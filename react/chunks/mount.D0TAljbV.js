function m0(s,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const a in i)if(a!=="default"&&!(a in s)){const n=Object.getOwnPropertyDescriptor(i,a);n&&Object.defineProperty(s,a,n.get?n:{enumerable:!0,get:()=>i[a]})}}}return Object.freeze(Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}))}function y0(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var b0={exports:{}},Lu={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mk=Symbol.for("react.transitional.element"),Rk=Symbol.for("react.fragment");function S0(s,e,t){var i=null;if(t!==void 0&&(i=""+t),e.key!==void 0&&(i=""+e.key),"key"in e){t={};for(var a in e)a!=="key"&&(t[a]=e[a])}else t=e;return e=t.ref,{$$typeof:Mk,type:s,key:i,ref:e!==void 0?e:null,props:t}}Lu.Fragment=Rk;Lu.jsx=S0;Lu.jsxs=S0;b0.exports=Lu;var ml=b0.exports;const Ok=y0(ml),Ik=m0({__proto__:null,default:Ok},[ml]),ud=typeof window>"u"?global:window,dd="@griffel/";function Hk(s,e){return ud[Symbol.for(dd+s)]||(ud[Symbol.for(dd+s)]=e),ud[Symbol.for(dd+s)]}const hf=Hk("DEFINITION_LOOKUP_TABLE",{}),yl="data-make-styles-bucket",Vk="data-priority",cf=7,Bp="___",Wk=Bp.length+cf,zk=0,Gk=1;function Uk(s){for(var e=0,t,i=0,a=s.length;a>=4;++i,a-=4)t=s.charCodeAt(i)&255|(s.charCodeAt(++i)&255)<<8|(s.charCodeAt(++i)&255)<<16|(s.charCodeAt(++i)&255)<<24,t=(t&65535)*1540483477+((t>>>16)*59797<<16),t^=t>>>24,e=(t&65535)*1540483477+((t>>>16)*59797<<16)^(e&65535)*1540483477+((e>>>16)*59797<<16);switch(a){case 3:e^=(s.charCodeAt(i+2)&255)<<16;case 2:e^=(s.charCodeAt(i+1)&255)<<8;case 1:e^=s.charCodeAt(i)&255,e=(e&65535)*1540483477+((e>>>16)*59797<<16)}return e^=e>>>13,e=(e&65535)*1540483477+((e>>>16)*59797<<16),((e^e>>>15)>>>0).toString(36)}function Yk(s){const e=s.length;if(e===cf)return s;for(let t=e;t<cf;t++)s+="0";return s}function w0(s,e,t=[]){return Bp+Yk(Uk(s+e))}function k0(s,e){let t="",i="";for(const a in s){const n=s[a];if(n===0){i+=a+" ";continue}const r=Array.isArray(n),o=e==="rtl"?(r?n[1]:n)+" ":(r?n[0]:n)+" ";t+=o,i+=o}return[t.slice(0,-1),i.slice(0,-1)]}function Qg(s,e){const t={};for(const i in s){const[a,n]=k0(s[i],e);if(n===""){t[i]="";continue}const r=w0(n,e),o=r+(a===""?"":" "+a);hf[r]=[s[i],e],t[i]=o}return t}const Kg={};function Xk(){let s=null,e="",t="";const i=new Array(arguments.length);for(let d=0;d<arguments.length;d++){const f=arguments[d];if(typeof f=="string"&&f!==""){const p=f.indexOf(Bp);if(p===-1)e+=f+" ";else{const g=f.substr(p,Wk);p>0&&(e+=f.slice(0,p)),t+=g,i[d]=g}}}if(t==="")return e.slice(0,-1);const a=Kg[t];if(a!==void 0)return e+a;const n=[];for(let d=0;d<arguments.length;d++){const f=i[d];if(f){const p=hf[f];p&&(n.push(p[zk]),s=p[Gk])}}const r=Object.assign.apply(Object,[{}].concat(n)),[o,l]=k0(r,s),h=w0(l,s,i),c=h+" "+o;return Kg[t]=c,hf[h]=[r,s],e+c}function qk(s){return Array.isArray(s)?s:[s]}function Jk(s,e,t,i){const a=[];if(i[yl]=e,i[Vk]=String(t),s)for(const r in i)s.setAttribute(r,i[r]);function n(r){return s!=null&&s.sheet?s.sheet.insertRule(r,s.sheet.cssRules.length):a.push(r)}return{elementAttributes:i,insertRule:n,element:s,bucketName:e,cssRules(){return s!=null&&s.sheet?Array.from(s.sheet.cssRules).map(r=>r.cssText):a}}}const Qk=["r","d","l","v","w","f","i","h","a","s","k","t","m","c"],$g=Qk.reduce((s,e,t)=>(s[e]=t,s),{});function Kk(s,e,t){return(s==="m"?s+e:s)+t}function $k(s,e,t,i,a={}){var n,r;const o=s==="m",l=(n=a.m)!==null&&n!==void 0?n:"0",h=(r=a.p)!==null&&r!==void 0?r:0,c=Kk(s,l,h);if(!i.stylesheets[c]){const d=e&&e.createElement("style"),f=Jk(d,s,h,Object.assign({},i.styleElementAttributes,o&&{media:l}));i.stylesheets[c]=f,e!=null&&e.head&&d&&e.head.insertBefore(d,jk(e,t,s,i,a))}return i.stylesheets[c]}function Zk(s,e,t){var i,a;const n=e+((i=t.m)!==null&&i!==void 0?i:""),r=s.getAttribute(yl)+((a=s.media)!==null&&a!==void 0?a:"");return n===r}function jk(s,e,t,i,a={}){var n,r;const o=$g[t],l=(n=a.m)!==null&&n!==void 0?n:"",h=(r=a.p)!==null&&r!==void 0?r:0;let c=m=>o-$g[m.getAttribute(yl)],d=s.head.querySelectorAll(`[${yl}]`);if(t==="m"){const m=s.head.querySelectorAll(`[${yl}="${t}"]`);m.length&&(d=m,c=T=>i.compareMediaQueries(l,T.media))}const f=m=>Zk(m,t,a)?h-Number(m.getAttribute("data-priority")):c(m),p=d.length;let g=p-1;for(;g>=0;){const m=d.item(g);if(f(m)>0)return m.nextSibling;g--}return p>0?d.item(0):e?e.nextSibling:null}function Zg(s,e){try{s.insertRule(e)}catch{}}let eT=0;const tT=(s,e)=>s<e?-1:s>e?1:0;function iT(s=typeof document>"u"?void 0:document,e={}){const{classNameHashSalt:t,unstable_filterCSSRule:i,insertionPoint:a,styleElementAttributes:n,compareMediaQueries:r=tT}=e,o={classNameHashSalt:t,insertionCache:{},stylesheets:{},styleElementAttributes:Object.freeze(n),compareMediaQueries:r,id:`d${eT++}`,insertCSSRules(l){for(const h in l){const c=l[h];for(let d=0,f=c.length;d<f;d++){const[p,g]=qk(c[d]),m=$k(h,s,a||null,o,g);o.insertionCache[p]||(o.insertionCache[p]=h,i?i(p)&&Zg(m,p):Zg(m,p))}}}};return o}const sT=()=>{const s={};return function(t,i){s[t.id]===void 0&&(t.insertCSSRules(i),s[t.id]=!0)}};function aT(s,e,t=sT){const i=t();let a=null,n=null;function r(o){const{dir:l,renderer:h}=o,c=l==="ltr";return c?a===null&&(a=Qg(s,l)):n===null&&(n=Qg(s,l)),i(h,e),c?a:n}return r}var T0={exports:{}},ze={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _p=Symbol.for("react.transitional.element"),nT=Symbol.for("react.portal"),rT=Symbol.for("react.fragment"),oT=Symbol.for("react.strict_mode"),lT=Symbol.for("react.profiler"),hT=Symbol.for("react.consumer"),cT=Symbol.for("react.context"),uT=Symbol.for("react.forward_ref"),dT=Symbol.for("react.suspense"),fT=Symbol.for("react.memo"),B0=Symbol.for("react.lazy"),pT=Symbol.for("react.activity"),jg=Symbol.iterator;function gT(s){return s===null||typeof s!="object"?null:(s=jg&&s[jg]||s["@@iterator"],typeof s=="function"?s:null)}var _0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},N0=Object.assign,x0={};function Ho(s,e,t){this.props=s,this.context=e,this.refs=x0,this.updater=t||_0}Ho.prototype.isReactComponent={};Ho.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};Ho.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function v0(){}v0.prototype=Ho.prototype;function Np(s,e,t){this.props=s,this.context=e,this.refs=x0,this.updater=t||_0}var xp=Np.prototype=new v0;xp.constructor=Np;N0(xp,Ho.prototype);xp.isPureReactComponent=!0;var em=Array.isArray;function uf(){}var Vt={H:null,A:null,T:null,S:null},C0=Object.prototype.hasOwnProperty;function vp(s,e,t){var i=t.ref;return{$$typeof:_p,type:s,key:e,ref:i!==void 0?i:null,props:t}}function mT(s,e){return vp(s.type,e,s.props)}function Cp(s){return typeof s=="object"&&s!==null&&s.$$typeof===_p}function yT(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(t){return e[t]})}var tm=/\/+/g;function fd(s,e){return typeof s=="object"&&s!==null&&s.key!=null?yT(""+s.key):e.toString(36)}function bT(s){switch(s.status){case"fulfilled":return s.value;case"rejected":throw s.reason;default:switch(typeof s.status=="string"?s.then(uf,uf):(s.status="pending",s.then(function(e){s.status==="pending"&&(s.status="fulfilled",s.value=e)},function(e){s.status==="pending"&&(s.status="rejected",s.reason=e)})),s.status){case"fulfilled":return s.value;case"rejected":throw s.reason}}throw s}function Jr(s,e,t,i,a){var n=typeof s;(n==="undefined"||n==="boolean")&&(s=null);var r=!1;if(s===null)r=!0;else switch(n){case"bigint":case"string":case"number":r=!0;break;case"object":switch(s.$$typeof){case _p:case nT:r=!0;break;case B0:return r=s._init,Jr(r(s._payload),e,t,i,a)}}if(r)return a=a(s),r=i===""?"."+fd(s,0):i,em(a)?(t="",r!=null&&(t=r.replace(tm,"$&/")+"/"),Jr(a,e,t,"",function(h){return h})):a!=null&&(Cp(a)&&(a=mT(a,t+(a.key==null||s&&s.key===a.key?"":(""+a.key).replace(tm,"$&/")+"/")+r)),e.push(a)),1;r=0;var o=i===""?".":i+":";if(em(s))for(var l=0;l<s.length;l++)i=s[l],n=o+fd(i,l),r+=Jr(i,e,t,n,a);else if(l=gT(s),typeof l=="function")for(s=l.call(s),l=0;!(i=s.next()).done;)i=i.value,n=o+fd(i,l++),r+=Jr(i,e,t,n,a);else if(n==="object"){if(typeof s.then=="function")return Jr(bT(s),e,t,i,a);throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.")}return r}function Uh(s,e,t){if(s==null)return s;var i=[],a=0;return Jr(s,i,"","",function(n){return e.call(t,n,a++)}),i}function ST(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(t){(s._status===0||s._status===-1)&&(s._status=1,s._result=t)},function(t){(s._status===0||s._status===-1)&&(s._status=2,s._result=t)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var im=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},wT={map:Uh,forEach:function(s,e,t){Uh(s,function(){e.apply(this,arguments)},t)},count:function(s){var e=0;return Uh(s,function(){e++}),e},toArray:function(s){return Uh(s,function(e){return e})||[]},only:function(s){if(!Cp(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};ze.Activity=pT;ze.Children=wT;ze.Component=Ho;ze.Fragment=rT;ze.Profiler=lT;ze.PureComponent=Np;ze.StrictMode=oT;ze.Suspense=dT;ze.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=Vt;ze.__COMPILER_RUNTIME={__proto__:null,c:function(s){return Vt.H.useMemoCache(s)}};ze.cache=function(s){return function(){return s.apply(null,arguments)}};ze.cacheSignal=function(){return null};ze.cloneElement=function(s,e,t){if(s==null)throw Error("The argument must be a React element, but you passed "+s+".");var i=N0({},s.props),a=s.key;if(e!=null)for(n in e.key!==void 0&&(a=""+e.key),e)!C0.call(e,n)||n==="key"||n==="__self"||n==="__source"||n==="ref"&&e.ref===void 0||(i[n]=e[n]);var n=arguments.length-2;if(n===1)i.children=t;else if(1<n){for(var r=Array(n),o=0;o<n;o++)r[o]=arguments[o+2];i.children=r}return vp(s.type,a,i)};ze.createContext=function(s){return s={$$typeof:cT,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null},s.Provider=s,s.Consumer={$$typeof:hT,_context:s},s};ze.createElement=function(s,e,t){var i,a={},n=null;if(e!=null)for(i in e.key!==void 0&&(n=""+e.key),e)C0.call(e,i)&&i!=="key"&&i!=="__self"&&i!=="__source"&&(a[i]=e[i]);var r=arguments.length-2;if(r===1)a.children=t;else if(1<r){for(var o=Array(r),l=0;l<r;l++)o[l]=arguments[l+2];a.children=o}if(s&&s.defaultProps)for(i in r=s.defaultProps,r)a[i]===void 0&&(a[i]=r[i]);return vp(s,n,a)};ze.createRef=function(){return{current:null}};ze.forwardRef=function(s){return{$$typeof:uT,render:s}};ze.isValidElement=Cp;ze.lazy=function(s){return{$$typeof:B0,_payload:{_status:-1,_result:s},_init:ST}};ze.memo=function(s,e){return{$$typeof:fT,type:s,compare:e===void 0?null:e}};ze.startTransition=function(s){var e=Vt.T,t={};Vt.T=t;try{var i=s(),a=Vt.S;a!==null&&a(t,i),typeof i=="object"&&i!==null&&typeof i.then=="function"&&i.then(uf,im)}catch(n){im(n)}finally{e!==null&&t.types!==null&&(e.types=t.types),Vt.T=e}};ze.unstable_useCacheRefresh=function(){return Vt.H.useCacheRefresh()};ze.use=function(s){return Vt.H.use(s)};ze.useActionState=function(s,e,t){return Vt.H.useActionState(s,e,t)};ze.useCallback=function(s,e){return Vt.H.useCallback(s,e)};ze.useContext=function(s){return Vt.H.useContext(s)};ze.useDebugValue=function(){};ze.useDeferredValue=function(s,e){return Vt.H.useDeferredValue(s,e)};ze.useEffect=function(s,e){return Vt.H.useEffect(s,e)};ze.useEffectEvent=function(s){return Vt.H.useEffectEvent(s)};ze.useId=function(){return Vt.H.useId()};ze.useImperativeHandle=function(s,e,t){return Vt.H.useImperativeHandle(s,e,t)};ze.useInsertionEffect=function(s,e){return Vt.H.useInsertionEffect(s,e)};ze.useLayoutEffect=function(s,e){return Vt.H.useLayoutEffect(s,e)};ze.useMemo=function(s,e){return Vt.H.useMemo(s,e)};ze.useOptimistic=function(s,e){return Vt.H.useOptimistic(s,e)};ze.useReducer=function(s,e,t){return Vt.H.useReducer(s,e,t)};ze.useRef=function(s){return Vt.H.useRef(s)};ze.useState=function(s){return Vt.H.useState(s)};ze.useSyncExternalStore=function(s,e,t){return Vt.H.useSyncExternalStore(s,e,t)};ze.useTransition=function(){return Vt.H.useTransition()};ze.version="19.2.0";T0.exports=ze;var Ae=T0.exports;const E0=y0(Ae),kT=m0({__proto__:null,default:E0},[Ae]),TT=Ae.createContext(iT());function D0(){return Ae.useContext(TT)}const P0=Ae.createContext("ltr"),BT=({children:s,dir:e})=>Ae.createElement(P0.Provider,{value:e},s);function J2(){return Ae.useContext(P0)}function _T(s,e){if(e){const t=Object.keys(e).reduce((i,a)=>`${i}--${a}: ${e[a]}; `,"");return`${s} { ${t} }`}return`${s} {}`}const L0=Symbol.for("fui.slotRenderFunction"),Au=Symbol.for("fui.slotElementType"),A0=Symbol.for("fui.slotClassNameProp");function F0(s,e){const{defaultProps:t,elementType:i}=e,a=NT(s),n={...t,...a,[Au]:i,[A0]:a==null?void 0:a.className};return a&&typeof a.children=="function"&&(n[L0]=a.children,n.children=t==null?void 0:t.children),n}function Q2(s,e){if(!(s===null||s===void 0&&!e.renderByDefault))return F0(s,e)}function NT(s){return typeof s=="string"||typeof s=="number"||xT(s)||Ae.isValidElement(s)?{children:s}:s}const xT=s=>typeof s=="object"&&s!==null&&Symbol.iterator in s;function sm(s){return!!(s!=null&&s.hasOwnProperty(Au))}const Ot=(...s)=>{const e={};for(const t of s){const i=Array.isArray(t)?t:Object.keys(t);for(const a of i)e[a]=1}return e},vT=Ot(["onAuxClick","onAnimationEnd","onAnimationStart","onCopy","onCut","onPaste","onCompositionEnd","onCompositionStart","onCompositionUpdate","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onInput","onSubmit","onLoad","onError","onKeyDown","onKeyDownCapture","onKeyPress","onKeyUp","onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting","onClick","onClickCapture","onContextMenu","onDoubleClick","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onMouseUpCapture","onSelect","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onScroll","onWheel","onPointerCancel","onPointerDown","onPointerEnter","onPointerLeave","onPointerMove","onPointerOut","onPointerOver","onPointerUp","onGotPointerCapture","onLostPointerCapture"]),CT=Ot(["accessKey","children","className","contentEditable","dir","draggable","hidden","htmlFor","id","lang","ref","role","style","tabIndex","title","translate","spellCheck","name"]),ET=Ot(["itemID","itemProp","itemRef","itemScope","itemType"]),_i=Ot(CT,vT,ET),DT=Ot(_i,["form"]),M0=Ot(_i,["height","loop","muted","preload","src","width"]),PT=Ot(M0,["poster"]),LT=Ot(_i,["start"]),AT=Ot(_i,["value"]),FT=Ot(_i,["download","href","hrefLang","media","referrerPolicy","rel","target","type"]),MT=Ot(_i,["dateTime"]),Fu=Ot(_i,["autoFocus","disabled","form","formAction","formEncType","formMethod","formNoValidate","formTarget","type","value"]),RT=Ot(Fu,["accept","alt","autoCorrect","autoCapitalize","autoComplete","checked","dirname","form","height","inputMode","list","max","maxLength","min","minLength","multiple","pattern","placeholder","readOnly","required","src","step","size","type","value","width"]),OT=Ot(Fu,["autoCapitalize","cols","dirname","form","maxLength","placeholder","readOnly","required","rows","wrap"]),IT=Ot(Fu,["form","multiple","required"]),HT=Ot(_i,["selected","value"]),VT=Ot(_i,["cellPadding","cellSpacing"]),WT=_i,zT=Ot(_i,["colSpan","rowSpan","scope"]),GT=Ot(_i,["colSpan","headers","rowSpan","scope"]),UT=Ot(_i,["span"]),YT=Ot(_i,["span"]),XT=Ot(_i,["disabled","form"]),qT=Ot(_i,["acceptCharset","action","encType","encType","method","noValidate","target"]),JT=Ot(_i,["allow","allowFullScreen","allowPaymentRequest","allowTransparency","csp","height","importance","referrerPolicy","sandbox","src","srcDoc","width"]),QT=Ot(_i,["alt","crossOrigin","height","src","srcSet","useMap","width"]),KT=Ot(_i,["open","onCancel","onClose"]);function $T(s,e,t){const i=Array.isArray(e),a={},n=Object.keys(s);for(const r of n)(!i&&e[r]||i&&e.indexOf(r)>=0||r.indexOf("data-")===0||r.indexOf("aria-")===0)&&(!t||(t==null?void 0:t.indexOf(r))===-1)&&(a[r]=s[r]);return a}const ZT={label:DT,audio:M0,video:PT,ol:LT,li:AT,a:FT,button:Fu,input:RT,textarea:OT,select:IT,option:HT,table:VT,tr:WT,th:zT,td:GT,colGroup:UT,col:YT,fieldset:XT,form:qT,iframe:JT,img:QT,time:MT,dialog:KT};function R0(s,e,t){const i=s&&ZT[s]||_i;return i.as=1,$T(e,i,t)}const K2=({primarySlotTagName:s,props:e,excludedPropNames:t})=>({root:{style:e.style,className:e.className},primary:R0(s,e,[...t||[],"style","className"])}),jT=(s,e,t)=>{var i;return R0((i=e.as)!==null&&i!==void 0?i:s,e,t)},O0=Ae.createContext(void 0),eB=O0.Provider,I0=Ae.createContext(void 0),tB="",iB=I0.Provider;function $2(){var s;return(s=Ae.useContext(I0))!==null&&s!==void 0?s:tB}const H0=Ae.createContext(void 0),sB={},aB=H0.Provider;function Z2(){var s;return(s=Ae.useContext(H0))!==null&&s!==void 0?s:sB}const V0=Ae.createContext(void 0),nB={targetDocument:typeof document=="object"?document:void 0,dir:"ltr"},rB=V0.Provider;function W0(){var s;return(s=Ae.useContext(V0))!==null&&s!==void 0?s:nB}const z0=Ae.createContext(void 0),oB=z0.Provider;function lB(){var s;return(s=Ae.useContext(z0))!==null&&s!==void 0?s:{}}const Ep=Ae.createContext(void 0),hB=()=>{},cB=Ep.Provider,j2=s=>{var e,t;return(t=(e=Ae.useContext(Ep))===null||e===void 0?void 0:e[s])!==null&&t!==void 0?t:hB};function Dp(){return typeof window<"u"&&!!(window.document&&window.document.createElement)}const G0={current:0},uB=Ae.createContext(void 0);function U0(){var s;return(s=Ae.useContext(uB))!==null&&s!==void 0?s:G0}function eE(){const s=U0()!==G0,[e,t]=Ae.useState(s);return Dp()&&s&&Ae.useLayoutEffect(()=>{t(!1)},[]),e}const dB=Dp()?Ae.useLayoutEffect:Ae.useEffect,Y0=Ae.createContext(void 0);Y0.Provider;function fB(){return Ae.useContext(Y0)||""}function pB(s="fui-",e){"use no memo";const t=U0(),i=fB(),a=kT.useId;if(a){const n=a(),r=Ae.useMemo(()=>n.replace(/:/g,""),[n]);return e||`${i}${s}${r}`}return Ae.useMemo(()=>e||`${i}${s}${++t.current}`,[i,s,e,t])}function gB(...s){"use no memo";const e=Ae.useCallback(t=>{e.current=t;for(const i of s)typeof i=="function"?i(t):i&&(i.current=t)},[...s]);return e}function am(s,e){var t;const i=s;var a;return!!(!(i==null||(t=i.ownerDocument)===null||t===void 0)&&t.defaultView&&i instanceof i.ownerDocument.defaultView[(a=void 0)!==null&&a!==void 0?a:"HTMLElement"])}function mB(s,e){return{...e,[Au]:s}}function X0(s,e){return function(i,a,n,r,o){return sm(a)?e(mB(i,a),null,n,r,o):sm(i)?e(i,a,n,r,o):s(i,a,n,r,o)}}function q0(s){const{as:e,[A0]:t,[Au]:i,[L0]:a,...n}=s,r=n,o=typeof i=="string"?e??i:i;return typeof o!="string"&&e&&(r.as=e),{elementType:o,props:r,renderFunction:a}}const wr=Ik,yB=(s,e,t)=>{const{elementType:i,renderFunction:a,props:n}=q0(s),r={...n,...e};return a?wr.jsx(Ae.Fragment,{children:a(i,r)},t):wr.jsx(i,r,t)},bB=(s,e,t)=>{const{elementType:i,renderFunction:a,props:n}=q0(s),r={...n,...e};return a?wr.jsx(Ae.Fragment,{children:a(i,{...r,children:wr.jsxs(Ae.Fragment,{children:r.children},void 0)})},t):wr.jsxs(i,r,t)},Aa=X0(wr.jsx,yB),SB=X0(wr.jsxs,bB),J0=Ae.createContext(void 0),wB={},kB=J0.Provider,tE=()=>{const s=Ae.useContext(J0);return s??wB},TB=(s,e)=>Aa(rB,{value:e.provider,children:Aa(eB,{value:e.theme,children:Aa(iB,{value:e.themeClassName,children:Aa(cB,{value:e.customStyleHooks_unstable,children:Aa(aB,{value:e.tooltip,children:Aa(BT,{dir:e.textDirection,children:Aa(kB,{value:e.iconDirection,children:Aa(oB,{value:e.overrides_unstable,children:SB(s.root,{children:[Dp()?null:Aa("style",{dangerouslySetInnerHTML:{__html:s.serverStyleProps.cssRule},...s.serverStyleProps.attributes}),s.root.children]})})})})})})})})});var BB=typeof WeakRef<"u",nm=class{constructor(s){BB&&typeof s=="object"?this._weakRef=new WeakRef(s):this._instance=s}deref(){var s,e;let t;return this._weakRef?(t=(s=this._weakRef)==null?void 0:s.deref(),t||delete this._weakRef):(t=this._instance,(e=t==null?void 0:t.isDisposed)!=null&&e.call(t)&&delete this._instance),t}},Ul="keyborg:focusin",_B="keyborg:focusout";function NB(s){const e=s.HTMLElement,t=e.prototype.focus;let i=!1;return e.prototype.focus=function(){i=!0},s.document.createElement("button").focus(),e.prototype.focus=t,i}var pd=!1;function iE(s){const e=s.focus;e.__keyborgNativeFocus?e.__keyborgNativeFocus.call(s):s.focus()}function xB(s){const e=s;pd||(pd=NB(e));const t=e.HTMLElement.prototype.focus;if(t.__keyborgNativeFocus)return;e.HTMLElement.prototype.focus=l;const i=new Set,a=c=>{const d=c.target;if(!d)return;const f=new CustomEvent(_B,{cancelable:!0,bubbles:!0,composed:!0,detail:{originalEvent:c}});d.dispatchEvent(f)},n=c=>{const d=c.target;if(!d)return;let f=c.composedPath()[0];const p=new Set;for(;f;)f.nodeType===Node.DOCUMENT_FRAGMENT_NODE?(p.add(f),f=f.host):f=f.parentNode;for(const g of i){const m=g.deref();(!m||!p.has(m))&&(i.delete(g),m&&(m.removeEventListener("focusin",n,!0),m.removeEventListener("focusout",a,!0)))}r(d,c.relatedTarget||void 0)},r=(c,d,f)=>{var p;const g=c.shadowRoot;if(g){for(const S of i)if(S.deref()===g)return;g.addEventListener("focusin",n,!0),g.addEventListener("focusout",a,!0),i.add(new nm(g));return}const m={relatedTarget:d,originalEvent:f},T=new CustomEvent(Ul,{cancelable:!0,bubbles:!0,composed:!0,detail:m});T.details=m,(pd||o.lastFocusedProgrammatically)&&(m.isFocusedProgrammatically=c===((p=o.lastFocusedProgrammatically)==null?void 0:p.deref()),o.lastFocusedProgrammatically=void 0),c.dispatchEvent(T)},o=e.__keyborgData={focusInHandler:n,focusOutHandler:a,shadowTargets:i};e.document.addEventListener("focusin",e.__keyborgData.focusInHandler,!0),e.document.addEventListener("focusout",e.__keyborgData.focusOutHandler,!0);function l(){const c=e.__keyborgData;return c&&(c.lastFocusedProgrammatically=new nm(this)),t.apply(this,arguments)}let h=e.document.activeElement;for(;h&&h.shadowRoot;)r(h),h=h.shadowRoot.activeElement;l.__keyborgNativeFocus=t}function vB(s){const e=s,t=e.HTMLElement.prototype,i=t.focus.__keyborgNativeFocus,a=e.__keyborgData;if(a){e.document.removeEventListener("focusin",a.focusInHandler,!0),e.document.removeEventListener("focusout",a.focusOutHandler,!0);for(const n of a.shadowTargets){const r=n.deref();r&&(r.removeEventListener("focusin",a.focusInHandler,!0),r.removeEventListener("focusout",a.focusOutHandler,!0))}a.shadowTargets.clear(),delete e.__keyborgData}i&&(t.focus=i)}var CB=500,Q0=0,EB=class{constructor(s,e){this._isNavigatingWithKeyboard_DO_NOT_USE=!1,this._onFocusIn=i=>{if(this._isMouseOrTouchUsedTimer||this.isNavigatingWithKeyboard)return;const a=i.detail;a.relatedTarget&&(a.isFocusedProgrammatically||a.isFocusedProgrammatically===void 0||(this.isNavigatingWithKeyboard=!0))},this._onMouseDown=i=>{i.buttons===0||i.clientX===0&&i.clientY===0&&i.screenX===0&&i.screenY===0||this._onMouseOrTouch()},this._onMouseOrTouch=()=>{const i=this._win;i&&(this._isMouseOrTouchUsedTimer&&i.clearTimeout(this._isMouseOrTouchUsedTimer),this._isMouseOrTouchUsedTimer=i.setTimeout(()=>{delete this._isMouseOrTouchUsedTimer},1e3)),this.isNavigatingWithKeyboard=!1},this._onKeyDown=i=>{this.isNavigatingWithKeyboard?this._shouldDismissKeyboardNavigation(i)&&this._scheduleDismiss():this._shouldTriggerKeyboardNavigation(i)&&(this.isNavigatingWithKeyboard=!0)},this.id="c"+ ++Q0,this._win=s;const t=s.document;if(e){const i=e.triggerKeys,a=e.dismissKeys;i!=null&&i.length&&(this._triggerKeys=new Set(i)),a!=null&&a.length&&(this._dismissKeys=new Set(a))}t.addEventListener(Ul,this._onFocusIn,!0),t.addEventListener("mousedown",this._onMouseDown,!0),s.addEventListener("keydown",this._onKeyDown,!0),t.addEventListener("touchstart",this._onMouseOrTouch,!0),t.addEventListener("touchend",this._onMouseOrTouch,!0),t.addEventListener("touchcancel",this._onMouseOrTouch,!0),xB(s)}get isNavigatingWithKeyboard(){return this._isNavigatingWithKeyboard_DO_NOT_USE}set isNavigatingWithKeyboard(s){this._isNavigatingWithKeyboard_DO_NOT_USE!==s&&(this._isNavigatingWithKeyboard_DO_NOT_USE=s,this.update())}dispose(){const s=this._win;if(s){this._isMouseOrTouchUsedTimer&&(s.clearTimeout(this._isMouseOrTouchUsedTimer),this._isMouseOrTouchUsedTimer=void 0),this._dismissTimer&&(s.clearTimeout(this._dismissTimer),this._dismissTimer=void 0),vB(s);const e=s.document;e.removeEventListener(Ul,this._onFocusIn,!0),e.removeEventListener("mousedown",this._onMouseDown,!0),s.removeEventListener("keydown",this._onKeyDown,!0),e.removeEventListener("touchstart",this._onMouseOrTouch,!0),e.removeEventListener("touchend",this._onMouseOrTouch,!0),e.removeEventListener("touchcancel",this._onMouseOrTouch,!0),delete this._win}}isDisposed(){return!!this._win}update(){var s,e;const t=(e=(s=this._win)==null?void 0:s.__keyborg)==null?void 0:e.refs;if(t)for(const i of Object.keys(t))Pp.update(t[i],this.isNavigatingWithKeyboard)}_shouldTriggerKeyboardNavigation(s){var e;if(s.key==="Tab")return!0;const t=(e=this._win)==null?void 0:e.document.activeElement,i=!this._triggerKeys||this._triggerKeys.has(s.keyCode),a=t&&(t.tagName==="INPUT"||t.tagName==="TEXTAREA"||t.isContentEditable);return i&&!a}_shouldDismissKeyboardNavigation(s){var e;return(e=this._dismissKeys)==null?void 0:e.has(s.keyCode)}_scheduleDismiss(){const s=this._win;if(s){this._dismissTimer&&(s.clearTimeout(this._dismissTimer),this._dismissTimer=void 0);const e=s.document.activeElement;this._dismissTimer=s.setTimeout(()=>{this._dismissTimer=void 0;const t=s.document.activeElement;e&&t&&e===t&&(this.isNavigatingWithKeyboard=!1)},CB)}}},Pp=class K0{constructor(e,t){this._cb=[],this._id="k"+ ++Q0,this._win=e;const i=e.__keyborg;i?(this._core=i.core,i.refs[this._id]=this):(this._core=new EB(e,t),e.__keyborg={core:this._core,refs:{[this._id]:this}})}static create(e,t){return new K0(e,t)}static dispose(e){e.dispose()}static update(e,t){e._cb.forEach(i=>i(t))}dispose(){var e;const t=(e=this._win)==null?void 0:e.__keyborg;t!=null&&t.refs[this._id]&&(delete t.refs[this._id],Object.keys(t.refs).length===0&&(t.core.dispose(),delete this._win.__keyborg)),this._cb=[],delete this._core,delete this._win}isNavigatingWithKeyboard(){var e;return!!((e=this._core)!=null&&e.isNavigatingWithKeyboard)}subscribe(e){this._cb.push(e)}unsubscribe(e){const t=this._cb.indexOf(e);t>=0&&this._cb.splice(t,1)}setVal(e){this._core&&(this._core.isNavigatingWithKeyboard=e)}};function DB(s,e){return Pp.create(s,e)}function PB(s){Pp.dispose(s)}/*!
 * Copyright (c) Microsoft Corporation. All rights reserved.
 * Licensed under the MIT License.
 */const rm="data-fui-focus-visible",sE="data-fui-focus-within";function LB(s,e){if($0(s))return()=>{};const t={current:void 0},i=DB(e);function a(l){i.isNavigatingWithKeyboard()&&am(l)&&(t.current=l,l.setAttribute(rm,""))}function n(){t.current&&(t.current.removeAttribute(rm),t.current=void 0)}i.subscribe(l=>{l?a(e.document.activeElement):n()});const r=l=>{n();const h=l.composedPath()[0];a(h)},o=l=>{(!l.relatedTarget||am(l.relatedTarget)&&!s.contains(l.relatedTarget))&&n()};return s.addEventListener(Ul,r),s.addEventListener("focusout",o),s.focusVisible=!0,s.contains(e.document.activeElement)&&a(e.document.activeElement),()=>{n(),s.removeEventListener(Ul,r),s.removeEventListener("focusout",o),s.focusVisible=void 0,PB(i)}}function $0(s){return s?s.focusVisible?!0:$0(s==null?void 0:s.parentElement):!1}function AB(s={}){const e=W0(),t=Ae.useRef(null);var i;const a=(i=s.targetDocument)!==null&&i!==void 0?i:e.targetDocument;return Ae.useEffect(()=>{if(a!=null&&a.defaultView&&t.current)return LB(t.current,a.defaultView)},[t,a]),t}const ye={14:"#242424",16:"#292929",20:"#333333",26:"#424242",30:"#4d4d4d",34:"#575757",38:"#616161",44:"#707070",70:"#b3b3b3",74:"#bdbdbd",78:"#c7c7c7",82:"#d1d1d1",84:"#d6d6d6",86:"#dbdbdb",88:"#e0e0e0",90:"#e6e6e6",92:"#ebebeb",94:"#f0f0f0",96:"#f5f5f5",98:"#fafafa"},yn={10:"rgba(255, 255, 255, 0.1)",20:"rgba(255, 255, 255, 0.2)",40:"rgba(255, 255, 255, 0.4)",50:"rgba(255, 255, 255, 0.5)",70:"rgba(255, 255, 255, 0.7)",80:"rgba(255, 255, 255, 0.8)"},bn={5:"rgba(0, 0, 0, 0.05)",10:"rgba(0, 0, 0, 0.1)",20:"rgba(0, 0, 0, 0.2)",30:"rgba(0, 0, 0, 0.3)",40:"rgba(0, 0, 0, 0.4)",50:"rgba(0, 0, 0, 0.5)"},ri="#ffffff",FB="#000000",MB={shade50:"#130204",shade40:"#230308",shade30:"#420610",shade20:"#590815",shade10:"#690a19",primary:"#750b1c",tint10:"#861b2c",tint20:"#962f3f",tint30:"#ac4f5e",tint40:"#d69ca5",tint50:"#e9c7cd",tint60:"#f9f0f2"},Z0={shade50:"#200205",shade40:"#3b0509",shade30:"#6e0811",shade20:"#960b18",shade10:"#b10e1c",primary:"#c50f1f",tint10:"#cc2635",tint20:"#d33f4c",tint30:"#dc626d",tint40:"#eeacb2",tint50:"#f6d1d5",tint60:"#fdf3f4"},RB={shade50:"#210809",shade40:"#3f1011",shade30:"#751d1f",shade20:"#9f282b",shade10:"#bc2f32",primary:"#d13438",tint10:"#d7494c",tint20:"#dc5e62",tint30:"#e37d80",tint40:"#f1bbbc",tint50:"#f8dadb",tint60:"#fdf6f6"},OB={shade50:"#230900",shade40:"#411200",shade30:"#7a2101",shade20:"#a62d01",shade10:"#c43501",primary:"#da3b01",tint10:"#de501c",tint20:"#e36537",tint30:"#e9835e",tint40:"#f4bfab",tint50:"#f9dcd1",tint60:"#fdf6f3"},IB={shade50:"#200d03",shade40:"#3d1805",shade30:"#712d09",shade20:"#9a3d0c",shade10:"#b6480e",primary:"#ca5010",tint10:"#d06228",tint20:"#d77440",tint30:"#df8e64",tint40:"#efc4ad",tint50:"#f7dfd2",tint60:"#fdf7f4"},HB={shade50:"#271002",shade40:"#4a1e04",shade30:"#8a3707",shade20:"#bc4b09",shade10:"#de590b",primary:"#f7630c",tint10:"#f87528",tint20:"#f98845",tint30:"#faa06b",tint40:"#fdcfb4",tint50:"#fee5d7",tint60:"#fff9f5"},VB={shade50:"#291600",shade40:"#4d2a00",shade30:"#8f4e00",shade20:"#c26a00",shade10:"#e67e00",primary:"#ff8c00",tint10:"#ff9a1f",tint20:"#ffa83d",tint30:"#ffba66",tint40:"#ffddb3",tint50:"#ffedd6",tint60:"#fffaf5"},WB={shade50:"#251a00",shade40:"#463100",shade30:"#835b00",shade20:"#b27c00",shade10:"#d39300",primary:"#eaa300",tint10:"#edad1c",tint20:"#efb839",tint30:"#f2c661",tint40:"#f9e2ae",tint50:"#fcefd3",tint60:"#fefbf4"},zB={shade50:"#282400",shade40:"#4c4400",shade30:"#817400",shade20:"#c0ad00",shade10:"#e4cc00",primary:"#fde300",tint10:"#fde61e",tint20:"#fdea3d",tint30:"#feee66",tint40:"#fef7b2",tint50:"#fffad6",tint60:"#fffef5"},GB={shade50:"#1f1900",shade40:"#3a2f00",shade30:"#6c5700",shade20:"#937700",shade10:"#ae8c00",primary:"#c19c00",tint10:"#c8a718",tint20:"#d0b232",tint30:"#dac157",tint40:"#ecdfa5",tint50:"#f5eece",tint60:"#fdfbf2"},UB={shade50:"#181202",shade40:"#2e2103",shade30:"#553e06",shade20:"#745408",shade10:"#89640a",primary:"#986f0b",tint10:"#a47d1e",tint20:"#b18c34",tint30:"#c1a256",tint40:"#e0cea2",tint50:"#efe4cb",tint60:"#fbf8f2"},YB={shade50:"#170e07",shade40:"#2b1a0e",shade30:"#50301a",shade20:"#6c4123",shade10:"#804d29",primary:"#8e562e",tint10:"#9c663f",tint20:"#a97652",tint30:"#bb8f6f",tint40:"#ddc3b0",tint50:"#edded3",tint60:"#faf7f4"},XB={shade50:"#0c1501",shade40:"#162702",shade30:"#294903",shade20:"#376304",shade10:"#427505",primary:"#498205",tint10:"#599116",tint20:"#6ba02b",tint30:"#85b44c",tint40:"#bdd99b",tint50:"#dbebc7",tint60:"#f6faf0"},qB={shade50:"#002111",shade40:"#003d20",shade30:"#00723b",shade20:"#009b51",shade10:"#00b85f",primary:"#00cc6a",tint10:"#19d279",tint20:"#34d889",tint30:"#5ae0a0",tint40:"#a8f0cd",tint50:"#cff7e4",tint60:"#f3fdf8"},JB={shade50:"#031a02",shade40:"#063004",shade30:"#0b5a08",shade20:"#0e7a0b",shade10:"#11910d",primary:"#13a10e",tint10:"#27ac22",tint20:"#3db838",tint30:"#5ec75a",tint40:"#a7e3a5",tint50:"#cef0cd",tint60:"#f2fbf2"},j0={shade50:"#031403",shade40:"#052505",shade30:"#094509",shade20:"#0c5e0c",shade10:"#0e700e",primary:"#107c10",tint10:"#218c21",tint20:"#359b35",tint30:"#54b054",tint40:"#9fd89f",tint50:"#c9eac9",tint60:"#f1faf1"},QB={shade50:"#021102",shade40:"#032003",shade30:"#063b06",shade20:"#085108",shade10:"#0a5f0a",primary:"#0b6a0b",tint10:"#1a7c1a",tint20:"#2d8e2d",tint30:"#4da64d",tint40:"#9ad29a",tint50:"#c6e7c6",tint60:"#f0f9f0"},KB={shade50:"#001d1f",shade40:"#00373a",shade30:"#00666d",shade20:"#008b94",shade10:"#00a5af",primary:"#00b7c3",tint10:"#18bfca",tint20:"#32c8d1",tint30:"#58d3db",tint40:"#a6e9ed",tint50:"#cef3f5",tint60:"#f2fcfd"},$B={shade50:"#001516",shade40:"#012728",shade30:"#02494c",shade20:"#026467",shade10:"#037679",primary:"#038387",tint10:"#159195",tint20:"#2aa0a4",tint30:"#4cb4b7",tint40:"#9bd9db",tint50:"#c7ebec",tint60:"#f0fafa"},ZB={shade50:"#000f12",shade40:"#001b22",shade30:"#00333f",shade20:"#004555",shade10:"#005265",primary:"#005b70",tint10:"#0f6c81",tint20:"#237d92",tint30:"#4496a9",tint40:"#94c8d4",tint50:"#c3e1e8",tint60:"#eff7f9"},jB={shade50:"#001322",shade40:"#002440",shade30:"#004377",shade20:"#005ba1",shade10:"#006cbf",primary:"#0078d4",tint10:"#1a86d9",tint20:"#3595de",tint30:"#5caae5",tint40:"#a9d3f2",tint50:"#d0e7f8",tint60:"#f3f9fd"},e_={shade50:"#000c16",shade40:"#00172a",shade30:"#002c4e",shade20:"#003b6a",shade10:"#00467e",primary:"#004e8c",tint10:"#125e9a",tint20:"#286fa8",tint30:"#4a89ba",tint40:"#9abfdc",tint50:"#c7dced",tint60:"#f0f6fa"},t_={shade50:"#0d1126",shade40:"#182047",shade30:"#2c3c85",shade20:"#3c51b4",shade10:"#4760d5",primary:"#4f6bed",tint10:"#637cef",tint20:"#778df1",tint30:"#93a4f4",tint40:"#c8d1fa",tint50:"#e1e6fc",tint60:"#f7f9fe"},i_={shade50:"#00061d",shade40:"#000c36",shade30:"#001665",shade20:"#001e89",shade10:"#0023a2",primary:"#0027b4",tint10:"#173bbd",tint20:"#3050c6",tint30:"#546fd2",tint40:"#a3b2e8",tint50:"#ccd5f3",tint60:"#f2f4fc"},s_={shade50:"#120f25",shade40:"#221d46",shade30:"#3f3682",shade20:"#5649b0",shade10:"#6656d1",primary:"#7160e8",tint10:"#8172eb",tint20:"#9184ee",tint30:"#a79cf1",tint40:"#d2ccf8",tint50:"#e7e4fb",tint60:"#f9f8fe"},a_={shade50:"#0f0717",shade40:"#1c0e2b",shade30:"#341a51",shade20:"#46236e",shade10:"#532982",primary:"#5c2e91",tint10:"#6b3f9e",tint20:"#7c52ab",tint30:"#9470bd",tint40:"#c6b1de",tint50:"#e0d3ed",tint60:"#f7f4fb"},n_={shade50:"#160418",shade40:"#29072e",shade30:"#4c0d55",shade20:"#671174",shade10:"#7a1589",primary:"#881798",tint10:"#952aa4",tint20:"#a33fb1",tint30:"#b55fc1",tint40:"#d9a7e0",tint50:"#eaceef",tint60:"#faf2fb"},r_={shade50:"#1f091d",shade40:"#3a1136",shade30:"#6d2064",shade20:"#932b88",shade10:"#af33a1",primary:"#c239b3",tint10:"#c94cbc",tint20:"#d161c4",tint30:"#da7ed0",tint40:"#edbbe7",tint50:"#f5daf2",tint60:"#fdf5fc"},o_={shade50:"#1c0b1f",shade40:"#35153a",shade30:"#63276d",shade20:"#863593",shade10:"#9f3faf",primary:"#b146c2",tint10:"#ba58c9",tint20:"#c36bd1",tint30:"#cf87da",tint40:"#e6bfed",tint50:"#f2dcf5",tint60:"#fcf6fd"},l_={shade50:"#24091b",shade40:"#441232",shade30:"#80215d",shade20:"#ad2d7e",shade10:"#cd3595",primary:"#e43ba6",tint10:"#e750b0",tint20:"#ea66ba",tint30:"#ef85c8",tint40:"#f7c0e3",tint50:"#fbddf0",tint60:"#fef6fb"},h_={shade50:"#1f0013",shade40:"#390024",shade30:"#6b0043",shade20:"#91005a",shade10:"#ac006b",primary:"#bf0077",tint10:"#c71885",tint20:"#ce3293",tint30:"#d957a8",tint40:"#eca5d1",tint50:"#f5cee6",tint60:"#fcf2f9"},c_={shade50:"#13000c",shade40:"#240017",shade30:"#43002b",shade20:"#5a003b",shade10:"#6b0045",primary:"#77004d",tint10:"#87105d",tint20:"#98246f",tint30:"#ad4589",tint40:"#d696c0",tint50:"#e9c4dc",tint60:"#faf0f6"},u_={shade50:"#141313",shade40:"#252323",shade30:"#444241",shade20:"#5d5958",shade10:"#6e6968",primary:"#7a7574",tint10:"#8a8584",tint20:"#9a9594",tint30:"#afabaa",tint40:"#d7d4d4",tint50:"#eae8e8",tint60:"#faf9f9"},d_={shade50:"#0f0e0e",shade40:"#1c1b1a",shade30:"#343231",shade20:"#474443",shade10:"#54514f",primary:"#5d5a58",tint10:"#706d6b",tint20:"#84817e",tint30:"#9e9b99",tint40:"#cecccb",tint50:"#e5e4e3",tint60:"#f8f8f8"},f_={shade50:"#111314",shade40:"#1f2426",shade30:"#3b4447",shade20:"#505c60",shade10:"#5f6d71",primary:"#69797e",tint10:"#79898d",tint20:"#89989d",tint30:"#a0adb2",tint40:"#cdd6d8",tint50:"#e4e9ea",tint60:"#f8f9fa"},p_={shade50:"#090a0b",shade40:"#111315",shade30:"#202427",shade20:"#2b3135",shade10:"#333a3f",primary:"#394146",tint10:"#4d565c",tint20:"#626c72",tint30:"#808a90",tint40:"#bcc3c7",tint50:"#dbdfe1",tint60:"#f6f7f8"},xs={red:RB,green:j0,darkOrange:OB,yellow:zB,berry:r_,lightGreen:JB,marigold:WB},gd={darkRed:MB,cranberry:Z0,pumpkin:IB,peach:VB,gold:GB,brass:UB,brown:YB,forest:XB,seafoam:qB,darkGreen:QB,lightTeal:KB,teal:$B,steel:ZB,blue:jB,royalBlue:e_,cornflower:t_,navy:i_,lavender:s_,purple:a_,grape:n_,lilac:o_,pink:l_,magenta:h_,plum:c_,beige:u_,mink:d_,platinum:f_,anchor:p_},ts={cranberry:Z0,green:j0,orange:HB},g_=["red","green","darkOrange","yellow","berry","lightGreen","marigold"],m_=["darkRed","cranberry","pumpkin","peach","gold","brass","brown","forest","seafoam","darkGreen","lightTeal","teal","steel","blue","royalBlue","cornflower","navy","lavender","purple","grape","lilac","pink","magenta","plum","beige","mink","platinum","anchor"],Vo={success:"green",warning:"orange",danger:"cranberry"},kh=g_.reduce((s,e)=>{const t=e.slice(0,1).toUpperCase()+e.slice(1),i={[`colorPalette${t}Background1`]:xs[e].tint60,[`colorPalette${t}Background2`]:xs[e].tint40,[`colorPalette${t}Background3`]:xs[e].primary,[`colorPalette${t}Foreground1`]:xs[e].shade10,[`colorPalette${t}Foreground2`]:xs[e].shade30,[`colorPalette${t}Foreground3`]:xs[e].primary,[`colorPalette${t}BorderActive`]:xs[e].primary,[`colorPalette${t}Border1`]:xs[e].tint40,[`colorPalette${t}Border2`]:xs[e].primary};return Object.assign(s,i)},{});kh.colorPaletteYellowForeground1=xs.yellow.shade30;kh.colorPaletteRedForegroundInverted=xs.red.tint20;kh.colorPaletteGreenForegroundInverted=xs.green.tint20;kh.colorPaletteYellowForegroundInverted=xs.yellow.tint40;const y_=m_.reduce((s,e)=>{const t=e.slice(0,1).toUpperCase()+e.slice(1),i={[`colorPalette${t}Background2`]:gd[e].tint40,[`colorPalette${t}Foreground2`]:gd[e].shade30,[`colorPalette${t}BorderActive`]:gd[e].primary};return Object.assign(s,i)},{}),b_={...kh,...y_},Wo=Object.entries(Vo).reduce((s,[e,t])=>{const i=e.slice(0,1).toUpperCase()+e.slice(1),a={[`colorStatus${i}Background1`]:ts[t].tint60,[`colorStatus${i}Background2`]:ts[t].tint40,[`colorStatus${i}Background3`]:ts[t].primary,[`colorStatus${i}Foreground1`]:ts[t].shade10,[`colorStatus${i}Foreground2`]:ts[t].shade30,[`colorStatus${i}Foreground3`]:ts[t].primary,[`colorStatus${i}ForegroundInverted`]:ts[t].tint30,[`colorStatus${i}BorderActive`]:ts[t].primary,[`colorStatus${i}Border1`]:ts[t].tint40,[`colorStatus${i}Border2`]:ts[t].primary};return Object.assign(s,a)},{});Wo.colorStatusDangerBackground3Hover=ts[Vo.danger].shade10;Wo.colorStatusDangerBackground3Pressed=ts[Vo.danger].shade20;Wo.colorStatusWarningForeground1=ts[Vo.warning].shade20;Wo.colorStatusWarningForeground3=ts[Vo.warning].shade20;Wo.colorStatusWarningBorder2=ts[Vo.warning].shade20;const S_=s=>({colorNeutralForeground1:ye[14],colorNeutralForeground1Hover:ye[14],colorNeutralForeground1Pressed:ye[14],colorNeutralForeground1Selected:ye[14],colorNeutralForeground2:ye[26],colorNeutralForeground2Hover:ye[14],colorNeutralForeground2Pressed:ye[14],colorNeutralForeground2Selected:ye[14],colorNeutralForeground2BrandHover:s[80],colorNeutralForeground2BrandPressed:s[70],colorNeutralForeground2BrandSelected:s[80],colorNeutralForeground3:ye[38],colorNeutralForeground3Hover:ye[26],colorNeutralForeground3Pressed:ye[26],colorNeutralForeground3Selected:ye[26],colorNeutralForeground3BrandHover:s[80],colorNeutralForeground3BrandPressed:s[70],colorNeutralForeground3BrandSelected:s[80],colorNeutralForeground4:ye[44],colorNeutralForegroundDisabled:ye[74],colorNeutralForegroundInvertedDisabled:yn[40],colorBrandForegroundLink:s[70],colorBrandForegroundLinkHover:s[60],colorBrandForegroundLinkPressed:s[40],colorBrandForegroundLinkSelected:s[70],colorNeutralForeground2Link:ye[26],colorNeutralForeground2LinkHover:ye[14],colorNeutralForeground2LinkPressed:ye[14],colorNeutralForeground2LinkSelected:ye[14],colorCompoundBrandForeground1:s[80],colorCompoundBrandForeground1Hover:s[70],colorCompoundBrandForeground1Pressed:s[60],colorBrandForeground1:s[80],colorBrandForeground2:s[70],colorBrandForeground2Hover:s[60],colorBrandForeground2Pressed:s[30],colorNeutralForeground1Static:ye[14],colorNeutralForegroundStaticInverted:ri,colorNeutralForegroundInverted:ri,colorNeutralForegroundInvertedHover:ri,colorNeutralForegroundInvertedPressed:ri,colorNeutralForegroundInvertedSelected:ri,colorNeutralForegroundInverted2:ri,colorNeutralForegroundOnBrand:ri,colorNeutralForegroundInvertedLink:ri,colorNeutralForegroundInvertedLinkHover:ri,colorNeutralForegroundInvertedLinkPressed:ri,colorNeutralForegroundInvertedLinkSelected:ri,colorBrandForegroundInverted:s[100],colorBrandForegroundInvertedHover:s[110],colorBrandForegroundInvertedPressed:s[100],colorBrandForegroundOnLight:s[80],colorBrandForegroundOnLightHover:s[70],colorBrandForegroundOnLightPressed:s[50],colorBrandForegroundOnLightSelected:s[60],colorNeutralBackground1:ri,colorNeutralBackground1Hover:ye[96],colorNeutralBackground1Pressed:ye[88],colorNeutralBackground1Selected:ye[92],colorNeutralBackground2:ye[98],colorNeutralBackground2Hover:ye[94],colorNeutralBackground2Pressed:ye[86],colorNeutralBackground2Selected:ye[90],colorNeutralBackground3:ye[96],colorNeutralBackground3Hover:ye[92],colorNeutralBackground3Pressed:ye[84],colorNeutralBackground3Selected:ye[88],colorNeutralBackground4:ye[94],colorNeutralBackground4Hover:ye[98],colorNeutralBackground4Pressed:ye[96],colorNeutralBackground4Selected:ri,colorNeutralBackground5:ye[92],colorNeutralBackground5Hover:ye[96],colorNeutralBackground5Pressed:ye[94],colorNeutralBackground5Selected:ye[98],colorNeutralBackground6:ye[90],colorNeutralBackgroundInverted:ye[16],colorNeutralBackgroundStatic:ye[20],colorNeutralBackgroundAlpha:yn[50],colorNeutralBackgroundAlpha2:yn[80],colorSubtleBackground:"transparent",colorSubtleBackgroundHover:ye[96],colorSubtleBackgroundPressed:ye[88],colorSubtleBackgroundSelected:ye[92],colorSubtleBackgroundLightAlphaHover:yn[70],colorSubtleBackgroundLightAlphaPressed:yn[50],colorSubtleBackgroundLightAlphaSelected:"transparent",colorSubtleBackgroundInverted:"transparent",colorSubtleBackgroundInvertedHover:bn[10],colorSubtleBackgroundInvertedPressed:bn[30],colorSubtleBackgroundInvertedSelected:bn[20],colorTransparentBackground:"transparent",colorTransparentBackgroundHover:"transparent",colorTransparentBackgroundPressed:"transparent",colorTransparentBackgroundSelected:"transparent",colorNeutralBackgroundDisabled:ye[94],colorNeutralBackgroundInvertedDisabled:yn[10],colorNeutralStencil1:ye[90],colorNeutralStencil2:ye[98],colorNeutralStencil1Alpha:bn[10],colorNeutralStencil2Alpha:bn[5],colorBackgroundOverlay:bn[40],colorScrollbarOverlay:bn[50],colorBrandBackground:s[80],colorBrandBackgroundHover:s[70],colorBrandBackgroundPressed:s[40],colorBrandBackgroundSelected:s[60],colorCompoundBrandBackground:s[80],colorCompoundBrandBackgroundHover:s[70],colorCompoundBrandBackgroundPressed:s[60],colorBrandBackgroundStatic:s[80],colorBrandBackground2:s[160],colorBrandBackground2Hover:s[150],colorBrandBackground2Pressed:s[130],colorBrandBackground3Static:s[60],colorBrandBackground4Static:s[40],colorBrandBackgroundInverted:ri,colorBrandBackgroundInvertedHover:s[160],colorBrandBackgroundInvertedPressed:s[140],colorBrandBackgroundInvertedSelected:s[150],colorNeutralCardBackground:ye[98],colorNeutralCardBackgroundHover:ri,colorNeutralCardBackgroundPressed:ye[96],colorNeutralCardBackgroundSelected:ye[92],colorNeutralCardBackgroundDisabled:ye[94],colorNeutralStrokeAccessible:ye[38],colorNeutralStrokeAccessibleHover:ye[34],colorNeutralStrokeAccessiblePressed:ye[30],colorNeutralStrokeAccessibleSelected:s[80],colorNeutralStroke1:ye[82],colorNeutralStroke1Hover:ye[78],colorNeutralStroke1Pressed:ye[70],colorNeutralStroke1Selected:ye[74],colorNeutralStroke2:ye[88],colorNeutralStroke3:ye[94],colorNeutralStrokeSubtle:ye[88],colorNeutralStrokeOnBrand:ri,colorNeutralStrokeOnBrand2:ri,colorNeutralStrokeOnBrand2Hover:ri,colorNeutralStrokeOnBrand2Pressed:ri,colorNeutralStrokeOnBrand2Selected:ri,colorBrandStroke1:s[80],colorBrandStroke2:s[140],colorBrandStroke2Hover:s[120],colorBrandStroke2Pressed:s[80],colorBrandStroke2Contrast:s[140],colorCompoundBrandStroke:s[80],colorCompoundBrandStrokeHover:s[70],colorCompoundBrandStrokePressed:s[60],colorNeutralStrokeDisabled:ye[88],colorNeutralStrokeInvertedDisabled:yn[40],colorTransparentStroke:"transparent",colorTransparentStrokeInteractive:"transparent",colorTransparentStrokeDisabled:"transparent",colorNeutralStrokeAlpha:bn[5],colorNeutralStrokeAlpha2:yn[20],colorStrokeFocus1:ri,colorStrokeFocus2:FB,colorNeutralShadowAmbient:"rgba(0,0,0,0.12)",colorNeutralShadowKey:"rgba(0,0,0,0.14)",colorNeutralShadowAmbientLighter:"rgba(0,0,0,0.06)",colorNeutralShadowKeyLighter:"rgba(0,0,0,0.07)",colorNeutralShadowAmbientDarker:"rgba(0,0,0,0.20)",colorNeutralShadowKeyDarker:"rgba(0,0,0,0.24)",colorBrandShadowAmbient:"rgba(0,0,0,0.30)",colorBrandShadowKey:"rgba(0,0,0,0.25)"}),w_={borderRadiusNone:"0",borderRadiusSmall:"2px",borderRadiusMedium:"4px",borderRadiusLarge:"6px",borderRadiusXLarge:"8px",borderRadiusCircular:"10000px"},k_={curveAccelerateMax:"cubic-bezier(0.9,0.1,1,0.2)",curveAccelerateMid:"cubic-bezier(1,0,1,1)",curveAccelerateMin:"cubic-bezier(0.8,0,0.78,1)",curveDecelerateMax:"cubic-bezier(0.1,0.9,0.2,1)",curveDecelerateMid:"cubic-bezier(0,0,0,1)",curveDecelerateMin:"cubic-bezier(0.33,0,0.1,1)",curveEasyEaseMax:"cubic-bezier(0.8,0,0.2,1)",curveEasyEase:"cubic-bezier(0.33,0,0.67,1)",curveLinear:"cubic-bezier(0,0,1,1)"},T_={durationUltraFast:"50ms",durationFaster:"100ms",durationFast:"150ms",durationNormal:"200ms",durationGentle:"250ms",durationSlow:"300ms",durationSlower:"400ms",durationUltraSlow:"500ms"},B_={fontSizeBase100:"10px",fontSizeBase200:"12px",fontSizeBase300:"14px",fontSizeBase400:"16px",fontSizeBase500:"20px",fontSizeBase600:"24px",fontSizeHero700:"28px",fontSizeHero800:"32px",fontSizeHero900:"40px",fontSizeHero1000:"68px"},__={lineHeightBase100:"14px",lineHeightBase200:"16px",lineHeightBase300:"20px",lineHeightBase400:"22px",lineHeightBase500:"28px",lineHeightBase600:"32px",lineHeightHero700:"36px",lineHeightHero800:"40px",lineHeightHero900:"52px",lineHeightHero1000:"92px"},N_={fontWeightRegular:400,fontWeightMedium:500,fontWeightSemibold:600,fontWeightBold:700},x_={fontFamilyBase:"'Segoe UI', 'Segoe UI Web (West European)', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', sans-serif",fontFamilyMonospace:"Consolas, 'Courier New', Courier, monospace",fontFamilyNumeric:"Bahnschrift, 'Segoe UI', 'Segoe UI Web (West European)', -apple-system, BlinkMacSystemFont, Roboto, 'Helvetica Neue', sans-serif"},ti={none:"0",xxs:"2px",xs:"4px",sNudge:"6px",s:"8px",mNudge:"10px",m:"12px",l:"16px",xl:"20px",xxl:"24px",xxxl:"32px"},v_={spacingHorizontalNone:ti.none,spacingHorizontalXXS:ti.xxs,spacingHorizontalXS:ti.xs,spacingHorizontalSNudge:ti.sNudge,spacingHorizontalS:ti.s,spacingHorizontalMNudge:ti.mNudge,spacingHorizontalM:ti.m,spacingHorizontalL:ti.l,spacingHorizontalXL:ti.xl,spacingHorizontalXXL:ti.xxl,spacingHorizontalXXXL:ti.xxxl},C_={spacingVerticalNone:ti.none,spacingVerticalXXS:ti.xxs,spacingVerticalXS:ti.xs,spacingVerticalSNudge:ti.sNudge,spacingVerticalS:ti.s,spacingVerticalMNudge:ti.mNudge,spacingVerticalM:ti.m,spacingVerticalL:ti.l,spacingVerticalXL:ti.xl,spacingVerticalXXL:ti.xxl,spacingVerticalXXXL:ti.xxxl},E_={strokeWidthThin:"1px",strokeWidthThick:"2px",strokeWidthThicker:"3px",strokeWidthThickest:"4px"};function om(s,e,t=""){return{[`shadow2${t}`]:`0 0 2px ${s}, 0 1px 2px ${e}`,[`shadow4${t}`]:`0 0 2px ${s}, 0 2px 4px ${e}`,[`shadow8${t}`]:`0 0 2px ${s}, 0 4px 8px ${e}`,[`shadow16${t}`]:`0 0 2px ${s}, 0 8px 16px ${e}`,[`shadow28${t}`]:`0 0 8px ${s}, 0 14px 28px ${e}`,[`shadow64${t}`]:`0 0 8px ${s}, 0 32px 64px ${e}`}}const D_=s=>{const e=S_(s);return{...w_,...B_,...__,...x_,...N_,...E_,...v_,...C_,...T_,...k_,...e,...b_,...Wo,...om(e.colorNeutralShadowAmbient,e.colorNeutralShadowKey),...om(e.colorBrandShadowAmbient,e.colorBrandShadowKey,"Brand")}},P_={30:"#0a2e4a",40:"#0c3b5e",50:"#0e4775",60:"#0f548c",70:"#115ea3",80:"#0f6cbd",100:"#479ef5",110:"#62abf5",120:"#77b7f7",130:"#96c6fa",140:"#b4d6fa",150:"#cfe4fa",160:"#ebf3fc"},L_=D_(P_),eb={root:"fui-FluentProvider"},A_=aT({root:{sj55zd:"f19n0e5",De3pzq:"fxugw4r",fsow6f:["f1o700av","fes3tcz"],Bahqtrf:"fk6fouc",Be2twd7:"fkhj508",Bhrd7zp:"figsok6",Bg96gwp:"f1i3iumi"}},{d:[".f19n0e5{color:var(--colorNeutralForeground1);}",".fxugw4r{background-color:var(--colorNeutralBackground1);}",".f1o700av{text-align:left;}",".fes3tcz{text-align:right;}",".fk6fouc{font-family:var(--fontFamilyBase);}",".fkhj508{font-size:var(--fontSizeBase300);}",".figsok6{font-weight:var(--fontWeightRegular);}",".f1i3iumi{line-height:var(--lineHeightBase300);}"]}),F_=s=>{"use no memo";const e=D0(),t=A_({dir:s.dir,renderer:e});return s.root.className=Xk(eb.root,s.themeClassName,t.root,s.root.className),s},M_=Ae.useInsertionEffect?Ae.useInsertionEffect:dB,R_=(s,e)=>{if(!(s!=null&&s.head))return;const t=s.createElement("style");return Object.keys(e).forEach(i=>{t.setAttribute(i,e[i])}),s.head.appendChild(t),t},O_=(s,e)=>{const t=s.sheet;t&&(t.cssRules.length>0&&t.deleteRule(0),t.insertRule(e,0))},I_=s=>{"use no memo";const{targetDocument:e,theme:t,rendererAttributes:i}=s,a=Ae.useRef(void 0),n=pB(eb.root),r=i,o=Ae.useMemo(()=>_T(`.${n}`,t),[t,n]);return H_(e,n),M_(()=>{const l=e==null?void 0:e.getElementById(n);return l?a.current=l:(a.current=R_(e,{...r,id:n}),a.current&&O_(a.current,o)),()=>{var h;(h=a.current)===null||h===void 0||h.remove()}},[n,e,o,r]),{styleTagId:n,rule:o}};function H_(s,e){Ae.useState(()=>{if(!s)return;const t=s.getElementById(e);t&&s.head.append(t)})}const V_={},W_={},z_=(s,e)=>{"use no memo";const t=W0(),i=G_(),a=lB(),n=Ae.useContext(Ep)||V_,{applyStylesToPortals:r=!0,customStyleHooks_unstable:o,dir:l=t.dir,targetDocument:h=t.targetDocument,theme:c,overrides_unstable:d={}}=s,f=md(i,c),p=md(a,d),g=md(n,o),m=D0();var T;const{styleTagId:S,rule:y}=I_({theme:f,targetDocument:h,rendererAttributes:(T=m.styleElementAttributes)!==null&&T!==void 0?T:W_});return{applyStylesToPortals:r,customStyleHooks_unstable:g,dir:l,targetDocument:h,theme:f,overrides_unstable:p,themeClassName:S,components:{root:"div"},root:F0(jT("div",{...s,dir:l,ref:gB(e,AB({targetDocument:h}))}),{elementType:"div"}),serverStyleProps:{cssRule:y,attributes:{...m.styleElementAttributes,id:S}}}};function md(s,e){return s&&e?{...s,...e}:s||e}function G_(){return Ae.useContext(O0)}function U_(s){const{applyStylesToPortals:e,customStyleHooks_unstable:t,dir:i,root:a,targetDocument:n,theme:r,themeClassName:o,overrides_unstable:l}=s,h=Ae.useMemo(()=>({dir:i,targetDocument:n}),[i,n]),[c]=Ae.useState(()=>({})),d=Ae.useMemo(()=>({textDirection:i}),[i]);return{customStyleHooks_unstable:t,overrides_unstable:l,provider:h,textDirection:i,iconDirection:d,tooltip:c,theme:r,themeClassName:e?a.className:o}}const tb=Ae.forwardRef((s,e)=>{const t=z_(s,e);F_(t);const i=U_(t);return TB(t,i)});tb.displayName="FluentProvider";var ib={exports:{}},sb={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(K,Se){var Me=K.length;K.push(Se);e:for(;0<Me;){var gt=Me-1>>>1,nt=K[gt];if(0<a(nt,Se))K[gt]=Se,K[Me]=nt,Me=gt;else break e}}function t(K){return K.length===0?null:K[0]}function i(K){if(K.length===0)return null;var Se=K[0],Me=K.pop();if(Me!==Se){K[0]=Me;e:for(var gt=0,nt=K.length,Lt=nt>>>1;gt<Lt;){var us=2*(gt+1)-1,ds=K[us],Gt=us+1,fs=K[Gt];if(0>a(ds,Me))Gt<nt&&0>a(fs,ds)?(K[gt]=fs,K[Gt]=Me,gt=Gt):(K[gt]=ds,K[us]=Me,gt=us);else if(Gt<nt&&0>a(fs,Me))K[gt]=fs,K[Gt]=Me,gt=Gt;else break e}}return Se}function a(K,Se){var Me=K.sortIndex-Se.sortIndex;return Me!==0?Me:K.id-Se.id}if(s.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var n=performance;s.unstable_now=function(){return n.now()}}else{var r=Date,o=r.now();s.unstable_now=function(){return r.now()-o}}var l=[],h=[],c=1,d=null,f=3,p=!1,g=!1,m=!1,T=!1,S=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;function B(K){for(var Se=t(h);Se!==null;){if(Se.callback===null)i(h);else if(Se.startTime<=K)i(h),Se.sortIndex=Se.expirationTime,e(l,Se);else break;Se=t(h)}}function N(K){if(m=!1,B(K),!g)if(t(l)!==null)g=!0,L||(L=!0,Ce());else{var Se=t(h);Se!==null&&Qi(N,Se.startTime-K)}}var L=!1,_=-1,A=5,J=-1;function G(){return T?!0:!(s.unstable_now()-J<A)}function ee(){if(T=!1,L){var K=s.unstable_now();J=K;var Se=!0;try{e:{g=!1,m&&(m=!1,y(_),_=-1),p=!0;var Me=f;try{t:{for(B(K),d=t(l);d!==null&&!(d.expirationTime>K&&G());){var gt=d.callback;if(typeof gt=="function"){d.callback=null,f=d.priorityLevel;var nt=gt(d.expirationTime<=K);if(K=s.unstable_now(),typeof nt=="function"){d.callback=nt,B(K),Se=!0;break t}d===t(l)&&i(l),B(K)}else i(l);d=t(l)}if(d!==null)Se=!0;else{var Lt=t(h);Lt!==null&&Qi(N,Lt.startTime-K),Se=!1}}break e}finally{d=null,f=Me,p=!1}Se=void 0}}finally{Se?Ce():L=!1}}}var Ce;if(typeof b=="function")Ce=function(){b(ee)};else if(typeof MessageChannel<"u"){var at=new MessageChannel,ht=at.port2;at.port1.onmessage=ee,Ce=function(){ht.postMessage(null)}}else Ce=function(){S(ee,0)};function Qi(K,Se){_=S(function(){K(s.unstable_now())},Se)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(K){K.callback=null},s.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):A=0<K?Math.floor(1e3/K):5},s.unstable_getCurrentPriorityLevel=function(){return f},s.unstable_next=function(K){switch(f){case 1:case 2:case 3:var Se=3;break;default:Se=f}var Me=f;f=Se;try{return K()}finally{f=Me}},s.unstable_requestPaint=function(){T=!0},s.unstable_runWithPriority=function(K,Se){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var Me=f;f=K;try{return Se()}finally{f=Me}},s.unstable_scheduleCallback=function(K,Se,Me){var gt=s.unstable_now();switch(typeof Me=="object"&&Me!==null?(Me=Me.delay,Me=typeof Me=="number"&&0<Me?gt+Me:gt):Me=gt,K){case 1:var nt=-1;break;case 2:nt=250;break;case 5:nt=1073741823;break;case 4:nt=1e4;break;default:nt=5e3}return nt=Me+nt,K={id:c++,callback:Se,priorityLevel:K,startTime:Me,expirationTime:nt,sortIndex:-1},Me>gt?(K.sortIndex=Me,e(h,K),t(l)===null&&K===t(h)&&(m?(y(_),_=-1):m=!0,Qi(N,Me-gt))):(K.sortIndex=nt,e(l,K),g||p||(g=!0,L||(L=!0,Ce()))),K},s.unstable_shouldYield=G,s.unstable_wrapCallback=function(K){var Se=f;return function(){var Me=f;f=Se;try{return K.apply(this,arguments)}finally{f=Me}}}})(sb);ib.exports=sb;var Y_=ib.exports,ab={exports:{}},hs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X_=Ae;function nb(s){var e="https://react.dev/errors/"+s;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var t=2;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t])}return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Sn(){}var as={d:{f:Sn,r:function(){throw Error(nb(522))},D:Sn,C:Sn,L:Sn,m:Sn,X:Sn,S:Sn,M:Sn},p:0,findDOMNode:null},q_=Symbol.for("react.portal");function J_(s,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:q_,key:i==null?null:""+i,children:s,containerInfo:e,implementation:t}}var bl=X_.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function Mu(s,e){if(s==="font")return"";if(typeof e=="string")return e==="use-credentials"?e:""}hs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=as;hs.createPortal=function(s,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)throw Error(nb(299));return J_(s,e,null,t)};hs.flushSync=function(s){var e=bl.T,t=as.p;try{if(bl.T=null,as.p=2,s)return s()}finally{bl.T=e,as.p=t,as.d.f()}};hs.preconnect=function(s,e){typeof s=="string"&&(e?(e=e.crossOrigin,e=typeof e=="string"?e==="use-credentials"?e:"":void 0):e=null,as.d.C(s,e))};hs.prefetchDNS=function(s){typeof s=="string"&&as.d.D(s)};hs.preinit=function(s,e){if(typeof s=="string"&&e&&typeof e.as=="string"){var t=e.as,i=Mu(t,e.crossOrigin),a=typeof e.integrity=="string"?e.integrity:void 0,n=typeof e.fetchPriority=="string"?e.fetchPriority:void 0;t==="style"?as.d.S(s,typeof e.precedence=="string"?e.precedence:void 0,{crossOrigin:i,integrity:a,fetchPriority:n}):t==="script"&&as.d.X(s,{crossOrigin:i,integrity:a,fetchPriority:n,nonce:typeof e.nonce=="string"?e.nonce:void 0})}};hs.preinitModule=function(s,e){if(typeof s=="string")if(typeof e=="object"&&e!==null){if(e.as==null||e.as==="script"){var t=Mu(e.as,e.crossOrigin);as.d.M(s,{crossOrigin:t,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0})}}else e==null&&as.d.M(s)};hs.preload=function(s,e){if(typeof s=="string"&&typeof e=="object"&&e!==null&&typeof e.as=="string"){var t=e.as,i=Mu(t,e.crossOrigin);as.d.L(s,t,{crossOrigin:i,integrity:typeof e.integrity=="string"?e.integrity:void 0,nonce:typeof e.nonce=="string"?e.nonce:void 0,type:typeof e.type=="string"?e.type:void 0,fetchPriority:typeof e.fetchPriority=="string"?e.fetchPriority:void 0,referrerPolicy:typeof e.referrerPolicy=="string"?e.referrerPolicy:void 0,imageSrcSet:typeof e.imageSrcSet=="string"?e.imageSrcSet:void 0,imageSizes:typeof e.imageSizes=="string"?e.imageSizes:void 0,media:typeof e.media=="string"?e.media:void 0})}};hs.preloadModule=function(s,e){if(typeof s=="string")if(e){var t=Mu(e.as,e.crossOrigin);as.d.m(s,{as:typeof e.as=="string"&&e.as!=="script"?e.as:void 0,crossOrigin:t,integrity:typeof e.integrity=="string"?e.integrity:void 0})}else as.d.m(s)};hs.requestFormReset=function(s){as.d.r(s)};hs.unstable_batchedUpdates=function(s,e){return s(e)};hs.useFormState=function(s,e,t){return bl.H.useFormState(s,e,t)};hs.useFormStatus=function(){return bl.H.useHostTransitionStatus()};hs.version="19.2.0";function rb(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rb)}catch(s){console.error(s)}}rb(),ab.exports=hs;var Q_=ab.exports,ob={exports:{}},Ru={};/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ei=Y_,lb=Ae,K_=Q_;function W(s){var e="https://react.dev/errors/"+s;if(1<arguments.length){e+="?args[]="+encodeURIComponent(arguments[1]);for(var t=2;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t])}return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function hb(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Th(s){var e=s,t=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(t=e.return),s=e.return;while(s)}return e.tag===3?t:null}function cb(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function ub(s){if(s.tag===31){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function lm(s){if(Th(s)!==s)throw Error(W(188))}function $_(s){var e=s.alternate;if(!e){if(e=Th(s),e===null)throw Error(W(188));return e!==s?null:s}for(var t=s,i=e;;){var a=t.return;if(a===null)break;var n=a.alternate;if(n===null){if(i=a.return,i!==null){t=i;continue}break}if(a.child===n.child){for(n=a.child;n;){if(n===t)return lm(a),s;if(n===i)return lm(a),e;n=n.sibling}throw Error(W(188))}if(t.return!==i.return)t=a,i=n;else{for(var r=!1,o=a.child;o;){if(o===t){r=!0,t=a,i=n;break}if(o===i){r=!0,i=a,t=n;break}o=o.sibling}if(!r){for(o=n.child;o;){if(o===t){r=!0,t=n,i=a;break}if(o===i){r=!0,i=n,t=a;break}o=o.sibling}if(!r)throw Error(W(189))}}if(t.alternate!==i)throw Error(W(190))}if(t.tag!==3)throw Error(W(188));return t.stateNode.current===t?s:e}function db(s){var e=s.tag;if(e===5||e===26||e===27||e===6)return s;for(s=s.child;s!==null;){if(e=db(s),e!==null)return e;s=s.sibling}return null}var zt=Object.assign,Z_=Symbol.for("react.element"),Yh=Symbol.for("react.transitional.element"),ll=Symbol.for("react.portal"),$r=Symbol.for("react.fragment"),fb=Symbol.for("react.strict_mode"),df=Symbol.for("react.profiler"),pb=Symbol.for("react.consumer"),Ja=Symbol.for("react.context"),Lp=Symbol.for("react.forward_ref"),ff=Symbol.for("react.suspense"),pf=Symbol.for("react.suspense_list"),Ap=Symbol.for("react.memo"),Tn=Symbol.for("react.lazy"),gf=Symbol.for("react.activity"),j_=Symbol.for("react.memo_cache_sentinel"),hm=Symbol.iterator;function jo(s){return s===null||typeof s!="object"?null:(s=hm&&s[hm]||s["@@iterator"],typeof s=="function"?s:null)}var e1=Symbol.for("react.client.reference");function mf(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===e1?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case $r:return"Fragment";case df:return"Profiler";case fb:return"StrictMode";case ff:return"Suspense";case pf:return"SuspenseList";case gf:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case ll:return"Portal";case Ja:return s.displayName||"Context";case pb:return(s._context.displayName||"Context")+".Consumer";case Lp:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case Ap:return e=s.displayName||null,e!==null?e:mf(s.type)||"Memo";case Tn:e=s._payload,s=s._init;try{return mf(s(e))}catch{}}return null}var hl=Array.isArray,Oe=lb.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ft=K_.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,kr={pending:!1,data:null,method:null,action:null},yf=[],Zr=-1;function Da(s){return{current:s}}function Ri(s){0>Zr||(s.current=yf[Zr],yf[Zr]=null,Zr--)}function Rt(s,e){Zr++,yf[Zr]=s.current,s.current=e}var Na=Da(null),Yl=Da(null),In=Da(null),vc=Da(null);function Cc(s,e){switch(Rt(In,e),Rt(Yl,s),Rt(Na,null),e.nodeType){case 9:case 11:s=(s=e.documentElement)&&(s=s.namespaceURI)?gy(s):0;break;default:if(s=e.tagName,e=e.namespaceURI)e=gy(e),s=Fw(e,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}Ri(Na),Rt(Na,s)}function To(){Ri(Na),Ri(Yl),Ri(In)}function bf(s){s.memoizedState!==null&&Rt(vc,s);var e=Na.current,t=Fw(e,s.type);e!==t&&(Rt(Yl,s),Rt(Na,t))}function Ec(s){Yl.current===s&&(Ri(Na),Ri(Yl)),vc.current===s&&(Ri(vc),ih._currentValue=kr)}var yd,cm;function ur(s){if(yd===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);yd=e&&e[1]||"",cm=-1<t.stack.indexOf(`
    at`)?" (<anonymous>)":-1<t.stack.indexOf("@")?"@unknown:0:0":""}return`
`+yd+s+cm}var bd=!1;function Sd(s,e){if(!s||bd)return"";bd=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var i={DetermineComponentFrameRoot:function(){try{if(e){var d=function(){throw Error()};if(Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(p){var f=p}Reflect.construct(s,[],d)}else{try{d.call()}catch(p){f=p}s.call(d.prototype)}}else{try{throw Error()}catch(p){f=p}(d=s())&&typeof d.catch=="function"&&d.catch(function(){})}}catch(p){if(p&&f&&typeof p.stack=="string")return[p.stack,f.stack]}return[null,null]}};i.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var a=Object.getOwnPropertyDescriptor(i.DetermineComponentFrameRoot,"name");a&&a.configurable&&Object.defineProperty(i.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var n=i.DetermineComponentFrameRoot(),r=n[0],o=n[1];if(r&&o){var l=r.split(`
`),h=o.split(`
`);for(a=i=0;i<l.length&&!l[i].includes("DetermineComponentFrameRoot");)i++;for(;a<h.length&&!h[a].includes("DetermineComponentFrameRoot");)a++;if(i===l.length||a===h.length)for(i=l.length-1,a=h.length-1;1<=i&&0<=a&&l[i]!==h[a];)a--;for(;1<=i&&0<=a;i--,a--)if(l[i]!==h[a]){if(i!==1||a!==1)do if(i--,a--,0>a||l[i]!==h[a]){var c=`
`+l[i].replace(" at new "," at ");return s.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",s.displayName)),c}while(1<=i&&0<=a);break}}}finally{bd=!1,Error.prepareStackTrace=t}return(t=s?s.displayName||s.name:"")?ur(t):""}function t1(s,e){switch(s.tag){case 26:case 27:case 5:return ur(s.type);case 16:return ur("Lazy");case 13:return s.child!==e&&e!==null?ur("Suspense Fallback"):ur("Suspense");case 19:return ur("SuspenseList");case 0:case 15:return Sd(s.type,!1);case 11:return Sd(s.type.render,!1);case 1:return Sd(s.type,!0);case 31:return ur("Activity");default:return""}}function um(s){try{var e="",t=null;do e+=t1(s,t),t=s,s=s.return;while(s);return e}catch(i){return`
Error generating stack: `+i.message+`
`+i.stack}}var Sf=Object.prototype.hasOwnProperty,Fp=Ei.unstable_scheduleCallback,wd=Ei.unstable_cancelCallback,i1=Ei.unstable_shouldYield,s1=Ei.unstable_requestPaint,Rs=Ei.unstable_now,a1=Ei.unstable_getCurrentPriorityLevel,gb=Ei.unstable_ImmediatePriority,mb=Ei.unstable_UserBlockingPriority,Dc=Ei.unstable_NormalPriority,n1=Ei.unstable_LowPriority,yb=Ei.unstable_IdlePriority,r1=Ei.log,o1=Ei.unstable_setDisableYieldValue,Bh=null,Os=null;function Dn(s){if(typeof r1=="function"&&o1(s),Os&&typeof Os.setStrictMode=="function")try{Os.setStrictMode(Bh,s)}catch{}}var Is=Math.clz32?Math.clz32:c1,l1=Math.log,h1=Math.LN2;function c1(s){return s>>>=0,s===0?32:31-(l1(s)/h1|0)|0}var Xh=256,qh=262144,Jh=4194304;function dr(s){var e=s&42;if(e!==0)return e;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return s&261888;case 262144:case 524288:case 1048576:case 2097152:return s&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Ou(s,e,t){var i=s.pendingLanes;if(i===0)return 0;var a=0,n=s.suspendedLanes,r=s.pingedLanes;s=s.warmLanes;var o=i&134217727;return o!==0?(i=o&~n,i!==0?a=dr(i):(r&=o,r!==0?a=dr(r):t||(t=o&~s,t!==0&&(a=dr(t))))):(o=i&~n,o!==0?a=dr(o):r!==0?a=dr(r):t||(t=i&~s,t!==0&&(a=dr(t)))),a===0?0:e!==0&&e!==a&&!(e&n)&&(n=a&-a,t=e&-e,n>=t||n===32&&(t&4194048)!==0)?e:a}function _h(s,e){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&e)===0}function u1(s,e){switch(s){case 1:case 2:case 4:case 8:case 64:return e+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function bb(){var s=Jh;return Jh<<=1,!(Jh&62914560)&&(Jh=4194304),s}function kd(s){for(var e=[],t=0;31>t;t++)e.push(s);return e}function Nh(s,e){s.pendingLanes|=e,e!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function d1(s,e,t,i,a,n){var r=s.pendingLanes;s.pendingLanes=t,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=t,s.entangledLanes&=t,s.errorRecoveryDisabledLanes&=t,s.shellSuspendCounter=0;var o=s.entanglements,l=s.expirationTimes,h=s.hiddenUpdates;for(t=r&~t;0<t;){var c=31-Is(t),d=1<<c;o[c]=0,l[c]=-1;var f=h[c];if(f!==null)for(h[c]=null,c=0;c<f.length;c++){var p=f[c];p!==null&&(p.lane&=-536870913)}t&=~d}i!==0&&Sb(s,i,0),n!==0&&a===0&&s.tag!==0&&(s.suspendedLanes|=n&~(r&~e))}function Sb(s,e,t){s.pendingLanes|=e,s.suspendedLanes&=~e;var i=31-Is(e);s.entangledLanes|=e,s.entanglements[i]=s.entanglements[i]|1073741824|t&261930}function wb(s,e){var t=s.entangledLanes|=e;for(s=s.entanglements;t;){var i=31-Is(t),a=1<<i;a&e|s[i]&e&&(s[i]|=e),t&=~a}}function kb(s,e){var t=e&-e;return t=t&42?1:Mp(t),t&(s.suspendedLanes|e)?0:t}function Mp(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function Rp(s){return s&=-s,2<s?8<s?s&134217727?32:268435456:8:2}function Tb(){var s=ft.p;return s!==0?s:(s=window.event,s===void 0?32:Yw(s.type))}function dm(s,e){var t=ft.p;try{return ft.p=s,e()}finally{ft.p=t}}var nr=Math.random().toString(36).slice(2),Vi="__reactFiber$"+nr,_s="__reactProps$"+nr,zo="__reactContainer$"+nr,wf="__reactEvents$"+nr,f1="__reactListeners$"+nr,p1="__reactHandles$"+nr,fm="__reactResources$"+nr,xh="__reactMarker$"+nr;function Op(s){delete s[Vi],delete s[_s],delete s[wf],delete s[f1],delete s[p1]}function jr(s){var e=s[Vi];if(e)return e;for(var t=s.parentNode;t;){if(e=t[zo]||t[Vi]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(s=wy(s);s!==null;){if(t=s[Vi])return t;s=wy(s)}return e}s=t,t=s.parentNode}return null}function Go(s){if(s=s[Vi]||s[zo]){var e=s.tag;if(e===5||e===6||e===13||e===31||e===26||e===27||e===3)return s}return null}function cl(s){var e=s.tag;if(e===5||e===26||e===27||e===6)return s.stateNode;throw Error(W(33))}function po(s){var e=s[fm];return e||(e=s[fm]={hoistableStyles:new Map,hoistableScripts:new Map}),e}function Fi(s){s[xh]=!0}var Bb=new Set,_b={};function Ir(s,e){Bo(s,e),Bo(s+"Capture",e)}function Bo(s,e){for(_b[s]=e,s=0;s<e.length;s++)Bb.add(e[s])}var g1=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),pm={},gm={};function m1(s){return Sf.call(gm,s)?!0:Sf.call(pm,s)?!1:g1.test(s)?gm[s]=!0:(pm[s]=!0,!1)}function uc(s,e,t){if(m1(e))if(t===null)s.removeAttribute(e);else{switch(typeof t){case"undefined":case"function":case"symbol":s.removeAttribute(e);return;case"boolean":var i=e.toLowerCase().slice(0,5);if(i!=="data-"&&i!=="aria-"){s.removeAttribute(e);return}}s.setAttribute(e,""+t)}}function Qh(s,e,t){if(t===null)s.removeAttribute(e);else{switch(typeof t){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(e);return}s.setAttribute(e,""+t)}}function Fa(s,e,t,i){if(i===null)s.removeAttribute(t);else{switch(typeof i){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(t);return}s.setAttributeNS(e,t,""+i)}}function Ys(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function Nb(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function y1(s,e,t){var i=Object.getOwnPropertyDescriptor(s.constructor.prototype,e);if(!s.hasOwnProperty(e)&&typeof i<"u"&&typeof i.get=="function"&&typeof i.set=="function"){var a=i.get,n=i.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return a.call(this)},set:function(r){t=""+r,n.call(this,r)}}),Object.defineProperty(s,e,{enumerable:i.enumerable}),{getValue:function(){return t},setValue:function(r){t=""+r},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function kf(s){if(!s._valueTracker){var e=Nb(s)?"checked":"value";s._valueTracker=y1(s,e,""+s[e])}}function xb(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return s&&(i=Nb(s)?s.checked?"true":"false":s.value),s=i,s!==t?(e.setValue(s),!0):!1}function Pc(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var b1=/[\n"\\]/g;function Qs(s){return s.replace(b1,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function Tf(s,e,t,i,a,n,r,o){s.name="",r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"?s.type=r:s.removeAttribute("type"),e!=null?r==="number"?(e===0&&s.value===""||s.value!=e)&&(s.value=""+Ys(e)):s.value!==""+Ys(e)&&(s.value=""+Ys(e)):r!=="submit"&&r!=="reset"||s.removeAttribute("value"),e!=null?Bf(s,r,Ys(e)):t!=null?Bf(s,r,Ys(t)):i!=null&&s.removeAttribute("value"),a==null&&n!=null&&(s.defaultChecked=!!n),a!=null&&(s.checked=a&&typeof a!="function"&&typeof a!="symbol"),o!=null&&typeof o!="function"&&typeof o!="symbol"&&typeof o!="boolean"?s.name=""+Ys(o):s.removeAttribute("name")}function vb(s,e,t,i,a,n,r,o){if(n!=null&&typeof n!="function"&&typeof n!="symbol"&&typeof n!="boolean"&&(s.type=n),e!=null||t!=null){if(!(n!=="submit"&&n!=="reset"||e!=null)){kf(s);return}t=t!=null?""+Ys(t):"",e=e!=null?""+Ys(e):t,o||e===s.value||(s.value=e),s.defaultValue=e}i=i??a,i=typeof i!="function"&&typeof i!="symbol"&&!!i,s.checked=o?s.checked:!!i,s.defaultChecked=!!i,r!=null&&typeof r!="function"&&typeof r!="symbol"&&typeof r!="boolean"&&(s.name=r),kf(s)}function Bf(s,e,t){e==="number"&&Pc(s.ownerDocument)===s||s.defaultValue===""+t||(s.defaultValue=""+t)}function go(s,e,t,i){if(s=s.options,e){e={};for(var a=0;a<t.length;a++)e["$"+t[a]]=!0;for(t=0;t<s.length;t++)a=e.hasOwnProperty("$"+s[t].value),s[t].selected!==a&&(s[t].selected=a),a&&i&&(s[t].defaultSelected=!0)}else{for(t=""+Ys(t),e=null,a=0;a<s.length;a++){if(s[a].value===t){s[a].selected=!0,i&&(s[a].defaultSelected=!0);return}e!==null||s[a].disabled||(e=s[a])}e!==null&&(e.selected=!0)}}function Cb(s,e,t){if(e!=null&&(e=""+Ys(e),e!==s.value&&(s.value=e),t==null)){s.defaultValue!==e&&(s.defaultValue=e);return}s.defaultValue=t!=null?""+Ys(t):""}function Eb(s,e,t,i){if(e==null){if(i!=null){if(t!=null)throw Error(W(92));if(hl(i)){if(1<i.length)throw Error(W(93));i=i[0]}t=i}t==null&&(t=""),e=t}t=Ys(e),s.defaultValue=t,i=s.textContent,i===t&&i!==""&&i!==null&&(s.value=i),kf(s)}function _o(s,e){if(e){var t=s.firstChild;if(t&&t===s.lastChild&&t.nodeType===3){t.nodeValue=e;return}}s.textContent=e}var S1=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function mm(s,e,t){var i=e.indexOf("--")===0;t==null||typeof t=="boolean"||t===""?i?s.setProperty(e,""):e==="float"?s.cssFloat="":s[e]="":i?s.setProperty(e,t):typeof t!="number"||t===0||S1.has(e)?e==="float"?s.cssFloat=t:s[e]=(""+t).trim():s[e]=t+"px"}function Db(s,e,t){if(e!=null&&typeof e!="object")throw Error(W(62));if(s=s.style,t!=null){for(var i in t)!t.hasOwnProperty(i)||e!=null&&e.hasOwnProperty(i)||(i.indexOf("--")===0?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="");for(var a in e)i=e[a],e.hasOwnProperty(a)&&t[a]!==i&&mm(s,a,i)}else for(var n in e)e.hasOwnProperty(n)&&mm(s,n,e[n])}function Ip(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var w1=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),k1=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function dc(s){return k1.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}function Qa(){}var _f=null;function Hp(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var eo=null,mo=null;function ym(s){var e=Go(s);if(e&&(s=e.stateNode)){var t=s[_s]||null;e:switch(s=e.stateNode,e.type){case"input":if(Tf(s,t.value,t.defaultValue,t.defaultValue,t.checked,t.defaultChecked,t.type,t.name),e=t.name,t.type==="radio"&&e!=null){for(t=s;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll('input[name="'+Qs(""+e)+'"][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==s&&i.form===s.form){var a=i[_s]||null;if(!a)throw Error(W(90));Tf(i,a.value,a.defaultValue,a.defaultValue,a.checked,a.defaultChecked,a.type,a.name)}}for(e=0;e<t.length;e++)i=t[e],i.form===s.form&&xb(i)}break e;case"textarea":Cb(s,t.value,t.defaultValue);break e;case"select":e=t.value,e!=null&&go(s,!!t.multiple,e,!1)}}}var Td=!1;function Pb(s,e,t){if(Td)return s(e,t);Td=!0;try{var i=s(e);return i}finally{if(Td=!1,(eo!==null||mo!==null)&&(Qu(),eo&&(e=eo,s=mo,mo=eo=null,ym(e),s)))for(e=0;e<s.length;e++)ym(s[e])}}function Xl(s,e){var t=s.stateNode;if(t===null)return null;var i=t[_s]||null;if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(s=s.type,i=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!i;break e;default:s=!1}if(s)return null;if(t&&typeof t!="function")throw Error(W(231,e,typeof t));return t}var ln=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Nf=!1;if(ln)try{var el={};Object.defineProperty(el,"passive",{get:function(){Nf=!0}}),window.addEventListener("test",el,el),window.removeEventListener("test",el,el)}catch{Nf=!1}var Pn=null,Vp=null,fc=null;function Lb(){if(fc)return fc;var s,e=Vp,t=e.length,i,a="value"in Pn?Pn.value:Pn.textContent,n=a.length;for(s=0;s<t&&e[s]===a[s];s++);var r=t-s;for(i=1;i<=r&&e[t-i]===a[n-i];i++);return fc=a.slice(s,1<i?1-i:void 0)}function pc(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function Kh(){return!0}function bm(){return!1}function Ns(s){function e(t,i,a,n,r){this._reactName=t,this._targetInst=a,this.type=i,this.nativeEvent=n,this.target=r,this.currentTarget=null;for(var o in s)s.hasOwnProperty(o)&&(t=s[o],this[o]=t?t(n):n[o]);return this.isDefaultPrevented=(n.defaultPrevented!=null?n.defaultPrevented:n.returnValue===!1)?Kh:bm,this.isPropagationStopped=bm,this}return zt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Kh)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Kh)},persist:function(){},isPersistent:Kh}),e}var Hr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Iu=Ns(Hr),vh=zt({},Hr,{view:0,detail:0}),T1=Ns(vh),Bd,_d,tl,Hu=zt({},vh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Wp,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==tl&&(tl&&s.type==="mousemove"?(Bd=s.screenX-tl.screenX,_d=s.screenY-tl.screenY):_d=Bd=0,tl=s),Bd)},movementY:function(s){return"movementY"in s?s.movementY:_d}}),Sm=Ns(Hu),B1=zt({},Hu,{dataTransfer:0}),_1=Ns(B1),N1=zt({},vh,{relatedTarget:0}),Nd=Ns(N1),x1=zt({},Hr,{animationName:0,elapsedTime:0,pseudoElement:0}),v1=Ns(x1),C1=zt({},Hr,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),E1=Ns(C1),D1=zt({},Hr,{data:0}),wm=Ns(D1),P1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},L1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},A1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function F1(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=A1[s])?!!e[s]:!1}function Wp(){return F1}var M1=zt({},vh,{key:function(s){if(s.key){var e=P1[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=pc(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?L1[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Wp,charCode:function(s){return s.type==="keypress"?pc(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?pc(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),R1=Ns(M1),O1=zt({},Hu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),km=Ns(O1),I1=zt({},vh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Wp}),H1=Ns(I1),V1=zt({},Hr,{propertyName:0,elapsedTime:0,pseudoElement:0}),W1=Ns(V1),z1=zt({},Hu,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),G1=Ns(z1),U1=zt({},Hr,{newState:0,oldState:0}),Y1=Ns(U1),X1=[9,13,27,32],zp=ln&&"CompositionEvent"in window,Sl=null;ln&&"documentMode"in document&&(Sl=document.documentMode);var q1=ln&&"TextEvent"in window&&!Sl,Ab=ln&&(!zp||Sl&&8<Sl&&11>=Sl),Tm=" ",Bm=!1;function Fb(s,e){switch(s){case"keyup":return X1.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mb(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var to=!1;function J1(s,e){switch(s){case"compositionend":return Mb(e);case"keypress":return e.which!==32?null:(Bm=!0,Tm);case"textInput":return s=e.data,s===Tm&&Bm?null:s;default:return null}}function Q1(s,e){if(to)return s==="compositionend"||!zp&&Fb(s,e)?(s=Lb(),fc=Vp=Pn=null,to=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Ab&&e.locale!=="ko"?null:e.data;default:return null}}var K1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function _m(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!K1[s.type]:e==="textarea"}function Rb(s,e,t,i){eo?mo?mo.push(i):mo=[i]:eo=i,e=Qc(e,"onChange"),0<e.length&&(t=new Iu("onChange","change",null,t,i),s.push({event:t,listeners:e}))}var wl=null,ql=null;function $1(s){Pw(s,0)}function Vu(s){var e=cl(s);if(xb(e))return s}function Nm(s,e){if(s==="change")return e}var Ob=!1;if(ln){var xd;if(ln){var vd="oninput"in document;if(!vd){var xm=document.createElement("div");xm.setAttribute("oninput","return;"),vd=typeof xm.oninput=="function"}xd=vd}else xd=!1;Ob=xd&&(!document.documentMode||9<document.documentMode)}function vm(){wl&&(wl.detachEvent("onpropertychange",Ib),ql=wl=null)}function Ib(s){if(s.propertyName==="value"&&Vu(ql)){var e=[];Rb(e,ql,s,Hp(s)),Pb($1,e)}}function Z1(s,e,t){s==="focusin"?(vm(),wl=e,ql=t,wl.attachEvent("onpropertychange",Ib)):s==="focusout"&&vm()}function j1(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Vu(ql)}function eN(s,e){if(s==="click")return Vu(e)}function tN(s,e){if(s==="input"||s==="change")return Vu(e)}function iN(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var Vs=typeof Object.is=="function"?Object.is:iN;function Jl(s,e){if(Vs(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var t=Object.keys(s),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var a=t[i];if(!Sf.call(e,a)||!Vs(s[a],e[a]))return!1}return!0}function Cm(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Em(s,e){var t=Cm(s);s=0;for(var i;t;){if(t.nodeType===3){if(i=s+t.textContent.length,s<=e&&i>=e)return{node:t,offset:e-s};s=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Cm(t)}}function Hb(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?Hb(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function Vb(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var e=Pc(s.document);e instanceof s.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)s=e.contentWindow;else break;e=Pc(s.document)}return e}function Gp(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}var sN=ln&&"documentMode"in document&&11>=document.documentMode,io=null,xf=null,kl=null,vf=!1;function Dm(s,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;vf||io==null||io!==Pc(i)||(i=io,"selectionStart"in i&&Gp(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),kl&&Jl(kl,i)||(kl=i,i=Qc(xf,"onSelect"),0<i.length&&(e=new Iu("onSelect","select",null,e,t),s.push({event:e,listeners:i}),e.target=io)))}function hr(s,e){var t={};return t[s.toLowerCase()]=e.toLowerCase(),t["Webkit"+s]="webkit"+e,t["Moz"+s]="moz"+e,t}var so={animationend:hr("Animation","AnimationEnd"),animationiteration:hr("Animation","AnimationIteration"),animationstart:hr("Animation","AnimationStart"),transitionrun:hr("Transition","TransitionRun"),transitionstart:hr("Transition","TransitionStart"),transitioncancel:hr("Transition","TransitionCancel"),transitionend:hr("Transition","TransitionEnd")},Cd={},Wb={};ln&&(Wb=document.createElement("div").style,"AnimationEvent"in window||(delete so.animationend.animation,delete so.animationiteration.animation,delete so.animationstart.animation),"TransitionEvent"in window||delete so.transitionend.transition);function Vr(s){if(Cd[s])return Cd[s];if(!so[s])return s;var e=so[s],t;for(t in e)if(e.hasOwnProperty(t)&&t in Wb)return Cd[s]=e[t];return s}var zb=Vr("animationend"),Gb=Vr("animationiteration"),Ub=Vr("animationstart"),aN=Vr("transitionrun"),nN=Vr("transitionstart"),rN=Vr("transitioncancel"),Yb=Vr("transitionend"),Xb=new Map,Cf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Cf.push("scrollEnd");function fa(s,e){Xb.set(s,e),Ir(e,[s])}var Lc=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var e=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(e))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)},Gs=[],ao=0,Up=0;function Wu(){for(var s=ao,e=Up=ao=0;e<s;){var t=Gs[e];Gs[e++]=null;var i=Gs[e];Gs[e++]=null;var a=Gs[e];Gs[e++]=null;var n=Gs[e];if(Gs[e++]=null,i!==null&&a!==null){var r=i.pending;r===null?a.next=a:(a.next=r.next,r.next=a),i.pending=a}n!==0&&qb(t,a,n)}}function zu(s,e,t,i){Gs[ao++]=s,Gs[ao++]=e,Gs[ao++]=t,Gs[ao++]=i,Up|=i,s.lanes|=i,s=s.alternate,s!==null&&(s.lanes|=i)}function Yp(s,e,t,i){return zu(s,e,t,i),Ac(s)}function Wr(s,e){return zu(s,null,null,e),Ac(s)}function qb(s,e,t){s.lanes|=t;var i=s.alternate;i!==null&&(i.lanes|=t);for(var a=!1,n=s.return;n!==null;)n.childLanes|=t,i=n.alternate,i!==null&&(i.childLanes|=t),n.tag===22&&(s=n.stateNode,s===null||s._visibility&1||(a=!0)),s=n,n=n.return;return s.tag===3?(n=s.stateNode,a&&e!==null&&(a=31-Is(t),s=n.hiddenUpdates,i=s[a],i===null?s[a]=[e]:i.push(e),e.lane=t|536870912),n):null}function Ac(s){if(50<Dl)throw Dl=0,Qf=null,Error(W(185));for(var e=s.return;e!==null;)s=e,e=s.return;return s.tag===3?s.stateNode:null}var no={};function oN(s,e,t,i){this.tag=s,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fs(s,e,t,i){return new oN(s,e,t,i)}function Xp(s){return s=s.prototype,!(!s||!s.isReactComponent)}function tn(s,e){var t=s.alternate;return t===null?(t=Fs(s.tag,e,s.key,s.mode),t.elementType=s.elementType,t.type=s.type,t.stateNode=s.stateNode,t.alternate=s,s.alternate=t):(t.pendingProps=e,t.type=s.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=s.flags&65011712,t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=s.sibling,t.index=s.index,t.ref=s.ref,t.refCleanup=s.refCleanup,t}function Jb(s,e){s.flags&=65011714;var t=s.alternate;return t===null?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=t.childLanes,s.lanes=t.lanes,s.child=t.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=t.memoizedProps,s.memoizedState=t.memoizedState,s.updateQueue=t.updateQueue,s.type=t.type,e=t.dependencies,s.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),s}function gc(s,e,t,i,a,n){var r=0;if(i=s,typeof s=="function")Xp(s)&&(r=1);else if(typeof s=="string")r=dx(s,t,Na.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case gf:return s=Fs(31,t,e,a),s.elementType=gf,s.lanes=n,s;case $r:return Tr(t.children,a,n,e);case fb:r=8,a|=24;break;case df:return s=Fs(12,t,e,a|2),s.elementType=df,s.lanes=n,s;case ff:return s=Fs(13,t,e,a),s.elementType=ff,s.lanes=n,s;case pf:return s=Fs(19,t,e,a),s.elementType=pf,s.lanes=n,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case Ja:r=10;break e;case pb:r=9;break e;case Lp:r=11;break e;case Ap:r=14;break e;case Tn:r=16,i=null;break e}r=29,t=Error(W(130,s===null?"null":typeof s,"")),i=null}return e=Fs(r,t,e,a),e.elementType=s,e.type=i,e.lanes=n,e}function Tr(s,e,t,i){return s=Fs(7,s,i,e),s.lanes=t,s}function Ed(s,e,t){return s=Fs(6,s,null,e),s.lanes=t,s}function Qb(s){var e=Fs(18,null,null,0);return e.stateNode=s,e}function Dd(s,e,t){return e=Fs(4,s.children!==null?s.children:[],s.key,e),e.lanes=t,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}var Pm=new WeakMap;function Ks(s,e){if(typeof s=="object"&&s!==null){var t=Pm.get(s);return t!==void 0?t:(e={value:s,source:e,stack:um(e)},Pm.set(s,e),e)}return{value:s,source:e,stack:um(e)}}var ro=[],oo=0,Fc=null,Ql=0,Xs=[],qs=0,Kn=null,Sa=1,wa="";function Ha(s,e){ro[oo++]=Ql,ro[oo++]=Fc,Fc=s,Ql=e}function Kb(s,e,t){Xs[qs++]=Sa,Xs[qs++]=wa,Xs[qs++]=Kn,Kn=s;var i=Sa;s=wa;var a=32-Is(i)-1;i&=~(1<<a),t+=1;var n=32-Is(e)+a;if(30<n){var r=a-a%5;n=(i&(1<<r)-1).toString(32),i>>=r,a-=r,Sa=1<<32-Is(e)+a|t<<a|i,wa=n+s}else Sa=1<<n|t<<a|i,wa=s}function qp(s){s.return!==null&&(Ha(s,1),Kb(s,1,0))}function Jp(s){for(;s===Fc;)Fc=ro[--oo],ro[oo]=null,Ql=ro[--oo],ro[oo]=null;for(;s===Kn;)Kn=Xs[--qs],Xs[qs]=null,wa=Xs[--qs],Xs[qs]=null,Sa=Xs[--qs],Xs[qs]=null}function $b(s,e){Xs[qs++]=Sa,Xs[qs++]=wa,Xs[qs++]=Kn,Sa=e.id,wa=e.overflow,Kn=s}var Wi=null,Ht=null,et=!1,Hn=null,$s=!1,Ef=Error(W(519));function $n(s){var e=Error(W(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw Kl(Ks(e,s)),Ef}function Lm(s){var e=s.stateNode,t=s.type,i=s.memoizedProps;switch(e[Vi]=s,e[_s]=i,t){case"dialog":Je("cancel",e),Je("close",e);break;case"iframe":case"object":case"embed":Je("load",e);break;case"video":case"audio":for(t=0;t<eh.length;t++)Je(eh[t],e);break;case"source":Je("error",e);break;case"img":case"image":case"link":Je("error",e),Je("load",e);break;case"details":Je("toggle",e);break;case"input":Je("invalid",e),vb(e,i.value,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name,!0);break;case"select":Je("invalid",e);break;case"textarea":Je("invalid",e),Eb(e,i.value,i.defaultValue,i.children)}t=i.children,typeof t!="string"&&typeof t!="number"&&typeof t!="bigint"||e.textContent===""+t||i.suppressHydrationWarning===!0||Aw(e.textContent,t)?(i.popover!=null&&(Je("beforetoggle",e),Je("toggle",e)),i.onScroll!=null&&Je("scroll",e),i.onScrollEnd!=null&&Je("scrollend",e),i.onClick!=null&&(e.onclick=Qa),e=!0):e=!1,e||$n(s,!0)}function Am(s){for(Wi=s.return;Wi;)switch(Wi.tag){case 5:case 31:case 13:$s=!1;return;case 27:case 3:$s=!0;return;default:Wi=Wi.return}}function Yr(s){if(s!==Wi)return!1;if(!et)return Am(s),et=!0,!1;var e=s.tag,t;if((t=e!==3&&e!==27)&&((t=e===5)&&(t=s.type,t=!(t!=="form"&&t!=="button")||ep(s.type,s.memoizedProps)),t=!t),t&&Ht&&$n(s),Am(s),e===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(W(317));Ht=Sy(s)}else if(e===31){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(W(317));Ht=Sy(s)}else e===27?(e=Ht,rr(s.type)?(s=ap,ap=null,Ht=s):Ht=e):Ht=Wi?ea(s.stateNode.nextSibling):null;return!0}function Pr(){Ht=Wi=null,et=!1}function Pd(){var s=Hn;return s!==null&&(bs===null?bs=s:bs.push.apply(bs,s),Hn=null),s}function Kl(s){Hn===null?Hn=[s]:Hn.push(s)}var Df=Da(null),zr=null,Ka=null;function Nn(s,e,t){Rt(Df,e._currentValue),e._currentValue=t}function sn(s){s._currentValue=Df.current,Ri(Df)}function Pf(s,e,t){for(;s!==null;){var i=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),s===t)break;s=s.return}}function Lf(s,e,t,i){var a=s.child;for(a!==null&&(a.return=s);a!==null;){var n=a.dependencies;if(n!==null){var r=a.child;n=n.firstContext;e:for(;n!==null;){var o=n;n=a;for(var l=0;l<e.length;l++)if(o.context===e[l]){n.lanes|=t,o=n.alternate,o!==null&&(o.lanes|=t),Pf(n.return,t,s),i||(r=null);break e}n=o.next}}else if(a.tag===18){if(r=a.return,r===null)throw Error(W(341));r.lanes|=t,n=r.alternate,n!==null&&(n.lanes|=t),Pf(r,t,s),r=null}else r=a.child;if(r!==null)r.return=a;else for(r=a;r!==null;){if(r===s){r=null;break}if(a=r.sibling,a!==null){a.return=r.return,r=a;break}r=r.return}a=r}}function Uo(s,e,t,i){s=null;for(var a=e,n=!1;a!==null;){if(!n){if(a.flags&524288)n=!0;else if(a.flags&262144)break}if(a.tag===10){var r=a.alternate;if(r===null)throw Error(W(387));if(r=r.memoizedProps,r!==null){var o=a.type;Vs(a.pendingProps.value,r.value)||(s!==null?s.push(o):s=[o])}}else if(a===vc.current){if(r=a.alternate,r===null)throw Error(W(387));r.memoizedState.memoizedState!==a.memoizedState.memoizedState&&(s!==null?s.push(ih):s=[ih])}a=a.return}s!==null&&Lf(e,s,t,i),e.flags|=262144}function Mc(s){for(s=s.firstContext;s!==null;){if(!Vs(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function Lr(s){zr=s,Ka=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function zi(s){return Zb(zr,s)}function $h(s,e){return zr===null&&Lr(s),Zb(s,e)}function Zb(s,e){var t=e._currentValue;if(e={context:e,memoizedValue:t,next:null},Ka===null){if(s===null)throw Error(W(308));Ka=e,s.dependencies={lanes:0,firstContext:e},s.flags|=524288}else Ka=Ka.next=e;return t}var lN=typeof AbortController<"u"?AbortController:function(){var s=[],e=this.signal={aborted:!1,addEventListener:function(t,i){s.push(i)}};this.abort=function(){e.aborted=!0,s.forEach(function(t){return t()})}},hN=Ei.unstable_scheduleCallback,cN=Ei.unstable_NormalPriority,ki={$$typeof:Ja,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Qp(){return{controller:new lN,data:new Map,refCount:0}}function Ch(s){s.refCount--,s.refCount===0&&hN(cN,function(){s.controller.abort()})}var Tl=null,Af=0,No=0,yo=null;function uN(s,e){if(Tl===null){var t=Tl=[];Af=0,No=wg(),yo={status:"pending",value:void 0,then:function(i){t.push(i)}}}return Af++,e.then(Fm,Fm),e}function Fm(){if(--Af===0&&Tl!==null){yo!==null&&(yo.status="fulfilled");var s=Tl;Tl=null,No=0,yo=null;for(var e=0;e<s.length;e++)(0,s[e])()}}function dN(s,e){var t=[],i={status:"pending",value:null,reason:null,then:function(a){t.push(a)}};return s.then(function(){i.status="fulfilled",i.value=e;for(var a=0;a<t.length;a++)(0,t[a])(e)},function(a){for(i.status="rejected",i.reason=a,a=0;a<t.length;a++)(0,t[a])(void 0)}),i}var Mm=Oe.S;Oe.S=function(s,e){dw=Rs(),typeof e=="object"&&e!==null&&typeof e.then=="function"&&uN(s,e),Mm!==null&&Mm(s,e)};var Br=Da(null);function Kp(){var s=Br.current;return s!==null?s:Pt.pooledCache}function mc(s,e){e===null?Rt(Br,Br.current):Rt(Br,e.pool)}function jb(){var s=Kp();return s===null?null:{parent:ki._currentValue,pool:s}}var Yo=Error(W(460)),$p=Error(W(474)),Gu=Error(W(542)),Rc={then:function(){}};function Rm(s){return s=s.status,s==="fulfilled"||s==="rejected"}function eS(s,e,t){switch(t=s[t],t===void 0?s.push(e):t!==e&&(e.then(Qa,Qa),e=t),e.status){case"fulfilled":return e.value;case"rejected":throw s=e.reason,Im(s),s;default:if(typeof e.status=="string")e.then(Qa,Qa);else{if(s=Pt,s!==null&&100<s.shellSuspendCounter)throw Error(W(482));s=e,s.status="pending",s.then(function(i){if(e.status==="pending"){var a=e;a.status="fulfilled",a.value=i}},function(i){if(e.status==="pending"){var a=e;a.status="rejected",a.reason=i}})}switch(e.status){case"fulfilled":return e.value;case"rejected":throw s=e.reason,Im(s),s}throw _r=e,Yo}}function fr(s){try{var e=s._init;return e(s._payload)}catch(t){throw t!==null&&typeof t=="object"&&typeof t.then=="function"?(_r=t,Yo):t}}var _r=null;function Om(){if(_r===null)throw Error(W(459));var s=_r;return _r=null,s}function Im(s){if(s===Yo||s===Gu)throw Error(W(483))}var bo=null,$l=0;function Zh(s){var e=$l;return $l+=1,bo===null&&(bo=[]),eS(bo,s,e)}function il(s,e){e=e.props.ref,s.ref=e!==void 0?e:null}function jh(s,e){throw e.$$typeof===Z_?Error(W(525)):(s=Object.prototype.toString.call(e),Error(W(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s)))}function tS(s){function e(S,y){if(s){var b=S.deletions;b===null?(S.deletions=[y],S.flags|=16):b.push(y)}}function t(S,y){if(!s)return null;for(;y!==null;)e(S,y),y=y.sibling;return null}function i(S){for(var y=new Map;S!==null;)S.key!==null?y.set(S.key,S):y.set(S.index,S),S=S.sibling;return y}function a(S,y){return S=tn(S,y),S.index=0,S.sibling=null,S}function n(S,y,b){return S.index=b,s?(b=S.alternate,b!==null?(b=b.index,b<y?(S.flags|=67108866,y):b):(S.flags|=67108866,y)):(S.flags|=1048576,y)}function r(S){return s&&S.alternate===null&&(S.flags|=67108866),S}function o(S,y,b,B){return y===null||y.tag!==6?(y=Ed(b,S.mode,B),y.return=S,y):(y=a(y,b),y.return=S,y)}function l(S,y,b,B){var N=b.type;return N===$r?c(S,y,b.props.children,B,b.key):y!==null&&(y.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Tn&&fr(N)===y.type)?(y=a(y,b.props),il(y,b),y.return=S,y):(y=gc(b.type,b.key,b.props,null,S.mode,B),il(y,b),y.return=S,y)}function h(S,y,b,B){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=Dd(b,S.mode,B),y.return=S,y):(y=a(y,b.children||[]),y.return=S,y)}function c(S,y,b,B,N){return y===null||y.tag!==7?(y=Tr(b,S.mode,B,N),y.return=S,y):(y=a(y,b),y.return=S,y)}function d(S,y,b){if(typeof y=="string"&&y!==""||typeof y=="number"||typeof y=="bigint")return y=Ed(""+y,S.mode,b),y.return=S,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Yh:return b=gc(y.type,y.key,y.props,null,S.mode,b),il(b,y),b.return=S,b;case ll:return y=Dd(y,S.mode,b),y.return=S,y;case Tn:return y=fr(y),d(S,y,b)}if(hl(y)||jo(y))return y=Tr(y,S.mode,b,null),y.return=S,y;if(typeof y.then=="function")return d(S,Zh(y),b);if(y.$$typeof===Ja)return d(S,$h(S,y),b);jh(S,y)}return null}function f(S,y,b,B){var N=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint")return N!==null?null:o(S,y,""+b,B);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Yh:return b.key===N?l(S,y,b,B):null;case ll:return b.key===N?h(S,y,b,B):null;case Tn:return b=fr(b),f(S,y,b,B)}if(hl(b)||jo(b))return N!==null?null:c(S,y,b,B,null);if(typeof b.then=="function")return f(S,y,Zh(b),B);if(b.$$typeof===Ja)return f(S,y,$h(S,b),B);jh(S,b)}return null}function p(S,y,b,B,N){if(typeof B=="string"&&B!==""||typeof B=="number"||typeof B=="bigint")return S=S.get(b)||null,o(y,S,""+B,N);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case Yh:return S=S.get(B.key===null?b:B.key)||null,l(y,S,B,N);case ll:return S=S.get(B.key===null?b:B.key)||null,h(y,S,B,N);case Tn:return B=fr(B),p(S,y,b,B,N)}if(hl(B)||jo(B))return S=S.get(b)||null,c(y,S,B,N,null);if(typeof B.then=="function")return p(S,y,b,Zh(B),N);if(B.$$typeof===Ja)return p(S,y,b,$h(y,B),N);jh(y,B)}return null}function g(S,y,b,B){for(var N=null,L=null,_=y,A=y=0,J=null;_!==null&&A<b.length;A++){_.index>A?(J=_,_=null):J=_.sibling;var G=f(S,_,b[A],B);if(G===null){_===null&&(_=J);break}s&&_&&G.alternate===null&&e(S,_),y=n(G,y,A),L===null?N=G:L.sibling=G,L=G,_=J}if(A===b.length)return t(S,_),et&&Ha(S,A),N;if(_===null){for(;A<b.length;A++)_=d(S,b[A],B),_!==null&&(y=n(_,y,A),L===null?N=_:L.sibling=_,L=_);return et&&Ha(S,A),N}for(_=i(_);A<b.length;A++)J=p(_,S,A,b[A],B),J!==null&&(s&&J.alternate!==null&&_.delete(J.key===null?A:J.key),y=n(J,y,A),L===null?N=J:L.sibling=J,L=J);return s&&_.forEach(function(ee){return e(S,ee)}),et&&Ha(S,A),N}function m(S,y,b,B){if(b==null)throw Error(W(151));for(var N=null,L=null,_=y,A=y=0,J=null,G=b.next();_!==null&&!G.done;A++,G=b.next()){_.index>A?(J=_,_=null):J=_.sibling;var ee=f(S,_,G.value,B);if(ee===null){_===null&&(_=J);break}s&&_&&ee.alternate===null&&e(S,_),y=n(ee,y,A),L===null?N=ee:L.sibling=ee,L=ee,_=J}if(G.done)return t(S,_),et&&Ha(S,A),N;if(_===null){for(;!G.done;A++,G=b.next())G=d(S,G.value,B),G!==null&&(y=n(G,y,A),L===null?N=G:L.sibling=G,L=G);return et&&Ha(S,A),N}for(_=i(_);!G.done;A++,G=b.next())G=p(_,S,A,G.value,B),G!==null&&(s&&G.alternate!==null&&_.delete(G.key===null?A:G.key),y=n(G,y,A),L===null?N=G:L.sibling=G,L=G);return s&&_.forEach(function(Ce){return e(S,Ce)}),et&&Ha(S,A),N}function T(S,y,b,B){if(typeof b=="object"&&b!==null&&b.type===$r&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Yh:e:{for(var N=b.key;y!==null;){if(y.key===N){if(N=b.type,N===$r){if(y.tag===7){t(S,y.sibling),B=a(y,b.props.children),B.return=S,S=B;break e}}else if(y.elementType===N||typeof N=="object"&&N!==null&&N.$$typeof===Tn&&fr(N)===y.type){t(S,y.sibling),B=a(y,b.props),il(B,b),B.return=S,S=B;break e}t(S,y);break}else e(S,y);y=y.sibling}b.type===$r?(B=Tr(b.props.children,S.mode,B,b.key),B.return=S,S=B):(B=gc(b.type,b.key,b.props,null,S.mode,B),il(B,b),B.return=S,S=B)}return r(S);case ll:e:{for(N=b.key;y!==null;){if(y.key===N)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){t(S,y.sibling),B=a(y,b.children||[]),B.return=S,S=B;break e}else{t(S,y);break}else e(S,y);y=y.sibling}B=Dd(b,S.mode,B),B.return=S,S=B}return r(S);case Tn:return b=fr(b),T(S,y,b,B)}if(hl(b))return g(S,y,b,B);if(jo(b)){if(N=jo(b),typeof N!="function")throw Error(W(150));return b=N.call(b),m(S,y,b,B)}if(typeof b.then=="function")return T(S,y,Zh(b),B);if(b.$$typeof===Ja)return T(S,y,$h(S,b),B);jh(S,b)}return typeof b=="string"&&b!==""||typeof b=="number"||typeof b=="bigint"?(b=""+b,y!==null&&y.tag===6?(t(S,y.sibling),B=a(y,b),B.return=S,S=B):(t(S,y),B=Ed(b,S.mode,B),B.return=S,S=B),r(S)):t(S,y)}return function(S,y,b,B){try{$l=0;var N=T(S,y,b,B);return bo=null,N}catch(_){if(_===Yo||_===Gu)throw _;var L=Fs(29,_,null,S.mode);return L.lanes=B,L.return=S,L}finally{}}}var Ar=tS(!0),iS=tS(!1),Bn=!1;function Zp(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ff(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Vn(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Wn(s,e,t){var i=s.updateQueue;if(i===null)return null;if(i=i.shared,dt&2){var a=i.pending;return a===null?e.next=e:(e.next=a.next,a.next=e),i.pending=e,e=Ac(s),qb(s,null,t),e}return zu(s,i,e,t),Ac(s)}function Bl(s,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194048)!==0)){var i=e.lanes;i&=s.pendingLanes,t|=i,e.lanes=t,wb(s,t)}}function Ld(s,e){var t=s.updateQueue,i=s.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var a=null,n=null;if(t=t.firstBaseUpdate,t!==null){do{var r={lane:t.lane,tag:t.tag,payload:t.payload,callback:null,next:null};n===null?a=n=r:n=n.next=r,t=t.next}while(t!==null);n===null?a=n=e:n=n.next=e}else a=n=e;t={baseState:i.baseState,firstBaseUpdate:a,lastBaseUpdate:n,shared:i.shared,callbacks:i.callbacks},s.updateQueue=t;return}s=t.lastBaseUpdate,s===null?t.firstBaseUpdate=e:s.next=e,t.lastBaseUpdate=e}var Mf=!1;function _l(){if(Mf){var s=yo;if(s!==null)throw s}}function Nl(s,e,t,i){Mf=!1;var a=s.updateQueue;Bn=!1;var n=a.firstBaseUpdate,r=a.lastBaseUpdate,o=a.shared.pending;if(o!==null){a.shared.pending=null;var l=o,h=l.next;l.next=null,r===null?n=h:r.next=h,r=l;var c=s.alternate;c!==null&&(c=c.updateQueue,o=c.lastBaseUpdate,o!==r&&(o===null?c.firstBaseUpdate=h:o.next=h,c.lastBaseUpdate=l))}if(n!==null){var d=a.baseState;r=0,c=h=l=null,o=n;do{var f=o.lane&-536870913,p=f!==o.lane;if(p?($e&f)===f:(i&f)===f){f!==0&&f===No&&(Mf=!0),c!==null&&(c=c.next={lane:0,tag:o.tag,payload:o.payload,callback:null,next:null});e:{var g=s,m=o;f=e;var T=t;switch(m.tag){case 1:if(g=m.payload,typeof g=="function"){d=g.call(T,d,f);break e}d=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=m.payload,f=typeof g=="function"?g.call(T,d,f):g,f==null)break e;d=zt({},d,f);break e;case 2:Bn=!0}}f=o.callback,f!==null&&(s.flags|=64,p&&(s.flags|=8192),p=a.callbacks,p===null?a.callbacks=[f]:p.push(f))}else p={lane:f,tag:o.tag,payload:o.payload,callback:o.callback,next:null},c===null?(h=c=p,l=d):c=c.next=p,r|=f;if(o=o.next,o===null){if(o=a.shared.pending,o===null)break;p=o,o=p.next,p.next=null,a.lastBaseUpdate=p,a.shared.pending=null}}while(!0);c===null&&(l=d),a.baseState=l,a.firstBaseUpdate=h,a.lastBaseUpdate=c,n===null&&(a.shared.lanes=0),jn|=r,s.lanes=r,s.memoizedState=d}}function sS(s,e){if(typeof s!="function")throw Error(W(191,s));s.call(e)}function aS(s,e){var t=s.callbacks;if(t!==null)for(s.callbacks=null,s=0;s<t.length;s++)sS(t[s],e)}var xo=Da(null),Oc=Da(0);function Hm(s,e){s=dn,Rt(Oc,s),Rt(xo,e),dn=s|e.baseLanes}function Rf(){Rt(Oc,dn),Rt(xo,xo.current)}function jp(){dn=Oc.current,Ri(xo),Ri(Oc)}var Ws=Da(null),js=null;function xn(s){var e=s.alternate;Rt(li,li.current&1),Rt(Ws,s),js===null&&(e===null||xo.current!==null||e.memoizedState!==null)&&(js=s)}function Of(s){Rt(li,li.current),Rt(Ws,s),js===null&&(js=s)}function nS(s){s.tag===22?(Rt(li,li.current),Rt(Ws,s),js===null&&(js=s)):vn()}function vn(){Rt(li,li.current),Rt(Ws,Ws.current)}function Ps(s){Ri(Ws),js===s&&(js=null),Ri(li)}var li=Da(0);function Ic(s){for(var e=s;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||ip(t)||sp(t)))return e}else if(e.tag===19&&(e.memoizedProps.revealOrder==="forwards"||e.memoizedProps.revealOrder==="backwards"||e.memoizedProps.revealOrder==="unstable_legacy-backwards"||e.memoizedProps.revealOrder==="together")){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var hn=0,Ue=null,Ct=null,yi=null,Hc=!1,So=!1,Fr=!1,Vc=0,Zl=0,wo=null,fN=0;function ei(){throw Error(W(321))}function eg(s,e){if(e===null)return!1;for(var t=0;t<e.length&&t<s.length;t++)if(!Vs(s[t],e[t]))return!1;return!0}function tg(s,e,t,i,a,n){return hn=n,Ue=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Oe.H=s===null||s.memoizedState===null?RS:dg,Fr=!1,n=t(i,a),Fr=!1,So&&(n=oS(e,t,i,a)),rS(s),n}function rS(s){Oe.H=jl;var e=Ct!==null&&Ct.next!==null;if(hn=0,yi=Ct=Ue=null,Hc=!1,Zl=0,wo=null,e)throw Error(W(300));s===null||Ti||(s=s.dependencies,s!==null&&Mc(s)&&(Ti=!0))}function oS(s,e,t,i){Ue=s;var a=0;do{if(So&&(wo=null),Zl=0,So=!1,25<=a)throw Error(W(301));if(a+=1,yi=Ct=null,s.updateQueue!=null){var n=s.updateQueue;n.lastEffect=null,n.events=null,n.stores=null,n.memoCache!=null&&(n.memoCache.index=0)}Oe.H=OS,n=e(t,i)}while(So);return n}function pN(){var s=Oe.H,e=s.useState()[0];return e=typeof e.then=="function"?Eh(e):e,s=s.useState()[0],(Ct!==null?Ct.memoizedState:null)!==s&&(Ue.flags|=1024),e}function ig(){var s=Vc!==0;return Vc=0,s}function sg(s,e,t){e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~t}function ag(s){if(Hc){for(s=s.memoizedState;s!==null;){var e=s.queue;e!==null&&(e.pending=null),s=s.next}Hc=!1}hn=0,yi=Ct=Ue=null,So=!1,Zl=Vc=0,wo=null}function Zi(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yi===null?Ue.memoizedState=yi=s:yi=yi.next=s,yi}function ci(){if(Ct===null){var s=Ue.alternate;s=s!==null?s.memoizedState:null}else s=Ct.next;var e=yi===null?Ue.memoizedState:yi.next;if(e!==null)yi=e,Ct=s;else{if(s===null)throw Ue.alternate===null?Error(W(467)):Error(W(310));Ct=s,s={memoizedState:Ct.memoizedState,baseState:Ct.baseState,baseQueue:Ct.baseQueue,queue:Ct.queue,next:null},yi===null?Ue.memoizedState=yi=s:yi=yi.next=s}return yi}function Uu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Eh(s){var e=Zl;return Zl+=1,wo===null&&(wo=[]),s=eS(wo,s,e),e=Ue,(yi===null?e.memoizedState:yi.next)===null&&(e=e.alternate,Oe.H=e===null||e.memoizedState===null?RS:dg),s}function Yu(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return Eh(s);if(s.$$typeof===Ja)return zi(s)}throw Error(W(438,String(s)))}function ng(s){var e=null,t=Ue.updateQueue;if(t!==null&&(e=t.memoCache),e==null){var i=Ue.alternate;i!==null&&(i=i.updateQueue,i!==null&&(i=i.memoCache,i!=null&&(e={data:i.data.map(function(a){return a.slice()}),index:0})))}if(e==null&&(e={data:[],index:0}),t===null&&(t=Uu(),Ue.updateQueue=t),t.memoCache=e,t=e.data[e.index],t===void 0)for(t=e.data[e.index]=Array(s),i=0;i<s;i++)t[i]=j_;return e.index++,t}function cn(s,e){return typeof e=="function"?e(s):e}function yc(s){var e=ci();return rg(e,Ct,s)}function rg(s,e,t){var i=s.queue;if(i===null)throw Error(W(311));i.lastRenderedReducer=t;var a=s.baseQueue,n=i.pending;if(n!==null){if(a!==null){var r=a.next;a.next=n.next,n.next=r}e.baseQueue=a=n,i.pending=null}if(n=s.baseState,a===null)s.memoizedState=n;else{e=a.next;var o=r=null,l=null,h=e,c=!1;do{var d=h.lane&-536870913;if(d!==h.lane?($e&d)===d:(hn&d)===d){var f=h.revertLane;if(f===0)l!==null&&(l=l.next={lane:0,revertLane:0,gesture:null,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),d===No&&(c=!0);else if((hn&f)===f){h=h.next,f===No&&(c=!0);continue}else d={lane:0,revertLane:h.revertLane,gesture:null,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null},l===null?(o=l=d,r=n):l=l.next=d,Ue.lanes|=f,jn|=f;d=h.action,Fr&&t(n,d),n=h.hasEagerState?h.eagerState:t(n,d)}else f={lane:d,revertLane:h.revertLane,gesture:h.gesture,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null},l===null?(o=l=f,r=n):l=l.next=f,Ue.lanes|=d,jn|=d;h=h.next}while(h!==null&&h!==e);if(l===null?r=n:l.next=o,!Vs(n,s.memoizedState)&&(Ti=!0,c&&(t=yo,t!==null)))throw t;s.memoizedState=n,s.baseState=r,s.baseQueue=l,i.lastRenderedState=n}return a===null&&(i.lanes=0),[s.memoizedState,i.dispatch]}function Ad(s){var e=ci(),t=e.queue;if(t===null)throw Error(W(311));t.lastRenderedReducer=s;var i=t.dispatch,a=t.pending,n=e.memoizedState;if(a!==null){t.pending=null;var r=a=a.next;do n=s(n,r.action),r=r.next;while(r!==a);Vs(n,e.memoizedState)||(Ti=!0),e.memoizedState=n,e.baseQueue===null&&(e.baseState=n),t.lastRenderedState=n}return[n,i]}function lS(s,e,t){var i=Ue,a=ci(),n=et;if(n){if(t===void 0)throw Error(W(407));t=t()}else t=e();var r=!Vs((Ct||a).memoizedState,t);if(r&&(a.memoizedState=t,Ti=!0),a=a.queue,og(uS.bind(null,i,a,s),[s]),a.getSnapshot!==e||r||yi!==null&&yi.memoizedState.tag&1){if(i.flags|=2048,vo(9,{destroy:void 0},cS.bind(null,i,a,t,e),null),Pt===null)throw Error(W(349));n||hn&127||hS(i,e,t)}return t}function hS(s,e,t){s.flags|=16384,s={getSnapshot:e,value:t},e=Ue.updateQueue,e===null?(e=Uu(),Ue.updateQueue=e,e.stores=[s]):(t=e.stores,t===null?e.stores=[s]:t.push(s))}function cS(s,e,t,i){e.value=t,e.getSnapshot=i,dS(e)&&fS(s)}function uS(s,e,t){return t(function(){dS(e)&&fS(s)})}function dS(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!Vs(s,t)}catch{return!0}}function fS(s){var e=Wr(s,2);e!==null&&Ts(e,s,2)}function If(s){var e=Zi();if(typeof s=="function"){var t=s;if(s=t(),Fr){Dn(!0);try{t()}finally{Dn(!1)}}}return e.memoizedState=e.baseState=s,e.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:s},e}function pS(s,e,t,i){return s.baseState=t,rg(s,Ct,typeof i=="function"?i:cn)}function gN(s,e,t,i,a){if(qu(s))throw Error(W(485));if(s=e.action,s!==null){var n={payload:a,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(r){n.listeners.push(r)}};Oe.T!==null?t(!0):n.isTransition=!1,i(n),t=e.pending,t===null?(n.next=e.pending=n,gS(e,n)):(n.next=t.next,e.pending=t.next=n)}}function gS(s,e){var t=e.action,i=e.payload,a=s.state;if(e.isTransition){var n=Oe.T,r={};Oe.T=r;try{var o=t(a,i),l=Oe.S;l!==null&&l(r,o),Vm(s,e,o)}catch(h){Hf(s,e,h)}finally{n!==null&&r.types!==null&&(n.types=r.types),Oe.T=n}}else try{n=t(a,i),Vm(s,e,n)}catch(h){Hf(s,e,h)}}function Vm(s,e,t){t!==null&&typeof t=="object"&&typeof t.then=="function"?t.then(function(i){Wm(s,e,i)},function(i){return Hf(s,e,i)}):Wm(s,e,t)}function Wm(s,e,t){e.status="fulfilled",e.value=t,mS(e),s.state=t,e=s.pending,e!==null&&(t=e.next,t===e?s.pending=null:(t=t.next,e.next=t,gS(s,t)))}function Hf(s,e,t){var i=s.pending;if(s.pending=null,i!==null){i=i.next;do e.status="rejected",e.reason=t,mS(e),e=e.next;while(e!==i)}s.action=null}function mS(s){s=s.listeners;for(var e=0;e<s.length;e++)(0,s[e])()}function yS(s,e){return e}function zm(s,e){if(et){var t=Pt.formState;if(t!==null){e:{var i=Ue;if(et){if(Ht){t:{for(var a=Ht,n=$s;a.nodeType!==8;){if(!n){a=null;break t}if(a=ea(a.nextSibling),a===null){a=null;break t}}n=a.data,a=n==="F!"||n==="F"?a:null}if(a){Ht=ea(a.nextSibling),i=a.data==="F!";break e}}$n(i)}i=!1}i&&(e=t[0])}}return t=Zi(),t.memoizedState=t.baseState=e,i={pending:null,lanes:0,dispatch:null,lastRenderedReducer:yS,lastRenderedState:e},t.queue=i,t=AS.bind(null,Ue,i),i.dispatch=t,i=If(!1),n=ug.bind(null,Ue,!1,i.queue),i=Zi(),a={state:e,dispatch:null,action:s,pending:null},i.queue=a,t=gN.bind(null,Ue,a,n,t),a.dispatch=t,i.memoizedState=s,[e,t,!1]}function Gm(s){var e=ci();return bS(e,Ct,s)}function bS(s,e,t){if(e=rg(s,e,yS)[0],s=yc(cn)[0],typeof e=="object"&&e!==null&&typeof e.then=="function")try{var i=Eh(e)}catch(r){throw r===Yo?Gu:r}else i=e;e=ci();var a=e.queue,n=a.dispatch;return t!==e.memoizedState&&(Ue.flags|=2048,vo(9,{destroy:void 0},mN.bind(null,a,t),null)),[i,n,s]}function mN(s,e){s.action=e}function Um(s){var e=ci(),t=Ct;if(t!==null)return bS(e,t,s);ci(),e=e.memoizedState,t=ci();var i=t.queue.dispatch;return t.memoizedState=s,[e,i,!1]}function vo(s,e,t,i){return s={tag:s,create:t,deps:i,inst:e,next:null},e=Ue.updateQueue,e===null&&(e=Uu(),Ue.updateQueue=e),t=e.lastEffect,t===null?e.lastEffect=s.next=s:(i=t.next,t.next=s,s.next=i,e.lastEffect=s),s}function SS(){return ci().memoizedState}function bc(s,e,t,i){var a=Zi();Ue.flags|=s,a.memoizedState=vo(1|e,{destroy:void 0},t,i===void 0?null:i)}function Xu(s,e,t,i){var a=ci();i=i===void 0?null:i;var n=a.memoizedState.inst;Ct!==null&&i!==null&&eg(i,Ct.memoizedState.deps)?a.memoizedState=vo(e,n,t,i):(Ue.flags|=s,a.memoizedState=vo(1|e,n,t,i))}function Ym(s,e){bc(8390656,8,s,e)}function og(s,e){Xu(2048,8,s,e)}function yN(s){Ue.flags|=4;var e=Ue.updateQueue;if(e===null)e=Uu(),Ue.updateQueue=e,e.events=[s];else{var t=e.events;t===null?e.events=[s]:t.push(s)}}function wS(s){var e=ci().memoizedState;return yN({ref:e,nextImpl:s}),function(){if(dt&2)throw Error(W(440));return e.impl.apply(void 0,arguments)}}function kS(s,e){return Xu(4,2,s,e)}function TS(s,e){return Xu(4,4,s,e)}function BS(s,e){if(typeof e=="function"){s=s();var t=e(s);return function(){typeof t=="function"?t():e(null)}}if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function _S(s,e,t){t=t!=null?t.concat([s]):null,Xu(4,4,BS.bind(null,e,s),t)}function lg(){}function NS(s,e){var t=ci();e=e===void 0?null:e;var i=t.memoizedState;return e!==null&&eg(e,i[1])?i[0]:(t.memoizedState=[s,e],s)}function xS(s,e){var t=ci();e=e===void 0?null:e;var i=t.memoizedState;if(e!==null&&eg(e,i[1]))return i[0];if(i=s(),Fr){Dn(!0);try{s()}finally{Dn(!1)}}return t.memoizedState=[i,e],i}function hg(s,e,t){return t===void 0||hn&1073741824&&!($e&261930)?s.memoizedState=e:(s.memoizedState=t,s=pw(),Ue.lanes|=s,jn|=s,t)}function vS(s,e,t,i){return Vs(t,e)?t:xo.current!==null?(s=hg(s,t,i),Vs(s,e)||(Ti=!0),s):!(hn&42)||hn&1073741824&&!($e&261930)?(Ti=!0,s.memoizedState=t):(s=pw(),Ue.lanes|=s,jn|=s,e)}function CS(s,e,t,i,a){var n=ft.p;ft.p=n!==0&&8>n?n:8;var r=Oe.T,o={};Oe.T=o,ug(s,!1,e,t);try{var l=a(),h=Oe.S;if(h!==null&&h(o,l),l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=dN(l,i);xl(s,e,c,Hs(s))}else xl(s,e,i,Hs(s))}catch(d){xl(s,e,{then:function(){},status:"rejected",reason:d},Hs())}finally{ft.p=n,r!==null&&o.types!==null&&(r.types=o.types),Oe.T=r}}function bN(){}function Vf(s,e,t,i){if(s.tag!==5)throw Error(W(476));var a=ES(s).queue;CS(s,a,e,kr,t===null?bN:function(){return DS(s),t(i)})}function ES(s){var e=s.memoizedState;if(e!==null)return e;e={memoizedState:kr,baseState:kr,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:kr},next:null};var t={};return e.next={memoizedState:t,baseState:t,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cn,lastRenderedState:t},next:null},s.memoizedState=e,s=s.alternate,s!==null&&(s.memoizedState=e),e}function DS(s){var e=ES(s);e.next===null&&(e=s.alternate.memoizedState),xl(s,e.next.queue,{},Hs())}function cg(){return zi(ih)}function PS(){return ci().memoizedState}function LS(){return ci().memoizedState}function SN(s){for(var e=s.return;e!==null;){switch(e.tag){case 24:case 3:var t=Hs();s=Vn(t);var i=Wn(e,s,t);i!==null&&(Ts(i,e,t),Bl(i,e,t)),e={cache:Qp()},s.payload=e;return}e=e.return}}function wN(s,e,t){var i=Hs();t={lane:i,revertLane:0,gesture:null,action:t,hasEagerState:!1,eagerState:null,next:null},qu(s)?FS(e,t):(t=Yp(s,e,t,i),t!==null&&(Ts(t,s,i),MS(t,e,i)))}function AS(s,e,t){var i=Hs();xl(s,e,t,i)}function xl(s,e,t,i){var a={lane:i,revertLane:0,gesture:null,action:t,hasEagerState:!1,eagerState:null,next:null};if(qu(s))FS(e,a);else{var n=s.alternate;if(s.lanes===0&&(n===null||n.lanes===0)&&(n=e.lastRenderedReducer,n!==null))try{var r=e.lastRenderedState,o=n(r,t);if(a.hasEagerState=!0,a.eagerState=o,Vs(o,r))return zu(s,e,a,0),Pt===null&&Wu(),!1}catch{}finally{}if(t=Yp(s,e,a,i),t!==null)return Ts(t,s,i),MS(t,e,i),!0}return!1}function ug(s,e,t,i){if(i={lane:2,revertLane:wg(),gesture:null,action:i,hasEagerState:!1,eagerState:null,next:null},qu(s)){if(e)throw Error(W(479))}else e=Yp(s,t,i,2),e!==null&&Ts(e,s,2)}function qu(s){var e=s.alternate;return s===Ue||e!==null&&e===Ue}function FS(s,e){So=Hc=!0;var t=s.pending;t===null?e.next=e:(e.next=t.next,t.next=e),s.pending=e}function MS(s,e,t){if(t&4194048){var i=e.lanes;i&=s.pendingLanes,t|=i,e.lanes=t,wb(s,t)}}var jl={readContext:zi,use:Yu,useCallback:ei,useContext:ei,useEffect:ei,useImperativeHandle:ei,useLayoutEffect:ei,useInsertionEffect:ei,useMemo:ei,useReducer:ei,useRef:ei,useState:ei,useDebugValue:ei,useDeferredValue:ei,useTransition:ei,useSyncExternalStore:ei,useId:ei,useHostTransitionStatus:ei,useFormState:ei,useActionState:ei,useOptimistic:ei,useMemoCache:ei,useCacheRefresh:ei};jl.useEffectEvent=ei;var RS={readContext:zi,use:Yu,useCallback:function(s,e){return Zi().memoizedState=[s,e===void 0?null:e],s},useContext:zi,useEffect:Ym,useImperativeHandle:function(s,e,t){t=t!=null?t.concat([s]):null,bc(4194308,4,BS.bind(null,e,s),t)},useLayoutEffect:function(s,e){return bc(4194308,4,s,e)},useInsertionEffect:function(s,e){bc(4,2,s,e)},useMemo:function(s,e){var t=Zi();e=e===void 0?null:e;var i=s();if(Fr){Dn(!0);try{s()}finally{Dn(!1)}}return t.memoizedState=[i,e],i},useReducer:function(s,e,t){var i=Zi();if(t!==void 0){var a=t(e);if(Fr){Dn(!0);try{t(e)}finally{Dn(!1)}}}else a=e;return i.memoizedState=i.baseState=a,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:a},i.queue=s,s=s.dispatch=wN.bind(null,Ue,s),[i.memoizedState,s]},useRef:function(s){var e=Zi();return s={current:s},e.memoizedState=s},useState:function(s){s=If(s);var e=s.queue,t=AS.bind(null,Ue,e);return e.dispatch=t,[s.memoizedState,t]},useDebugValue:lg,useDeferredValue:function(s,e){var t=Zi();return hg(t,s,e)},useTransition:function(){var s=If(!1);return s=CS.bind(null,Ue,s.queue,!0,!1),Zi().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,e,t){var i=Ue,a=Zi();if(et){if(t===void 0)throw Error(W(407));t=t()}else{if(t=e(),Pt===null)throw Error(W(349));$e&127||hS(i,e,t)}a.memoizedState=t;var n={value:t,getSnapshot:e};return a.queue=n,Ym(uS.bind(null,i,n,s),[s]),i.flags|=2048,vo(9,{destroy:void 0},cS.bind(null,i,n,t,e),null),t},useId:function(){var s=Zi(),e=Pt.identifierPrefix;if(et){var t=wa,i=Sa;t=(i&~(1<<32-Is(i)-1)).toString(32)+t,e="_"+e+"R_"+t,t=Vc++,0<t&&(e+="H"+t.toString(32)),e+="_"}else t=fN++,e="_"+e+"r_"+t.toString(32)+"_";return s.memoizedState=e},useHostTransitionStatus:cg,useFormState:zm,useActionState:zm,useOptimistic:function(s){var e=Zi();e.memoizedState=e.baseState=s;var t={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return e.queue=t,e=ug.bind(null,Ue,!0,t),t.dispatch=e,[s,e]},useMemoCache:ng,useCacheRefresh:function(){return Zi().memoizedState=SN.bind(null,Ue)},useEffectEvent:function(s){var e=Zi(),t={impl:s};return e.memoizedState=t,function(){if(dt&2)throw Error(W(440));return t.impl.apply(void 0,arguments)}}},dg={readContext:zi,use:Yu,useCallback:NS,useContext:zi,useEffect:og,useImperativeHandle:_S,useInsertionEffect:kS,useLayoutEffect:TS,useMemo:xS,useReducer:yc,useRef:SS,useState:function(){return yc(cn)},useDebugValue:lg,useDeferredValue:function(s,e){var t=ci();return vS(t,Ct.memoizedState,s,e)},useTransition:function(){var s=yc(cn)[0],e=ci().memoizedState;return[typeof s=="boolean"?s:Eh(s),e]},useSyncExternalStore:lS,useId:PS,useHostTransitionStatus:cg,useFormState:Gm,useActionState:Gm,useOptimistic:function(s,e){var t=ci();return pS(t,Ct,s,e)},useMemoCache:ng,useCacheRefresh:LS};dg.useEffectEvent=wS;var OS={readContext:zi,use:Yu,useCallback:NS,useContext:zi,useEffect:og,useImperativeHandle:_S,useInsertionEffect:kS,useLayoutEffect:TS,useMemo:xS,useReducer:Ad,useRef:SS,useState:function(){return Ad(cn)},useDebugValue:lg,useDeferredValue:function(s,e){var t=ci();return Ct===null?hg(t,s,e):vS(t,Ct.memoizedState,s,e)},useTransition:function(){var s=Ad(cn)[0],e=ci().memoizedState;return[typeof s=="boolean"?s:Eh(s),e]},useSyncExternalStore:lS,useId:PS,useHostTransitionStatus:cg,useFormState:Um,useActionState:Um,useOptimistic:function(s,e){var t=ci();return Ct!==null?pS(t,Ct,s,e):(t.baseState=s,[s,t.queue.dispatch])},useMemoCache:ng,useCacheRefresh:LS};OS.useEffectEvent=wS;function Fd(s,e,t,i){e=s.memoizedState,t=t(i,e),t=t==null?e:zt({},e,t),s.memoizedState=t,s.lanes===0&&(s.updateQueue.baseState=t)}var Wf={enqueueSetState:function(s,e,t){s=s._reactInternals;var i=Hs(),a=Vn(i);a.payload=e,t!=null&&(a.callback=t),e=Wn(s,a,i),e!==null&&(Ts(e,s,i),Bl(e,s,i))},enqueueReplaceState:function(s,e,t){s=s._reactInternals;var i=Hs(),a=Vn(i);a.tag=1,a.payload=e,t!=null&&(a.callback=t),e=Wn(s,a,i),e!==null&&(Ts(e,s,i),Bl(e,s,i))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var t=Hs(),i=Vn(t);i.tag=2,e!=null&&(i.callback=e),e=Wn(s,i,t),e!==null&&(Ts(e,s,t),Bl(e,s,t))}};function Xm(s,e,t,i,a,n,r){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(i,n,r):e.prototype&&e.prototype.isPureReactComponent?!Jl(t,i)||!Jl(a,n):!0}function qm(s,e,t,i){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==s&&Wf.enqueueReplaceState(e,e.state,null)}function Mr(s,e){var t=e;if("ref"in e){t={};for(var i in e)i!=="ref"&&(t[i]=e[i])}if(s=s.defaultProps){t===e&&(t=zt({},t));for(var a in s)t[a]===void 0&&(t[a]=s[a])}return t}function IS(s){Lc(s)}function HS(s){console.error(s)}function VS(s){Lc(s)}function Wc(s,e){try{var t=s.onUncaughtError;t(e.value,{componentStack:e.stack})}catch(i){setTimeout(function(){throw i})}}function Jm(s,e,t){try{var i=s.onCaughtError;i(t.value,{componentStack:t.stack,errorBoundary:e.tag===1?e.stateNode:null})}catch(a){setTimeout(function(){throw a})}}function zf(s,e,t){return t=Vn(t),t.tag=3,t.payload={element:null},t.callback=function(){Wc(s,e)},t}function WS(s){return s=Vn(s),s.tag=3,s}function zS(s,e,t,i){var a=t.type.getDerivedStateFromError;if(typeof a=="function"){var n=i.value;s.payload=function(){return a(n)},s.callback=function(){Jm(e,t,i)}}var r=t.stateNode;r!==null&&typeof r.componentDidCatch=="function"&&(s.callback=function(){Jm(e,t,i),typeof a!="function"&&(zn===null?zn=new Set([this]):zn.add(this));var o=i.stack;this.componentDidCatch(i.value,{componentStack:o!==null?o:""})})}function kN(s,e,t,i,a){if(t.flags|=32768,i!==null&&typeof i=="object"&&typeof i.then=="function"){if(e=t.alternate,e!==null&&Uo(e,t,a,!0),t=Ws.current,t!==null){switch(t.tag){case 31:case 13:return js===null?Xc():t.alternate===null&&si===0&&(si=3),t.flags&=-257,t.flags|=65536,t.lanes=a,i===Rc?t.flags|=16384:(e=t.updateQueue,e===null?t.updateQueue=new Set([i]):e.add(i),Yd(s,i,a)),!1;case 22:return t.flags|=65536,i===Rc?t.flags|=16384:(e=t.updateQueue,e===null?(e={transitions:null,markerInstances:null,retryQueue:new Set([i])},t.updateQueue=e):(t=e.retryQueue,t===null?e.retryQueue=new Set([i]):t.add(i)),Yd(s,i,a)),!1}throw Error(W(435,t.tag))}return Yd(s,i,a),Xc(),!1}if(et)return e=Ws.current,e!==null?(!(e.flags&65536)&&(e.flags|=256),e.flags|=65536,e.lanes=a,i!==Ef&&(s=Error(W(422),{cause:i}),Kl(Ks(s,t)))):(i!==Ef&&(e=Error(W(423),{cause:i}),Kl(Ks(e,t))),s=s.current.alternate,s.flags|=65536,a&=-a,s.lanes|=a,i=Ks(i,t),a=zf(s.stateNode,i,a),Ld(s,a),si!==4&&(si=2)),!1;var n=Error(W(520),{cause:i});if(n=Ks(n,t),El===null?El=[n]:El.push(n),si!==4&&(si=2),e===null)return!0;i=Ks(i,t),t=e;do{switch(t.tag){case 3:return t.flags|=65536,s=a&-a,t.lanes|=s,s=zf(t.stateNode,i,s),Ld(t,s),!1;case 1:if(e=t.type,n=t.stateNode,(t.flags&128)===0&&(typeof e.getDerivedStateFromError=="function"||n!==null&&typeof n.componentDidCatch=="function"&&(zn===null||!zn.has(n))))return t.flags|=65536,a&=-a,t.lanes|=a,a=WS(a),zS(a,s,t,i),Ld(t,a),!1}t=t.return}while(t!==null);return!1}var fg=Error(W(461)),Ti=!1;function Oi(s,e,t,i){e.child=s===null?iS(e,null,t,i):Ar(e,s.child,t,i)}function Qm(s,e,t,i,a){t=t.render;var n=e.ref;if("ref"in i){var r={};for(var o in i)o!=="ref"&&(r[o]=i[o])}else r=i;return Lr(e),i=tg(s,e,t,r,n,a),o=ig(),s!==null&&!Ti?(sg(s,e,a),un(s,e,a)):(et&&o&&qp(e),e.flags|=1,Oi(s,e,i,a),e.child)}function Km(s,e,t,i,a){if(s===null){var n=t.type;return typeof n=="function"&&!Xp(n)&&n.defaultProps===void 0&&t.compare===null?(e.tag=15,e.type=n,GS(s,e,n,i,a)):(s=gc(t.type,null,i,e,e.mode,a),s.ref=e.ref,s.return=e,e.child=s)}if(n=s.child,!pg(s,a)){var r=n.memoizedProps;if(t=t.compare,t=t!==null?t:Jl,t(r,i)&&s.ref===e.ref)return un(s,e,a)}return e.flags|=1,s=tn(n,i),s.ref=e.ref,s.return=e,e.child=s}function GS(s,e,t,i,a){if(s!==null){var n=s.memoizedProps;if(Jl(n,i)&&s.ref===e.ref)if(Ti=!1,e.pendingProps=i=n,pg(s,a))s.flags&131072&&(Ti=!0);else return e.lanes=s.lanes,un(s,e,a)}return Gf(s,e,t,i,a)}function US(s,e,t,i){var a=i.children,n=s!==null?s.memoizedState:null;if(s===null&&e.stateNode===null&&(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),i.mode==="hidden"){if(e.flags&128){if(n=n!==null?n.baseLanes|t:t,s!==null){for(i=e.child=s.child,a=0;i!==null;)a=a|i.lanes|i.childLanes,i=i.sibling;i=a&~n}else i=0,e.child=null;return $m(s,e,n,t,i)}if(t&536870912)e.memoizedState={baseLanes:0,cachePool:null},s!==null&&mc(e,n!==null?n.cachePool:null),n!==null?Hm(e,n):Rf(),nS(e);else return i=e.lanes=536870912,$m(s,e,n!==null?n.baseLanes|t:t,t,i)}else n!==null?(mc(e,n.cachePool),Hm(e,n),vn(),e.memoizedState=null):(s!==null&&mc(e,null),Rf(),vn());return Oi(s,e,a,t),e.child}function ul(s,e){return s!==null&&s.tag===22||e.stateNode!==null||(e.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),e.sibling}function $m(s,e,t,i,a){var n=Kp();return n=n===null?null:{parent:ki._currentValue,pool:n},e.memoizedState={baseLanes:t,cachePool:n},s!==null&&mc(e,null),Rf(),nS(e),s!==null&&Uo(s,e,i,!0),e.childLanes=a,null}function Sc(s,e){return e=zc({mode:e.mode,children:e.children},s.mode),e.ref=s.ref,s.child=e,e.return=s,e}function Zm(s,e,t){return Ar(e,s.child,null,t),s=Sc(e,e.pendingProps),s.flags|=2,Ps(e),e.memoizedState=null,s}function TN(s,e,t){var i=e.pendingProps,a=(e.flags&128)!==0;if(e.flags&=-129,s===null){if(et){if(i.mode==="hidden")return s=Sc(e,i),e.lanes=536870912,ul(null,s);if(Of(e),(s=Ht)?(s=Rw(s,$s),s=s!==null&&s.data==="&"?s:null,s!==null&&(e.memoizedState={dehydrated:s,treeContext:Kn!==null?{id:Sa,overflow:wa}:null,retryLane:536870912,hydrationErrors:null},t=Qb(s),t.return=e,e.child=t,Wi=e,Ht=null)):s=null,s===null)throw $n(e);return e.lanes=536870912,null}return Sc(e,i)}var n=s.memoizedState;if(n!==null){var r=n.dehydrated;if(Of(e),a)if(e.flags&256)e.flags&=-257,e=Zm(s,e,t);else if(e.memoizedState!==null)e.child=s.child,e.flags|=128,e=null;else throw Error(W(558));else if(Ti||Uo(s,e,t,!1),a=(t&s.childLanes)!==0,Ti||a){if(i=Pt,i!==null&&(r=kb(i,t),r!==0&&r!==n.retryLane))throw n.retryLane=r,Wr(s,r),Ts(i,s,r),fg;Xc(),e=Zm(s,e,t)}else s=n.treeContext,Ht=ea(r.nextSibling),Wi=e,et=!0,Hn=null,$s=!1,s!==null&&$b(e,s),e=Sc(e,i),e.flags|=4096;return e}return s=tn(s.child,{mode:i.mode,children:i.children}),s.ref=e.ref,e.child=s,s.return=e,s}function wc(s,e){var t=e.ref;if(t===null)s!==null&&s.ref!==null&&(e.flags|=4194816);else{if(typeof t!="function"&&typeof t!="object")throw Error(W(284));(s===null||s.ref!==t)&&(e.flags|=4194816)}}function Gf(s,e,t,i,a){return Lr(e),t=tg(s,e,t,i,void 0,a),i=ig(),s!==null&&!Ti?(sg(s,e,a),un(s,e,a)):(et&&i&&qp(e),e.flags|=1,Oi(s,e,t,a),e.child)}function jm(s,e,t,i,a,n){return Lr(e),e.updateQueue=null,t=oS(e,i,t,a),rS(s),i=ig(),s!==null&&!Ti?(sg(s,e,n),un(s,e,n)):(et&&i&&qp(e),e.flags|=1,Oi(s,e,t,n),e.child)}function ey(s,e,t,i,a){if(Lr(e),e.stateNode===null){var n=no,r=t.contextType;typeof r=="object"&&r!==null&&(n=zi(r)),n=new t(i,n),e.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=Wf,e.stateNode=n,n._reactInternals=e,n=e.stateNode,n.props=i,n.state=e.memoizedState,n.refs={},Zp(e),r=t.contextType,n.context=typeof r=="object"&&r!==null?zi(r):no,n.state=e.memoizedState,r=t.getDerivedStateFromProps,typeof r=="function"&&(Fd(e,t,r,i),n.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof n.getSnapshotBeforeUpdate=="function"||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(r=n.state,typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount(),r!==n.state&&Wf.enqueueReplaceState(n,n.state,null),Nl(e,i,n,a),_l(),n.state=e.memoizedState),typeof n.componentDidMount=="function"&&(e.flags|=4194308),i=!0}else if(s===null){n=e.stateNode;var o=e.memoizedProps,l=Mr(t,o);n.props=l;var h=n.context,c=t.contextType;r=no,typeof c=="object"&&c!==null&&(r=zi(c));var d=t.getDerivedStateFromProps;c=typeof d=="function"||typeof n.getSnapshotBeforeUpdate=="function",o=e.pendingProps!==o,c||typeof n.UNSAFE_componentWillReceiveProps!="function"&&typeof n.componentWillReceiveProps!="function"||(o||h!==r)&&qm(e,n,i,r),Bn=!1;var f=e.memoizedState;n.state=f,Nl(e,i,n,a),_l(),h=e.memoizedState,o||f!==h||Bn?(typeof d=="function"&&(Fd(e,t,d,i),h=e.memoizedState),(l=Bn||Xm(e,t,l,i,f,h,r))?(c||typeof n.UNSAFE_componentWillMount!="function"&&typeof n.componentWillMount!="function"||(typeof n.componentWillMount=="function"&&n.componentWillMount(),typeof n.UNSAFE_componentWillMount=="function"&&n.UNSAFE_componentWillMount()),typeof n.componentDidMount=="function"&&(e.flags|=4194308)):(typeof n.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=h),n.props=i,n.state=h,n.context=r,i=l):(typeof n.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{n=e.stateNode,Ff(s,e),r=e.memoizedProps,c=Mr(t,r),n.props=c,d=e.pendingProps,f=n.context,h=t.contextType,l=no,typeof h=="object"&&h!==null&&(l=zi(h)),o=t.getDerivedStateFromProps,(h=typeof o=="function"||typeof n.getSnapshotBeforeUpdate=="function")||typeof n.UNSAFE_componentWillReceiveProps!="function"&&typeof n.componentWillReceiveProps!="function"||(r!==d||f!==l)&&qm(e,n,i,l),Bn=!1,f=e.memoizedState,n.state=f,Nl(e,i,n,a),_l();var p=e.memoizedState;r!==d||f!==p||Bn||s!==null&&s.dependencies!==null&&Mc(s.dependencies)?(typeof o=="function"&&(Fd(e,t,o,i),p=e.memoizedState),(c=Bn||Xm(e,t,c,i,f,p,l)||s!==null&&s.dependencies!==null&&Mc(s.dependencies))?(h||typeof n.UNSAFE_componentWillUpdate!="function"&&typeof n.componentWillUpdate!="function"||(typeof n.componentWillUpdate=="function"&&n.componentWillUpdate(i,p,l),typeof n.UNSAFE_componentWillUpdate=="function"&&n.UNSAFE_componentWillUpdate(i,p,l)),typeof n.componentDidUpdate=="function"&&(e.flags|=4),typeof n.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof n.componentDidUpdate!="function"||r===s.memoizedProps&&f===s.memoizedState||(e.flags|=4),typeof n.getSnapshotBeforeUpdate!="function"||r===s.memoizedProps&&f===s.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=p),n.props=i,n.state=p,n.context=l,i=c):(typeof n.componentDidUpdate!="function"||r===s.memoizedProps&&f===s.memoizedState||(e.flags|=4),typeof n.getSnapshotBeforeUpdate!="function"||r===s.memoizedProps&&f===s.memoizedState||(e.flags|=1024),i=!1)}return n=i,wc(s,e),i=(e.flags&128)!==0,n||i?(n=e.stateNode,t=i&&typeof t.getDerivedStateFromError!="function"?null:n.render(),e.flags|=1,s!==null&&i?(e.child=Ar(e,s.child,null,a),e.child=Ar(e,null,t,a)):Oi(s,e,t,a),e.memoizedState=n.state,s=e.child):s=un(s,e,a),s}function ty(s,e,t,i){return Pr(),e.flags|=256,Oi(s,e,t,i),e.child}var Md={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Rd(s){return{baseLanes:s,cachePool:jb()}}function Od(s,e,t){return s=s!==null?s.childLanes&~t:0,e&&(s|=Ms),s}function YS(s,e,t){var i=e.pendingProps,a=!1,n=(e.flags&128)!==0,r;if((r=n)||(r=s!==null&&s.memoizedState===null?!1:(li.current&2)!==0),r&&(a=!0,e.flags&=-129),r=(e.flags&32)!==0,e.flags&=-33,s===null){if(et){if(a?xn(e):vn(),(s=Ht)?(s=Rw(s,$s),s=s!==null&&s.data!=="&"?s:null,s!==null&&(e.memoizedState={dehydrated:s,treeContext:Kn!==null?{id:Sa,overflow:wa}:null,retryLane:536870912,hydrationErrors:null},t=Qb(s),t.return=e,e.child=t,Wi=e,Ht=null)):s=null,s===null)throw $n(e);return sp(s)?e.lanes=32:e.lanes=536870912,null}var o=i.children;return i=i.fallback,a?(vn(),a=e.mode,o=zc({mode:"hidden",children:o},a),i=Tr(i,a,t,null),o.return=e,i.return=e,o.sibling=i,e.child=o,i=e.child,i.memoizedState=Rd(t),i.childLanes=Od(s,r,t),e.memoizedState=Md,ul(null,i)):(xn(e),Uf(e,o))}var l=s.memoizedState;if(l!==null&&(o=l.dehydrated,o!==null)){if(n)e.flags&256?(xn(e),e.flags&=-257,e=Id(s,e,t)):e.memoizedState!==null?(vn(),e.child=s.child,e.flags|=128,e=null):(vn(),o=i.fallback,a=e.mode,i=zc({mode:"visible",children:i.children},a),o=Tr(o,a,t,null),o.flags|=2,i.return=e,o.return=e,i.sibling=o,e.child=i,Ar(e,s.child,null,t),i=e.child,i.memoizedState=Rd(t),i.childLanes=Od(s,r,t),e.memoizedState=Md,e=ul(null,i));else if(xn(e),sp(o)){if(r=o.nextSibling&&o.nextSibling.dataset,r)var h=r.dgst;r=h,i=Error(W(419)),i.stack="",i.digest=r,Kl({value:i,source:null,stack:null}),e=Id(s,e,t)}else if(Ti||Uo(s,e,t,!1),r=(t&s.childLanes)!==0,Ti||r){if(r=Pt,r!==null&&(i=kb(r,t),i!==0&&i!==l.retryLane))throw l.retryLane=i,Wr(s,i),Ts(r,s,i),fg;ip(o)||Xc(),e=Id(s,e,t)}else ip(o)?(e.flags|=192,e.child=s.child,e=null):(s=l.treeContext,Ht=ea(o.nextSibling),Wi=e,et=!0,Hn=null,$s=!1,s!==null&&$b(e,s),e=Uf(e,i.children),e.flags|=4096);return e}return a?(vn(),o=i.fallback,a=e.mode,l=s.child,h=l.sibling,i=tn(l,{mode:"hidden",children:i.children}),i.subtreeFlags=l.subtreeFlags&65011712,h!==null?o=tn(h,o):(o=Tr(o,a,t,null),o.flags|=2),o.return=e,i.return=e,i.sibling=o,e.child=i,ul(null,i),i=e.child,o=s.child.memoizedState,o===null?o=Rd(t):(a=o.cachePool,a!==null?(l=ki._currentValue,a=a.parent!==l?{parent:l,pool:l}:a):a=jb(),o={baseLanes:o.baseLanes|t,cachePool:a}),i.memoizedState=o,i.childLanes=Od(s,r,t),e.memoizedState=Md,ul(s.child,i)):(xn(e),t=s.child,s=t.sibling,t=tn(t,{mode:"visible",children:i.children}),t.return=e,t.sibling=null,s!==null&&(r=e.deletions,r===null?(e.deletions=[s],e.flags|=16):r.push(s)),e.child=t,e.memoizedState=null,t)}function Uf(s,e){return e=zc({mode:"visible",children:e},s.mode),e.return=s,s.child=e}function zc(s,e){return s=Fs(22,s,null,e),s.lanes=0,s}function Id(s,e,t){return Ar(e,s.child,null,t),s=Uf(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function iy(s,e,t){s.lanes|=e;var i=s.alternate;i!==null&&(i.lanes|=e),Pf(s.return,e,t)}function Hd(s,e,t,i,a,n){var r=s.memoizedState;r===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:a,treeForkCount:n}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=i,r.tail=t,r.tailMode=a,r.treeForkCount=n)}function XS(s,e,t){var i=e.pendingProps,a=i.revealOrder,n=i.tail;i=i.children;var r=li.current,o=(r&2)!==0;if(o?(r=r&1|2,e.flags|=128):r&=1,Rt(li,r),Oi(s,e,i,t),i=et?Ql:0,!o&&s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&iy(s,t,e);else if(s.tag===19)iy(s,t,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}switch(a){case"forwards":for(t=e.child,a=null;t!==null;)s=t.alternate,s!==null&&Ic(s)===null&&(a=t),t=t.sibling;t=a,t===null?(a=e.child,e.child=null):(a=t.sibling,t.sibling=null),Hd(e,!1,a,t,n,i);break;case"backwards":case"unstable_legacy-backwards":for(t=null,a=e.child,e.child=null;a!==null;){if(s=a.alternate,s!==null&&Ic(s)===null){e.child=a;break}s=a.sibling,a.sibling=t,t=a,a=s}Hd(e,!0,t,null,n,i);break;case"together":Hd(e,!1,null,null,void 0,i);break;default:e.memoizedState=null}return e.child}function un(s,e,t){if(s!==null&&(e.dependencies=s.dependencies),jn|=e.lanes,!(t&e.childLanes))if(s!==null){if(Uo(s,e,t,!1),(t&e.childLanes)===0)return null}else return null;if(s!==null&&e.child!==s.child)throw Error(W(153));if(e.child!==null){for(s=e.child,t=tn(s,s.pendingProps),e.child=t,t.return=e;s.sibling!==null;)s=s.sibling,t=t.sibling=tn(s,s.pendingProps),t.return=e;t.sibling=null}return e.child}function pg(s,e){return s.lanes&e?!0:(s=s.dependencies,!!(s!==null&&Mc(s)))}function BN(s,e,t){switch(e.tag){case 3:Cc(e,e.stateNode.containerInfo),Nn(e,ki,s.memoizedState.cache),Pr();break;case 27:case 5:bf(e);break;case 4:Cc(e,e.stateNode.containerInfo);break;case 10:Nn(e,e.type,e.memoizedProps.value);break;case 31:if(e.memoizedState!==null)return e.flags|=128,Of(e),null;break;case 13:var i=e.memoizedState;if(i!==null)return i.dehydrated!==null?(xn(e),e.flags|=128,null):t&e.child.childLanes?YS(s,e,t):(xn(e),s=un(s,e,t),s!==null?s.sibling:null);xn(e);break;case 19:var a=(s.flags&128)!==0;if(i=(t&e.childLanes)!==0,i||(Uo(s,e,t,!1),i=(t&e.childLanes)!==0),a){if(i)return XS(s,e,t);e.flags|=128}if(a=e.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Rt(li,li.current),i)break;return null;case 22:return e.lanes=0,US(s,e,t,e.pendingProps);case 24:Nn(e,ki,s.memoizedState.cache)}return un(s,e,t)}function qS(s,e,t){if(s!==null)if(s.memoizedProps!==e.pendingProps)Ti=!0;else{if(!pg(s,t)&&!(e.flags&128))return Ti=!1,BN(s,e,t);Ti=!!(s.flags&131072)}else Ti=!1,et&&e.flags&1048576&&Kb(e,Ql,e.index);switch(e.lanes=0,e.tag){case 16:e:{var i=e.pendingProps;if(s=fr(e.elementType),e.type=s,typeof s=="function")Xp(s)?(i=Mr(s,i),e.tag=1,e=ey(null,e,s,i,t)):(e.tag=0,e=Gf(null,e,s,i,t));else{if(s!=null){var a=s.$$typeof;if(a===Lp){e.tag=11,e=Qm(null,e,s,i,t);break e}else if(a===Ap){e.tag=14,e=Km(null,e,s,i,t);break e}}throw e=mf(s)||s,Error(W(306,e,""))}}return e;case 0:return Gf(s,e,e.type,e.pendingProps,t);case 1:return i=e.type,a=Mr(i,e.pendingProps),ey(s,e,i,a,t);case 3:e:{if(Cc(e,e.stateNode.containerInfo),s===null)throw Error(W(387));i=e.pendingProps;var n=e.memoizedState;a=n.element,Ff(s,e),Nl(e,i,null,t);var r=e.memoizedState;if(i=r.cache,Nn(e,ki,i),i!==n.cache&&Lf(e,[ki],t,!0),_l(),i=r.element,n.isDehydrated)if(n={element:i,isDehydrated:!1,cache:r.cache},e.updateQueue.baseState=n,e.memoizedState=n,e.flags&256){e=ty(s,e,i,t);break e}else if(i!==a){a=Ks(Error(W(424)),e),Kl(a),e=ty(s,e,i,t);break e}else{switch(s=e.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(Ht=ea(s.firstChild),Wi=e,et=!0,Hn=null,$s=!0,t=iS(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling}else{if(Pr(),i===a){e=un(s,e,t);break e}Oi(s,e,i,t)}e=e.child}return e;case 26:return wc(s,e),s===null?(t=Ty(e.type,null,e.pendingProps,null))?e.memoizedState=t:et||(t=e.type,s=e.pendingProps,i=Kc(In.current).createElement(t),i[Vi]=e,i[_s]=s,Gi(i,t,s),Fi(i),e.stateNode=i):e.memoizedState=Ty(e.type,s.memoizedProps,e.pendingProps,s.memoizedState),null;case 27:return bf(e),s===null&&et&&(i=e.stateNode=Ow(e.type,e.pendingProps,In.current),Wi=e,$s=!0,a=Ht,rr(e.type)?(ap=a,Ht=ea(i.firstChild)):Ht=a),Oi(s,e,e.pendingProps.children,t),wc(s,e),s===null&&(e.flags|=4194304),e.child;case 5:return s===null&&et&&((a=i=Ht)&&(i=jN(i,e.type,e.pendingProps,$s),i!==null?(e.stateNode=i,Wi=e,Ht=ea(i.firstChild),$s=!1,a=!0):a=!1),a||$n(e)),bf(e),a=e.type,n=e.pendingProps,r=s!==null?s.memoizedProps:null,i=n.children,ep(a,n)?i=null:r!==null&&ep(a,r)&&(e.flags|=32),e.memoizedState!==null&&(a=tg(s,e,pN,null,null,t),ih._currentValue=a),wc(s,e),Oi(s,e,i,t),e.child;case 6:return s===null&&et&&((s=t=Ht)&&(t=ex(t,e.pendingProps,$s),t!==null?(e.stateNode=t,Wi=e,Ht=null,s=!0):s=!1),s||$n(e)),null;case 13:return YS(s,e,t);case 4:return Cc(e,e.stateNode.containerInfo),i=e.pendingProps,s===null?e.child=Ar(e,null,i,t):Oi(s,e,i,t),e.child;case 11:return Qm(s,e,e.type,e.pendingProps,t);case 7:return Oi(s,e,e.pendingProps,t),e.child;case 8:return Oi(s,e,e.pendingProps.children,t),e.child;case 12:return Oi(s,e,e.pendingProps.children,t),e.child;case 10:return i=e.pendingProps,Nn(e,e.type,i.value),Oi(s,e,i.children,t),e.child;case 9:return a=e.type._context,i=e.pendingProps.children,Lr(e),a=zi(a),i=i(a),e.flags|=1,Oi(s,e,i,t),e.child;case 14:return Km(s,e,e.type,e.pendingProps,t);case 15:return GS(s,e,e.type,e.pendingProps,t);case 19:return XS(s,e,t);case 31:return TN(s,e,t);case 22:return US(s,e,t,e.pendingProps);case 24:return Lr(e),i=zi(ki),s===null?(a=Kp(),a===null&&(a=Pt,n=Qp(),a.pooledCache=n,n.refCount++,n!==null&&(a.pooledCacheLanes|=t),a=n),e.memoizedState={parent:i,cache:a},Zp(e),Nn(e,ki,a)):(s.lanes&t&&(Ff(s,e),Nl(e,null,null,t),_l()),a=s.memoizedState,n=e.memoizedState,a.parent!==i?(a={parent:i,cache:i},e.memoizedState=a,e.lanes===0&&(e.memoizedState=e.updateQueue.baseState=a),Nn(e,ki,i)):(i=n.cache,Nn(e,ki,i),i!==a.cache&&Lf(e,[ki],t,!0))),Oi(s,e,e.pendingProps.children,t),e.child;case 29:throw e.pendingProps}throw Error(W(156,e.tag))}function Ma(s){s.flags|=4}function Vd(s,e,t,i,a){if((e=(s.mode&32)!==0)&&(e=!1),e){if(s.flags|=16777216,(a&335544128)===a)if(s.stateNode.complete)s.flags|=8192;else if(yw())s.flags|=8192;else throw _r=Rc,$p}else s.flags&=-16777217}function sy(s,e){if(e.type!=="stylesheet"||e.state.loading&4)s.flags&=-16777217;else if(s.flags|=16777216,!Vw(e))if(yw())s.flags|=8192;else throw _r=Rc,$p}function ec(s,e){e!==null&&(s.flags|=4),s.flags&16384&&(e=s.tag!==22?bb():536870912,s.lanes|=e,Co|=e)}function sl(s,e){if(!et)switch(s.tailMode){case"hidden":e=s.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?s.tail=null:t.sibling=null;break;case"collapsed":t=s.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:i.sibling=null}}function It(s){var e=s.alternate!==null&&s.alternate.child===s.child,t=0,i=0;if(e)for(var a=s.child;a!==null;)t|=a.lanes|a.childLanes,i|=a.subtreeFlags&65011712,i|=a.flags&65011712,a.return=s,a=a.sibling;else for(a=s.child;a!==null;)t|=a.lanes|a.childLanes,i|=a.subtreeFlags,i|=a.flags,a.return=s,a=a.sibling;return s.subtreeFlags|=i,s.childLanes=t,e}function _N(s,e,t){var i=e.pendingProps;switch(Jp(e),e.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return It(e),null;case 1:return It(e),null;case 3:return t=e.stateNode,i=null,s!==null&&(i=s.memoizedState.cache),e.memoizedState.cache!==i&&(e.flags|=2048),sn(ki),To(),t.pendingContext&&(t.context=t.pendingContext,t.pendingContext=null),(s===null||s.child===null)&&(Yr(e)?Ma(e):s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Pd())),It(e),null;case 26:var a=e.type,n=e.memoizedState;return s===null?(Ma(e),n!==null?(It(e),sy(e,n)):(It(e),Vd(e,a,null,i,t))):n?n!==s.memoizedState?(Ma(e),It(e),sy(e,n)):(It(e),e.flags&=-16777217):(s=s.memoizedProps,s!==i&&Ma(e),It(e),Vd(e,a,s,i,t)),null;case 27:if(Ec(e),t=In.current,a=e.type,s!==null&&e.stateNode!=null)s.memoizedProps!==i&&Ma(e);else{if(!i){if(e.stateNode===null)throw Error(W(166));return It(e),null}s=Na.current,Yr(e)?Lm(e):(s=Ow(a,i,t),e.stateNode=s,Ma(e))}return It(e),null;case 5:if(Ec(e),a=e.type,s!==null&&e.stateNode!=null)s.memoizedProps!==i&&Ma(e);else{if(!i){if(e.stateNode===null)throw Error(W(166));return It(e),null}if(n=Na.current,Yr(e))Lm(e);else{var r=Kc(In.current);switch(n){case 1:n=r.createElementNS("http://www.w3.org/2000/svg",a);break;case 2:n=r.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;default:switch(a){case"svg":n=r.createElementNS("http://www.w3.org/2000/svg",a);break;case"math":n=r.createElementNS("http://www.w3.org/1998/Math/MathML",a);break;case"script":n=r.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild);break;case"select":n=typeof i.is=="string"?r.createElement("select",{is:i.is}):r.createElement("select"),i.multiple?n.multiple=!0:i.size&&(n.size=i.size);break;default:n=typeof i.is=="string"?r.createElement(a,{is:i.is}):r.createElement(a)}}n[Vi]=e,n[_s]=i;e:for(r=e.child;r!==null;){if(r.tag===5||r.tag===6)n.appendChild(r.stateNode);else if(r.tag!==4&&r.tag!==27&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break e;for(;r.sibling===null;){if(r.return===null||r.return===e)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}e.stateNode=n;e:switch(Gi(n,a,i),a){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}i&&Ma(e)}}return It(e),Vd(e,e.type,s===null?null:s.memoizedProps,e.pendingProps,t),null;case 6:if(s&&e.stateNode!=null)s.memoizedProps!==i&&Ma(e);else{if(typeof i!="string"&&e.stateNode===null)throw Error(W(166));if(s=In.current,Yr(e)){if(s=e.stateNode,t=e.memoizedProps,i=null,a=Wi,a!==null)switch(a.tag){case 27:case 5:i=a.memoizedProps}s[Vi]=e,s=!!(s.nodeValue===t||i!==null&&i.suppressHydrationWarning===!0||Aw(s.nodeValue,t)),s||$n(e,!0)}else s=Kc(s).createTextNode(i),s[Vi]=e,e.stateNode=s}return It(e),null;case 31:if(t=e.memoizedState,s===null||s.memoizedState!==null){if(i=Yr(e),t!==null){if(s===null){if(!i)throw Error(W(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(W(557));s[Vi]=e}else Pr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;It(e),s=!1}else t=Pd(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=t),s=!0;if(!s)return e.flags&256?(Ps(e),e):(Ps(e),null);if(e.flags&128)throw Error(W(558))}return It(e),null;case 13:if(i=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(a=Yr(e),i!==null&&i.dehydrated!==null){if(s===null){if(!a)throw Error(W(318));if(a=e.memoizedState,a=a!==null?a.dehydrated:null,!a)throw Error(W(317));a[Vi]=e}else Pr(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;It(e),a=!1}else a=Pd(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=a),a=!0;if(!a)return e.flags&256?(Ps(e),e):(Ps(e),null)}return Ps(e),e.flags&128?(e.lanes=t,e):(t=i!==null,s=s!==null&&s.memoizedState!==null,t&&(i=e.child,a=null,i.alternate!==null&&i.alternate.memoizedState!==null&&i.alternate.memoizedState.cachePool!==null&&(a=i.alternate.memoizedState.cachePool.pool),n=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(n=i.memoizedState.cachePool.pool),n!==a&&(i.flags|=2048)),t!==s&&t&&(e.child.flags|=8192),ec(e,e.updateQueue),It(e),null);case 4:return To(),s===null&&kg(e.stateNode.containerInfo),It(e),null;case 10:return sn(e.type),It(e),null;case 19:if(Ri(li),i=e.memoizedState,i===null)return It(e),null;if(a=(e.flags&128)!==0,n=i.rendering,n===null)if(a)sl(i,!1);else{if(si!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(n=Ic(s),n!==null){for(e.flags|=128,sl(i,!1),s=n.updateQueue,e.updateQueue=s,ec(e,s),e.subtreeFlags=0,s=t,t=e.child;t!==null;)Jb(t,s),t=t.sibling;return Rt(li,li.current&1|2),et&&Ha(e,i.treeForkCount),e.child}s=s.sibling}i.tail!==null&&Rs()>Uc&&(e.flags|=128,a=!0,sl(i,!1),e.lanes=4194304)}else{if(!a)if(s=Ic(n),s!==null){if(e.flags|=128,a=!0,s=s.updateQueue,e.updateQueue=s,ec(e,s),sl(i,!0),i.tail===null&&i.tailMode==="hidden"&&!n.alternate&&!et)return It(e),null}else 2*Rs()-i.renderingStartTime>Uc&&t!==536870912&&(e.flags|=128,a=!0,sl(i,!1),e.lanes=4194304);i.isBackwards?(n.sibling=e.child,e.child=n):(s=i.last,s!==null?s.sibling=n:e.child=n,i.last=n)}return i.tail!==null?(s=i.tail,i.rendering=s,i.tail=s.sibling,i.renderingStartTime=Rs(),s.sibling=null,t=li.current,Rt(li,a?t&1|2:t&1),et&&Ha(e,i.treeForkCount),s):(It(e),null);case 22:case 23:return Ps(e),jp(),i=e.memoizedState!==null,s!==null?s.memoizedState!==null!==i&&(e.flags|=8192):i&&(e.flags|=8192),i?t&536870912&&!(e.flags&128)&&(It(e),e.subtreeFlags&6&&(e.flags|=8192)):It(e),t=e.updateQueue,t!==null&&ec(e,t.retryQueue),t=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(t=s.memoizedState.cachePool.pool),i=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(i=e.memoizedState.cachePool.pool),i!==t&&(e.flags|=2048),s!==null&&Ri(Br),null;case 24:return t=null,s!==null&&(t=s.memoizedState.cache),e.memoizedState.cache!==t&&(e.flags|=2048),sn(ki),It(e),null;case 25:return null;case 30:return null}throw Error(W(156,e.tag))}function NN(s,e){switch(Jp(e),e.tag){case 1:return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return sn(ki),To(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 26:case 27:case 5:return Ec(e),null;case 31:if(e.memoizedState!==null){if(Ps(e),e.alternate===null)throw Error(W(340));Pr()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 13:if(Ps(e),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error(W(340));Pr()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return Ri(li),null;case 4:return To(),null;case 10:return sn(e.type),null;case 22:case 23:return Ps(e),jp(),s!==null&&Ri(Br),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 24:return sn(ki),null;case 25:return null;default:return null}}function JS(s,e){switch(Jp(e),e.tag){case 3:sn(ki),To();break;case 26:case 27:case 5:Ec(e);break;case 4:To();break;case 31:e.memoizedState!==null&&Ps(e);break;case 13:Ps(e);break;case 19:Ri(li);break;case 10:sn(e.type);break;case 22:case 23:Ps(e),jp(),s!==null&&Ri(Br);break;case 24:sn(ki)}}function Dh(s,e){try{var t=e.updateQueue,i=t!==null?t.lastEffect:null;if(i!==null){var a=i.next;t=a;do{if((t.tag&s)===s){i=void 0;var n=t.create,r=t.inst;i=n(),r.destroy=i}t=t.next}while(t!==a)}}catch(o){kt(e,e.return,o)}}function Zn(s,e,t){try{var i=e.updateQueue,a=i!==null?i.lastEffect:null;if(a!==null){var n=a.next;i=n;do{if((i.tag&s)===s){var r=i.inst,o=r.destroy;if(o!==void 0){r.destroy=void 0,a=e;var l=t,h=o;try{h()}catch(c){kt(a,l,c)}}}i=i.next}while(i!==n)}}catch(c){kt(e,e.return,c)}}function QS(s){var e=s.updateQueue;if(e!==null){var t=s.stateNode;try{aS(e,t)}catch(i){kt(s,s.return,i)}}}function KS(s,e,t){t.props=Mr(s.type,s.memoizedProps),t.state=s.memoizedState;try{t.componentWillUnmount()}catch(i){kt(s,e,i)}}function vl(s,e){try{var t=s.ref;if(t!==null){switch(s.tag){case 26:case 27:case 5:var i=s.stateNode;break;case 30:i=s.stateNode;break;default:i=s.stateNode}typeof t=="function"?s.refCleanup=t(i):t.current=i}}catch(a){kt(s,e,a)}}function ka(s,e){var t=s.ref,i=s.refCleanup;if(t!==null)if(typeof i=="function")try{i()}catch(a){kt(s,e,a)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof t=="function")try{t(null)}catch(a){kt(s,e,a)}else t.current=null}function $S(s){var e=s.type,t=s.memoizedProps,i=s.stateNode;try{e:switch(e){case"button":case"input":case"select":case"textarea":t.autoFocus&&i.focus();break e;case"img":t.src?i.src=t.src:t.srcSet&&(i.srcset=t.srcSet)}}catch(a){kt(s,s.return,a)}}function Wd(s,e,t){try{var i=s.stateNode;qN(i,s.type,t,e),i[_s]=e}catch(a){kt(s,s.return,a)}}function ZS(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&rr(s.type)||s.tag===4}function zd(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||ZS(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&rr(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Yf(s,e,t){var i=s.tag;if(i===5||i===6)s=s.stateNode,e?(t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t).insertBefore(s,e):(e=t.nodeType===9?t.body:t.nodeName==="HTML"?t.ownerDocument.body:t,e.appendChild(s),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Qa));else if(i!==4&&(i===27&&rr(s.type)&&(t=s.stateNode,e=null),s=s.child,s!==null))for(Yf(s,e,t),s=s.sibling;s!==null;)Yf(s,e,t),s=s.sibling}function Gc(s,e,t){var i=s.tag;if(i===5||i===6)s=s.stateNode,e?t.insertBefore(s,e):t.appendChild(s);else if(i!==4&&(i===27&&rr(s.type)&&(t=s.stateNode),s=s.child,s!==null))for(Gc(s,e,t),s=s.sibling;s!==null;)Gc(s,e,t),s=s.sibling}function jS(s){var e=s.stateNode,t=s.memoizedProps;try{for(var i=s.type,a=e.attributes;a.length;)e.removeAttributeNode(a[0]);Gi(e,i,t),e[Vi]=s,e[_s]=t}catch(n){kt(s,s.return,n)}}var Ga=!1,bi=!1,Gd=!1,ay=typeof WeakSet=="function"?WeakSet:Set,Ai=null;function xN(s,e){if(s=s.containerInfo,Zf=eu,s=Vb(s),Gp(s)){if("selectionStart"in s)var t={start:s.selectionStart,end:s.selectionEnd};else e:{t=(t=s.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var a=i.anchorOffset,n=i.focusNode;i=i.focusOffset;try{t.nodeType,n.nodeType}catch{t=null;break e}var r=0,o=-1,l=-1,h=0,c=0,d=s,f=null;t:for(;;){for(var p;d!==t||a!==0&&d.nodeType!==3||(o=r+a),d!==n||i!==0&&d.nodeType!==3||(l=r+i),d.nodeType===3&&(r+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===s)break t;if(f===t&&++h===a&&(o=r),f===n&&++c===i&&(l=r),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}t=o===-1||l===-1?null:{start:o,end:l}}else t=null}t=t||{start:0,end:0}}else t=null;for(jf={focusedElem:s,selectionRange:t},eu=!1,Ai=e;Ai!==null;)if(e=Ai,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,Ai=s;else for(;Ai!==null;){switch(e=Ai,n=e.alternate,s=e.flags,e.tag){case 0:if(s&4&&(s=e.updateQueue,s=s!==null?s.events:null,s!==null))for(t=0;t<s.length;t++)a=s[t],a.ref.impl=a.nextImpl;break;case 11:case 15:break;case 1:if(s&1024&&n!==null){s=void 0,t=e,a=n.memoizedProps,n=n.memoizedState,i=t.stateNode;try{var g=Mr(t.type,a);s=i.getSnapshotBeforeUpdate(g,n),i.__reactInternalSnapshotBeforeUpdate=s}catch(m){kt(t,t.return,m)}}break;case 3:if(s&1024){if(s=e.stateNode.containerInfo,t=s.nodeType,t===9)tp(s);else if(t===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":tp(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if(s&1024)throw Error(W(163))}if(s=e.sibling,s!==null){s.return=e.return,Ai=s;break}Ai=e.return}}function ew(s,e,t){var i=t.flags;switch(t.tag){case 0:case 11:case 15:Oa(s,t),i&4&&Dh(5,t);break;case 1:if(Oa(s,t),i&4)if(s=t.stateNode,e===null)try{s.componentDidMount()}catch(r){kt(t,t.return,r)}else{var a=Mr(t.type,e.memoizedProps);e=e.memoizedState;try{s.componentDidUpdate(a,e,s.__reactInternalSnapshotBeforeUpdate)}catch(r){kt(t,t.return,r)}}i&64&&QS(t),i&512&&vl(t,t.return);break;case 3:if(Oa(s,t),i&64&&(s=t.updateQueue,s!==null)){if(e=null,t.child!==null)switch(t.child.tag){case 27:case 5:e=t.child.stateNode;break;case 1:e=t.child.stateNode}try{aS(s,e)}catch(r){kt(t,t.return,r)}}break;case 27:e===null&&i&4&&jS(t);case 26:case 5:Oa(s,t),e===null&&i&4&&$S(t),i&512&&vl(t,t.return);break;case 12:Oa(s,t);break;case 31:Oa(s,t),i&4&&sw(s,t);break;case 13:Oa(s,t),i&4&&aw(s,t),i&64&&(s=t.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(t=MN.bind(null,t),tx(s,t))));break;case 22:if(i=t.memoizedState!==null||Ga,!i){e=e!==null&&e.memoizedState!==null||bi,a=Ga;var n=bi;Ga=i,(bi=e)&&!n?Ia(s,t,(t.subtreeFlags&8772)!==0):Oa(s,t),Ga=a,bi=n}break;case 30:break;default:Oa(s,t)}}function tw(s){var e=s.alternate;e!==null&&(s.alternate=null,tw(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&Op(e)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Yt=null,ys=!1;function Ra(s,e,t){for(t=t.child;t!==null;)iw(s,e,t),t=t.sibling}function iw(s,e,t){if(Os&&typeof Os.onCommitFiberUnmount=="function")try{Os.onCommitFiberUnmount(Bh,t)}catch{}switch(t.tag){case 26:bi||ka(t,e),Ra(s,e,t),t.memoizedState?t.memoizedState.count--:t.stateNode&&(t=t.stateNode,t.parentNode.removeChild(t));break;case 27:bi||ka(t,e);var i=Yt,a=ys;rr(t.type)&&(Yt=t.stateNode,ys=!1),Ra(s,e,t),Pl(t.stateNode),Yt=i,ys=a;break;case 5:bi||ka(t,e);case 6:if(i=Yt,a=ys,Yt=null,Ra(s,e,t),Yt=i,ys=a,Yt!==null)if(ys)try{(Yt.nodeType===9?Yt.body:Yt.nodeName==="HTML"?Yt.ownerDocument.body:Yt).removeChild(t.stateNode)}catch(n){kt(t,e,n)}else try{Yt.removeChild(t.stateNode)}catch(n){kt(t,e,n)}break;case 18:Yt!==null&&(ys?(s=Yt,yy(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,t.stateNode),Lo(s)):yy(Yt,t.stateNode));break;case 4:i=Yt,a=ys,Yt=t.stateNode.containerInfo,ys=!0,Ra(s,e,t),Yt=i,ys=a;break;case 0:case 11:case 14:case 15:Zn(2,t,e),bi||Zn(4,t,e),Ra(s,e,t);break;case 1:bi||(ka(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"&&KS(t,e,i)),Ra(s,e,t);break;case 21:Ra(s,e,t);break;case 22:bi=(i=bi)||t.memoizedState!==null,Ra(s,e,t),bi=i;break;default:Ra(s,e,t)}}function sw(s,e){if(e.memoizedState===null&&(s=e.alternate,s!==null&&(s=s.memoizedState,s!==null))){s=s.dehydrated;try{Lo(s)}catch(t){kt(e,e.return,t)}}}function aw(s,e){if(e.memoizedState===null&&(s=e.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{Lo(s)}catch(t){kt(e,e.return,t)}}function vN(s){switch(s.tag){case 31:case 13:case 19:var e=s.stateNode;return e===null&&(e=s.stateNode=new ay),e;case 22:return s=s.stateNode,e=s._retryCache,e===null&&(e=s._retryCache=new ay),e;default:throw Error(W(435,s.tag))}}function tc(s,e){var t=vN(s);e.forEach(function(i){if(!t.has(i)){t.add(i);var a=RN.bind(null,s,i);i.then(a,a)}})}function ps(s,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var a=t[i],n=s,r=e,o=r;e:for(;o!==null;){switch(o.tag){case 27:if(rr(o.type)){Yt=o.stateNode,ys=!1;break e}break;case 5:Yt=o.stateNode,ys=!1;break e;case 3:case 4:Yt=o.stateNode.containerInfo,ys=!0;break e}o=o.return}if(Yt===null)throw Error(W(160));iw(n,r,a),Yt=null,ys=!1,n=a.alternate,n!==null&&(n.return=null),a.return=null}if(e.subtreeFlags&13886)for(e=e.child;e!==null;)nw(e,s),e=e.sibling}var sa=null;function nw(s,e){var t=s.alternate,i=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:ps(e,s),gs(s),i&4&&(Zn(3,s,s.return),Dh(3,s),Zn(5,s,s.return));break;case 1:ps(e,s),gs(s),i&512&&(bi||t===null||ka(t,t.return)),i&64&&Ga&&(s=s.updateQueue,s!==null&&(i=s.callbacks,i!==null&&(t=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=t===null?i:t.concat(i))));break;case 26:var a=sa;if(ps(e,s),gs(s),i&512&&(bi||t===null||ka(t,t.return)),i&4){var n=t!==null?t.memoizedState:null;if(i=s.memoizedState,t===null)if(i===null)if(s.stateNode===null){e:{i=s.type,t=s.memoizedProps,a=a.ownerDocument||a;t:switch(i){case"title":n=a.getElementsByTagName("title")[0],(!n||n[xh]||n[Vi]||n.namespaceURI==="http://www.w3.org/2000/svg"||n.hasAttribute("itemprop"))&&(n=a.createElement(i),a.head.insertBefore(n,a.querySelector("head > title"))),Gi(n,i,t),n[Vi]=s,Fi(n),i=n;break e;case"link":var r=_y("link","href",a).get(i+(t.href||""));if(r){for(var o=0;o<r.length;o++)if(n=r[o],n.getAttribute("href")===(t.href==null||t.href===""?null:t.href)&&n.getAttribute("rel")===(t.rel==null?null:t.rel)&&n.getAttribute("title")===(t.title==null?null:t.title)&&n.getAttribute("crossorigin")===(t.crossOrigin==null?null:t.crossOrigin)){r.splice(o,1);break t}}n=a.createElement(i),Gi(n,i,t),a.head.appendChild(n);break;case"meta":if(r=_y("meta","content",a).get(i+(t.content||""))){for(o=0;o<r.length;o++)if(n=r[o],n.getAttribute("content")===(t.content==null?null:""+t.content)&&n.getAttribute("name")===(t.name==null?null:t.name)&&n.getAttribute("property")===(t.property==null?null:t.property)&&n.getAttribute("http-equiv")===(t.httpEquiv==null?null:t.httpEquiv)&&n.getAttribute("charset")===(t.charSet==null?null:t.charSet)){r.splice(o,1);break t}}n=a.createElement(i),Gi(n,i,t),a.head.appendChild(n);break;default:throw Error(W(468,i))}n[Vi]=s,Fi(n),i=n}s.stateNode=i}else Ny(a,s.type,s.stateNode);else s.stateNode=By(a,i,s.memoizedProps);else n!==i?(n===null?t.stateNode!==null&&(t=t.stateNode,t.parentNode.removeChild(t)):n.count--,i===null?Ny(a,s.type,s.stateNode):By(a,i,s.memoizedProps)):i===null&&s.stateNode!==null&&Wd(s,s.memoizedProps,t.memoizedProps)}break;case 27:ps(e,s),gs(s),i&512&&(bi||t===null||ka(t,t.return)),t!==null&&i&4&&Wd(s,s.memoizedProps,t.memoizedProps);break;case 5:if(ps(e,s),gs(s),i&512&&(bi||t===null||ka(t,t.return)),s.flags&32){a=s.stateNode;try{_o(a,"")}catch(g){kt(s,s.return,g)}}i&4&&s.stateNode!=null&&(a=s.memoizedProps,Wd(s,a,t!==null?t.memoizedProps:a)),i&1024&&(Gd=!0);break;case 6:if(ps(e,s),gs(s),i&4){if(s.stateNode===null)throw Error(W(162));i=s.memoizedProps,t=s.stateNode;try{t.nodeValue=i}catch(g){kt(s,s.return,g)}}break;case 3:if(Bc=null,a=sa,sa=$c(e.containerInfo),ps(e,s),sa=a,gs(s),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Lo(e.containerInfo)}catch(g){kt(s,s.return,g)}Gd&&(Gd=!1,rw(s));break;case 4:i=sa,sa=$c(s.stateNode.containerInfo),ps(e,s),gs(s),sa=i;break;case 12:ps(e,s),gs(s);break;case 31:ps(e,s),gs(s),i&4&&(i=s.updateQueue,i!==null&&(s.updateQueue=null,tc(s,i)));break;case 13:ps(e,s),gs(s),s.child.flags&8192&&s.memoizedState!==null!=(t!==null&&t.memoizedState!==null)&&(Ju=Rs()),i&4&&(i=s.updateQueue,i!==null&&(s.updateQueue=null,tc(s,i)));break;case 22:a=s.memoizedState!==null;var l=t!==null&&t.memoizedState!==null,h=Ga,c=bi;if(Ga=h||a,bi=c||l,ps(e,s),bi=c,Ga=h,gs(s),i&8192)e:for(e=s.stateNode,e._visibility=a?e._visibility&-2:e._visibility|1,a&&(t===null||l||Ga||bi||pr(s)),t=null,e=s;;){if(e.tag===5||e.tag===26){if(t===null){l=t=e;try{if(n=l.stateNode,a)r=n.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none";else{o=l.stateNode;var d=l.memoizedProps.style,f=d!=null&&d.hasOwnProperty("display")?d.display:null;o.style.display=f==null||typeof f=="boolean"?"":(""+f).trim()}}catch(g){kt(l,l.return,g)}}}else if(e.tag===6){if(t===null){l=e;try{l.stateNode.nodeValue=a?"":l.memoizedProps}catch(g){kt(l,l.return,g)}}}else if(e.tag===18){if(t===null){l=e;try{var p=l.stateNode;a?by(p,!0):by(l.stateNode,!1)}catch(g){kt(l,l.return,g)}}}else if((e.tag!==22&&e.tag!==23||e.memoizedState===null||e===s)&&e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break e;for(;e.sibling===null;){if(e.return===null||e.return===s)break e;t===e&&(t=null),e=e.return}t===e&&(t=null),e.sibling.return=e.return,e=e.sibling}i&4&&(i=s.updateQueue,i!==null&&(t=i.retryQueue,t!==null&&(i.retryQueue=null,tc(s,t))));break;case 19:ps(e,s),gs(s),i&4&&(i=s.updateQueue,i!==null&&(s.updateQueue=null,tc(s,i)));break;case 30:break;case 21:break;default:ps(e,s),gs(s)}}function gs(s){var e=s.flags;if(e&2){try{for(var t,i=s.return;i!==null;){if(ZS(i)){t=i;break}i=i.return}if(t==null)throw Error(W(160));switch(t.tag){case 27:var a=t.stateNode,n=zd(s);Gc(s,n,a);break;case 5:var r=t.stateNode;t.flags&32&&(_o(r,""),t.flags&=-33);var o=zd(s);Gc(s,o,r);break;case 3:case 4:var l=t.stateNode.containerInfo,h=zd(s);Yf(s,h,l);break;default:throw Error(W(161))}}catch(c){kt(s,s.return,c)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function rw(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var e=s;rw(e),e.tag===5&&e.flags&1024&&e.stateNode.reset(),s=s.sibling}}function Oa(s,e){if(e.subtreeFlags&8772)for(e=e.child;e!==null;)ew(s,e.alternate,e),e=e.sibling}function pr(s){for(s=s.child;s!==null;){var e=s;switch(e.tag){case 0:case 11:case 14:case 15:Zn(4,e,e.return),pr(e);break;case 1:ka(e,e.return);var t=e.stateNode;typeof t.componentWillUnmount=="function"&&KS(e,e.return,t),pr(e);break;case 27:Pl(e.stateNode);case 26:case 5:ka(e,e.return),pr(e);break;case 22:e.memoizedState===null&&pr(e);break;case 30:pr(e);break;default:pr(e)}s=s.sibling}}function Ia(s,e,t){for(t=t&&(e.subtreeFlags&8772)!==0,e=e.child;e!==null;){var i=e.alternate,a=s,n=e,r=n.flags;switch(n.tag){case 0:case 11:case 15:Ia(a,n,t),Dh(4,n);break;case 1:if(Ia(a,n,t),i=n,a=i.stateNode,typeof a.componentDidMount=="function")try{a.componentDidMount()}catch(h){kt(i,i.return,h)}if(i=n,a=i.updateQueue,a!==null){var o=i.stateNode;try{var l=a.shared.hiddenCallbacks;if(l!==null)for(a.shared.hiddenCallbacks=null,a=0;a<l.length;a++)sS(l[a],o)}catch(h){kt(i,i.return,h)}}t&&r&64&&QS(n),vl(n,n.return);break;case 27:jS(n);case 26:case 5:Ia(a,n,t),t&&i===null&&r&4&&$S(n),vl(n,n.return);break;case 12:Ia(a,n,t);break;case 31:Ia(a,n,t),t&&r&4&&sw(a,n);break;case 13:Ia(a,n,t),t&&r&4&&aw(a,n);break;case 22:n.memoizedState===null&&Ia(a,n,t),vl(n,n.return);break;case 30:break;default:Ia(a,n,t)}e=e.sibling}}function gg(s,e){var t=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(t=s.memoizedState.cachePool.pool),s=null,e.memoizedState!==null&&e.memoizedState.cachePool!==null&&(s=e.memoizedState.cachePool.pool),s!==t&&(s!=null&&s.refCount++,t!=null&&Ch(t))}function mg(s,e){s=null,e.alternate!==null&&(s=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==s&&(e.refCount++,s!=null&&Ch(s))}function ia(s,e,t,i){if(e.subtreeFlags&10256)for(e=e.child;e!==null;)ow(s,e,t,i),e=e.sibling}function ow(s,e,t,i){var a=e.flags;switch(e.tag){case 0:case 11:case 15:ia(s,e,t,i),a&2048&&Dh(9,e);break;case 1:ia(s,e,t,i);break;case 3:ia(s,e,t,i),a&2048&&(s=null,e.alternate!==null&&(s=e.alternate.memoizedState.cache),e=e.memoizedState.cache,e!==s&&(e.refCount++,s!=null&&Ch(s)));break;case 12:if(a&2048){ia(s,e,t,i),s=e.stateNode;try{var n=e.memoizedProps,r=n.id,o=n.onPostCommit;typeof o=="function"&&o(r,e.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(l){kt(e,e.return,l)}}else ia(s,e,t,i);break;case 31:ia(s,e,t,i);break;case 13:ia(s,e,t,i);break;case 23:break;case 22:n=e.stateNode,r=e.alternate,e.memoizedState!==null?n._visibility&2?ia(s,e,t,i):Cl(s,e):n._visibility&2?ia(s,e,t,i):(n._visibility|=2,Qr(s,e,t,i,(e.subtreeFlags&10256)!==0||!1)),a&2048&&gg(r,e);break;case 24:ia(s,e,t,i),a&2048&&mg(e.alternate,e);break;default:ia(s,e,t,i)}}function Qr(s,e,t,i,a){for(a=a&&((e.subtreeFlags&10256)!==0||!1),e=e.child;e!==null;){var n=s,r=e,o=t,l=i,h=r.flags;switch(r.tag){case 0:case 11:case 15:Qr(n,r,o,l,a),Dh(8,r);break;case 23:break;case 22:var c=r.stateNode;r.memoizedState!==null?c._visibility&2?Qr(n,r,o,l,a):Cl(n,r):(c._visibility|=2,Qr(n,r,o,l,a)),a&&h&2048&&gg(r.alternate,r);break;case 24:Qr(n,r,o,l,a),a&&h&2048&&mg(r.alternate,r);break;default:Qr(n,r,o,l,a)}e=e.sibling}}function Cl(s,e){if(e.subtreeFlags&10256)for(e=e.child;e!==null;){var t=s,i=e,a=i.flags;switch(i.tag){case 22:Cl(t,i),a&2048&&gg(i.alternate,i);break;case 24:Cl(t,i),a&2048&&mg(i.alternate,i);break;default:Cl(t,i)}e=e.sibling}}var dl=8192;function Xr(s,e,t){if(s.subtreeFlags&dl)for(s=s.child;s!==null;)lw(s,e,t),s=s.sibling}function lw(s,e,t){switch(s.tag){case 26:Xr(s,e,t),s.flags&dl&&s.memoizedState!==null&&fx(t,sa,s.memoizedState,s.memoizedProps);break;case 5:Xr(s,e,t);break;case 3:case 4:var i=sa;sa=$c(s.stateNode.containerInfo),Xr(s,e,t),sa=i;break;case 22:s.memoizedState===null&&(i=s.alternate,i!==null&&i.memoizedState!==null?(i=dl,dl=16777216,Xr(s,e,t),dl=i):Xr(s,e,t));break;default:Xr(s,e,t)}}function hw(s){var e=s.alternate;if(e!==null&&(s=e.child,s!==null)){e.child=null;do e=s.sibling,s.sibling=null,s=e;while(s!==null)}}function al(s){var e=s.deletions;if(s.flags&16){if(e!==null)for(var t=0;t<e.length;t++){var i=e[t];Ai=i,uw(i,s)}hw(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)cw(s),s=s.sibling}function cw(s){switch(s.tag){case 0:case 11:case 15:al(s),s.flags&2048&&Zn(9,s,s.return);break;case 3:al(s);break;case 12:al(s);break;case 22:var e=s.stateNode;s.memoizedState!==null&&e._visibility&2&&(s.return===null||s.return.tag!==13)?(e._visibility&=-3,kc(s)):al(s);break;default:al(s)}}function kc(s){var e=s.deletions;if(s.flags&16){if(e!==null)for(var t=0;t<e.length;t++){var i=e[t];Ai=i,uw(i,s)}hw(s)}for(s=s.child;s!==null;){switch(e=s,e.tag){case 0:case 11:case 15:Zn(8,e,e.return),kc(e);break;case 22:t=e.stateNode,t._visibility&2&&(t._visibility&=-3,kc(e));break;default:kc(e)}s=s.sibling}}function uw(s,e){for(;Ai!==null;){var t=Ai;switch(t.tag){case 0:case 11:case 15:Zn(8,t,e);break;case 23:case 22:if(t.memoizedState!==null&&t.memoizedState.cachePool!==null){var i=t.memoizedState.cachePool.pool;i!=null&&i.refCount++}break;case 24:Ch(t.memoizedState.cache)}if(i=t.child,i!==null)i.return=t,Ai=i;else e:for(t=s;Ai!==null;){i=Ai;var a=i.sibling,n=i.return;if(tw(i),i===t){Ai=null;break e}if(a!==null){a.return=n,Ai=a;break e}Ai=n}}}var CN={getCacheForType:function(s){var e=zi(ki),t=e.data.get(s);return t===void 0&&(t=s(),e.data.set(s,t)),t},cacheSignal:function(){return zi(ki).controller.signal}},EN=typeof WeakMap=="function"?WeakMap:Map,dt=0,Pt=null,Qe=null,$e=0,yt=0,vs=null,Ln=!1,Xo=!1,yg=!1,dn=0,si=0,jn=0,Nr=0,bg=0,Ms=0,Co=0,El=null,bs=null,Xf=!1,Ju=0,dw=0,Uc=1/0,Yc=null,zn=null,xi=0,Gn=null,Eo=null,an=0,qf=0,Jf=null,fw=null,Dl=0,Qf=null;function Hs(){return dt&2&&$e!==0?$e&-$e:Oe.T!==null?wg():Tb()}function pw(){if(Ms===0)if(!($e&536870912)||et){var s=qh;qh<<=1,!(qh&3932160)&&(qh=262144),Ms=s}else Ms=536870912;return s=Ws.current,s!==null&&(s.flags|=32),Ms}function Ts(s,e,t){(s===Pt&&(yt===2||yt===9)||s.cancelPendingCommit!==null)&&(Do(s,0),An(s,$e,Ms,!1)),Nh(s,t),(!(dt&2)||s!==Pt)&&(s===Pt&&(!(dt&2)&&(Nr|=t),si===4&&An(s,$e,Ms,!1)),Pa(s))}function gw(s,e,t){if(dt&6)throw Error(W(327));var i=!t&&(e&127)===0&&(e&s.expiredLanes)===0||_h(s,e),a=i?LN(s,e):Ud(s,e,!0),n=i;do{if(a===0){Xo&&!i&&An(s,e,0,!1);break}else{if(t=s.current.alternate,n&&!DN(t)){a=Ud(s,e,!1),n=!1;continue}if(a===2){if(n=e,s.errorRecoveryDisabledLanes&n)var r=0;else r=s.pendingLanes&-536870913,r=r!==0?r:r&536870912?536870912:0;if(r!==0){e=r;e:{var o=s;a=El;var l=o.current.memoizedState.isDehydrated;if(l&&(Do(o,r).flags|=256),r=Ud(o,r,!1),r!==2){if(yg&&!l){o.errorRecoveryDisabledLanes|=n,Nr|=n,a=4;break e}n=bs,bs=a,n!==null&&(bs===null?bs=n:bs.push.apply(bs,n))}a=r}if(n=!1,a!==2)continue}}if(a===1){Do(s,0),An(s,e,0,!0);break}e:{switch(i=s,n=a,n){case 0:case 1:throw Error(W(345));case 4:if((e&4194048)!==e)break;case 6:An(i,e,Ms,!Ln);break e;case 2:bs=null;break;case 3:case 5:break;default:throw Error(W(329))}if((e&62914560)===e&&(a=Ju+300-Rs(),10<a)){if(An(i,e,Ms,!Ln),Ou(i,0,!0)!==0)break e;an=e,i.timeoutHandle=Mw(ny.bind(null,i,t,bs,Yc,Xf,e,Ms,Nr,Co,Ln,n,"Throttled",-0,0),a);break e}ny(i,t,bs,Yc,Xf,e,Ms,Nr,Co,Ln,n,null,-0,0)}}break}while(!0);Pa(s)}function ny(s,e,t,i,a,n,r,o,l,h,c,d,f,p){if(s.timeoutHandle=-1,d=e.subtreeFlags,d&8192||(d&16785408)===16785408){d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Qa},lw(e,n,d);var g=(n&62914560)===n?Ju-Rs():(n&4194048)===n?dw-Rs():0;if(g=px(d,g),g!==null){an=n,s.cancelPendingCommit=g(oy.bind(null,s,e,n,t,i,a,r,o,l,c,d,null,f,p)),An(s,n,r,!h);return}}oy(s,e,n,t,i,a,r,o,l)}function DN(s){for(var e=s;;){var t=e.tag;if((t===0||t===11||t===15)&&e.flags&16384&&(t=e.updateQueue,t!==null&&(t=t.stores,t!==null)))for(var i=0;i<t.length;i++){var a=t[i],n=a.getSnapshot;a=a.value;try{if(!Vs(n(),a))return!1}catch{return!1}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function An(s,e,t,i){e&=~bg,e&=~Nr,s.suspendedLanes|=e,s.pingedLanes&=~e,i&&(s.warmLanes|=e),i=s.expirationTimes;for(var a=e;0<a;){var n=31-Is(a),r=1<<n;i[n]=-1,a&=~r}t!==0&&Sb(s,t,e)}function Qu(){return dt&6?!0:(Ph(0),!1)}function Sg(){if(Qe!==null){if(yt===0)var s=Qe.return;else s=Qe,Ka=zr=null,ag(s),bo=null,$l=0,s=Qe;for(;s!==null;)JS(s.alternate,s),s=s.return;Qe=null}}function Do(s,e){var t=s.timeoutHandle;t!==-1&&(s.timeoutHandle=-1,KN(t)),t=s.cancelPendingCommit,t!==null&&(s.cancelPendingCommit=null,t()),an=0,Sg(),Pt=s,Qe=t=tn(s.current,null),$e=e,yt=0,vs=null,Ln=!1,Xo=_h(s,e),yg=!1,Co=Ms=bg=Nr=jn=si=0,bs=El=null,Xf=!1,e&8&&(e|=e&32);var i=s.entangledLanes;if(i!==0)for(s=s.entanglements,i&=e;0<i;){var a=31-Is(i),n=1<<a;e|=s[a],i&=~n}return dn=e,Wu(),t}function mw(s,e){Ue=null,Oe.H=jl,e===Yo||e===Gu?(e=Om(),yt=3):e===$p?(e=Om(),yt=4):yt=e===fg?8:e!==null&&typeof e=="object"&&typeof e.then=="function"?6:1,vs=e,Qe===null&&(si=1,Wc(s,Ks(e,s.current)))}function yw(){var s=Ws.current;return s===null?!0:($e&4194048)===$e?js===null:($e&62914560)===$e||$e&536870912?s===js:!1}function bw(){var s=Oe.H;return Oe.H=jl,s===null?jl:s}function Sw(){var s=Oe.A;return Oe.A=CN,s}function Xc(){si=4,Ln||($e&4194048)!==$e&&Ws.current!==null||(Xo=!0),!(jn&134217727)&&!(Nr&134217727)||Pt===null||An(Pt,$e,Ms,!1)}function Ud(s,e,t){var i=dt;dt|=2;var a=bw(),n=Sw();(Pt!==s||$e!==e)&&(Yc=null,Do(s,e)),e=!1;var r=si;e:do try{if(yt!==0&&Qe!==null){var o=Qe,l=vs;switch(yt){case 8:Sg(),r=6;break e;case 3:case 2:case 9:case 6:Ws.current===null&&(e=!0);var h=yt;if(yt=0,vs=null,lo(s,o,l,h),t&&Xo){r=0;break e}break;default:h=yt,yt=0,vs=null,lo(s,o,l,h)}}PN(),r=si;break}catch(c){mw(s,c)}while(!0);return e&&s.shellSuspendCounter++,Ka=zr=null,dt=i,Oe.H=a,Oe.A=n,Qe===null&&(Pt=null,$e=0,Wu()),r}function PN(){for(;Qe!==null;)ww(Qe)}function LN(s,e){var t=dt;dt|=2;var i=bw(),a=Sw();Pt!==s||$e!==e?(Yc=null,Uc=Rs()+500,Do(s,e)):Xo=_h(s,e);e:do try{if(yt!==0&&Qe!==null){e=Qe;var n=vs;t:switch(yt){case 1:yt=0,vs=null,lo(s,e,n,1);break;case 2:case 9:if(Rm(n)){yt=0,vs=null,ry(e);break}e=function(){yt!==2&&yt!==9||Pt!==s||(yt=7),Pa(s)},n.then(e,e);break e;case 3:yt=7;break e;case 4:yt=5;break e;case 7:Rm(n)?(yt=0,vs=null,ry(e)):(yt=0,vs=null,lo(s,e,n,7));break;case 5:var r=null;switch(Qe.tag){case 26:r=Qe.memoizedState;case 5:case 27:var o=Qe;if(r?Vw(r):o.stateNode.complete){yt=0,vs=null;var l=o.sibling;if(l!==null)Qe=l;else{var h=o.return;h!==null?(Qe=h,Ku(h)):Qe=null}break t}}yt=0,vs=null,lo(s,e,n,5);break;case 6:yt=0,vs=null,lo(s,e,n,6);break;case 8:Sg(),si=6;break e;default:throw Error(W(462))}}AN();break}catch(c){mw(s,c)}while(!0);return Ka=zr=null,Oe.H=i,Oe.A=a,dt=t,Qe!==null?0:(Pt=null,$e=0,Wu(),si)}function AN(){for(;Qe!==null&&!i1();)ww(Qe)}function ww(s){var e=qS(s.alternate,s,dn);s.memoizedProps=s.pendingProps,e===null?Ku(s):Qe=e}function ry(s){var e=s,t=e.alternate;switch(e.tag){case 15:case 0:e=jm(t,e,e.pendingProps,e.type,void 0,$e);break;case 11:e=jm(t,e,e.pendingProps,e.type.render,e.ref,$e);break;case 5:ag(e);default:JS(t,e),e=Qe=Jb(e,dn),e=qS(t,e,dn)}s.memoizedProps=s.pendingProps,e===null?Ku(s):Qe=e}function lo(s,e,t,i){Ka=zr=null,ag(e),bo=null,$l=0;var a=e.return;try{if(kN(s,a,e,t,$e)){si=1,Wc(s,Ks(t,s.current)),Qe=null;return}}catch(n){if(a!==null)throw Qe=a,n;si=1,Wc(s,Ks(t,s.current)),Qe=null;return}e.flags&32768?(et||i===1?s=!0:Xo||$e&536870912?s=!1:(Ln=s=!0,(i===2||i===9||i===3||i===6)&&(i=Ws.current,i!==null&&i.tag===13&&(i.flags|=16384))),kw(e,s)):Ku(e)}function Ku(s){var e=s;do{if(e.flags&32768){kw(e,Ln);return}s=e.return;var t=_N(e.alternate,e,dn);if(t!==null){Qe=t;return}if(e=e.sibling,e!==null){Qe=e;return}Qe=e=s}while(e!==null);si===0&&(si=5)}function kw(s,e){do{var t=NN(s.alternate,s);if(t!==null){t.flags&=32767,Qe=t;return}if(t=s.return,t!==null&&(t.flags|=32768,t.subtreeFlags=0,t.deletions=null),!e&&(s=s.sibling,s!==null)){Qe=s;return}Qe=s=t}while(s!==null);si=6,Qe=null}function oy(s,e,t,i,a,n,r,o,l){s.cancelPendingCommit=null;do $u();while(xi!==0);if(dt&6)throw Error(W(327));if(e!==null){if(e===s.current)throw Error(W(177));if(n=e.lanes|e.childLanes,n|=Up,d1(s,t,n,r,o,l),s===Pt&&(Qe=Pt=null,$e=0),Eo=e,Gn=s,an=t,qf=n,Jf=a,fw=i,e.subtreeFlags&10256||e.flags&10256?(s.callbackNode=null,s.callbackPriority=0,ON(Dc,function(){return xw(),null})):(s.callbackNode=null,s.callbackPriority=0),i=(e.flags&13878)!==0,e.subtreeFlags&13878||i){i=Oe.T,Oe.T=null,a=ft.p,ft.p=2,r=dt,dt|=4;try{xN(s,e,t)}finally{dt=r,ft.p=a,Oe.T=i}}xi=1,Tw(),Bw(),_w()}}function Tw(){if(xi===1){xi=0;var s=Gn,e=Eo,t=(e.flags&13878)!==0;if(e.subtreeFlags&13878||t){t=Oe.T,Oe.T=null;var i=ft.p;ft.p=2;var a=dt;dt|=4;try{nw(e,s);var n=jf,r=Vb(s.containerInfo),o=n.focusedElem,l=n.selectionRange;if(r!==o&&o&&o.ownerDocument&&Hb(o.ownerDocument.documentElement,o)){if(l!==null&&Gp(o)){var h=l.start,c=l.end;if(c===void 0&&(c=h),"selectionStart"in o)o.selectionStart=h,o.selectionEnd=Math.min(c,o.value.length);else{var d=o.ownerDocument||document,f=d&&d.defaultView||window;if(f.getSelection){var p=f.getSelection(),g=o.textContent.length,m=Math.min(l.start,g),T=l.end===void 0?m:Math.min(l.end,g);!p.extend&&m>T&&(r=T,T=m,m=r);var S=Em(o,m),y=Em(o,T);if(S&&y&&(p.rangeCount!==1||p.anchorNode!==S.node||p.anchorOffset!==S.offset||p.focusNode!==y.node||p.focusOffset!==y.offset)){var b=d.createRange();b.setStart(S.node,S.offset),p.removeAllRanges(),m>T?(p.addRange(b),p.extend(y.node,y.offset)):(b.setEnd(y.node,y.offset),p.addRange(b))}}}}for(d=[],p=o;p=p.parentNode;)p.nodeType===1&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<d.length;o++){var B=d[o];B.element.scrollLeft=B.left,B.element.scrollTop=B.top}}eu=!!Zf,jf=Zf=null}finally{dt=a,ft.p=i,Oe.T=t}}s.current=e,xi=2}}function Bw(){if(xi===2){xi=0;var s=Gn,e=Eo,t=(e.flags&8772)!==0;if(e.subtreeFlags&8772||t){t=Oe.T,Oe.T=null;var i=ft.p;ft.p=2;var a=dt;dt|=4;try{ew(s,e.alternate,e)}finally{dt=a,ft.p=i,Oe.T=t}}xi=3}}function _w(){if(xi===4||xi===3){xi=0,s1();var s=Gn,e=Eo,t=an,i=fw;e.subtreeFlags&10256||e.flags&10256?xi=5:(xi=0,Eo=Gn=null,Nw(s,s.pendingLanes));var a=s.pendingLanes;if(a===0&&(zn=null),Rp(t),e=e.stateNode,Os&&typeof Os.onCommitFiberRoot=="function")try{Os.onCommitFiberRoot(Bh,e,void 0,(e.current.flags&128)===128)}catch{}if(i!==null){e=Oe.T,a=ft.p,ft.p=2,Oe.T=null;try{for(var n=s.onRecoverableError,r=0;r<i.length;r++){var o=i[r];n(o.value,{componentStack:o.stack})}}finally{Oe.T=e,ft.p=a}}an&3&&$u(),Pa(s),a=s.pendingLanes,t&261930&&a&42?s===Qf?Dl++:(Dl=0,Qf=s):Dl=0,Ph(0)}}function Nw(s,e){(s.pooledCacheLanes&=e)===0&&(e=s.pooledCache,e!=null&&(s.pooledCache=null,Ch(e)))}function $u(){return Tw(),Bw(),_w(),xw()}function xw(){if(xi!==5)return!1;var s=Gn,e=qf;qf=0;var t=Rp(an),i=Oe.T,a=ft.p;try{ft.p=32>t?32:t,Oe.T=null,t=Jf,Jf=null;var n=Gn,r=an;if(xi=0,Eo=Gn=null,an=0,dt&6)throw Error(W(331));var o=dt;if(dt|=4,cw(n.current),ow(n,n.current,r,t),dt=o,Ph(0,!1),Os&&typeof Os.onPostCommitFiberRoot=="function")try{Os.onPostCommitFiberRoot(Bh,n)}catch{}return!0}finally{ft.p=a,Oe.T=i,Nw(s,e)}}function ly(s,e,t){e=Ks(t,e),e=zf(s.stateNode,e,2),s=Wn(s,e,2),s!==null&&(Nh(s,2),Pa(s))}function kt(s,e,t){if(s.tag===3)ly(s,s,t);else for(;e!==null;){if(e.tag===3){ly(e,s,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(zn===null||!zn.has(i))){s=Ks(t,s),t=WS(2),i=Wn(e,t,2),i!==null&&(zS(t,i,e,s),Nh(i,2),Pa(i));break}}e=e.return}}function Yd(s,e,t){var i=s.pingCache;if(i===null){i=s.pingCache=new EN;var a=new Set;i.set(e,a)}else a=i.get(e),a===void 0&&(a=new Set,i.set(e,a));a.has(t)||(yg=!0,a.add(t),s=FN.bind(null,s,e,t),e.then(s,s))}function FN(s,e,t){var i=s.pingCache;i!==null&&i.delete(e),s.pingedLanes|=s.suspendedLanes&t,s.warmLanes&=~t,Pt===s&&($e&t)===t&&(si===4||si===3&&($e&62914560)===$e&&300>Rs()-Ju?!(dt&2)&&Do(s,0):bg|=t,Co===$e&&(Co=0)),Pa(s)}function vw(s,e){e===0&&(e=bb()),s=Wr(s,e),s!==null&&(Nh(s,e),Pa(s))}function MN(s){var e=s.memoizedState,t=0;e!==null&&(t=e.retryLane),vw(s,t)}function RN(s,e){var t=0;switch(s.tag){case 31:case 13:var i=s.stateNode,a=s.memoizedState;a!==null&&(t=a.retryLane);break;case 19:i=s.stateNode;break;case 22:i=s.stateNode._retryCache;break;default:throw Error(W(314))}i!==null&&i.delete(e),vw(s,t)}function ON(s,e){return Fp(s,e)}var qc=null,Kr=null,Kf=!1,Jc=!1,Xd=!1,Fn=0;function Pa(s){s!==Kr&&s.next===null&&(Kr===null?qc=Kr=s:Kr=Kr.next=s),Jc=!0,Kf||(Kf=!0,HN())}function Ph(s,e){if(!Xd&&Jc){Xd=!0;do for(var t=!1,i=qc;i!==null;){if(s!==0){var a=i.pendingLanes;if(a===0)var n=0;else{var r=i.suspendedLanes,o=i.pingedLanes;n=(1<<31-Is(42|s)+1)-1,n&=a&~(r&~o),n=n&201326741?n&201326741|1:n?n|2:0}n!==0&&(t=!0,hy(i,n))}else n=$e,n=Ou(i,i===Pt?n:0,i.cancelPendingCommit!==null||i.timeoutHandle!==-1),!(n&3)||_h(i,n)||(t=!0,hy(i,n));i=i.next}while(t);Xd=!1}}function IN(){Cw()}function Cw(){Jc=Kf=!1;var s=0;Fn!==0&&QN()&&(s=Fn);for(var e=Rs(),t=null,i=qc;i!==null;){var a=i.next,n=Ew(i,e);n===0?(i.next=null,t===null?qc=a:t.next=a,a===null&&(Kr=t)):(t=i,(s!==0||n&3)&&(Jc=!0)),i=a}xi!==0&&xi!==5||Ph(s),Fn!==0&&(Fn=0)}function Ew(s,e){for(var t=s.suspendedLanes,i=s.pingedLanes,a=s.expirationTimes,n=s.pendingLanes&-62914561;0<n;){var r=31-Is(n),o=1<<r,l=a[r];l===-1?(!(o&t)||o&i)&&(a[r]=u1(o,e)):l<=e&&(s.expiredLanes|=o),n&=~o}if(e=Pt,t=$e,t=Ou(s,s===e?t:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),i=s.callbackNode,t===0||s===e&&(yt===2||yt===9)||s.cancelPendingCommit!==null)return i!==null&&i!==null&&wd(i),s.callbackNode=null,s.callbackPriority=0;if(!(t&3)||_h(s,t)){if(e=t&-t,e===s.callbackPriority)return e;switch(i!==null&&wd(i),Rp(t)){case 2:case 8:t=mb;break;case 32:t=Dc;break;case 268435456:t=yb;break;default:t=Dc}return i=Dw.bind(null,s),t=Fp(t,i),s.callbackPriority=e,s.callbackNode=t,e}return i!==null&&i!==null&&wd(i),s.callbackPriority=2,s.callbackNode=null,2}function Dw(s,e){if(xi!==0&&xi!==5)return s.callbackNode=null,s.callbackPriority=0,null;var t=s.callbackNode;if($u()&&s.callbackNode!==t)return null;var i=$e;return i=Ou(s,s===Pt?i:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),i===0?null:(gw(s,i,e),Ew(s,Rs()),s.callbackNode!=null&&s.callbackNode===t?Dw.bind(null,s):null)}function hy(s,e){if($u())return null;gw(s,e,!0)}function HN(){$N(function(){dt&6?Fp(gb,IN):Cw()})}function wg(){if(Fn===0){var s=No;s===0&&(s=Xh,Xh<<=1,!(Xh&261888)&&(Xh=256)),Fn=s}return Fn}function cy(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:dc(""+s)}function uy(s,e){var t=e.ownerDocument.createElement("input");return t.name=e.name,t.value=e.value,s.id&&t.setAttribute("form",s.id),e.parentNode.insertBefore(t,e),s=new FormData(s),t.parentNode.removeChild(t),s}function VN(s,e,t,i,a){if(e==="submit"&&t&&t.stateNode===a){var n=cy((a[_s]||null).action),r=i.submitter;r&&(e=(e=r[_s]||null)?cy(e.formAction):r.getAttribute("formAction"),e!==null&&(n=e,r=null));var o=new Iu("action","action",null,i,a);s.push({event:o,listeners:[{instance:null,listener:function(){if(i.defaultPrevented){if(Fn!==0){var l=r?uy(a,r):new FormData(a);Vf(t,{pending:!0,data:l,method:a.method,action:n},null,l)}}else typeof n=="function"&&(o.preventDefault(),l=r?uy(a,r):new FormData(a),Vf(t,{pending:!0,data:l,method:a.method,action:n},n,l))},currentTarget:a}]})}}for(var qd=0;qd<Cf.length;qd++){var Jd=Cf[qd],WN=Jd.toLowerCase(),zN=Jd[0].toUpperCase()+Jd.slice(1);fa(WN,"on"+zN)}fa(zb,"onAnimationEnd");fa(Gb,"onAnimationIteration");fa(Ub,"onAnimationStart");fa("dblclick","onDoubleClick");fa("focusin","onFocus");fa("focusout","onBlur");fa(aN,"onTransitionRun");fa(nN,"onTransitionStart");fa(rN,"onTransitionCancel");fa(Yb,"onTransitionEnd");Bo("onMouseEnter",["mouseout","mouseover"]);Bo("onMouseLeave",["mouseout","mouseover"]);Bo("onPointerEnter",["pointerout","pointerover"]);Bo("onPointerLeave",["pointerout","pointerover"]);Ir("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Ir("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Ir("onBeforeInput",["compositionend","keypress","textInput","paste"]);Ir("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Ir("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Ir("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var eh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),GN=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(eh));function Pw(s,e){e=(e&4)!==0;for(var t=0;t<s.length;t++){var i=s[t],a=i.event;i=i.listeners;e:{var n=void 0;if(e)for(var r=i.length-1;0<=r;r--){var o=i[r],l=o.instance,h=o.currentTarget;if(o=o.listener,l!==n&&a.isPropagationStopped())break e;n=o,a.currentTarget=h;try{n(a)}catch(c){Lc(c)}a.currentTarget=null,n=l}else for(r=0;r<i.length;r++){if(o=i[r],l=o.instance,h=o.currentTarget,o=o.listener,l!==n&&a.isPropagationStopped())break e;n=o,a.currentTarget=h;try{n(a)}catch(c){Lc(c)}a.currentTarget=null,n=l}}}}function Je(s,e){var t=e[wf];t===void 0&&(t=e[wf]=new Set);var i=s+"__bubble";t.has(i)||(Lw(e,s,2,!1),t.add(i))}function Qd(s,e,t){var i=0;e&&(i|=4),Lw(t,s,i,e)}var ic="_reactListening"+Math.random().toString(36).slice(2);function kg(s){if(!s[ic]){s[ic]=!0,Bb.forEach(function(t){t!=="selectionchange"&&(GN.has(t)||Qd(t,!1,s),Qd(t,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[ic]||(e[ic]=!0,Qd("selectionchange",!1,e))}}function Lw(s,e,t,i){switch(Yw(e)){case 2:var a=yx;break;case 8:a=bx;break;default:a=Ng}t=a.bind(null,e,t,s),a=void 0,!Nf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(a=!0),i?a!==void 0?s.addEventListener(e,t,{capture:!0,passive:a}):s.addEventListener(e,t,!0):a!==void 0?s.addEventListener(e,t,{passive:a}):s.addEventListener(e,t,!1)}function Kd(s,e,t,i,a){var n=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var r=i.tag;if(r===3||r===4){var o=i.stateNode.containerInfo;if(o===a)break;if(r===4)for(r=i.return;r!==null;){var l=r.tag;if((l===3||l===4)&&r.stateNode.containerInfo===a)return;r=r.return}for(;o!==null;){if(r=jr(o),r===null)return;if(l=r.tag,l===5||l===6||l===26||l===27){i=n=r;continue e}o=o.parentNode}}i=i.return}Pb(function(){var h=n,c=Hp(t),d=[];e:{var f=Xb.get(s);if(f!==void 0){var p=Iu,g=s;switch(s){case"keypress":if(pc(t)===0)break e;case"keydown":case"keyup":p=R1;break;case"focusin":g="focus",p=Nd;break;case"focusout":g="blur",p=Nd;break;case"beforeblur":case"afterblur":p=Nd;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Sm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=_1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=H1;break;case zb:case Gb:case Ub:p=v1;break;case Yb:p=W1;break;case"scroll":case"scrollend":p=T1;break;case"wheel":p=G1;break;case"copy":case"cut":case"paste":p=E1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=km;break;case"toggle":case"beforetoggle":p=Y1}var m=(e&4)!==0,T=!m&&(s==="scroll"||s==="scrollend"),S=m?f!==null?f+"Capture":null:f;m=[];for(var y=h,b;y!==null;){var B=y;if(b=B.stateNode,B=B.tag,B!==5&&B!==26&&B!==27||b===null||S===null||(B=Xl(y,S),B!=null&&m.push(th(y,B,b))),T)break;y=y.return}0<m.length&&(f=new p(f,g,null,t,c),d.push({event:f,listeners:m}))}}if(!(e&7)){e:{if(f=s==="mouseover"||s==="pointerover",p=s==="mouseout"||s==="pointerout",f&&t!==_f&&(g=t.relatedTarget||t.fromElement)&&(jr(g)||g[zo]))break e;if((p||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,p?(g=t.relatedTarget||t.toElement,p=h,g=g?jr(g):null,g!==null&&(T=Th(g),m=g.tag,g!==T||m!==5&&m!==27&&m!==6)&&(g=null)):(p=null,g=h),p!==g)){if(m=Sm,B="onMouseLeave",S="onMouseEnter",y="mouse",(s==="pointerout"||s==="pointerover")&&(m=km,B="onPointerLeave",S="onPointerEnter",y="pointer"),T=p==null?f:cl(p),b=g==null?f:cl(g),f=new m(B,y+"leave",p,t,c),f.target=T,f.relatedTarget=b,B=null,jr(c)===h&&(m=new m(S,y+"enter",g,t,c),m.target=b,m.relatedTarget=T,B=m),T=B,p&&g)t:{for(m=UN,S=p,y=g,b=0,B=S;B;B=m(B))b++;B=0;for(var N=y;N;N=m(N))B++;for(;0<b-B;)S=m(S),b--;for(;0<B-b;)y=m(y),B--;for(;b--;){if(S===y||y!==null&&S===y.alternate){m=S;break t}S=m(S),y=m(y)}m=null}else m=null;p!==null&&dy(d,f,p,m,!1),g!==null&&T!==null&&dy(d,T,g,m,!0)}}e:{if(f=h?cl(h):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var L=Nm;else if(_m(f))if(Ob)L=tN;else{L=j1;var _=Z1}else p=f.nodeName,!p||p.toLowerCase()!=="input"||f.type!=="checkbox"&&f.type!=="radio"?h&&Ip(h.elementType)&&(L=Nm):L=eN;if(L&&(L=L(s,h))){Rb(d,L,t,c);break e}_&&_(s,f,h),s==="focusout"&&h&&f.type==="number"&&h.memoizedProps.value!=null&&Bf(f,"number",f.value)}switch(_=h?cl(h):window,s){case"focusin":(_m(_)||_.contentEditable==="true")&&(io=_,xf=h,kl=null);break;case"focusout":kl=xf=io=null;break;case"mousedown":vf=!0;break;case"contextmenu":case"mouseup":case"dragend":vf=!1,Dm(d,t,c);break;case"selectionchange":if(sN)break;case"keydown":case"keyup":Dm(d,t,c)}var A;if(zp)e:{switch(s){case"compositionstart":var J="onCompositionStart";break e;case"compositionend":J="onCompositionEnd";break e;case"compositionupdate":J="onCompositionUpdate";break e}J=void 0}else to?Fb(s,t)&&(J="onCompositionEnd"):s==="keydown"&&t.keyCode===229&&(J="onCompositionStart");J&&(Ab&&t.locale!=="ko"&&(to||J!=="onCompositionStart"?J==="onCompositionEnd"&&to&&(A=Lb()):(Pn=c,Vp="value"in Pn?Pn.value:Pn.textContent,to=!0)),_=Qc(h,J),0<_.length&&(J=new wm(J,s,null,t,c),d.push({event:J,listeners:_}),A?J.data=A:(A=Mb(t),A!==null&&(J.data=A)))),(A=q1?J1(s,t):Q1(s,t))&&(J=Qc(h,"onBeforeInput"),0<J.length&&(_=new wm("onBeforeInput","beforeinput",null,t,c),d.push({event:_,listeners:J}),_.data=A)),VN(d,s,h,t,c)}Pw(d,e)})}function th(s,e,t){return{instance:s,listener:e,currentTarget:t}}function Qc(s,e){for(var t=e+"Capture",i=[];s!==null;){var a=s,n=a.stateNode;if(a=a.tag,a!==5&&a!==26&&a!==27||n===null||(a=Xl(s,t),a!=null&&i.unshift(th(s,a,n)),a=Xl(s,e),a!=null&&i.push(th(s,a,n))),s.tag===3)return i;s=s.return}return[]}function UN(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function dy(s,e,t,i,a){for(var n=e._reactName,r=[];t!==null&&t!==i;){var o=t,l=o.alternate,h=o.stateNode;if(o=o.tag,l!==null&&l===i)break;o!==5&&o!==26&&o!==27||h===null||(l=h,a?(h=Xl(t,n),h!=null&&r.unshift(th(t,h,l))):a||(h=Xl(t,n),h!=null&&r.push(th(t,h,l)))),t=t.return}r.length!==0&&s.push({event:e,listeners:r})}var YN=/\r\n?/g,XN=/\u0000|\uFFFD/g;function fy(s){return(typeof s=="string"?s:""+s).replace(YN,`
`).replace(XN,"")}function Aw(s,e){return e=fy(e),fy(s)===e}function xt(s,e,t,i,a,n){switch(t){case"children":typeof i=="string"?e==="body"||e==="textarea"&&i===""||_o(s,i):(typeof i=="number"||typeof i=="bigint")&&e!=="body"&&_o(s,""+i);break;case"className":Qh(s,"class",i);break;case"tabIndex":Qh(s,"tabindex",i);break;case"dir":case"role":case"viewBox":case"width":case"height":Qh(s,t,i);break;case"style":Db(s,i,n);break;case"data":if(e!=="object"){Qh(s,"data",i);break}case"src":case"href":if(i===""&&(e!=="a"||t!=="href")){s.removeAttribute(t);break}if(i==null||typeof i=="function"||typeof i=="symbol"||typeof i=="boolean"){s.removeAttribute(t);break}i=dc(""+i),s.setAttribute(t,i);break;case"action":case"formAction":if(typeof i=="function"){s.setAttribute(t,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof n=="function"&&(t==="formAction"?(e!=="input"&&xt(s,e,"name",a.name,a,null),xt(s,e,"formEncType",a.formEncType,a,null),xt(s,e,"formMethod",a.formMethod,a,null),xt(s,e,"formTarget",a.formTarget,a,null)):(xt(s,e,"encType",a.encType,a,null),xt(s,e,"method",a.method,a,null),xt(s,e,"target",a.target,a,null)));if(i==null||typeof i=="symbol"||typeof i=="boolean"){s.removeAttribute(t);break}i=dc(""+i),s.setAttribute(t,i);break;case"onClick":i!=null&&(s.onclick=Qa);break;case"onScroll":i!=null&&Je("scroll",s);break;case"onScrollEnd":i!=null&&Je("scrollend",s);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(W(61));if(t=i.__html,t!=null){if(a.children!=null)throw Error(W(60));s.innerHTML=t}}break;case"multiple":s.multiple=i&&typeof i!="function"&&typeof i!="symbol";break;case"muted":s.muted=i&&typeof i!="function"&&typeof i!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(i==null||typeof i=="function"||typeof i=="boolean"||typeof i=="symbol"){s.removeAttribute("xlink:href");break}t=dc(""+i),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":i!=null&&typeof i!="function"&&typeof i!="symbol"?s.setAttribute(t,""+i):s.removeAttribute(t);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":i&&typeof i!="function"&&typeof i!="symbol"?s.setAttribute(t,""):s.removeAttribute(t);break;case"capture":case"download":i===!0?s.setAttribute(t,""):i!==!1&&i!=null&&typeof i!="function"&&typeof i!="symbol"?s.setAttribute(t,i):s.removeAttribute(t);break;case"cols":case"rows":case"size":case"span":i!=null&&typeof i!="function"&&typeof i!="symbol"&&!isNaN(i)&&1<=i?s.setAttribute(t,i):s.removeAttribute(t);break;case"rowSpan":case"start":i==null||typeof i=="function"||typeof i=="symbol"||isNaN(i)?s.removeAttribute(t):s.setAttribute(t,i);break;case"popover":Je("beforetoggle",s),Je("toggle",s),uc(s,"popover",i);break;case"xlinkActuate":Fa(s,"http://www.w3.org/1999/xlink","xlink:actuate",i);break;case"xlinkArcrole":Fa(s,"http://www.w3.org/1999/xlink","xlink:arcrole",i);break;case"xlinkRole":Fa(s,"http://www.w3.org/1999/xlink","xlink:role",i);break;case"xlinkShow":Fa(s,"http://www.w3.org/1999/xlink","xlink:show",i);break;case"xlinkTitle":Fa(s,"http://www.w3.org/1999/xlink","xlink:title",i);break;case"xlinkType":Fa(s,"http://www.w3.org/1999/xlink","xlink:type",i);break;case"xmlBase":Fa(s,"http://www.w3.org/XML/1998/namespace","xml:base",i);break;case"xmlLang":Fa(s,"http://www.w3.org/XML/1998/namespace","xml:lang",i);break;case"xmlSpace":Fa(s,"http://www.w3.org/XML/1998/namespace","xml:space",i);break;case"is":uc(s,"is",i);break;case"innerText":case"textContent":break;default:(!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(t=w1.get(t)||t,uc(s,t,i))}}function $f(s,e,t,i,a,n){switch(t){case"style":Db(s,i,n);break;case"dangerouslySetInnerHTML":if(i!=null){if(typeof i!="object"||!("__html"in i))throw Error(W(61));if(t=i.__html,t!=null){if(a.children!=null)throw Error(W(60));s.innerHTML=t}}break;case"children":typeof i=="string"?_o(s,i):(typeof i=="number"||typeof i=="bigint")&&_o(s,""+i);break;case"onScroll":i!=null&&Je("scroll",s);break;case"onScrollEnd":i!=null&&Je("scrollend",s);break;case"onClick":i!=null&&(s.onclick=Qa);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!_b.hasOwnProperty(t))e:{if(t[0]==="o"&&t[1]==="n"&&(a=t.endsWith("Capture"),e=t.slice(2,a?t.length-7:void 0),n=s[_s]||null,n=n!=null?n[t]:null,typeof n=="function"&&s.removeEventListener(e,n,a),typeof i=="function")){typeof n!="function"&&n!==null&&(t in s?s[t]=null:s.hasAttribute(t)&&s.removeAttribute(t)),s.addEventListener(e,i,a);break e}t in s?s[t]=i:i===!0?s.setAttribute(t,""):uc(s,t,i)}}}function Gi(s,e,t){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Je("error",s),Je("load",s);var i=!1,a=!1,n;for(n in t)if(t.hasOwnProperty(n)){var r=t[n];if(r!=null)switch(n){case"src":i=!0;break;case"srcSet":a=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(W(137,e));default:xt(s,e,n,r,t,null)}}a&&xt(s,e,"srcSet",t.srcSet,t,null),i&&xt(s,e,"src",t.src,t,null);return;case"input":Je("invalid",s);var o=n=r=a=null,l=null,h=null;for(i in t)if(t.hasOwnProperty(i)){var c=t[i];if(c!=null)switch(i){case"name":a=c;break;case"type":r=c;break;case"checked":l=c;break;case"defaultChecked":h=c;break;case"value":n=c;break;case"defaultValue":o=c;break;case"children":case"dangerouslySetInnerHTML":if(c!=null)throw Error(W(137,e));break;default:xt(s,e,i,c,t,null)}}vb(s,n,o,l,h,r,a,!1);return;case"select":Je("invalid",s),i=r=n=null;for(a in t)if(t.hasOwnProperty(a)&&(o=t[a],o!=null))switch(a){case"value":n=o;break;case"defaultValue":r=o;break;case"multiple":i=o;default:xt(s,e,a,o,t,null)}e=n,t=r,s.multiple=!!i,e!=null?go(s,!!i,e,!1):t!=null&&go(s,!!i,t,!0);return;case"textarea":Je("invalid",s),n=a=i=null;for(r in t)if(t.hasOwnProperty(r)&&(o=t[r],o!=null))switch(r){case"value":i=o;break;case"defaultValue":a=o;break;case"children":n=o;break;case"dangerouslySetInnerHTML":if(o!=null)throw Error(W(91));break;default:xt(s,e,r,o,t,null)}Eb(s,i,a,n);return;case"option":for(l in t)if(t.hasOwnProperty(l)&&(i=t[l],i!=null))switch(l){case"selected":s.selected=i&&typeof i!="function"&&typeof i!="symbol";break;default:xt(s,e,l,i,t,null)}return;case"dialog":Je("beforetoggle",s),Je("toggle",s),Je("cancel",s),Je("close",s);break;case"iframe":case"object":Je("load",s);break;case"video":case"audio":for(i=0;i<eh.length;i++)Je(eh[i],s);break;case"image":Je("error",s),Je("load",s);break;case"details":Je("toggle",s);break;case"embed":case"source":case"link":Je("error",s),Je("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(h in t)if(t.hasOwnProperty(h)&&(i=t[h],i!=null))switch(h){case"children":case"dangerouslySetInnerHTML":throw Error(W(137,e));default:xt(s,e,h,i,t,null)}return;default:if(Ip(e)){for(c in t)t.hasOwnProperty(c)&&(i=t[c],i!==void 0&&$f(s,e,c,i,t,void 0));return}}for(o in t)t.hasOwnProperty(o)&&(i=t[o],i!=null&&xt(s,e,o,i,t,null))}function qN(s,e,t,i){switch(e){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var a=null,n=null,r=null,o=null,l=null,h=null,c=null;for(p in t){var d=t[p];if(t.hasOwnProperty(p)&&d!=null)switch(p){case"checked":break;case"value":break;case"defaultValue":l=d;default:i.hasOwnProperty(p)||xt(s,e,p,null,i,d)}}for(var f in i){var p=i[f];if(d=t[f],i.hasOwnProperty(f)&&(p!=null||d!=null))switch(f){case"type":n=p;break;case"name":a=p;break;case"checked":h=p;break;case"defaultChecked":c=p;break;case"value":r=p;break;case"defaultValue":o=p;break;case"children":case"dangerouslySetInnerHTML":if(p!=null)throw Error(W(137,e));break;default:p!==d&&xt(s,e,f,p,i,d)}}Tf(s,r,o,l,h,c,n,a);return;case"select":p=r=o=f=null;for(n in t)if(l=t[n],t.hasOwnProperty(n)&&l!=null)switch(n){case"value":break;case"multiple":p=l;default:i.hasOwnProperty(n)||xt(s,e,n,null,i,l)}for(a in i)if(n=i[a],l=t[a],i.hasOwnProperty(a)&&(n!=null||l!=null))switch(a){case"value":f=n;break;case"defaultValue":o=n;break;case"multiple":r=n;default:n!==l&&xt(s,e,a,n,i,l)}e=o,t=r,i=p,f!=null?go(s,!!t,f,!1):!!i!=!!t&&(e!=null?go(s,!!t,e,!0):go(s,!!t,t?[]:"",!1));return;case"textarea":p=f=null;for(o in t)if(a=t[o],t.hasOwnProperty(o)&&a!=null&&!i.hasOwnProperty(o))switch(o){case"value":break;case"children":break;default:xt(s,e,o,null,i,a)}for(r in i)if(a=i[r],n=t[r],i.hasOwnProperty(r)&&(a!=null||n!=null))switch(r){case"value":f=a;break;case"defaultValue":p=a;break;case"children":break;case"dangerouslySetInnerHTML":if(a!=null)throw Error(W(91));break;default:a!==n&&xt(s,e,r,a,i,n)}Cb(s,f,p);return;case"option":for(var g in t)if(f=t[g],t.hasOwnProperty(g)&&f!=null&&!i.hasOwnProperty(g))switch(g){case"selected":s.selected=!1;break;default:xt(s,e,g,null,i,f)}for(l in i)if(f=i[l],p=t[l],i.hasOwnProperty(l)&&f!==p&&(f!=null||p!=null))switch(l){case"selected":s.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:xt(s,e,l,f,i,p)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var m in t)f=t[m],t.hasOwnProperty(m)&&f!=null&&!i.hasOwnProperty(m)&&xt(s,e,m,null,i,f);for(h in i)if(f=i[h],p=t[h],i.hasOwnProperty(h)&&f!==p&&(f!=null||p!=null))switch(h){case"children":case"dangerouslySetInnerHTML":if(f!=null)throw Error(W(137,e));break;default:xt(s,e,h,f,i,p)}return;default:if(Ip(e)){for(var T in t)f=t[T],t.hasOwnProperty(T)&&f!==void 0&&!i.hasOwnProperty(T)&&$f(s,e,T,void 0,i,f);for(c in i)f=i[c],p=t[c],!i.hasOwnProperty(c)||f===p||f===void 0&&p===void 0||$f(s,e,c,f,i,p);return}}for(var S in t)f=t[S],t.hasOwnProperty(S)&&f!=null&&!i.hasOwnProperty(S)&&xt(s,e,S,null,i,f);for(d in i)f=i[d],p=t[d],!i.hasOwnProperty(d)||f===p||f==null&&p==null||xt(s,e,d,f,i,p)}function py(s){switch(s){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function JN(){if(typeof performance.getEntriesByType=="function"){for(var s=0,e=0,t=performance.getEntriesByType("resource"),i=0;i<t.length;i++){var a=t[i],n=a.transferSize,r=a.initiatorType,o=a.duration;if(n&&o&&py(r)){for(r=0,o=a.responseEnd,i+=1;i<t.length;i++){var l=t[i],h=l.startTime;if(h>o)break;var c=l.transferSize,d=l.initiatorType;c&&py(d)&&(l=l.responseEnd,r+=c*(l<o?1:(o-h)/(l-h)))}if(--i,e+=8*(n+r)/(a.duration/1e3),s++,10<s)break}}if(0<s)return e/s/1e6}return navigator.connection&&(s=navigator.connection.downlink,typeof s=="number")?s:5}var Zf=null,jf=null;function Kc(s){return s.nodeType===9?s:s.ownerDocument}function gy(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Fw(s,e){if(s===0)switch(e){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&e==="foreignObject"?0:s}function ep(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.children=="bigint"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var $d=null;function QN(){var s=window.event;return s&&s.type==="popstate"?s===$d?!1:($d=s,!0):($d=null,!1)}var Mw=typeof setTimeout=="function"?setTimeout:void 0,KN=typeof clearTimeout=="function"?clearTimeout:void 0,my=typeof Promise=="function"?Promise:void 0,$N=typeof queueMicrotask=="function"?queueMicrotask:typeof my<"u"?function(s){return my.resolve(null).then(s).catch(ZN)}:Mw;function ZN(s){setTimeout(function(){throw s})}function rr(s){return s==="head"}function yy(s,e){var t=e,i=0;do{var a=t.nextSibling;if(s.removeChild(t),a&&a.nodeType===8)if(t=a.data,t==="/$"||t==="/&"){if(i===0){s.removeChild(a),Lo(e);return}i--}else if(t==="$"||t==="$?"||t==="$~"||t==="$!"||t==="&")i++;else if(t==="html")Pl(s.ownerDocument.documentElement);else if(t==="head"){t=s.ownerDocument.head,Pl(t);for(var n=t.firstChild;n;){var r=n.nextSibling,o=n.nodeName;n[xh]||o==="SCRIPT"||o==="STYLE"||o==="LINK"&&n.rel.toLowerCase()==="stylesheet"||t.removeChild(n),n=r}}else t==="body"&&Pl(s.ownerDocument.body);t=a}while(t);Lo(e)}function by(s,e){var t=s;s=0;do{var i=t.nextSibling;if(t.nodeType===1?e?(t._stashedDisplay=t.style.display,t.style.display="none"):(t.style.display=t._stashedDisplay||"",t.getAttribute("style")===""&&t.removeAttribute("style")):t.nodeType===3&&(e?(t._stashedText=t.nodeValue,t.nodeValue=""):t.nodeValue=t._stashedText||""),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(s===0)break;s--}else t!=="$"&&t!=="$?"&&t!=="$~"&&t!=="$!"||s++;t=i}while(t)}function tp(s){var e=s.firstChild;for(e&&e.nodeType===10&&(e=e.nextSibling);e;){var t=e;switch(e=e.nextSibling,t.nodeName){case"HTML":case"HEAD":case"BODY":tp(t),Op(t);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(t.rel.toLowerCase()==="stylesheet")continue}s.removeChild(t)}}function jN(s,e,t,i){for(;s.nodeType===1;){var a=t;if(s.nodeName.toLowerCase()!==e.toLowerCase()){if(!i&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(i){if(!s[xh])switch(e){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(n=s.getAttribute("rel"),n==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(n!==a.rel||s.getAttribute("href")!==(a.href==null||a.href===""?null:a.href)||s.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin)||s.getAttribute("title")!==(a.title==null?null:a.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(n=s.getAttribute("src"),(n!==(a.src==null?null:a.src)||s.getAttribute("type")!==(a.type==null?null:a.type)||s.getAttribute("crossorigin")!==(a.crossOrigin==null?null:a.crossOrigin))&&n&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(e==="input"&&s.type==="hidden"){var n=a.name==null?null:""+a.name;if(a.type==="hidden"&&s.getAttribute("name")===n)return s}else return s;if(s=ea(s.nextSibling),s===null)break}return null}function ex(s,e,t){if(e==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!t||(s=ea(s.nextSibling),s===null))return null;return s}function Rw(s,e){for(;s.nodeType!==8;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!e||(s=ea(s.nextSibling),s===null))return null;return s}function ip(s){return s.data==="$?"||s.data==="$~"}function sp(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState!=="loading"}function tx(s,e){var t=s.ownerDocument;if(s.data==="$~")s._reactRetry=e;else if(s.data!=="$?"||t.readyState!=="loading")e();else{var i=function(){e(),t.removeEventListener("DOMContentLoaded",i)};t.addEventListener("DOMContentLoaded",i),s._reactRetry=i}}function ea(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?"||e==="$~"||e==="&"||e==="F!"||e==="F")break;if(e==="/$"||e==="/&")return null}}return s}var ap=null;function Sy(s){s=s.nextSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="/$"||t==="/&"){if(e===0)return ea(s.nextSibling);e--}else t!=="$"&&t!=="$!"&&t!=="$?"&&t!=="$~"&&t!=="&"||e++}s=s.nextSibling}return null}function wy(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="$"||t==="$!"||t==="$?"||t==="$~"||t==="&"){if(e===0)return s;e--}else t!=="/$"&&t!=="/&"||e++}s=s.previousSibling}return null}function Ow(s,e,t){switch(e=Kc(t),s){case"html":if(s=e.documentElement,!s)throw Error(W(452));return s;case"head":if(s=e.head,!s)throw Error(W(453));return s;case"body":if(s=e.body,!s)throw Error(W(454));return s;default:throw Error(W(451))}}function Pl(s){for(var e=s.attributes;e.length;)s.removeAttributeNode(e[0]);Op(s)}var ta=new Map,ky=new Set;function $c(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var gn=ft.d;ft.d={f:ix,r:sx,D:ax,C:nx,L:rx,m:ox,X:hx,S:lx,M:cx};function ix(){var s=gn.f(),e=Qu();return s||e}function sx(s){var e=Go(s);e!==null&&e.tag===5&&e.type==="form"?DS(e):gn.r(s)}var qo=typeof document>"u"?null:document;function Iw(s,e,t){var i=qo;if(i&&typeof e=="string"&&e){var a=Qs(e);a='link[rel="'+s+'"][href="'+a+'"]',typeof t=="string"&&(a+='[crossorigin="'+t+'"]'),ky.has(a)||(ky.add(a),s={rel:s,crossOrigin:t,href:e},i.querySelector(a)===null&&(e=i.createElement("link"),Gi(e,"link",s),Fi(e),i.head.appendChild(e)))}}function ax(s){gn.D(s),Iw("dns-prefetch",s,null)}function nx(s,e){gn.C(s,e),Iw("preconnect",s,e)}function rx(s,e,t){gn.L(s,e,t);var i=qo;if(i&&s&&e){var a='link[rel="preload"][as="'+Qs(e)+'"]';e==="image"&&t&&t.imageSrcSet?(a+='[imagesrcset="'+Qs(t.imageSrcSet)+'"]',typeof t.imageSizes=="string"&&(a+='[imagesizes="'+Qs(t.imageSizes)+'"]')):a+='[href="'+Qs(s)+'"]';var n=a;switch(e){case"style":n=Po(s);break;case"script":n=Jo(s)}ta.has(n)||(s=zt({rel:"preload",href:e==="image"&&t&&t.imageSrcSet?void 0:s,as:e},t),ta.set(n,s),i.querySelector(a)!==null||e==="style"&&i.querySelector(Lh(n))||e==="script"&&i.querySelector(Ah(n))||(e=i.createElement("link"),Gi(e,"link",s),Fi(e),i.head.appendChild(e)))}}function ox(s,e){gn.m(s,e);var t=qo;if(t&&s){var i=e&&typeof e.as=="string"?e.as:"script",a='link[rel="modulepreload"][as="'+Qs(i)+'"][href="'+Qs(s)+'"]',n=a;switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":n=Jo(s)}if(!ta.has(n)&&(s=zt({rel:"modulepreload",href:s},e),ta.set(n,s),t.querySelector(a)===null)){switch(i){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(t.querySelector(Ah(n)))return}i=t.createElement("link"),Gi(i,"link",s),Fi(i),t.head.appendChild(i)}}}function lx(s,e,t){gn.S(s,e,t);var i=qo;if(i&&s){var a=po(i).hoistableStyles,n=Po(s);e=e||"default";var r=a.get(n);if(!r){var o={loading:0,preload:null};if(r=i.querySelector(Lh(n)))o.loading=5;else{s=zt({rel:"stylesheet",href:s,"data-precedence":e},t),(t=ta.get(n))&&Tg(s,t);var l=r=i.createElement("link");Fi(l),Gi(l,"link",s),l._p=new Promise(function(h,c){l.onload=h,l.onerror=c}),l.addEventListener("load",function(){o.loading|=1}),l.addEventListener("error",function(){o.loading|=2}),o.loading|=4,Tc(r,e,i)}r={type:"stylesheet",instance:r,count:1,state:o},a.set(n,r)}}}function hx(s,e){gn.X(s,e);var t=qo;if(t&&s){var i=po(t).hoistableScripts,a=Jo(s),n=i.get(a);n||(n=t.querySelector(Ah(a)),n||(s=zt({src:s,async:!0},e),(e=ta.get(a))&&Bg(s,e),n=t.createElement("script"),Fi(n),Gi(n,"link",s),t.head.appendChild(n)),n={type:"script",instance:n,count:1,state:null},i.set(a,n))}}function cx(s,e){gn.M(s,e);var t=qo;if(t&&s){var i=po(t).hoistableScripts,a=Jo(s),n=i.get(a);n||(n=t.querySelector(Ah(a)),n||(s=zt({src:s,async:!0,type:"module"},e),(e=ta.get(a))&&Bg(s,e),n=t.createElement("script"),Fi(n),Gi(n,"link",s),t.head.appendChild(n)),n={type:"script",instance:n,count:1,state:null},i.set(a,n))}}function Ty(s,e,t,i){var a=(a=In.current)?$c(a):null;if(!a)throw Error(W(446));switch(s){case"meta":case"title":return null;case"style":return typeof t.precedence=="string"&&typeof t.href=="string"?(e=Po(t.href),t=po(a).hoistableStyles,i=t.get(e),i||(i={type:"style",instance:null,count:0,state:null},t.set(e,i)),i):{type:"void",instance:null,count:0,state:null};case"link":if(t.rel==="stylesheet"&&typeof t.href=="string"&&typeof t.precedence=="string"){s=Po(t.href);var n=po(a).hoistableStyles,r=n.get(s);if(r||(a=a.ownerDocument||a,r={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},n.set(s,r),(n=a.querySelector(Lh(s)))&&!n._p&&(r.instance=n,r.state.loading=5),ta.has(s)||(t={rel:"preload",as:"style",href:t.href,crossOrigin:t.crossOrigin,integrity:t.integrity,media:t.media,hrefLang:t.hrefLang,referrerPolicy:t.referrerPolicy},ta.set(s,t),n||ux(a,s,t,r.state))),e&&i===null)throw Error(W(528,""));return r}if(e&&i!==null)throw Error(W(529,""));return null;case"script":return e=t.async,t=t.src,typeof t=="string"&&e&&typeof e!="function"&&typeof e!="symbol"?(e=Jo(t),t=po(a).hoistableScripts,i=t.get(e),i||(i={type:"script",instance:null,count:0,state:null},t.set(e,i)),i):{type:"void",instance:null,count:0,state:null};default:throw Error(W(444,s))}}function Po(s){return'href="'+Qs(s)+'"'}function Lh(s){return'link[rel="stylesheet"]['+s+"]"}function Hw(s){return zt({},s,{"data-precedence":s.precedence,precedence:null})}function ux(s,e,t,i){s.querySelector('link[rel="preload"][as="style"]['+e+"]")?i.loading=1:(e=s.createElement("link"),i.preload=e,e.addEventListener("load",function(){return i.loading|=1}),e.addEventListener("error",function(){return i.loading|=2}),Gi(e,"link",t),Fi(e),s.head.appendChild(e))}function Jo(s){return'[src="'+Qs(s)+'"]'}function Ah(s){return"script[async]"+s}function By(s,e,t){if(e.count++,e.instance===null)switch(e.type){case"style":var i=s.querySelector('style[data-href~="'+Qs(t.href)+'"]');if(i)return e.instance=i,Fi(i),i;var a=zt({},t,{"data-href":t.href,"data-precedence":t.precedence,href:null,precedence:null});return i=(s.ownerDocument||s).createElement("style"),Fi(i),Gi(i,"style",a),Tc(i,t.precedence,s),e.instance=i;case"stylesheet":a=Po(t.href);var n=s.querySelector(Lh(a));if(n)return e.state.loading|=4,e.instance=n,Fi(n),n;i=Hw(t),(a=ta.get(a))&&Tg(i,a),n=(s.ownerDocument||s).createElement("link"),Fi(n);var r=n;return r._p=new Promise(function(o,l){r.onload=o,r.onerror=l}),Gi(n,"link",i),e.state.loading|=4,Tc(n,t.precedence,s),e.instance=n;case"script":return n=Jo(t.src),(a=s.querySelector(Ah(n)))?(e.instance=a,Fi(a),a):(i=t,(a=ta.get(n))&&(i=zt({},t),Bg(i,a)),s=s.ownerDocument||s,a=s.createElement("script"),Fi(a),Gi(a,"link",i),s.head.appendChild(a),e.instance=a);case"void":return null;default:throw Error(W(443,e.type))}else e.type==="stylesheet"&&!(e.state.loading&4)&&(i=e.instance,e.state.loading|=4,Tc(i,t.precedence,s));return e.instance}function Tc(s,e,t){for(var i=t.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),a=i.length?i[i.length-1]:null,n=a,r=0;r<i.length;r++){var o=i[r];if(o.dataset.precedence===e)n=o;else if(n!==a)break}n?n.parentNode.insertBefore(s,n.nextSibling):(e=t.nodeType===9?t.head:t,e.insertBefore(s,e.firstChild))}function Tg(s,e){s.crossOrigin==null&&(s.crossOrigin=e.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=e.referrerPolicy),s.title==null&&(s.title=e.title)}function Bg(s,e){s.crossOrigin==null&&(s.crossOrigin=e.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=e.referrerPolicy),s.integrity==null&&(s.integrity=e.integrity)}var Bc=null;function _y(s,e,t){if(Bc===null){var i=new Map,a=Bc=new Map;a.set(t,i)}else a=Bc,i=a.get(t),i||(i=new Map,a.set(t,i));if(i.has(s))return i;for(i.set(s,null),t=t.getElementsByTagName(s),a=0;a<t.length;a++){var n=t[a];if(!(n[xh]||n[Vi]||s==="link"&&n.getAttribute("rel")==="stylesheet")&&n.namespaceURI!=="http://www.w3.org/2000/svg"){var r=n.getAttribute(e)||"";r=s+r;var o=i.get(r);o?o.push(n):i.set(r,[n])}}return i}function Ny(s,e,t){s=s.ownerDocument||s,s.head.insertBefore(t,e==="title"?s.querySelector("head > title"):null)}function dx(s,e,t){if(t===1||e.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof e.precedence!="string"||typeof e.href!="string"||e.href==="")break;return!0;case"link":if(typeof e.rel!="string"||typeof e.href!="string"||e.href===""||e.onLoad||e.onError)break;switch(e.rel){case"stylesheet":return s=e.disabled,typeof e.precedence=="string"&&s==null;default:return!0}case"script":if(e.async&&typeof e.async!="function"&&typeof e.async!="symbol"&&!e.onLoad&&!e.onError&&e.src&&typeof e.src=="string")return!0}return!1}function Vw(s){return!(s.type==="stylesheet"&&!(s.state.loading&3))}function fx(s,e,t,i){if(t.type==="stylesheet"&&(typeof i.media!="string"||matchMedia(i.media).matches!==!1)&&!(t.state.loading&4)){if(t.instance===null){var a=Po(i.href),n=e.querySelector(Lh(a));if(n){e=n._p,e!==null&&typeof e=="object"&&typeof e.then=="function"&&(s.count++,s=Zc.bind(s),e.then(s,s)),t.state.loading|=4,t.instance=n,Fi(n);return}n=e.ownerDocument||e,i=Hw(i),(a=ta.get(a))&&Tg(i,a),n=n.createElement("link"),Fi(n);var r=n;r._p=new Promise(function(o,l){r.onload=o,r.onerror=l}),Gi(n,"link",i),t.instance=n}s.stylesheets===null&&(s.stylesheets=new Map),s.stylesheets.set(t,e),(e=t.state.preload)&&!(t.state.loading&3)&&(s.count++,t=Zc.bind(s),e.addEventListener("load",t),e.addEventListener("error",t))}}var Zd=0;function px(s,e){return s.stylesheets&&s.count===0&&_c(s,s.stylesheets),0<s.count||0<s.imgCount?function(t){var i=setTimeout(function(){if(s.stylesheets&&_c(s,s.stylesheets),s.unsuspend){var n=s.unsuspend;s.unsuspend=null,n()}},6e4+e);0<s.imgBytes&&Zd===0&&(Zd=62500*JN());var a=setTimeout(function(){if(s.waitingForImages=!1,s.count===0&&(s.stylesheets&&_c(s,s.stylesheets),s.unsuspend)){var n=s.unsuspend;s.unsuspend=null,n()}},(s.imgBytes>Zd?50:800)+e);return s.unsuspend=t,function(){s.unsuspend=null,clearTimeout(i),clearTimeout(a)}}:null}function Zc(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)_c(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var jc=null;function _c(s,e){s.stylesheets=null,s.unsuspend!==null&&(s.count++,jc=new Map,e.forEach(gx,s),jc=null,Zc.call(s))}function gx(s,e){if(!(e.state.loading&4)){var t=jc.get(s);if(t)var i=t.get(null);else{t=new Map,jc.set(s,t);for(var a=s.querySelectorAll("link[data-precedence],style[data-precedence]"),n=0;n<a.length;n++){var r=a[n];(r.nodeName==="LINK"||r.getAttribute("media")!=="not all")&&(t.set(r.dataset.precedence,r),i=r)}i&&t.set(null,i)}a=e.instance,r=a.getAttribute("data-precedence"),n=t.get(r)||i,n===i&&t.set(null,a),t.set(r,a),this.count++,i=Zc.bind(this),a.addEventListener("load",i),a.addEventListener("error",i),n?n.parentNode.insertBefore(a,n.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(a,s.firstChild)),e.state.loading|=4}}var ih={$$typeof:Ja,Provider:null,Consumer:null,_currentValue:kr,_currentValue2:kr,_threadCount:0};function mx(s,e,t,i,a,n,r,o,l){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=kd(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=kd(0),this.hiddenUpdates=kd(null),this.identifierPrefix=i,this.onUncaughtError=a,this.onCaughtError=n,this.onRecoverableError=r,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function Ww(s,e,t,i,a,n,r,o,l,h,c,d){return s=new mx(s,e,t,r,l,h,c,d,o),e=1,n===!0&&(e|=24),n=Fs(3,null,null,e),s.current=n,n.stateNode=s,e=Qp(),e.refCount++,s.pooledCache=e,e.refCount++,n.memoizedState={element:i,isDehydrated:t,cache:e},Zp(n),s}function zw(s){return s?(s=no,s):no}function Gw(s,e,t,i,a,n){a=zw(a),i.context===null?i.context=a:i.pendingContext=a,i=Vn(e),i.payload={element:t},n=n===void 0?null:n,n!==null&&(i.callback=n),t=Wn(s,i,e),t!==null&&(Ts(t,s,e),Bl(t,s,e))}function xy(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var t=s.retryLane;s.retryLane=t!==0&&t<e?t:e}}function _g(s,e){xy(s,e),(s=s.alternate)&&xy(s,e)}function Uw(s){if(s.tag===13||s.tag===31){var e=Wr(s,67108864);e!==null&&Ts(e,s,67108864),_g(s,67108864)}}function vy(s){if(s.tag===13||s.tag===31){var e=Hs();e=Mp(e);var t=Wr(s,e);t!==null&&Ts(t,s,e),_g(s,e)}}var eu=!0;function yx(s,e,t,i){var a=Oe.T;Oe.T=null;var n=ft.p;try{ft.p=2,Ng(s,e,t,i)}finally{ft.p=n,Oe.T=a}}function bx(s,e,t,i){var a=Oe.T;Oe.T=null;var n=ft.p;try{ft.p=8,Ng(s,e,t,i)}finally{ft.p=n,Oe.T=a}}function Ng(s,e,t,i){if(eu){var a=np(i);if(a===null)Kd(s,e,i,tu,t),Cy(s,i);else if(wx(a,s,e,t,i))i.stopPropagation();else if(Cy(s,i),e&4&&-1<Sx.indexOf(s)){for(;a!==null;){var n=Go(a);if(n!==null)switch(n.tag){case 3:if(n=n.stateNode,n.current.memoizedState.isDehydrated){var r=dr(n.pendingLanes);if(r!==0){var o=n;for(o.pendingLanes|=2,o.entangledLanes|=2;r;){var l=1<<31-Is(r);o.entanglements[1]|=l,r&=~l}Pa(n),!(dt&6)&&(Uc=Rs()+500,Ph(0))}}break;case 31:case 13:o=Wr(n,2),o!==null&&Ts(o,n,2),Qu(),_g(n,2)}if(n=np(i),n===null&&Kd(s,e,i,tu,t),n===a)break;a=n}a!==null&&i.stopPropagation()}else Kd(s,e,i,null,t)}}function np(s){return s=Hp(s),xg(s)}var tu=null;function xg(s){if(tu=null,s=jr(s),s!==null){var e=Th(s);if(e===null)s=null;else{var t=e.tag;if(t===13){if(s=cb(e),s!==null)return s;s=null}else if(t===31){if(s=ub(e),s!==null)return s;s=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null)}}return tu=s,null}function Yw(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(a1()){case gb:return 2;case mb:return 8;case Dc:case n1:return 32;case yb:return 268435456;default:return 32}default:return 32}}var rp=!1,Un=null,Yn=null,Xn=null,sh=new Map,ah=new Map,Cn=[],Sx="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Cy(s,e){switch(s){case"focusin":case"focusout":Un=null;break;case"dragenter":case"dragleave":Yn=null;break;case"mouseover":case"mouseout":Xn=null;break;case"pointerover":case"pointerout":sh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ah.delete(e.pointerId)}}function nl(s,e,t,i,a,n){return s===null||s.nativeEvent!==n?(s={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:n,targetContainers:[a]},e!==null&&(e=Go(e),e!==null&&Uw(e)),s):(s.eventSystemFlags|=i,e=s.targetContainers,a!==null&&e.indexOf(a)===-1&&e.push(a),s)}function wx(s,e,t,i,a){switch(e){case"focusin":return Un=nl(Un,s,e,t,i,a),!0;case"dragenter":return Yn=nl(Yn,s,e,t,i,a),!0;case"mouseover":return Xn=nl(Xn,s,e,t,i,a),!0;case"pointerover":var n=a.pointerId;return sh.set(n,nl(sh.get(n)||null,s,e,t,i,a)),!0;case"gotpointercapture":return n=a.pointerId,ah.set(n,nl(ah.get(n)||null,s,e,t,i,a)),!0}return!1}function Xw(s){var e=jr(s.target);if(e!==null){var t=Th(e);if(t!==null){if(e=t.tag,e===13){if(e=cb(t),e!==null){s.blockedOn=e,dm(s.priority,function(){vy(t)});return}}else if(e===31){if(e=ub(t),e!==null){s.blockedOn=e,dm(s.priority,function(){vy(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){s.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Nc(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var t=np(s.nativeEvent);if(t===null){t=s.nativeEvent;var i=new t.constructor(t.type,t);_f=i,t.target.dispatchEvent(i),_f=null}else return e=Go(t),e!==null&&Uw(e),s.blockedOn=t,!1;e.shift()}return!0}function Ey(s,e,t){Nc(s)&&t.delete(e)}function kx(){rp=!1,Un!==null&&Nc(Un)&&(Un=null),Yn!==null&&Nc(Yn)&&(Yn=null),Xn!==null&&Nc(Xn)&&(Xn=null),sh.forEach(Ey),ah.forEach(Ey)}function sc(s,e){s.blockedOn===e&&(s.blockedOn=null,rp||(rp=!0,Ei.unstable_scheduleCallback(Ei.unstable_NormalPriority,kx)))}var ac=null;function Dy(s){ac!==s&&(ac=s,Ei.unstable_scheduleCallback(Ei.unstable_NormalPriority,function(){ac===s&&(ac=null);for(var e=0;e<s.length;e+=3){var t=s[e],i=s[e+1],a=s[e+2];if(typeof i!="function"){if(xg(i||t)===null)continue;break}var n=Go(t);n!==null&&(s.splice(e,3),e-=3,Vf(n,{pending:!0,data:a,method:t.method,action:i},i,a))}}))}function Lo(s){function e(l){return sc(l,s)}Un!==null&&sc(Un,s),Yn!==null&&sc(Yn,s),Xn!==null&&sc(Xn,s),sh.forEach(e),ah.forEach(e);for(var t=0;t<Cn.length;t++){var i=Cn[t];i.blockedOn===s&&(i.blockedOn=null)}for(;0<Cn.length&&(t=Cn[0],t.blockedOn===null);)Xw(t),t.blockedOn===null&&Cn.shift();if(t=(s.ownerDocument||s).$$reactFormReplay,t!=null)for(i=0;i<t.length;i+=3){var a=t[i],n=t[i+1],r=a[_s]||null;if(typeof n=="function")r||Dy(t);else if(r){var o=null;if(n&&n.hasAttribute("formAction")){if(a=n,r=n[_s]||null)o=r.formAction;else if(xg(a)!==null)continue}else o=r.action;typeof o=="function"?t[i+1]=o:(t.splice(i,3),i-=3),Dy(t)}}}function qw(){function s(n){n.canIntercept&&n.info==="react-transition"&&n.intercept({handler:function(){return new Promise(function(r){return a=r})},focusReset:"manual",scroll:"manual"})}function e(){a!==null&&(a(),a=null),i||setTimeout(t,20)}function t(){if(!i&&!navigation.transition){var n=navigation.currentEntry;n&&n.url!=null&&navigation.navigate(n.url,{state:n.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var i=!1,a=null;return navigation.addEventListener("navigate",s),navigation.addEventListener("navigatesuccess",e),navigation.addEventListener("navigateerror",e),setTimeout(t,100),function(){i=!0,navigation.removeEventListener("navigate",s),navigation.removeEventListener("navigatesuccess",e),navigation.removeEventListener("navigateerror",e),a!==null&&(a(),a=null)}}}function vg(s){this._internalRoot=s}Zu.prototype.render=vg.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error(W(409));var t=e.current,i=Hs();Gw(t,i,s,e,null,null)};Zu.prototype.unmount=vg.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;Gw(s.current,2,null,s,null,null),Qu(),e[zo]=null}};function Zu(s){this._internalRoot=s}Zu.prototype.unstable_scheduleHydration=function(s){if(s){var e=Tb();s={blockedOn:null,target:s,priority:e};for(var t=0;t<Cn.length&&e!==0&&e<Cn[t].priority;t++);Cn.splice(t,0,s),t===0&&Xw(s)}};var Py=lb.version;if(Py!=="19.2.0")throw Error(W(527,Py,"19.2.0"));ft.findDOMNode=function(s){var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error(W(188)):(s=Object.keys(s).join(","),Error(W(268,s)));return s=$_(e),s=s!==null?db(s):null,s=s===null?null:s.stateNode,s};var Tx={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:Oe,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var nc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!nc.isDisabled&&nc.supportsFiber)try{Bh=nc.inject(Tx),Os=nc}catch{}}Ru.createRoot=function(s,e){if(!hb(s))throw Error(W(299));var t=!1,i="",a=IS,n=HS,r=VS;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onUncaughtError!==void 0&&(a=e.onUncaughtError),e.onCaughtError!==void 0&&(n=e.onCaughtError),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Ww(s,1,!1,null,null,t,i,null,a,n,r,qw),s[zo]=e.current,kg(s),new vg(e)};Ru.hydrateRoot=function(s,e,t){if(!hb(s))throw Error(W(299));var i=!1,a="",n=IS,r=HS,o=VS,l=null;return t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(a=t.identifierPrefix),t.onUncaughtError!==void 0&&(n=t.onUncaughtError),t.onCaughtError!==void 0&&(r=t.onCaughtError),t.onRecoverableError!==void 0&&(o=t.onRecoverableError),t.formState!==void 0&&(l=t.formState)),e=Ww(s,1,!0,e,t??null,i,a,l,n,r,o,qw),e.context=zw(null),t=e.current,i=Hs(),i=Mp(i),a=Vn(i),a.callback=null,Wn(t,a,i),t=i,e.current.lanes=t,Nh(e,t),Pa(e),s[zo]=e.current,kg(s),new Zu(e)};Ru.version="19.2.0";function Jw(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Jw)}catch(s){console.error(s)}}Jw(),ob.exports=Ru;var Bx=ob.exports;/*!
 * alphaTab v1.6.3 (, build 22)
 *
 * Copyright  2025, Daniel Kuschny and Contributors, All rights reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * Integrated Libraries:
 *
 * Library: TinySoundFont
 * License: MIT
 * Copyright: Copyright (C) 2017, 2018 Bernhard Schelling
 * URL: https://github.com/schellingb/TinySoundFont
 * Purpose: SoundFont loading and Audio Synthesis
 *
 * Library: SFZero
 * License: MIT
 * Copyright: Copyright (C) 2012 Steve Folta ()
 * URL: https://github.com/stevefolta/SFZero
 * Purpose: TinySoundFont is based on SFZEro
 *
 * Library: Haxe Standard Library
 * License: MIT
 * Copyright: Copyright (C)2005-2025 Haxe Foundation
 * URL: https://github.com/HaxeFoundation/haxe/tree/development/std
 * Purpose: XML Parser & Zip Inflate Algorithm
 *
 * Library: SharpZipLib
 * License: MIT
 * Copyright: Copyright  2000-2018 SharpZipLib Contributors
 * URL: https://github.com/icsharpcode/SharpZipLib
 * Purpose: Zip Deflate Algorithm for writing compressed Zips
 *
 * Library: NVorbis
 * License: MIT
 * Copyright: Copyright (c) 2020 Andrew Ward
 * URL: https://github.com/NVorbis/NVorbis
 * Purpose: Vorbis Stream Decoding
 *
 * Library: libvorbis
 * License: BSD-3-Clause
 * Copyright: Copyright (c) 2002-2020 Xiph.org Foundation
 * URL: https://github.com/xiph/vorbis
 * Purpose: NVorbis adopted some code from libvorbis.
 *
 * @preserve
 * @license
 */class _x{constructor(e){this._targets=new Set,this._callback=e,window.addEventListener("resize",this.onWindowResize.bind(this),!1)}observe(e){this._targets.add(e)}unobserve(e){this._targets.delete(e)}disconnect(){this._targets.clear()}onWindowResize(){const e=[];for(const t of this._targets)e.push({target:t,contentRect:void 0,borderBoxSize:void 0,contentBoxSize:[],devicePixelContentBoxSize:[]});this._callback(e,this)}}class Nx{constructor(e){this._elements=[];let t=null;const i=this.check.bind(this);this.check=()=>{t||(t=setTimeout(()=>{i(),t=null},100))},this._callback=e,window.addEventListener("resize",this.check,!0),document.addEventListener("scroll",this.check,!0)}observe(e){this._elements.indexOf(e)>=0||(this._elements.push(e),this.check())}unobserve(e){this._elements=this._elements.filter(t=>t!==e)}check(){const e=[];for(const t of this._elements){const i=t.getBoundingClientRect();i.top+i.height>=0&&i.top<=window.innerHeight&&i.left+i.width>=0&&i.left<=window.innerWidth&&e.push({target:t,isIntersecting:!0})}e.length&&this._callback(e,this)}}typeof Symbol.dispose>"u"&&(Symbol.dispose=Symbol("Symbol.dispose")),typeof window<"u"&&("ResizeObserver"in globalThis||(globalThis.ResizeObserver=_x),"IntersectionObserver"in globalThis||(globalThis.IntersectionObserver=Nx),"replaceChildren"in Element.prototype||(Element.prototype.replaceChildren=function(...s){this.innerHTML="",this.append(...s)},Document.prototype.replaceChildren=Element.prototype.replaceChildren,DocumentFragment.prototype.replaceChildren=Element.prototype.replaceChildren)),"replaceAll"in String.prototype||(String.prototype.replaceAll=function(s,e){return this.replace(new RegExp(s,"g"),e)});var nn;(function(s){s[s.Page=0]="Page",s[s.Horizontal=1]="Horizontal"})(nn||(nn={}));var Ua;(function(s){s[s.Default=0]="Default",s[s.ScoreTab=1]="ScoreTab",s[s.Score=2]="Score",s[s.Tab=3]="Tab",s[s.TabMixed=4]="TabMixed"})(Ua||(Ua={}));class oa{static getValue(e){return oa._values||(oa._values=new Map),e=e.toLowerCase().replaceAll(" ",""),oa._values.has(e)?oa._values.get(e):0}static isPiano(e){return e<=7||e>=16&&e<=23}static isGuitar(e){return e>=24&&e<=39||e===105||e===43}}oa._values=new Map([["acousticgrandpiano",0],["brightacousticpiano",1],["electricgrandpiano",2],["honkytonkpiano",3],["electricpiano1",4],["electricpiano2",5],["harpsichord",6],["clavinet",7],["celesta",8],["glockenspiel",9],["musicbox",10],["vibraphone",11],["marimba",12],["xylophone",13],["tubularbells",14],["dulcimer",15],["drawbarorgan",16],["percussiveorgan",17],["rockorgan",18],["churchorgan",19],["reedorgan",20],["accordion",21],["harmonica",22],["tangoaccordion",23],["acousticguitarnylon",24],["acousticguitarsteel",25],["electricguitarjazz",26],["electricguitarclean",27],["electricguitarmuted",28],["overdrivenguitar",29],["distortionguitar",30],["guitarharmonics",31],["acousticbass",32],["electricbassfinger",33],["electricbasspick",34],["fretlessbass",35],["slapbass1",36],["slapbass2",37],["synthbass1",38],["synthbass2",39],["violin",40],["viola",41],["cello",42],["contrabass",43],["tremolostrings",44],["pizzicatostrings",45],["orchestralharp",46],["timpani",47],["stringensemble1",48],["stringensemble2",49],["synthstrings1",50],["synthstrings2",51],["choiraahs",52],["voiceoohs",53],["synthvoice",54],["orchestrahit",55],["trumpet",56],["trombone",57],["tuba",58],["mutedtrumpet",59],["frenchhorn",60],["brasssection",61],["synthbrass1",62],["synthbrass2",63],["sopranosax",64],["altosax",65],["tenorsax",66],["baritonesax",67],["oboe",68],["englishhorn",69],["bassoon",70],["clarinet",71],["piccolo",72],["flute",73],["recorder",74],["panflute",75],["blownbottle",76],["shakuhachi",77],["whistle",78],["ocarina",79],["lead1square",80],["lead2sawtooth",81],["lead3calliope",82],["lead4chiff",83],["lead5charang",84],["lead6voice",85],["lead7fifths",86],["lead8bassandlead",87],["pad1newage",88],["pad2warm",89],["pad3polysynth",90],["pad4choir",91],["pad5bowed",92],["pad6metallic",93],["pad7halo",94],["pad8sweep",95],["fx1rain",96],["fx2soundtrack",97],["fx3crystal",98],["fx4atmosphere",99],["fx5brightness",100],["fx6goblins",101],["fx7echoes",102],["fx8scifi",103],["sitar",104],["banjo",105],["shamisen",106],["koto",107],["kalimba",108],["bagpipe",109],["fiddle",110],["shanai",111],["tinklebell",112],["agogo",113],["steeldrums",114],["woodblock",115],["taikodrum",116],["melodictom",117],["synthdrum",118],["reversecymbal",119],["guitarfretnoise",120],["breathnoise",121],["seashore",122],["birdtweet",123],["telephonering",124],["helicopter",125],["applause",126],["gunshot",127]]);var la;(function(s){s[s.NoBrackets=0]="NoBrackets",s[s.GroupStaves=1]="GroupStaves",s[s.GroupSimilarInstruments=2]="GroupSimilarInstruments"})(la||(la={}));var ct;(function(s){s[s.Hidden=0]="Hidden",s[s.FirstSystem=1]="FirstSystem",s[s.AllSystems=2]="AllSystems"})(ct||(ct={}));var Si;(function(s){s[s.FullName=0]="FullName",s[s.ShortName=1]="ShortName"})(Si||(Si={}));var wi;(function(s){s[s.Horizontal=0]="Horizontal",s[s.Vertical=1]="Vertical"})(wi||(wi={}));class xx{constructor(){this.hideDynamics=!1,this.bracketExtendMode=la.GroupStaves,this.useSystemSignSeparator=!1,this.globalDisplayTuning=!0,this.perTrackDisplayTuning=null,this.globalDisplayChordDiagramsOnTop=!0,this.perTrackChordDiagramsOnTop=null,this.singleTrackTrackNamePolicy=ct.FirstSystem,this.multiTrackTrackNamePolicy=ct.FirstSystem,this.firstSystemTrackNameMode=Si.ShortName,this.otherSystemsTrackNameMode=Si.ShortName,this.firstSystemTrackNameOrientation=wi.Vertical,this.otherSystemsTrackNameOrientation=wi.Vertical,this.multiTrackMultiBarRest=!1,this.perTrackMultiBarRest=null}}class Ly{constructor(){this.masterBars=[],this.opening=null,this.closings=[],this.isClosed=!1}get openings(){const e=this.opening;return e?[e]:[]}get isOpened(){var e;return((e=this.opening)==null?void 0:e.isRepeatStart)===!0}addMasterBar(e){this.opening===null&&(this.opening=e),this.masterBars.push(e),e.repeatGroup=this,e.isRepeatEnd&&(this.closings.push(e),this.isClosed=!0)}}class Qo{constructor(){this.colors=new Map}}var xe;(function(s){s[s.Neutral=0]="Neutral",s[s.C3=1]="C3",s[s.C4=2]="C4",s[s.F4=3]="F4",s[s.G2=4]="G2"})(xe||(xe={}));var fe;(function(s){s[s._15ma=0]="_15ma",s[s._8va=1]="_8va",s[s.Regular=2]="Regular",s[s._8vb=3]="_8vb",s[s._15mb=4]="_15mb"})(fe||(fe={}));var St;(function(s){s[s.None=0]="None",s[s.Simple=1]="Simple",s[s.FirstOfDouble=2]="FirstOfDouble",s[s.SecondOfDouble=3]="SecondOfDouble"})(St||(St={}));var _e;(function(s){s[s.Cb=-7]="Cb",s[s.Gb=-6]="Gb",s[s.Db=-5]="Db",s[s.Ab=-4]="Ab",s[s.Eb=-3]="Eb",s[s.Bb=-2]="Bb",s[s.F=-1]="F",s[s.C=0]="C",s[s.G=1]="G",s[s.D=2]="D",s[s.A=3]="A",s[s.E=4]="E",s[s.B=5]="B",s[s.FSharp=6]="FSharp",s[s.CSharp=7]="CSharp"})(_e||(_e={}));var Mi;(function(s){s[s.Major=0]="Major",s[s.Minor=1]="Minor"})(Mi||(Mi={}));var Et;(function(s){s[s.Down=0]="Down",s[s.Hold=1]="Hold",s[s.Up=2]="Up"})(Et||(Et={}));class xr{constructor(){this.ratioPosition=0,this.pedalType=Et.Down,this.nextPedalMarker=null,this.previousPedalMarker=null}}var Ee;(function(s){s[s.StandardNotationRepeats=0]="StandardNotationRepeats",s[s.GuitarTabsRepeats=1]="GuitarTabsRepeats",s[s.SlashRepeats=2]="SlashRepeats",s[s.NumberedRepeats=3]="NumberedRepeats",s[s.StandardNotationBarNumber=4]="StandardNotationBarNumber",s[s.GuitarTabsBarNumber=5]="GuitarTabsBarNumber",s[s.SlashBarNumber=6]="SlashBarNumber",s[s.NumberedBarNumber=7]="NumberedBarNumber",s[s.StandardNotationBarLines=8]="StandardNotationBarLines",s[s.GuitarTabsBarLines=9]="GuitarTabsBarLines",s[s.SlashBarLines=10]="SlashBarLines",s[s.NumberedBarLines=11]="NumberedBarLines",s[s.StandardNotationClef=12]="StandardNotationClef",s[s.GuitarTabsClef=13]="GuitarTabsClef",s[s.StandardNotationKeySignature=14]="StandardNotationKeySignature",s[s.NumberedKeySignature=15]="NumberedKeySignature",s[s.StandardNotationTimeSignature=16]="StandardNotationTimeSignature",s[s.GuitarTabsTimeSignature=17]="GuitarTabsTimeSignature",s[s.SlashTimeSignature=18]="SlashTimeSignature",s[s.NumberedTimeSignature=19]="NumberedTimeSignature",s[s.StandardNotationStaffLine=20]="StandardNotationStaffLine",s[s.GuitarTabsStaffLine=21]="GuitarTabsStaffLine",s[s.SlashStaffLine=22]="SlashStaffLine",s[s.NumberedStaffLine=23]="NumberedStaffLine"})(Ee||(Ee={}));class vx extends Qo{}var oe;(function(s){s[s.Automatic=0]="Automatic",s[s.Dashed=1]="Dashed",s[s.Dotted=2]="Dotted",s[s.Heavy=3]="Heavy",s[s.HeavyHeavy=4]="HeavyHeavy",s[s.HeavyLight=5]="HeavyLight",s[s.LightHeavy=6]="LightHeavy",s[s.LightLight=7]="LightLight",s[s.None=8]="None",s[s.Regular=9]="Regular",s[s.Short=10]="Short",s[s.Tick=11]="Tick"})(oe||(oe={}));class qi{constructor(){this.id=qi._globalBarId++,this.index=0,this.nextBar=null,this.previousBar=null,this.clef=xe.G2,this.clefOttava=fe.Regular,this.voices=[],this.simileMark=St.None,this.isMultiVoice=!1,this.displayScale=1,this.displayWidth=-1,this.sustainPedals=[],this._isEmpty=!0,this._isRestOnly=!0,this.barLineLeft=oe.Automatic,this.barLineRight=oe.Automatic,this.keySignature=_e.C,this.keySignatureType=Mi.Major}static resetIds(){qi._globalBarId=0}get masterBar(){return this.staff.track.score.masterBars[this.index]}get isEmpty(){return this._isEmpty}get hasChanges(){return this.index===0||this.keySignature!==this.previousBar.keySignature||this.keySignatureType!==this.previousBar.keySignatureType||this.clef!==this.previousBar.clef||this.clefOttava!==this.previousBar.clefOttava?!0:this.simileMark!==St.None||this.sustainPedals.length>0||this.barLineLeft!==oe.Automatic||this.barLineRight!==oe.Automatic}get isRestOnly(){return this._isRestOnly}getActualBarLineLeft(e){return qi.actualBarLine(this,!1,e)}getActualBarLineRight(){return qi.actualBarLine(this,!0,!1)}static automaticToActualType(e,t,i){let a;return t?e.isRepeatEnd?a=oe.LightHeavy:e.nextMasterBar?e.isFreeTime?a=oe.Dashed:e.isDoubleBar?a=oe.LightLight:a=oe.Regular:a=oe.LightHeavy:e.isRepeatStart?a=oe.HeavyLight:i?a=oe.Regular:a=oe.None,a}static actualBarLine(e,t,i){const a=e.masterBar,n=t?e.barLineRight:e.barLineLeft;let r;return n===oe.Automatic?r=qi.automaticToActualType(a,t,i):r=n,r}addVoice(e){e.bar=this,e.index=this.voices.length,this.voices.push(e)}finish(e,t=null){this.isMultiVoice=!1,this._isEmpty=!0,this._isRestOnly=!0;for(let a=0,n=this.voices.length;a<n;a++){const r=this.voices[a];r.finish(e,t),a>0&&!r.isEmpty&&(this.isMultiVoice=!0),r.isEmpty||(this._isEmpty=!1),r.isRestOnly||(this._isRestOnly=!1)}const i=this.sustainPedals;if(i.length>0){let a=null;this.sustainPedals=[],this.previousBar&&this.previousBar.sustainPedals.length>0&&(a=this.previousBar.sustainPedals[this.previousBar.sustainPedals.length-1]);const n=a!==null&&a.pedalType!==Et.Up;for(const r of i){if(a&&a.pedalType!==Et.Up){if(a.bar===this&&r.ratioPosition<=a.ratioPosition)continue;a.nextPedalMarker=r,r.previousPedalMarker=a}n&&r.pedalType===Et.Down&&(r.pedalType=Et.Hold),r.bar=this,this.sustainPedals.push(r),a=r}}else if(this.previousBar&&this.previousBar.sustainPedals.length>0){const a=this.previousBar.sustainPedals[this.previousBar.sustainPedals.length-1];if(a.pedalType!==Et.Up){const n=new xr;n.ratioPosition=0,n.bar=this,n.pedalType=Et.Hold,this.sustainPedals.push(n),a.nextPedalMarker=n,n.previousPedalMarker=a}}}calculateDuration(){let e=0;for(const t of this.voices){const i=t.calculateDuration();i>e&&(e=i)}return e}}qi._globalBarId=0;var j;(function(s){s[s.PPP=0]="PPP",s[s.PP=1]="PP",s[s.P=2]="P",s[s.MP=3]="MP",s[s.MF=4]="MF",s[s.F=5]="F",s[s.FF=6]="FF",s[s.FFF=7]="FFF",s[s.PPPP=8]="PPPP",s[s.PPPPP=9]="PPPPP",s[s.PPPPPP=10]="PPPPPP",s[s.FFFF=11]="FFFF",s[s.FFFFF=12]="FFFFF",s[s.FFFFFF=13]="FFFFFF",s[s.SF=14]="SF",s[s.SFP=15]="SFP",s[s.SFPP=16]="SFPP",s[s.FP=17]="FP",s[s.RF=18]="RF",s[s.RFZ=19]="RFZ",s[s.SFZ=20]="SFZ",s[s.SFFZ=21]="SFFZ",s[s.FZ=22]="FZ",s[s.N=23]="N",s[s.PF=24]="PF",s[s.SFZP=25]="SFZP"})(j||(j={}));class v{static ticksToMillis(e,t){return e*(6e4/(t*v.QuarterTime))|0}static millisToTicks(e,t){return e/(6e4/(t*v.QuarterTime))|0}static toTicks(e){return v.valueToTicks(e)}static valueToTicks(e){let t=e;return t<0&&(t=1/-t),v.QuarterTime*(4/t)|0}static applyDot(e,t){return t?e+(e/4|0)*3:e+(e/2|0)}static applyTuplet(e,t,i){return e*i/t|0}static removeTuplet(e,t,i){return e*t/i|0}static dynamicToVelocity(e,t=0){let i=1;switch(e){case j.PPP:i=v.MinVelocity+0*v.VelocityIncrement;break;case j.PP:i=v.MinVelocity+1*v.VelocityIncrement;break;case j.P:i=v.MinVelocity+2*v.VelocityIncrement;break;case j.MP:i=v.MinVelocity+3*v.VelocityIncrement;break;case j.MF:i=v.MinVelocity+4*v.VelocityIncrement;break;case j.F:i=v.MinVelocity+5*v.VelocityIncrement;break;case j.FF:i=v.MinVelocity+6*v.VelocityIncrement;break;case j.FFF:i=v.MinVelocity+7*v.VelocityIncrement;break;case j.PPPP:i=10;break;case j.PPPPP:i=5;break;case j.PPPPPP:i=3;break;case j.FFFF:i=v.MinVelocity+8*v.VelocityIncrement;break;case j.FFFFF:i=v.MinVelocity+9*v.VelocityIncrement;break;case j.FFFFFF:i=v.MinVelocity+10*v.VelocityIncrement;break;case j.SF:case j.SFP:case j.SFZP:case j.SFPP:case j.SFZ:case j.FZ:i=v.MinVelocity+6*v.VelocityIncrement;break;case j.FP:i=v.MinVelocity+5*v.VelocityIncrement;break;case j.RF:case j.RFZ:case j.SFFZ:i=v.MinVelocity+5*v.VelocityIncrement;break;case j.N:i=1;break;case j.PF:i=v.MinVelocity+(4.5*v.VelocityIncrement|0);break}return i+=t*v.VelocityIncrement,Math.min(Math.max(i,1),127)}}v.QuarterTime=960;v.MinVelocity=15;v.VelocityIncrement=16;var tt;(function(s){s[s.Tempo=0]="Tempo",s[s.Volume=1]="Volume",s[s.Instrument=2]="Instrument",s[s.Balance=3]="Balance",s[s.SyncPoint=4]="SyncPoint"})(tt||(tt={}));class ju{constructor(){this.barOccurence=0,this.millisecondOffset=0}}class wt{constructor(){this.isLinear=!1,this.type=tt.Tempo,this.value=0,this.ratioPosition=0,this.text=""}static buildTempoAutomation(e,t,i,a){(a<1||a>5)&&(a=2);const n=new Float32Array([1,.5,1,1.5,2,3]),r=new wt;return r.type=tt.Tempo,r.isLinear=e,r.ratioPosition=t,r.value=i*n[a],r}static buildInstrumentAutomation(e,t,i){const a=new wt;return a.type=tt.Instrument,a.isLinear=e,a.ratioPosition=t,a.value=i,a}}class H{constructor(e=0,t=0){this.offset=e,this.value=t}}H.MaxPosition=60;H.MaxValue=12;var Xe;(function(s){s[s.Default=0]="Default",s[s.Gradual=1]="Gradual",s[s.Fast=2]="Fast"})(Xe||(Xe={}));var q;(function(s){s[s.None=0]="None",s[s.Custom=1]="Custom",s[s.Bend=2]="Bend",s[s.Release=3]="Release",s[s.BendRelease=4]="BendRelease",s[s.Hold=5]="Hold",s[s.Prebend=6]="Prebend",s[s.PrebendBend=7]="PrebendBend",s[s.PrebendRelease=8]="PrebendRelease"})(q||(q={}));var Y;(function(s){s[s.None=0]="None",s[s.BrushUp=1]="BrushUp",s[s.BrushDown=2]="BrushDown",s[s.ArpeggioUp=3]="ArpeggioUp",s[s.ArpeggioDown=4]="ArpeggioDown"})(Y||(Y={}));var vi;(function(s){s[s.None=0]="None",s[s.Crescendo=1]="Crescendo",s[s.Decrescendo=2]="Decrescendo"})(vi||(vi={}));var w;(function(s){s[s.QuadrupleWhole=-4]="QuadrupleWhole",s[s.DoubleWhole=-2]="DoubleWhole",s[s.Whole=1]="Whole",s[s.Half=2]="Half",s[s.Quarter=4]="Quarter",s[s.Eighth=8]="Eighth",s[s.Sixteenth=16]="Sixteenth",s[s.ThirtySecond=32]="ThirtySecond",s[s.SixtyFourth=64]="SixtyFourth",s[s.OneHundredTwentyEighth=128]="OneHundredTwentyEighth",s[s.TwoHundredFiftySixth=256]="TwoHundredFiftySixth"})(w||(w={}));var se;(function(s){s[s.None=0]="None",s[s.OnBeat=1]="OnBeat",s[s.BeforeBeat=2]="BeforeBeat",s[s.BendGrace=3]="BendGrace"})(se||(se={}));var _t;(function(s){s[s.None=0]="None",s[s.Normal=1]="Normal",s[s.Heavy=2]="Heavy",s[s.Tenuto=3]="Tenuto"})(_t||(_t={}));var ie;(function(s){s[s.Unknown=-2]="Unknown",s[s.NoOrDead=-1]="NoOrDead",s[s.Thumb=0]="Thumb",s[s.IndexFinger=1]="IndexFinger",s[s.MiddleFinger=2]="MiddleFinger",s[s.AnnularFinger=3]="AnnularFinger",s[s.LittleFinger=4]="LittleFinger"})(ie||(ie={}));var ae;(function(s){s[s.None=0]="None",s[s.Natural=1]="Natural",s[s.Artificial=2]="Artificial",s[s.Pinch=3]="Pinch",s[s.Tap=4]="Tap",s[s.Semi=5]="Semi",s[s.Feedback=6]="Feedback"})(ae||(ae={}));var ke;(function(s){s[s.Default=0]="Default",s[s.ForceNone=1]="ForceNone",s[s.ForceNatural=2]="ForceNatural",s[s.ForceSharp=3]="ForceSharp",s[s.ForceDoubleSharp=4]="ForceDoubleSharp",s[s.ForceFlat=5]="ForceFlat",s[s.ForceDoubleFlat=6]="ForceDoubleFlat"})(ke||(ke={}));var jt;(function(s){s[s.None=0]="None",s[s.IntoFromBelow=1]="IntoFromBelow",s[s.IntoFromAbove=2]="IntoFromAbove"})(jt||(jt={}));var pe;(function(s){s[s.None=0]="None",s[s.Shift=1]="Shift",s[s.Legato=2]="Legato",s[s.OutUp=3]="OutUp",s[s.OutDown=4]="OutDown",s[s.PickSlideDown=5]="PickSlideDown",s[s.PickSlideUp=6]="PickSlideUp"})(pe||(pe={}));var ve;(function(s){s[s.None=0]="None",s[s.Slight=1]="Slight",s[s.Wide=2]="Wide"})(ve||(ve={}));var Us;(function(s){s[s.Hidden=0]="Hidden",s[s.ShowWithBeams=1]="ShowWithBeams",s[s.ShowWithBars=2]="ShowWithBars",s[s.Automatic=3]="Automatic"})(Us||(Us={}));var ua;(function(s){s[s.ScoreDefault=0]="ScoreDefault",s[s.ScoreForcePiano=1]="ScoreForcePiano",s[s.SingleNoteEffectBand=2]="SingleNoteEffectBand",s[s.SingleNoteEffectBandForcePiano=3]="SingleNoteEffectBandForcePiano"})(ua||(ua={}));var ai;(function(s){s[s.GuitarPro=0]="GuitarPro",s[s.SongBook=1]="SongBook"})(ai||(ai={}));var be;(function(s){s[s.ScoreTitle=0]="ScoreTitle",s[s.ScoreSubTitle=1]="ScoreSubTitle",s[s.ScoreArtist=2]="ScoreArtist",s[s.ScoreAlbum=3]="ScoreAlbum",s[s.ScoreWords=4]="ScoreWords",s[s.ScoreMusic=5]="ScoreMusic",s[s.ScoreWordsAndMusic=6]="ScoreWordsAndMusic",s[s.ScoreCopyright=7]="ScoreCopyright",s[s.GuitarTuning=8]="GuitarTuning",s[s.TrackNames=9]="TrackNames",s[s.ChordDiagrams=10]="ChordDiagrams",s[s.ParenthesisOnTiedBends=11]="ParenthesisOnTiedBends",s[s.TabNotesOnTiedBends=12]="TabNotesOnTiedBends",s[s.ZerosOnDiveWhammys=13]="ZerosOnDiveWhammys",s[s.EffectAlternateEndings=14]="EffectAlternateEndings",s[s.EffectCapo=15]="EffectCapo",s[s.EffectChordNames=16]="EffectChordNames",s[s.EffectCrescendo=17]="EffectCrescendo",s[s.EffectDynamics=18]="EffectDynamics",s[s.EffectFadeIn=19]="EffectFadeIn",s[s.EffectFermata=20]="EffectFermata",s[s.EffectFingering=21]="EffectFingering",s[s.EffectHarmonics=22]="EffectHarmonics",s[s.EffectLetRing=23]="EffectLetRing",s[s.EffectLyrics=24]="EffectLyrics",s[s.EffectMarker=25]="EffectMarker",s[s.EffectOttavia=26]="EffectOttavia",s[s.EffectPalmMute=27]="EffectPalmMute",s[s.EffectPickSlide=28]="EffectPickSlide",s[s.EffectPickStroke=29]="EffectPickStroke",s[s.EffectSlightBeatVibrato=30]="EffectSlightBeatVibrato",s[s.EffectSlightNoteVibrato=31]="EffectSlightNoteVibrato",s[s.EffectTap=32]="EffectTap",s[s.EffectTempo=33]="EffectTempo",s[s.EffectText=34]="EffectText",s[s.EffectTrill=35]="EffectTrill",s[s.EffectTripletFeel=36]="EffectTripletFeel",s[s.EffectWhammyBar=37]="EffectWhammyBar",s[s.EffectWideBeatVibrato=38]="EffectWideBeatVibrato",s[s.EffectWideNoteVibrato=39]="EffectWideNoteVibrato",s[s.EffectLeftHandTap=40]="EffectLeftHandTap",s[s.EffectFreeTime=41]="EffectFreeTime",s[s.EffectSustainPedal=42]="EffectSustainPedal",s[s.EffectGolpe=43]="EffectGolpe",s[s.EffectWahPedal=44]="EffectWahPedal",s[s.EffectBeatBarre=45]="EffectBeatBarre",s[s.EffectNoteOrnament=46]="EffectNoteOrnament",s[s.EffectRasgueado=47]="EffectRasgueado",s[s.EffectDirections=48]="EffectDirections",s[s.EffectBeatTimer=49]="EffectBeatTimer"})(be||(be={}));class nh{constructor(){this.notationMode=ai.GuitarPro,this.fingeringMode=ua.ScoreDefault,this.elements=new Map,this.rhythmMode=Us.Automatic,this.rhythmHeight=15,this.transpositionPitches=[],this.displayTranspositionPitches=[],this.smallGraceTabNotes=!0,this.extendBendArrowsOnTiedNotes=!0,this.extendLineEffectsToBeatEnd=!1,this.slurHeight=5}isNotationElementVisible(e){return this.elements.has(e)?this.elements.get(e):nh.defaultElements.has(e)?nh.defaultElements.get(e):!0}}nh.defaultElements=new Map([[be.ZerosOnDiveWhammys,!1]]);class Fh{constructor(e){this._value=void 0,this._factory=e}get value(){return this._value===void 0&&(this._value=this._factory()),this._value}}var na;(function(s){s[s.None=0]="None",s[s.Debug=1]="Debug",s[s.Info=2]="Info",s[s.Warning=3]="Warning",s[s.Error=4]="Error"})(na||(na={}));class yr{static format(e,t){return`[AlphaTab][${e}] ${t}`}debug(e,t,...i){console.debug(yr.format(e,t),...i)}warning(e,t,...i){console.warn(yr.format(e,t),...i)}info(e,t,...i){console.info(yr.format(e,t),...i)}error(e,t,...i){console.error(yr.format(e,t),...i)}}yr.logLevel=na.Info;class E{static shouldLog(e){return E.logLevel!==na.None&&e>=E.logLevel}static debug(e,t,...i){E.shouldLog(na.Debug)&&E.log.debug(e,t,...i)}static warning(e,t,...i){E.shouldLog(na.Warning)&&E.log.warning(e,t,...i)}static info(e,t,...i){E.shouldLog(na.Info)&&E.log.info(e,t,...i)}static error(e,t,...i){E.shouldLog(na.Error)&&E.log.error(e,t,...i)}}E.logLevel=na.Info;E.log=new yr;var me;(function(s){s[s.NoTripletFeel=0]="NoTripletFeel",s[s.Triplet16th=1]="Triplet16th",s[s.Triplet8th=2]="Triplet8th",s[s.Dotted16th=3]="Dotted16th",s[s.Dotted8th=4]="Dotted8th",s[s.Scottish16th=5]="Scottish16th",s[s.Scottish8th=6]="Scottish8th"})(me||(me={}));class Ca{constructor(){this.alternateEndings=0,this.nextMasterBar=null,this.previousMasterBar=null,this.index=0,this.isDoubleBar=!1,this.isRepeatStart=!1,this.repeatCount=0,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.timeSignatureCommon=!1,this.isFreeTime=!1,this.tripletFeel=me.NoTripletFeel,this.section=null,this.tempoAutomations=[],this.fermata=null,this.start=0,this.isAnacrusis=!1,this.displayScale=1,this.displayWidth=-1,this.directions=null}get hasChanges(){return this.index===0?!1:this.timeSignatureCommon!==this.previousMasterBar.timeSignatureCommon||this.timeSignatureNumerator!==this.previousMasterBar.timeSignatureNumerator||this.timeSignatureDenominator!==this.previousMasterBar.timeSignatureDenominator||this.tripletFeel!==this.previousMasterBar.tripletFeel?!0:this.alternateEndings!==0||this.isRepeatStart||this.isRepeatEnd||this.isFreeTime||this.isSectionStart||this.tempoAutomations.length>0||this.syncPoints&&this.syncPoints.length>0||this.fermata!==null&&this.fermata.size>0||this.directions!==null&&this.directions.size>0||this.isAnacrusis}get keySignature(){return this.score.tracks[0].staves[0].bars[this.index].keySignature}set keySignature(e){this.score.tracks[0].staves[0].bars[this.index].keySignature=e}get keySignatureType(){return this.score.tracks[0].staves[0].bars[this.index].keySignatureType}set keySignatureType(e){this.score.tracks[0].staves[0].bars[this.index].keySignatureType=e}get isRepeatEnd(){return this.repeatCount>0}get isSectionStart(){return!!this.section}get tempoAutomation(){return this.tempoAutomations.length>0?this.tempoAutomations[0]:null}calculateDuration(e=!0){if(this.isAnacrusis&&e){let t=0;for(const i of this.score.tracks)for(const a of i.staves){const n=this.index<a.bars.length?a.bars[this.index].calculateDuration():0;n>t&&(t=n)}return t}return this.timeSignatureNumerator*v.valueToTicks(this.timeSignatureDenominator)}addFermata(e,t){let i=this.fermata;i===null&&(i=new Map,this.fermata=i),i.set(e,t)}addDirection(e){this.directions==null&&(this.directions=new Set),this.directions.add(e)}getFermata(e){const t=this.fermata;return t===null?null:t.has(e.playbackStart)?t.get(e.playbackStart):null}addSyncPoint(e){this.syncPoints||(this.syncPoints=[]),this.syncPoints.push(e)}}Ca.MaxAlternateEndings=8;class te{}te.DefaultChannelCount=17;te.MetronomeChannel=te.DefaultChannelCount-1;te.MetronomeKey=33;te.AudioChannels=2;te.MinVolume=0;te.MinProgram=0;te.MaxProgram=127;te.MinPlaybackSpeed=.125;te.MaxPlaybackSpeed=8;te.PercussionChannel=9;te.PercussionBank=128;te.MaxPitchWheel=16384;te.MaxPitchWheel20=4294967296;te.DefaultPitchWheel=te.MaxPitchWheel/2;te.MicroBufferCount=32;te.MicroBufferSize=64;class op{constructor(){this.beats=[],this.id="empty",this.isComplete=!1}addBeat(e){e.graceIndex=this.beats.length,e.graceGroup=this,this.beats.push(e)}finish(){this.beats.length>0&&(this.id=`${this.beats[0].absoluteDisplayStart}_${this.beats[0].voice.index}`)}}var rh;(function(s){s[s.Glyphs=0]="Glyphs"})(rh||(rh={}));class Cx extends Qo{}let Bs=class lp{constructor(){this._isEmpty=!0,this._isRestOnly=!0,this.id=lp._globalVoiceId++,this.index=0,this.beats=[]}static resetIds(){lp._globalVoiceId=0}get isEmpty(){return this._isEmpty}forceNonEmpty(){this._isEmpty=!1}get isRestOnly(){return this._isRestOnly}insertBeat(e,t){t.nextBeat=e.nextBeat,t.nextBeat&&(t.nextBeat.previousBeat=t),t.previousBeat=e,t.voice=this,e.nextBeat=t,this.beats.splice(e.index+1,0,t)}addBeat(e){e.voice=this,e.index=this.beats.length,this.beats.push(e),e.isEmpty||(this._isEmpty=!1),e.isRest||(this._isRestOnly=!1)}chain(e,t=null){if(this.bar){if(e.index<this.beats.length-1)e.nextBeat=this.beats[e.index+1],e.nextBeat.previousBeat=e;else if(e.isLastOfVoice&&e.voice.bar.nextBar){const i=this.bar.nextBar.voices[this.index];i.beats.length>0&&(e.nextBeat=i.beats[0]),e.nextBeat.previousBeat=e}e.chain(t)}}addGraceBeat(e){if(this.beats.length===0){this.addBeat(e);return}const t=this.beats[this.beats.length-1];this.beats.splice(this.beats.length-1,1),this.addBeat(e),this.addBeat(t),this._isEmpty=!1,this._isRestOnly=!1}getBeatAtPlaybackStart(e){return this._beatLookup.has(e)?this._beatLookup.get(e):null}finish(e,t=null){this._isEmpty=!0,this._isRestOnly=!0,this._beatLookup=new Map;let i=null;for(let r=0;r<this.beats.length;r++){const o=this.beats[r];o.index=r,this.chain(o,t),o.graceType===se.None?(o.graceGroup=i,i&&(i.isComplete=!0),i=null):(i||(i=new op),i.addBeat(o)),o.isEmpty||(this._isEmpty=!1),o.isRest||(this._isRestOnly=!1)}let a=0,n=0;for(let r=0;r<this.beats.length;r++){const o=this.beats[r];if(o.index=r,o.finish(e,t),o.graceType===se.None){if(o.graceGroup){const l=o.graceGroup.beats[0],h=o.graceGroup.beats[o.graceGroup.beats.length-1];if(l.graceType!==se.BendGrace){const c=h.playbackStart+h.playbackDuration-l.playbackStart;switch(l.graceType){case se.BeforeBeat:l.previousBeat?(l.previousBeat.playbackDuration-=c,l.previousBeat.voice===this?n=l.previousBeat.playbackStart+l.previousBeat.playbackDuration:n=-c):n=-c;for(const d of o.graceGroup.beats)this._beatLookup.delete(d.playbackStart),d.playbackStart=n,this._beatLookup.set(d.playbackStart,o),n+=d.playbackDuration;break;case se.OnBeat:o.playbackDuration-=c,h.voice===this?n=h.playbackStart+h.playbackDuration:n=-c;break}}}o.displayStart=a,o.playbackStart=n,o.fermata?this.bar.masterBar.addFermata(o.playbackStart,o.fermata):o.fermata=this.bar.masterBar.getFermata(o),this._beatLookup.set(o.playbackStart,o)}else o.displayStart=a,o.playbackStart=n;o.finishTuplet(),o.graceGroup&&o.graceGroup.finish(),a+=o.displayDuration,n+=o.playbackDuration}}calculateDuration(){if(this.isEmpty||this.beats.length===0)return 0;const e=this.beats[this.beats.length-1],t=this.beats[0];return e.playbackStart+e.playbackDuration-t.playbackStart}};Bs._globalVoiceId=0;class Ex{constructor(){this.note=null,this.tone=new Qw,this.octave=0}get realValue(){return this.octave*12+this.tone.noteValue}}class Qw{constructor(e=0,t=ke.Default){this.noteValue=e,this.accidentalMode=t}}class V{static getIndex(e){return e<0?0:Math.log2(e)|0}static keySignatureIsFlat(e){return e<0}static keySignatureIsNatural(e){return e===0}static keySignatureIsSharp(e){return e>0}static applyPitchOffsets(e,t){for(let i=0;i<t.tracks.length;i++){if(i<e.notation.displayTranspositionPitches.length)for(const a of t.tracks[i].staves)a.displayTranspositionPitch=-e.notation.displayTranspositionPitches[i];if(i<e.notation.transpositionPitches.length)for(const a of t.tracks[i].staves)a.transpositionPitch=-e.notation.transpositionPitches[i]}}static fingerToString(e,t,i,a){if(e.notation.fingeringMode===ua.ScoreForcePiano||e.notation.fingeringMode===ua.SingleNoteEffectBandForcePiano||oa.isPiano(t.voice.bar.staff.track.playbackInfo.program))switch(i){case ie.Unknown:case ie.NoOrDead:return null;case ie.Thumb:return"1";case ie.IndexFinger:return"2";case ie.MiddleFinger:return"3";case ie.AnnularFinger:return"4";case ie.LittleFinger:return"5";default:return null}if(a)switch(i){case ie.Unknown:return null;case ie.NoOrDead:return"0";case ie.Thumb:return"t";case ie.IndexFinger:return"1";case ie.MiddleFinger:return"2";case ie.AnnularFinger:return"3";case ie.LittleFinger:return"4";default:return null}switch(i){case ie.Unknown:case ie.NoOrDead:return null;case ie.Thumb:return"p";case ie.IndexFinger:return"i";case ie.MiddleFinger:return"m";case ie.AnnularFinger:return"a";case ie.LittleFinger:return"c";default:return null}}static isTuning(e){return!!V.parseTuning(e)}static parseTuning(e){let t="",i="";for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);if(r>=48&&r<=57){if(!t)return null;i+=String.fromCharCode(r)}else if(V.TuningLetters.has(r))t+=String.fromCharCode(r);else return null}if(!i||!t)return null;const a=new Ex;return a.octave=Number.parseInt(i)+1,a.note=t.toLowerCase(),a.tone=V.getToneForText(a.note),a.tone.noteValue<0&&(a.octave--,a.tone.noteValue+=12),a}static getTuningForText(e){const t=V.parseTuning(e);return t?t.realValue:-1}static getToneForText(e){const t=e.substring(0,1),i=e.substring(1);let a,n;switch(t.toLowerCase()){case"c":a=0;break;case"d":a=2;break;case"e":a=4;break;case"f":a=5;break;case"g":a=7;break;case"a":a=9;break;case"b":a=11;break;default:a=0;break}switch(n=V.parseAccidentalMode(i),n){case ke.Default:break;case ke.ForceNone:break;case ke.ForceNatural:break;case ke.ForceSharp:a++;break;case ke.ForceDoubleSharp:a+=2;break;case ke.ForceFlat:a--;break;case ke.ForceDoubleFlat:a-=2;break}return new Qw(a,n)}static parseAccidentalMode(e){const t=e.toLowerCase();return V.accidentalModeMapping.has(t)?V.accidentalModeMapping.get(t):ke.Default}static newGuid(){return`${Math.floor((1+Math.random())*65536).toString(16).substring(1)+Math.floor((1+Math.random())*65536).toString(16).substring(1)}-${Math.floor((1+Math.random())*65536).toString(16).substring(1)}-${Math.floor((1+Math.random())*65536).toString(16).substring(1)}-${Math.floor((1+Math.random())*65536).toString(16).substring(1)}-${Math.floor((1+Math.random())*65536).toString(16).substring(1)}${Math.floor((1+Math.random())*65536).toString(16).substring(1)}${Math.floor((1+Math.random())*65536).toString(16).substring(1)}`}static isAlmostEqualTo(e,t){return Math.abs(e-t)<1e-5}static toHexString(e,t=0){let i="";const a="0123456789ABCDEF";do i=String.fromCharCode(a.charCodeAt(e&15))+i,e=e>>4;while(e>0);for(;i.length<t;)i=`0${i}`;return i}static getAlternateEndingsList(e){const t=[];for(let i=0;i<Ca.MaxAlternateEndings;i++)e&1<<i&&t.push(i);return t}static deltaFretToHarmonicValue(e){switch(e){case 2:return 2.4;case 3:return 3.2;case 4:case 5:case 7:case 9:case 12:case 16:case 17:case 19:case 24:return e;case 8:return 8.2;case 10:return 9.6;case 14:case 15:return 14.7;case 21:case 22:return 21.7;default:return 12}}static clamp(e,t,i){return e<=t?t:e>=i?i:e}static buildMultiBarRestInfo(e,t,i){var c;if(!e)return null;const a=e[0].score.stylesheet;if(!(e.length>1?a.multiTrackMultiBarRest:((c=a.perTrackMultiBarRest)==null?void 0:c.has(e[0].index))===!0))return null;const r=new Map,o=e[0].score;let l=t,h=o.tempo;for(;l<=i;){const d=l;let f=null;for(;l<=i;){const p=o.masterBars[l];let g=!1;for(const T of p.tempoAutomations)T.value!==h&&(g=!0),h=T.value;if(p.alternateEndings||p.isRepeatStart&&p.index!==d||p.isFreeTime||p.isAnacrusis||p.section!==null||p.index!==d&&g||p.fermata!==null&&p.fermata.size>0||p.directions!==null&&p.directions.size>0||d>t&&p.previousMasterBar&&(p.timeSignatureCommon!==p.previousMasterBar.timeSignatureCommon||p.timeSignatureNumerator!==p.previousMasterBar.timeSignatureNumerator||p.timeSignatureDenominator!==p.previousMasterBar.timeSignatureDenominator||p.tripletFeel!==p.previousMasterBar.tripletFeel))break;let m=!0;for(const T of e){for(const S of T.staves){const y=S.bars[p.index];if(!y.isRestOnly){m=!1;break}if(y.index>0&&(y.keySignature!==y.previousBar.keySignature||y.keySignatureType!==y.previousBar.keySignatureType)){m=!1;break}}if(!m)break}if(!m||(l++,p.index>d&&(f===null?f=[p.index]:f.push(p.index)),p.isRepeatEnd))break}f?r.set(d,f):l++}return r}static computeFirstDisplayedBarIndex(e,t){let i=t.display.startBar;return i--,i=Math.min(e.masterBars.length-1,Math.max(0,i)),i}static computeLastDisplayedBarIndex(e,t,i){let a=t.display.barCount;return a<0&&(a=e.masterBars.length),a=i+a-1,a=Math.min(e.masterBars.length-1,Math.max(0,a)),a}static getOrCreateHeaderFooterStyle(e,t){let i=e.style;e.style||(i=new ko,e.style=i);let a;if(i.headerAndFooter.has(t))a=i.headerAndFooter.get(t);else{if(a=new is,ko.defaultHeaderAndFooter.has(t)){const n=ko.defaultHeaderAndFooter.get(t);a.template=n.template,a.textAlign=n.textAlign}i.headerAndFooter.set(t,a)}return a}static consolidate(e){if(e.masterBars.length===0){const i=new Ca;e.addMasterBar(i);const a=new wt;a.isLinear=!1,a.type=tt.Tempo,a.value=e.tempo,i.tempoAutomations.push(a);const n=new qi;e.tracks[0].staves[0].addBar(n);const r=new Bs;n.addVoice(r);const o=new Wt;o.isEmpty=!0,r.addBeat(o);return}const t=new Set([te.PercussionChannel]);for(const i of e.tracks){if(i.staves.length===1&&i.staves[0].isPercussion)i.playbackInfo.primaryChannel=te.PercussionChannel,i.playbackInfo.secondaryChannel=te.PercussionChannel;else{if(i.playbackInfo.primaryChannel!==te.PercussionChannel)for(;t.has(i.playbackInfo.primaryChannel);)i.playbackInfo.primaryChannel++;if(t.add(i.playbackInfo.primaryChannel),i.playbackInfo.secondaryChannel!==te.PercussionChannel)for(;t.has(i.playbackInfo.secondaryChannel);)i.playbackInfo.secondaryChannel++;t.add(i.playbackInfo.secondaryChannel)}for(const a of i.staves){for(const r of a.bars)for(const o of r.voices)if(o.isEmpty&&o.beats.length===0){const l=new Wt;l.isEmpty=!0,o.addBeat(l)}const n=a.bars.length===0?1:a.bars[0].voices.length;for(;a.bars.length<e.masterBars.length;){const r=new qi;a.addBar(r);const o=r.previousBar;o&&(r.clef=o.clef,r.clefOttava=o.clefOttava,r.keySignature=r.previousBar.keySignature,r.keySignatureType=r.previousBar.keySignatureType);for(let l=0;l<n;l++){const h=new Bs;r.addVoice(h);const c=new Wt;c.isEmpty=!0,h.addBeat(c)}}}}}static trimEmptyBarsAtEnd(e){for(;e.masterBars.length>1;){const t=e.masterBars.length-1,i=e.masterBars[t];if(i.hasChanges)return;for(const a of e.tracks)for(const n of a.staves)if(t<n.bars.length){const r=n.bars[t];if(!r.isEmpty||r.hasChanges)return}for(const a of e.tracks)for(const n of a.staves)if(t<n.bars.length){const r=n.bars[t];n.bars.pop(),r.previousBar.nextBar=null}e.masterBars.pop(),i.previousMasterBar.nextMasterBar=null}}}V.TuningLetters=new Set([67,68,69,70,71,65,66,99,100,101,102,103,97,98,35]);V.accidentalModeMapping=new Map([["default",ke.Default],["d",ke.Default],["forcenone",ke.ForceNone],["-",ke.ForceNone],["forcenatural",ke.ForceNatural],["n",ke.ForceNatural],["forcesharp",ke.ForceSharp],["#",ke.ForceSharp],["forcedoublesharp",ke.ForceDoubleSharp],["##",ke.ForceDoubleSharp],["x",ke.ForceDoubleSharp],["forceflat",ke.ForceFlat],["b",ke.ForceFlat],["forcedoubleflat",ke.ForceDoubleFlat],["bb",ke.ForceDoubleFlat]]);var ni;(function(s){s[s.None=0]="None",s[s.Up=1]="Up",s[s.Down=2]="Down"})(ni||(ni={}));var u;(function(s){s[s.None=-1]="None",s[s.Space=32]="Space",s[s.Brace=57344]="Brace",s[s.BracketTop=57347]="BracketTop",s[s.BracketBottom=57348]="BracketBottom",s[s.SystemDivider=57351]="SystemDivider",s[s.GClef=57424]="GClef",s[s.CClef=57436]="CClef",s[s.FClef=57442]="FClef",s[s.UnpitchedPercussionClef1=57449]="UnpitchedPercussionClef1",s[s.SixStringTabClef=57453]="SixStringTabClef",s[s.FourStringTabClef=57454]="FourStringTabClef",s[s.TimeSig0=57472]="TimeSig0",s[s.TimeSig1=57473]="TimeSig1",s[s.TimeSig2=57474]="TimeSig2",s[s.TimeSig3=57475]="TimeSig3",s[s.TimeSig4=57476]="TimeSig4",s[s.TimeSig5=57477]="TimeSig5",s[s.TimeSig6=57478]="TimeSig6",s[s.TimeSig7=57479]="TimeSig7",s[s.TimeSig8=57480]="TimeSig8",s[s.TimeSig9=57481]="TimeSig9",s[s.TimeSigCommon=57482]="TimeSigCommon",s[s.TimeSigCutCommon=57483]="TimeSigCutCommon",s[s.NoteheadDoubleWholeSquare=57505]="NoteheadDoubleWholeSquare",s[s.NoteheadDoubleWhole=57504]="NoteheadDoubleWhole",s[s.NoteheadWhole=57506]="NoteheadWhole",s[s.NoteheadHalf=57507]="NoteheadHalf",s[s.NoteheadBlack=57508]="NoteheadBlack",s[s.NoteheadNull=57509]="NoteheadNull",s[s.NoteheadXOrnate=57514]="NoteheadXOrnate",s[s.NoteheadPlusDoubleWhole=57516]="NoteheadPlusDoubleWhole",s[s.NoteheadPlusWhole=57517]="NoteheadPlusWhole",s[s.NoteheadPlusHalf=57518]="NoteheadPlusHalf",s[s.NoteheadPlusBlack=57519]="NoteheadPlusBlack",s[s.NoteheadSquareWhite=57528]="NoteheadSquareWhite",s[s.NoteheadSquareBlack=57529]="NoteheadSquareBlack",s[s.NoteheadTriangleUpDoubleWhole=57530]="NoteheadTriangleUpDoubleWhole",s[s.NoteheadTriangleUpWhole=57531]="NoteheadTriangleUpWhole",s[s.NoteheadTriangleUpHalf=57532]="NoteheadTriangleUpHalf",s[s.NoteheadTriangleUpBlack=57534]="NoteheadTriangleUpBlack",s[s.NoteheadTriangleRightWhite=57537]="NoteheadTriangleRightWhite",s[s.NoteheadTriangleRightBlack=57538]="NoteheadTriangleRightBlack",s[s.NoteheadTriangleDownDoubleWhole=57548]="NoteheadTriangleDownDoubleWhole",s[s.NoteheadTriangleDownWhole=57540]="NoteheadTriangleDownWhole",s[s.NoteheadTriangleDownHalf=57541]="NoteheadTriangleDownHalf",s[s.NoteheadTriangleDownBlack=57543]="NoteheadTriangleDownBlack",s[s.NoteheadDiamondDoubleWhole=57559]="NoteheadDiamondDoubleWhole",s[s.NoteheadDiamondWhole=57560]="NoteheadDiamondWhole",s[s.NoteheadDiamondHalf=57561]="NoteheadDiamondHalf",s[s.NoteheadDiamondBlack=57563]="NoteheadDiamondBlack",s[s.NoteheadDiamondBlackWide=57564]="NoteheadDiamondBlackWide",s[s.NoteheadDiamondWhite=57565]="NoteheadDiamondWhite",s[s.NoteheadDiamondWhiteWide=57566]="NoteheadDiamondWhiteWide",s[s.NoteheadCircleXDoubleWhole=57520]="NoteheadCircleXDoubleWhole",s[s.NoteheadCircleXWhole=57521]="NoteheadCircleXWhole",s[s.NoteheadCircleXHalf=57522]="NoteheadCircleXHalf",s[s.NoteheadCircleX=57523]="NoteheadCircleX",s[s.NoteheadXDoubleWhole=57510]="NoteheadXDoubleWhole",s[s.NoteheadXWhole=57511]="NoteheadXWhole",s[s.NoteheadXHalf=57512]="NoteheadXHalf",s[s.NoteheadXBlack=57513]="NoteheadXBlack",s[s.NoteheadParenthesis=57550]="NoteheadParenthesis",s[s.NoteheadSlashedBlack1=57551]="NoteheadSlashedBlack1",s[s.NoteheadSlashedBlack2=57552]="NoteheadSlashedBlack2",s[s.NoteheadSlashedHalf1=57553]="NoteheadSlashedHalf1",s[s.NoteheadSlashedHalf2=57554]="NoteheadSlashedHalf2",s[s.NoteheadSlashedWhole1=57555]="NoteheadSlashedWhole1",s[s.NoteheadSlashedWhole2=57556]="NoteheadSlashedWhole2",s[s.NoteheadSlashedDoubleWhole1=57557]="NoteheadSlashedDoubleWhole1",s[s.NoteheadSlashedDoubleWhole2=57558]="NoteheadSlashedDoubleWhole2",s[s.NoteheadCircledBlack=57572]="NoteheadCircledBlack",s[s.NoteheadCircledHalf=57573]="NoteheadCircledHalf",s[s.NoteheadCircledWhole=57574]="NoteheadCircledWhole",s[s.NoteheadCircledDoubleWhole=57575]="NoteheadCircledDoubleWhole",s[s.NoteheadCircleSlash=57591]="NoteheadCircleSlash",s[s.NoteheadHeavyX=57592]="NoteheadHeavyX",s[s.NoteheadHeavyXHat=57593]="NoteheadHeavyXHat",s[s.NoteheadSlashVerticalEnds=57600]="NoteheadSlashVerticalEnds",s[s.NoteheadSlashWhiteWhole=57602]="NoteheadSlashWhiteWhole",s[s.NoteheadSlashWhiteHalf=57603]="NoteheadSlashWhiteHalf",s[s.NoteheadRoundWhiteWithDot=57621]="NoteheadRoundWhiteWithDot",s[s.NoteheadSquareBlackLarge=57626]="NoteheadSquareBlackLarge",s[s.NoteheadSquareBlackWhite=57627]="NoteheadSquareBlackWhite",s[s.NoteheadClusterDoubleWhole3rd=57640]="NoteheadClusterDoubleWhole3rd",s[s.NoteheadClusterWhole3rd=57641]="NoteheadClusterWhole3rd",s[s.NoteheadClusterHalf3rd=57642]="NoteheadClusterHalf3rd",s[s.NoteheadClusterQuarter3rd=57643]="NoteheadClusterQuarter3rd",s[s.NoteShapeRoundWhite=57776]="NoteShapeRoundWhite",s[s.NoteShapeRoundBlack=57777]="NoteShapeRoundBlack",s[s.NoteShapeSquareWhite=57778]="NoteShapeSquareWhite",s[s.NoteShapeSquareBlack=57779]="NoteShapeSquareBlack",s[s.NoteShapeTriangleRightWhite=57780]="NoteShapeTriangleRightWhite",s[s.NoteShapeTriangleRightBlack=57781]="NoteShapeTriangleRightBlack",s[s.NoteShapeTriangleLeftWhite=57782]="NoteShapeTriangleLeftWhite",s[s.NoteShapeTriangleLeftBlack=57783]="NoteShapeTriangleLeftBlack",s[s.NoteShapeDiamondWhite=57784]="NoteShapeDiamondWhite",s[s.NoteShapeDiamondBlack=57785]="NoteShapeDiamondBlack",s[s.NoteShapeTriangleUpWhite=57786]="NoteShapeTriangleUpWhite",s[s.NoteShapeTriangleUpBlack=57787]="NoteShapeTriangleUpBlack",s[s.NoteShapeMoonWhite=57788]="NoteShapeMoonWhite",s[s.NoteShapeMoonBlack=57789]="NoteShapeMoonBlack",s[s.NoteShapeTriangleRoundWhite=57790]="NoteShapeTriangleRoundWhite",s[s.NoteShapeTriangleRoundBlack=57791]="NoteShapeTriangleRoundBlack",s[s.NoteQuarterUp=57813]="NoteQuarterUp",s[s.NoteEighthUp=57815]="NoteEighthUp",s[s.TextBlackNoteLongStem=57841]="TextBlackNoteLongStem",s[s.TextBlackNoteFrac8thLongStem=57843]="TextBlackNoteFrac8thLongStem",s[s.TextBlackNoteFrac16thLongStem=57845]="TextBlackNoteFrac16thLongStem",s[s.TextBlackNoteFrac32ndLongStem=57846]="TextBlackNoteFrac32ndLongStem",s[s.TextCont8thBeamLongStem=57848]="TextCont8thBeamLongStem",s[s.TextCont16thBeamLongStem=57850]="TextCont16thBeamLongStem",s[s.TextCont32ndBeamLongStem=57851]="TextCont32ndBeamLongStem",s[s.TextAugmentationDot=57852]="TextAugmentationDot",s[s.TextTupletBracketStartLongStem=57857]="TextTupletBracketStartLongStem",s[s.TextTuplet3LongStem=57858]="TextTuplet3LongStem",s[s.TextTupletBracketEndLongStem=57859]="TextTupletBracketEndLongStem",s[s.Tremolo3=57890]="Tremolo3",s[s.Tremolo2=57889]="Tremolo2",s[s.Tremolo1=57888]="Tremolo1",s[s.FlagEighthUp=57920]="FlagEighthUp",s[s.FlagEighthDown=57921]="FlagEighthDown",s[s.FlagSixteenthUp=57922]="FlagSixteenthUp",s[s.FlagSixteenthDown=57923]="FlagSixteenthDown",s[s.FlagThirtySecondUp=57924]="FlagThirtySecondUp",s[s.FlagThirtySecondDown=57925]="FlagThirtySecondDown",s[s.FlagSixtyFourthUp=57926]="FlagSixtyFourthUp",s[s.FlagSixtyFourthDown=57927]="FlagSixtyFourthDown",s[s.FlagOneHundredTwentyEighthUp=57928]="FlagOneHundredTwentyEighthUp",s[s.FlagOneHundredTwentyEighthDown=57929]="FlagOneHundredTwentyEighthDown",s[s.FlagTwoHundredFiftySixthUp=57930]="FlagTwoHundredFiftySixthUp",s[s.FlagTwoHundredFiftySixthDown=57931]="FlagTwoHundredFiftySixthDown",s[s.AccidentalFlat=57952]="AccidentalFlat",s[s.AccidentalNatural=57953]="AccidentalNatural",s[s.AccidentalSharp=57954]="AccidentalSharp",s[s.AccidentalDoubleSharp=57955]="AccidentalDoubleSharp",s[s.AccidentalDoubleFlat=57956]="AccidentalDoubleFlat",s[s.AccidentalQuarterToneFlatArrowUp=57968]="AccidentalQuarterToneFlatArrowUp",s[s.AccidentalQuarterToneSharpArrowUp=57972]="AccidentalQuarterToneSharpArrowUp",s[s.AccidentalQuarterToneNaturalArrowUp=57970]="AccidentalQuarterToneNaturalArrowUp",s[s.Segno=57415]="Segno",s[s.Coda=57416]="Coda",s[s.ArticAccentAbove=58528]="ArticAccentAbove",s[s.ArticAccentBelow=58529]="ArticAccentBelow",s[s.ArticStaccatoAbove=58530]="ArticStaccatoAbove",s[s.ArticStaccatoBelow=58531]="ArticStaccatoBelow",s[s.ArticTenutoAbove=58532]="ArticTenutoAbove",s[s.ArticTenutoBelow=58533]="ArticTenutoBelow",s[s.ArticMarcatoAbove=58540]="ArticMarcatoAbove",s[s.ArticMarcatoBelow=58541]="ArticMarcatoBelow",s[s.FermataAbove=58560]="FermataAbove",s[s.FermataShortAbove=58564]="FermataShortAbove",s[s.FermataLongAbove=58566]="FermataLongAbove",s[s.RestLonga=58593]="RestLonga",s[s.RestDoubleWhole=58594]="RestDoubleWhole",s[s.RestWhole=58595]="RestWhole",s[s.RestHalf=58596]="RestHalf",s[s.RestQuarter=58597]="RestQuarter",s[s.RestEighth=58598]="RestEighth",s[s.RestSixteenth=58599]="RestSixteenth",s[s.RestThirtySecond=58600]="RestThirtySecond",s[s.RestSixtyFourth=58601]="RestSixtyFourth",s[s.RestOneHundredTwentyEighth=58602]="RestOneHundredTwentyEighth",s[s.RestTwoHundredFiftySixth=58603]="RestTwoHundredFiftySixth",s[s.RestHBarLeft=58607]="RestHBarLeft",s[s.RestHBarMiddle=58608]="RestHBarMiddle",s[s.RestHBarRight=58609]="RestHBarRight",s[s.Repeat1Bar=58624]="Repeat1Bar",s[s.Repeat2Bars=58625]="Repeat2Bars",s[s.Ottava=58640]="Ottava",s[s.OttavaAlta=58641]="OttavaAlta",s[s.OttavaBassaVb=58652]="OttavaBassaVb",s[s.Quindicesima=58644]="Quindicesima",s[s.QuindicesimaAlta=58645]="QuindicesimaAlta",s[s.DynamicPPPPPP=58663]="DynamicPPPPPP",s[s.DynamicPPPPP=58664]="DynamicPPPPP",s[s.DynamicPPPP=58665]="DynamicPPPP",s[s.DynamicPPP=58666]="DynamicPPP",s[s.DynamicPP=58667]="DynamicPP",s[s.DynamicPiano=58656]="DynamicPiano",s[s.DynamicMP=58668]="DynamicMP",s[s.DynamicMF=58669]="DynamicMF",s[s.DynamicPF=58670]="DynamicPF",s[s.DynamicForte=58658]="DynamicForte",s[s.DynamicFF=58671]="DynamicFF",s[s.DynamicFFF=58672]="DynamicFFF",s[s.DynamicFFFF=58673]="DynamicFFFF",s[s.DynamicFFFFF=58674]="DynamicFFFFF",s[s.DynamicFFFFFF=58675]="DynamicFFFFFF",s[s.DynamicFortePiano=58676]="DynamicFortePiano",s[s.DynamicNiente=58662]="DynamicNiente",s[s.DynamicSforzando1=58678]="DynamicSforzando1",s[s.DynamicSforzandoPiano=58679]="DynamicSforzandoPiano",s[s.DynamicSforzandoPianissimo=58680]="DynamicSforzandoPianissimo",s[s.DynamicSforzato=58681]="DynamicSforzato",s[s.DynamicSforzatoPiano=58682]="DynamicSforzatoPiano",s[s.DynamicSforzatoFF=58683]="DynamicSforzatoFF",s[s.DynamicRinforzando1=58684]="DynamicRinforzando1",s[s.DynamicRinforzando2=58685]="DynamicRinforzando2",s[s.DynamicForzando=58677]="DynamicForzando",s[s.OrnamentTrill=58726]="OrnamentTrill",s[s.OrnamentTurn=58727]="OrnamentTurn",s[s.OrnamentTurnInverted=58728]="OrnamentTurnInverted",s[s.OrnamentShortTrill=58732]="OrnamentShortTrill",s[s.OrnamentMordent=58733]="OrnamentMordent",s[s.StringsDownBow=58896]="StringsDownBow",s[s.StringsUpBow=58898]="StringsUpBow",s[s.KeyboardPedalPed=58960]="KeyboardPedalPed",s[s.KeyboardPedalUp=58965]="KeyboardPedalUp",s[s.PictEdgeOfCymbal=59177]="PictEdgeOfCymbal",s[s.GuitarString0=59443]="GuitarString0",s[s.GuitarString1=59444]="GuitarString1",s[s.GuitarString2=59445]="GuitarString2",s[s.GuitarString3=59446]="GuitarString3",s[s.GuitarString4=59447]="GuitarString4",s[s.GuitarString5=59448]="GuitarString5",s[s.GuitarString6=59449]="GuitarString6",s[s.GuitarString7=59450]="GuitarString7",s[s.GuitarString8=59451]="GuitarString8",s[s.GuitarString9=59452]="GuitarString9",s[s.GuitarOpenPedal=59453]="GuitarOpenPedal",s[s.GuitarClosePedal=59455]="GuitarClosePedal",s[s.GuitarGolpe=59458]="GuitarGolpe",s[s.GuitarFadeIn=59459]="GuitarFadeIn",s[s.GuitarFadeOut=59460]="GuitarFadeOut",s[s.GuitarVolumeSwell=59461]="GuitarVolumeSwell",s[s.FretboardX=59481]="FretboardX",s[s.FretboardO=59482]="FretboardO",s[s.WiggleTrill=60068]="WiggleTrill",s[s.WiggleVibratoMediumFast=60126]="WiggleVibratoMediumFast",s[s.OctaveBaselineM=60565]="OctaveBaselineM",s[s.OctaveBaselineB=60563]="OctaveBaselineB"})(u||(u={}));var Q;(function(s){s[s.Left=0]="Left",s[s.Center=1]="Center",s[s.Right=2]="Right"})(Q||(Q={}));var he;(function(s){s[s.Top=0]="Top",s[s.Middle=1]="Middle",s[s.Bottom=2]="Bottom"})(he||(he={}));class ed{constructor(e,t){this.width=e,this.height=t}}class U{constructor(e="",t=0,i=0,a=u.None,n=u.None,r=u.None,o=u.None,l=he.Middle){this.elementType=e,this.outputMidiNumber=i,this.staffLine=t,this.noteHeadDefault=a,this.noteHeadHalf=n!==u.None?n:a,this.noteHeadWhole=r!==u.None?r:a,this.techniqueSymbol=o,this.techniqueSymbolPlacement=l}getSymbol(e){switch(e){case w.Whole:return this.noteHeadWhole;case w.Half:return this.noteHeadHalf;default:return this.noteHeadDefault}}}class At{static articulationFromElementVariation(e,t){return e<At.gp6ElementAndVariationToArticulation.length?(t>=At.gp6ElementAndVariationToArticulation.length&&(t=0),At.gp6ElementAndVariationToArticulation[e][t]):38}static getArticulation(e){const t=e.percussionArticulation;if(t<0)return null;const i=e.beat.voice.bar.staff.track.percussionArticulations;return t<i.length?i[t]:At.getArticulationByInputMidiNumber(t)}static getElementAndVariation(e){const t=At.getArticulation(e);if(!t)return[-1,-1];for(let i=0;i<At.gp6ElementAndVariationToArticulation.length;i++){const a=At.gp6ElementAndVariationToArticulation[i];for(let n=0;n<a.length;n++){const r=At.getArticulationByInputMidiNumber(a[n]);if((r==null?void 0:r.outputMidiNumber)===t.outputMidiNumber)return[i,n]}}return[-1,-1]}static getArticulationByInputMidiNumber(e){return At.instrumentArticulations.has(e)?At.instrumentArticulations.get(e):null}}At.gp6ElementAndVariationToArticulation=[[35,35,35],[38,91,37],[99,100,99],[56,100,56],[102,103,102],[43,43,43],[45,45,45],[47,47,47],[48,48,48],[50,50,50],[42,92,46],[44,44,44],[57,98,57],[49,97,49],[55,95,55],[51,93,127],[52,96,52]];At.instrumentArticulations=new Map([[38,new U("snare",3,38,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[37,new U("snare",3,37,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[91,new U("snare",3,38,u.NoteheadDiamondWhite,u.NoteheadDiamondWhite,u.NoteheadDiamondWhite)],[42,new U("hiHat",-1,42,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[92,new U("hiHat",-1,46,u.NoteheadCircleSlash,u.NoteheadCircleSlash,u.NoteheadCircleSlash)],[46,new U("hiHat",-1,46,u.NoteheadCircleX,u.NoteheadCircleX,u.NoteheadCircleX)],[44,new U("hiHat",9,44,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[35,new U("kickDrum",8,35,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[36,new U("kickDrum",7,36,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[50,new U("tom",1,50,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[48,new U("tom",2,48,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[47,new U("tom",4,47,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[45,new U("tom",5,45,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[43,new U("tom",6,43,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[93,new U("ride",0,51,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack,u.PictEdgeOfCymbal,he.Bottom)],[51,new U("ride",0,51,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[53,new U("ride",0,53,u.NoteheadDiamondWhite,u.NoteheadDiamondWhite,u.NoteheadDiamondWhite)],[94,new U("ride",0,51,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack,u.ArticStaccatoAbove,he.Top)],[55,new U("splash",-2,55,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[95,new U("splash",-2,55,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack,u.ArticStaccatoAbove,he.Bottom)],[52,new U("china",-3,52,u.NoteheadHeavyXHat,u.NoteheadHeavyXHat,u.NoteheadHeavyXHat)],[96,new U("china",-3,52,u.NoteheadHeavyXHat,u.NoteheadHeavyXHat,u.NoteheadHeavyXHat)],[49,new U("crash",-2,49,u.NoteheadHeavyX,u.NoteheadHeavyX,u.NoteheadHeavyX)],[97,new U("crash",-2,49,u.NoteheadHeavyX,u.NoteheadHeavyX,u.NoteheadHeavyX,u.ArticStaccatoAbove,he.Bottom)],[57,new U("crash",-1,57,u.NoteheadHeavyX,u.NoteheadHeavyX,u.NoteheadHeavyX)],[98,new U("crash",-1,57,u.NoteheadHeavyX,u.NoteheadHeavyX,u.NoteheadHeavyX,u.ArticStaccatoAbove,he.Bottom)],[99,new U("cowbell",1,56,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpHalf,u.NoteheadTriangleUpWhole)],[100,new U("cowbell",1,56,u.NoteheadXBlack,u.NoteheadXHalf,u.NoteheadXWhole)],[56,new U("cowbell",0,56,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpHalf,u.NoteheadTriangleUpWhole)],[101,new U("cowbell",0,56,u.NoteheadXBlack,u.NoteheadXHalf,u.NoteheadXWhole)],[102,new U("cowbell",-1,56,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpHalf,u.NoteheadTriangleUpWhole)],[103,new U("cowbell",-1,56,u.NoteheadXBlack,u.NoteheadXHalf,u.NoteheadXWhole)],[77,new U("woodblock",-9,77,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack)],[76,new U("woodblock",-10,76,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack)],[60,new U("bongo",-4,60,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[104,new U("bongo",-5,60,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.NoteheadParenthesis,he.Middle)],[105,new U("bongo",-6,60,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[61,new U("bongo",-7,61,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[106,new U("bongo",-8,61,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.NoteheadParenthesis,he.Middle)],[107,new U("bongo",-16,61,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[66,new U("timbale",10,66,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[65,new U("timbale",9,65,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[68,new U("agogo",12,68,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[67,new U("agogo",11,67,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[64,new U("conga",17,64,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[108,new U("conga",16,64,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[109,new U("conga",15,64,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.NoteheadParenthesis,he.Middle)],[63,new U("conga",14,63,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[110,new U("conga",13,63,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[62,new U("conga",19,62,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.NoteheadParenthesis,he.Middle)],[72,new U("whistle",-11,72,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[71,new U("whistle",-17,71,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[73,new U("guiro",38,73,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[74,new U("guiro",37,74,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[86,new U("surdo",36,86,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[87,new U("surdo",35,87,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadParenthesis,he.Middle)],[54,new U("tambourine",3,54,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack)],[111,new U("tambourine",2,54,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack,u.StringsUpBow,he.Bottom)],[112,new U("tambourine",1,54,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack,u.NoteheadTriangleUpBlack,u.StringsDownBow,he.Bottom)],[113,new U("tambourine",-7,54,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[79,new U("cuica",30,79,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[78,new U("cuica",29,78,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[58,new U("vibraslap",28,58,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[81,new U("triangle",27,81,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[80,new U("triangle",26,80,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadParenthesis,he.Middle)],[114,new U("grancassa",25,43,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[115,new U("piatti",18,49,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[116,new U("piatti",24,49,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[69,new U("cabasa",23,69,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[117,new U("cabasa",22,69,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.StringsUpBow,he.Bottom)],[85,new U("castanets",21,85,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[75,new U("claves",20,75,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[70,new U("maraca",-12,70,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[118,new U("maraca",-13,70,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.StringsUpBow,he.Bottom)],[119,new U("maraca",-14,70,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[120,new U("maraca",-15,70,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.StringsUpBow,he.Bottom)],[82,new U("shaker",-23,54,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[122,new U("shaker",-24,54,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.StringsUpBow,he.Bottom)],[84,new U("bellTree",-18,53,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[123,new U("bellTree",-19,53,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole,u.StringsUpBow,he.Bottom)],[83,new U("jingleBell",-20,53,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[124,new U("unpitched",-21,62,u.NoteheadNull,u.NoteheadNull,u.NoteheadNull,u.GuitarGolpe,he.Top)],[125,new U("unpitched",-22,62,u.NoteheadNull,u.NoteheadNull,u.NoteheadNull,u.GuitarGolpe,he.Bottom)],[39,new U("handClap",3,39,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[40,new U("snare",3,40,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[31,new U("snare",3,40,u.NoteheadSlashedBlack2,u.NoteheadSlashedBlack2,u.NoteheadSlashedBlack2)],[41,new U("tom",5,41,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole)],[59,new U("ride",2,59,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack,u.PictEdgeOfCymbal,he.Bottom)],[126,new U("ride",2,59,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[127,new U("ride",2,59,u.NoteheadDiamondWhite,u.NoteheadDiamondWhite,u.NoteheadDiamondWhite)],[29,new U("ride",2,59,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack,u.ArticStaccatoAbove,he.Top)],[30,new U("crash",-3,49,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[33,new U("snare",3,37,u.NoteheadXBlack,u.NoteheadXBlack,u.NoteheadXBlack)],[34,new U("snare",3,38,u.NoteheadBlack,u.NoteheadBlack,u.NoteheadBlack)]]);At.instrumentArticulationNames=new Map([["Ride (choke)",29],["Cymbal (hit)",30],["Snare (side stick)",31],["Snare (side stick) 2",33],["Snare (hit)",34],["Kick (hit)",35],["Kick (hit) 2",36],["Snare (side stick) 3",37],["Snare (hit) 2",38],["Hand Clap (hit)",39],["Snare (hit) 3",40],["Low Floor Tom (hit)",41],["Hi-Hat (closed)",42],["Very Low Tom (hit)",43],["Pedal Hi-Hat (hit)",44],["Low Tom (hit)",45],["Hi-Hat (open)",46],["Mid Tom (hit)",47],["High Tom (hit)",48],["Crash high (hit)",49],["High Floor Tom (hit)",50],["Ride (middle)",51],["China (hit)",52],["Ride (bell)",53],["Tambourine (hit)",54],["Splash (hit)",55],["Cowbell medium (hit)",56],["Crash medium (hit)",57],["Vibraslap (hit)",58],["Ride (edge)",59],["Hand (hit)",60],["Hand (hit)",61],["Conga high (mute)",62],["Conga high (hit)",63],["Conga low (hit)",64],["Timbale high (hit)",65],["Timbale low (hit)",66],["Agogo high (hit)",67],["Agogo tow (hit)",68],["Cabasa (hit)",69],["Left Maraca (hit)",70],["Whistle high (hit)",71],["Whistle low (hit)",72],["Guiro (hit)",73],["Guiro (scrap-return)",74],["Claves (hit)",75],["Woodblock high (hit)",76],["Woodblock low (hit)",77],["Cuica (mute)",78],["Cuica (open)",79],["Triangle (rnute)",80],["Triangle (hit)",81],["Shaker (hit)",82],["Tinkle Bell (hat)",83],["Jingle Bell (hit)",83],["Bell Tree (hit)",84],["Castanets (hit)",85],["Surdo (hit)",86],["Surdo (mute)",87],["Snare (rim shot)",91],["Hi-Hat (half)",92],["Ride (edge) 2",93],["Ride (choke) 2",94],["Splash (choke)",95],["China (choke)",96],["Crash high (choke)",97],["Crash medium (choke)",98],["Cowbell low (hit)",99],["Cowbell low (tip)",100],["Cowbell medium (tip)",101],["Cowbell high (hit)",102],["Cowbell high (tip)",103],["Hand (mute)",104],["Hand (slap)",105],["Hand (mute) 2",106],["Hand (slap) 2",107],["Conga low (slap)",108],["Conga low (mute)",109],["Conga high (slap)",110],["Tambourine (return)",111],["Tambourine (roll)",112],["Tambourine (hand)",113],["Grancassa (hit)",114],["Piatti (hat)",115],["Piatti (hand)",116],["Cabasa (return)",117],["Left Maraca (return)",118],["Right Maraca (hit)",119],["Right Maraca (return)",120],["Shaker (return)",122],["Bell Tee (return)",123],["Golpe (thumb)",124],["Golpe (finger)",125],["Ride (middle) 2",126],["Ride (bell) 2",127]]);var Tt;(function(s){s[s.None=0]="None",s[s.InvertedTurn=1]="InvertedTurn",s[s.Turn=2]="Turn",s[s.UpperMordent=3]="UpperMordent",s[s.LowerMordent=4]="LowerMordent"})(Tt||(Tt={}));class wn{constructor(){this.tieDestinationNoteId=-1,this.tieOriginNoteId=-1,this.slurDestinationNoteId=-1,this.slurOriginNoteId=-1,this.hammerPullDestinationNoteId=-1,this.hammerPullOriginNoteId=-1,this.slideTargetNoteId=-1,this.slideOriginNoteId=-1}}var Ci;(function(s){s[s.Effects=0]="Effects",s[s.StandardNotationNoteHead=1]="StandardNotationNoteHead",s[s.StandardNotationAccidentals=2]="StandardNotationAccidentals",s[s.StandardNotationEffects=3]="StandardNotationEffects",s[s.GuitarTabFretNumber=4]="GuitarTabFretNumber",s[s.GuitarTabEffects=5]="GuitarTabEffects",s[s.SlashNoteHead=6]="SlashNoteHead",s[s.SlashEffects=7]="SlashEffects",s[s.NumberedNumber=8]="NumberedNumber",s[s.NumberedAccidentals=9]="NumberedAccidentals",s[s.NumberedEffects=10]="NumberedEffects"})(Ci||(Ci={}));class Kw extends Qo{}class bt{constructor(){this.id=bt.GlobalNoteId++,this.index=0,this.accentuated=_t.None,this.bendType=q.None,this.bendStyle=Xe.Default,this.bendOrigin=null,this.isContinuedBend=!1,this.bendPoints=null,this.maxBendPoint=null,this.fret=-1,this.string=-1,this.showStringNumber=!1,this.octave=-1,this.tone=-1,this.percussionArticulation=-1,this.isVisible=!0,this.isLeftHandTapped=!1,this.isHammerPullOrigin=!1,this.hammerPullOrigin=null,this.hammerPullDestination=null,this.isSlurDestination=!1,this.slurOrigin=null,this.slurDestination=null,this.harmonicType=ae.None,this.harmonicValue=0,this.isGhost=!1,this.isLetRing=!1,this.letRingDestination=null,this.isPalmMute=!1,this.palmMuteDestination=null,this.isDead=!1,this.isStaccato=!1,this.slideInType=jt.None,this.slideOutType=pe.None,this.slideTarget=null,this.slideOrigin=null,this.vibrato=ve.None,this.tieOrigin=null,this.tieDestination=null,this.isTieDestination=!1,this.leftHandFinger=ie.Unknown,this.rightHandFinger=ie.Unknown,this.trillValue=-1,this.trillSpeed=w.ThirtySecond,this.durationPercent=1,this.accidentalMode=ke.Default,this.dynamics=j.F,this.isEffectSlurOrigin=!1,this.hasEffectSlur=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.ornament=Tt.None,this._noteIdBag=null}static resetIds(){bt.GlobalNoteId=0}get hasBend(){return this.bendPoints!==null&&this.bendType!==q.None}get isStringed(){return this.string>=0}get isPiano(){return!this.isStringed&&this.octave>=0&&this.tone>=0}get isPercussion(){return!this.isStringed&&this.percussionArticulation>=0}get element(){return this.isPercussion?At.getElementAndVariation(this)[0]:-1}get variation(){return this.isPercussion?At.getElementAndVariation(this)[1]:-1}get isHammerPullDestination(){return!!this.hammerPullOrigin}get isSlurOrigin(){return!!this.slurDestination}get isHarmonic(){return this.harmonicType!==ae.None}get isTieOrigin(){return this.tieDestination!==null}get isFingering(){return this.leftHandFinger!==ie.Unknown||this.rightHandFinger!==ie.Unknown}get trillFret(){return this.trillValue-this.stringTuning}get isTrill(){return this.trillValue>=0}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get stringTuning(){return this.beat.voice.bar.staff.capo+bt.getStringTuning(this.beat.voice.bar.staff,this.string)}static getStringTuning(e,t){return e.tuning.length>0?e.tuning[e.tuning.length-(t-1)-1]:0}get realValue(){return this.calculateRealValue(!0,!0)}get realValueWithoutHarmonic(){return this.calculateRealValue(!0,!1)}calculateRealValue(e,t){const i=e?this.beat.voice.bar.staff.transpositionPitch:0;if(t){let a=this.calculateRealValue(e,!1);return this.isStringed&&(this.harmonicType===ae.Natural?a=this.harmonicPitch+this.stringTuning-i:a+=this.harmonicPitch),a}return this.isPercussion?this.percussionArticulation:this.isStringed?this.fret+this.stringTuning-i:this.isPiano?this.octave*12+this.tone-i:0}get harmonicPitch(){if(this.harmonicType===ae.None||!this.isStringed)return 0;const e=this.harmonicValue;return V.isAlmostEqualTo(e,2.4)?36:V.isAlmostEqualTo(e,2.7)?34:e<3?0:e<=3.5?31:e<=4?28:e<=5?24:e<=6?34:e<=7?19:e<=8.5?36:e<=9?28:e<=10?34:e<=11?0:e<=12?12:e<14?0:e<=15?34:e<=16?28:e<=17?36:e<=18?0:e<=19?19:e<=21?0:e<=22?36:e<=24?24:0}get initialBendValue(){return this.hasBend?Math.floor(this.bendPoints[0].value/2):this.bendOrigin?Math.floor(this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value/2):this.isTieDestination&&this.tieOrigin.bendOrigin?Math.floor(this.tieOrigin.bendOrigin.bendPoints[this.tieOrigin.bendOrigin.bendPoints.length-1].value/2):this.beat.hasWhammyBar?Math.floor(this.beat.whammyBarPoints[0].value/2):this.beat.isContinuedWhammy?Math.floor(this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value/2):0}get displayValue(){return this.displayValueWithoutBend+this.initialBendValue}get displayValueWithoutBend(){let e=this.realValue;switch(this.harmonicType!==ae.Natural&&this.harmonicType!==ae.None&&(e-=this.harmonicPitch),this.beat.ottava){case fe._15ma:e-=24;break;case fe._8va:e-=12;break;case fe.Regular:break;case fe._8vb:e+=12;break;case fe._15mb:e+=24;break}switch(this.beat.voice.bar.clefOttava){case fe._15ma:e-=24;break;case fe._8va:e-=12;break;case fe.Regular:break;case fe._8vb:e+=12;break;case fe._15mb:e+=24;break}return e-this.beat.voice.bar.staff.displayTranspositionPitch}get hasQuarterToneOffset(){return this.hasBend?this.bendPoints[0].value%2!==0:this.bendOrigin?this.bendOrigin.bendPoints[this.bendOrigin.bendPoints.length-1].value%2!==0:this.beat.hasWhammyBar?this.beat.whammyBarPoints[0].value%2!==0:this.beat.isContinuedWhammy?this.beat.previousBeat.whammyBarPoints[this.beat.previousBeat.whammyBarPoints.length-1].value%2!==0:!1}addBendPoint(e){let t=this.bendPoints;t===null&&(t=[],this.bendPoints=t),t.push(e),(!this.maxBendPoint||e.value>this.maxBendPoint.value)&&(this.maxBendPoint=e),this.bendType===q.None&&(this.bendType=q.Custom)}finish(e,t=null){const i=new Fh(()=>bt.nextNoteOnSameLine(this)),a=e&&e.notation.notationMode===ai.SongBook;if(this.isTieDestination&&(this.chain(t),a&&this.tieOrigin&&this.tieOrigin.isLetRing&&(this.isLetRing=!0)),this.isLetRing&&(!i.value||!i.value.isLetRing?this.letRingDestination=this:this.letRingDestination=i.value,a&&this.isTieDestination&&!this.tieOrigin.hasBend&&(this.isVisible=!1)),this.isPalmMute&&(!i.value||!i.value.isPalmMute?this.palmMuteDestination=this:this.palmMuteDestination=i.value),this.isHammerPullOrigin){const l=bt.findHammerPullDestination(this);l?(this.hammerPullDestination=l,l.hammerPullOrigin=this):this.isHammerPullOrigin=!1}switch(this.slideOutType){case pe.Shift:case pe.Legato:this.slideTarget||(this.slideTarget=i.value),this.slideTarget?this.slideTarget.slideOrigin=this:this.slideOutType=pe.None;break}let n=null;this.isHammerPullOrigin&&this.hammerPullDestination?n=this.hammerPullDestination:this.slideOutType===pe.Legato&&this.slideTarget&&(n=this.slideTarget),n&&(this.hasEffectSlur=!0,this.effectSlurOrigin&&this.beat.pickStroke===ni.None?(this.effectSlurOrigin.effectSlurDestination=n,this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin,this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=n,this.effectSlurDestination.effectSlurOrigin=this));const r=this.bendPoints,o=r!=null&&r.length>0;if(o){const l=this.isTieDestination&&this.tieOrigin.hasBend;this.isContinuedBend=l}else this.bendType=q.None;if(o&&this.bendType===q.Custom){if(r.length===4){const l=r[0],h=r[1],c=r[2],d=r[3];h.value===c.value?d.value>l.value?h.value>d.value?this.bendType=q.BendRelease:!this.isContinuedBend&&l.value>0?(this.bendType=q.PrebendBend,r.splice(2,1),r.splice(1,1)):(this.bendType=q.Bend,r.splice(2,1),r.splice(1,1)):d.value<l.value?this.isContinuedBend?(this.bendType=q.Release,r.splice(2,1),r.splice(1,1)):(this.bendType=q.PrebendRelease,r.splice(2,1),r.splice(1,1)):h.value>l.value?this.bendType=q.BendRelease:l.value>0&&!this.isContinuedBend?(this.bendType=q.Prebend,r.splice(2,1),r.splice(1,1)):(this.bendType=q.Hold,r.splice(2,1),r.splice(1,1)):E.warning("Model","Unsupported bend type detected, fallback to custom",null)}else if(r.length===2){const l=r[0],h=r[1];h.value>l.value?!this.isContinuedBend&&l.value>0?this.bendType=q.PrebendBend:this.bendType=q.Bend:h.value<l.value?this.isContinuedBend?this.bendType=q.Release:this.bendType=q.PrebendRelease:l.value>0&&!this.isContinuedBend?this.bendType=q.Prebend:this.bendType=q.Hold}}this.initialBendValue>0&&(this.accidentalMode=ke.Default)}static nextNoteOnSameLine(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+bt.MaxOffsetForSameLineSearch;){const i=t.getNoteOnString(e.string);if(i)return i;t=t.nextBeat}return null}static findHammerPullDestination(e){let t=e.beat.nextBeat;for(;t&&t.voice.bar.index<=e.beat.voice.bar.index+bt.MaxOffsetForSameLineSearch;){let i=t.getNoteOnString(e.string);if(i)return i;for(let a=e.string;a>0;a--)if(i=t.getNoteOnString(a),i){if(i.isLeftHandTapped)return i;break}for(let a=e.string;a<=e.beat.voice.bar.staff.tuning.length;a++)if(i=t.getNoteOnString(a),i){if(i.isLeftHandTapped)return i;break}t=t.nextBeat}return null}static findTieOrigin(e){let t=e.beat.previousBeat;for(;t&&t.voice.bar.index>=e.beat.voice.bar.index-bt.MaxOffsetForSameLineSearch;){if(e.isStringed){const i=t.getNoteOnString(e.string);if(i)return i}else if(e.octave===-1&&e.tone===-1){if(e.index<t.notes.length)return t.notes[e.index]}else{const i=t.getNoteWithRealValue(e.realValue);if(i)return i}t=t.previousBeat}return null}chain(e=null){if(e!==null)if(this._noteIdBag!==null){let t;e.has(bt.NoteIdLookupKey)?t=e.get(bt.NoteIdLookupKey):(t=new Map,e.set(bt.NoteIdLookupKey,t)),(this._noteIdBag.hammerPullDestinationNoteId!==-1||this._noteIdBag.tieDestinationNoteId!==-1||this._noteIdBag.slurDestinationNoteId!==-1||this._noteIdBag.slideTargetNoteId!==-1)&&t.set(this.id,this),this._noteIdBag.hammerPullOriginNoteId!==-1&&(this.hammerPullOrigin=t.get(this._noteIdBag.hammerPullOriginNoteId),this.hammerPullOrigin.hammerPullDestination=this),this._noteIdBag.tieOriginNoteId!==-1&&(this.tieOrigin=t.get(this._noteIdBag.tieOriginNoteId),this.tieOrigin.tieDestination=this),this._noteIdBag.slurOriginNoteId!==-1&&(this.slurOrigin=t.get(this._noteIdBag.slurOriginNoteId),this.slurOrigin.slurDestination=this),this._noteIdBag.slideOriginNoteId!==-1&&(this.slideOrigin=t.get(this._noteIdBag.slideOriginNoteId),this.slideOrigin.slideTarget=this),this._noteIdBag=null}else{if(!this.isTieDestination&&this.tieOrigin===null)return;const t=this.tieOrigin??bt.findTieOrigin(this);t?(t.tieDestination=this,this.tieOrigin=t,this.fret=t.fret,this.octave=t.octave,this.tone=t.tone,t.hasBend&&(this.bendOrigin=this.tieOrigin)):this.isTieDestination=!1}}toJson(e){this.tieDestination!==null&&e.set("tiedestinationnoteid",this.tieDestination.id),this.tieOrigin!==null&&e.set("tieoriginnoteid",this.tieOrigin.id),this.slurDestination!==null&&e.set("slurdestinationnoteid",this.slurDestination.id),this.slurOrigin!==null&&e.set("sluroriginnoteid",this.slurOrigin.id),this.hammerPullOrigin!==null&&e.set("hammerpulloriginnoteid",this.hammerPullOrigin.id),this.hammerPullDestination!==null&&e.set("hammerpulldestinationnoteid",this.hammerPullDestination.id),this.slideTarget!==null&&e.set("slidetargetnoteid",this.slideTarget.id),this.slideOrigin!==null&&e.set("slideoriginnoteid",this.slideOrigin.id)}setProperty(e,t){switch(e){case"tiedestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new wn),this._noteIdBag.tieDestinationNoteId=t,!0;case"tieoriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new wn),this._noteIdBag.tieOriginNoteId=t,!0;case"slurdestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new wn),this._noteIdBag.slurDestinationNoteId=t,!0;case"sluroriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new wn),this._noteIdBag.slurOriginNoteId=t,!0;case"hammerpulloriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new wn),this._noteIdBag.hammerPullOriginNoteId=t,!0;case"hammerpulldestinationnoteid":return this._noteIdBag==null&&(this._noteIdBag=new wn),this._noteIdBag.hammerPullDestinationNoteId=t,!0;case"slidetargetnoteid":return this._noteIdBag==null&&(this._noteIdBag=new wn),this._noteIdBag.slideTargetNoteId=t,!0;case"slideoriginnoteid":return this._noteIdBag==null&&(this._noteIdBag=new wn),this._noteIdBag.slideOriginNoteId=t,!0}return!1}}bt.GlobalNoteId=0;bt.MaxOffsetForSameLineSearch=3;bt.NoteIdLookupKey="NoteIdLookup";class mi{constructor(e){this._isEqualLengthTuplet=!0,this.totalDuration=0,this.beats=[],this.isFull=!1,this.voice=e}check(e){if(this.beats.length===0)return this.beats.push(e),this.totalDuration+=e.playbackDuration,!0;if(e.graceType!==se.None)return!0;if(e.voice!==this.voice||this.isFull||e.tupletNumerator!==this.beats[0].tupletNumerator||e.tupletDenominator!==this.beats[0].tupletDenominator)return!1;if(e.playbackDuration!==this.beats[0].playbackDuration&&(this._isEqualLengthTuplet=!1),this.beats.push(e),this.totalDuration+=e.playbackDuration,this._isEqualLengthTuplet)this.beats.length===this.beats[0].tupletNumerator&&(this.isFull=!0);else{const t=this.beats[0].tupletNumerator/this.beats[0].tupletDenominator|0;for(const i of mi.AllTicks)if(this.totalDuration===i*t){this.isFull=!0;break}}return!0}}mi.HalfTicks=1920;mi.QuarterTicks=960;mi.EighthTicks=480;mi.SixteenthTicks=240;mi.ThirtySecondTicks=120;mi.SixtyFourthTicks=60;mi.OneHundredTwentyEighthTicks=30;mi.TwoHundredFiftySixthTicks=15;mi.AllTicks=[mi.HalfTicks,mi.QuarterTicks,mi.EighthTicks,mi.SixteenthTicks,mi.ThirtySecondTicks,mi.SixtyFourthTicks,mi.OneHundredTwentyEighthTicks,mi.TwoHundredFiftySixthTicks];var De;(function(s){s[s.None=0]="None",s[s.Custom=1]="Custom",s[s.Dive=2]="Dive",s[s.Dip=3]="Dip",s[s.Hold=4]="Hold",s[s.Predive=5]="Predive",s[s.PrediveDive=6]="PrediveDive"})(De||(De={}));class $w{static clone(e){const t=new H;return t.offset=e.offset,t.value=e.value,t}}class Zw{static clone(e){const t=new bt;if(t.index=e.index,t.accentuated=e.accentuated,t.bendType=e.bendType,t.bendStyle=e.bendStyle,t.isContinuedBend=e.isContinuedBend,e.bendPoints){t.bendPoints=[];for(const i of e.bendPoints)t.addBendPoint($w.clone(i))}return t.fret=e.fret,t.string=e.string,t.showStringNumber=e.showStringNumber,t.octave=e.octave,t.tone=e.tone,t.percussionArticulation=e.percussionArticulation,t.isVisible=e.isVisible,t.isLeftHandTapped=e.isLeftHandTapped,t.isHammerPullOrigin=e.isHammerPullOrigin,t.isSlurDestination=e.isSlurDestination,t.harmonicType=e.harmonicType,t.harmonicValue=e.harmonicValue,t.isGhost=e.isGhost,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.isDead=e.isDead,t.isStaccato=e.isStaccato,t.slideInType=e.slideInType,t.slideOutType=e.slideOutType,t.vibrato=e.vibrato,t.isTieDestination=e.isTieDestination,t.leftHandFinger=e.leftHandFinger,t.rightHandFinger=e.rightHandFinger,t.trillValue=e.trillValue,t.trillSpeed=e.trillSpeed,t.durationPercent=e.durationPercent,t.accidentalMode=e.accidentalMode,t.dynamics=e.dynamics,t.ornament=e.ornament,t}}class Dx{static clone(e){const t=new ju;return t.barOccurence=e.barOccurence,t.millisecondOffset=e.millisecondOffset,t}}class Px{static clone(e){const t=new wt;return t.isLinear=e.isLinear,t.type=e.type,t.value=e.value,t.syncPointValue=e.syncPointValue?Dx.clone(e.syncPointValue):void 0,t.ratioPosition=e.ratioPosition,t.text=e.text,t}}class Cg{static clone(e){const t=new Wt;t.index=e.index,t.notes=[];for(const i of e.notes)t.addNote(Zw.clone(i));t.isEmpty=e.isEmpty,t.whammyStyle=e.whammyStyle,t.ottava=e.ottava,t.isLegatoOrigin=e.isLegatoOrigin,t.duration=e.duration,t.isLetRing=e.isLetRing,t.isPalmMute=e.isPalmMute,t.automations=[];for(const i of e.automations)t.automations.push(Px.clone(i));if(t.dots=e.dots,t.fade=e.fade,t.lyrics=e.lyrics?e.lyrics.slice():null,t.pop=e.pop,t.slap=e.slap,t.tap=e.tap,t.text=e.text,t.slashed=e.slashed,t.deadSlapped=e.deadSlapped,t.brushType=e.brushType,t.brushDuration=e.brushDuration,t.tupletDenominator=e.tupletDenominator,t.tupletNumerator=e.tupletNumerator,t.isContinuedWhammy=e.isContinuedWhammy,t.whammyBarType=e.whammyBarType,e.whammyBarPoints){t.whammyBarPoints=[];for(const i of e.whammyBarPoints)t.addWhammyBarPoint($w.clone(i))}return t.vibrato=e.vibrato,t.chordId=e.chordId,t.graceType=e.graceType,t.pickStroke=e.pickStroke,t.tremoloSpeed=e.tremoloSpeed,t.crescendo=e.crescendo,t.displayStart=e.displayStart,t.playbackStart=e.playbackStart,t.displayDuration=e.displayDuration,t.playbackDuration=e.playbackDuration,t.overrideDisplayDuration=e.overrideDisplayDuration,t.golpe=e.golpe,t.dynamics=e.dynamics,t.invertBeamDirection=e.invertBeamDirection,t.preferredBeamDirection=e.preferredBeamDirection,t.isEffectSlurOrigin=e.isEffectSlurOrigin,t.beamingMode=e.beamingMode,t.wahPedal=e.wahPedal,t.barreFret=e.barreFret,t.barreShape=e.barreShape,t.rasgueado=e.rasgueado,t.showTimer=e.showTimer,t.timer=e.timer,t}}var Ji;(function(s){s[s.None=0]="None",s[s.Thumb=1]="Thumb",s[s.Finger=2]="Finger"})(Ji||(Ji={}));var qt;(function(s){s[s.None=0]="None",s[s.FadeIn=1]="FadeIn",s[s.FadeOut=2]="FadeOut",s[s.VolumeSwell=3]="VolumeSwell"})(qt||(qt={}));var ls;(function(s){s[s.None=0]="None",s[s.Open=1]="Open",s[s.Closed=2]="Closed"})(ls||(ls={}));var ns;(function(s){s[s.None=0]="None",s[s.Full=1]="Full",s[s.Half=2]="Half"})(ns||(ns={}));var X;(function(s){s[s.None=0]="None",s[s.Ii=1]="Ii",s[s.Mi=2]="Mi",s[s.MiiTriplet=3]="MiiTriplet",s[s.MiiAnapaest=4]="MiiAnapaest",s[s.PmpTriplet=5]="PmpTriplet",s[s.PmpAnapaest=6]="PmpAnapaest",s[s.PeiTriplet=7]="PeiTriplet",s[s.PeiAnapaest=8]="PeiAnapaest",s[s.PaiTriplet=9]="PaiTriplet",s[s.PaiAnapaest=10]="PaiAnapaest",s[s.AmiTriplet=11]="AmiTriplet",s[s.AmiAnapaest=12]="AmiAnapaest",s[s.Ppp=13]="Ppp",s[s.Amii=14]="Amii",s[s.Amip=15]="Amip",s[s.Eami=16]="Eami",s[s.Eamii=17]="Eamii",s[s.Peami=18]="Peami"})(X||(X={}));var it;(function(s){s[s.Auto=0]="Auto",s[s.ForceSplitToNext=1]="ForceSplitToNext",s[s.ForceMergeWithNext=2]="ForceMergeWithNext",s[s.ForceSplitOnSecondaryToNext=3]="ForceSplitOnSecondaryToNext"})(it||(it={}));var qe;(function(s){s[s.Effects=0]="Effects",s[s.StandardNotationStem=1]="StandardNotationStem",s[s.StandardNotationFlags=2]="StandardNotationFlags",s[s.StandardNotationBeams=3]="StandardNotationBeams",s[s.StandardNotationTuplet=4]="StandardNotationTuplet",s[s.StandardNotationEffects=5]="StandardNotationEffects",s[s.StandardNotationRests=6]="StandardNotationRests",s[s.GuitarTabStem=7]="GuitarTabStem",s[s.GuitarTabFlags=8]="GuitarTabFlags",s[s.GuitarTabBeams=9]="GuitarTabBeams",s[s.GuitarTabTuplet=10]="GuitarTabTuplet",s[s.GuitarTabEffects=11]="GuitarTabEffects",s[s.GuitarTabRests=12]="GuitarTabRests",s[s.SlashStem=13]="SlashStem",s[s.SlashFlags=14]="SlashFlags",s[s.SlashBeams=15]="SlashBeams",s[s.SlashTuplet=16]="SlashTuplet",s[s.SlashRests=17]="SlashRests",s[s.SlashEffects=18]="SlashEffects",s[s.NumberedDuration=19]="NumberedDuration",s[s.NumberedEffects=20]="NumberedEffects",s[s.NumberedRests=21]="NumberedRests",s[s.NumberedTuplet=22]="NumberedTuplet"})(qe||(qe={}));class Lx extends Qo{}class Wt{constructor(){this.id=Wt._globalBeatId++,this.index=0,this.previousBeat=null,this.nextBeat=null,this.notes=[],this.noteStringLookup=new Map,this.noteValueLookup=new Map,this.isEmpty=!1,this.whammyStyle=Xe.Default,this.ottava=fe.Regular,this.fermata=null,this.isLegatoOrigin=!1,this.minNote=null,this.maxNote=null,this.maxStringNote=null,this.minStringNote=null,this.duration=w.Quarter,this.isLetRing=!1,this.isPalmMute=!1,this.automations=[],this.dots=0,this.fade=qt.None,this.lyrics=null,this.pop=!1,this.slap=!1,this.tap=!1,this.text=null,this.slashed=!1,this.deadSlapped=!1,this.brushType=Y.None,this.brushDuration=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.tupletGroup=null,this.isContinuedWhammy=!1,this.whammyBarType=De.None,this.whammyBarPoints=null,this.maxWhammyPoint=null,this.minWhammyPoint=null,this.vibrato=ve.None,this.chordId=null,this.graceType=se.None,this.graceGroup=null,this.graceIndex=-1,this.pickStroke=ni.None,this.tremoloSpeed=null,this.crescendo=vi.None,this.displayStart=0,this.playbackStart=0,this.displayDuration=0,this.playbackDuration=0,this.golpe=Ji.None,this.dynamics=j.F,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isEffectSlurOrigin=!1,this.effectSlurOrigin=null,this.effectSlurDestination=null,this.beamingMode=it.Auto,this.wahPedal=ls.None,this.barreFret=-1,this.barreShape=ns.None,this.rasgueado=X.None,this.showTimer=!1,this.timer=null}static resetIds(){Wt._globalBeatId=0}get isLastOfVoice(){return this.index===this.voice.beats.length-1}get isLegatoDestination(){return!!this.previousBeat&&this.previousBeat.isLegatoOrigin}get isRest(){return this.isEmpty||!this.deadSlapped&&this.notes.length===0}get isFullBarRest(){return this.isRest&&this.voice.beats.length===1&&this.duration===w.Whole}get fadeIn(){return this.fade===qt.FadeIn}set fadeIn(e){this.fade=e?qt.FadeIn:qt.None}get hasRasgueado(){return this.rasgueado!==X.None}get hasTuplet(){return!(this.tupletDenominator===-1&&this.tupletNumerator===-1)&&!(this.tupletDenominator===1&&this.tupletNumerator===1)}get hasWhammyBar(){return this.whammyBarPoints!==null&&this.whammyBarType!==De.None}get hasChord(){return!!this.chordId}get chord(){return this.chordId?this.voice.bar.staff.getChord(this.chordId):null}get isTremolo(){return!!this.tremoloSpeed}get displayEnd(){return this.displayStart+this.displayDuration}get absoluteDisplayStart(){return this.voice.bar.masterBar.start+this.displayStart}get absolutePlaybackStart(){return this.voice.bar.masterBar.start+this.playbackStart}get isEffectSlurDestination(){return!!this.effectSlurOrigin}get isBarre(){return this.barreShape!==ns.None&&this.barreFret>=0}addWhammyBarPoint(e){let t=this.whammyBarPoints;t===null&&(t=[],this.whammyBarPoints=t),t.push(e),(!this.maxWhammyPoint||e.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=e),(!this.minWhammyPoint||e.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=e),this.whammyBarType===De.None&&(this.whammyBarType=De.Custom)}removeWhammyBarPoint(e){const t=this.whammyBarPoints;if(t===null||e<0||e>=t.length)return;t.splice(e,1);const i=t[e];if(i===this.maxWhammyPoint){this.maxWhammyPoint=null;for(const a of t)(!this.maxWhammyPoint||a.value>this.maxWhammyPoint.value)&&(this.maxWhammyPoint=a)}if(i===this.minWhammyPoint){this.minWhammyPoint=null;for(const a of t)(!this.minWhammyPoint||a.value<this.minWhammyPoint.value)&&(this.minWhammyPoint=a)}}addNote(e){e.beat=this,e.index=this.notes.length,this.notes.push(e),e.isStringed&&this.noteStringLookup.set(e.string,e)}removeNote(e){const t=this.notes.indexOf(e);t>=0&&(this.notes.splice(t,1),e.isStringed&&this.noteStringLookup.delete(e.string))}getAutomation(e){for(let t=0,i=this.automations.length;t<i;t++){const a=this.automations[t];if(a.type===e)return a}return null}getNoteOnString(e){return this.noteStringLookup.has(e)?this.noteStringLookup.get(e):null}calculateDuration(){if(this.overrideDisplayDuration!==void 0)return this.overrideDisplayDuration;if(this.isFullBarRest)return this.voice.bar.masterBar.calculateDuration();let e=v.toTicks(this.duration);return this.dots===2?e=v.applyDot(e,!0):this.dots===1&&(e=v.applyDot(e,!1)),this.tupletDenominator>0&&this.tupletNumerator>=0&&(e=v.applyTuplet(e,this.tupletNumerator,this.tupletDenominator)),e}updateDurations(){const e=this.calculateDuration();switch(this.playbackDuration=e,this.graceType){case se.BeforeBeat:case se.OnBeat:switch(this.duration){case w.Sixteenth:this.playbackDuration=v.toTicks(w.SixtyFourth);break;case w.ThirtySecond:this.playbackDuration=v.toTicks(w.OneHundredTwentyEighth);break;default:this.playbackDuration=v.toTicks(w.ThirtySecond);break}this.displayDuration=0;break;case se.BendGrace:this.playbackDuration/=2,this.displayDuration=0;break;default:this.displayDuration=e;const t=this.previousBeat;t&&t.graceType===se.BendGrace&&(this.playbackDuration=t.playbackDuration);break}}finishTuplet(){const e=this.previousBeat;let t=e?e.tupletGroup:null;if((this.hasTuplet||this.graceType!==se.None&&t)&&((!e||!t||!t.check(this))&&(t=new mi(this.voice),t.check(this)),this.tupletGroup=t),this.index>0){const i=this.voice.bar.masterBar.calculateDuration(),a=[];for(const n of this.automations)n.ratioPosition===0&&(n.ratioPosition=this.playbackStart/i),n.type!==tt.Volume&&a.push(n);this.automations=a}}finish(e,t=null){switch(this.getAutomation(tt.Instrument)===null&&this.index===0&&this.voice.index===0&&this.voice.bar.index===0&&this.voice.bar.staff.index===0&&this.automations.push(wt.buildInstrumentAutomation(!1,0,this.voice.bar.staff.track.playbackInfo.program)),this.graceType){case se.OnBeat:case se.BeforeBeat:const c=this.graceGroup.beats.length;c===1?this.duration=w.Eighth:c===2?this.duration=w.Sixteenth:this.duration=w.ThirtySecond;break}const i=e?e.notation.notationMode:ai.GuitarPro;let a=this.text==="grad"||this.text==="grad.";a&&i===ai.SongBook&&(this.text="");let n=!1;this.minNote=null,this.maxNote=null,this.minStringNote=null,this.maxStringNote=null;let r=0,o=!1;for(let c=0,d=this.notes.length;c<d;c++){const f=this.notes[c];if(f.dynamics=this.dynamics,f.finish(e,t),f.isLetRing&&(this.isLetRing=!0),f.isPalmMute&&(this.isPalmMute=!0),i===ai.SongBook&&f.hasBend&&this.graceType!==se.BendGrace){if(!f.isTieOrigin)switch(f.bendType){case q.Bend:case q.PrebendRelease:case q.PrebendBend:n=!0;break}a||f.bendStyle===Xe.Gradual?(a=!0,f.bendStyle=Xe.Gradual,n=!1):f.bendStyle=Xe.Fast}f.isVisible&&(r++,(!this.minNote||f.realValue<this.minNote.realValue)&&(this.minNote=f),(!this.maxNote||f.realValue>this.maxNote.realValue)&&(this.maxNote=f),(!this.minStringNote||f.string<this.minStringNote.string)&&(this.minStringNote=f),(!this.maxStringNote||f.string>this.maxStringNote.string)&&(this.maxStringNote=f),f.hasEffectSlur&&(o=!0))}if(o&&(this.effectSlurOrigin?(this.effectSlurOrigin.effectSlurDestination=this.nextBeat,this.effectSlurOrigin.effectSlurDestination&&(this.effectSlurOrigin.effectSlurDestination.effectSlurOrigin=this.effectSlurOrigin),this.effectSlurOrigin=null):(this.isEffectSlurOrigin=!0,this.effectSlurDestination=this.nextBeat,this.effectSlurDestination&&(this.effectSlurDestination.effectSlurOrigin=this))),this.notes.length>0&&r===0&&(this.isEmpty=!0),!this.isRest&&(!this.isLetRing||!this.isPalmMute)){let c=this.previousBeat;for(;c&&c.isRest;)this.isLetRing||(c.isLetRing=!1),this.isPalmMute||(c.isPalmMute=!1),c=c.previousBeat}else this.isRest&&this.previousBeat&&e&&e.notation.notationMode===ai.GuitarPro&&(this.previousBeat.isLetRing&&(this.isLetRing=!0),this.previousBeat.isPalmMute&&(this.isPalmMute=!0));const l=this.whammyBarPoints,h=l!==null&&l.length>0;if(h){const c=!!this.previousBeat&&this.previousBeat.hasWhammyBar;this.isContinuedWhammy=c}else this.whammyBarType=De.None;if(h&&this.whammyBarType===De.Custom&&(i===ai.SongBook&&(this.whammyStyle=a?Xe.Gradual:Xe.Fast),l.length===4)){const c=l[0],d=l[1],f=l[2],p=l[3];d.value===f.value&&(c.value<d.value&&d.value<p.value||c.value>d.value&&d.value>p.value?(c.value!==0&&!this.isContinuedWhammy?this.whammyBarType=De.PrediveDive:this.whammyBarType=De.Dive,l.splice(2,1),l.splice(1,1)):c.value>d.value&&d.value<p.value||c.value<d.value&&d.value>p.value?(this.whammyBarType=De.Dip,(d.offset===f.offset||i===ai.SongBook)&&l.splice(2,1)):c.value===d.value&&d.value===p.value&&(c.value!==0&&!this.isContinuedWhammy?this.whammyBarType=De.Predive:this.whammyBarType=De.Hold,l.splice(2,1),l.splice(1,1)))}if(this.updateDurations(),n){const c=Cg.clone(this);c.id=Wt._globalBeatId++,c.pickStroke=ni.None;for(let d=0,f=c.notes.length;d<f;d++){const p=c.notes[d],g=this.notes[d];if(p.bendType=q.None,p.maxBendPoint=null,p.bendPoints=null,p.bendStyle=Xe.Default,p.id=bt.GlobalNoteId++,g.isTieOrigin&&(p.tieDestination=g.tieDestination,g.tieDestination.tieOrigin=p),g.isTieDestination&&(p.tieOrigin=g.tieOrigin?g.tieOrigin:null,g.tieOrigin.tieDestination=p),g.hasBend&&g.isTieOrigin){const m=bt.findTieOrigin(g);if(m&&m.hasBend){p.bendType=q.Hold;const T=g.bendPoints[g.bendPoints.length-1];p.addBendPoint(new H(0,T.value)),p.addBendPoint(new H(H.MaxPosition,T.value))}}p.isTieDestination=!0}this.graceType=se.BendGrace,this.graceGroup=new op,this.graceGroup.addBeat(this),this.graceGroup.isComplete=!0,this.graceGroup.finish(),this.updateDurations(),this.voice.insertBeat(this,c),c.graceGroup=new op,c.graceGroup.addBeat(this),c.graceGroup.isComplete=!0,c.graceGroup.finish()}}isBefore(e){return this.voice.bar.index<e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index<e.index}isAfter(e){return this.voice.bar.index>e.voice.bar.index||e.voice.bar.index===this.voice.bar.index&&this.index>e.index}hasNoteOnString(e){return this.noteStringLookup.has(e)}getNoteWithRealValue(e){return this.noteValueLookup.has(e)?this.noteValueLookup.get(e):null}chain(e=null){for(const t of this.notes)this.noteValueLookup.set(t.realValue,t),t.chain(e)}}Wt._globalBeatId=0;var z;(function(s){s[s.Title=0]="Title",s[s.SubTitle=1]="SubTitle",s[s.Artist=2]="Artist",s[s.Album=3]="Album",s[s.Words=4]="Words",s[s.Music=5]="Music",s[s.WordsAndMusic=6]="WordsAndMusic",s[s.Transcriber=7]="Transcriber",s[s.Copyright=8]="Copyright",s[s.CopyrightSecondLine=9]="CopyrightSecondLine",s[s.ChordDiagramList=10]="ChordDiagramList"})(z||(z={}));class is{constructor(e="",t=void 0,i=Q.Left){this.template=e,this.isVisible=t,this.textAlign=i}buildText(e){let t=!1,i=!1;const a=this.template.replace(is.PlaceholderPattern,(n,r)=>{i=!0;let o="";switch(r){case"TITLE":o=e.title;break;case"SUBTITLE":o=e.subTitle;break;case"ARTIST":o=e.artist;break;case"ALBUM":o=e.album;break;case"WORDS":case"WORDSMUSIC":o=e.words;break;case"MUSIC":o=e.music;break;case"TABBER":o=e.tab;break;case"COPYRIGHT":o=e.copyright;break;default:o="";break}return o&&(t=!0),o});return i&&!t?"":a}}is.PlaceholderPattern=/%([^%]+)%/g;class ko extends Qo{constructor(){super(...arguments),this.headerAndFooter=new Map}}ko.defaultHeaderAndFooter=new Map([[z.Title,new is("%TITLE%",void 0,Q.Center)],[z.SubTitle,new is("%SUBTITLE%",void 0,Q.Center)],[z.Artist,new is("%ARTIST%",void 0,Q.Center)],[z.Album,new is("%ALBUM%",void 0,Q.Center)],[z.Words,new is("Words by %WORDS%",void 0,Q.Left)],[z.Music,new is("Music by %MUSIC%",void 0,Q.Right)],[z.WordsAndMusic,new is("Words & Music by %MUSIC%",void 0,Q.Right)],[z.Transcriber,new is("Tabbed by %TABBER%",!1,Q.Right)],[z.Copyright,new is("%COPYRIGHT%",void 0,Q.Center)],[z.CopyrightSecondLine,new is("All Rights Reserved - International Copyright Secured",!0,Q.Center)]]);class fn{constructor(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0,this.album="",this.artist="",this.copyright="",this.instructions="",this.music="",this.notices="",this.subTitle="",this.title="",this.words="",this.tab="",this.tempo=120,this.tempoLabel="",this.masterBars=[],this.tracks=[],this.defaultSystemsLayout=3,this.systemsLayout=[],this.stylesheet=new xx}static resetIds(){qi.resetIds(),Wt.resetIds(),Bs.resetIds(),bt.resetIds()}rebuildRepeatGroups(){this._currentRepeatGroup=null,this._openedRepeatGroups=[],this._properlyOpenedRepeatGroups=0;for(const e of this.masterBars)this.addMasterBarToRepeatGroups(e)}addMasterBar(e){e.score=this,e.index=this.masterBars.length,this.masterBars.length!==0&&(e.previousMasterBar=this.masterBars[this.masterBars.length-1],e.previousMasterBar.nextMasterBar=e,e.start=e.previousMasterBar.start+(e.previousMasterBar.isAnacrusis?0:e.previousMasterBar.calculateDuration())),this.addMasterBarToRepeatGroups(e),this.masterBars.push(e)}addMasterBarToRepeatGroups(e){var t;e.isRepeatStart?((t=this._currentRepeatGroup)!=null&&t.isClosed&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--),this._currentRepeatGroup=new Ly,this._openedRepeatGroups.push(this._currentRepeatGroup),this._properlyOpenedRepeatGroups++):this._currentRepeatGroup||(this._currentRepeatGroup=new Ly,this._openedRepeatGroups.push(this._currentRepeatGroup)),this._currentRepeatGroup.addMasterBar(e),e.isRepeatEnd&&this._properlyOpenedRepeatGroups>1&&(this._openedRepeatGroups.pop(),this._properlyOpenedRepeatGroups--,this._currentRepeatGroup=this._openedRepeatGroups.length>0?this._openedRepeatGroups[this._openedRepeatGroups.length-1]:null)}addTrack(e){e.score=this,e.index=this.tracks.length,this.tracks.push(e)}finish(e){const t=new Map;for(let i=0,a=this.tracks.length;i<a;i++)this.tracks[i].finish(e,t)}applyFlatSyncPoints(e){for(const t of this.masterBars)t.syncPoints=void 0;for(const t of e){const i=new wt;i.ratioPosition=Math.min(1,Math.max(0,t.barPosition)),i.type=tt.SyncPoint,i.syncPointValue=new ju,i.syncPointValue.millisecondOffset=t.millisecondOffset,i.syncPointValue.barOccurence=t.barOccurence,t.barIndex<this.masterBars.length&&this.masterBars[t.barIndex].addSyncPoint(i)}for(const t of this.masterBars)t.syncPoints&&t.syncPoints.sort((i,a)=>{const n=i.syncPointValue.barOccurence-a.syncPointValue.barOccurence;return n!==0?n:i.ratioPosition-a.ratioPosition})}exportFlatSyncPoints(){const e=[];for(const t of this.masterBars){const i=t.syncPoints;if(i)for(const a of i)e.push({barIndex:t.index,barOccurence:a.syncPointValue.barOccurence,barPosition:a.ratioPosition,millisecondOffset:a.syncPointValue.millisecondOffset})}return e}}class Ko{init(e,t){this.data=e,this.settings=t,fn.resetIds()}}var Ve;(function(s){s[s.General=0]="General",s[s.Format=1]="Format",s[s.AlphaTex=2]="AlphaTex"})(Ve||(Ve={}));class We extends Error{constructor(e,t="",i){super(t??"",{cause:i}),this.type=e,Object.setPrototypeOf(this,We.prototype)}}class vt extends We{constructor(e=null,t){super(Ve.Format,e??"Unsupported format",t),Object.setPrototypeOf(this,vt.prototype)}}class er{constructor(){this.name="",this.firstFret=1,this.strings=[],this.barreFrets=[],this.showName=!0,this.showDiagram=!0,this.showFingering=!0}get uniqueId(){return[this.name,this.firstFret.toString(),this.strings.join(","),this.barreFrets.join(","),this.showDiagram.toString(),this.showFingering.toString(),this.showName.toString()].join("|")}}var Di;(function(s){s[s.IgnoreSpaces=0]="IgnoreSpaces",s[s.Begin=1]="Begin",s[s.Text=2]="Text",s[s.Comment=3]="Comment",s[s.Dash=4]="Dash"})(Di||(Di={}));class Xt{constructor(){this.startBar=0,this.text=""}finish(e=!1){this.chunks=[],this.parse(this.text,0,this.chunks,e)}parse(e,t,i,a){if(!e)return;let n=Di.Begin,r=Di.Begin,o=!1,l=0;for(;t<e.length;){const h=e.charCodeAt(t);switch(n){case Di.IgnoreSpaces:switch(h){case Xt.CharCodeLF:case Xt.CharCodeCR:case Xt.CharCodeTab:break;case Xt.CharCodeSpace:if(!o){n=r;continue}break;default:o=!1,n=r;continue}break;case Di.Begin:switch(h){case Xt.CharCodeBrackedOpen:n=Di.Comment;break;default:l=t,n=Di.Text;continue}break;case Di.Comment:switch(h){case Xt.CharCodeBrackedClose:n=Di.Begin;break}break;case Di.Text:switch(h){case Xt.CharCodeDash:n=Di.Dash;break;case Xt.CharCodeCR:case Xt.CharCodeLF:case Xt.CharCodeSpace:const c=e.substr(l,t-l);this.addChunk(c,a),n=Di.IgnoreSpaces,r=Di.Begin;break}break;case Di.Dash:switch(h){case Xt.CharCodeDash:break;default:const c=e.substr(l,t-l);this.addChunk(c,a),o=!0,n=Di.IgnoreSpaces,r=Di.Begin;continue}break}t+=1}n===Di.Text&&t!==l&&this.addChunk(e.substr(l,t-l),a)}addChunk(e,t){e=this.prepareChunk(e),(!t||e.length>0&&e!=="-")&&this.chunks.push(e)}prepareChunk(e){const t=e.split("+").join(" ");let i=t.length;for(;i>0&&t.charAt(i-1)==="_";)i--;return i!==t.length?t.substr(0,i):t}}Xt.CharCodeLF=10;Xt.CharCodeTab=9;Xt.CharCodeCR=13;Xt.CharCodeSpace=32;Xt.CharCodeBrackedClose=93;Xt.CharCodeBrackedOpen=91;Xt.CharCodeDash=45;class Mh{constructor(){this.marker="",this.text=""}}class Kt extends We{constructor(e){super(Ve.Format,e),Object.setPrototypeOf(this,Kt.prototype)}}class Pe{constructor(e,t,i,a=255){this.raw=0,this.raw=(a&255)<<24|(e&255)<<16|(t&255)<<8|i&255,this.updateRgba()}updateRgba(){this.a===255?this.rgba=`#${V.toHexString(this.r,2)}${V.toHexString(this.g,2)}${V.toHexString(this.b,2)}`:this.rgba=`rgba(${this.r},${this.g},${this.b},${this.a/255})`}get a(){return this.raw>>24&255}get r(){return this.raw>>16&255}get g(){return this.raw>>8&255}get b(){return this.raw&255}static random(e=100){return new Pe(Math.random()*255|0,Math.random()*255|0,Math.random()*255|0,e)}static fromJson(e){if(e instanceof Pe)return e;switch(typeof e){case"number":{const t=new Pe(0,0,0,0);return t.raw=e,t.updateRgba(),t}case"string":{const t=e;if(t.startsWith("#")){if(t.length===4)return new Pe(Number.parseInt(t[1],16)*17,Number.parseInt(t[2],16)*17,Number.parseInt(t[3],16)*17);if(t.length===5)return new Pe(Number.parseInt(t[1],16)*17,Number.parseInt(t[2],16)*17,Number.parseInt(t[3],16)*17,Number.parseInt(t[4],16)*17);if(t.length===7)return new Pe(Number.parseInt(t.substring(1,3),16),Number.parseInt(t.substring(3,5),16),Number.parseInt(t.substring(5,7),16));if(t.length===9)return new Pe(Number.parseInt(t.substring(1,3),16),Number.parseInt(t.substring(3,5),16),Number.parseInt(t.substring(5,7),16),Number.parseInt(t.substring(7,9),16))}else if(t.startsWith("rgba")||t.startsWith("rgb")){const i=t.indexOf("("),a=t.lastIndexOf(")");if(i===-1||a===-1)throw new Kt("No values specified for rgb/rgba function");const n=t.substring(i+1,a).split(",");if(n.length===3)return new Pe(Number.parseInt(n[0]),Number.parseInt(n[1]),Number.parseInt(n[2]));if(n.length===4)return new Pe(Number.parseInt(n[0]),Number.parseInt(n[1]),Number.parseInt(n[2]),Number.parseFloat(n[3])*255)}return null}}throw new Kt("Unsupported format for color")}static toJson(e){return e===null?null:e.raw}}Pe.BlackRgb="#000000";class jw{constructor(){this.volume=15,this.balance=8,this.port=1,this.program=0,this.primaryChannel=0,this.secondaryChannel=0,this.isMute=!1,this.isSolo=!1}}class M{static getTextForTuning(e,t){const i=M.getTextPartsForTuning(e);return t?i.join(""):i[0]}static getTextPartsForTuning(e,t=-1){const i=e/12|0,a=e%12;return[["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"][a],(i+t).toString()]}static getDefaultTuningFor(e){return M._defaultTunings.has(e)?M._defaultTunings.get(e):null}static getPresetsFor(e){switch(e){case 7:return M._sevenStrings;case 6:return M._sixStrings;case 5:return M._fiveStrings;case 4:return M._fourStrings}return[]}static initialize(){M._defaultTunings.set(7,new M("Guitar 7 strings",[64,59,55,50,45,40,35],!0)),M._sevenStrings.push(M._defaultTunings.get(7)),M._defaultTunings.set(6,new M("Guitar Standard Tuning",[64,59,55,50,45,40],!0)),M._sixStrings.push(M._defaultTunings.get(6)),M._sixStrings.push(new M("Guitar Tune down  step",[63,58,54,49,44,39],!1)),M._sixStrings.push(new M("Guitar Tune down 1 step",[62,57,53,48,43,38],!1)),M._sixStrings.push(new M("Guitar Tune down 2 step",[60,55,51,46,41,36],!1)),M._sixStrings.push(new M("Guitar Dropped D Tuning",[64,59,55,50,45,38],!1)),M._sixStrings.push(new M("Guitar Dropped D Tuning variant",[64,57,55,50,45,38],!1)),M._sixStrings.push(new M("Guitar Double Dropped D Tuning",[62,59,55,50,45,38],!1)),M._sixStrings.push(new M("Guitar Dropped E Tuning",[66,61,57,52,47,40],!1)),M._sixStrings.push(new M("Guitar Dropped C Tuning",[62,57,53,48,43,36],!1)),M._sixStrings.push(new M("Guitar Open C Tuning",[64,60,55,48,43,36],!1)),M._sixStrings.push(new M("Guitar Open Cm Tuning",[63,60,55,48,43,36],!1)),M._sixStrings.push(new M("Guitar Open C6 Tuning",[64,57,55,48,43,36],!1)),M._sixStrings.push(new M("Guitar Open Cmaj7 Tuning",[64,59,55,52,43,36],!1)),M._sixStrings.push(new M("Guitar Open D Tuning",[62,57,54,50,45,38],!1)),M._sixStrings.push(new M("Guitar Open Dm Tuning",[62,57,53,50,45,38],!1)),M._sixStrings.push(new M("Guitar Open D5 Tuning",[62,57,50,50,45,38],!1)),M._sixStrings.push(new M("Guitar Open D6 Tuning",[62,59,54,50,45,38],!1)),M._sixStrings.push(new M("Guitar Open Dsus4 Tuning",[62,57,55,50,45,38],!1)),M._sixStrings.push(new M("Guitar Open E Tuning",[64,59,56,52,47,40],!1)),M._sixStrings.push(new M("Guitar Open Em Tuning",[64,59,55,52,47,40],!1)),M._sixStrings.push(new M("Guitar Open Esus11 Tuning",[64,59,55,52,45,40],!1)),M._sixStrings.push(new M("Guitar Open F Tuning",[65,60,53,48,45,41],!1)),M._sixStrings.push(new M("Guitar Open G Tuning",[62,59,55,50,43,38],!1)),M._sixStrings.push(new M("Guitar Open Gm Tuning",[62,58,55,50,43,38],!1)),M._sixStrings.push(new M("Guitar Open G6 Tuning",[64,59,55,50,43,38],!1)),M._sixStrings.push(new M("Guitar Open Gsus4 Tuning",[62,60,55,50,43,38],!1)),M._sixStrings.push(new M("Guitar Open A Tuning",[64,61,57,52,45,40],!1)),M._sixStrings.push(new M("Guitar Open Am Tuning",[64,60,57,52,45,40],!1)),M._sixStrings.push(new M("Guitar Nashville Tuning",[64,59,67,62,57,52],!1)),M._sixStrings.push(new M("Bass 6 Strings Tuning",[48,43,38,33,28,23],!1)),M._sixStrings.push(new M("Lute or Vihuela Tuning",[64,59,54,50,45,40],!1)),M._defaultTunings.set(5,new M("Bass 5 Strings Tuning",[43,38,33,28,23],!0)),M._fiveStrings.push(M._defaultTunings.get(5)),M._fiveStrings.push(new M("Banjo Dropped C Tuning",[62,59,55,48,67],!1)),M._fiveStrings.push(new M("Banjo Open D Tuning",[62,57,54,50,69],!1)),M._fiveStrings.push(new M("Banjo Open G Tuning",[62,59,55,50,67],!1)),M._fiveStrings.push(new M("Banjo G Minor Tuning",[62,58,55,50,67],!1)),M._fiveStrings.push(new M("Banjo G Modal Tuning",[62,57,55,50,67],!1)),M._defaultTunings.set(4,new M("Bass Standard Tuning",[43,38,33,28],!0)),M._fourStrings.push(M._defaultTunings.get(4)),M._fourStrings.push(new M("Bass Tune down  step",[42,37,32,27],!1)),M._fourStrings.push(new M("Bass Tune down 1 step",[41,36,31,26],!1)),M._fourStrings.push(new M("Bass Tune down 2 step",[39,34,29,24],!1)),M._fourStrings.push(new M("Bass Dropped D Tuning",[43,38,33,26],!1)),M._fourStrings.push(new M("Ukulele C Tuning",[45,40,36,43],!1)),M._fourStrings.push(new M("Ukulele G Tuning",[52,47,43,38],!1)),M._fourStrings.push(new M("Mandolin Standard Tuning",[64,57,50,43],!1)),M._fourStrings.push(new M("Mandolin or Violin Tuning",[76,69,62,55],!1)),M._fourStrings.push(new M("Viola Tuning",[69,62,55,48],!1)),M._fourStrings.push(new M("Cello Tuning",[57,50,43,36],!1))}static findTuning(e){const t=M.getPresetsFor(e.length);for(let i=0,a=t.length;i<a;i++){const n=t[i];let r=!0;for(let o=0,l=e.length;o<l;o++)if(e[o]!==n.tunings[o]){r=!1;break}if(r)return n}return null}constructor(e="",t=null,i=!1){this.isStandard=i,this.name=e,this.tunings=t??[]}finish(){const e=M.findTuning(this.tunings);e&&(this.name=e.name,this.isStandard=e.isStandard),this.name=this.name.trim()}}M._sevenStrings=[];M._sixStrings=[];M._fiveStrings=[];M._fourStrings=[];M._defaultTunings=new Map;M.defaultAccidentals=["","#","","#","","","#","","#","","#",""];M.defaultSteps=["C","C","D","D","E","F","F","G","G","A","A","B"];M.initialize();class $o{constructor(){this.index=0,this.bars=[],this.chords=null,this.capo=0,this.transpositionPitch=0,this.displayTranspositionPitch=0,this.stringTuning=new M("",[],!1),this.showSlash=!1,this.showNumbered=!1,this.showTablature=!0,this.showStandardNotation=!0,this.isPercussion=!1,this.standardNotationLineCount=$o.DefaultStandardNotationLineCount}get tuning(){return this.stringTuning.tunings}get tuningName(){return this.stringTuning.name}get isStringed(){return this.stringTuning.tunings.length>0}finish(e,t=null){this.stringTuning.finish();for(let i=0,a=this.bars.length;i<a;i++)this.bars[i].finish(e,t)}addChord(e,t){t.staff=this;let i=this.chords;i===null&&(i=new Map,this.chords=i),i.set(e,t)}hasChord(e){var t;return((t=this.chords)==null?void 0:t.has(e))??!1}getChord(e){var t;return((t=this.chords)==null?void 0:t.get(e))??null}addBar(e){const t=this.bars;e.staff=this,e.index=t.length,t.length>0&&(e.previousBar=t[t.length-1],e.previousBar.nextBar=e),t.push(e)}}$o.DefaultStandardNotationLineCount=5;var Ta;(function(s){s[s.TrackName=0]="TrackName",s[s.BracesAndBrackets=1]="BracesAndBrackets",s[s.SystemSeparator=2]="SystemSeparator",s[s.StringTuning=3]="StringTuning"})(Ta||(Ta={}));class Ax extends Qo{}class Ea{constructor(){this.index=0,this.staves=[],this.playbackInfo=new jw,this.color=new Pe(200,0,0,255),this.name="",this.isVisibleOnMultiTrack=!0,this.shortName="",this.defaultSystemsLayout=3,this.systemsLayout=[],this.percussionArticulations=[]}addLineBreaks(e){this.lineBreaks||(this.lineBreaks=new Set),this.lineBreaks.add(e)}ensureStaveCount(e){for(;this.staves.length<e;)this.addStaff(new $o)}addStaff(e){e.index=this.staves.length,e.track=this,this.staves.push(e)}finish(e,t=null){this.shortName||(this.shortName=this.name,this.shortName.length>Ea.ShortNameMaxLength&&(this.shortName=this.shortName.substr(0,Ea.ShortNameMaxLength)));for(let i=0,a=this.staves.length;i<a;i++)this.staves[i].finish(e,t)}applyLyrics(e){for(const i of e)i.finish();const t=this.staves[0];for(let i=0;i<e.length;i++){const a=e[i];if(a.startBar>=0&&a.startBar<t.bars.length){let n=t.bars[a.startBar].voices[0].beats[0];for(let r=0;r<a.chunks.length&&n;r++){for(;n&&(n.isEmpty||n.isRest);)n=n.nextBeat;n&&(n.lyrics||(n.lyrics=new Array(e.length),n.lyrics.fill("")),n.lyrics[i]=a.chunks[r],n=n.nextBeat)}}}}}Ea.ShortNameMaxLength=10;class de{static float64ToBytes(e){return de._dataView.setFloat64(0,e,!0),de._conversionByteArray}static bytesToInt64LE(e){de._conversionByteArray.set(e,0);const t=de._dataView.getBigInt64(0,!0);return t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER?Number(t):Number.MAX_SAFE_INTEGER}static bytesToFloat64LE(e){return de._conversionByteArray.set(e,0),de._dataView.getFloat64(0,!0)}static bytesToFloat32LE(e){return de._conversionByteArray.set(e,0),de._dataView.getFloat32(0,!0)}static float32BEToBytes(e){return de._dataView.setFloat32(0,e,!1),de._conversionByteArray.slice(0,4)}static uint16ToInt16(e){return de._dataView.setUint16(0,e,!0),de._dataView.getInt16(0,!0)}static int16ToUint32(e){return de._dataView.setInt16(0,e,!0),de._dataView.getUint32(0,!0)}static int32ToUint16(e){return de._dataView.setInt32(0,e,!0),de._dataView.getUint16(0,!0)}static int32ToInt16(e){return de._dataView.setInt32(0,e,!0),de._dataView.getInt16(0,!0)}static int32ToUint32(e){return de._dataView.setInt32(0,e,!0),de._dataView.getUint32(0,!0)}static uint8ToInt8(e){return de._dataView.setUint8(0,e),de._dataView.getInt8(0)}}de._conversionBuffer=new ArrayBuffer(8);de._conversionByteArray=new Uint8Array(de._conversionBuffer);de._dataView=new DataView(de._conversionBuffer);class x{static readInt32BE(e){const t=e.readByte(),i=e.readByte(),a=e.readByte(),n=e.readByte();return t<<24|i<<16|a<<8|n}static readFloat32BE(e){const t=new Uint8Array(4);return e.read(t,0,t.length),t.reverse(),de.bytesToFloat32LE(t)}static readFloat64BE(e){const t=new Uint8Array(8);return e.read(t,0,t.length),t.reverse(),de.bytesToFloat64LE(t)}static readInt32LE(e){const t=e.readByte(),i=e.readByte(),a=e.readByte();return e.readByte()<<24|a<<16|i<<8|t}static readInt64LE(e){const t=new Uint8Array(8);return e.read(t,0,t.length),de.bytesToInt64LE(t)}static readUInt32LE(e){const t=e.readByte(),i=e.readByte(),a=e.readByte();return e.readByte()<<24|a<<16|i<<8|t}static decodeUInt32LE(e,t){const i=e[t],a=e[t+1],n=e[t+2];return e[t+3]<<24|n<<16|a<<8|i}static readUInt16LE(e){const t=e.readByte(),i=e.readByte();return de.int32ToUint16(i<<8|t)}static readInt16LE(e){const t=e.readByte(),i=e.readByte();return de.int32ToInt16(i<<8|t)}static readUInt32BE(e){const t=e.readByte(),i=e.readByte(),a=e.readByte(),n=e.readByte();return de.int32ToUint32(t<<24|i<<16|a<<8|n)}static readUInt16BE(e){const t=e.readByte(),i=e.readByte();return de.int32ToInt16(t<<8|i)}static readInt16BE(e){const t=e.readByte(),i=e.readByte();return de.int32ToInt16(t<<8|i)}static readByteArray(e,t){const i=new Uint8Array(t);return e.read(i,0,t),i}static read8BitChars(e,t){const i=new Uint8Array(t);return e.read(i,0,i.length),x.toString(i,"utf-8")}static read8BitString(e){let t="",i=e.readByte();for(;i!==0;)t+=String.fromCharCode(i),i=e.readByte();return t}static read8BitStringLength(e,t){let i="",a=-1;for(let r=0;r<t;r++){const o=e.readByte();o===0&&a===-1&&(a=r),i+=String.fromCharCode(o)}const n=i;return a>=0?n.substr(0,a):n}static readSInt8(e){const t=e.readByte();return((t&255)>>7)*-256+(t&255)}static readInt24(e,t){let i=e[t]|e[t+1]<<8|e[t+2]<<16;return(i&8388608)===8388608&&(i=i|255<<24),i}static readInt16(e,t){return de.int32ToInt16(e[t]|e[t+1]<<8)}static toString(e,t){const i=x.detectEncoding(e);return i&&(t=i),t||(t="utf-8"),new TextDecoder(t).decode(e.buffer)}static detectEncoding(e){return e.length>2&&e[0]===254&&e[1]===255?"utf-16be":e.length>2&&e[0]===255&&e[1]===254?"utf-16le":e.length>4&&e[0]===0&&e[1]===0&&e[2]===254&&e[3]===255?"utf-32be":e.length>4&&e[0]===255&&e[1]===254&&e[2]===0&&e[3]===0?"utf-32le":null}static stringToBytes(e){return new TextEncoder().encode(e)}static writeInt32BE(e,t){e.writeByte(t>>24&255),e.writeByte(t>>16&255),e.writeByte(t>>8&255),e.writeByte(t>>0&255)}static writeInt32LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255),e.writeByte(t>>16&255),e.writeByte(t>>24&255)}static writeUInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16LE(e,t){e.writeByte(t>>0&255),e.writeByte(t>>8&255)}static writeInt16BE(e,t){e.writeByte(t>>8&255),e.writeByte(t>>0&255)}static writeFloat32BE(e,t){const i=de.float32BEToBytes(t);e.write(i,0,i.length)}}class Dt{constructor(){this.length=0,this.position=0}get bytesWritten(){return this.position}getBuffer(){return this._buffer}static empty(){return Dt.withCapacity(0)}static withCapacity(e){const t=new Dt;return t._buffer=new Uint8Array(e),t}static fromBuffer(e){const t=new Dt;return t._buffer=e,t.length=e.length,t}static fromString(e){const t=x.stringToBytes(e);return Dt.fromBuffer(t)}reset(){this.position=0}skip(e){this.position+=e}readByte(){return this.length-this.position<=0?-1:this._buffer[this.position++]}read(e,t,i){let a=this.length-this.position;return a>i&&(a=i),a<=0?0:(e.set(this._buffer.subarray(this.position,this.position+a),t),this.position+=a,a)}writeByte(e){const t=this.position+1;this.ensureCapacity(t),this._buffer[this.position]=e&255,t>this.length&&(this.length=t),this.position=t}write(e,t,i){const a=this.position+i;this.ensureCapacity(a);const n=Math.min(i,e.length-t);this._buffer.set(e.subarray(t,t+n),this.position),a>this.length&&(this.length=a),this.position=a}ensureCapacity(e){if(e>this._buffer.length){let t=e;t<256&&(t=256),t<this._buffer.length*2&&(t=this._buffer.length*2);const i=new Uint8Array(t);this.length>0&&i.set(this._buffer.subarray(0,0+this.length),0),this._buffer=i}}readAll(){return this.toArray()}toArray(){const e=new Uint8Array(this.length);return e.set(this._buffer.subarray(0,0+this.length),0),e}copyTo(e){e.write(this._buffer,0,this.length)}}var R;(function(s){s[s.TargetFine=0]="TargetFine",s[s.TargetSegno=1]="TargetSegno",s[s.TargetSegnoSegno=2]="TargetSegnoSegno",s[s.TargetCoda=3]="TargetCoda",s[s.TargetDoubleCoda=4]="TargetDoubleCoda",s[s.JumpDaCapo=5]="JumpDaCapo",s[s.JumpDaCapoAlCoda=6]="JumpDaCapoAlCoda",s[s.JumpDaCapoAlDoubleCoda=7]="JumpDaCapoAlDoubleCoda",s[s.JumpDaCapoAlFine=8]="JumpDaCapoAlFine",s[s.JumpDalSegno=9]="JumpDalSegno",s[s.JumpDalSegnoAlCoda=10]="JumpDalSegnoAlCoda",s[s.JumpDalSegnoAlDoubleCoda=11]="JumpDalSegnoAlDoubleCoda",s[s.JumpDalSegnoAlFine=12]="JumpDalSegnoAlFine",s[s.JumpDalSegnoSegno=13]="JumpDalSegnoSegno",s[s.JumpDalSegnoSegnoAlCoda=14]="JumpDalSegnoSegnoAlCoda",s[s.JumpDalSegnoSegnoAlDoubleCoda=15]="JumpDalSegnoSegnoAlDoubleCoda",s[s.JumpDalSegnoSegnoAlFine=16]="JumpDalSegnoSegnoAlFine",s[s.JumpDaCoda=17]="JumpDaCoda",s[s.JumpDaDoubleCoda=18]="JumpDaDoubleCoda"})(R||(R={}));var Bi;(function(s){s[s.Short=0]="Short",s[s.Medium=1]="Medium",s[s.Long=2]="Long"})(Bi||(Bi={}));class Rh{constructor(){this.type=Bi.Short,this.length=0}}var P;(function(s){s[s.Up=0]="Up",s[s.Down=1]="Down"})(P||(P={}));var k;(function(s){s[s.No=0]="No",s[s.Eof=1]="Eof",s[s.Number=2]="Number",s[s.DoubleDot=3]="DoubleDot",s[s.Dot=4]="Dot",s[s.String=5]="String",s[s.Tuning=6]="Tuning",s[s.LParensis=7]="LParensis",s[s.RParensis=8]="RParensis",s[s.LBrace=9]="LBrace",s[s.RBrace=10]="RBrace",s[s.Pipe=11]="Pipe",s[s.MetaCommand=12]="MetaCommand",s[s.Multiply=13]="Multiply",s[s.LowerThan=14]="LowerThan"})(k||(k={}));var Jt;(function(s){s[s.KnownStaffMeta=0]="KnownStaffMeta",s[s.UnknownStaffMeta=1]="UnknownStaffMeta",s[s.EndOfMetaDetected=2]="EndOfMetaDetected"})(Jt||(Jt={}));class vr extends We{constructor(e,t,i,a,n,r,o,l=null){super(Ve.AlphaTex,e),this.position=t,this.line=i,this.col=a,this.nonTerm=n??"",this.expected=r??k.No,this.symbol=o??k.No,this.symbolData=l,Object.setPrototypeOf(this,vr.prototype)}static symbolError(e,t,i,a,n,r,o=null){let l=`MalFormed AlphaTex: @${e} (line ${t}, col ${i}): Error on block ${a}`;return n!==r?(l+=`, expected a ${k[n]} found a ${k[r]}`,o!==null&&(l+=`: '${o}'`)):l+=`, invalid value: '${o}'`,new vr(l,e,t,i,a,n,r,o)}static errorMessage(e,t,i,a){return e=`MalFormed AlphaTex: @${t} (line ${i}, col ${a}): ${e}`,new vr(e,t,i,a,null,null,null,null)}}var ho;(function(s){s[s.Auto=0]="Auto",s[s.Explicit=1]="Explicit"})(ho||(ho={}));class di extends Ko{constructor(){super(...arguments),this._trackChannel=0,this._barIndex=0,this._voiceIndex=0,this._input="",this._ch=di.Eof,this._curChPos=0,this._line=1,this._col=0,this._lastValidSpot=[0,1,0],this._sy=k.No,this._syData="",this._allowNegatives=!1,this._allowFloat=!1,this._allowTuning=!1,this._currentDuration=w.QuadrupleWhole,this._currentDynamics=j.PPP,this._currentTuplet=0,this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._percussionArticulationNames=new Map,this._sustainPedalToBeat=new Map,this._slurs=new Map,this._articulationValueToIndex=new Map,this._accidentalMode=ho.Explicit,this._syncPoints=[],this.logErrors=!1}get name(){return"AlphaTex"}initFromString(e,t){this.data=Dt.empty(),this._input=e,this.settings=t,fn.resetIds()}readScore(){try{if(this.data.length>0&&(this._input=x.toString(this.data.readAll(),this.settings.importer.encoding)),this._allowTuning=!0,this._lyrics=new Map,this._sustainPedalToBeat=new Map,this.createDefaultScore(),this._curChPos=0,this._line=1,this._col=0,this.saveValidSpot(),this._currentDuration=w.Quarter,this._currentDynamics=j.F,this._currentTuplet=1,this._ch=this.nextChar(),this._sy=this.newSy(),this._sy===k.LowerThan)throw new vt("Unknown start sign '<' (meant to import as XML?)");if(this._sy!==k.Eof){const e=this.metaData(),t=this.bars();if(!e&&!t)throw new vt("No alphaTex data found");this._sy===k.Dot&&(this._sy=this.newSy(),this.syncPoints())}V.consolidate(this._score),this._score.finish(this.settings),V.trimEmptyBarsAtEnd(this._score),this._score.rebuildRepeatGroups(),this._score.applyFlatSyncPoints(this._syncPoints);for(const[e,t]of this._lyrics)this._score.tracks[e].applyLyrics(t);for(const[e,t]of this._sustainPedalToBeat){const i=t.voice.bar.masterBar.calculateDuration();e.ratioPosition=t.playbackStart/i}return this._score}catch(e){throw e instanceof vr?new vt(e.message,e):e}}syncPoints(){for(;this._sy!==k.Eof;)this.syncPoint()}syncPoint(){(this._sy!==k.MetaCommand||this._syData!=="sync")&&this.error("syncPoint",k.MetaCommand,!0),this._sy=this.newSy(),this._sy!==k.Number&&this.error("syncPointBarIndex",k.Number,!0);const e=this._syData;this._sy=this.newSy(),this._sy!==k.Number&&this.error("syncPointBarOccurence",k.Number,!0);const t=this._syData;this._sy=this.newSy(),this._sy!==k.Number&&this.error("syncPointBarMillis",k.Number,!0);const i=this._syData;this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1;let a=0;this._sy===k.Number&&(a=this._syData,this._sy=this.newSy()),this._syncPoints.push({barIndex:e,barOccurence:t,barPosition:a,millisecondOffset:i})}error(e,t,i=!0){let a,n=!1;i?(a=this._sy,(a===k.String||a===k.Number||a===k.MetaCommand)&&(n=!0)):a=t;const r=vr.symbolError(this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2],e,t,a,n?this._syData:null);throw this.logErrors&&E.error(this.name,r.message),r}errorMessage(e){const t=vr.errorMessage(e,this._lastValidSpot[0],this._lastValidSpot[1],this._lastValidSpot[2]);throw this.logErrors&&E.error(this.name,t.message),t}createDefaultScore(){this._score=new fn,this._score.tempo=120,this._score.tempoLabel="",this.newTrack()}newTrack(){this._currentTrack=new Ea,this._currentTrack.ensureStaveCount(1),this._currentTrack.playbackInfo.program=25,this._currentTrack.playbackInfo.primaryChannel=this._trackChannel++,this._currentTrack.playbackInfo.secondaryChannel=this._trackChannel++;const e=this._currentTrack.staves[0];e.displayTranspositionPitch=0,e.stringTuning.tunings=M.getDefaultTuningFor(6).tunings,this._articulationValueToIndex.clear(),this.beginStaff(e),this._score.addTrack(this._currentTrack),this._lyrics.set(this._currentTrack.index,[]),this._currentDynamics=j.F}parseClefFromString(e){switch(e.toLowerCase()){case"g2":case"treble":return xe.G2;case"f4":case"bass":return xe.F4;case"c3":case"tenor":return xe.C3;case"c4":case"alto":return xe.C4;case"n":case"neutral":return xe.Neutral;default:return xe.G2}}parseClefFromInt(e){switch(e){case 43:return xe.G2;case 65:return xe.F4;case 48:return xe.C3;case 60:return xe.C4;default:return xe.G2}}parseTripletFeelFromString(e){switch(e.toLowerCase()){case"no":case"none":return me.NoTripletFeel;case"t16":case"triplet-16th":return me.Triplet16th;case"t8":case"triplet-8th":return me.Triplet8th;case"d16":case"dotted-16th":return me.Dotted16th;case"d8":case"dotted-8th":return me.Dotted8th;case"s16":case"scottish-16th":return me.Scottish16th;case"s8":case"scottish-8th":return me.Scottish8th;default:return me.NoTripletFeel}}parseTripletFeelFromInt(e){switch(e){case 0:return me.NoTripletFeel;case 1:return me.Triplet16th;case 2:return me.Triplet8th;case 3:return me.Dotted16th;case 4:return me.Dotted8th;case 5:return me.Scottish16th;case 6:return me.Scottish8th;default:return me.NoTripletFeel}}parseKeySignature(e){switch(e.toLowerCase()){case"cb":case"cbmajor":case"abminor":return _e.Cb;case"gb":case"gbmajor":case"ebminor":return _e.Gb;case"db":case"dbmajor":case"bbminor":return _e.Db;case"ab":case"abmajor":case"fminor":return _e.Ab;case"eb":case"ebmajor":case"cminor":return _e.Eb;case"bb":case"bbmajor":case"gminor":return _e.Bb;case"f":case"fmajor":case"dminor":return _e.F;case"c":case"cmajor":case"aminor":return _e.C;case"g":case"gmajor":case"eminor":return _e.G;case"d":case"dmajor":case"bminor":return _e.D;case"a":case"amajor":case"f#minor":return _e.A;case"e":case"emajor":case"c#minor":return _e.E;case"b":case"bmajor":case"g#minor":return _e.B;case"f#":case"f#major":case"d#minor":return _e.FSharp;case"c#":case"c#major":case"a#minor":return _e.CSharp;default:return _e.C}}parseKeySignatureType(e){return e.toLowerCase().endsWith("minor")?Mi.Minor:Mi.Major}nextChar(){return this._curChPos<this._input.length?(this._ch=this._input.charCodeAt(this._curChPos++),this._ch===10?(this._line++,this._col=0):this._col++):this._ch=di.Eof,this._ch}saveValidSpot(){this._lastValidSpot=[this._curChPos,this._line,this._col]}newSy(){for(this.saveValidSpot(),this._sy=k.No;this._sy===k.No;)if(this._ch===di.Eof)this._sy=k.Eof;else if(di.isWhiteSpace(this._ch))this._ch=this.nextChar(),this.saveValidSpot();else if(this._ch===47){if(this._ch=this.nextChar(),this._ch===47)for(;this._ch!==13&&this._ch!==10&&this._ch!==di.Eof;)this._ch=this.nextChar();else if(this._ch===42)for(;this._ch!==di.Eof;)if(this._ch===42){if(this._ch=this.nextChar(),this._ch===47){this._ch=this.nextChar();break}}else this._ch=this.nextChar();else this.error("comment",k.String,!1);this.saveValidSpot()}else if(this._ch===34||this._ch===39){const e=this._ch;this._ch=this.nextChar();let t="";for(this._sy=k.String;this._ch!==e&&this._ch!==di.Eof;)this._ch===92?(this._ch=this.nextChar(),this._ch===92?t+="\\":this._ch===e?t+=String.fromCharCode(this._ch):this._ch===82||this._ch===114?t+="\r":this._ch===78||this._ch===110?t+=`
`:this._ch===84||this._ch===116?t+="	":this.errorMessage("Unsupported escape sequence")):t+=String.fromCharCode(this._ch),this._ch=this.nextChar();this._ch===di.Eof&&this.errorMessage("String opened but never closed"),this._syData=t,this._ch=this.nextChar()}else if(this._ch===45)this._allowNegatives?this.readNumberOrName():(this._sy=k.String,this._syData=this.readName());else if(this._ch===46)this._sy=k.Dot,this._ch=this.nextChar();else if(this._ch===58)this._sy=k.DoubleDot,this._ch=this.nextChar();else if(this._ch===40)this._sy=k.LParensis,this._ch=this.nextChar();else if(this._ch===92)this._ch=this.nextChar(),this._sy=k.MetaCommand,this._ch===92&&(this._ch=this.nextChar()),this._syData=this.readName();else if(this._ch===41)this._sy=k.RParensis,this._ch=this.nextChar();else if(this._ch===123)this._sy=k.LBrace,this._ch=this.nextChar();else if(this._ch===125)this._sy=k.RBrace,this._ch=this.nextChar();else if(this._ch===124)this._sy=k.Pipe,this._ch=this.nextChar();else if(this._ch===42)this._sy=k.Multiply,this._ch=this.nextChar();else if(this._ch===60)this._sy=k.LowerThan,this._ch=this.nextChar();else if(this.isDigit(this._ch))this.readNumberOrName();else if(di.isNameLetter(this._ch)){const e=this.readName(),t=this._allowTuning?V.parseTuning(e):null;t?(this._sy=k.Tuning,this._syData=t):(this._sy=k.String,this._syData=e)}else this.error("symbol",k.String,!1);return this._sy}readNumberOrName(){let e="",t=!0;do e+=String.fromCharCode(this._ch),this.isDigit(this._ch)||(t=!1),this._ch=this.nextChar();while(this.isDigit(this._ch)||di.isNameLetter(this._ch));t?(this._sy=k.Number,this._syData=this._allowFloat?Number.parseFloat(e):Number.parseInt(e)):(this._sy=k.String,this._syData=e)}static isNameLetter(e){return!di.isTerminal(e)&&(33<=e&&e<=47||58<=e&&e<=126||128<=e)}static isTerminal(e){return e===46||e===123||e===125||e===91||e===93||e===40||e===41||e===124||e===39||e===34||e===42||e===92}static isWhiteSpace(e){return e===9||e===10||e===11||e===13||e===32}isDigit(e){return e>=48&&e<=57||this._allowNegatives&&e===45||this._allowFloat&&e===46}readName(){let e="";do e+=String.fromCharCode(this._ch),this._ch=this.nextChar();while(di.isNameLetter(this._ch)||this.isDigit(this._ch));return e}metaData(){let e=!1,t=!1,i=!0;for(;this._sy===k.MetaCommand&&i;){const a=this._syData.toLowerCase();switch(a){case"title":case"subtitle":case"artist":case"album":case"words":case"music":case"copyright":case"instructions":case"notices":case"tab":this._sy=this.newSy(),this._sy!==k.String&&this.error(a,k.String,!0);const n=this._syData;this._sy=this.newSy(),e=!0;let r=z.ChordDiagramList;switch(a){case"title":this._score.title=n,r=z.Title;break;case"subtitle":this._score.subTitle=n,r=z.SubTitle;break;case"artist":this._score.artist=n,r=z.Artist;break;case"album":this._score.album=n,r=z.Album;break;case"words":this._score.words=n,r=z.Words;break;case"music":this._score.music=n,r=z.Music;break;case"copyright":this._score.copyright=n,r=z.Copyright;break;case"instructions":this._score.instructions=n;break;case"notices":this._score.notices=n;break;case"tab":this._score.tab=n,r=z.Transcriber;break}r!==z.ChordDiagramList&&this.headerFooterStyle(r);break;case"copyright2":this._sy=this.newSy(),this._sy!==k.String&&this.error(a,k.String,!0),this.headerFooterStyle(z.CopyrightSecondLine),e=!0;break;case"wordsandmusic":this._sy=this.newSy(),this._sy!==k.String&&this.error(a,k.String,!0),this.headerFooterStyle(z.WordsAndMusic),e=!0;break;case"tempo":this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy===k.Number?this._score.tempo=this._syData:this.error("tempo",k.Number,!0),this._sy=this.newSy(),this._sy===k.String&&(this._score.tempoLabel=this._syData,this._sy=this.newSy()),e=!0;break;case"defaultsystemslayout":this._sy=this.newSy(),this._sy===k.Number?(this._score.defaultSystemsLayout=this._syData,this._sy=this.newSy(),e=!0):this.error("default-systems-layout",k.Number,!0);break;case"systemslayout":for(this._sy=this.newSy(),e=!0;this._sy===k.Number;)this._score.systemsLayout.push(this._syData),this._sy=this.newSy();break;case"hidedynamics":this._score.stylesheet.hideDynamics=!0,this._sy=this.newSy(),e=!0;break;case"showdynamics":this._score.stylesheet.hideDynamics=!1,this._sy=this.newSy(),e=!0;break;case"bracketextendmode":this._sy=this.newSy(),this._sy!==k.String&&this.error("bracketExtendMode",k.String,!0),this._score.stylesheet.bracketExtendMode=this.parseBracketExtendMode(this._syData),this._sy=this.newSy(),e=!0;break;case"usesystemsignseparator":this._score.stylesheet.useSystemSignSeparator=!0,this._sy=this.newSy(),e=!0;break;case"multibarrest":this._score.stylesheet.multiTrackMultiBarRest=!0,this._sy=this.newSy(),e=!0;break;case"singletracktracknamepolicy":this._sy=this.newSy(),this._sy!==k.String&&this.error("singleTrackTrackNamePolicy",k.String,!0),this._score.stylesheet.singleTrackTrackNamePolicy=this.parseTrackNamePolicy(this._syData),this._sy=this.newSy(),e=!0;break;case"multitracktracknamepolicy":this._sy=this.newSy(),this._sy!==k.String&&this.error("multiTrackTrackNamePolicy",k.String,!0),this._score.stylesheet.multiTrackTrackNamePolicy=this.parseTrackNamePolicy(this._syData),this._sy=this.newSy(),e=!0;break;case"firstsystemtracknamemode":this._sy=this.newSy(),this._sy!==k.String&&this.error("firstSystemTrackNameMode",k.String,!0),this._score.stylesheet.firstSystemTrackNameMode=this.parseTrackNameMode(this._syData),this._sy=this.newSy(),e=!0;break;case"othersystemstracknamemode":this._sy=this.newSy(),this._sy!==k.String&&this.error("otherSystemsTrackNameMode",k.String,!0),this._score.stylesheet.otherSystemsTrackNameMode=this.parseTrackNameMode(this._syData),this._sy=this.newSy(),e=!0;break;case"firstsystemtracknameorientation":this._sy=this.newSy(),this._sy!==k.String&&this.error("firstSystemTrackNameOrientation",k.String,!0),this._score.stylesheet.firstSystemTrackNameOrientation=this.parseTrackNameOrientation(this._syData),this._sy=this.newSy(),e=!0;break;case"othersystemstracknameorientation":this._sy=this.newSy(),this._sy!==k.String&&this.error("otherSystemsTrackNameOrientation",k.String,!0),this._score.stylesheet.otherSystemsTrackNameOrientation=this.parseTrackNameOrientation(this._syData),this._sy=this.newSy(),e=!0;break;default:switch(this.handleStaffMeta()){case Jt.KnownStaffMeta:t=!0;break;case Jt.UnknownStaffMeta:e||t?this.error("metaDataTags",k.String,!1):i=!1;break;case Jt.EndOfMetaDetected:i=!1;break}break}}return e?(this._sy!==k.Dot&&this.error("song",k.Dot,!0),this._sy=this.newSy()):this._sy===k.Dot&&(this._sy=this.newSy(),e=!0),e||t}headerFooterStyle(e){const t=V.getOrCreateHeaderFooterStyle(this._score,e);if(t.isVisible===void 0&&(t.isVisible=!0),this._sy===k.String){const i=this._syData;i?t.template=i:t.isVisible=!1,this._sy=this.newSy()}if(this._sy===k.String){switch(this._syData.toLowerCase()){case"left":t.textAlign=Q.Left;break;case"center":t.textAlign=Q.Center;break;case"right":t.textAlign=Q.Right;break}this._sy=this.newSy()}}parseTrackNamePolicy(e){switch(e.toLowerCase()){case"hidden":return ct.Hidden;case"allsystems":return ct.AllSystems;default:return ct.FirstSystem}}parseTrackNameMode(e){switch(e.toLowerCase()){case"fullname":return Si.FullName;default:return Si.ShortName}}parseTrackNameOrientation(e){switch(e.toLowerCase()){case"horizontal":return wi.Horizontal;default:return wi.Vertical}}handleStaffMeta(){var e;switch(this._syData.toLowerCase()){case"capo":return this._sy=this.newSy(),this._sy===k.Number?this._currentStaff.capo=this._syData:this.error("capo",k.Number,!0),this._sy=this.newSy(),Jt.KnownStaffMeta;case"tuning":this._sy=this.newSy();const t=this._currentStaff.tuning.length;switch(this._staffHasExplicitTuning=!0,this._staffTuningApplied=!1,this._sy){case k.String:const o=this._syData.toLowerCase();o==="piano"||o==="none"||o==="voice"?this.makeCurrentStaffPitched():this.error("tuning",k.Tuning,!0),this._sy=this.newSy();break;case k.Tuning:const l=[];do{const h=this._syData;l.push(h.realValue),this._sy=this.newSy()}while(this._sy===k.Tuning);this._currentStaff.stringTuning.tunings=l;break;default:this.error("tuning",k.Tuning,!0);break}return this._sy===k.String&&this._syData.toLowerCase()==="hide"&&(this._score.stylesheet.perTrackDisplayTuning||(this._score.stylesheet.perTrackDisplayTuning=new Map),this._score.stylesheet.perTrackDisplayTuning.set(this._currentTrack.index,!1),this._sy=this.newSy()),t!==this._currentStaff.tuning.length&&(((e=this._currentStaff.chords)==null?void 0:e.size)??0)>0&&this.errorMessage("Tuning must be defined before any chord"),Jt.KnownStaffMeta;case"instrument":if(this._sy=this.newSy(),this._staffTuningApplied=!1,this._sy===k.Number){const o=this._syData;o>=0&&o<=127?this._currentTrack.playbackInfo.program=this._syData:this.error("instrument",k.Number,!1)}else if(this._sy===k.String){const o=this._syData.toLowerCase();if(o==="percussion"){for(const l of this._currentTrack.staves)this.applyPercussionStaff(l);this._currentTrack.playbackInfo.primaryChannel=te.PercussionChannel,this._currentTrack.playbackInfo.secondaryChannel=te.PercussionChannel}else this._currentTrack.playbackInfo.program=oa.getValue(o)}else this.error("instrument",k.Number,!0);return this._sy=this.newSy(),Jt.KnownStaffMeta;case"lyrics":this._sy=this.newSy();const i=new Xt;return i.startBar=0,i.text="",this._sy===k.Number&&(i.startBar=this._syData,this._sy=this.newSy()),this._sy===k.String?(i.text=this._syData,this._sy=this.newSy()):this.error("lyrics",k.String,!0),this._lyrics.get(this._currentTrack.index).push(i),Jt.KnownStaffMeta;case"chord":this._sy=this.newSy();const a=new er;this.chordProperties(a),this._sy===k.String?(a.name=this._syData,this._sy=this.newSy()):this.error("chord-name",k.String,!0);for(let o=0;o<this._currentStaff.tuning.length;o++)this._sy===k.Number?a.strings.push(this._syData):this._sy===k.String&&this._syData.toLowerCase()==="x"&&a.strings.push(-1),this._sy=this.newSy();return this._currentStaff.addChord(this.getChordId(this._currentStaff,a.name),a),Jt.KnownStaffMeta;case"articulation":this._sy=this.newSy();let n="";if(this._sy===k.String?(n=this._syData,this._sy=this.newSy()):this.error("articulation-name",k.String,!0),n==="defaults"){for(const[o,l]of At.instrumentArticulationNames)this._percussionArticulationNames.set(o.toLowerCase(),l),this._percussionArticulationNames.set(di.toArticulationId(o),l);return Jt.KnownStaffMeta}let r=0;return this._sy===k.Number?(r=this._syData,this._sy=this.newSy()):this.error("articulation-number",k.Number,!0),At.instrumentArticulations.has(r)||this.errorMessage(`Unknown articulation ${r}. Refer to https://www.alphatab.net/docs/alphatex/percussion for available ids`),this._percussionArticulationNames.set(n.toLowerCase(),r),Jt.KnownStaffMeta;case"accidentals":return this.handleAccidentalMode(),Jt.KnownStaffMeta;case"displaytranspose":return this._allowNegatives=!0,this._sy=this.newSy(),this._sy===k.Number?(this._currentStaff.displayTranspositionPitch=this._syData*-1,this._staffHasExplicitDisplayTransposition=!0):this.error("displaytranspose",k.Number,!0),this._allowNegatives=!1,this._sy=this.newSy(),Jt.KnownStaffMeta;case"transpose":return this._allowNegatives=!0,this._sy=this.newSy(),this._sy===k.Number?this._currentStaff.transpositionPitch=this._syData*-1:this.error("transpose",k.Number,!0),this._allowNegatives=!1,this._sy=this.newSy(),Jt.KnownStaffMeta;case"track":case"staff":return Jt.EndOfMetaDetected;case"voice":return this._sy=this.newSy(),this.handleNewVoice()?Jt.EndOfMetaDetected:Jt.KnownStaffMeta;default:return Jt.UnknownStaffMeta}}handleAccidentalMode(){switch(this._sy=this.newSy(),this._sy!==k.String&&this.error("accidental-mode",k.String,!0),this._syData){case"auto":this._accidentalMode=ho.Auto;break;case"explicit":this._accidentalMode=ho.Explicit;break}this._sy=this.newSy()}makeCurrentStaffPitched(){this._currentStaff.stringTuning.tunings=[],this._staffHasExplicitDisplayTransposition||(this._currentStaff.displayTranspositionPitch=0)}static toArticulationId(e){return e.replace(/[^a-zA-Z0-9]/g,"").toLowerCase()}applyPercussionStaff(e){e.isPercussion=!0,e.showTablature=!1}chordProperties(e){if(this._sy===k.LBrace){for(this._sy=this.newSy();this._sy===k.String;)switch(this._syData.toLowerCase()){case"firstfret":switch(this._sy=this.newSy(),this._sy){case k.Number:e.firstFret=this._syData;break;default:this.error("chord-firstfret",k.Number,!0);break}this._sy=this.newSy();break;case"showdiagram":switch(this._sy=this.newSy(),this._sy){case k.String:e.showDiagram=this._syData.toLowerCase()!=="false";break;case k.Number:e.showDiagram=this._syData!==0;break;default:this.error("chord-showdiagram",k.String,!0);break}this._sy=this.newSy();break;case"showfingering":switch(this._sy=this.newSy(),this._sy){case k.String:e.showDiagram=this._syData.toLowerCase()!=="false";break;case k.Number:e.showFingering=this._syData!==0;break;default:this.error("chord-showfingering",k.String,!0);break}this._sy=this.newSy();break;case"showname":switch(this._sy=this.newSy(),this._sy){case k.String:e.showName=this._syData.toLowerCase()!=="false";break;case k.Number:e.showName=this._syData!==0;break;default:this.error("chord-showname",k.String,!0);break}this._sy=this.newSy();break;case"barre":for(this._sy=this.newSy();this._sy===k.Number;)e.barreFrets.push(this._syData),this._sy=this.newSy();break;default:this.error("chord-properties",k.String,!1);break}this._sy!==k.RBrace&&this.error("chord-properties",k.RBrace,!0),this._sy=this.newSy()}}bars(){const e=this.bar();for(;this._sy!==k.Eof;)if(this._sy===k.Pipe)this._sy=this.newSy(),this.bar();else if(this._sy===k.MetaCommand)this.bar();else break;return e}trackStaffMeta(){if(this._sy!==k.MetaCommand)return!1;if(this._syData.toLowerCase()==="track"&&(this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._score.masterBars.length>0&&this.newTrack(),this._sy===k.String&&(this._currentTrack.name=this._syData,this._sy=this.newSy()),this._sy===k.String&&(this._currentTrack.shortName=this._syData,this._sy=this.newSy()),this.trackProperties()),this._sy===k.MetaCommand&&this._syData.toLowerCase()==="staff"){if(this._staffHasExplicitDisplayTransposition=!1,this._staffHasExplicitTuning=!1,this._staffTuningApplied=!1,this._sy=this.newSy(),this._currentTrack.staves[0].bars.length>0){const e=this._currentStaff.isPercussion;this._currentTrack.ensureStaveCount(this._currentTrack.staves.length+1),this.beginStaff(this._currentTrack.staves[this._currentTrack.staves.length-1]),e&&this.applyPercussionStaff(this._currentStaff),this._currentDynamics=j.F}this.staffProperties()}return this._sy===k.MetaCommand&&this._syData.toLowerCase()==="voice"&&(this._sy=this.newSy(),this.handleNewVoice()),!0}handleNewVoice(){if(this._voiceIndex===0&&(this._currentStaff.bars.length===0||this._currentStaff.bars.length===1&&this._currentStaff.bars[0].isEmpty))return!1;for(const e of this._currentStaff.bars){const t=new Bs;e.addVoice(t)}return this._voiceIndex++,this._barIndex=0,!0}beginStaff(e){this._currentStaff=e,this._slurs.clear(),this._barIndex=0,this._voiceIndex=0}trackProperties(){if(this._sy===k.LBrace){for(this._sy=this.newSy();this._sy===k.String;)switch(this._syData.toLowerCase()){case"color":this._sy=this.newSy(),this._sy!==k.String&&this.error("track-color",k.String,!0),this._currentTrack.color=Pe.fromJson(this._syData),this._sy=this.newSy();break;case"defaultsystemslayout":this._sy=this.newSy(),this._sy===k.Number?(this._currentTrack.defaultSystemsLayout=this._syData,this._sy=this.newSy()):this.error("default-systems-layout",k.Number,!0);break;case"systemslayout":for(this._sy=this.newSy();this._sy===k.Number;)this._currentTrack.systemsLayout.push(this._syData),this._sy=this.newSy();break;case"volume":this._sy=this.newSy(),this._sy!==k.Number&&this.error("track-volume",k.Number,!0),this._currentTrack.playbackInfo.volume=V.clamp(this._syData,0,16),this._sy=this.newSy();break;case"balance":this._sy=this.newSy(),this._sy!==k.Number&&this.error("track-balance",k.Number,!0),this._currentTrack.playbackInfo.balance=V.clamp(this._syData,0,16),this._sy=this.newSy();break;case"mute":this._sy=this.newSy(),this._currentTrack.playbackInfo.isMute=!0;break;case"solo":this._sy=this.newSy(),this._currentTrack.playbackInfo.isSolo=!0;break;case"multibarrest":this._sy=this.newSy(),this._score.stylesheet.perTrackMultiBarRest||(this._score.stylesheet.perTrackMultiBarRest=new Set),this._score.stylesheet.perTrackMultiBarRest.add(this._currentTrack.index);break;default:this.error("track-properties",k.String,!1);break}this._sy!==k.RBrace&&this.error("track-properties",k.RBrace,!0),this._sy=this.newSy()}}staffProperties(){if(this._sy!==k.LBrace)return;this._sy=this.newSy();let e=!1,t=!1,i=!1,a=!1;for(;this._sy===k.String;)switch(this._syData.toLowerCase()){case"score":e=!0,this._sy=this.newSy(),this._sy===k.Number&&(this._currentStaff.standardNotationLineCount=this._syData,this._sy=this.newSy());break;case"tabs":t=!0,this._sy=this.newSy();break;case"slash":i=!0,this._sy=this.newSy();break;case"numbered":a=!0,this._sy=this.newSy();break;default:this.error("staff-properties",k.String,!1);break}(e||t||i||a)&&(this._currentStaff.showStandardNotation=e,this._currentStaff.showTablature=t,this._currentStaff.showSlash=i,this._currentStaff.showNumbered=a),this._sy!==k.RBrace&&this.error("staff-properties",k.RBrace,!0),this._sy=this.newSy()}bar(){const e=this.trackStaffMeta(),t=this.newBar(this._currentStaff);if(this._currentStaff.bars.length>this._score.masterBars.length){const l=new Ca;this._score.addMasterBar(l),l.index>0&&(l.timeSignatureDenominator=l.previousMasterBar.timeSignatureDenominator,l.timeSignatureNumerator=l.previousMasterBar.timeSignatureNumerator,l.tripletFeel=l.previousMasterBar.tripletFeel)}const i=this.barMeta(t),a=this._currentTrack.playbackInfo.program;!this._staffTuningApplied&&!this._staffHasExplicitTuning&&(this._currentStaff.stringTuning.tunings=[],a===15?this._currentStaff.stringTuning.tunings=M.getDefaultTuningFor(6).tunings:a>=24&&a<=31?this._currentStaff.stringTuning.tunings=M.getDefaultTuningFor(6).tunings:a>=32&&a<=39?this._currentStaff.stringTuning.tunings=[43,38,33,28]:a===40||a===44||a===45||a===48||a===49||a===50||a===51?this._currentStaff.stringTuning.tunings=[52,57,50,43]:a===41?this._currentStaff.stringTuning.tunings=[57,50,43,36]:a===42?this._currentStaff.stringTuning.tunings=[45,38,31,24]:a===43?this._currentStaff.stringTuning.tunings=[43,38,33,28]:a===105?this._currentStaff.stringTuning.tunings=[50,47,43,38,55]:a===106?this._currentStaff.stringTuning.tunings=[57,52,45]:a===107?this._currentStaff.stringTuning.tunings=[52,45,38,31]:a===110&&(this._currentStaff.stringTuning.tunings=[64,57,50,43]),this._staffTuningApplied=!0),this._staffHasExplicitDisplayTransposition||(a>=24&&a<=31||a>=32&&a<=39||a===43?this._currentStaff.displayTranspositionPitch=-12:this._currentStaff.displayTranspositionPitch=0);let n=!1;const r=t.voices[this._voiceIndex];if(!(this._sy===k.MetaCommand&&(this._syData.toLowerCase()==="track"||this._syData.toLowerCase()==="staff")))for(;this._sy!==k.Pipe&&this._sy!==k.Eof&&this.beat(r);)n=!0;if(r.beats.length===0){const l=new Wt;l.isEmpty=!0,r.addBeat(l)}return e||i||n}newBar(e){if(this._barIndex<e.bars.length){const a=e.bars[this._barIndex];return this._barIndex++,a}const t=e.bars.length===0?1:e.bars[0].voices.length,i=new qi;e.addBar(i),i.previousBar&&(i.clef=i.previousBar.clef,i.clefOttava=i.previousBar.clefOttava,i.keySignature=i.previousBar.keySignature,i.keySignatureType=i.previousBar.keySignatureType),this._barIndex++;for(let a=0;a<t;a++){const n=new Bs;i.addVoice(n)}return i}beat(e){this.beatDuration();const t=new Wt;if(e.addBeat(t),this._allowTuning=!this._currentStaff.isPercussion,this._sy===k.LParensis){for(this._sy=this.newSy(),this.note(t);this._sy!==k.RParensis&&this._sy!==k.Eof&&(this._allowTuning=!this._currentStaff.isPercussion,!!this.note(t)););this._sy!==k.RParensis&&this.error("note-list",k.RParensis,!0),this._sy=this.newSy()}else if(this._sy===k.String&&this._syData.toLowerCase()==="r")this._sy=this.newSy();else if(!this.note(t))return e.beats.splice(e.beats.length-1,1),!1;this._sy===k.Dot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==k.Number&&this.error("duration",k.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._sy=this.newSy()),t.duration=this._currentDuration,t.dynamics=this._currentDynamics,this._currentTuplet!==1&&!t.hasTuplet&&di.applyTuplet(t,this._currentTuplet);let i=1;this._sy===k.Multiply&&(this._sy=this.newSy(),this._sy!==k.Number?this.error("multiplier",k.Number,!0):i=this._syData,this._sy=this.newSy()),this.beatEffects(t);for(let a=0;a<i-1;a++)e.addBeat(Cg.clone(t));return!0}beatDuration(){if(this._sy===k.DoubleDot&&(this._allowNegatives=!0,this._sy=this.newSy(),this._allowNegatives=!1,this._sy!==k.Number&&this.error("duration",k.Number,!0),this._currentDuration=this.parseDuration(this._syData),this._currentTuplet=1,this._sy=this.newSy(),this._sy===k.LBrace)){for(this._sy=this.newSy();this._sy===k.String;)switch(this._syData.toLowerCase()){case"tu":this._sy=this.newSy(),this._sy!==k.Number&&this.error("duration-tuplet",k.Number,!0),this._currentTuplet=this._syData,this._sy=this.newSy();break;default:this.error("beat-duration",k.String,!1);break}this._sy!==k.RBrace&&this.error("beat-duration",k.RBrace,!0),this._sy=this.newSy()}}beatEffects(e){if(this._sy===k.LBrace){for(this._sy=this.newSy();this._sy===k.String;)this.applyBeatEffect(e)||this.error("beat-effects",k.String,!1);this._sy!==k.RBrace&&this.error("beat-effects",k.RBrace,!0),this._sy=this.newSy()}}applyBeatEffect(e){const t=this._syData.toLowerCase();if(t==="f")e.fade=qt.FadeIn;else if(t==="fo")e.fade=qt.FadeOut;else if(t==="vs")e.fade=qt.VolumeSwell;else if(t==="v")e.vibrato=ve.Slight;else if(t==="vw")e.vibrato=ve.Wide;else if(t==="s")e.slap=!0;else if(t==="p")e.pop=!0;else if(t==="tt")e.tap=!0;else if(t==="txt"){if(this._sy=this.newSy(),this._sy!==k.String)return this.error("beat-text",k.String,!0),!1;e.text=this._syData}else if(t==="dd")e.dots=2;else if(t==="d")e.dots=1;else if(t==="su")e.pickStroke=ni.Up;else if(t==="sd")e.pickStroke=ni.Down;else if(t==="tu"){if(this._sy=this.newSy(),this._sy!==k.Number)return this.error("tuplet",k.Number,!0),!1;const i=this._syData;if(this._sy=this.newSy(),this._sy===k.Number){const a=this._syData;this._sy=this.newSy(),e.tupletNumerator=i,e.tupletDenominator=a}else di.applyTuplet(e,i);return!0}else if(t==="tb"||t==="tbe"){this._sy=this.newSy();const i=t==="tbe";for(this._sy===k.String&&(e.whammyBarType=this.parseWhammyType(this._syData),this._sy=this.newSy()),this._sy===k.String&&(e.whammyStyle=this.parseBendStyle(this._syData),this._sy=this.newSy()),this._sy!==k.LParensis&&this.error("tremolobar-effect",k.LParensis,!0),this._allowNegatives=!0,this._allowFloat=!0,this._sy=this.newSy();this._sy!==k.RParensis&&this._sy!==k.Eof;){let a=0,n=0;i?(this._sy!==k.Number&&this.error("tremolobar-effect",k.Number,!0),a=this._syData,this._sy=this.newSy(),this._sy!==k.Number&&this.error("tremolobar-effect",k.Number,!0),n=this._syData):(this._sy!==k.Number&&this.error("tremolobar-effect",k.Number,!0),a=0,n=this._syData),e.addWhammyBarPoint(new H(a,n)),this._sy=this.newSy()}if(e.whammyBarPoints!=null){for(;e.whammyBarPoints.length>60;)e.removeWhammyBarPoint(e.whammyBarPoints.length-1);if(i)e.whammyBarPoints.sort((a,n)=>a.offset-n.offset);else{const a=e.whammyBarPoints.length,n=60/a|0;let r=0;for(;r<a;)e.whammyBarPoints[r].offset=Math.min(60,r*n),r++}}this._allowNegatives=!1,this._allowFloat=!1,this._sy!==k.RParensis&&this.error("tremolobar-effect",k.RParensis,!0)}else if(t==="bu"||t==="bd"||t==="au"||t==="ad"){switch(t){case"bu":e.brushType=Y.BrushUp;break;case"bd":e.brushType=Y.BrushDown;break;case"au":e.brushType=Y.ArpeggioUp;break;case"ad":e.brushType=Y.ArpeggioDown;break}return this._sy=this.newSy(),this._sy===k.Number?(e.brushDuration=this._syData,this._sy=this.newSy(),!0):(e.updateDurations(),t==="bu"||t==="bd"?e.brushDuration=e.playbackDuration/4/e.notes.length:(t==="au"||t==="ad")&&(e.brushDuration=e.playbackDuration/e.notes.length),!0)}else if(t==="ch"){this._sy=this.newSy();const i=this._syData,a=this.getChordId(this._currentStaff,i);if(!this._currentStaff.hasChord(a)){const n=new er;n.showDiagram=!1,n.name=i,this._currentStaff.addChord(a,n)}e.chordId=a}else{if(t==="gr")return this._sy=this.newSy(),this._syData.toLowerCase()==="ob"?(e.graceType=se.OnBeat,this._sy=this.newSy()):this._syData.toLowerCase()==="b"?(e.graceType=se.BendGrace,this._sy=this.newSy()):e.graceType=se.BeforeBeat,!0;if(t==="dy"){this._sy=this.newSy();const i=this._syData.toUpperCase();switch(i){case"PPP":case"PP":case"P":case"MP":case"MF":case"F":case"FF":case"FFF":case"PPPP":case"PPPPP":case"PPPPPP":case"FFFF":case"FFFFF":case"FFFFFF":case"SF":case"SFP":case"SFPP":case"FP":case"RF":case"RFZ":case"SFZ":case"SFFZ":case"FZ":case"N":case"PF":case"SFZP":e.dynamics=j[i];break}this._currentDynamics=e.dynamics}else if(t==="cre")e.crescendo=vi.Crescendo;else if(t==="dec")e.crescendo=vi.Decrescendo;else if(t==="tempo"){const i=this.readTempoAutomation();return e.automations.push(i),e.voice.bar.masterBar.tempoAutomations.push(i),!0}else if(t==="tp"){if(this._sy=this.newSy(),e.tremoloSpeed=w.Eighth,this._sy===k.Number){switch(this._syData){case 8:e.tremoloSpeed=w.Eighth;break;case 16:e.tremoloSpeed=w.Sixteenth;break;case 32:e.tremoloSpeed=w.ThirtySecond;break;default:e.tremoloSpeed=w.Eighth;break}this._sy=this.newSy()}return!0}else if(t==="spd"){const i=new xr;return i.pedalType=Et.Down,i.ratioPosition=e.voice.bar.sustainPedals.length,this._sustainPedalToBeat.set(i,e),e.voice.bar.sustainPedals.push(i),this._sy=this.newSy(),!0}else if(t==="spu"){const i=new xr;return i.pedalType=Et.Up,i.ratioPosition=e.voice.bar.sustainPedals.length,this._sustainPedalToBeat.set(i,e),e.voice.bar.sustainPedals.push(i),this._sy=this.newSy(),!0}else if(t==="spe"){const i=new xr;return i.pedalType=Et.Up,i.ratioPosition=1,e.voice.bar.sustainPedals.push(i),this._sy=this.newSy(),!0}else{if(t==="slashed")return e.slashed=!0,this._sy=this.newSy(),!0;if(t==="ds")return e.deadSlapped=!0,this._sy=this.newSy(),!0;if(t==="glpf")return this._sy=this.newSy(),e.golpe=Ji.Finger,!0;if(t==="glpt")return this._sy=this.newSy(),e.golpe=Ji.Thumb,!0;if(t==="waho")return this._sy=this.newSy(),e.wahPedal=ls.Open,!0;if(t==="wahc")return this._sy=this.newSy(),e.wahPedal=ls.Closed,!0;if(t==="barre"){if(this._sy=this.newSy(),this._sy!==k.Number&&this.error("beat-barre",k.Number,!0),e.barreFret=this._syData,e.barreShape=ns.Full,this._sy=this.newSy(),this._sy===k.String)switch(this._syData.toLowerCase()){case"full":e.barreShape=ns.Full,this._sy=this.newSy();break;case"half":e.barreShape=ns.Half,this._sy=this.newSy();break}return!0}else if(t==="rasg"){switch(this._sy=this.newSy(),this._sy!==k.String&&this.error("rasgueado",k.String,!0),this._syData.toLowerCase()){case"ii":e.rasgueado=X.Ii;break;case"mi":e.rasgueado=X.Mi;break;case"miitriplet":e.rasgueado=X.MiiTriplet;break;case"miianapaest":e.rasgueado=X.MiiAnapaest;break;case"pmptriplet":e.rasgueado=X.PmpTriplet;break;case"pmpanapaest":e.rasgueado=X.PmpAnapaest;break;case"peitriplet":e.rasgueado=X.PeiTriplet;break;case"peianapaest":e.rasgueado=X.PeiAnapaest;break;case"paitriplet":e.rasgueado=X.PaiTriplet;break;case"paianapaest":e.rasgueado=X.PaiAnapaest;break;case"amitriplet":e.rasgueado=X.AmiTriplet;break;case"amianapaest":e.rasgueado=X.AmiAnapaest;break;case"ppp":e.rasgueado=X.Ppp;break;case"amii":e.rasgueado=X.Amii;break;case"amip":e.rasgueado=X.Amip;break;case"eami":e.rasgueado=X.Eami;break;case"eamii":e.rasgueado=X.Eamii;break;case"peami":e.rasgueado=X.Peami;break}return this._sy=this.newSy(),!0}else if(t==="ot")this._sy=this.newSy(),this._sy!==k.String&&this.error("beat-ottava",k.String,!0),e.ottava=this.parseClefOttavaFromString(this._syData);else if(t==="legatoorigin")e.isLegatoOrigin=!0;else if(t==="instrument"){this._sy=this.newSy();let i=0;this._sy===k.Number?i=this._syData:this._sy===k.String?i=oa.getValue(this._syData):this.error("instrument-change",k.Number,!0);const a=new wt;a.isLinear=!1,a.type=tt.Instrument,a.value=i,e.automations.push(a)}else if(t==="fermata"){this._sy=this.newSy(),this._sy!==k.String&&this.error("fermata",k.Number,!0);const i=new Rh;return i.type=this.parseFermataFromString(this._syData),this._allowFloat=!0,this._sy=this.newSy(),this._sy===k.Number&&(i.length=this._syData,this._sy=this.newSy()),this._allowFloat=!1,e.fermata=i,!0}else if(t==="beam"){switch(this._sy=this.newSy(),this._sy!==k.String&&this.error("beam",k.Number,!0),this._syData.toLowerCase()){case"invert":e.invertBeamDirection=!0;break;case"up":e.preferredBeamDirection=P.Up;break;case"down":e.preferredBeamDirection=P.Down;break;case"auto":e.beamingMode=it.Auto;break;case"split":e.beamingMode=it.ForceSplitToNext;break;case"merge":e.beamingMode=it.ForceMergeWithNext;break;case"splitsecondary":e.beamingMode=it.ForceSplitOnSecondaryToNext;break}return this._sy=this.newSy(),!0}else return t==="timer"?(e.showTimer=!0,this._sy=this.newSy(),!0):!1}}return this._sy=this.newSy(),!0}parseBracketExtendMode(e){switch(e.toLowerCase()){case"nobrackets":return la.NoBrackets;case"groupstaves":return la.GroupStaves;case"groupsimilarinstruments":return la.GroupSimilarInstruments;default:return la.GroupStaves}}parseFermataFromString(e){switch(e.toLowerCase()){case"short":return Bi.Short;case"medium":return Bi.Medium;case"long":return Bi.Long;default:return Bi.Medium}}parseClefOttavaFromString(e){switch(e.toLowerCase()){case"15ma":return fe._15ma;case"8va":return fe._8va;case"regular":return fe.Regular;case"8vb":return fe._8vb;case"15mb":return fe._15mb;default:return fe.Regular}}getChordId(e,t){return t.toLowerCase()+e.index+e.track.index}static applyTuplet(e,t){switch(t){case 3:e.tupletNumerator=3,e.tupletDenominator=2;break;case 5:e.tupletNumerator=5,e.tupletDenominator=4;break;case 6:e.tupletNumerator=6,e.tupletDenominator=4;break;case 7:e.tupletNumerator=7,e.tupletDenominator=4;break;case 9:e.tupletNumerator=9,e.tupletDenominator=8;break;case 10:e.tupletNumerator=10,e.tupletDenominator=8;break;case 11:e.tupletNumerator=11,e.tupletDenominator=8;break;case 12:e.tupletNumerator=12,e.tupletDenominator=8;break;default:e.tupletNumerator=1,e.tupletDenominator=1;break}}isNoteText(e){return e==="x"||e==="-"||e==="r"}note(e){let t=!1,i=!1,a=-1,n=-1,r=-1,o=ke.Default;switch(this._sy){case k.Number:a=this._syData,this._currentStaff.isPercussion&&!At.instrumentArticulations.has(a)&&this.errorMessage(`Unknown percussion articulation ${a}`);break;case k.String:if(this._currentStaff.isPercussion){const f=this._syData.toLowerCase();this._percussionArticulationNames.has(f)?a=this._percussionArticulationNames.get(f):this.errorMessage(`Unknown percussion articulation '${this._syData}'`)}else t=this._syData==="x",i=this._syData==="-",i||t?a=0:this.error("note-fret",k.Number,!0);break;case k.Tuning:e.index===0&&e.voice.index===0&&e.voice.bar.index===0&&this.makeCurrentStaffPitched();const d=this._syData;n=d.octave,r=d.tone.noteValue,this._accidentalMode===ho.Explicit&&(o=d.tone.accidentalMode);break;default:return!1}this._sy=this.newSy();const l=n===-1&&this._currentStaff.tuning.length>0&&!this._currentStaff.isPercussion;let h=-1;l&&(this._sy!==k.Dot&&this.error("note",k.Dot,!0),this._sy=this.newSy(),this._sy!==k.Number&&this.error("note-string",k.Number,!0),h=this._syData,(h<1||h>this._currentStaff.tuning.length)&&this.error("note-string",k.Number,!1),this._sy=this.newSy());const c=new bt;if(l)c.string=this._currentStaff.tuning.length-(h-1),c.isDead=t,c.isTieDestination=i,i||(c.fret=a);else if(this._currentStaff.isPercussion){const d=a;let f=0;if(this._articulationValueToIndex.has(d))f=this._articulationValueToIndex.get(d);else{f=this._currentTrack.percussionArticulations.length;const p=At.getArticulationByInputMidiNumber(d);p===null&&this.errorMessage(`Unknown articulation value ${d}`),this._currentTrack.percussionArticulations.push(p),this._articulationValueToIndex.set(d,f)}c.percussionArticulation=f}else c.octave=n,c.tone=r,c.accidentalMode=o,c.isTieDestination=i;return e.addNote(c),this.noteEffects(c),!0}noteEffects(e){if(this._sy===k.LBrace){for(this._sy=this.newSy();this._sy===k.String;){const t=this._syData.toLowerCase();if(t==="b"||t==="be"){this._sy=this.newSy();const i=t==="be";for(this._sy===k.String&&(e.bendType=this.parseBendType(this._syData),this._sy=this.newSy()),this._sy===k.String&&(e.bendStyle=this.parseBendStyle(this._syData),this._sy=this.newSy()),this._sy!==k.LParensis&&this.error("bend-effect",k.LParensis,!0),this._sy=this.newSy();this._sy!==k.RParensis&&this._sy!==k.Eof;){let n=0,r=0;i?(this._sy!==k.Number&&this.error("bend-effect-value",k.Number,!0),n=this._syData,this._sy=this.newSy(),this._sy!==k.Number&&this.error("bend-effect-value",k.Number,!0),r=this._syData):(this._sy!==k.Number&&this.error("bend-effect-value",k.Number,!0),r=this._syData),e.addBendPoint(new H(n,r)),this._sy=this.newSy()}const a=e.bendPoints;if(a!=null){for(;a.length>60;)a.splice(a.length-1,1);if(i)a.sort((n,r)=>n.offset-r.offset);else{const n=a.length,r=60/(n-1)|0;let o=0;for(;o<n;)a[o].offset=Math.min(60,o*r),o++}}this._sy!==k.RParensis&&this.error("bend-effect",k.RParensis,!0),this._sy=this.newSy()}else if(t==="nh")e.harmonicType=ae.Natural,e.harmonicValue=V.deltaFretToHarmonicValue(e.fret),this._sy=this.newSy();else if(t==="ah")e.harmonicType=ae.Artificial,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if(t==="th")e.harmonicType=ae.Tap,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if(t==="ph")e.harmonicType=ae.Pinch,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if(t==="sh")e.harmonicType=ae.Semi,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if(t==="fh")e.harmonicType=ae.Feedback,e.harmonicValue=this.harmonicValue(e.harmonicValue);else if(t==="tr"){this._sy=this.newSy(),this._sy!==k.Number&&this.error("trill-effect",k.Number,!0);const i=this._syData;this._sy=this.newSy();let a=w.Sixteenth;if(this._sy===k.Number){switch(this._syData){case 16:a=w.Sixteenth;break;case 32:a=w.ThirtySecond;break;case 64:a=w.SixtyFourth;break;default:a=w.Sixteenth;break}this._sy=this.newSy()}e.trillValue=i+e.stringTuning,e.trillSpeed=a}else if(t==="v")this._sy=this.newSy(),e.vibrato=ve.Slight;else if(t==="sl")this._sy=this.newSy(),e.slideOutType=pe.Legato;else if(t==="ss")this._sy=this.newSy(),e.slideOutType=pe.Shift;else if(t==="sib")this._sy=this.newSy(),e.slideInType=jt.IntoFromBelow;else if(t==="sia")this._sy=this.newSy(),e.slideInType=jt.IntoFromAbove;else if(t==="sou")this._sy=this.newSy(),e.slideOutType=pe.OutUp;else if(t==="sod")this._sy=this.newSy(),e.slideOutType=pe.OutDown;else if(t==="psd")this._sy=this.newSy(),e.slideOutType=pe.PickSlideDown;else if(t==="psu")this._sy=this.newSy(),e.slideOutType=pe.PickSlideUp;else if(t==="h")this._sy=this.newSy(),e.isHammerPullOrigin=!0;else if(t==="lht")this._sy=this.newSy(),e.isLeftHandTapped=!0;else if(t==="g")this._sy=this.newSy(),e.isGhost=!0;else if(t==="ac")this._sy=this.newSy(),e.accentuated=_t.Normal;else if(t==="hac")this._sy=this.newSy(),e.accentuated=_t.Heavy;else if(t==="ten")this._sy=this.newSy(),e.accentuated=_t.Tenuto;else if(t==="pm")this._sy=this.newSy(),e.isPalmMute=!0;else if(t==="st")this._sy=this.newSy(),e.isStaccato=!0;else if(t==="lr")this._sy=this.newSy(),e.isLetRing=!0;else if(t==="x")this._sy=this.newSy(),e.fret=0,e.isDead=!0;else if(t==="-"||t==="t")this._sy=this.newSy(),e.isTieDestination=!0;else if(t==="lf"){this._sy=this.newSy();let i=ie.Thumb;this._sy===k.Number&&(i=this.toFinger(this._syData),this._sy=this.newSy()),e.leftHandFinger=i}else if(t==="rf"){this._sy=this.newSy();let i=ie.Thumb;this._sy===k.Number&&(i=this.toFinger(this._syData),this._sy=this.newSy()),e.rightHandFinger=i}else if(t==="acc")this._sy=this.newSy(),this._sy!==k.String&&this.error("note-accidental",k.String,!0),e.accidentalMode=V.parseAccidentalMode(this._syData),this._sy=this.newSy();else if(t==="turn")this._sy=this.newSy(),e.ornament=Tt.Turn;else if(t==="iturn")this._sy=this.newSy(),e.ornament=Tt.InvertedTurn;else if(t==="umordent")this._sy=this.newSy(),e.ornament=Tt.UpperMordent;else if(t==="lmordent")this._sy=this.newSy(),e.ornament=Tt.LowerMordent;else if(t==="string")this._sy=this.newSy(),e.showStringNumber=!0;else if(t==="hide")this._sy=this.newSy(),e.isVisible=!1;else if(t==="slur"){this._sy=this.newSy(),this._sy!==k.String&&this.error("slur",k.String,!0);const i=this._syData;if(this._slurs.has(i)){const a=this._slurs.get(i);a.slurDestination=e,e.slurOrigin=a,e.isSlurDestination=!0}else this._slurs.set(i,e);this._sy=this.newSy()}else this.applyBeatEffect(e.beat)||this.error(t,k.String,!1)}this._sy!==k.RBrace&&this.error("note-effect",k.RBrace,!1),this._sy=this.newSy()}}harmonicValue(e){return this._allowNegatives=!0,this._allowFloat=!0,this._sy=this.newSy(),this._sy===k.Number&&(e=this._syData,this._sy=this.newSy()),this._allowNegatives=!1,this._allowFloat=!1,e}toFinger(e){switch(e){case 1:return ie.Thumb;case 2:return ie.IndexFinger;case 3:return ie.MiddleFinger;case 4:return ie.AnnularFinger;case 5:return ie.LittleFinger}return ie.Thumb}parseDuration(e){switch(e){case-4:return w.QuadrupleWhole;case-2:return w.DoubleWhole;case 1:return w.Whole;case 2:return w.Half;case 4:return w.Quarter;case 8:return w.Eighth;case 16:return w.Sixteenth;case 32:return w.ThirtySecond;case 64:return w.SixtyFourth;case 128:return w.OneHundredTwentyEighth;case 256:return w.TwoHundredFiftySixth;default:return w.Quarter}}parseBendStyle(e){switch(e.toLowerCase()){case"gradual":return Xe.Gradual;case"fast":return Xe.Fast;default:return Xe.Default}}parseBendType(e){switch(e.toLowerCase()){case"none":return q.None;case"custom":return q.Custom;case"bend":return q.Bend;case"release":return q.Release;case"bendrelease":return q.BendRelease;case"hold":return q.Hold;case"prebend":return q.Prebend;case"prebendbend":return q.PrebendBend;case"prebendrelease":return q.PrebendRelease;default:return q.Custom}}barMeta(e){let t=!1;const i=e.masterBar;let a=!1;for(;!a&&this._sy===k.MetaCommand;){t=!0;const n=this._syData.toLowerCase();if(n==="ts")this._sy=this.newSy(),this._sy===k.String?this._syData.toLowerCase()==="common"?(i.timeSignatureCommon=!0,i.timeSignatureNumerator=4,i.timeSignatureDenominator=4,this._sy=this.newSy()):this.error("timesignature-numerator",k.String,!0):(this._sy!==k.Number&&this.error("timesignature-numerator",k.Number,!0),i.timeSignatureNumerator=this._syData,this._sy=this.newSy(),this._sy!==k.Number&&this.error("timesignature-denominator",k.Number,!0),i.timeSignatureDenominator=this._syData,this._sy=this.newSy());else if(n==="ft")i.isFreeTime=!0,this._sy=this.newSy();else if(n==="ro")i.isRepeatStart=!0,this._sy=this.newSy();else if(n==="rc")this._sy=this.newSy(),this._sy!==k.Number&&this.error("repeatclose",k.Number,!0),this._syData>2048&&this.error("repeatclose",k.Number,!1),i.repeatCount=this._syData,this._sy=this.newSy();else if(n==="ae")if(this._sy=this.newSy(),this._sy===k.LParensis){for(this._sy=this.newSy(),this._sy!==k.Number&&this.error("alternateending",k.Number,!0),this.applyAlternateEnding(i);this._sy===k.Number;)this.applyAlternateEnding(i);this._sy!==k.RParensis&&this.error("alternateending-list",k.RParensis,!0),this._sy=this.newSy()}else this._sy!==k.Number&&this.error("alternateending",k.Number,!0),this.applyAlternateEnding(i);else if(n==="ks")this._sy=this.newSy(),this._sy!==k.String&&this.error("keysignature",k.String,!0),e.keySignature=this.parseKeySignature(this._syData),e.keySignatureType=this.parseKeySignatureType(this._syData),this._sy=this.newSy();else if(n==="clef"){switch(this._sy=this.newSy(),this._sy){case k.String:e.clef=this.parseClefFromString(this._syData);break;case k.Number:e.clef=this.parseClefFromInt(this._syData);break;case k.Tuning:const r=this._syData;e.clef=this.parseClefFromInt(r.realValue);break;default:this.error("clef",k.String,!0);break}this._sy=this.newSy()}else if(n==="tempo"){const r=this.readTempoAutomation();i.tempoAutomations.push(r)}else if(n==="section"){this._sy=this.newSy(),this._sy!==k.String&&this.error("section",k.String,!0);let r=this._syData;this._sy=this.newSy();let o="";this._sy===k.String&&!this.isNoteText(this._syData.toLowerCase())&&(o=r,r=this._syData,this._sy=this.newSy());const l=new Mh;l.marker=o,l.text=r,i.section=l}else if(n==="tf"){switch(this._allowTuning=!1,this._sy=this.newSy(),this._allowTuning=!0,this._sy){case k.String:i.tripletFeel=this.parseTripletFeelFromString(this._syData);break;case k.Number:i.tripletFeel=this.parseTripletFeelFromInt(this._syData);break;default:this.error("triplet-feel",k.String,!0);break}this._sy=this.newSy()}else if(n==="ac")i.isAnacrusis=!0,this._sy=this.newSy();else if(n==="db")i.isDoubleBar=!0,e.barLineRight=oe.LightLight,this._sy=this.newSy();else if(n==="barlineleft")this._sy=this.newSy(),this._sy!==k.String&&this.error("barlineleft",k.String,!0),e.barLineLeft=this.parseBarLineStyle(this._syData),this._sy=this.newSy();else if(n==="barlineright")this._sy=this.newSy(),this._sy!==k.String&&this.error("barlineright",k.String,!0),e.barLineRight=this.parseBarLineStyle(this._syData),this._sy=this.newSy();else if(n==="accidentals")this.handleAccidentalMode();else if(n==="jump")this.handleDirections(i);else if(n==="ottava")this._sy=this.newSy(),this._sy!==k.String&&this.error("ottava",k.String,!0),e.clefOttava=this.parseClefOttavaFromString(this._syData),this._sy=this.newSy();else if(n==="simile")this._sy=this.newSy(),this._sy!==k.String&&this.error("simile",k.String,!0),e.simileMark=this.parseSimileMarkFromString(this._syData),this._sy=this.newSy();else if(n==="scale")this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==k.Number&&this.error("scale",k.Number,!0),i.displayScale=this._syData,e.displayScale=this._syData,this._sy=this.newSy();else if(n==="width")this._sy=this.newSy(),this._sy!==k.Number&&this.error("width",k.Number,!0),i.displayWidth=this._syData,e.displayWidth=this._syData,this._sy=this.newSy();else if(e.index===0)switch(this.handleStaffMeta()){case Jt.KnownStaffMeta:break;case Jt.UnknownStaffMeta:this.error("measure-effects",k.String,!1);break;case Jt.EndOfMetaDetected:a=!0;break}else switch(this.handleStaffMeta()){case Jt.EndOfMetaDetected:a=!0;break;default:this.error("measure-effects",k.String,!1);break}}if(i.index===0&&i.tempoAutomations.length===0){const n=new wt;n.isLinear=!1,n.type=tt.Tempo,n.value=this._score.tempo,n.text=this._score.tempoLabel,i.tempoAutomations.push(n)}return t}parseBarLineStyle(e){switch(e.toLowerCase()){case"automatic":return oe.Automatic;case"dashed":return oe.Dashed;case"dotted":return oe.Dotted;case"heavy":return oe.Heavy;case"heavyheavy":return oe.HeavyHeavy;case"heavylight":return oe.HeavyLight;case"lightheavy":return oe.LightHeavy;case"lightlight":return oe.LightLight;case"none":return oe.None;case"regular":return oe.Regular;case"short":return oe.Short;case"tick":return oe.Tick}return oe.Automatic}parseSimileMarkFromString(e){switch(e.toLowerCase()){case"none":return St.None;case"simple":return St.Simple;case"firstofdouble":return St.FirstOfDouble;case"secondofdouble":return St.SecondOfDouble;default:return St.None}}handleDirections(e){switch(this._sy=this.newSy(),this._sy!==k.String&&this.error("direction",k.String,!0),this._syData.toLowerCase()){case"fine":e.addDirection(R.TargetFine);break;case"segno":e.addDirection(R.TargetSegno);break;case"segnosegno":e.addDirection(R.TargetSegnoSegno);break;case"coda":e.addDirection(R.TargetCoda);break;case"doublecoda":e.addDirection(R.TargetDoubleCoda);break;case"dacapo":e.addDirection(R.JumpDaCapo);break;case"dacapoalcoda":e.addDirection(R.JumpDaCapoAlCoda);break;case"dacapoaldoublecoda":e.addDirection(R.JumpDaCapoAlDoubleCoda);break;case"dacapoalfine":e.addDirection(R.JumpDaCapoAlFine);break;case"dalsegno":e.addDirection(R.JumpDalSegno);break;case"dalsegnoalcoda":e.addDirection(R.JumpDalSegnoAlCoda);break;case"dalsegnoaldoublecoda":e.addDirection(R.JumpDalSegnoAlDoubleCoda);break;case"dalsegnoalfine":e.addDirection(R.JumpDalSegnoAlFine);break;case"dalsegnosegno":e.addDirection(R.JumpDalSegnoSegno);break;case"dalsegnosegnoalcoda":e.addDirection(R.JumpDalSegnoSegnoAlCoda);break;case"dalsegnosegnoaldoublecoda":e.addDirection(R.JumpDalSegnoSegnoAlDoubleCoda);break;case"dalsegnosegnoalfine":e.addDirection(R.JumpDalSegnoSegnoAlFine);break;case"dacoda":e.addDirection(R.JumpDaCoda);break;case"dadoublecoda":e.addDirection(R.JumpDaDoubleCoda);break;default:this.errorMessage(`Unexpected direction value: '${this._syData}'`);return}this._sy=this.newSy()}readTempoAutomation(){this._allowFloat=!0,this._sy=this.newSy(),this._allowFloat=!1,this._sy!==k.Number&&this.error("tempo",k.Number,!0);const e=new wt;return e.isLinear=!1,e.type=tt.Tempo,e.value=this._syData,this._sy=this.newSy(),this._sy===k.String&&(e.text=this._syData,this._sy=this.newSy()),e}applyAlternateEnding(e){const t=this._syData;t<1&&this.error("alternateending",k.Number,!0),e.alternateEndings|=1<<t-1,this._sy=this.newSy()}parseWhammyType(e){switch(e.toLowerCase()){case"none":return De.None;case"custom":return De.Custom;case"dive":return De.Dive;case"dip":return De.Dip;case"hold":return De.Hold;case"predive":return De.Predive;case"predivedive":return De.PrediveDive;default:return De.Custom}}}di.Eof=0;class ma extends Ko{constructor(){super(...arguments),this._versionNumber=0,this._globalTripletFeel=me.NoTripletFeel,this._lyricsTrack=0,this._lyrics=[],this._barCount=0,this._trackCount=0,this._playbackInfos=[],this._doubleBars=new Set,this._keySignatures=new Map,this._beatTextChunksByTrack=new Map,this._directionLookup=new Map}get name(){return"Guitar Pro 3-5"}readScore(){if(this._directionLookup.clear(),this.readVersion(),this._score=new fn,this.readScoreInformation(),this._versionNumber<500&&(this._globalTripletFeel=Le.gpReadBool(this.data)?me.Triplet8th:me.NoTripletFeel),this._versionNumber>=400&&this.readLyrics(),this._versionNumber>=510&&this.data.skip(19),this._versionNumber>=500&&(this.readPageSetup(),this._score.tempoLabel=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding)),this._score.tempo=x.readInt32LE(this.data),this._versionNumber>=510&&Le.gpReadBool(this.data),x.readInt32LE(this.data),this._versionNumber>=400&&this.data.readByte(),this.readPlaybackInfos(),this._versionNumber>=500&&(this.readDirection(R.TargetCoda),this.readDirection(R.TargetDoubleCoda),this.readDirection(R.TargetSegno),this.readDirection(R.TargetSegnoSegno),this.readDirection(R.TargetFine),this.readDirection(R.JumpDaCapo),this.readDirection(R.JumpDaCapoAlCoda),this.readDirection(R.JumpDaCapoAlDoubleCoda),this.readDirection(R.JumpDaCapoAlFine),this.readDirection(R.JumpDalSegno),this.readDirection(R.JumpDalSegnoAlCoda),this.readDirection(R.JumpDalSegnoAlDoubleCoda),this.readDirection(R.JumpDalSegnoAlFine),this.readDirection(R.JumpDalSegnoSegno),this.readDirection(R.JumpDalSegnoSegnoAlCoda),this.readDirection(R.JumpDalSegnoSegnoAlDoubleCoda),this.readDirection(R.JumpDalSegnoSegnoAlFine),this.readDirection(R.JumpDaCoda),this.readDirection(R.JumpDaDoubleCoda),this.data.skip(4)),this._barCount=x.readInt32LE(this.data),this._trackCount=x.readInt32LE(this.data),this.readMasterBars(),this.readTracks(),this.readBars(),this._score.masterBars.length>0){const e=wt.buildTempoAutomation(!1,0,this._score.tempo,2);e.text=this._score.tempoLabel,this._score.masterBars[0].tempoAutomations.push(e)}return V.consolidate(this._score),this._score.finish(this.settings),this._lyrics&&this._lyricsTrack>=0&&this._score.tracks[this._lyricsTrack].applyLyrics(this._lyrics),this._score}readDirection(e){let t=x.readInt16LE(this.data);if(t===-1)return;t--;let i;this._directionLookup.has(t)?i=this._directionLookup.get(t):(i=[],this._directionLookup.set(t,i)),i.push(e)}readVersion(){let e=Le.gpReadStringByteLength(this.data,30,this.settings.importer.encoding);if(!e.startsWith(ma.VersionString))throw new vt("Unsupported format");e=e.substr(ma.VersionString.length+1);const t=e.indexOf(".");this._versionNumber=100*Number.parseInt(e.substr(0,t))+Number.parseInt(e.substr(t+1)),E.debug(this.name,`Guitar Pro version ${e} detected`)}readScoreInformation(){var i;this._score.title=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.subTitle=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.artist=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.album=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.words=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.music=this._versionNumber>=500?Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding):this._score.words,this._score.copyright=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.tab=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding),this._score.instructions=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding);const e=x.readInt32LE(this.data);let t="";for(let a=0;a<e;a++)a>0&&(t+=`\r
`),t+=(i=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding))==null?void 0:i.toString();this._score.notices=t}readLyrics(){this._lyrics=[],this._lyricsTrack=x.readInt32LE(this.data)-1;for(let e=0;e<5;e++){const t=new Xt;t.startBar=x.readInt32LE(this.data)-1,t.text=Le.gpReadStringInt(this.data,this.settings.importer.encoding),this._lyrics.push(t)}}readPageSetup(){this.data.skip(28);const e=x.readInt16LE(this.data);V.getOrCreateHeaderFooterStyle(this._score,z.Title).isVisible=(e&1)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.Title).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),V.getOrCreateHeaderFooterStyle(this._score,z.SubTitle).isVisible=(e&2)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.SubTitle).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),V.getOrCreateHeaderFooterStyle(this._score,z.Artist).isVisible=(e&4)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.Artist).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),V.getOrCreateHeaderFooterStyle(this._score,z.Album).isVisible=(e&8)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.Album).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),V.getOrCreateHeaderFooterStyle(this._score,z.Words).isVisible=(e&16)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.Words).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),V.getOrCreateHeaderFooterStyle(this._score,z.Music).isVisible=(e&32)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.Music).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),V.getOrCreateHeaderFooterStyle(this._score,z.WordsAndMusic).isVisible=(e&64)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.WordsAndMusic).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),V.getOrCreateHeaderFooterStyle(this._score,z.Copyright).isVisible=(e&128)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.Copyright).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),V.getOrCreateHeaderFooterStyle(this._score,z.CopyrightSecondLine).isVisible=(e&128)!==0,V.getOrCreateHeaderFooterStyle(this._score,z.CopyrightSecondLine).template=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),Le.gpReadStringIntByte(this.data,this.settings.importer.encoding)}readPlaybackInfos(){this._playbackInfos=[];let e=0;for(let t=0;t<64;t++){const i=new jw;i.primaryChannel=e++,i.secondaryChannel=e++,i.program=x.readInt32LE(this.data),i.volume=this.data.readByte(),i.balance=this.data.readByte(),this.data.skip(6),this._playbackInfos.push(i)}}readMasterBars(){for(let e=0;e<this._barCount;e++)this.readMasterBar()}readMasterBar(){let e=null;this._score.masterBars.length>0&&(e=this._score.masterBars[this._score.masterBars.length-1]);const t=new Ca,i=this.data.readByte();if(i&1?t.timeSignatureNumerator=this.data.readByte():e&&(t.timeSignatureNumerator=e.timeSignatureNumerator),i&2?t.timeSignatureDenominator=this.data.readByte():e&&(t.timeSignatureDenominator=e.timeSignatureDenominator),t.isRepeatStart=(i&4)!==0,i&8&&(t.repeatCount=this.data.readByte()+(this._versionNumber>=500?0:1)),i&16&&this._versionNumber<500){let r=e,o=0;for(;r&&!(r.isRepeatEnd&&r!==e||r.isRepeatStart);)o=o|r.alternateEndings,r=r.previousMasterBar;let l=0;const h=this.data.readByte();for(let c=0;c<8;c++){const d=1<<c;h>c&&!(o&d)&&(l=l|d)}t.alternateEndings=l}if(i&32){const r=new Mh;r.text=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),r.marker="",Le.gpReadColor(this.data,!1),t.section=r}if(i&64&&this._keySignatures.set(this._score.masterBars.length,[x.readSInt8(this.data),this.data.readByte()]),this._versionNumber>=500&&i&3&&this.data.skip(4),this._versionNumber>=500&&(t.alternateEndings=this.data.readByte()),this._versionNumber>=500){switch(this.data.readByte()){case 1:t.tripletFeel=me.Triplet8th;break;case 2:t.tripletFeel=me.Triplet16th;break}this.data.readByte()}else t.tripletFeel=this._globalTripletFeel;const a=(i&128)!==0;t.isDoubleBar=a;const n=this._score.masterBars.length;if(this._directionLookup.has(n))for(const r of this._directionLookup.get(n))t.addDirection(r);this._score.addMasterBar(t),a&&this._doubleBars.add(t.index)}readTracks(){for(let e=0;e<this._trackCount;e++)this.readTrack()}readTrack(){const e=new Ea;e.ensureStaveCount(1),this._score.addTrack(e);const t=e.staves[0],i=this.data.readByte();e.name=Le.gpReadStringByteLength(this.data,40,this.settings.importer.encoding),i&1&&(t.isPercussion=!0),this._versionNumber>=500&&(e.isVisibleOnMultiTrack=(i&8)!==0),this._score.stylesheet.perTrackDisplayTuning===null&&(this._score.stylesheet.perTrackDisplayTuning=new Map),this._score.stylesheet.perTrackDisplayTuning.set(e.index,(i&128)!==0);const a=x.readInt32LE(this.data),n=[];for(let h=0;h<7;h++){const c=x.readInt32LE(this.data);a>h&&n.push(c)}t.stringTuning.tunings=n;const r=x.readInt32LE(this.data),o=x.readInt32LE(this.data)-1,l=x.readInt32LE(this.data)-1;if(this.data.skip(4),o>=0&&o<this._playbackInfos.length){const h=this._playbackInfos[o];h.port=r,h.isSolo=(i&16)!==0,h.isMute=(i&32)!==0,h.secondaryChannel=l,oa.isGuitar(h.program)&&(t.displayTranspositionPitch=-12),e.playbackInfo=h}if(t.capo=x.readInt32LE(this.data),e.color=Le.gpReadColor(this.data,!1),this._versionNumber>=500){const h=this.data.readByte();t.showTablature=(h&1)!==0,t.showStandardNotation=(h&2)!==0;const c=(h&100)!==0;this._score.stylesheet.perTrackChordDiagramsOnTop===null&&(this._score.stylesheet.perTrackChordDiagramsOnTop=new Map),this._score.stylesheet.perTrackChordDiagramsOnTop.set(e.index,c),this.data.readByte(),this.data.skip(43)}this._versionNumber>=510&&(this.data.skip(4),Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),Le.gpReadStringIntByte(this.data,this.settings.importer.encoding))}readBars(){for(let e=0;e<this._barCount;e++)for(let t=0;t<this._trackCount;t++)this.readBar(this._score.tracks[t])}readBar(e){const t=new qi,i=e.staves[0];if(i.isPercussion&&(t.clef=xe.Neutral),i.addBar(t),this._keySignatures.has(t.index)){const n=this._keySignatures.get(t.index);t.keySignature=n[0],t.keySignatureType=n[1]}else t.index>0&&(t.keySignature=t.previousBar.keySignature,t.keySignatureType=t.previousBar.keySignatureType);this._doubleBars.has(t.index)&&(t.barLineRight=oe.LightLight);let a=1;this._versionNumber>=500&&(this.data.readByte(),a=2);for(let n=0;n<a;n++)this.readVoice(e,t)}readVoice(e,t){const i=x.readInt32LE(this.data);if(i===0)return;const a=new Bs;t.addVoice(a);for(let n=0;n<i;n++)this.readBeat(e,t,a)}readBeat(e,t,i){const a=new Wt,n=this.data.readByte();if(n&1&&(a.dots=1),n&64){const c=this.data.readByte();a.isEmpty=(c&2)===0}switch(i.addBeat(a),x.readSInt8(this.data)){case-2:a.duration=w.Whole;break;case-1:a.duration=w.Half;break;case 0:a.duration=w.Quarter;break;case 1:a.duration=w.Eighth;break;case 2:a.duration=w.Sixteenth;break;case 3:a.duration=w.ThirtySecond;break;case 4:a.duration=w.SixtyFourth;break;default:a.duration=w.Quarter;break}if(n&32)switch(a.tupletNumerator=x.readInt32LE(this.data),a.tupletNumerator){case 1:a.tupletDenominator=1;break;case 3:a.tupletDenominator=2;break;case 5:case 6:case 7:a.tupletDenominator=4;break;case 9:case 10:case 11:case 12:case 13:a.tupletDenominator=8;break;case 2:case 4:case 8:break;default:a.tupletNumerator=1,a.tupletDenominator=1;break}n&2&&this.readChord(a);const o=this.settings.importer.beatTextAsLyrics&&e.index!==this._lyricsTrack;if(n&4){const c=Le.gpReadStringIntUnused(this.data,this.settings.importer.encoding);if(o){const d=new Xt;d.text=c.trim(),d.finish(!0);const f=[];for(let p=d.chunks.length-1;p>=0;p--)f.push(d.chunks[p]);this._beatTextChunksByTrack.set(e.index,f)}else a.text=c}let l=ae.None;n&8&&(l=this.readBeatEffects(a)),n&16&&this.readMixTableChange(a);const h=this.data.readByte();for(let c=6;c>=0;c--)if(h&1<<c&&6-c<t.staff.tuning.length){const d=this.readNote(e,t,i,a,6-c);l!==ae.None&&(d.harmonicType=l,d.harmonicType===ae.Natural&&(d.harmonicValue=V.deltaFretToHarmonicValue(d.fret)))}if(this._versionNumber>=500){const c=x.readInt16LE(this.data);if(c&1&&a.index>0&&(i.beats[a.index-1].beamingMode=it.ForceSplitToNext),c&2&&(a.preferredBeamDirection=P.Down),c&4&&a.index>0&&(i.beats[a.index-1].beamingMode=it.ForceMergeWithNext),c&8&&(a.preferredBeamDirection=P.Up),c&16&&(a.ottava=fe._8va),c&32&&(a.ottava=fe._8vb),c&64&&(a.ottava=fe._15ma),c&256&&(a.ottava=fe._15mb),c&2048){const d=this.data.readByte()!==0;a.index>0&&d&&(i.beats[a.index-1].beamingMode=it.ForceSplitOnSecondaryToNext)}}o&&!a.isRest&&this._beatTextChunksByTrack.has(e.index)&&this._beatTextChunksByTrack.get(e.index).length>0&&(a.lyrics=[this._beatTextChunksByTrack.get(e.index).pop()])}readChord(e){const t=new er,i=V.newGuid();if(this._versionNumber>=500){this.data.skip(17),t.name=Le.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=x.readInt32LE(this.data);for(let r=0;r<7;r++){const o=x.readInt32LE(this.data);r<e.voice.bar.staff.tuning.length&&t.strings.push(o)}const a=this.data.readByte(),n=new Uint8Array(5);this.data.read(n,0,n.length);for(let r=0;r<a;r++)t.barreFrets.push(n[r]);this.data.skip(26)}else if(this.data.readByte()!==0)if(this._versionNumber>=400){this.data.skip(16),t.name=Le.gpReadStringByteLength(this.data,21,this.settings.importer.encoding),this.data.skip(4),t.firstFret=x.readInt32LE(this.data);for(let r=0;r<7;r++){const o=x.readInt32LE(this.data);r<e.voice.bar.staff.tuning.length&&t.strings.push(o)}const a=this.data.readByte(),n=new Uint8Array(5);this.data.read(n,0,n.length);for(let r=0;r<a;r++)t.barreFrets.push(n[r]);this.data.skip(26)}else{this.data.skip(25),t.name=Le.gpReadStringByteLength(this.data,34,this.settings.importer.encoding),t.firstFret=x.readInt32LE(this.data);for(let a=0;a<6;a++){const n=x.readInt32LE(this.data);a<e.voice.bar.staff.tuning.length&&t.strings.push(n)}this.data.skip(36)}else{const a=this._versionNumber>=406?7:6;if(t.name=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),t.firstFret=x.readInt32LE(this.data),t.firstFret>0)for(let n=0;n<a;n++){const r=x.readInt32LE(this.data);n<e.voice.bar.staff.tuning.length&&t.strings.push(r)}}t.name&&(e.chordId=i,e.voice.bar.staff.addChord(e.chordId,t))}readBeatEffects(e){const t=this.data.readByte();let i=0;if(this._versionNumber>=400&&(i=this.data.readByte()),t&16&&(e.fade=qt.FadeIn),(this._versionNumber<400&&t&1||t&2)&&(e.vibrato=ve.Slight),i&1&&(e.rasgueado=X.Ii),t&32&&this._versionNumber>=400)switch(x.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}else if(t&32){switch(x.readSInt8(this.data)){case 1:e.tap=!0;break;case 2:e.slap=!0;break;case 3:e.pop=!0;break}this.data.skip(4)}if(i&4&&this.readTremoloBarEffect(e),t&64){let a=0,n=0;this._versionNumber<500?(n=this.data.readByte(),a=this.data.readByte()):(a=this.data.readByte(),n=this.data.readByte()),a>0?(e.brushType=Y.BrushUp,e.brushDuration=ma.toStrokeValue(a)):n>0&&(e.brushType=Y.BrushDown,e.brushDuration=ma.toStrokeValue(n))}if(i&2)switch(x.readSInt8(this.data)){case 0:e.pickStroke=ni.None;break;case 1:e.pickStroke=ni.Up;break;case 2:e.pickStroke=ni.Down;break}if(this._versionNumber<400){if(t&4)return ae.Natural;if(t&8)return ae.Artificial}return ae.None}readTremoloBarEffect(e){this.data.readByte(),x.readInt32LE(this.data);const t=x.readInt32LE(this.data);if(t>0)for(let i=0;i<t;i++){const a=new H(0,0);a.offset=x.readInt32LE(this.data),a.value=x.readInt32LE(this.data)/ma.BendStep|0,Le.gpReadBool(this.data),e.addWhammyBarPoint(a)}}static toStrokeValue(e){switch(e){case 1:return 30;case 2:return 30;case 3:return 60;case 4:return 120;case 5:return 240;case 6:return 480;default:return 0}}readMixTableChange(e){const t=new Fx;t.instrument=x.readSInt8(this.data),this._versionNumber>=500&&this.data.skip(16),t.volume=x.readSInt8(this.data),t.balance=x.readSInt8(this.data);const i=x.readSInt8(this.data),a=x.readSInt8(this.data),n=x.readSInt8(this.data),r=x.readSInt8(this.data);if(this._versionNumber>=500&&(t.tempoName=Le.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.tempo=x.readInt32LE(this.data),t.volume>=0&&this.data.readByte(),t.balance>=0&&this.data.readByte(),i>=0&&this.data.readByte(),a>=0&&this.data.readByte(),n>=0&&this.data.readByte(),r>=0&&this.data.readByte(),t.tempo>=0&&(t.duration=x.readSInt8(this.data),this._versionNumber>=510&&this.data.readByte()),this._versionNumber>=400&&this.data.readByte(),this._versionNumber>=500){const o=x.readSInt8(this.data);o>=100?e.wahPedal=ls.Closed:o>=0&&(e.wahPedal=ls.Open)}if(this._versionNumber>=510&&(Le.gpReadStringIntByte(this.data,this.settings.importer.encoding),Le.gpReadStringIntByte(this.data,this.settings.importer.encoding)),t.volume>=0){const o=new wt;o.isLinear=!0,o.type=tt.Volume,o.value=t.volume,e.automations.push(o)}if(t.balance>=0){const o=new wt;o.isLinear=!0,o.type=tt.Balance,o.value=t.balance,e.automations.push(o)}if(t.instrument>=0){const o=new wt;o.isLinear=!0,o.type=tt.Instrument,o.value=t.instrument,e.automations.push(o)}if(t.tempo>=0){const o=new wt;o.isLinear=!0,o.type=tt.Tempo,o.value=t.tempo,e.automations.push(o),e.voice.bar.masterBar.tempoAutomations.push(o)}}readNote(e,t,i,a,n){const r=new bt;r.string=t.staff.tuning.length-n;const o=this.data.readByte();if(o&2?r.accentuated=_t.Heavy:o&64&&(r.accentuated=_t.Normal),r.isGhost=(o&4)!==0,o&32){const h=this.data.readByte();h===3?r.isDead=!0:h===2&&(r.isTieDestination=!0)}if(o&1&&this._versionNumber<500&&(this.data.readByte(),this.data.readByte()),o&16){const h=x.readSInt8(this.data);r.dynamics=this.toDynamicValue(h),a.dynamics=r.dynamics}o&32&&(r.fret=x.readSInt8(this.data)),o&128&&(r.leftHandFinger=x.readSInt8(this.data),r.rightHandFinger=x.readSInt8(this.data));let l=!1;if(this._versionNumber>=500&&(o&1&&(r.durationPercent=x.readFloat64BE(this.data)),l=(this.data.readByte()&2)!==0),a.addNote(r),o&8&&this.readNoteEffects(e,i,a,r),t.staff.isPercussion&&(r.percussionArticulation=r.fret,r.string=-1,r.fret=-1),l){const h=M.defaultAccidentals[r.realValueWithoutHarmonic%12];h==="#"?r.accidentalMode=ke.ForceFlat:h==="b"&&(r.accidentalMode=ke.ForceSharp)}return r}toDynamicValue(e){switch(e){case 1:return j.PPP;case 2:return j.PP;case 3:return j.P;case 4:return j.MP;case 5:return j.MF;case 6:return j.F;case 7:return j.FF;case 8:return j.FFF;default:return j.F}}readNoteEffects(e,t,i,a){const n=this.data.readByte();let r=0;this._versionNumber>=400&&(r=this.data.readByte()),n&1&&this.readBend(a),n&16&&this.readGrace(t,a),r&4&&this.readTremoloPicking(i),r&8?this.readSlide(a):this._versionNumber<400&&n&4&&(a.slideOutType=pe.Shift),r&16&&this.readArtificialHarmonic(a),r&32&&this.readTrill(a),a.isLetRing=(n&8)!==0,a.isHammerPullOrigin=(n&2)!==0,r&64&&(a.vibrato=ve.Slight),a.isPalmMute=(r&2)!==0,a.isStaccato=(r&1)!==0}readBend(e){this.data.readByte(),x.readInt32LE(this.data);const t=x.readInt32LE(this.data);if(t>0)for(let i=0;i<t;i++){const a=new H(0,0);a.offset=x.readInt32LE(this.data),a.value=x.readInt32LE(this.data)/ma.BendStep|0,Le.gpReadBool(this.data),e.addBendPoint(a)}}readGrace(e,t){const i=new Wt,a=new bt;switch(a.string=t.string,a.fret=x.readSInt8(this.data),i.duration=w.ThirtySecond,i.dynamics=this.toDynamicValue(x.readSInt8(this.data)),x.readSInt8(this.data)){case 0:break;case 1:a.slideOutType=pe.Legato,a.slideTarget=t;break;case 2:break;case 3:a.isHammerPullOrigin=!0;break}if(a.dynamics=i.dynamics,this.data.skip(1),this._versionNumber<500)i.graceType=se.BeforeBeat;else{const r=this.data.readByte();a.isDead=(r&1)!==0,i.graceType=r&2?se.OnBeat:se.BeforeBeat}e.addGraceBeat(i),i.addNote(a)}readTremoloPicking(e){switch(this.data.readByte()){case 1:e.tremoloSpeed=w.Eighth;break;case 2:e.tremoloSpeed=w.Sixteenth;break;case 3:e.tremoloSpeed=w.ThirtySecond;break}}readSlide(e){if(this._versionNumber>=500){const t=x.readSInt8(this.data);t&1?e.slideOutType=pe.Shift:t&2?e.slideOutType=pe.Legato:t&4?e.slideOutType=pe.OutDown:t&8&&(e.slideOutType=pe.OutUp),t&16?e.slideInType=jt.IntoFromBelow:t&32&&(e.slideInType=jt.IntoFromAbove)}else switch(x.readSInt8(this.data)){case 1:e.slideOutType=pe.Shift;break;case 2:e.slideOutType=pe.Legato;break;case 3:e.slideOutType=pe.OutDown;break;case 4:e.slideOutType=pe.OutUp;break;case-1:e.slideInType=jt.IntoFromBelow;break;case-2:e.slideInType=jt.IntoFromAbove;break}}readArtificialHarmonic(e){const t=this.data.readByte();if(this._versionNumber>=500)switch(t){case 1:e.harmonicType=ae.Natural,e.harmonicValue=V.deltaFretToHarmonicValue(e.fret);break;case 2:this.data.readByte(),this.data.readByte(),this.data.readByte(),e.harmonicType=ae.Artificial;break;case 3:e.harmonicType=ae.Tap,e.harmonicValue=V.deltaFretToHarmonicValue(this.data.readByte());break;case 4:e.harmonicType=ae.Pinch,e.harmonicValue=12;break;case 5:e.harmonicType=ae.Semi,e.harmonicValue=12;break}else if(this._versionNumber>=400)switch(t){case 1:e.harmonicType=ae.Natural;break;case 3:e.harmonicType=ae.Tap;break;case 4:e.harmonicType=ae.Pinch;break;case 5:e.harmonicType=ae.Semi;break;case 15:e.harmonicType=ae.Artificial;break;case 17:e.harmonicType=ae.Artificial;break;case 22:e.harmonicType=ae.Artificial;break}}readTrill(e){switch(e.trillValue=this.data.readByte()+e.stringTuning,this.data.readByte()){case 1:e.trillSpeed=w.Sixteenth;break;case 2:e.trillSpeed=w.ThirtySecond;break;case 3:e.trillSpeed=w.SixtyFourth;break}}}ma.VersionString="FICHIER GUITAR PRO ";ma.BendStep=25;class Le{static gpReadColor(e,t=!1){const i=e.readByte(),a=e.readByte(),n=e.readByte();let r=255;return t?r=e.readByte():e.skip(1),new Pe(i,a,n,r)}static gpReadBool(e){return e.readByte()!==0}static gpReadStringIntUnused(e,t){return e.skip(4),Le.gpReadString(e,e.readByte(),t)}static gpReadStringInt(e,t){return Le.gpReadString(e,x.readInt32LE(e),t)}static gpReadStringIntByte(e,t){const i=x.readInt32LE(e)-1;return e.readByte(),Le.gpReadString(e,i,t)}static gpReadString(e,t,i){const a=new Uint8Array(t);return e.read(a,0,a.length),x.toString(a,i)}static gpWriteString(e,t){const i=x.stringToBytes(t);e.writeByte(t.length),e.write(i,0,i.length)}static gpReadStringByteLength(e,t,i){const a=e.readByte(),n=Le.gpReadString(e,a,i);return a<t&&e.skip(t-a),n}}class Fx{constructor(){this.volume=-1,this.balance=-1,this.instrument=-1,this.tempoName="",this.tempo=-1,this.duration=-1}}class hi{constructor(){this.x=0,this.y=0,this.w=0,this.h=0}scaleWith(e){this.x*=e,this.y*=e,this.w*=e,this.h*=e}}var Ie;(function(s){s[s.Boolean=0]="Boolean",s[s.Integer=1]="Integer",s[s.Float=2]="Float",s[s.String=3]="String",s[s.Point=4]="Point",s[s.Size=5]="Size",s[s.Rectangle=6]="Rectangle",s[s.Color=7]="Color"})(Ie||(Ie={}));class ms{constructor(e){this._types=new Map,this.raw=new Map,e&&this.read(e)}read(e){const t=Dt.fromBuffer(e),i=x.readInt32BE(t);for(let a=0;a<i;a++){const n=Le.gpReadString(t,t.readByte(),"utf-8"),r=t.readByte();switch(this._types.set(n,r),r){case Ie.Boolean:const o=t.readByte()===1;this.addValue(n,o);break;case Ie.Integer:const l=x.readInt32BE(t);this.addValue(n,l);break;case Ie.Float:const h=x.readFloat32BE(t);this.addValue(n,h);break;case Ie.String:const c=Le.gpReadString(t,x.readInt16BE(t),"utf-8");this.addValue(n,c);break;case Ie.Point:const d=x.readInt32BE(t),f=x.readInt32BE(t);this.addValue(n,new H(d,f));break;case Ie.Size:const p=x.readInt32BE(t),g=x.readInt32BE(t);this.addValue(n,new H(p,g));break;case Ie.Rectangle:const m=new hi;m.x=x.readInt32BE(t),m.y=x.readInt32BE(t),m.w=x.readInt32BE(t),m.h=x.readInt32BE(t),this.addValue(n,m);break;case Ie.Color:const T=Le.gpReadColor(t,!0);this.addValue(n,T);break}}}apply(e){for(const[t,i]of this.raw)switch(t){case"StandardNotation/hideDynamics":e.stylesheet.hideDynamics=i;break;case"System/bracketExtendMode":e.stylesheet.bracketExtendMode=i;break;case"Global/useSystemSignSeparator":e.stylesheet.useSystemSignSeparator=i;break;case"Global/DisplayTuning":e.stylesheet.globalDisplayTuning=i;break;case"Global/DrawChords":e.stylesheet.globalDisplayChordDiagramsOnTop=i;break;case"System/showTrackNameSingle":i||(e.stylesheet.singleTrackTrackNamePolicy=ct.Hidden);break;case"System/showTrackNameMulti":i||(e.stylesheet.multiTrackTrackNamePolicy=ct.Hidden);break;case"System/trackNameModeSingle":if(e.stylesheet.singleTrackTrackNamePolicy!==ct.Hidden)switch(i){case 0:e.stylesheet.singleTrackTrackNamePolicy=ct.FirstSystem;break;case 1:e.stylesheet.singleTrackTrackNamePolicy=ct.FirstSystem;break;case 2:e.stylesheet.singleTrackTrackNamePolicy=ct.AllSystems;break}break;case"System/trackNameModeMulti":if(e.stylesheet.multiTrackTrackNamePolicy!==ct.Hidden)switch(i){case 0:e.stylesheet.multiTrackTrackNamePolicy=ct.FirstSystem;break;case 1:e.stylesheet.multiTrackTrackNamePolicy=ct.FirstSystem;break;case 2:e.stylesheet.multiTrackTrackNamePolicy=ct.AllSystems;break}break;case"System/shortTrackNameOnFirstSystem":i?e.stylesheet.firstSystemTrackNameMode=Si.ShortName:e.stylesheet.firstSystemTrackNameMode=Si.FullName;break;case"System/shortTrackNameOnOtherSystems":i?e.stylesheet.otherSystemsTrackNameMode=Si.ShortName:e.stylesheet.otherSystemsTrackNameMode=Si.FullName;break;case"System/horizontalTrackNameOnFirstSystem":i?e.stylesheet.firstSystemTrackNameOrientation=wi.Horizontal:e.stylesheet.firstSystemTrackNameOrientation=wi.Vertical;break;case"System/horizontalTrackNameOnOtherSystems":i?e.stylesheet.otherSystemsTrackNameOrientation=wi.Horizontal:e.stylesheet.otherSystemsTrackNameOrientation=wi.Vertical;break;case"Header/Title":V.getOrCreateHeaderFooterStyle(e,z.Title).template=i;break;case"Header/TitleAlignment":V.getOrCreateHeaderFooterStyle(e,z.Title).textAlign=this.toTextAlign(i);break;case"Header/drawTitle":V.getOrCreateHeaderFooterStyle(e,z.Title).isVisible=i;break;case"Header/Subtitle":V.getOrCreateHeaderFooterStyle(e,z.SubTitle).template=i;break;case"Header/SubtitleAlignment":V.getOrCreateHeaderFooterStyle(e,z.SubTitle).textAlign=this.toTextAlign(i);break;case"Header/drawSubtitle":V.getOrCreateHeaderFooterStyle(e,z.SubTitle).isVisible=i;break;case"Header/Artist":V.getOrCreateHeaderFooterStyle(e,z.Artist).template=i;break;case"Header/ArtistAlignment":V.getOrCreateHeaderFooterStyle(e,z.Artist).textAlign=this.toTextAlign(i);break;case"Header/drawArtist":V.getOrCreateHeaderFooterStyle(e,z.Artist).isVisible=i;break;case"Header/Album":V.getOrCreateHeaderFooterStyle(e,z.Album).template=i;break;case"Header/AlbumAlignment":V.getOrCreateHeaderFooterStyle(e,z.Album).textAlign=this.toTextAlign(i);break;case"Header/drawAlbum":V.getOrCreateHeaderFooterStyle(e,z.Album).isVisible=i;break;case"Header/Words":V.getOrCreateHeaderFooterStyle(e,z.Words).template=i;break;case"Header/WordsAlignment":V.getOrCreateHeaderFooterStyle(e,z.Words).textAlign=this.toTextAlign(i);break;case"Header/drawWords":V.getOrCreateHeaderFooterStyle(e,z.Words).isVisible=i;break;case"Header/Music":V.getOrCreateHeaderFooterStyle(e,z.Music).template=i;break;case"Header/MusicAlignment":V.getOrCreateHeaderFooterStyle(e,z.Music).textAlign=this.toTextAlign(i);break;case"Header/drawMusic":V.getOrCreateHeaderFooterStyle(e,z.Music).isVisible=i;break;case"Header/WordsAndMusic":V.getOrCreateHeaderFooterStyle(e,z.WordsAndMusic).template=i;break;case"Header/WordsAndMusicAlignment":V.getOrCreateHeaderFooterStyle(e,z.WordsAndMusic).textAlign=this.toTextAlign(i);break;case"Header/drawWordsAndMusic":V.getOrCreateHeaderFooterStyle(e,z.WordsAndMusic).isVisible=i;break;case"Header/Tabber":V.getOrCreateHeaderFooterStyle(e,z.Transcriber).template=i;break;case"Header/TabberAlignment":V.getOrCreateHeaderFooterStyle(e,z.Transcriber).textAlign=this.toTextAlign(i);break;case"Header/drawTabber":V.getOrCreateHeaderFooterStyle(e,z.Transcriber).isVisible=i;break;case"Footer/Copyright":V.getOrCreateHeaderFooterStyle(e,z.Copyright).template=i;break;case"Footer/CopyrightAlignment":V.getOrCreateHeaderFooterStyle(e,z.Copyright).textAlign=this.toTextAlign(i);break;case"Footer/drawCopyright":V.getOrCreateHeaderFooterStyle(e,z.Copyright).isVisible=i;break;case"Footer/Copyright2":V.getOrCreateHeaderFooterStyle(e,z.CopyrightSecondLine).template=i;break;case"Footer/Copyright2Alignment":V.getOrCreateHeaderFooterStyle(e,z.CopyrightSecondLine).textAlign=this.toTextAlign(i);break;case"Footer/drawCopyright2":V.getOrCreateHeaderFooterStyle(e,z.CopyrightSecondLine).isVisible=i;break}}toTextAlign(e){switch(e){case 0:return Q.Left;case 1:return Q.Center;case 2:return Q.Right}return Q.Left}addValue(e,t,i){this.raw.set(e,t),i!==void 0&&this._types.set(e,i)}writeTo(e){x.writeInt32BE(e,this.raw.size);for(const[t,i]of this.raw){const a=this.getDataType(t,i);switch(Le.gpWriteString(e,t),e.writeByte(a),a){case Ie.Boolean:e.writeByte(i?1:0);break;case Ie.Integer:x.writeInt32BE(e,i);break;case Ie.Float:x.writeFloat32BE(e,i);break;case Ie.String:const n=x.stringToBytes(i);x.writeInt16BE(e,n.length),e.write(n,0,n.length);break;case Ie.Point:x.writeInt32BE(e,i.offset),x.writeInt32BE(e,i.value);break;case Ie.Size:x.writeInt32BE(e,i.offset),x.writeInt32BE(e,i.value);break;case Ie.Rectangle:x.writeInt32BE(e,i.x),x.writeInt32BE(e,i.y),x.writeInt32BE(e,i.w),x.writeInt32BE(e,i.h);break;case Ie.Color:e.writeByte(i.r),e.writeByte(i.g),e.writeByte(i.b),e.writeByte(i.a);break}}}getDataType(e,t){if(this._types.has(e))return this._types.get(e);const i=typeof t;switch(typeof t){case"string":return Ie.String;case"number":const a=t|0;return t===a?Ie.Integer:Ie.Float;case"object":if(t instanceof H)return Ie.Point;if(t instanceof hi)return Ie.Rectangle;if(t instanceof Pe)return Ie.Color;break}throw new We(Ve.General,`Unknown value type in BinaryStylesheet: ${i}`)}static writeForScore(e){const t=new ms;switch(t.addValue("StandardNotation/hideDynamics",e.stylesheet.hideDynamics,Ie.Boolean),t.addValue("System/bracketExtendMode",e.stylesheet.bracketExtendMode,Ie.Integer),t.addValue("Global/useSystemSignSeparator",e.stylesheet.useSystemSignSeparator,Ie.Boolean),t.addValue("Global/DisplayTuning",e.stylesheet.globalDisplayTuning,Ie.Boolean),t.addValue("Global/DrawChords",e.stylesheet.globalDisplayChordDiagramsOnTop,Ie.Boolean),e.stylesheet.singleTrackTrackNamePolicy){case ct.Hidden:t.addValue("System/showTrackNameSingle",!1,Ie.Boolean);break;case ct.FirstSystem:t.addValue("System/trackNameModeSingle",0,Ie.Integer);break;case ct.AllSystems:t.addValue("System/trackNameModeSingle",2,Ie.Integer);break}switch(e.stylesheet.multiTrackTrackNamePolicy){case ct.Hidden:t.addValue("System/showTrackNameMulti",!1,Ie.Boolean);break;case ct.FirstSystem:t.addValue("System/trackNameModeMulti",0,Ie.Integer);break;case ct.AllSystems:t.addValue("System/trackNameModeMulti",2,Ie.Integer);break}switch(e.stylesheet.firstSystemTrackNameMode){case Si.FullName:t.addValue("System/shortTrackNameOnFirstSystem",!1,Ie.Boolean);break;case Si.ShortName:t.addValue("System/shortTrackNameOnFirstSystem",!0,Ie.Boolean);break}switch(e.stylesheet.otherSystemsTrackNameMode){case Si.FullName:t.addValue("System/shortTrackNameOnOtherSystems",!1,Ie.Boolean);break;case Si.ShortName:t.addValue("System/shortTrackNameOnOtherSystems",!0,Ie.Boolean);break}switch(e.stylesheet.firstSystemTrackNameOrientation){case wi.Horizontal:t.addValue("System/horizontalTrackNameOnFirstSystem",!0,Ie.Boolean);break;case wi.Vertical:t.addValue("System/horizontalTrackNameOnFirstSystem",!1,Ie.Boolean);break}switch(e.stylesheet.otherSystemsTrackNameOrientation){case wi.Horizontal:t.addValue("System/horizontalTrackNameOnOtherSystems",!0,Ie.Boolean);break;case wi.Vertical:t.addValue("System/horizontalTrackNameOnOtherSystems",!1,Ie.Boolean);break}const i=e.style;if(i)for(const[n,r]of i.headerAndFooter)switch(n){case z.Title:ms.addHeaderAndFooter(t,r,"Header/","Title");break;case z.SubTitle:ms.addHeaderAndFooter(t,r,"Header/","Subtitle");break;case z.Artist:ms.addHeaderAndFooter(t,r,"Header/","Artist");break;case z.Album:ms.addHeaderAndFooter(t,r,"Header/","Album");break;case z.Words:ms.addHeaderAndFooter(t,r,"Header/","Words");break;case z.Music:ms.addHeaderAndFooter(t,r,"Header/","Music");break;case z.WordsAndMusic:ms.addHeaderAndFooter(t,r,"Header/","WordsAndMusic");break;case z.Transcriber:ms.addHeaderAndFooter(t,r,"Header/","Tabber");break;case z.Copyright:ms.addHeaderAndFooter(t,r,"Footer/","Copyright");break;case z.CopyrightSecondLine:ms.addHeaderAndFooter(t,r,"Footer/","Copyright2");break}const a=Dt.withCapacity(128);return t.writeTo(a),a.toArray()}static addHeaderAndFooter(e,t,i,a){e.addValue(`${i}${a}`,t.template,Ie.String),e.addValue(`${i}${a}Alignment`,t.textAlign,Ie.Integer),t.isVisible!==void 0&&e.addValue(`${i}draw${a}`,t.isVisible,Ie.Boolean)}}var st;(function(s){s[s.None=0]="None",s[s.Element=1]="Element",s[s.Text=2]="Text",s[s.CDATA=3]="CDATA",s[s.Document=4]="Document",s[s.DocumentType=5]="DocumentType",s[s.Comment=6]="Comment"})(st||(st={}));class Ls{constructor(){this.nodeType=st.None,this.localName=null,this.value=null,this.childNodes=[],this.attributes=new Map,this.firstChild=null,this.firstElement=null}*childElements(){for(const e of this.childNodes)e.nodeType===st.Element&&(yield e)}addChild(e){this.childNodes.push(e),this.firstChild=e,(e.nodeType===st.Element||e.nodeType===st.CDATA)&&(this.firstElement=e)}getAttribute(e,t=""){return this.attributes.has(e)?this.attributes.get(e):t}getElementsByTagName(e,t=!1){const i=[];return this.searchElementsByTagName(this.childNodes,i,e,t),i}searchElementsByTagName(e,t,i,a=!1){for(const n of e)n&&n.nodeType===st.Element&&n.localName===i&&t.push(n),a&&this.searchElementsByTagName(n.childNodes,t,i,!0)}findChildElement(e){for(const t of this.childNodes)if(t&&t.nodeType===st.Element&&t.localName===e)return t;return null}addElement(e){const t=new Ls;return t.nodeType=st.Element,t.localName=e,this.addChild(t),t}get innerText(){var e;if(this.nodeType===st.Element||this.nodeType===st.Document){if(this.firstElement&&this.firstElement.nodeType===st.CDATA)return this.firstElement.innerText;let t="";for(const a of this.childNodes)t+=(e=a.innerText)==null?void 0:e.toString();return t.trim()}return this.value??""}set innerText(e){const t=new Ls;t.nodeType=st.Text,t.value=e,this.childNodes=[t]}setCData(e){const t=new Ls;t.nodeType=st.CDATA,t.value=e,this.childNodes=[t]}}class $i extends We{constructor(e,t,i){super(Ve.Format,e),this.pos=0,this.xml=t,this.pos=i,Object.setPrototypeOf(this,$i.prototype)}}var ce;(function(s){s[s.IgnoreSpaces=0]="IgnoreSpaces",s[s.Begin=1]="Begin",s[s.BeginNode=2]="BeginNode",s[s.TagName=3]="TagName",s[s.Body=4]="Body",s[s.AttribName=5]="AttribName",s[s.Equals=6]="Equals",s[s.AttvalBegin=7]="AttvalBegin",s[s.AttribVal=8]="AttribVal",s[s.Childs=9]="Childs",s[s.Close=10]="Close",s[s.WaitEnd=11]="WaitEnd",s[s.WaitEndRet=12]="WaitEndRet",s[s.Pcdata=13]="Pcdata",s[s.Header=14]="Header",s[s.Comment=15]="Comment",s[s.Doctype=16]="Doctype",s[s.Cdata=17]="Cdata",s[s.Escape=18]="Escape"})(ce||(ce={}));class Z{static parse(e,t,i){var g;let a=e.charCodeAt(t),n=ce.Begin,r=ce.Begin,o=0,l="",h=ce.Begin,c=null,d=null,f=0,p=0;for(;t<e.length;){switch(a=e.charCodeAt(t),n){case ce.IgnoreSpaces:switch(a){case Z.CharCodeLF:case Z.CharCodeCR:case Z.CharCodeTab:case Z.CharCodeSpace:break;default:n=r;continue}break;case ce.Begin:switch(a){case Z.CharCodeLowerThan:n=ce.IgnoreSpaces,r=ce.BeginNode;break;default:o=t,n=ce.Pcdata;continue}break;case ce.Pcdata:if(a===Z.CharCodeLowerThan){l+=e.substr(o,t-o);const m=new Ls;m.nodeType=st.Text,m.value=l,l="",i.addChild(m),n=ce.IgnoreSpaces,r=ce.BeginNode}else a===Z.CharCodeAmp&&(l+=e.substr(o,t-o),n=ce.Escape,h=ce.Pcdata,o=t+1);break;case ce.Cdata:if(a===Z.CharCodeBrackedClose&&e.charCodeAt(t+1)===Z.CharCodeBrackedClose&&e.charCodeAt(t+2)===Z.CharCodeGreaterThan){const m=new Ls;m.nodeType=st.CDATA,m.value=e.substr(o,t-o),i.addChild(m),t+=2,n=ce.Begin}break;case ce.BeginNode:switch(a){case Z.CharCodeExclamation:if(e.charCodeAt(t+1)===Z.CharCodeBrackedOpen){if(t+=2,e.substr(t,6).toUpperCase()!=="CDATA[")throw new $i("Expected <![CDATA[",e,t);t+=5,n=ce.Cdata,o=t+1}else if(e.charCodeAt(t+1)===Z.CharCodeUpperD||e.charCodeAt(t+1)===Z.CharCodeLowerD){if(e.substr(t+2,6).toUpperCase()!=="OCTYPE")throw new $i("Expected <!DOCTYPE",e,t);t+=8,n=ce.Doctype,o=t+1}else{if(e.charCodeAt(t+1)!==Z.CharCodeMinus||e.charCodeAt(t+2)!==Z.CharCodeMinus)throw new $i("Expected <!--",e,t);t+=2,n=ce.Comment,o=t+1}break;case Z.CharCodeQuestion:n=ce.Header,o=t;break;case Z.CharCodeSlash:if(!i)throw new $i("Expected node name",e,t);o=t+1,n=ce.IgnoreSpaces,r=ce.Close;break;default:n=ce.TagName,o=t;continue}break;case ce.TagName:if(!Z.isValidChar(a)){if(t===o)throw new $i("Expected node name",e,t);c=new Ls,c.nodeType=st.Element,c.localName=e.substr(o,t-o),i.addChild(c),n=ce.IgnoreSpaces,r=ce.Body;continue}break;case ce.Body:switch(a){case Z.CharCodeSlash:n=ce.WaitEnd;break;case Z.CharCodeGreaterThan:n=ce.Childs;break;default:n=ce.AttribName,o=t;continue}break;case ce.AttribName:if(!Z.isValidChar(a)){if(o===t)throw new $i("Expected attribute name",e,t);if(d=e.substr(o,t-o),c.attributes.has(d))throw new $i(`Duplicate attribute [${d}]`,e,t);n=ce.IgnoreSpaces,r=ce.Equals;continue}break;case ce.Equals:switch(a){case Z.CharCodeEquals:n=ce.IgnoreSpaces,r=ce.AttvalBegin;break;default:throw new $i("Expected =",e,t)}break;case ce.AttvalBegin:switch(a){case Z.CharCodeDoubleQuote:case Z.CharCodeSingleQuote:l="",n=ce.AttribVal,o=t+1,p=a;break}break;case ce.AttribVal:switch(a){case Z.CharCodeAmp:l+=e.substr(o,t-o),n=ce.Escape,h=ce.AttribVal,o=t+1;break;default:if(a===p){l+=e.substr(o,t-o);const m=l;l="",c.attributes.set(d,m),n=ce.IgnoreSpaces,r=ce.Body}break}break;case ce.Childs:t=Z.parse(e,t,c),o=t,n=ce.Begin;break;case ce.WaitEnd:switch(a){case Z.CharCodeGreaterThan:n=ce.Begin;break;default:throw new $i("Expected >",e,t)}break;case ce.WaitEndRet:switch(a){case Z.CharCodeGreaterThan:return t;default:throw new $i("Expected >",e,t)}case ce.Close:if(!Z.isValidChar(a)){if(o===t)throw new $i("Expected node name",e,t);if(e.substr(o,t-o)!==i.localName)throw new $i(`Expected </${i.localName}>`,e,t);n=ce.IgnoreSpaces,r=ce.WaitEndRet;continue}break;case ce.Comment:a===Z.CharCodeMinus&&e.charCodeAt(t+1)===Z.CharCodeMinus&&e.charCodeAt(t+2)===Z.CharCodeGreaterThan&&(t+=2,n=ce.Begin);break;case ce.Doctype:if(a===Z.CharCodeBrackedOpen)f++;else if(a===Z.CharCodeBrackedClose)f--;else if(a===Z.CharCodeGreaterThan&&f===0){const m=new Ls;m.nodeType=st.DocumentType,m.value=e.substr(o,t-o),i.addChild(m),n=ce.Begin}break;case ce.Header:a===Z.CharCodeQuestion&&e.charCodeAt(t+1)===Z.CharCodeGreaterThan&&(t++,n=ce.Begin);break;case ce.Escape:if(a===Z.CharCodeSemi){const m=e.substr(o,t-o);if(m.charCodeAt(0)===Z.CharCodeSharp){const T=m.charCodeAt(1)===Z.CharCodeLowerX?Number.parseInt(`0${m.substr(1,m.length-1)}`):Number.parseInt(m.substr(1,m.length-1));l+=String.fromCharCode(T)}else Z.Escapes.has(m)?l+=Z.Escapes.get(m):l+=(g=`&${m};`)==null?void 0:g.toString();o=t+1,n=h}else!Z.isValidChar(a)&&a!==Z.CharCodeSharp&&(l+="&",l+=e.substr(o,t-o),t--,o=t+1,n=h);break}t++}if(n===ce.Begin&&(o=t,n=ce.Pcdata),n===ce.Pcdata){if(t!==o){l+=e.substr(o,t-o);const m=new Ls;m.nodeType=st.Text,m.value=l,i.addChild(m)}return t}if(n===ce.Escape&&h===ce.Pcdata){l+="&",l+=e.substr(o,t-o);const m=new Ls;return m.nodeType=st.Text,m.value=l,i.addChild(m),t}throw new $i("Unexpected end",e,t)}static isValidChar(e){return e>=Z.CharCodeLowerA&&e<=Z.CharCodeLowerZ||e>=Z.CharCodeUpperA&&e<=Z.CharCodeUpperZ||e>=Z.CharCode0&&e<=Z.CharCode9||e===Z.CharCodeColon||e===Z.CharCodeDot||e===Z.CharCodeUnderscore||e===Z.CharCodeMinus}}Z.CharCodeLF=10;Z.CharCodeTab=9;Z.CharCodeCR=13;Z.CharCodeSpace=32;Z.CharCodeLowerThan=60;Z.CharCodeAmp=38;Z.CharCodeBrackedClose=93;Z.CharCodeBrackedOpen=91;Z.CharCodeGreaterThan=62;Z.CharCodeExclamation=33;Z.CharCodeUpperD=68;Z.CharCodeLowerD=100;Z.CharCodeMinus=45;Z.CharCodeQuestion=63;Z.CharCodeSlash=47;Z.CharCodeEquals=61;Z.CharCodeDoubleQuote=34;Z.CharCodeSingleQuote=39;Z.CharCodeSharp=35;Z.CharCodeLowerX=120;Z.CharCodeLowerA=97;Z.CharCodeLowerZ=122;Z.CharCodeUpperA=65;Z.CharCodeUpperZ=90;Z.CharCode0=48;Z.CharCode9=57;Z.CharCodeColon=58;Z.CharCodeDot=46;Z.CharCodeUnderscore=95;Z.CharCodeSemi=59;Z.Escapes=new Map([["lt","<"],["gt",">"],["amp","&"],["quot",'"'],["apos","'"]]);class Eg{static write(e,t,i){const a=new Eg(t,i);return a.writeNode(e),a.toString()}constructor(e,t){this._result=[],this._indention=e,this._xmlHeader=t,this._currentIndention="",this._isStartOfLine=!0}writeNode(e){switch(e.nodeType){case st.None:break;case st.Element:this._result.length>0&&this.writeLine(),this.write(`<${e.localName}`);for(const[t,i]of e.attributes)this.write(` ${t}="`),this.writeAttributeValue(i),this.write('"');if(e.childNodes.length===0)this.write("/>");else{if(this.write(">"),e.childNodes.length===1&&!e.firstElement)this.writeNode(e.childNodes[0]);else{this.indent();for(const t of e.childNodes)(t.nodeType===st.Element||t.nodeType===st.Comment)&&this.writeNode(t);this.unindend(),this.writeLine()}this.write(`</${e.localName}>`)}break;case st.Text:e.value&&this.write(e.value);break;case st.CDATA:e.value!==null&&this.write(`<![CDATA[${e.value}]]>`);break;case st.Document:this._xmlHeader&&this.write('<?xml version="1.0" encoding="utf-8"?>');for(const t of e.childNodes)this.writeNode(t);break;case st.DocumentType:this.write(`<!DOCTYPE ${e.value}>`);break;case st.Comment:this.write(`<!-- ${e.value} -->`);break}}unindend(){this._currentIndention=this._currentIndention.substr(0,this._currentIndention.length-this._indention.length)}indent(){this._currentIndention+=this._indention}writeAttributeValue(e){for(let t=0;t<e.length;t++){const i=e.charAt(t);switch(i){case"<":this._result.push("&lt;");break;case">":this._result.push("&gt;");break;case"&":this._result.push("&amp;");break;case"'":this._result.push("&apos;");break;case'"':this._result.push("&quot;");break;default:this._result.push(i);break}}}write(e){this._isStartOfLine&&this._result.push(this._currentIndention),this._result.push(e),this._isStartOfLine=!1}writeLine(e=null){e&&this.write(e),this._indention.length>0&&!this._isStartOfLine&&(this._result.push(`
`),this._isStartOfLine=!0)}toString(){return this._result.join("").trimRight()}}class oh extends Ls{constructor(){super(),this.nodeType=st.Document}parse(e){Z.parse(e,0,this)}toString(){return this.toFormattedString()}toFormattedString(e="",t=!1){return Eg.write(this,e,t)}}class ek{}class Mx{constructor(){this.id="",this.dots=0,this.tupletDenominator=-1,this.tupletNumerator=-1,this.value=w.Quarter}}class Rx{constructor(){this.name="",this.path="",this.role="",this.program=0}get uniqueId(){return`${this.path};${this.name};${this.role}`}}class I{constructor(){this._hasAnacrusis=!1,this._skipApplyLyrics=!1,this._backingTrackPadding=0,this._doubleBars=new Set,this._keySignatures=new Map}parseXml(e,t){this._masterTrackAutomations=new Map,this._automationsPerTrackIdAndBarIndex=new Map,this._sustainPedalsPerTrackIdAndBarIndex=new Map,this._tracksMapping=[],this._tracksById=new Map,this._masterBars=[],this._barsOfMasterBar=[],this._voicesOfBar=new Map,this._barsById=new Map,this._voiceById=new Map,this._beatsOfVoice=new Map,this._beatById=new Map,this._rhythmOfBeat=new Map,this._rhythmById=new Map,this._notesOfBeat=new Map,this._noteById=new Map,this._tappedNotes=new Map,this._lyricsByTrack=new Map,this._soundsByTrack=new Map,this._skipApplyLyrics=!1;const i=new oh;try{i.parse(e)}catch(a){throw new vt("Could not parse XML",a)}if(this.parseDom(i),this.buildModel(),V.consolidate(this.score),this.score.finish(t),!this._skipApplyLyrics&&this._lyricsByTrack.size>0)for(const[a,n]of this._lyricsByTrack)this._tracksById.get(a).applyLyrics(n)}parseDom(e){const t=e.firstElement;if(t)if(t.localName==="GPIF"){this.score=new fn;for(const i of t.childElements())switch(i.localName){case"Score":this.parseScoreNode(i);break;case"MasterTrack":this.parseMasterTrackNode(i);break;case"BackingTrack":this.parseBackingTrackNode(i);break;case"Tracks":this.parseTracksNode(i);break;case"MasterBars":this.parseMasterBarsNode(i);break;case"Bars":this.parseBars(i);break;case"Voices":this.parseVoices(i);break;case"Beats":this.parseBeats(i);break;case"Notes":this.parseNotes(i);break;case"Rhythms":this.parseRhythms(i);break;case"Assets":this.parseAssets(i);break}}else throw new vt("Root node of XML was not GPIF")}parseAssets(e){for(const t of e.childElements())switch(t.localName){case"Asset":t.getAttribute("id")===this._backingTrackAssetId&&this.parseBackingTrackAsset(t);break}}parseBackingTrackAsset(e){let t="";for(const a of e.childElements())switch(a.localName){case"EmbeddedFilePath":t=a.innerText;break}const i=this.loadAsset;if(i){const a=i(t);a?this.score.backingTrack.rawAudioFile=a:this.score.backingTrack=void 0}}parseScoreNode(e){for(const t of e.childElements())switch(t.localName){case"Title":this.score.title=t.innerText;break;case"SubTitle":this.score.subTitle=t.innerText;break;case"Artist":this.score.artist=t.innerText;break;case"Album":this.score.album=t.innerText;break;case"Words":this.score.words=t.innerText;break;case"Music":this.score.music=t.innerText;break;case"WordsAndMusic":const i=t.innerText;i!==""&&(i&&!this.score.words&&(this.score.words=i),i&&!this.score.music&&(this.score.music=i));break;case"Copyright":this.score.copyright=t.innerText;break;case"Tabber":this.score.tab=t.innerText;break;case"Instructions":this.score.instructions=t.innerText;break;case"Notices":this.score.notices=t.innerText;break;case"ScoreSystemsDefaultLayout":this.score.defaultSystemsLayout=I.parseIntSafe(t.innerText,4);break;case"ScoreSystemsLayout":this.score.systemsLayout=I.splitSafe(t.innerText).map(a=>I.parseIntSafe(a,4));break}}static parseIntSafe(e,t){if(!e)return t;const i=Number.parseInt(e);return Number.isNaN(i)?t:i}static parseFloatSafe(e,t){if(!e)return t;const i=Number.parseFloat(e);return Number.isNaN(i)?t:i}static splitSafe(e,t=" "){return e?e.split(t).map(i=>i.trim()).filter(i=>i.length>0):[]}parseBackingTrackNode(e){const t=new ek;let i=!1,a="",n="";for(const r of e.childElements())switch(r.localName){case"Enabled":i=r.innerText==="true";break;case"Source":a=r.innerText;break;case"AssetId":n=r.innerText;break;case"FramePadding":this._backingTrackPadding=I.parseIntSafe(r.innerText,0)/I.SampleRate*1e3;break}i&&a==="Local"&&(this.score.backingTrack=t,this._backingTrackAssetId=n)}parseMasterTrackNode(e){for(const t of e.childElements())switch(t.localName){case"Automations":this.parseAutomations(t,this._masterTrackAutomations,null,null);break;case"Tracks":this._tracksMapping=I.splitSafe(t.innerText);break;case"Anacrusis":this._hasAnacrusis=!0;break}}parseAutomations(e,t,i,a){for(const n of e.childElements())switch(n.localName){case"Automation":this.parseAutomation(n,t,i,a);break}}parseAutomation(e,t,i,a){let n=null,r=!1,o=-1,l=0,h=0,c=null,d=0,f=null,p;for(const m of e.childElements())switch(m.localName){case"Type":n=m.innerText;break;case"Linear":r=m.innerText.toLowerCase()==="true";break;case"Bar":o=I.parseIntSafe(m.innerText,0);break;case"Position":l=I.parseFloatSafe(m.innerText,0);break;case"Value":if(m.firstElement&&m.firstElement.nodeType===st.CDATA)c=m.innerText;else if(m.firstElement&&m.firstElement.nodeType===st.Element&&n==="SyncPoint"){p=new ju;for(const T of m.childElements())switch(T.localName){case"BarIndex":o=I.parseIntSafe(T.innerText,0);break;case"BarOccurrence":p.barOccurence=I.parseIntSafe(T.innerText,0);break;case"FrameOffset":const S=I.parseFloatSafe(T.innerText,0);p.millisecondOffset=S/I.SampleRate*1e3;break}}else{const T=I.splitSafe(m.innerText);T.length===1?(h=I.parseFloatSafe(T[0],0),d=1):(h=I.parseFloatSafe(T[0],0),d=I.parseIntSafe(T[1],0))}break;case"Text":f=m.innerText;break}if(!n)return;let g=null;switch(n){case"Tempo":g=wt.buildTempoAutomation(r,l,h,d);break;case"SyncPoint":g=new wt,g.type=tt.SyncPoint,g.isLinear=r,g.ratioPosition=l,g.syncPointValue=p;break;case"Sound":c&&i&&i.has(c)&&(g=wt.buildInstrumentAutomation(r,l,i.get(c).program));break;case"SustainPedal":if(a){let m;a.has(o)?m=a.get(o):(m=[],a.set(o,m));const T=new xr;switch(T.ratioPosition=l,d){case 1:T.pedalType=Et.Down;break;case 3:T.pedalType=Et.Up;break}m.push(T)}break}g&&(f&&(g.text=f),o>=0&&(t.has(o)||t.set(o,[]),t.get(o).push(g)))}parseTracksNode(e){for(const t of e.childElements())switch(t.localName){case"Track":this.parseTrack(t);break}}parseTrack(e){this._articulationByName=new Map;const t=new Ea;t.ensureStaveCount(1);const i=t.staves[0];i.showStandardNotation=!0;const a=e.getAttribute("id");for(const n of e.childElements())switch(n.localName){case"Name":t.name=n.innerText;break;case"Color":const r=I.splitSafe(n.innerText);if(r.length>=3){const h=I.parseIntSafe(r[0],0),c=I.parseIntSafe(r[1],0),d=I.parseIntSafe(r[2],0);t.color=new Pe(h,c,d,255)}break;case"Instrument":const o=n.getAttribute("ref");(o.endsWith("-gs")||o.endsWith("GrandStaff"))&&(t.ensureStaveCount(2),t.staves[1].showStandardNotation=!0);break;case"InstrumentSet":this.parseInstrumentSet(t,n);break;case"NotationPatch":this.parseNotationPatch(t,n);break;case"ShortName":t.shortName=n.innerText;break;case"SystemsDefautLayout":t.defaultSystemsLayout=I.parseIntSafe(n.innerText,4);break;case"SystemsLayout":t.systemsLayout=I.splitSafe(n.innerText).map(h=>I.parseIntSafe(h,4));break;case"Lyrics":this.parseLyrics(a,n);break;case"Properties":this.parseTrackProperties(t,n);break;case"GeneralMidi":case"MidiConnection":case"MIDISettings":this.parseGeneralMidi(t,n);break;case"Sounds":this.parseSounds(a,t,n);break;case"PlaybackState":const l=n.innerText;t.playbackInfo.isSolo=l==="Solo",t.playbackInfo.isMute=l==="Mute";break;case"PartSounding":this.parsePartSounding(t,n);break;case"Staves":this.parseStaves(t,n);break;case"Transpose":this.parseTranspose(t,n);break;case"RSE":this.parseRSE(t,n);break;case"Automations":this.parseTrackAutomations(a,n);break}this._tracksById.set(a,t)}parseTrackAutomations(e,t){const i=new Map;this._automationsPerTrackIdAndBarIndex.set(e,i);const a=new Map;this._sustainPedalsPerTrackIdAndBarIndex.set(e,a),this.parseAutomations(t,i,this._soundsByTrack.get(e),a)}parseNotationPatch(e,t){for(const i of t.childElements())switch(i.localName){case"LineCount":const a=I.parseIntSafe(i.innerText,5);for(const n of e.staves)n.standardNotationLineCount=a;break;case"Elements":this.parseElements(e,i);break}}parseInstrumentSet(e,t){for(const i of t.childElements())switch(i.localName){case"Type":if(i.innerText==="drumKit")for(const n of e.staves)n.isPercussion=!0;break;case"Elements":this.parseElements(e,i);break;case"LineCount":const a=I.parseIntSafe(i.innerText,5);for(const n of e.staves)n.standardNotationLineCount=a;break}}parseElements(e,t){for(const i of t.childElements())switch(i.localName){case"Element":this.parseElement(e,i);break}}parseElement(e,t){var a;const i=((a=t.findChildElement("Type"))==null?void 0:a.innerText)??"";for(const n of t.childElements())switch(n.localName){case"Name":case"Articulations":this.parseArticulations(e,n,i);break}}parseArticulations(e,t,i){for(const a of t.childElements())switch(a.localName){case"Articulation":this.parseArticulation(e,a,i);break}}parseArticulation(e,t,i){const a=new U;a.outputMidiNumber=-1,a.elementType=i;let n="";for(const r of t.childElements()){const o=r.innerText;switch(r.localName){case"Name":n=r.innerText;break;case"OutputMidiNumber":a.outputMidiNumber=I.parseIntSafe(o,0);break;case"TechniqueSymbol":a.techniqueSymbol=this.parseTechniqueSymbol(o);break;case"TechniquePlacement":switch(o){case"outside":a.techniqueSymbolPlacement=he.Bottom;break;case"inside":a.techniqueSymbolPlacement=he.Middle;break;case"above":a.techniqueSymbolPlacement=he.Bottom;break;case"below":a.techniqueSymbolPlacement=he.Top;break}break;case"Noteheads":const l=I.splitSafe(o);l.length>=1&&(a.noteHeadDefault=this.parseNoteHead(l[0])),l.length>=2&&(a.noteHeadHalf=this.parseNoteHead(l[1])),l.length>=3&&(a.noteHeadWhole=this.parseNoteHead(l[2])),a.noteHeadHalf===u.None&&(a.noteHeadHalf=a.noteHeadDefault),a.noteHeadWhole===u.None&&(a.noteHeadWhole=a.noteHeadDefault);break;case"StaffLine":a.staffLine=I.parseIntSafe(o,0);break}}a.outputMidiNumber!==-1?(e.percussionArticulations.push(a),n.length>0&&this._articulationByName.set(n,a)):n.length>0&&this._articulationByName.has(n)&&(this._articulationByName.get(n).staffLine=a.staffLine)}parseTechniqueSymbol(e){switch(e){case"pictEdgeOfCymbal":return u.PictEdgeOfCymbal;case"articStaccatoAbove":return u.ArticStaccatoAbove;case"noteheadParenthesis":return u.NoteheadParenthesis;case"stringsUpBow":return u.StringsUpBow;case"stringsDownBow":return u.StringsDownBow;case"guitarGolpe":return u.GuitarGolpe;default:return u.None}}parseNoteHead(e){switch(e){case"noteheadDoubleWholeSquare":return u.NoteheadDoubleWholeSquare;case"noteheadDoubleWhole":return u.NoteheadDoubleWhole;case"noteheadWhole":return u.NoteheadWhole;case"noteheadHalf":return u.NoteheadHalf;case"noteheadBlack":return u.NoteheadBlack;case"noteheadNull":return u.NoteheadNull;case"noteheadXOrnate":return u.NoteheadXOrnate;case"noteheadTriangleUpWhole":return u.NoteheadTriangleUpWhole;case"noteheadTriangleUpHalf":return u.NoteheadTriangleUpHalf;case"noteheadTriangleUpBlack":return u.NoteheadTriangleUpBlack;case"noteheadDiamondBlackWide":return u.NoteheadDiamondBlackWide;case"noteheadDiamondWhite":return u.NoteheadDiamondWhite;case"noteheadDiamondWhiteWide":return u.NoteheadDiamondWhiteWide;case"noteheadCircleX":return u.NoteheadCircleX;case"noteheadXWhole":return u.NoteheadXWhole;case"noteheadXHalf":return u.NoteheadXHalf;case"noteheadXBlack":return u.NoteheadXBlack;case"noteheadParenthesis":return u.NoteheadParenthesis;case"noteheadSlashedBlack2":return u.NoteheadSlashedBlack2;case"noteheadCircleSlash":return u.NoteheadCircleSlash;case"noteheadHeavyX":return u.NoteheadHeavyX;case"noteheadHeavyXHat":return u.NoteheadHeavyXHat;default:return E.warning("GPIF","Unknown notehead symbol",e),u.None}}parseStaves(e,t){let i=0;for(const a of t.childElements())switch(a.localName){case"Staff":e.ensureStaveCount(i+1);const n=e.staves[i];this.parseStaff(n,a),i++;break}}parseStaff(e,t){for(const i of t.childElements())switch(i.localName){case"Properties":this.parseStaffProperties(e,i);break}}parseStaffProperties(e,t){for(const i of t.childElements())switch(i.localName){case"Property":this.parseStaffProperty(e,i);break}}parseStaffProperty(e,t){var a,n;switch(t.getAttribute("name")){case"Tuning":for(const o of t.childElements())switch(o.localName){case"Pitches":const l=I.splitSafe((a=t.findChildElement("Pitches"))==null?void 0:a.innerText),h=new Array(l.length);for(let c=0;c<h.length;c++)h[h.length-1-c]=I.parseIntSafe(l[c],0);e.stringTuning.tunings=h;break;case"Label":e.stringTuning.name=o.innerText;break}e.isPercussion||(e.showTablature=!0);break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForStaff(e,t);break;case"CapoFret":const r=I.parseIntSafe((n=t.findChildElement("Fret"))==null?void 0:n.innerText,0);e.capo=r;break}}parseLyrics(e,t){const i=[];for(const a of t.childElements())switch(a.localName){case"Line":i.push(this.parseLyricsLine(a));break}this._lyricsByTrack.set(e,i)}parseLyricsLine(e){const t=new Xt;for(const i of e.childElements())switch(i.localName){case"Offset":t.startBar=I.parseIntSafe(i.innerText,0);break;case"Text":t.text=i.innerText;break}return t}parseDiagramCollectionForTrack(e,t){const i=t.findChildElement("Items");if(i)for(const a of i.childElements())switch(a.localName){case"Item":this.parseDiagramItemForTrack(e,a);break}}parseDiagramCollectionForStaff(e,t){const i=t.findChildElement("Items");if(i)for(const a of i.childElements())switch(a.localName){case"Item":this.parseDiagramItemForStaff(e,a);break}}parseDiagramItemForTrack(e,t){const i=new er,a=t.getAttribute("id");for(const n of e.staves)n.addChord(a,i);this.parseDiagramItemForChord(i,t)}parseDiagramItemForStaff(e,t){const i=new er,a=t.getAttribute("id");e.addChord(a,i),this.parseDiagramItemForChord(i,t)}parseDiagramItemForChord(e,t){e.name=t.getAttribute("name");const i=t.findChildElement("Diagram");if(!i){e.showDiagram=!1,e.showFingering=!1;return}const a=I.parseIntSafe(i.getAttribute("stringCount"),6),n=I.parseIntSafe(i.getAttribute("baseFret"),0);e.firstFret=n+1;for(let r=0;r<a;r++)e.strings.push(-1);for(const r of i.childElements())switch(r.localName){case"Fret":const o=I.parseIntSafe(r.getAttribute("string"),0);e.strings[a-o-1]=n+I.parseIntSafe(r.getAttribute("fret"),0);break;case"Fingering":const l=new Map;for(const h of r.childElements())switch(h.localName){case"Position":let c=ie.Unknown;const d=n+I.parseIntSafe(h.getAttribute("fret"),0);switch(h.getAttribute("finger")){case"Index":c=ie.IndexFinger;break;case"Middle":c=ie.MiddleFinger;break;case"Rank":c=ie.AnnularFinger;break;case"Pinky":c=ie.LittleFinger;break;case"Thumb":c=ie.Thumb;break}c!==ie.Unknown&&(l.has(c)?e.barreFrets.push(d):l.set(c,!0));break}break;case"Property":switch(r.getAttribute("name")){case"ShowName":e.showName=r.getAttribute("value")==="true";break;case"ShowDiagram":e.showDiagram=r.getAttribute("value")==="true";break;case"ShowFingering":e.showFingering=r.getAttribute("value")==="true";break}break}}parseTrackProperties(e,t){for(const i of t.childElements())switch(i.localName){case"Property":this.parseTrackProperty(e,i);break}}parseTrackProperty(e,t){var a,n;switch(t.getAttribute("name")){case"Tuning":const r=I.splitSafe((a=t.findChildElement("Pitches"))==null?void 0:a.innerText),o=new Array(r.length);for(let h=0;h<o.length;h++)o[o.length-1-h]=I.parseIntSafe(r[h],0);for(const h of e.staves)h.stringTuning.tunings=o,h.showStandardNotation=!0,h.showTablature=!0;break;case"DiagramCollection":case"ChordCollection":this.parseDiagramCollectionForTrack(e,t);break;case"CapoFret":const l=I.parseIntSafe((n=t.findChildElement("Fret"))==null?void 0:n.innerText,0);for(const h of e.staves)h.capo=l;break}}parseGeneralMidi(e,t){for(const a of t.childElements())switch(a.localName){case"Program":e.playbackInfo.program=I.parseIntSafe(a.innerText,0);break;case"Port":e.playbackInfo.port=I.parseIntSafe(a.innerText,0);break;case"PrimaryChannel":e.playbackInfo.primaryChannel=I.parseIntSafe(a.innerText,0);break;case"SecondaryChannel":e.playbackInfo.secondaryChannel=I.parseIntSafe(a.innerText,0);break}if(t.getAttribute("table")==="Percussion")for(const a of e.staves)a.isPercussion=!0}parseSounds(e,t,i){for(const a of i.childElements())switch(a.localName){case"Sound":this.parseSound(e,t,a);break}}parseSound(e,t,i){const a=new Rx;for(const n of i.childElements())switch(n.localName){case"Name":a.name=n.innerText;break;case"Path":a.path=n.innerText;break;case"Role":a.role=n.innerText;break;case"MIDI":this.parseSoundMidi(a,n);break}(a.role==="Factory"||t.playbackInfo.program===0)&&(t.playbackInfo.program=a.program),this._soundsByTrack.has(e)||this._soundsByTrack.set(e,new Map),this._soundsByTrack.get(e).set(a.uniqueId,a)}parseSoundMidi(e,t){for(const i of t.childElements())switch(i.localName){case"Program":e.program=I.parseIntSafe(i.innerText,0);break}}parsePartSounding(e,t){for(const i of t.childElements())switch(i.localName){case"TranspositionPitch":for(const a of e.staves)a.displayTranspositionPitch=I.parseIntSafe(i.innerText,0);break}}parseTranspose(e,t){let i=0,a=0;for(const n of t.childElements())switch(n.localName){case"Chromatic":a=I.parseIntSafe(n.innerText,0);break;case"Octave":i=I.parseIntSafe(n.innerText,0);break}for(const n of e.staves)n.displayTranspositionPitch=i*12+a}parseRSE(e,t){for(const i of t.childElements())switch(i.localName){case"ChannelStrip":this.parseChannelStrip(e,i);break}}parseChannelStrip(e,t){for(const i of t.childElements())switch(i.localName){case"Parameters":this.parseChannelStripParameters(e,i);break}}parseChannelStripParameters(e,t){if(t.firstChild&&t.firstChild.value){const i=I.splitSafe(t.firstChild.value);i.length>=12&&(e.playbackInfo.balance=Math.floor(I.parseFloatSafe(i[11],.5)*16),e.playbackInfo.volume=Math.floor(I.parseFloatSafe(i[12],.9)*16))}}parseMasterBarsNode(e){for(const t of e.childElements())switch(t.localName){case"MasterBar":this.parseMasterBar(t);break}}parseMasterBar(e){var i,a,n;const t=new Ca;this._masterBars.length===0&&this._hasAnacrusis&&(t.isAnacrusis=!0);for(const r of e.childElements())switch(r.localName){case"Time":const o=r.innerText.split("/");t.timeSignatureNumerator=I.parseIntSafe(o[0],4),t.timeSignatureDenominator=I.parseIntSafe(o[1],4);break;case"FreeTime":t.isFreeTime=!0;break;case"DoubleBar":t.isDoubleBar=!0,this._doubleBars.add(t);break;case"Section":t.section=new Mh,t.section.marker=((i=r.findChildElement("Letter"))==null?void 0:i.innerText)??"",t.section.text=((a=r.findChildElement("Text"))==null?void 0:a.innerText)??"";break;case"Repeat":r.getAttribute("start").toLowerCase()==="true"&&(t.isRepeatStart=!0),r.getAttribute("end").toLowerCase()==="true"&&r.getAttribute("count")&&(t.repeatCount=I.parseIntSafe(r.getAttribute("count"),1));break;case"AlternateEndings":const l=I.splitSafe(r.innerText);let h=0;for(let p=0;p<l.length;p++)h=h|1<<-1+I.parseIntSafe(l[p],0);t.alternateEndings=h;break;case"Bars":this._barsOfMasterBar.push(I.splitSafe(r.innerText));break;case"TripletFeel":switch(r.innerText){case"NoTripletFeel":t.tripletFeel=me.NoTripletFeel;break;case"Triplet8th":t.tripletFeel=me.Triplet8th;break;case"Triplet16th":t.tripletFeel=me.Triplet16th;break;case"Dotted8th":t.tripletFeel=me.Dotted8th;break;case"Dotted16th":t.tripletFeel=me.Dotted16th;break;case"Scottish8th":t.tripletFeel=me.Scottish8th;break;case"Scottish16th":t.tripletFeel=me.Scottish16th;break}break;case"Key":const c=I.parseIntSafe((n=r.findChildElement("AccidentalCount"))==null?void 0:n.innerText,0),d=r.findChildElement("Mode");let f=Mi.Major;if(d)switch(d.innerText.toLowerCase()){case"major":f=Mi.Major;break;case"minor":f=Mi.Minor;break}this._keySignatures.set(this._masterBars.length,[c,f]);break;case"Fermatas":this.parseFermatas(t,r);break;case"XProperties":this.parseMasterBarXProperties(t,r);break;case"Directions":this.parseDirections(t,r);break}this._masterBars.push(t)}parseDirections(e,t){for(const i of t.childElements())switch(i.localName){case"Target":switch(i.innerText){case"Coda":e.addDirection(R.TargetCoda);break;case"DoubleCoda":e.addDirection(R.TargetDoubleCoda);break;case"Segno":e.addDirection(R.TargetSegno);break;case"SegnoSegno":e.addDirection(R.TargetSegnoSegno);break;case"Fine":e.addDirection(R.TargetFine);break}break;case"Jump":switch(i.innerText){case"DaCapo":e.addDirection(R.JumpDaCapo);break;case"DaCapoAlCoda":e.addDirection(R.JumpDaCapoAlCoda);break;case"DaCapoAlDoubleCoda":e.addDirection(R.JumpDaCapoAlDoubleCoda);break;case"DaCapoAlFine":e.addDirection(R.JumpDaCapoAlFine);break;case"DaSegno":e.addDirection(R.JumpDalSegno);break;case"DaSegnoAlCoda":e.addDirection(R.JumpDalSegnoAlCoda);break;case"DaSegnoAlDoubleCoda":e.addDirection(R.JumpDalSegnoAlDoubleCoda);break;case"DaSegnoAlFine":e.addDirection(R.JumpDalSegnoAlFine);break;case"DaSegnoSegno":e.addDirection(R.JumpDalSegnoSegno);break;case"DaSegnoSegnoAlCoda":e.addDirection(R.JumpDalSegnoSegnoAlCoda);break;case"DaSegnoSegnoAlDoubleCoda":e.addDirection(R.JumpDalSegnoSegnoAlDoubleCoda);break;case"DaSegnoSegnoAlFine":e.addDirection(R.JumpDalSegnoSegnoAlFine);break;case"DaCoda":e.addDirection(R.JumpDaCoda);break;case"DaDoubleCoda":e.addDirection(R.JumpDaDoubleCoda);break}break}}parseFermatas(e,t){for(const i of t.childElements())switch(i.localName){case"Fermata":this.parseFermata(e,i);break}}parseFermata(e,t){let i=0;const a=new Rh;for(const n of t.childElements())switch(n.localName){case"Type":switch(n.innerText){case"Short":a.type=Bi.Short;break;case"Medium":a.type=Bi.Medium;break;case"Long":a.type=Bi.Long;break}break;case"Length":a.length=I.parseFloatSafe(n.innerText,0);break;case"Offset":const r=n.innerText.split("/");if(r.length===2){const o=I.parseIntSafe(r[0],4),l=I.parseIntSafe(r[1],4);i=o/l*v.QuarterTime|0}break}e.addFermata(i,a)}parseBars(e){for(const t of e.childElements())switch(t.localName){case"Bar":this.parseBar(t);break}}parseBar(e){const t=new qi,i=e.getAttribute("id");for(const a of e.childElements())switch(a.localName){case"Voices":this._voicesOfBar.set(i,I.splitSafe(a.innerText));break;case"Clef":switch(a.innerText){case"Neutral":t.clef=xe.Neutral;break;case"G2":t.clef=xe.G2;break;case"F4":t.clef=xe.F4;break;case"C4":t.clef=xe.C4;break;case"C3":t.clef=xe.C3;break}break;case"Ottavia":switch(a.innerText){case"8va":t.clefOttava=fe._8va;break;case"15ma":t.clefOttava=fe._15ma;break;case"8vb":t.clefOttava=fe._8vb;break;case"15mb":t.clefOttava=fe._15mb;break}break;case"SimileMark":switch(a.innerText){case"Simple":t.simileMark=St.Simple;break;case"FirstOfDouble":t.simileMark=St.FirstOfDouble;break;case"SecondOfDouble":t.simileMark=St.SecondOfDouble;break}break;case"XProperties":this.parseBarXProperties(a,t);break}this._barsById.set(i,t)}parseVoices(e){for(const t of e.childElements())switch(t.localName){case"Voice":this.parseVoice(t);break}}parseVoice(e){const t=new Bs,i=e.getAttribute("id");for(const a of e.childElements())switch(a.localName){case"Beats":this._beatsOfVoice.set(i,I.splitSafe(a.innerText));break}this._voiceById.set(i,t)}parseBeats(e){for(const t of e.childElements())switch(t.localName){case"Beat":this.parseBeat(t);break}}parseBeat(e){const t=new Wt,i=e.getAttribute("id");for(const a of e.childElements())switch(a.localName){case"Notes":this._notesOfBeat.set(i,I.splitSafe(a.innerText));break;case"Rhythm":this._rhythmOfBeat.set(i,a.getAttribute("ref"));break;case"Fadding":switch(a.innerText){case"FadeIn":t.fade=qt.FadeIn;break;case"FadeOut":t.fade=qt.FadeOut;break;case"VolumeSwell":t.fade=qt.VolumeSwell;break}break;case"Tremolo":switch(a.innerText){case"1/2":t.tremoloSpeed=w.Eighth;break;case"1/4":t.tremoloSpeed=w.Sixteenth;break;case"1/8":t.tremoloSpeed=w.ThirtySecond;break}break;case"Chord":t.chordId=a.innerText;break;case"Hairpin":switch(a.innerText){case"Crescendo":t.crescendo=vi.Crescendo;break;case"Decrescendo":t.crescendo=vi.Decrescendo;break}break;case"Arpeggio":a.innerText==="Up"?t.brushType=Y.ArpeggioUp:t.brushType=Y.ArpeggioDown;break;case"Properties":this.parseBeatProperties(a,t);break;case"XProperties":this.parseBeatXProperties(a,t);break;case"FreeText":t.text=a.innerText;break;case"TransposedPitchStemOrientation":switch(a.innerText){case"Upward":t.preferredBeamDirection=P.Up;break;case"Downward":t.preferredBeamDirection=P.Down;break}break;case"Dynamic":switch(a.innerText){case"PPP":t.dynamics=j.PPP;break;case"PP":t.dynamics=j.PP;break;case"P":t.dynamics=j.P;break;case"MP":t.dynamics=j.MP;break;case"MF":t.dynamics=j.MF;break;case"F":t.dynamics=j.F;break;case"FF":t.dynamics=j.FF;break;case"FFF":t.dynamics=j.FFF;break}break;case"GraceNotes":switch(a.innerText){case"OnBeat":t.graceType=se.OnBeat;break;case"BeforeBeat":t.graceType=se.BeforeBeat;break}break;case"Legato":a.getAttribute("origin")==="true"&&(t.isLegatoOrigin=!0);break;case"Whammy":const n=new H(0,0);n.value=this.toBendValue(I.parseFloatSafe(a.getAttribute("originValue"),0)),n.offset=this.toBendOffset(I.parseFloatSafe(a.getAttribute("originOffset"),0)),t.addWhammyBarPoint(n);const r=new H(0,0);r.value=this.toBendValue(I.parseFloatSafe(a.getAttribute("middleValue"),0)),r.offset=this.toBendOffset(I.parseFloatSafe(a.getAttribute("middleOffset1"),0)),t.addWhammyBarPoint(r);const o=new H(0,0);o.value=this.toBendValue(I.parseFloatSafe(a.getAttribute("middleValue"),0)),o.offset=this.toBendOffset(I.parseFloatSafe(a.getAttribute("middleOffset2"),0)),t.addWhammyBarPoint(o);const l=new H(0,0);l.value=this.toBendValue(I.parseFloatSafe(a.getAttribute("destinationValue"),0)),l.offset=this.toBendOffset(I.parseFloatSafe(a.getAttribute("destinationOffset"),0)),t.addWhammyBarPoint(l);break;case"Ottavia":switch(a.innerText){case"8va":t.ottava=fe._8va;break;case"8vb":t.ottava=fe._8vb;break;case"15ma":t.ottava=fe._15ma;break;case"15mb":t.ottava=fe._15mb;break}break;case"Lyrics":t.lyrics=this.parseBeatLyrics(a),this._skipApplyLyrics=!0;break;case"Slashed":t.slashed=!0;break;case"DeadSlapped":t.deadSlapped=!0;break;case"Golpe":switch(a.innerText){case"Finger":t.golpe=Ji.Finger;break;case"Thumb":t.golpe=Ji.Thumb;break}break;case"Wah":switch(a.innerText){case"Open":t.wahPedal=ls.Open;break;case"Closed":t.wahPedal=ls.Closed;break}break;case"UserTransposedPitchStemOrientation":switch(a.innerText){case"Downward":t.preferredBeamDirection=P.Down;break;case"Upward":t.preferredBeamDirection=P.Up;break}break;case"Timer":t.showTimer=!0,t.timer=I.parseIntSafe(a.innerText,-1),t.timer<0&&(t.timer=null);break}this._beatById.set(i,t)}parseBeatLyrics(e){const t=[];for(const i of e.childElements())switch(i.localName){case"Line":t.push(i.innerText);break}return t}parseBeatXProperties(e,t){var i,a,n,r;for(const o of e.childElements())switch(o.localName){case"XProperty":const l=o.getAttribute("id");let h=0;switch(l){case"1124204546":switch(h=I.parseIntSafe((i=o.findChildElement("Int"))==null?void 0:i.innerText,0),h){case 1:t.beamingMode=it.ForceMergeWithNext;break;case 2:t.beamingMode=it.ForceSplitToNext;break}break;case"1124204552":switch(h=I.parseIntSafe((a=o.findChildElement("Int"))==null?void 0:a.innerText,0),h){case 1:t.beamingMode!==it.ForceSplitToNext&&(t.beamingMode=it.ForceSplitOnSecondaryToNext);break}break;case"1124204545":h=I.parseIntSafe((n=o.findChildElement("Int"))==null?void 0:n.innerText,0),t.invertBeamDirection=h===1;break;case"687935489":h=I.parseIntSafe((r=o.findChildElement("Int"))==null?void 0:r.innerText,0),t.brushDuration=h;break}break}}parseBarXProperties(e,t){for(const i of e.childElements())switch(i.localName){case"XProperty":switch(i.getAttribute("id")){case"1124139520":const n=i.findChildElement("Double")??i.findChildElement("Float");t.displayScale=I.parseFloatSafe(n==null?void 0:n.innerText,1);break}break}}parseMasterBarXProperties(e,t){var i;for(const a of t.childElements())switch(a.localName){case"XProperty":switch(a.getAttribute("id")){case"1124073984":e.displayScale=I.parseFloatSafe((i=a.findChildElement("Double"))==null?void 0:i.innerText,1);break}break}}parseBeatProperties(e,t){var h,c,d,f,p,g,m,T,S,y,b,B,N;let i=!1,a=null,n=null,r=null,o=null,l=null;for(const L of e.childElements())switch(L.localName){case"Property":switch(L.getAttribute("name")){case"Brush":((h=L.findChildElement("Direction"))==null?void 0:h.innerText)==="Up"?t.brushType=Y.BrushUp:t.brushType=Y.BrushDown;break;case"PickStroke":((c=L.findChildElement("Direction"))==null?void 0:c.innerText)==="Up"?t.pickStroke=ni.Up:t.pickStroke=ni.Down;break;case"Slapped":L.findChildElement("Enable")&&(t.slap=!0);break;case"Popped":L.findChildElement("Enable")&&(t.pop=!0);break;case"VibratoWTremBar":switch((d=L.findChildElement("Strength"))==null?void 0:d.innerText){case"Wide":t.vibrato=ve.Wide;break;case"Slight":t.vibrato=ve.Slight;break}break;case"WhammyBar":i=!0;break;case"WhammyBarExtend":break;case"WhammyBarOriginValue":a||(a=new H(0,0)),a.value=this.toBendValue(I.parseFloatSafe((f=L.findChildElement("Float"))==null?void 0:f.innerText,0));break;case"WhammyBarOriginOffset":a||(a=new H(0,0)),a.offset=this.toBendOffset(I.parseFloatSafe((p=L.findChildElement("Float"))==null?void 0:p.innerText,0));break;case"WhammyBarMiddleValue":n=this.toBendValue(I.parseFloatSafe((g=L.findChildElement("Float"))==null?void 0:g.innerText,0));break;case"WhammyBarMiddleOffset1":r=this.toBendOffset(I.parseFloatSafe((m=L.findChildElement("Float"))==null?void 0:m.innerText,0));break;case"WhammyBarMiddleOffset2":o=this.toBendOffset(I.parseFloatSafe((T=L.findChildElement("Float"))==null?void 0:T.innerText,0));break;case"WhammyBarDestinationValue":l||(l=new H(H.MaxPosition,0)),l.value=this.toBendValue(I.parseFloatSafe((S=L.findChildElement("Float"))==null?void 0:S.innerText,0));break;case"WhammyBarDestinationOffset":l||(l=new H(0,0)),l.offset=this.toBendOffset(I.parseFloatSafe((y=L.findChildElement("Float"))==null?void 0:y.innerText,0));break;case"BarreFret":t.barreFret=I.parseIntSafe((b=L.findChildElement("Fret"))==null?void 0:b.innerText,0);break;case"BarreString":switch((B=L.findChildElement("String"))==null?void 0:B.innerText){case"0":t.barreShape=ns.Full;break;case"1":t.barreShape=ns.Half;break}break;case"Rasgueado":switch((N=L.findChildElement("Rasgueado"))==null?void 0:N.innerText){case"ii_1":t.rasgueado=X.Ii;break;case"mi_1":t.rasgueado=X.Mi;break;case"mii_1":t.rasgueado=X.MiiTriplet;break;case"mii_2":t.rasgueado=X.MiiAnapaest;break;case"pmp_1":t.rasgueado=X.PmpTriplet;break;case"pmp_2":t.rasgueado=X.PmpAnapaest;break;case"pei_1":t.rasgueado=X.PeiTriplet;break;case"pei_2":t.rasgueado=X.PeiAnapaest;break;case"pai_1":t.rasgueado=X.PaiTriplet;break;case"pai_2":t.rasgueado=X.PaiAnapaest;break;case"ami_1":t.rasgueado=X.AmiTriplet;break;case"ami_2":t.rasgueado=X.AmiAnapaest;break;case"ppp_1":t.rasgueado=X.Ppp;break;case"amii_1":t.rasgueado=X.Amii;break;case"amip_1":t.rasgueado=X.Amip;break;case"eami_1":t.rasgueado=X.Eami;break;case"eamii_1":t.rasgueado=X.Eamii;break;case"peami_1":t.rasgueado=X.Peami;break}break}break}i&&(a||(a=new H(0,0)),l||(l=new H(H.MaxPosition,0)),t.addWhammyBarPoint(a),r&&n&&t.addWhammyBarPoint(new H(r,n)),o&&n&&t.addWhammyBarPoint(new H(o,n)),!r&&!o&&n&&t.addWhammyBarPoint(new H(H.MaxPosition/2|0,n)),t.addWhammyBarPoint(l))}parseNotes(e){for(const t of e.childElements())switch(t.localName){case"Note":this.parseNote(t);break}}parseNote(e){const t=new bt,i=e.getAttribute("id");for(const a of e.childElements())switch(a.localName){case"Properties":this.parseNoteProperties(a,t,i);break;case"AntiAccent":a.innerText.toLowerCase()==="normal"&&(t.isGhost=!0);break;case"LetRing":t.isLetRing=!0;break;case"Trill":t.trillValue=I.parseIntSafe(a.innerText,-1),t.trillSpeed=w.Sixteenth;break;case"Accent":const n=I.parseIntSafe(a.innerText,0);n&1&&(t.isStaccato=!0),n&4&&(t.accentuated=_t.Heavy),n&8&&(t.accentuated=_t.Normal),n&16&&(t.accentuated=_t.Tenuto);break;case"Tie":a.getAttribute("destination").toLowerCase()==="true"&&(t.isTieDestination=!0);break;case"Vibrato":switch(a.innerText){case"Slight":t.vibrato=ve.Slight;break;case"Wide":t.vibrato=ve.Wide;break}break;case"LeftFingering":switch(a.innerText){case"P":t.leftHandFinger=ie.Thumb;break;case"I":t.leftHandFinger=ie.IndexFinger;break;case"M":t.leftHandFinger=ie.MiddleFinger;break;case"A":t.leftHandFinger=ie.AnnularFinger;break;case"C":t.leftHandFinger=ie.LittleFinger;break}break;case"RightFingering":switch(a.innerText){case"P":t.rightHandFinger=ie.Thumb;break;case"I":t.rightHandFinger=ie.IndexFinger;break;case"M":t.rightHandFinger=ie.MiddleFinger;break;case"A":t.rightHandFinger=ie.AnnularFinger;break;case"C":t.rightHandFinger=ie.LittleFinger;break}break;case"InstrumentArticulation":t.percussionArticulation=I.parseIntSafe(a.innerText,0);break;case"Ornament":switch(a.innerText){case"Turn":t.ornament=Tt.Turn;break;case"InvertedTurn":t.ornament=Tt.InvertedTurn;break;case"UpperMordent":t.ornament=Tt.UpperMordent;break;case"LowerMordent":t.ornament=Tt.LowerMordent;break}break}this._noteById.set(i,t)}parseNoteProperties(e,t,i){var f,p,g,m,T,S,y,b,B,N,L,_,A,J;let a=!1,n=null,r=null,o=null,l=null,h=null,c=-1,d=-1;for(const G of e.childElements())switch(G.localName){case"Property":switch(G.getAttribute("name")){case"ShowStringNumber":G.findChildElement("Enable")&&(t.showStringNumber=!0);break;case"String":t.string=I.parseIntSafe((f=G.findChildElement("String"))==null?void 0:f.innerText,0)+1;break;case"Fret":t.fret=I.parseIntSafe((p=G.findChildElement("Fret"))==null?void 0:p.innerText,0);break;case"Element":c=I.parseIntSafe((g=G.findChildElement("Element"))==null?void 0:g.innerText,0);break;case"Variation":d=I.parseIntSafe((m=G.findChildElement("Variation"))==null?void 0:m.innerText,0);break;case"Tapped":this._tappedNotes.set(i,!0);break;case"HarmonicType":const Ce=G.findChildElement("HType");if(Ce)switch(Ce.innerText){case"NoHarmonic":t.harmonicType=ae.None;break;case"Natural":t.harmonicType=ae.Natural;break;case"Artificial":t.harmonicType=ae.Artificial;break;case"Pinch":t.harmonicType=ae.Pinch;break;case"Tap":t.harmonicType=ae.Tap;break;case"Semi":t.harmonicType=ae.Semi;break;case"Feedback":t.harmonicType=ae.Feedback;break}break;case"HarmonicFret":const at=G.findChildElement("HFret");at&&(t.harmonicValue=I.parseFloatSafe(at.innerText,0));break;case"Muted":G.findChildElement("Enable")&&(t.isDead=!0);break;case"PalmMuted":G.findChildElement("Enable")&&(t.isPalmMute=!0);break;case"Octave":t.octave=I.parseIntSafe((T=G.findChildElement("Number"))==null?void 0:T.innerText,0),t.tone===-1&&(t.tone=0);break;case"Tone":t.tone=I.parseIntSafe((S=G.findChildElement("Step"))==null?void 0:S.innerText,0);break;case"ConcertPitch":this.parseConcertPitch(G,t);break;case"Bended":a=!0;break;case"BendOriginValue":n||(n=new H(0,0)),n.value=this.toBendValue(I.parseFloatSafe((y=G.findChildElement("Float"))==null?void 0:y.innerText,0));break;case"BendOriginOffset":n||(n=new H(0,0)),n.offset=this.toBendOffset(I.parseFloatSafe((b=G.findChildElement("Float"))==null?void 0:b.innerText,0));break;case"BendMiddleValue":r=this.toBendValue(I.parseFloatSafe((B=G.findChildElement("Float"))==null?void 0:B.innerText,0));break;case"BendMiddleOffset1":o=this.toBendOffset(I.parseFloatSafe((N=G.findChildElement("Float"))==null?void 0:N.innerText,0));break;case"BendMiddleOffset2":l=this.toBendOffset(I.parseFloatSafe((L=G.findChildElement("Float"))==null?void 0:L.innerText,0));break;case"BendDestinationValue":h||(h=new H(H.MaxPosition,0)),h.value=this.toBendValue(I.parseFloatSafe((_=G.findChildElement("Float"))==null?void 0:_.innerText,0));break;case"BendDestinationOffset":h||(h=new H(0,0)),h.offset=this.toBendOffset(I.parseFloatSafe((A=G.findChildElement("Float"))==null?void 0:A.innerText,0));break;case"HopoOrigin":G.findChildElement("Enable")&&(t.isHammerPullOrigin=!0);break;case"HopoDestination":break;case"LeftHandTapped":t.isLeftHandTapped=!0;break;case"Slide":const ht=I.parseIntSafe((J=G.findChildElement("Flags"))==null?void 0:J.innerText,0);ht&1?t.slideOutType=pe.Shift:ht&2?t.slideOutType=pe.Legato:ht&4?t.slideOutType=pe.OutDown:ht&8&&(t.slideOutType=pe.OutUp),ht&16?t.slideInType=jt.IntoFromBelow:ht&32&&(t.slideInType=jt.IntoFromAbove),ht&64?t.slideOutType=pe.PickSlideDown:ht&128&&(t.slideOutType=pe.PickSlideUp);break}break}a&&(n||(n=new H(0,0)),h||(h=new H(H.MaxPosition,0)),t.addBendPoint(n),o&&r&&t.addBendPoint(new H(o,r)),l&&r&&t.addBendPoint(new H(l,r)),!o&&!l&&r&&t.addBendPoint(new H(H.MaxPosition/2|0,r)),t.addBendPoint(h)),c!==-1&&d!==-1&&(t.percussionArticulation=At.articulationFromElementVariation(c,d))}parseConcertPitch(e,t){const i=e.findChildElement("Pitch");if(i)for(const a of i.childElements())switch(a.localName){case"Accidental":switch(a.innerText){case"x":t.accidentalMode=ke.ForceDoubleSharp;break;case"#":t.accidentalMode=ke.ForceSharp;break;case"b":t.accidentalMode=ke.ForceFlat;break;case"bb":t.accidentalMode=ke.ForceDoubleFlat;break}break}}toBendValue(e){return e*I.BendPointValueFactor|0}toBendOffset(e){return e*I.BendPointPositionFactor}parseRhythms(e){for(const t of e.childElements())switch(t.localName){case"Rhythm":this.parseRhythm(t);break}}parseRhythm(e){const t=new Mx,i=e.getAttribute("id");t.id=i;for(const a of e.childElements())switch(a.localName){case"NoteValue":switch(a.innerText){case"Long":t.value=w.QuadrupleWhole;break;case"DoubleWhole":t.value=w.DoubleWhole;break;case"Whole":t.value=w.Whole;break;case"Half":t.value=w.Half;break;case"Quarter":t.value=w.Quarter;break;case"Eighth":t.value=w.Eighth;break;case"16th":t.value=w.Sixteenth;break;case"32nd":t.value=w.ThirtySecond;break;case"64th":t.value=w.SixtyFourth;break;case"128th":t.value=w.OneHundredTwentyEighth;break;case"256th":t.value=w.TwoHundredFiftySixth;break}break;case"PrimaryTuplet":t.tupletNumerator=I.parseIntSafe(a.getAttribute("num"),-1),t.tupletDenominator=I.parseIntSafe(a.getAttribute("den"),-1);break;case"AugmentationDot":t.dots=I.parseIntSafe(a.getAttribute("count"),0);break}this._rhythmById.set(i,t)}buildModel(){for(let i=0,a=this._masterBars.length;i<a;i++){const n=this._masterBars[i];this.score.addMasterBar(n)}const e=this._masterBars[this._masterBars.length-1];this._doubleBars.has(e)&&(this._doubleBars.delete(e),e.isDoubleBar=!1);for(const i of this._tracksMapping){if(!i)continue;const a=this._tracksById.get(i);this.score.addTrack(a)}let t;for(const i of this._barsOfMasterBar){let a=0;t=[_e.C,Mi.Major];for(let n=0,r=0;n<i.length&&r<this.score.tracks.length;n++){const o=i[n];if(o!==I.InvalidId){const l=this._barsById.get(o),h=this.score.tracks[r],c=h.staves[a];c.addBar(l);const d=c.bars.length-1;if(this._keySignatures.has(d)&&(t=this._keySignatures.get(d)),l.keySignature=t[0],l.keySignatureType=t[1],this._doubleBars.has(l.masterBar)&&(l.barLineRight=oe.LightLight),this._voicesOfBar.has(o))for(const f of this._voicesOfBar.get(o))if(f!==I.InvalidId){const p=this._voiceById.get(f);if(l.addVoice(p),this._beatsOfVoice.has(f)){for(const g of this._beatsOfVoice.get(f))if(g!==I.InvalidId){const m=Cg.clone(this._beatById.get(g));p.addBeat(m);const T=this._rhythmOfBeat.get(g),S=this._rhythmById.get(T);if(m.duration=S.value,m.dots=S.dots,m.tupletNumerator=S.tupletNumerator,m.tupletDenominator=S.tupletDenominator,this._notesOfBeat.has(g)){for(const y of this._notesOfBeat.get(g))if(y!==I.InvalidId){const b=Zw.clone(this._noteById.get(y));c.isPercussion?(b.fret=-1,b.string=-1):b.percussionArticulation=-1,m.addNote(b),this._tappedNotes.has(y)&&(m.tap=!0)}}}}}else{const p=new Bs;l.addVoice(p);const g=new Wt;g.isEmpty=!0,g.duration=w.Quarter,p.addBeat(g)}a===h.staves.length-1?(r++,a=0,t=[_e.C,Mi.Major]):(a++,t=[_e.C,Mi.Major])}else r++}}for(const i of this._tracksMapping){if(!i)continue;const a=this._tracksById.get(i);let n=!1;for(const r of a.staves)if(r.isPercussion){n=!0;break}if(n||(a.percussionArticulations=[]),this._automationsPerTrackIdAndBarIndex.has(i)){const r=this._automationsPerTrackIdAndBarIndex.get(i);for(const[o,l]of r)if(a.staves.length>0&&o<a.staves[0].bars.length){const h=a.staves[0].bars[o];if(h.voices.length>0&&h.voices[0].beats.length>0){const c=h.voices[0].beats[0];for(const d of l)c.automations.push(d)}}}if(this._sustainPedalsPerTrackIdAndBarIndex.has(i)){const r=this._sustainPedalsPerTrackIdAndBarIndex.get(i);for(const[o,l]of r)if(a.staves.length>0&&o<a.staves[0].bars.length){const h=a.staves[0].bars[o];h.sustainPedals=l}}}for(const[i,a]of this._masterTrackAutomations){const n=this.score.masterBars[i];for(let r=0,o=a.length;r<o;r++){const l=a[r];switch(l.type){case tt.Tempo:i===0&&(this.score.tempo=l.value|0,l.text&&(this.score.tempoLabel=l.text)),n.tempoAutomations.push(l);break;case tt.SyncPoint:l.syncPointValue.millisecondOffset-=this._backingTrackPadding,n.addSyncPoint(l);break}}}}}I.InvalidId="-1";I.BendPointPositionFactor=H.MaxPosition/100;I.BendPointValueFactor=1/25;I.SampleRate=44100;class jd{constructor(){this.isMultiRest=!1,this.trackViewGroups=[]}}class Ay{constructor(){this.showNumbered=!1,this.showSlash=!1,this.showStandardNotation=!1,this.showTablature=!1}}class tk{apply(e){if(this.scoreViews.length>0){let t=0;e.stylesheet.multiTrackMultiBarRest=this.scoreViews[0].isMultiRest;for(const i of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const a=e.tracks[t];for(const n of a.staves)n.showTablature=i.showTablature,n.showStandardNotation=i.showStandardNotation,n.showSlash=i.showSlash,n.showNumbered=i.showNumbered}t++}for(let i=1;i<this.scoreViews.length;i++)this.scoreViews[i].isMultiRest&&(e.stylesheet.perTrackMultiBarRest||(e.stylesheet.perTrackMultiBarRest=new Set),t=i-1,e.stylesheet.perTrackMultiBarRest.add(t))}}constructor(e){this.scoreViews=[];const t=Dt.fromBuffer(e),i=x.readInt32BE(t);for(let a=0;a<i;a++){const n=new jd;this.scoreViews.push(n),n.isMultiRest=Le.gpReadBool(t);const r=x.readInt32BE(t);for(let o=0;o<r;o++){let l=t.readByte();l===0&&(l=1);const h=new Ay;h.showStandardNotation=(l&1)!==0,h.showTablature=(l&2)!==0,h.showSlash=(l&4)!==0,h.showNumbered=(l&8)!==0,n.trackViewGroups.push(h)}}}static writeForScore(e){var a;const t=Dt.withCapacity(128),i=[new jd];i[0].isMultiRest=e.stylesheet.multiTrackMultiBarRest;for(const n of e.tracks){const r=new Ay;r.showStandardNotation=n.staves[0].showStandardNotation,r.showTablature=n.staves[0].showTablature,r.showSlash=n.staves[0].showSlash,r.showNumbered=n.staves[0].showNumbered,i[0].trackViewGroups.push(r);const o=new jd;o.isMultiRest=((a=e.stylesheet.perTrackMultiBarRest)==null?void 0:a.has(n.index))===!0,o.trackViewGroups.push(r),i.push(o)}x.writeInt32BE(t,i.length);for(const n of i){t.writeByte(n.isMultiRest?1:0),x.writeInt32BE(t,n.trackViewGroups.length);for(const r of n.trackViewGroups){let o=0;r.showStandardNotation&&(o=o|1),r.showTablature&&(o=o|2),r.showSlash&&(o=o|4),r.showNumbered&&(o=o|8),t.writeByte(o)}}return x.writeInt32BE(t,1),t.toArray()}}let Dg=class{};class xc extends Dg{constructor(e){super(),this.n=e}}class gr extends Dg{constructor(e,t){super(),this.left=e,this.right=t}}class hp extends Dg{constructor(e,t){super(),this.n=e,this.table=t}}class fi{static make(e,t,i,a){const n=[],r=[];if(a>32)throw new Kt("Invalid huffman");for(let h=0;h<a;h++)n.push(0),r.push(0);for(let h=0;h<i;h++){const c=e[h+t];if(c>=a)throw new Kt("Invalid huffman");n[c]++}let o=0;for(let h=1;h<a-1;h++)o=o+n[h]<<1,r[h]=o;const l=new Map;for(let h=0;h<i;h++){const c=e[h+t];if(c!==0){const d=r[c-1];r[c-1]=d+1,l.set(d<<5|c,h)}}return fi.treeCompress(new gr(fi.treeMake(l,a,0,1),fi.treeMake(l,a,1,1)))}static treeMake(e,t,i,a){if(a>t)throw new Kt("Invalid huffman");const n=i<<5|a;return e.has(n)?new xc(e.get(n)):(i=i<<1,a+=1,new gr(fi.treeMake(e,t,i,a),fi.treeMake(e,t,i|1,a)))}static treeCompress(e){const t=fi.treeDepth(e);if(t===0)return e;if(t===1){if(e instanceof gr)return new gr(fi.treeCompress(e.left),fi.treeCompress(e.right));throw new Kt("assert")}const i=1<<t,a=[];for(let n=0;n<i;n++)a.push(new xc(-1));return fi.treeWalk(a,0,0,t,e),new hp(t,a)}static treeWalk(e,t,i,a,n){n instanceof gr&&a>0?(fi.treeWalk(e,t,i+1,a-1,n.left),fi.treeWalk(e,t|1<<i,i+1,a-1,n.right)):e[t]=fi.treeCompress(n)}static treeDepth(e){if(e instanceof xc)return 0;if(e instanceof hp)throw new Kt("assert");if(e instanceof gr){const t=fi.treeDepth(e.left),i=fi.treeDepth(e.right);return 1+(t<i?t:i)}return 0}}var Ut;(function(s){s[s.Head=0]="Head",s[s.Block=1]="Block",s[s.CData=2]="CData",s[s.Flat=3]="Flat",s[s.Crc=4]="Crc",s[s.Dist=5]="Dist",s[s.DistOne=6]="DistOne",s[s.Done=7]="Done"})(Ut||(Ut={}));class aa{constructor(){this.buffer=new Uint8Array(aa.BufferSize),this.pos=0}slide(){const e=new Uint8Array(aa.BufferSize);this.pos-=aa.Size,e.set(this.buffer.subarray(aa.Size,aa.Size+this.pos),0),this.buffer=e}addBytes(e,t,i){this.pos+i>aa.BufferSize&&this.slide(),this.buffer.set(e.subarray(t,t+i),this.pos),this.pos+=i}addByte(e){this.pos===aa.BufferSize&&this.slide(),this.buffer[this.pos]=e,this.pos++}getLastChar(){return this.buffer[this.pos-1]}available(){return this.pos}}aa.Size=32768;aa.BufferSize=65536;class Ii{static buildFixedHuffman(){const e=[];for(let t=0;t<288;t++)e.push(t<=143?8:t<=255?9:t<=279?7:8);return fi.make(e,0,288,10)}constructor(e){this._nbits=0,this._bits=0,this._state=Ut.Block,this._isFinal=!1,this._huffman=Ii._fixedHuffman,this._huffdist=null,this._len=0,this._dist=0,this._needed=0,this._output=null,this._outpos=0,this._lengths=[],this._window=new aa,this._input=e;for(let t=0;t<19;t++)this._lengths.push(-1)}readBytes(e,t,i){if(this._needed=i,this._outpos=t,this._output=e,i>0)for(;this.inflateLoop(););return i-this._needed}inflateLoop(){switch(this._state){case Ut.Head:const e=this._input.readByte();if((e&15)!==8)throw new Kt("Invalid data");const i=this._input.readByte(),a=(i&32)!==0;if(((e<<8)+i)%31!==0)throw new Kt("Invalid data");if(a)throw new Kt("Unsupported dictionary");return this._state=Ut.Block,!0;case Ut.Crc:return this._state=Ut.Done,!0;case Ut.Done:return!1;case Ut.Block:switch(this._isFinal=this.getBit(),this.getBits(2)){case 0:if(this._len=x.readUInt16LE(this._input),x.readUInt16LE(this._input)!==65535-this._len)throw new Kt("Invalid data");this._state=Ut.Flat;const c=this.inflateLoop();return this.resetBits(),c;case 1:return this._huffman=Ii._fixedHuffman,this._huffdist=null,this._state=Ut.CData,!0;case 2:const d=this.getBits(5)+257,f=this.getBits(5)+1,p=this.getBits(4)+4;for(let m=0;m<p;m++)this._lengths[Ii.CodeLengthsPos[m]]=this.getBits(3);for(let m=p;m<19;m++)this._lengths[Ii.CodeLengthsPos[m]]=0;this._huffman=fi.make(this._lengths,0,19,8);const g=[];for(let m=0;m<d+f;m++)g.push(0);return this.inflateLengths(g,d+f),this._huffdist=fi.make(g,d,f,16),this._huffman=fi.make(g,0,d,16),this._state=Ut.CData,!0;default:throw new Kt("Invalid data")}case Ut.Flat:{const h=this._len<this._needed?this._len:this._needed,c=x.readByteArray(this._input,h);return this._len-=h,this.addBytes(c,0,h),this._len===0&&(this._state=this._isFinal?Ut.Crc:Ut.Block),this._needed>0}case Ut.DistOne:{const h=this._len<this._needed?this._len:this._needed;return this.addDistOne(h),this._len-=h,this._len===0&&(this._state=Ut.CData),this._needed>0}case Ut.Dist:for(;this._len>0&&this._needed>0;){const h=this._len<this._dist?this._len:this._dist,c=this._needed<h?this._needed:h;this.addDist(this._dist,c),this._len-=c}return this._len===0&&(this._state=Ut.CData),this._needed>0;case Ut.CData:let n=this.applyHuffman(this._huffman);if(n<256)return this.addByte(n),this._needed>0;if(n===256)return this._state=this._isFinal?Ut.Crc:Ut.Block,!0;n=n-257&255;let r=Ii.LenExtraBitsTbl[n];if(r===-1)throw new Kt("Invalid data");this._len=Ii.LenBaseValTbl[n]+this.getBits(r);const o=this._huffdist,l=o?this.applyHuffman(o):this.getRevBits(5);if(r=Ii.DistExtraBitsTbl[l],r===-1)throw new Kt("Invalid data");if(this._dist=Ii.DistBaseValTbl[l]+this.getBits(r),this._dist>this._window.available())throw new Kt("Invalid data");return this._state=this._dist===1?Ut.DistOne:Ut.Dist,!0}return!1}addDistOne(e){const t=this._window.getLastChar();for(let i=0;i<e;i++)this.addByte(t)}addByte(e){this._window.addByte(e),this._output[this._outpos]=e,this._needed--,this._outpos++}addDist(e,t){this.addBytes(this._window.buffer,this._window.pos-e,t)}getBit(){this._nbits===0&&(this._nbits=8,this._bits=this._input.readByte());const e=(this._bits&1)===1;return this._nbits--,this._bits=this._bits>>1,e}getBits(e){for(;this._nbits<e;)this._bits=this._bits|this._input.readByte()<<this._nbits,this._nbits+=8;const t=this._bits&(1<<e)-1;return this._nbits-=e,this._bits=this._bits>>e,t}getRevBits(e){return e===0?0:this.getBit()?1<<e-1|this.getRevBits(e-1):this.getRevBits(e-1)}resetBits(){this._bits=0,this._nbits=0}addBytes(e,t,i){this._window.addBytes(e,t,i),this._output.set(e.subarray(t,t+i),this._outpos),this._needed-=i,this._outpos+=i}inflateLengths(e,t){let i=0,a=0;for(;i<t;){const n=this.applyHuffman(this._huffman);switch(n){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:a=n,e[i]=n,i++;break;case 16:const r=i+3+this.getBits(2);if(r>t)throw new Kt("Invalid data");for(;i<r;)e[i]=a,i++;break;case 17:if(i+=3+this.getBits(3),i>t)throw new Kt("Invalid data");break;case 18:if(i+=11+this.getBits(7),i>t)throw new Kt("Invalid data");break;default:throw new Kt("Invalid data")}}}applyHuffman(e){if(e instanceof xc)return e.n;if(e instanceof gr)return this.applyHuffman(this.getBit()?e.right:e.left);if(e instanceof hp)return this.applyHuffman(e.table[this.getBits(e.n)]);throw new Kt("Invalid data")}}Ii.LenExtraBitsTbl=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,-1,-1];Ii.LenBaseValTbl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258];Ii.DistExtraBitsTbl=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,-1,-1];Ii.DistBaseValTbl=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577];Ii.CodeLengthsPos=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];Ii._fixedHuffman=Ii.buildFixedHuffman();class $a{constructor(e,t){this.fullName=e;const i=e.lastIndexOf("/");this.fileName=i===-1||i===e.length-1?this.fullName:e.substr(i+1),this.data=t}}$a.OptionalDataDescriptorSignature=134695760;$a.CompressionMethodDeflate=8;$a.LocalFileHeaderSignature=67324752;$a.CentralFileHeaderSignature=33639248;$a.EndOfCentralDirSignature=101010256;class Pg{constructor(e){this._readable=e}read(){const e=[];for(;;){const t=this.readEntry();if(!t)break;e.push(t)}return e}readEntry(){const e=this._readable;if(x.readInt32LE(e)!==$a.LocalFileHeaderSignature)return null;x.readUInt16LE(e);const i=x.readUInt16LE(e),a=x.readUInt16LE(e),n=a!==0;if(n&&a!==$a.CompressionMethodDeflate)return null;x.readInt16LE(this._readable),x.readInt16LE(this._readable),x.readInt32LE(e),x.readInt32LE(e);const r=x.readInt32LE(e),o=x.readInt16LE(e),l=x.readInt16LE(e),h=x.toString(x.readByteArray(e,o),"utf-8");e.skip(l);let c;if(n){const d=Dt.empty(),f=new Ii(this._readable),p=new Uint8Array(65536);for(;;){const g=f.readBytes(p,0,p.length);if(d.write(p,0,g),g<p.length)break}c=d.toArray()}else c=x.readByteArray(this._readable,r);return i&8&&(x.readInt32LE(this._readable)===$a.OptionalDataDescriptorSignature&&x.readInt32LE(this._readable),x.readInt32LE(this._readable),x.readInt32LE(this._readable)),new $a(h,c)}}class Ox{constructor(){this.trackViewGroups=[]}}class Ix{constructor(){this.isVisible=!1}}var cp;(function(s){s[s.PageVertical=0]="PageVertical",s[s.PageGrid=1]="PageGrid",s[s.PageParchment=2]="PageParchment",s[s.ScreenVertical=3]="ScreenVertical",s[s.ScreenHorizontal=4]="ScreenHorizontal",s[s.PageHorizontal=5]="PageHorizontal"})(cp||(cp={}));class ik{constructor(e,t){this.zoomLevel=4,this.view=cp.PageVertical,this.muiltiVoiceCursor=!1,this.scoreViews=[];const i=Dt.fromBuffer(t);this.zoomLevel=x.readInt32BE(i),this.view=i.readByte(),this.muiltiVoiceCursor=i.readByte()!==0;const a=e.scoreViews.length;for(let n=0;n<a;n++){const r=new Ox;this.scoreViews.push(r);const o=e.scoreViews[n];for(let l=0;l<o.trackViewGroups.length;l++){const h=new Ix;h.isVisible=i.readByte()!==0,r.trackViewGroups.push(h)}}}apply(e){if(this.scoreViews.length>0){let t=0;for(const i of this.scoreViews[0].trackViewGroups){if(t<e.tracks.length){const a=e.tracks[t];a.isVisibleOnMultiTrack=i.isVisible}t++}}}static writeForScore(e){const t=Dt.withCapacity(128);x.writeInt32BE(t,4),t.writeByte(0);const i=e.tracks.length>0&&e.tracks[0].staves[0].bars[0].isMultiVoice;t.writeByte(i?255:0);for(const a of e.tracks)t.writeByte(a.isVisibleOnMultiTrack?255:0);for(const a of e.tracks)t.writeByte(255);return t.toArray()}}class Hx extends Ko{get name(){return"Guitar Pro 7-8"}readScore(){E.debug(this.name,"Loading ZIP entries");const e=new Pg(this.data);let t;try{t=e.read()}catch(d){throw new vt("No Zip archive",d)}E.debug(this.name,"Zip entries loaded");let i=null,a=null,n=null,r=null;const o=new Map;for(const d of t)switch(o.set(d.fullName,d),d.fileName){case"score.gpif":i=x.toString(d.data,this.settings.importer.encoding);break;case"BinaryStylesheet":a=d.data;break;case"PartConfiguration":n=d.data;break;case"LayoutConfiguration":r=d.data;break}if(!i)throw new vt("No score.gpif found in zip archive");E.debug(this.name,"Start Parsing score.gpif");const l=new I;l.loadAsset=d=>{if(o.has(d))return o.get(d).data},l.parseXml(i,this.settings),E.debug(this.name,"score.gpif parsed");const h=l.score;a&&(E.debug(this.name,"Start Parsing BinaryStylesheet"),new ms(a).apply(h),E.debug(this.name,"BinaryStylesheet parsed"));let c=null;return n&&(E.debug(this.name,"Start Parsing Part Configuration"),c=new tk(n),c.apply(h),E.debug(this.name,"Part Configuration parsed")),r&&c!=null&&(E.debug(this.name,"Start Parsing Layout Configuration"),new ik(c,r).apply(h),E.debug(this.name,"Layout Configuration parsed")),h}}class lh extends We{constructor(){super(Ve.Format,"Unexpected end of data within reader"),Object.setPrototypeOf(this,lh.prototype)}}class hh{constructor(e){this._currentByte=0,this._position=hh.ByteSize,this._source=e}readByte(){return this.readBits(8)}readBytes(e){const t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=this.readByte()&255;return t}readBits(e){let t=0,i=e-1;for(;i>=0;)t=t|this.readBit()<<i,i--;return t}readBitsReversed(e){let t=0;for(let i=0;i<e;i++)t=t|this.readBit()<<i;return t}readBit(){if(this._position>=8){if(this._currentByte=this._source.readByte(),this._currentByte===-1)throw new lh;this._position=0}const e=this._currentByte>>hh.ByteSize-this._position-1&1;return this._position++,e}readAll(){const e=Dt.empty();try{for(;;)e.writeByte(this.readByte()&255)}catch(t){if(!(t instanceof lh))throw t}return e.toArray()}}hh.ByteSize=8;class Vx{constructor(){this.fileName="",this.fileSize=0,this.data=null}}class Lg{constructor(){this.files=[],this.files=[],this.fileFilter=e=>!0}load(e){const t=new hh(e);this.readBlock(t)}readHeader(e){return this.getString(e.readBytes(4),0,4)}decompress(e,t=!1){const i=Dt.empty();let a;const n=this.getInteger(e.readBytes(4),0);try{for(;i.length<n;)if(e.readBits(1)===1){const d=e.readBits(4),f=e.readBitsReversed(d),p=e.readBitsReversed(d),g=i.length-f,m=Math.min(f,p);a=i.getBuffer(),i.write(a,g,m)}else{const d=e.readBitsReversed(2);for(let f=0;f<d;f++)i.writeByte(e.readByte())}}catch(c){if(!(c instanceof lh))throw c}a=i.getBuffer();const r=t?4:0,o=i.length-r,l=new Uint8Array(o),h=o;return l.set(a.subarray(r,r+h),0),l}readBlock(e){const t=this.readHeader(e);if(t==="BCFZ")this.readUncompressedBlock(this.decompress(e,!0));else if(t==="BCFS")this.readUncompressedBlock(e.readAll());else throw new vt("Unsupported format")}readUncompressedBlock(e){let i=4096;for(;i+3<e.length;){if(this.getInteger(e,i)===2){const n=new Vx;n.fileName=this.getString(e,i+4,127),n.fileSize=this.getInteger(e,i+140);const r=!this.fileFilter||this.fileFilter(n.fileName);r&&this.files.push(n);const o=i+148;let l=0,h=0;const c=r?Dt.withCapacity(n.fileSize):null;for(;l=this.getInteger(e,o+4*h++),l!==0;)i=l*4096,r&&c.write(e,i,4096);if(r){n.data=new Uint8Array(Math.min(n.fileSize,c.length));const d=c.toArray();n.data.set(d.subarray(0,0+n.data.length),0)}}i+=4096}}getString(e,t,i){let a="";for(let n=0;n<i;n++){const r=e[t+n]&255;if(r===0)break;a+=String.fromCharCode(r)}return a}getInteger(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}}Lg.HeaderBcFs="BCFS";Lg.HeaderBcFz="BCFZ";class Wx extends Ko{get name(){return"Guitar Pro 6"}readScore(){E.debug(this.name,"Loading GPX filesystem");const e=new Lg;e.fileFilter=h=>h.endsWith("score.gpif")||h.endsWith("BinaryStylesheet")||h.endsWith("PartConfiguration")||h.endsWith("LayoutConfiguration"),e.load(this.data),E.debug(this.name,"GPX filesystem loaded");let t=null,i=null,a=null,n=null;for(const h of e.files)switch(h.fileName){case"score.gpif":t=x.toString(h.data,this.settings.importer.encoding);break;case"BinaryStylesheet":i=h.data;break;case"PartConfiguration":a=h.data;break;case"LayoutConfiguration":n=h.data;break}if(!t)throw new vt("No score.gpif found in GPX");E.debug(this.name,"Start Parsing score.gpif");const r=new I;r.parseXml(t,this.settings),E.debug(this.name,"score.gpif parsed");const o=r.score;i&&(E.debug(this.name,"Start Parsing BinaryStylesheet"),new ms(i).apply(o),E.debug(this.name,"BinaryStylesheet parsed"));let l=null;return a&&(E.debug(this.name,"Start Parsing Part Configuration"),l=new tk(a),l.apply(o),E.debug(this.name,"Part Configuration parsed")),n&&l!=null&&(E.debug(this.name,"Start Parsing Layout Configuration"),new ik(l,n).apply(o),E.debug(this.name,"Layout Configuration parsed")),o}}var ne;(function(s){s[s.None=0]="None",s[s.Natural=1]="Natural",s[s.Sharp=2]="Sharp",s[s.Flat=3]="Flat",s[s.NaturalQuarterNoteUp=4]="NaturalQuarterNoteUp",s[s.SharpQuarterNoteUp=5]="SharpQuarterNoteUp",s[s.FlatQuarterNoteUp=6]="FlatQuarterNoteUp",s[s.DoubleSharp=7]="DoubleSharp",s[s.DoubleFlat=8]="DoubleFlat"})(ne||(ne={}));class zx{constructor(){this.maxLine=-1e3,this.minLine=-1e3}}class ut{constructor(e){this._registeredAccidentals=new Map,this._appliedScoreLines=new Map,this._appliedScoreLinesByValue=new Map,this._notesByValue=new Map,this._beatLines=new Map,this.maxLineBeat=null,this.minLineBeat=null,this.maxLine=-1e3,this.minLine=-1e3,this._barRenderer=e,this._bar=e.bar}static getPercussionLine(e,t){var i;return t<e.staff.track.percussionArticulations.length?e.staff.track.percussionArticulations[t].staffLine:((i=At.getArticulationByInputMidiNumber(t))==null?void 0:i.staffLine)??0}static getNoteValue(e){if(e.isPercussion)return e.percussionArticulation;let t=e.displayValue;switch(e.accidentalMode){case ke.ForceDoubleFlat:t+=2;break;case ke.ForceDoubleSharp:t-=2;break;case ke.ForceFlat:t+=1;break;case ke.ForceSharp:t-=1;break}return t}applyAccidental(e){const t=ut.getNoteValue(e),i=e.hasQuarterToneOffset;return this.getAccidental(t,i,e.beat,!1,e)}applyAccidentalForValue(e,t,i,a){return this.getAccidental(t,i,e,a,null)}static computeLineWithoutAccidentals(e,t){let i=0;const a=ut.getNoteValue(t);return t.isPercussion?i=ut.getPercussionLine(e,a):i=ut.calculateNoteSteps(e.keySignature,e.clef,a),i}static computeAccidental(e,t,i,a,n=null){const o=e+7,l=i%12,h=o<7?ne.Flat:ne.Sharp,c=ut.KeySignatureLookup[o][l],d=ut.AccidentalNotes[l];let f=ne.None;if(a)switch(f=d?h:ne.Natural,f){case ne.Natural:f=ne.NaturalQuarterNoteUp;break;case ne.Sharp:f=ne.SharpQuarterNoteUp;break;case ne.Flat:f=ne.FlatQuarterNoteUp;break}else{switch(t){case ke.ForceSharp:f=ne.Sharp;break;case ke.ForceDoubleSharp:f=ne.DoubleSharp;break;case ke.ForceFlat:f=ne.Flat;break;case ke.ForceDoubleFlat:f=ne.DoubleFlat;break;default:d?f=h:c&&(f=ne.Natural);break}f!==ne.None?n!=null?n===f&&(f=ne.None):c&&f===h&&(f=ne.None):n!==null&&(n===ne.Natural?f=ne.None:f=ne.Natural)}return f}getAccidental(e,t,i,a,n=null){var h;let r=0,o=ne.None;if(n!=null?n.isPercussion:this._bar.staff.isPercussion)r=ut.getPercussionLine(this._bar,e);else{const c=n?n.accidentalMode:ke.Default;r=ut.calculateNoteSteps(this._bar.keySignature,this._bar.clef,e);const d=this._registeredAccidentals.has(r)?this._registeredAccidentals.get(r):null;o=ut.computeAccidental(this._bar.keySignature,c,e,t,d);let f=!1;switch(o){case ne.NaturalQuarterNoteUp:case ne.SharpQuarterNoteUp:case ne.FlatQuarterNoteUp:break;default:if(n&&n.isTieDestination&&n.beat.index===0){const p=(h=this._barRenderer.scoreRenderer.layout)==null?void 0:h.getRendererForBar(this._barRenderer.staff.staffId,n.tieOrigin.beat.voice.bar);p&&p.staff===this._barRenderer.staff&&p.accidentalHelper.getNoteLine(n.tieOrigin)===r&&(f=!0)}f?o=ne.None:o!==ne.None&&this._registeredAccidentals.set(r,o);break}}return n?(this._appliedScoreLines.set(n.id,r),this._notesByValue.set(e,n)):this._appliedScoreLinesByValue.set(e,r),(this.minLine===-1e3||this.minLine<r)&&(this.minLine=r,this.minLineBeat=i),(this.maxLine===-1e3||this.maxLine>r)&&(this.maxLine=r,this.maxLineBeat=i),a||this.registerLine(i,r),o}registerLine(e,t){let i;this._beatLines.has(e.id)?i=this._beatLines.get(e.id):(i=new zx,this._beatLines.set(e.id,i)),(i.minLine===-1e3||t<i.minLine)&&(i.minLine=t),(i.minLine===-1e3||t>i.maxLine)&&(i.maxLine=t)}getMaxLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).maxLine:0}getMinLine(e){return this._beatLines.has(e.id)?this._beatLines.get(e.id).minLine:0}static calculateNoteSteps(e,t,i){const a=i,n=e,r=t,o=a%12,l=(a/12|0)-1;let h=ut.OctaveSteps[r];h-=l*ut.StepsPerOctave;const c=V.keySignatureIsSharp(n)||V.keySignatureIsNatural(n)?ut.SharpNoteSteps:ut.FlatNoteSteps;return h-=c[o],h}getNoteLine(e){return this._appliedScoreLines.get(e.id)}getNoteLineForValue(e,t=!1){return this._appliedScoreLinesByValue.has(e)?this._appliedScoreLinesByValue.get(e):t&&this._notesByValue.has(e)?this.getNoteLine(this._notesByValue.get(e)):0}}ut.KeySignatureLookup=[[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0],[!0,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0],[!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!0,!0,!0,!0],[!1,!1,!1,!0,!0,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!0,!0],[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],[!1,!1,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!1,!1,!1,!1,!1],[!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!1,!1,!1],[!0,!0,!0,!0,!1,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!1],[!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0,!0]];ut.AccidentalNotes=[!1,!0,!1,!0,!1,!1,!0,!1,!0,!1,!0,!1];ut.StepsPerOctave=7;ut.OctaveSteps=[38,32,30,26,38];ut.SharpNoteSteps=[0,0,1,1,2,3,3,4,4,5,5,6];ut.FlatNoteSteps=[0,1,1,2,2,3,4,4,5,5,6,6];class Gx{constructor(){this.currentDynamics=j.F,this.slideOrigins=new Map,this.transpose=0,this.isExplicitlyBeamed=!1,this.tieStarts=new Set,this.tieStartIds=new Map,this.slideOrigins=new Map,this.slurStarts=new Map}}class Ux extends U{constructor(){super(...arguments),this.outputMidiChannel=-1,this.outputMidiProgram=-1,this.outputVolume=-1,this.outputBalance=-1}}class td{constructor(e){this.instruments=new Map,this._instrumentIdToArticulationIndex=new Map,this._lyricsLine=0,this._lyricsLines=new Map,this.track=e}getLyricLine(e){if(this._lyricsLines.has(e))return this._lyricsLines.get(e);const t=this._lyricsLine;return this._lyricsLines.set(e,t),this._lyricsLine++,t}getOrCreateArticulation(e,t){const i=t.octave*12+t.tone,a=`${e}_${i}`;if(this._instrumentIdToArticulationIndex.has(a))return this._instrumentIdToArticulationIndex.get(a);let n;this.instruments.has(e)?n=this.instruments.get(e):n=td.defaultNoteArticulation;const r=this.track.percussionArticulations.length,o=t.beat.voice.bar;let l;i===0?l=4:l=ut.calculateNoteSteps(o.keySignature,o.clef,i);const h=t.beat.voice.bar.staff.standardNotationLineCount*2-1,d=5*2-1-h,f=l-d,p=new U(n.elementType,f,n.outputMidiNumber,n.noteHeadDefault,n.noteHeadHalf,n.noteHeadWhole,n.techniqueSymbol,n.techniqueSymbolPlacement);return this._instrumentIdToArticulationIndex.set(a,r),this.track.percussionArticulations.push(p),r}}td.defaultNoteArticulation=new U("Default",0,0,u.NoteheadBlack,u.NoteheadHalf,u.NoteheadWhole);class Ge extends Ko{constructor(){super(...arguments),this._idToTrackInfo=new Map,this._indexToTrackInfo=new Map,this._staffToContext=new Map,this._divisionsPerQuarterNote=1,this._currentDynamics=j.F,this._musicalPosition=0,this._lastBeat=null,this._nextMasterBarRepeatEnding=0,this._nextBeatAutomations=null,this._nextBeatChord=null,this._nextBeatCrescendo=null,this._nextBeatLetRing=!1,this._nextBeatPalmMute=!1,this._nextBeatOttavia=null,this._nextBeatText=null,this._simileMarkAllStaves=null,this._simileMarkPerStaff=null,this._isBeatSlash=!1,this._keyAllStaves=null,this._currentTrillStep=-1}get name(){return"MusicXML"}readScore(){const e=this.extractMusicXml(),t=new oh;try{t.parse(e)}catch(i){throw new vt("Unsupported format",i)}return this._score=new fn,this._score.tempo=120,this._score.stylesheet.hideDynamics=!0,this.parseDom(t),V.consolidate(this._score),this._score.finish(this.settings),this._score.rebuildRepeatGroups(),this._score}extractMusicXml(){const e=new Pg(this.data);let t;try{t=e.read()}catch{t=[]}if(t.length===0)return this.data.reset(),x.toString(this.data.readAll(),this.settings.importer.encoding);const i=t.find(h=>h.fullName==="META-INF/container.xml");if(!i)throw new vt("No compressed MusicXML");const a=new oh;try{a.parse(x.toString(i.data,this.settings.importer.encoding))}catch(h){throw new vt("Malformed container.xml, could not parse as XML",h)}const n=a.firstElement;if(!n||n.localName!=="container")throw new vt("Malformed container.xml, root element not 'container'");const r=n.findChildElement("rootfiles");if(!r)throw new vt("Malformed container.xml, 'container/rootfiles' not found");let o="";for(const h of r.childElements())if(h.localName==="rootfile"){o=h.getAttribute("full-path");break}if(!o)throw new vt("Unsupported compressed MusicXML, missing rootfile");const l=t.find(h=>h.fullName===o);if(!l)throw new vt(`Malformed container.xml, '${o}' not contained in zip`);return x.toString(l.data,this.settings.importer.encoding)}parseDom(e){const t=e.firstElement;if(!t)throw new vt("Unsupported format");switch(t.localName){case"score-partwise":this.parsePartwise(t);break;case"score-timewise":this.parseTimewise(t);break;default:throw new vt("Unsupported format")}}parsePartwise(e){for(const t of e.childElements())switch(t.localName){case"credit":this.parseCredit(t);break;case"identification":this.parseIdentification(t);break;case"movement-title":this.parseMovementTitle(t);break;case"part":this.parsePartwisePart(t);break;case"part-list":this.parsePartList(t);break;case"work":this.parseWork(t);break}}parseTimewise(e){let t=0;for(const i of e.childElements())switch(i.localName){case"credit":this.parseCredit(i);break;case"identification":this.parseIdentification(i);break;case"movement-title":this.parseMovementTitle(i);break;case"part-list":this.parsePartList(i);break;case"work":this.parseWork(i);break;case"measure":this.parseTimewiseMeasure(i,t),t++;break}}parseCredit(e){if(e.getAttribute("page","1")!=="1")return;const t=[];let i=null,a="";for(const n of e.childElements())switch(n.localName){case"credit-type":t.push(n.innerText);break;case"credit-words":i===null&&(i=n),a+=n.innerText;break}if(t.length>0)for(const n of t)switch(n){case"title":this._score.title=Ge.sanitizeDisplay(a);break;case"subtitle":this._score.subTitle=Ge.sanitizeDisplay(a);break;case"composer":this._score.artist=Ge.sanitizeDisplay(a);break;case"arranger":this._score.artist=Ge.sanitizeDisplay(a);break;case"lyricist":this._score.words=Ge.sanitizeDisplay(a);break;case"rights":this._score.copyright=Ge.sanitizeDisplay(a);break}else if(i){const n=i.getAttribute("font-size","0"),r=i.getAttribute("font-size","top"),o=i.getAttribute("halign","left");if(r==="top"){if(a.includes("copyright")||a.includes("Copyright")||a.includes("")||a.includes("(c)")||a.includes("(C)")){this._score.copyright=Ge.sanitizeDisplay(a);return}if(o==="center"||n==="center"){if(this._score.title.length===0){this._score.title=Ge.sanitizeDisplay(a);return}if(this._score.subTitle.length===0){this._score.subTitle=Ge.sanitizeDisplay(a);return}if(this._score.album.length===0){this._score.album=Ge.sanitizeDisplay(a);return}}else if((o==="right"||n==="right")&&this._score.music.length===0){this._score.music=Ge.sanitizeDisplay(a);return}if(this._score.artist.length===0){this._score.artist=Ge.sanitizeDisplay(a);return}if(this._score.words.length===0){this._score.words=Ge.sanitizeDisplay(a);return}}}}static sanitizeDisplay(e){return e.replaceAll("\r","").replaceAll(`
`," ").replaceAll("	","").replaceAll(" ","")}parseIdentification(e){for(const t of e.childElements())switch(t.localName){case"creator":if(t.attributes.has("type"))switch(t.attributes.get("type")){case"composer":this._score.artist=Ge.sanitizeDisplay(t.innerText);break;case"lyricist":this._score.words=Ge.sanitizeDisplay(t.innerText);break;case"arranger":this._score.music=Ge.sanitizeDisplay(t.innerText);break}else this._score.artist=Ge.sanitizeDisplay(t.innerText);break;case"rights":this._score.copyright.length>0&&(this._score.copyright+=", "),this._score.copyright+=t.innerText,t.attributes.has("type")&&(this._score.copyright+=` (${t.attributes.get("type")})`);break;case"encoding":this.parseEncoding(t);break}}parseEncoding(e){for(const t of e.childElements())switch(t.localName){case"encoder":this._score.tab.length>0&&(this._score.tab+=", "),this._score.tab+=t.innerText,t.attributes.has("type")&&(this._score.tab+=` (${t.attributes.get("type")})`);break;case"encoding-description":this._score.notices+=Ge.sanitizeDisplay(t.innerText);break}}parseMovementTitle(e){this._score.title.length===0?this._score.title=Ge.sanitizeDisplay(e.innerText):this._score.subTitle=Ge.sanitizeDisplay(e.innerText)}parsePartList(e){for(const t of e.childElements())switch(t.localName){case"score-part":this.parseScorePart(t);break}}parseScorePart(e){const t=new Ea;t.ensureStaveCount(1),this._score.addTrack(t);const i=e.attributes.get("id"),a=new td(t);this._idToTrackInfo.set(i,a),this._indexToTrackInfo.set(t.index,a);for(const n of e.childElements())switch(n.localName){case"part-name":t.name=Ge.sanitizeDisplay(n.innerText);break;case"part-name-display":t.name=this.parsePartDisplayAsText(n);break;case"part-abbreviation":t.shortName=Ge.sanitizeDisplay(n.innerText);break;case"part-abbreviation-display":t.shortName=this.parsePartDisplayAsText(n);break;case"score-instrument":this.parseScoreInstrument(n,a);break;case"midi-device":n.attributes.has("port")&&(t.playbackInfo.port=Number.parseInt(n.attributes.get("port"),10));break;case"midi-instrument":this.parseScorePartMidiInstrument(n,a);break}a.firstArticulation&&(a.firstArticulation.outputMidiProgram>=0&&(t.playbackInfo.program=a.firstArticulation.outputMidiProgram),a.firstArticulation.outputBalance>=0&&(t.playbackInfo.balance=a.firstArticulation.outputBalance),a.firstArticulation.outputVolume>=0&&(t.playbackInfo.volume=a.firstArticulation.outputVolume),a.firstArticulation.outputMidiChannel>=0&&(t.playbackInfo.primaryChannel=a.firstArticulation.outputMidiChannel,t.playbackInfo.secondaryChannel=a.firstArticulation.outputMidiChannel))}parseScoreInstrument(e,t){const i=new Ux;t.firstArticulation||(t.firstArticulation=i),t.instruments.set(e.getAttribute("id",""),i)}parseScorePartMidiInstrument(e,t){const i=e.getAttribute("id","");if(!t.instruments.has(i))return;const a=t.instruments.get(i);for(const n of e.childElements())switch(n.localName){case"midi-channel":a.outputMidiChannel=Number.parseInt(n.innerText)-1;break;case"midi-program":a.outputMidiProgram=Number.parseInt(n.innerText)-1;break;case"midi-unpitched":a.outputMidiNumber=Number.parseInt(n.innerText)-1;break;case"volume":a.outputVolume=Ge.interpolatePercent(Number.parseFloat(n.innerText));break;case"pan":a.outputBalance=Ge.interpolatePan(Number.parseFloat(n.innerText));break}}static interpolatePercent(e){return Ge.interpolate(0,100,0,16,e)|0}static interpolatePan(e){return Ge.interpolate(-90,90,0,16,e)|0}static interpolate(e,t,i,a,n){const r=(n-e)/(t-e);return i+(a-i)*r}parsePartDisplayAsText(e){let t="";for(const i of e.childElements())switch(i.localName){case"display-text":t+=i.innerText;break;case"accidental-text":switch(i.innerText){case"sharp":t+="";break;case"natural":t+="";break;case"flat":t+="";break;case"double-sharp":t+="";break;case"sharp-sharp":t+="";break;case"flat-flat":t+="";break;case"natural-sharp":t+="";break;case"natural-flat":t+="";break;case"sharp-down":t+="";break;case"sharp-up":t+="";break;case"natural-down":t+="";break;case"natural-up":t+="";break;case"flat-down":t+="";break;case"flat-up":t+="";break;case"arrow-down":t+="";break;case"arrow-up":t+="";break;case"triple-sharp":t+="";break;case"triple-flat":t+="";break;case"sharp-1":t+="";break;case"sharp-2":t+="";break;case"sharp-3":t+="";break;case"sharp-4":t+="";break;case"sharp-5":t+="";break;case"flat-1":t+="";break;case"flat-2":t+="";break;case"flat-3":t+="";break;case"flat-4":t+="";break;case"flat-5":t+="";break}break}return Ge.sanitizeDisplay(t)}parseWork(e){for(const t of e.childElements())switch(t.localName){case"work-title":this._score.title=Ge.sanitizeDisplay(t.innerText);break}}parsePartwisePart(e){const t=e.attributes.get("id");if(!t||!this._idToTrackInfo.has(t))return;const i=this._idToTrackInfo.get(t).track;let a=0;for(const n of e.childElements())switch(n.localName){case"measure":this.parsePartwiseMeasure(n,i,a),a++;break}}parsePartwiseMeasure(e,t,i){const a=this.getOrCreateMasterBar(e,i);this.parsePartMeasure(e,a,t)}parseTimewiseMeasure(e,t){const i=this.getOrCreateMasterBar(e,t);for(const a of e.childElements())switch(a.localName){case"part":this.parseTimewisePart(a,i);break}}getOrCreateMasterBar(e,t){const i=e.attributes.get("implicit")==="yes";for(;this._score.masterBars.length<=t;){const n=new Ca;i&&(n.isAnacrusis=!0),this._score.addMasterBar(n),n.index>0&&(n.timeSignatureDenominator=n.previousMasterBar.timeSignatureDenominator,n.timeSignatureNumerator=n.previousMasterBar.timeSignatureNumerator,n.tripletFeel=n.previousMasterBar.tripletFeel)}return this._score.masterBars[t]}parseTimewisePart(e,t){const i=e.attributes.get("id");if(!i||!this._idToTrackInfo.has(i))return;const a=this._idToTrackInfo.get(i).track;this.parsePartMeasure(e,t,a)}parsePartMeasure(e,t,i){this._musicalPosition=0,this._lastBeat=null,t.alternateEndings=this._nextMasterBarRepeatEnding;const a=[];for(const r of e.childElements())switch(r.localName){case"note":this.parseNote(r,t,i);break;case"backup":this.parseBackup(r);break;case"forward":this.parseForward(r);break;case"direction":this.parseDirection(r,t,i);break;case"attributes":this.parseAttributes(r,t,i);break;case"harmony":this.parseHarmony(r,i);break;case"print":this.parsePrint(r,t,i);break;case"sound":this.parseSound(r,t,i);break;case"barline":a.push(r);break}for(const r of a)this.parseBarLine(r,t,i);this.applySimileMarks(t,i);const n=this.getOrCreateStaff(i,0);this.getOrCreateBar(n,t),this._keyAllStaves=null}parsePrint(e,t,i){(e.getAttribute("new-system","no")==="yes"||e.getAttribute("new-page","no")==="yes")&&i.addLineBreaks(t.index)}applySimileMarks(e,t){if(this._simileMarkAllStaves!==null){for(const i of t.staves){const a=this.getOrCreateBar(i,e);a.simileMark=this._simileMarkAllStaves,a.simileMark!==St.None&&this.clearBar(a)}this._simileMarkAllStaves===St.FirstOfDouble?this._simileMarkAllStaves=St.SecondOfDouble:this._simileMarkAllStaves=null}if(this._simileMarkPerStaff!==null){const i=Array.from(this._simileMarkPerStaff.keys());for(const a of i){const n=this.getOrCreateStaff(t,a),r=this.getOrCreateBar(n,e);r.simileMark=this._simileMarkPerStaff.get(a),r.simileMark!==St.None&&this.clearBar(r),r.simileMark===St.FirstOfDouble?this._simileMarkPerStaff.set(a,St.SecondOfDouble):this._simileMarkPerStaff.delete(a)}this._simileMarkPerStaff.size===0&&(this._simileMarkPerStaff=null)}}clearBar(e){for(const t of e.voices){const i=new Wt;i.isEmpty=!0,t.addBeat(i)}}parseBarLine(e,t,i){for(const a of e.childElements())switch(a.localName){case"bar-style":this.parseBarStyle(a,t,i,e.getAttribute("location","right"));break;case"ending":this.parseEnding(a,t);break;case"repeat":this.parseRepeat(a,t);break}}parseRepeat(e,t){const i=e.getAttribute("direction");let a=Number.parseInt(e.getAttribute("times"));(a<0||Number.isNaN(a))&&(a=2),i==="backward"?t.repeatCount=a:i==="forward"&&(t.isRepeatStart=!0)}parseEnding(e,t){const i=e.getAttribute("number").split(",").map(n=>Number.parseInt(n));let a=0;for(const n of i)a=a|1<<n-1&255;switch(t.alternateEndings=a,e.getAttribute("type","")){case"start":this._nextMasterBarRepeatEnding=this._nextMasterBarRepeatEnding|a;break;case"stop":case"discontinue":this._nextMasterBarRepeatEnding=this._nextMasterBarRepeatEnding&~a;break}}parseBarStyle(e,t,i,a){let n=oe.Automatic;switch(e.innerText){case"dashed":n=oe.Dashed;break;case"dotted":n=oe.Dotted;break;case"heavy":n=oe.Heavy;break;case"heavy-heavy":n=oe.HeavyHeavy;break;case"heavy-light":n=oe.HeavyLight;break;case"light-heavy":n=oe.LightHeavy;break;case"light-light":n=oe.LightLight;break;case"none":n=oe.None;break;case"regular":n=oe.Regular;break;case"short":n=oe.Short;break;case"tick":n=oe.Tick;break}for(const r of i.staves){const o=this.getOrCreateBar(r,t);switch(a){case"left":o.barLineLeft=n;break;case"right":o.barLineRight=n;break}}}parseSound(e,t,i){for(const a of e.childElements())switch(a.localName){case"midi-instrument":this.parseSoundMidiInstrument(a,t);break;case"swing":this.parseSwing(a,t);break}if(e.attributes.has("coda")&&t.addDirection(R.TargetCoda),e.attributes.has("tocoda")&&t.addDirection(R.JumpDaCoda),e.attributes.has("dacapo")&&t.addDirection(R.JumpDaCapo),e.attributes.has("dalsegno")&&t.addDirection(R.JumpDalSegno),e.attributes.has("fine")&&t.addDirection(R.TargetFine),e.attributes.has("segno")&&t.addDirection(R.TargetSegno),e.attributes.has("pan")){this._nextBeatAutomations||(this._nextBeatAutomations=[]);const a=new wt;a.type=tt.Balance,a.value=Ge.interpolatePan(Number.parseFloat(e.attributes.get("pan"))),this._nextBeatAutomations.push(a)}if(e.attributes.has("tempo")){this._nextBeatAutomations||(this._nextBeatAutomations=[]);const a=new wt;a.type=tt.Tempo,a.value=Ge.interpolatePercent(Number.parseFloat(e.attributes.get("tempo"))),this._nextBeatAutomations.push(a)}}parseSwing(e,t){let i=0,a=0,n=null;for(const r of e.childElements())switch(r.localName){case"straight":t.tripletFeel=me.NoTripletFeel;return;case"first":i=Number.parseInt(r.innerText);break;case"second":a=Number.parseInt(r.innerText);break;case"swing-type":n=this.parseBeatDuration(r);break}n||(n=w.Eighth),n===w.Eighth?i===2&&a===1?t.tripletFeel=me.Triplet8th:i===3&&a===1?t.tripletFeel=me.Dotted8th:i===1&&a===3&&(t.tripletFeel=me.Scottish8th):n===w.Sixteenth&&(i===2&&a===1?t.tripletFeel=me.Triplet16th:i===3&&a===1?t.tripletFeel=me.Dotted16th:i===1&&a===3&&(t.tripletFeel=me.Scottish16th))}parseSoundMidiInstrument(e,t){let i;for(const a of e.childElements())switch(a.localName){case"midi-program":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new wt,i.type=tt.Instrument,i.value=Number.parseInt(a.innerText)-1,this._nextBeatAutomations.push(i);break;case"volume":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new wt,i.type=tt.Volume,i.value=Ge.interpolatePercent(Number.parseFloat(a.innerText)),this._nextBeatAutomations.push(i);break;case"pan":this._nextBeatAutomations||(this._nextBeatAutomations=[]),i=new wt,i.type=tt.Balance,i.value=Ge.interpolatePan(Number.parseFloat(a.innerText)),this._nextBeatAutomations.push(i);break}}parseHarmony(e,t){const i=new er;let a=!1,n="";for(const r of e.childElements())switch(r.localName){case"root":i.name=this.parseHarmonyRoot(r);break;case"kind":i.name=i.name+this.parseHarmonyKind(r),r.getAttribute("parentheses-degrees","no")==="yes"&&(a=!0);break;case"frame":this.parseHarmonyFrame(r,i);break;case"degree":n+=this.parseDegree(r);break}n&&(i.name+=a?`(${n})`:n),this._nextBeatChord===null&&(this._nextBeatChord=i)}parseDegree(e){let t="",i="",a="";for(const n of e.childElements())switch(n.localName){case"degree-value":t=n.innerText;break;case"degree-alter":switch(n.innerText){case"-1":i="";break;case"1":i="";break}break;case"degree-type":a+=n.getAttribute("text","");break}return`${a}${i}${t}`}parseHarmonyRoot(e){let t="",i="";for(const a of e.childElements())switch(a.localName){case"root-step":t=a.innerText;break;case"root-alter":switch(Number.parseFloat(a.innerText)){case-2:i="bb";break;case-1:i="b";break;case 0:i="";break;case 1:i="#";break;case 2:i="##";break}break}return t+i}parseHarmonyKind(e){const t=e.getAttribute("text");let i="";if(t)i=t;else{const a=e.innerText;switch(a){case"major":i="";break;case"minor":i="m";break;case"augmented":i="+";break;case"diminished":i="";break;case"dominant":i="7";break;case"major-seventh":i="7M";break;case"minor-seventh":i="m7";break;case"diminished-seventh":i="7";break;case"augmented-seventh":i="+7";break;case"half-diminished":i="";break;case"major-minor":i="mMaj";break;case"major-sixth":i="maj6";break;case"minor-sixth":i="m6";break;case"dominant-ninth":i="9";break;case"major-ninth":i="maj9";break;case"minor-ninth":i="m9";break;case"dominant-11th":i="11";break;case"major-11th":i="maj11";break;case"minor-11th":i="m11";break;case"dominant-13th":i="13";break;case"major-13th":i="maj13";break;case"minor-13th":i="m13";break;case"suspended-second":i="sus2";break;case"suspended-fourth":i="sus4";break;case"Neapolitan":i="II";break;case"Italian":i="It";break;case"French":i="Fr";break;case"German":i="Fr";break;default:i=a;break}}return i}parseHarmonyFrame(e,t){for(const i of e.childElements())switch(i.localName){case"frame-strings":const a=Number.parseInt(i.innerText);t.strings=new Array(a);for(let o=0;o<a;o++)t.strings[o]=-1;break;case"first-fret":t.firstFret=Number.parseInt(i.innerText);break;case"frame-note":let n=null,r=null;for(const o of i.childElements())switch(o.localName){case"string":n=Number.parseInt(o.innerText);break;case"fret":r=Number.parseInt(o.innerText),n&&r>=0&&(t.strings[n-1]=r);break;case"barre":n&&r&&o.getAttribute("type")==="start"&&t.barreFrets.push(r);break}break}}parseAttributes(e,t,i){let a,n,r;if(this._lastBeat==null)for(const o of e.childElements())switch(o.localName){case"divisions":this._divisionsPerQuarterNote=Number.parseFloat(o.innerText);break;case"key":this.parseKey(o,t,i);break;case"time":this.parseTime(o,t);break;case"staves":i.ensureStaveCount(Number.parseInt(o.innerText));break;case"clef":a=Number.parseInt(o.getAttribute("number","1"))-1,n=this.getOrCreateStaff(i,a),r=this.getOrCreateBar(n,t),this.parseClef(o,r);break;case"staff-details":a=Number.parseInt(o.getAttribute("number","1"))-1,n=this.getOrCreateStaff(i,a),this.parseStaffDetails(o,n);break;case"transpose":this.parseTranspose(o,i);break;case"measure-style":this.parseMeasureStyle(o,i,!1);break}else for(const o of e.childElements())switch(o.localName){case"divisions":this._divisionsPerQuarterNote=Number.parseFloat(o.innerText);break;case"measure-style":this.parseMeasureStyle(o,i,!0);break}}parseMeasureStyle(e,t,i){for(const a of e.childElements())switch(a.localName){case"measure-repeat":if(!i){let n=null;switch(a.getAttribute("type")){case"start":switch(Number.parseInt(a.getAttribute("slashes","1"))){case 1:n=St.Simple;break;case 2:n=St.FirstOfDouble;break}break;case"stop":n=null;break}if(e.attributes.has("number")){this._simileMarkPerStaff=this._simileMarkPerStaff??new Map;const r=Number.parseInt(e.attributes.get("number"))-1;n==null?this._simileMarkPerStaff.delete(r):this._simileMarkPerStaff.set(r,n)}else this._simileMarkAllStaves=n}break;case"slash":switch(a.getAttribute("type")){case"start":this._isBeatSlash=!0;break;case"stop":this._isBeatSlash=!1;break}break}}parseTranspose(e,t){let i=0;for(const a of e.childElements())switch(a.localName){case"chromatic":i+=Number.parseFloat(a.innerText);break;case"octave-change":i+=Number.parseFloat(a.innerText)*12;break}if(e.attributes.has("number")){const a=this.getOrCreateStaff(t,Number.parseInt(e.attributes.get("number"))-1);this.getStaffContext(a).transpose=i,a.displayTranspositionPitch=i}else for(const a of t.staves)this.getStaffContext(a).transpose=i,a.displayTranspositionPitch=i}parseStaffDetails(e,t){for(const i of e.childElements())switch(i.localName){case"staff-lines":t.standardNotationLineCount=Number.parseInt(i.innerText);break;case"staff-tuning":this.parseStaffTuning(i,t);break;case"capo":t.capo=Number.parseInt(i.innerText);break}}parseStaffTuning(e,t){t.stringTuning.tunings.length===0&&(t.showTablature=!0,t.showStandardNotation=!1,t.stringTuning.tunings=new Array(t.standardNotationLineCount).fill(0));const i=Number.parseInt(e.getAttribute("line"));let a="C",n="",r=0;for(const l of e.childElements())switch(l.localName){case"tuning-step":a=l.innerText;break;case"tuning-alter":r=Number.parseFloat(l.innerText);break;case"tuning-octave":n=l.innerText;break}const o=V.getTuningForText(a+n)+r;t.tuning[t.tuning.length-i]=o}parseClef(e,t){let i="s",a=0;for(const n of e.childElements())switch(n.localName){case"sign":i=n.innerText.toLowerCase();break;case"line":a=Number.parseInt(n.innerText);break;case"clef-octave-change":switch(Number.parseInt(n.innerText)){case-2:t.clefOttava=fe._15mb;break;case-1:t.clefOttava=fe._8vb;break;case 1:t.clefOttava=fe._8va;break;case 2:t.clefOttava=fe._15mb;break}break}switch(i){case"g":t.clef=xe.G2;break;case"f":t.clef=xe.F4;break;case"c":a===3?t.clef=xe.C3:t.clef=xe.C4;break;case"percussion":t.clef=xe.Neutral,t.staff.isPercussion=!0;break;case"tab":t.clef=xe.G2,t.staff.showTablature=!0;break;default:t.clef=xe.G2;break}}parseTime(e,t){let i=!1,a=!1;for(const n of e.childElements()){const r=n.innerText;switch(n.localName){case"beats":i||(r.indexOf("+")===-1?t.timeSignatureNumerator=Number.parseInt(r):t.timeSignatureNumerator=r.split("+").map(o=>Number.parseInt(o)).reduce((o,l)=>l+o,0),i=!0);break;case"beat-type":a||(r.indexOf("+")===-1?t.timeSignatureDenominator=Number.parseInt(r):t.timeSignatureDenominator=r.split("+").map(o=>Number.parseInt(o)).reduce((o,l)=>l+o,0),a=!0);break}}switch(e.getAttribute("symbol","")){case"common":case"cut":t.timeSignatureCommon=!0;break}}parseKey(e,t,i){let a=-_e.C,n="";for(const l of e.childElements())switch(l.localName){case"fifths":a=Number.parseInt(l.innerText);break;case"mode":n=l.innerText;break}let r;-7<=a&&a<=7?r=a:r=_e.C;let o;if(n==="minor"?o=Mi.Minor:o=Mi.Major,e.attributes.has("number")){const l=this.getOrCreateStaff(i,Number.parseInt(e.attributes.get("number"))-1),h=this.getOrCreateBar(l,t);h.keySignature=r,h.keySignatureType=o}else{this._keyAllStaves=[r,o];for(const l of i.staves)l.bars.length>t.index&&(l.bars[t.index].keySignature=r,l.bars[t.index].keySignatureType=o)}}parseDirection(e,t,i){const a=[];let n=null,r=-1,o=-1;for(const f of e.childElements())switch(f.localName){case"direction-type":const p=f.firstElement;p&&a.push(p);break;case"offset":n=Number.parseFloat(f.innerText);break;case"voice":break;case"staff":r=Number.parseInt(f.innerText)-1;break;case"sound":f.attributes.has("tempo")&&(o=Number.parseFloat(f.attributes.get("tempo")));break}let l=null;r>=0?l=this.getOrCreateStaff(i,r):this._lastBeat!==null?l=this._lastBeat.voice.bar.staff:l=this.getOrCreateStaff(i,0);const h=l?this.getOrCreateBar(l,t):null,c=()=>{let f=this._musicalPosition;n!==null&&(f+=n);const p=t.calculateDuration(!1);return f/p};if(o>0){const f=new wt;f.type=tt.Tempo,f.value=o,f.ratioPosition=c(),this.hasSameTempo(t,f)||(t.tempoAutomations.push(f),t.index===0&&(t.score.tempo=f.value))}let d="";for(const f of a)switch(f.localName){case"rehearsal":t.section=new Mh,t.section.marker=f.innerText;break;case"segno":t.addDirection(R.TargetSegno);break;case"coda":t.addDirection(R.TargetCoda);break;case"words":d=f.innerText;break;case"wedge":switch(f.getAttribute("type")){case"crescendo":this._nextBeatCrescendo=vi.Crescendo;break;case"diminuendo":this._nextBeatCrescendo=vi.Decrescendo;break;case"stop":this._nextBeatCrescendo=null;break}break;case"dynamics":const p=this.parseDynamics(f);p!==null&&(this._currentDynamics=p,this._score.stylesheet.hideDynamics=!1);break;case"dashes":const g=f.getAttribute("type","start");switch(d){case"LetRing":this._nextBeatLetRing=g==="start"||g==="continue";break;case"P.M.":this._nextBeatPalmMute=g==="start"||g==="continue";break}d="";break;case"pedal":const m=this.parsePedal(f);if(m&&h){m.ratioPosition=c();const T=h.sustainPedals.length>0&&h.sustainPedals[h.sustainPedals.length-1].pedalType!==Et.Up;(m.pedalType!==Et.Up||T)&&h.sustainPedals.push(m)}break;case"metronome":this.parseMetronome(f,t,c());break;case"octave-shift":this._nextBeatOttavia=this.parseOctaveShift(f);break}d&&(this._nextBeatText=d)}parseOctaveShift(e){const t=e.getAttribute("type");switch(Number.parseInt(e.getAttribute("size","8"))){case 15:switch(t){case"up":return fe._15mb;case"down":return fe._15ma;case"stop":return fe.Regular;case"continue":return this._nextBeatOttavia}break;case 8:switch(t){case"up":return fe._8vb;case"down":return fe._8va;case"stop":return fe.Regular;case"continue":return this._nextBeatOttavia}break}return null}parseMetronome(e,t,i){let a=null,n=-1;for(const r of e.childElements())switch(r.localName){case"beat-unit":a=this.parseBeatDuration(r);break;case"per-minute":n=Number.parseFloat(r.innerText);break}if(a!==null&&n>0){const r=new wt;r.type=tt.Tempo,r.value=n*(a/4)|0,r.ratioPosition=i,this.hasSameTempo(t,r)||(t.tempoAutomations.push(r),t.index===0&&(t.score.tempo=r.value))}}hasSameTempo(e,t){for(const i of e.tempoAutomations)if(t.ratioPosition===i.ratioPosition&&t.value===i.value)return!0;return!1}parsePedal(e){const t=new xr;switch(e.getAttribute("type")){case"start":t.pedalType=Et.Down;break;case"stop":t.pedalType=Et.Up;break;case"continue":t.pedalType=Et.Hold;break;default:return null}return t}parseDynamics(e){for(const t of e.childElements()){const i=t.localName.toUpperCase();switch(i){case"PPP":case"PP":case"P":case"MP":case"MF":case"F":case"FF":case"FFF":case"PPPP":case"PPPPP":case"PPPPPP":case"FFFF":case"FFFFF":case"FFFFFF":case"SF":case"SFP":case"SFPP":case"FP":case"RF":case"RFZ":case"SFZ":case"SFFZ":case"FZ":case"N":case"PF":case"SFZP":return j[i]}}return null}parseForward(e){for(const t of e.childElements())switch(t.localName){case"duration":this._musicalPosition+=this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(t.innerText));break}}parseBackup(e){for(const t of e.childElements())switch(t.localName){case"duration":if(this._lastBeat){let a=this._musicalPosition;a-=this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(t.innerText)),a<0&&(a=0),this._musicalPosition=a}break}}getOrCreateStaff(e,t){for(;e.staves.length<=t;){const i=new $o;e.addStaff(i),this._score.masterBars.length>0&&this.getOrCreateBar(i,this._score.masterBars[this._score.masterBars.length-1])}return e.staves[t]}getOrCreateBar(e,t){const i=e.bars.length===0?1:e.bars[0].voices.length;for(;e.bars.length<=t.index;){const a=new qi;e.addBar(a),a.previousBar&&(a.clef=a.previousBar.clef,a.clefOttava=a.previousBar.clefOttava,a.keySignature=a.previousBar.keySignature,a.keySignatureType=a.previousBar.keySignatureType),this._keyAllStaves!=null&&(a.keySignature=this._keyAllStaves[0],a.keySignatureType=this._keyAllStaves[1]);for(let n=0;n<i;n++){const r=new Bs;a.addVoice(r)}}return e.bars[t.index]}getOrCreateVoice(e,t){let i=!1;for(;e.voices.length<=t;)e.addVoice(new Bs),i=!0;if(i)for(const a of e.staff.bars)for(;a.voices.length<=t;)a.addVoice(new Bs);return e.voices[t]}parseNote(e,t,i){let a=null,n=se.None,r=0,o=null,l=!1,h=0,c=0,d=-1,f=null,p=0,g=-1,m=-1,T=null,S=null,y=!1,b=null;const B=e.getAttribute("print-object","yes")!=="no",N=()=>{if(a!==null)return;l&&!this._lastBeat&&(E.warning("MusicXML","Malformed MusicXML, <chord /> cannot be set on the first note of a measure"),l=!1),l&&!S&&(E.warning("MusicXML","Cannot mix <chord /> and <rest />"),l=!1);const L=this.getOrCreateStaff(i,h);if(l){a=this._lastBeat,a.addNote(S);return}const _=this.getOrCreateBar(L,t),A=this.getOrCreateVoice(_,c),J=A.beats.length===0?0:A.beats[A.beats.length-1].displayEnd;let G=this._musicalPosition-J;if(G>0){if(this._lastBeat&&this._lastBeat.beamingMode===it.ForceMergeWithNext&&this._lastBeat.voice.bar.staff.index!==h&&A.beats.length>0&&A.beats[A.beats.length-1].beamingMode===it.ForceMergeWithNext){const K=A.beats[A.beats.length-1].duration;for(;G>0;){const Se=this.createRestForGap(G,K);if(Se!==null)this.insertBeatToVoice(Se,A),G-=Se.playbackDuration;else break}}if(G>0){const K=new Wt;K.dynamics=this._currentDynamics,K.isEmpty=!0,K.duration=w.TwoHundredFiftySixth,K.overrideDisplayDuration=G,K.updateDurations(),this.insertBeatToVoice(K,A)}}else G<0&&E.error("MusicXML","Unsupported forward/backup detected. Cannot fill new beats into already filled area of voice");d<0&&f!==null&&(d=v.toTicks(f),p>0&&(d=v.applyDot(d,p===2)));const ee=new Wt;a=ee,o===null?ee.beamingMode=this.getStaffContext(L).isExplicitlyBeamed?it.ForceSplitToNext:it.Auto:(ee.beamingMode=o,this.getStaffContext(L).isExplicitlyBeamed=!0),ee.isEmpty=!1,ee.dynamics=this._currentDynamics,this._isBeatSlash&&(ee.slashed=!0);const Ce=this._nextBeatAutomations;if(this._nextBeatAutomations=null,Ce!==null)for(const K of Ce)ee.automations.push(K);const at=this._nextBeatChord;this._nextBeatChord=null,at!==null&&(ee.chordId=at.uniqueId,A.bar.staff.hasChord(at.uniqueId)||A.bar.staff.addChord(ee.chordId,at));const ht=this._nextBeatCrescendo;ht!==null&&(ee.crescendo=ht);const Qi=this._nextBeatOttavia;if(Qi!==null&&(ee.ottava=Qi),ee.isLetRing=this._nextBeatLetRing,ee.isPalmMute=this._nextBeatPalmMute,this._nextBeatText&&(ee.text=this._nextBeatText,this._nextBeatText=null),S!==null&&ee.addNote(S),this.insertBeatToVoice(ee,A),S!==null){S.isVisible=B;const K=this._indexToTrackInfo.get(i.index);b!==null?S.percussionArticulation=K.getOrCreateArticulation(b,S):y||(S.percussionArticulation=K.getOrCreateArticulation("",S))}n!==se.None?(ee.graceType=n,this.applyBeatDurationFromTicks(ee,r,null,!1)):(ee.tupletNumerator=g,ee.tupletDenominator=m,ee.dots=p,ee.preferredBeamDirection=T,this.applyBeatDurationFromTicks(ee,d,f,!0)),this._musicalPosition=ee.displayEnd,this._lastBeat=ee};for(const L of e.childElements())switch(L.localName){case"grace":const _=Number.parseFloat(L.getAttribute("make-time","-1"));_>=0?(r=this.musicXmlDivisionsToAlphaTabTicks(_),n=se.BeforeBeat):n=se.OnBeat,L.getAttribute("slash")==="yes"&&(n=se.BeforeBeat);break;case"chord":l=!0;break;case"cue":return;case"pitch":S=this.parsePitch(L),y=!0;break;case"unpitched":S=this.parseUnpitched(L,i);break;case"rest":S=null,f===null&&(f=w.Whole);break;case"duration":d=this.parseDuration(L);break;case"instrument":b=L.getAttribute("id","");break;case"voice":c=Number.parseInt(L.innerText),Number.isNaN(c)?(E.warning("MusicXML","Voices need to be specified as numbers"),c=0):c=c-1;break;case"type":f=this.parseBeatDuration(L);break;case"dot":p++;break;case"accidental":S===null?E.warning("MusicXML","Malformed MusicXML, missing pitch or unpitched for note"):this.parseAccidental(L,S);break;case"time-modification":for(const A of L.childElements())switch(A.localName){case"actual-notes":g=Number.parseInt(A.innerText);break;case"normal-notes":m=Number.parseInt(A.innerText);break}break;case"stem":T=this.parseStem(L);break;case"notehead":S===null?E.warning("MusicXML","Malformed MusicXML, missing pitch or unpitched for note"):this.parseNoteHead(L,S,f??w.Quarter,T??this.estimateBeamDirection(S));break;case"staff":h=Number.parseInt(L.innerText)-1;break;case"beam":if(L.getAttribute("number","1")==="1")switch(L.innerText){case"begin":o=it.ForceMergeWithNext;break;case"continue":o=it.ForceMergeWithNext;break;case"end":o=it.ForceSplitToNext;break}break;case"notations":N(),this.parseNotations(L,S,a);break;case"lyric":N(),this.parseLyric(L,a,i);break;case"play":this.parsePlay(L,S);break}if(y){const L=this.getOrCreateStaff(i,h),_=this.getStaffContext(L).transpose;if(_!==0){const A=S.octave*12+S.tone+_;S.octave=A/12|0,S.tone=A-S.octave*12}}N()}parsePlay(e,t){for(const i of e.childElements())switch(i.localName){case"mute":t&&i.innerText==="palm"&&(t.isPalmMute=!0);break}}estimateBeamDirection(e){return e.calculateRealValue(!1,!1)<Ge.B4Value?P.Down:P.Up}parseNoteHead(e,t,i,a){e.getAttribute("parentheses","no")==="yes"&&(t.isGhost=!0);const n=e.getAttribute("filled","");let r;switch(n==="yes"?r=!0:n==="no"&&(r=!1),t.style=new Kw,e.innerText){case"arrow down":t.style.noteHeadCenterOnStem=!0,this.applyNoteHead(t,i,r,u.NoteheadTriangleDownDoubleWhole,u.NoteheadTriangleDownWhole,u.NoteheadTriangleDownHalf,u.NoteheadTriangleDownBlack);break;case"arrow up":t.style.noteHeadCenterOnStem=!0,this.applyNoteHead(t,i,r,u.NoteheadTriangleUpDoubleWhole,u.NoteheadTriangleUpWhole,u.NoteheadTriangleUpHalf,u.NoteheadTriangleUpBlack);break;case"back slashed":this.applyNoteHead(t,i,r,u.NoteheadSlashedDoubleWhole2,u.NoteheadSlashedWhole2,u.NoteheadSlashedHalf2,u.NoteheadSlashedBlack2);break;case"circle dot":t.style.noteHead=u.NoteheadRoundWhiteWithDot;break;case"circle-x":this.applyNoteHead(t,i,r,u.NoteheadCircleXDoubleWhole,u.NoteheadCircleXWhole,u.NoteheadCircleXHalf,u.NoteheadCircleX);break;case"circled":this.applyNoteHead(t,i,r,u.NoteheadCircledDoubleWhole,u.NoteheadCircledWhole,u.NoteheadCircledHalf,u.NoteheadCircledBlack);break;case"cluster":this.applyNoteHead(t,i,r,u.NoteheadClusterDoubleWhole3rd,u.NoteheadClusterWhole3rd,u.NoteheadClusterHalf3rd,u.NoteheadClusterQuarter3rd);break;case"cross":this.applyNoteHead(t,i,r,u.NoteheadPlusDoubleWhole,u.NoteheadPlusWhole,u.NoteheadPlusHalf,u.NoteheadPlusBlack);break;case"diamond":this.applyNoteHead(t,i,r,u.NoteheadDiamondDoubleWhole,u.NoteheadDiamondWhole,u.NoteheadDiamondHalf,u.NoteheadDiamondBlack);break;case"do":this.applyNoteHead(t,i,r,u.NoteShapeTriangleUpWhite,u.NoteShapeTriangleUpWhite,u.NoteShapeTriangleUpWhite,u.NoteShapeTriangleUpBlack);break;case"fa":a===P.Up?this.applyNoteHead(t,i,r,u.NoteShapeTriangleRightWhite,u.NoteShapeTriangleRightWhite,u.NoteShapeTriangleRightWhite,u.NoteShapeTriangleRightBlack):this.applyNoteHead(t,i,r,u.NoteShapeTriangleLeftWhite,u.NoteShapeTriangleLeftWhite,u.NoteShapeTriangleLeftWhite,u.NoteShapeTriangleLeftBlack);break;case"fa up":this.applyNoteHead(t,i,r,u.NoteShapeTriangleLeftWhite,u.NoteShapeTriangleLeftWhite,u.NoteShapeTriangleLeftWhite,u.NoteShapeTriangleLeftBlack);break;case"inverted triangle":this.applyNoteHead(t,i,r,u.NoteheadTriangleDownDoubleWhole,u.NoteheadTriangleDownWhole,u.NoteheadTriangleDownHalf,u.NoteheadTriangleDownBlack);break;case"la":this.applyNoteHead(t,i,r,u.NoteShapeSquareWhite,u.NoteShapeSquareWhite,u.NoteShapeSquareWhite,u.NoteShapeSquareBlack);break;case"left triangle":this.applyNoteHead(t,i,r,u.NoteheadTriangleRightWhite,u.NoteheadTriangleRightWhite,u.NoteheadTriangleRightWhite,u.NoteheadTriangleRightBlack);break;case"mi":this.applyNoteHead(t,i,r,u.NoteShapeDiamondWhite,u.NoteShapeDiamondWhite,u.NoteShapeDiamondWhite,u.NoteShapeDiamondBlack);break;case"none":t.style.noteHead=u.NoteheadNull;break;case"normal":this.applyNoteHead(t,i,r,u.NoteheadDoubleWhole,u.NoteheadWhole,u.NoteheadHalf,u.NoteheadBlack);break;case"re":this.applyNoteHead(t,i,r,u.NoteShapeMoonWhite,u.NoteShapeMoonWhite,u.NoteShapeMoonWhite,u.NoteShapeMoonBlack);break;case"rectangle":this.applyNoteHead(t,i,r,u.NoteheadSquareWhite,u.NoteheadSquareWhite,u.NoteheadSquareWhite,u.NoteheadSquareBlack);break;case"slash":this.applyNoteHead(t,i,r,u.NoteheadSlashWhiteWhole,u.NoteheadSlashWhiteWhole,u.NoteheadSlashWhiteHalf,u.NoteheadSlashVerticalEnds);break;case"slashed":this.applyNoteHead(t,i,r,u.NoteheadSlashedDoubleWhole1,u.NoteheadSlashedWhole1,u.NoteheadSlashedHalf1,u.NoteheadSlashedBlack1);break;case"so":this.applyNoteHead(t,i,r,u.NoteShapeRoundWhite,u.NoteShapeRoundWhite,u.NoteShapeRoundWhite,u.NoteShapeRoundBlack);break;case"square":this.applyNoteHead(t,i,r,u.NoteShapeSquareWhite,u.NoteShapeSquareWhite,u.NoteShapeSquareWhite,u.NoteShapeSquareBlack);break;case"ti":this.applyNoteHead(t,i,r,u.NoteShapeTriangleRoundWhite,u.NoteShapeTriangleRoundWhite,u.NoteShapeTriangleRoundWhite,u.NoteShapeTriangleRoundBlack);break;case"triangle":this.applyNoteHead(t,i,r,u.NoteheadTriangleUpDoubleWhole,u.NoteheadTriangleUpWhole,u.NoteheadTriangleUpHalf,u.NoteheadTriangleUpBlack);break;case"x":this.applyNoteHead(t,i,r,u.NoteheadXDoubleWhole,u.NoteheadXWhole,u.NoteheadXHalf,u.NoteheadXBlack);break}}createRestForGap(e,t){let i=v.toTicks(t);for(;i>e;){if(t===w.TwoHundredFiftySixth)return null;t=t*2,i=v.toTicks(t)}const a=new Wt;return a.dynamics=this._currentDynamics,a.isEmpty=!1,a.duration=t,a.overrideDisplayDuration=i,a.updateDurations(),a}insertBeatToVoice(e,t){if(t.beats.length>0){const i=t.beats[t.beats.length-1];i.nextBeat=e,e.previousBeat=i;let a=i;for(;a!==null&&a.graceType!==se.None;)a.index>0?a=a.previousBeat:a=null;a!==null&&(e.displayStart=a.displayEnd)}t.addBeat(e)}musicXmlDivisionsToAlphaTabTicks(e){return e*v.QuarterTime/this._divisionsPerQuarterNote}parseBeatDuration(e){switch(e.innerText){case"1024th":return w.TwoHundredFiftySixth;case"512th":return w.TwoHundredFiftySixth;case"256th":return w.TwoHundredFiftySixth;case"128th":return w.OneHundredTwentyEighth;case"64th":return w.SixtyFourth;case"32nd":return w.ThirtySecond;case"16th":return w.Sixteenth;case"eighth":return w.Eighth;case"quarter":return w.Quarter;case"half":return w.Half;case"whole":return w.Whole;case"breve":return w.DoubleWhole;case"long":return w.QuadrupleWhole}return null}applyBeatDurationFromTicks(e,t,i,a){if(!i)for(let n=0;n<Ge.allDurations.length;n++){const r=Ge.allDurationTicks[n];if(t>=r)i=Ge.allDurations[n];else break}e.duration=i??w.Sixteenth,a&&(e.overrideDisplayDuration=t),e.updateDurations()}parseLyric(e,t,i){const n=this._indexToTrackInfo.get(i.index).getLyricLine(e.getAttribute("number",""));for(t.lyrics===null&&(t.lyrics=[]);t.lyrics.length<=n;)t.lyrics.push("");for(const r of e.childElements())switch(r.localName){case"text":t.lyrics[n]?t.lyrics[n]+=` ${r.innerText}`:t.lyrics[n]=r.innerText;break;case"elision":t.lyrics[n]+=r.innerText;break}}parseNotations(e,t,i){for(const a of e.childElements())switch(a.localName){case"tied":t&&this.parseTied(a,t,i.voice.bar.staff);break;case"slur":t&&this.parseSlur(a,t);break;case"glissando":t&&this.parseGlissando(a,t);break;case"slide":t&&this.parseSlide(a,t);break;case"ornaments":t&&this.parseOrnaments(a,t);break;case"technical":this.parseTechnical(a,t,i);break;case"articulations":t&&this.parseArticulations(a,t);break;case"dynamics":const n=this.parseDynamics(a);n!==null&&(i.dynamics=n,this._currentDynamics=n);break;case"fermata":this.parseFermata(a,i);break;case"arpeggiate":this.parseArpeggiate(a,i);break}}getStaffContext(e){if(!this._staffToContext.has(e)){const t=new Gx;return this._staffToContext.set(e,t),t}return this._staffToContext.get(e)}parseGlissando(e,t){const i=e.getAttribute("type"),a=e.getAttribute("number","1"),n=this.getStaffContext(t.beat.voice.bar.staff);switch(i){case"start":n.slideOrigins.set(a,t);break;case"stop":if(n.slideOrigins.has(a)){const r=n.slideOrigins.get(a);r.slideTarget=t,t.slideOrigin=r,r.slideOutType=pe.Shift}break}}parseSlur(e,t){const i=e.getAttribute("number","1"),a=this.getStaffContext(t.beat.voice.bar.staff);switch(e.getAttribute("type")){case"start":a.slurStarts.set(i,t);break;case"stop":if(a.slurStarts.has(i)){t.isSlurDestination=!0;const n=a.slurStarts.get(i);n.slurDestination=t,t.slurOrigin=n,a.slurStarts.delete(i)}break}}parseArpeggiate(e,t){switch(e.getAttribute("direction","down")){case"down":t.brushType=Y.ArpeggioDown;break;case"up":t.brushType=Y.ArpeggioUp;break}}parseFermata(e,t){let i;switch(e.innerText){case"normal":i=Bi.Medium;break;case"angled":i=Bi.Short;break;case"square":i=Bi.Long;break;default:i=Bi.Medium;break}t.fermata=new Rh,t.fermata.type=i}parseArticulations(e,t){for(const i of e.childElements())switch(i.localName){case"accent":t.accentuated=_t.Normal;break;case"strong-accent":t.accentuated=_t.Heavy;break;case"staccato":t.isStaccato=!0;break;case"tenuto":t.accentuated=_t.Tenuto;break}}parseTechnical(e,t,i){const a=[];for(const n of e.childElements())switch(n.localName){case"up-bow":i.pickStroke=ni.Up;break;case"down-bow":i.pickStroke=ni.Down;break;case"harmonic":break;case"fingering":t&&(t.leftHandFinger=this.parseFingering(n));break;case"pluck":t&&(t.rightHandFinger=this.parseFingering(n));break;case"fret":t&&(t.fret=Number.parseInt(n.innerText));break;case"string":t&&(t.string=i.voice.bar.staff.tuning.length-Number.parseInt(n.innerText)+1);break;case"hammer-on":case"pull-off":t&&(t.isHammerPullOrigin=!0);break;case"bend":a.push(n);break;case"tap":i.tap=!0;break;case"smear":t&&(t.vibrato=ve.Slight);break;case"golpe":switch(n.getAttribute("placement","above")){case"above":i.golpe=Ji.Finger;break;case"below":i.golpe=Ji.Thumb;break}break}t&&a.length>0&&this.parseBends(a,t)}parseBends(e,t){const i=H.MaxPosition/e.length;let a=0,n=0,r=!0;for(const o of e){const l=o.findChildElement("bend-alter");if(l){const h=Math.round(Math.abs(Number.parseFloat(l.innerText))*2);o.findChildElement("pre-bend")?r?(a+=h,t.addBendPoint(new H(n,a)),n+=i,t.addBendPoint(new H(n,a)),r=!1):n+=i:o.findChildElement("release")?(r&&(a+=h),t.addBendPoint(new H(n,a)),n+=i,a-=h,t.addBendPoint(new H(n,a)),r=!1):(t.addBendPoint(new H(n,a)),a+=h,n+=i,t.addBendPoint(new H(n,a)),r=!1)}}}parseFingering(e){switch(e.innerText){case"0":return ie.NoOrDead;case"1":case"p":case"t":return ie.Thumb;case"2":case"i":return ie.IndexFinger;case"3":case"m":return ie.MiddleFinger;case"4":case"a":return ie.AnnularFinger;case"5":case"c":return ie.LittleFinger}return ie.Unknown}parseOrnaments(e,t){let i=-1;for(const a of e.childElements())switch(a.localName){case"trill-mark":i=Number.parseInt(a.getAttribute("trill-step","2")),t.isStringed?t.trillValue=t.stringTuning+i:t.isPercussion||(t.trillValue=t.calculateRealValue(!1,!1)+i);break;case"turn":t.ornament=Tt.Turn;break;case"inverted-turn":t.ornament=Tt.InvertedTurn;break;case"wavy-line":i>0?a.getAttribute("type")==="start"&&(this._currentTrillStep=i):this._currentTrillStep>0?a.getAttribute("type")==="stop"?this._currentTrillStep=-1:t.isStringed?t.trillValue=t.stringTuning+this._currentTrillStep:t.isPercussion||(t.trillValue=t.calculateRealValue(!1,!1)+this._currentTrillStep):t.vibrato=ve.Slight;break;case"mordent":t.ornament=Tt.LowerMordent;break;case"inverted-mordent":t.ornament=Tt.UpperMordent;break;case"tremolo":switch(a.innerText){case"1":t.beat.tremoloSpeed=w.Eighth;break;case"2":t.beat.tremoloSpeed=w.Sixteenth;break;case"3":t.beat.tremoloSpeed=w.ThirtySecond;break}break}}parseSlide(e,t){const i=e.getAttribute("type"),a=e.getAttribute("number","1"),n=this.getStaffContext(t.beat.voice.bar.staff);switch(i){case"start":n.slideOrigins.set(a,t);break;case"stop":if(n.slideOrigins.has(a)){const r=n.slideOrigins.get(a);r.slideTarget=t,t.slideOrigin=r,r.slideOutType=pe.Shift}break}}parseTied(e,t,i){const a=e.getAttribute("type"),n=e.getAttribute("number",""),r=this.getStaffContext(i);if(a==="start"){if(n){if(r.tieStartIds.has(n)){const o=r.tieStartIds.get(n);r.tieStarts.delete(o)}r.tieStartIds.set(n,t)}r.tieStarts.add(t)}else if(a==="stop"&&!t.isTieDestination){let o=null;if(n){if(!r.tieStartIds.has(n))return;o=r.tieStartIds.get(n),r.tieStartIds.delete(n),r.tieStarts.delete(t)}else{const l=this.calculatePitchedNoteValue(t);for(const h of r.tieStarts)if(this.calculatePitchedNoteValue(h)===l){o=h,r.tieStarts.delete(o);break}}if(!o)return;t.isTieDestination=!0,t.tieOrigin=o}}parseStem(e){switch(e.innerText){case"down":return P.Down;case"up":return P.Up;default:return null}}parseAccidental(e,t){switch(e.innerText){case"sharp":t.accidentalMode=ke.ForceSharp;break;case"natural":t.accidentalMode=ke.ForceNatural;break;case"flat":t.accidentalMode=ke.ForceFlat;break;case"double-sharp":t.accidentalMode=ke.ForceDoubleSharp;break;case"flat-flat":t.accidentalMode=ke.ForceDoubleFlat;break}}calculatePitchedNoteValue(e){return e.octave*12+e.tone}parseDuration(e){return this.musicXmlDivisionsToAlphaTabTicks(Number.parseFloat(e.innerText))}parseUnpitched(e,t){let i="",a=0;for(const r of e.childElements())switch(r.localName){case"display-step":i=r.innerText;break;case"display-octave":a=Number.parseInt(r.innerText)+1;break}const n=new bt;if(i==="")n.octave=0,n.tone=0;else{const r=a*12+V.getToneForText(i).noteValue;n.octave=r/12|0,n.tone=r-n.octave*12}return n}parsePitch(e){let t="",i=0,a=0;for(const o of e.childElements())switch(o.localName){case"step":t=o.innerText;break;case"alter":i=Number.parseFloat(o.innerText),Number.isNaN(i)&&(i=0);break;case"octave":a=Number.parseInt(o.innerText)+1;break}i=i|0;const n=a*12+V.getToneForText(t).noteValue+i,r=new bt;return r.octave=n/12|0,r.tone=n-r.octave*12,r}applyNoteHead(e,t,i,a,n,r,o){if(i===void 0)switch(t){case w.QuadrupleWhole:case w.DoubleWhole:e.style.noteHead=a;break;case w.Whole:e.style.noteHead=n;break;case w.Half:e.style.noteHead=r;break;default:e.style.noteHead=o;break}else if(i===!0)e.style.noteHead=o;else switch(t){case w.QuadrupleWhole:case w.DoubleWhole:e.style.noteHead=a;break;case w.Whole:e.style.noteHead=n;break;case w.Half:e.style.noteHead=r;break;default:e.style.noteHead=r;break}}}Ge.B4Value=71;Ge.allDurations=[w.TwoHundredFiftySixth,w.OneHundredTwentyEighth,w.SixtyFourth,w.ThirtySecond,w.Sixteenth,w.Eighth,w.Quarter,w.Half,w.Whole,w.DoubleWhole,w.QuadrupleWhole];Ge.allDurationTicks=Ge.allDurations.map(s=>v.toTicks(s));var Ao;(function(s){s[s.SingleTrackMultiChannel=0]="SingleTrackMultiChannel",s[s.MultiTrack=1]="MultiTrack"})(Ao||(Ao={}));class sk{constructor(){this.events=[]}addEvent(e){if(this.events.length===0||e.tick>=this.events[this.events.length-1].tick)this.events.push(e);else{let t=this.events.length;for(;t>0&&this.events[t-1].tick>e.tick;)t--;this.events.splice(t,0,e)}}writeTo(e){const t=Dt.empty();let i=0;for(const r of this.events){const o=r.tick-i;Za.writeVariableInt(t,o),r.writeTo(t),i=r.tick}const a=new Uint8Array([77,84,114,107]);e.write(a,0,a.length);const n=t.toArray();x.writeInt32BE(e,n.length),e.write(n,0,n.length)}}class Za{constructor(){this.format=Ao.SingleTrackMultiChannel,this.division=v.QuarterTime,this.tracks=[]}get events(){if(this.tracks.length===1)return this.tracks[0].events;const e=[];for(const t of this.tracks)this.events.push(...t.events);return e.sort((t,i)=>t.tick-i.tick),e}ensureTracks(e){for(;this.tracks.length<e;)this.tracks.push(new sk)}addEvent(e){this.format===Ao.SingleTrackMultiChannel?(this.ensureTracks(1),this.tracks[0].addEvent(e)):(this.ensureTracks(e.track+1),this.tracks[e.track].addEvent(e))}toBinary(){const e=Dt.empty();return this.writeTo(e),e.toArray()}writeTo(e){const t=new Uint8Array([77,84,104,100]);e.write(t,0,t.length),x.writeInt32BE(e,6),x.writeInt16BE(e,this.format),x.writeInt16BE(e,this.tracks.length),x.writeInt16BE(e,this.division);for(const i of this.tracks)i.writeTo(e)}static writeVariableInt(e,t){const i=new Uint8Array(4);let a=0;do i[a++]=t&127,t>>=7;while(t>0);for(;a>0;)a--,a>0?e.writeByte(i[a]|128):e.writeByte(i[a])}}var Fe;(function(s){s[s.TimeSignature=88]="TimeSignature",s[s.NoteOn=128]="NoteOn",s[s.NoteOff=144]="NoteOff",s[s.ControlChange=176]="ControlChange",s[s.ProgramChange=192]="ProgramChange",s[s.TempoChange=81]="TempoChange",s[s.PitchBend=224]="PitchBend",s[s.PerNotePitchBend=96]="PerNotePitchBend",s[s.EndOfTrack=47]="EndOfTrack",s[s.AlphaTabRest=241]="AlphaTabRest",s[s.AlphaTabMetronome=242]="AlphaTabMetronome",s[s.SystemExclusive=240]="SystemExclusive",s[s.SystemExclusive2=247]="SystemExclusive2",s[s.Meta=255]="Meta"})(Fe||(Fe={}));class La{constructor(e,t,i){this.track=e,this.tick=t,this.type=i}get command(){return this.type}get message(){return 0}get data1(){return 0}get data2(){return 0}}class ak extends La{constructor(e,t,i,a,n,r){super(e,t,Fe.TimeSignature),this.track=e,this.tick=t,this.numerator=i,this.denominatorIndex=a,this.midiClocksPerMetronomeClick=n,this.thirtySecondNodesInQuarter=r}writeTo(e){e.writeByte(255),e.writeByte(88),Za.writeVariableInt(e,4),e.writeByte(this.numerator&255),e.writeByte(this.denominatorIndex&255),e.writeByte(this.midiClocksPerMetronomeClick&255),e.writeByte(this.thirtySecondNodesInQuarter&255)}}class pn extends La{writeTo(e){e.writeByte(240);const t=Dt.withCapacity(16);t.writeByte(pn.AlphaTabManufacturerId),this.writeEventData(t),t.writeByte(247),Za.writeVariableInt(e,t.length),t.copyTo(e)}}pn.AlphaTabManufacturerId=125;pn.MetronomeEventId=0;pn.RestEventId=1;class nk extends pn{constructor(e,t,i,a,n){super(e,t,Fe.AlphaTabMetronome),this.isMetronome=!0,this.metronomeNumerator=i,this.metronomeDurationInMilliseconds=n,this.metronomeDurationInTicks=a}writeEventData(e){e.writeByte(pn.MetronomeEventId),e.writeByte(this.metronomeNumerator),x.writeInt32LE(e,this.metronomeDurationInTicks),x.writeInt32LE(e,this.metronomeDurationInMilliseconds)}}class rk extends pn{constructor(e,t,i){super(e,t,Fe.AlphaTabRest),this.channel=i}writeEventData(e){e.writeByte(pn.RestEventId),e.writeByte(this.channel)}}class ok extends La{constructor(e,t,i,a,n,r){super(e,t,i),this.channel=a,this.noteKey=n,this.noteVelocity=r}get data1(){return this.noteKey}get data2(){return this.noteVelocity}}class lk extends ok{constructor(e,t,i,a,n){super(e,t,Fe.NoteOn,i,a,n)}writeTo(e){e.writeByte(this.channel&15|144),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class hk extends ok{constructor(e,t,i,a,n){super(e,t,Fe.NoteOff,i,a,n)}writeTo(e){e.writeByte(this.channel&15|128),e.writeByte(this.noteKey&255),e.writeByte(this.noteVelocity&255)}}class ck extends La{constructor(e,t,i,a,n){super(e,t,Fe.ControlChange),this.channel=i,this.controller=a,this.value=n}writeTo(e){e.writeByte(this.channel&15|176),e.writeByte(this.controller&255),e.writeByte(this.value&255)}get data1(){return this.controller}get data2(){return this.value}}class uk extends La{constructor(e,t,i,a){super(e,t,Fe.ProgramChange),this.channel=i,this.program=a}writeTo(e){e.writeByte(this.channel&15|192),e.writeByte(this.program&255)}get data1(){return this.program}}class dk extends La{get microSecondsPerQuarterNote(){return 6e7/this.beatsPerMinute}set microSecondsPerQuarterNote(e){this.beatsPerMinute=6e7/e}constructor(e,t){super(0,e,Fe.TempoChange),this.beatsPerMinute=0,this.microSecondsPerQuarterNote=t}writeTo(e){e.writeByte(255),e.writeByte(81),e.writeByte(3),e.writeByte(this.microSecondsPerQuarterNote>>16&255),e.writeByte(this.microSecondsPerQuarterNote>>8&255),e.writeByte(this.microSecondsPerQuarterNote&255)}}class fk extends La{constructor(e,t,i,a){super(e,t,Fe.PitchBend),this.channel=i,this.value=a}writeTo(e){e.writeByte(this.channel&15|224),e.writeByte(this.value&127),e.writeByte(this.value>>7&127)}get data1(){return this.value&127}get data2(){return this.value>>7&127}}class pk extends La{constructor(e,t,i,a,n){super(e,t,Fe.PerNotePitchBend),this.channel=i,this.noteKey=a,this.value=n}writeTo(e){throw new We(Ve.General,"Note Bend (Midi2.0) events cannot be exported to SMF1.0")}}class gk extends La{constructor(e,t){super(e,t,Fe.EndOfTrack)}writeTo(e){e.writeByte(255),e.writeByte(47),e.writeByte(0)}}class Ll{constructor(e,t){this.time=0,this.eventIndex=e,this.event=t,this.isMetronome=this.event.type===Fe.AlphaTabMetronome}static newMetronomeEvent(e,t,i,a,n){const r=new nk(0,t,i,a,n);return new Ll(e,r)}}class fl{constructor(){this.masterBarIndex=0,this.masterBarOccurence=0,this.synthBpm=0,this.synthTime=0,this.synthTick=0,this.syncTime=0,this.syncBpm=0}updateSyncBpm(e,t){const i=e-this.synthTime,a=t-this.syncTime,n=i/a*this.synthBpm;this.syncBpm=n}}class Fy{constructor(e,t,i){this.bpm=e,this.ticks=t,this.time=i}}class ef{constructor(){this.tempoChanges=[],this.tempoChangeIndex=0,this.syncPoints=[],this.firstProgramEventPerChannel=new Map,this.firstTimeSignatureNumerator=0,this.firstTimeSignatureDenominator=0,this.synthData=[],this.division=v.QuarterTime,this.eventIndex=0,this.currentTime=0,this.syncPointIndex=0,this.playbackRange=null,this.playbackRangeStartTime=0,this.playbackRangeEndTime=0,this.endTick=0,this.endTime=0,this.currentTempo=0,this.syncPointTempo=0}}class mk{get isPlayingMain(){return this._currentState===this._mainState}get isPlayingOneTimeMidi(){return this._currentState===this._oneTimeState}get isPlayingCountIn(){return this._currentState===this._countInState}constructor(e){this._oneTimeState=null,this._countInState=null,this.isLooping=!1,this.playbackSpeed=1,this.instrumentPrograms=new Set,this.percussionKeys=new Set,this._synthesizer=e,this._mainState=new ef,this._currentState=this._mainState}get mainPlaybackRange(){return this._mainState.playbackRange}set mainPlaybackRange(e){this._mainState.playbackRange=e,e&&(this._mainState.playbackRangeStartTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.startTick,1),this._mainState.playbackRangeEndTime=this.tickPositionToTimePositionWithSpeed(this._mainState,e.endTick,1))}get currentTime(){return this._currentState.currentTime/this.playbackSpeed}get currentEndTick(){return this._currentState.endTick}get currentEndTime(){return this._currentState.endTime/this.playbackSpeed}get currentTempo(){return this._currentState.currentTempo}get modifiedTempo(){return this._currentState.syncPointTempo*this.playbackSpeed}get syncPointTempo(){return this._currentState.syncPointTempo}get currentSyncPoints(){return this._currentState.syncPoints}mainSeek(e){if(e*=this.playbackSpeed,this.mainPlaybackRange&&(e<this._mainState.playbackRangeStartTime?e=this._mainState.playbackRangeStartTime:e>this._mainState.playbackRangeEndTime&&(e=this._mainState.playbackRangeEndTime)),e>this._mainState.currentTime)this.mainSilentProcess(e-this._mainState.currentTime);else if(e<this._mainState.currentTime){if(this._mainState.currentTime=0,this._mainState.eventIndex=0,this._mainState.syncPointIndex=0,this._mainState.tempoChangeIndex=0,this._mainState.currentTempo=this._mainState.tempoChanges[0].bpm,this._mainState.syncPointTempo=this._mainState.syncPoints.length>0?this._mainState.syncPoints[0].syncBpm:this._mainState.currentTempo,this.isPlayingMain){const t=this._synthesizer.metronomeVolume;this._synthesizer.noteOffAll(!0),this._synthesizer.resetSoft(),this._synthesizer.setupMetronomeChannel(t)}this.mainSilentProcess(e)}}mainSilentProcess(e){if(e<=0)return;const t=Date.now(),i=this._mainState.currentTime+e;if(this.isPlayingMain)for(;this._mainState.currentTime<i;)this.fillMidiEventQueueLimited(i-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(te.MicroBufferSize);this._mainState.currentTime=i;const a=Date.now()-t;E.debug("Sequencer",`Silent seek finished in ${a}ms (main)`)}loadOneTimeMidi(e){this._oneTimeState=this.createStateFromFile(e),this._currentState=this._oneTimeState}loadMidi(e){this.instrumentPrograms.clear(),this.percussionKeys.clear(),this._mainState=this.createStateFromFile(e),this._currentState=this._mainState}createStateFromFile(e){const t=new ef;this.percussionKeys.add(te.MetronomeKey),t.tempoChanges=[],t.division=e.division,t.eventIndex=0,t.currentTime=0,t.synthData=[];let i=120,a=0,n=0,r=0,o=0,l=0,h=0,c=0,d=0;for(const f of e.events){const p=new Ll(t.synthData.length,f);t.synthData.push(p);const g=f.tick-d;if(a+=g,n+=g*(6e4/(i*e.division)),p.time=n,d=f.tick,o>0)for(;h<a;){const m=Ll.newMetronomeEvent(t.synthData.length,h,Math.floor(h/o)%r,o,l);t.synthData.push(m),m.time=c,h+=o,c+=l}if(f.type===Fe.TempoChange)i=f.beatsPerMinute,t.tempoChanges.push(new Fy(i,a,n)),l=o*(6e4/(i*e.division));else if(f.type===Fe.TimeSignature){const m=f,T=Math.pow(2,m.denominatorIndex);r=m.numerator,o=t.division*(4/T)|0,l=o*(6e4/(i*e.division)),t.firstTimeSignatureDenominator===0&&(t.firstTimeSignatureNumerator=m.numerator,t.firstTimeSignatureDenominator=T)}else if(f.type===Fe.ProgramChange){const m=f,T=m.channel;t.firstProgramEventPerChannel.has(T)||t.firstProgramEventPerChannel.set(T,p),T===te.PercussionChannel||this.instrumentPrograms.add(m.program)}else if(f.type===Fe.NoteOn){const m=f;m.channel===te.PercussionChannel&&this.percussionKeys.add(m.noteKey)}}return t.currentTempo=t.tempoChanges.length>0?t.tempoChanges[0].bpm:i,t.syncPointTempo=t.currentTempo,t.synthData.sort((f,p)=>f.time>p.time?1:f.time<p.time?-1:f.eventIndex-p.eventIndex),t.endTime=n,t.endTick=a,t}fillMidiEventQueue(){return this.fillMidiEventQueueLimited(-1)}fillMidiEventQueueToEndTime(e){for(;this._mainState.currentTime<e;)this.fillMidiEventQueueLimited(e-this._mainState.currentTime)&&this._synthesizer.synthesizeSilent(te.MicroBufferSize);let t=!1;for(this._currentState.currentTime=e;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime;){const i=this._currentState.synthData[this._currentState.eventIndex];this._synthesizer.dispatchEvent(i),this._currentState.eventIndex++,t=!0}return t}fillMidiEventQueueLimited(e){let t=te.MicroBufferSize/this._synthesizer.outSampleRate*1e3*this.playbackSpeed,i=this.internalEndTime;e>0&&(e<t&&(t=e),i=Math.min(this.internalEndTime,this._currentState.currentTime+e));let a=!1;for(this._currentState.currentTime+=t;this._currentState.eventIndex<this._currentState.synthData.length&&this._currentState.synthData[this._currentState.eventIndex].time<this._currentState.currentTime&&this._currentState.currentTime<i;)this._synthesizer.dispatchEvent(this._currentState.synthData[this._currentState.eventIndex]),this._currentState.eventIndex++,a=!0;return a}mainTickPositionToTimePosition(e){return this.tickPositionToTimePositionWithSpeed(this._mainState,e,this.playbackSpeed)}mainUpdateSyncPoints(e){const t=this._mainState;if(e.sort((i,a)=>i.synthTick-a.synthTick),t.syncPoints=[],e.length>=0){let i=120,a=0,n=0,r=0;for(let o=0;o<e.length;o++){const l=e[o];let h=0,c,d,f;if(o===0)c=i,d=0,f=0;else{const p=e[o-1];c=p.syncBpm,d=p.syncTime,f=p.synthTick}for(;r<t.tempoChanges.length&&t.tempoChanges[r].ticks<=l.synthTick;){if(h=t.tempoChanges[r].ticks-a,h>0){a+=h,n+=h*(6e4/(i*t.division));const p=(l.syncTime-d)/(l.synthTick-f),g=(a-f)*p+d,m=new fl;m.synthTick=a,m.synthBpm=i,m.synthTime=n,m.syncTime=g,m.syncBpm=c}i=t.tempoChanges[r].bpm,r++}h=l.synthTick-a,a+=h,n+=h*(6e4/(i*t.division)),t.syncPoints.push(l)}}t.syncPointIndex=0,t.syncPointTempo=t.syncPoints.length>0?t.syncPoints[0].syncBpm:t.currentTempo}currentTimePositionToTickPosition(e){const t=this._currentState;if(t.tempoChanges.length===0)return 0;e*=this.playbackSpeed,this.updateCurrentTempo(t,e);const i=t.tempoChanges[t.tempoChangeIndex],n=(e-i.time)/(6e4/(i.bpm*t.division))|0;return i.ticks+n+1}currentUpdateCurrentTempo(e){this.updateCurrentTempo(this._mainState,e*this.playbackSpeed)}updateCurrentTempo(e,t){let i=e.tempoChangeIndex;for(t<e.tempoChanges[i].time&&(i=0);i+1<e.tempoChanges.length&&e.tempoChanges[i+1].time<=t;)i++;i!==e.tempoChangeIndex&&(e.tempoChangeIndex=i,e.currentTempo=e.tempoChanges[e.tempoChangeIndex].bpm,e.syncPoints.length===0&&(e.syncPointTempo=e.currentTempo))}currentUpdateSyncPoints(e){this.updateSyncPoints(this._mainState,e)}updateSyncPoints(e,t){const i=e.syncPoints;if(i.length>0){let a=Math.min(e.syncPointIndex,i.length-1);for(t<i[a].syncTime&&(a=0);a+1<i.length&&i[a+1].syncTime<=t;)a++;a!==e.syncPointIndex&&(e.syncPointIndex=a,e.syncPointTempo=i[a].syncBpm)}else e.syncPointTempo=e.currentTempo}mainTimePositionFromBackingTrack(e,t){const i=this._mainState,a=i.syncPoints;if(e<0||a.length===0)return e;this.updateSyncPoints(this._mainState,e);const n=Math.min(i.syncPointIndex,a.length-1),r=a[n],o=e-r.syncTime;let l;if(n+1<a.length){const h=a[n+1],c=o/(h.syncTime-r.syncTime);l=(h.synthTime-r.synthTime)*c}else{const h=o/(t-r.syncTime);l=(i.endTime-r.synthTime)*h}return(r.synthTime+l)/this.playbackSpeed}mainTimePositionToBackingTrack(e,t){const i=this._mainState,a=i.syncPoints;if(e<0||a.length===0)return e;e*=this.playbackSpeed;let n=Math.min(i.syncPointIndex,a.length-1);for(e<a[n].synthTime&&(n=0);n+1<a.length&&a[n+1].synthTime<=e;)n++;const r=a[n],o=e-r.synthTime;let l;if(n+1<a.length){const h=a[n+1],c=o/(h.synthTime-r.synthTime),d=h.syncTime-r.syncTime;l=r.syncTime+d*c}else{const h=o/(i.endTime-r.synthTime),c=t-r.syncTime;l=r.syncTime+c*h}return l}tickPositionToTimePositionWithSpeed(e,t,i){let a=0,n=120,r=0;for(const o of e.tempoChanges){if(t<o.ticks)break;a=o.time,n=o.bpm,r=o.ticks}return t-=r,a+=t*(6e4/(n*e.division)),a/i}get internalEndTime(){return this.isPlayingMain?this.mainPlaybackRange?this._currentState.playbackRangeEndTime:this._currentState.endTime:this._currentState.endTime}get isFinished(){return this._currentState.currentTime>=this.internalEndTime}stop(){this.isPlayingMain&&this.mainPlaybackRange?this._currentState.currentTime=this.mainPlaybackRange.startTick:this._currentState.currentTime=0,this._currentState.eventIndex=0}resetOneTimeMidi(){this._oneTimeState=null,this._currentState=this._mainState}resetCountIn(){this._countInState=null,this._currentState=this._mainState}startCountIn(){this.generateCountInMidi(),this._currentState=this._countInState,this.stop(),this._synthesizer.noteOffAll(!0)}generateCountInMidi(){const e=new ef;e.division=this._mainState.division;let t=120,i=4,a=4;this._mainState.eventIndex===0?(t=this._mainState.tempoChanges[0].bpm,i=this._mainState.firstTimeSignatureNumerator,a=this._mainState.firstTimeSignatureDenominator):(t=this._synthesizer.currentTempo,i=this._synthesizer.timeSignatureNumerator,a=this._synthesizer.timeSignatureDenominator),e.tempoChanges.push(new Fy(t,0,0));const n=e.division*(4/a)|0,r=n*(6e4/(t*this._mainState.division));let o=0,l=0;for(let h=0;h<i;h++){const c=Ll.newMetronomeEvent(e.synthData.length,o,h,n,r);e.synthData.push(c),c.time=l,o+=n,l+=r}e.synthData.sort((h,c)=>h.time>c.time?1:h.time<c.time?-1:h.eventIndex-c.eventIndex),e.endTime=l,e.endTick=o,e.currentTempo=t,e.syncPointTempo=t,this._countInState=e}}var ii;(function(s){s[s.Paused=0]="Paused",s[s.Playing=1]="Playing"})(ii||(ii={}));class co{constructor(e,t){this.state=e,this.stopped=t}}class Ya{constructor(e,t,i,a,n,r,o){this.originalTempo=0,this.modifiedTempo=0,this.currentTime=e,this.endTime=t,this.currentTick=i,this.endTick=a,this.isSeek=n,this.originalTempo=r,this.modifiedTempo=o}}class Es{constructor(){this.id="",this.size=0}static load(e,t,i){if(e&&Es.HeaderSize>e.size||i.position+Es.HeaderSize>=i.length||(t.id=x.read8BitStringLength(i,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122)||(t.size=x.readUInt32LE(i),e&&Es.HeaderSize+t.size>e.size))return!1;e&&(e.size-=Es.HeaderSize+t.size);const a=t.id==="RIFF",n=t.id==="LIST";return a&&e?!1:!a&&!n?!0:(t.id=x.read8BitStringLength(i,4),t.id.charCodeAt(0)<=32||t.id.charCodeAt(0)>=122?!1:(t.size-=4,!0))}}Es.HeaderSize=8;class Yx{constructor(e,t,i,a){this.packetData=e,this.isBeginningOfStream=t,this.isEndOfStream=i,this.granulePosition=i?a:null}addData(e){const t=this.packetData,i=new Uint8Array(t.length+e.length);i.set(t,0),i.set(e,t.length)}}var Al;(function(s){s[s.ContinuesPacket=1]="ContinuesPacket",s[s.BeginningOfStream=2]="BeginningOfStream",s[s.EndOfStream=4]="EndOfStream"})(Al||(Al={}));class Xx{constructor(e){this._readable=e}read(){const e=[];for(;this.findAndReadPage(e););return e}findAndReadPage(e){return this.seekPageHeader()?this.readPage(e):!1}seekPageHeader(){for(let e=0;e<65536;e++){if(x.readInt32LE(this._readable)===1399285583)return!0;this._readable.position-=3}return!1}readPage(e){const t=this._readable.readByte();if(t===-1||t!==0)return!1;const i=this._readable.readByte(),a=x.readInt64LE(this._readable);this._readable.skip(4),this._readable.skip(4),this._readable.skip(4);const n=this._readable.readByte();if(n===-1)return!1;const r=[];let o=0;for(let l=0;l<n;l++){const h=this._readable.readByte();o===r.length&&r.push(0),r[o]+=h,h<255&&o++}for(let l=0;l<r.length;l++){const h=new Uint8Array(r[l]);if(this._readable.read(h,0,h.length)!==h.length)return!1;if(i&Al.ContinuesPacket){if(e.length===0)throw new We(Ve.Format,"OGG: Continuation page without any previous packets");e[e.length-1].addData(h)}else{const d=new Yx(h,(i&Al.BeginningOfStream)!==0&&l===0,(i&Al.EndOfStream)!==0&&l===r.length-1,a);e.push(d)}}return!0}}class qx{constructor(){this.audioChannels=0,this.audioSampleRate=0,this.samples=new Float32Array(0),this.bitrateMaximum=0,this.bitrateNominal=0,this.bitrateMinimum=0,this.blocksize0=0,this.blocksize1=0}}class My{constructor(){this.value=0,this.bitsRead=0}}class Oh{constructor(e){this._bitBucket=0n,this._bitCount=0n,this._overflowBits=0n,this._source=e}readByte(){return this.readBits(Oh.ByteSize)}readBit(){return this.readBits(1)===1}readBytes(e){const t=new Uint8Array(e);for(let i=0;i<e;i++)t[i]=this.readByte()&255;return t}readBits(e){if(e===0)return 0;const t=this.tryPeekBits(e);return this.skipBits(e),t.value}tryPeekBits(e){if(e<0||e>32)throw new We(Ve.General,"IO: Cannot read more than 32 bits in one go");if(e===0)return new My;const t=new My;for(;this._bitCount<e;){const a=BigInt(this._source.readByte());if(a===-1n)return t.bitsRead=Number(this._bitCount),t.value=Number(this._bitBucket),this._bitBucket=0n,this._bitCount=0n,t;this._bitBucket=(a&0xffn)<<this._bitCount|this._bitBucket,this._bitCount+=8n,this._bitCount>32&&(this._overflowBits=a>>40n-this._bitCount&0xffn)}let i=this._bitBucket;return e<64&&(i=i&(1n<<BigInt(e))-1n),t.value=Number(i),t.bitsRead=e,t}skipBits(e){let t=BigInt(e);if(e!==0)if(this._bitCount>t){if(e>31?this._bitBucket=0n:this._bitBucket=this._bitBucket>>t,this._bitCount>32){const i=this._bitCount-32n;this._bitBucket=this._bitBucket|this._overflowBits<<this._bitCount-t-i,i>e&&(this._overflowBits=this._overflowBits>>t&0xffn)}this._bitCount-=t}else if(this._bitCount===t)this._bitBucket=0n,this._bitCount=0n;else{for(t-=this._bitCount,this._bitCount=0n,this._bitBucket=0n;t>8;){if(this._source.readByte()===-1){t=0n;break}t-=8n}if(t>0){const i=BigInt(this._source.readByte());i===-1n||(this._bitBucket=i>>t,this._bitCount=8n-t)}}}}Oh.ByteSize=8;class Jx{constructor(){this.codebooks=[],this.timeDomainTransforms=[],this.floors=[],this.residues=[],this.mappings=[],this.modes=[]}}class Ba{static ilog(e){let t=0;for(;e>0;)++t,e>>=1;return t}static bitReverse(e,t=32){let i=BigInt(e);return i=(i&BigInt(2863311530))>>1n|(i&BigInt(1431655765))<<1n,i=(i&BigInt(3435973836))>>2n|(i&BigInt(858993459))<<2n,i=(i&BigInt(4042322160))>>4n|(i&BigInt(252645135))<<4n,i=(i&BigInt(4278255360))>>8n|(i&BigInt(16711935))<<8n,i=(i>>16n|i<<16n)>>32n-BigInt(t),Number(BigInt.asUintN(32,i))}static convertFromVorbisFloat32(e){const t=BigInt(e);let i=t&BigInt(2097151);const a=t&BigInt(2147483648),n=(t&BigInt(2145386496))>>21n;return a!==0n&&(i=-i),Number(i)*Math.pow(2,Number(n)-788)}}class Qx{constructor(e){this._data=e}get(e){return this._data[e]}}class up{get(e){return e}}up.instance=new up;class Kx{constructor(e,t){if(this._maxBits=0,this._overflowList=null,this._prefixList=null,this._prefixBitLength=0,this.dimensions=0,this.entries=0,this.mapType=0,e.readBits(24)!==5653314)throw new We(Ve.Format,"Vorbis: Book header had invalid signature!");this.dimensions=e.readBits(16),this.entries=e.readBits(24),this._lengths=new Int32Array(this.entries),this.initTree(e,t),this.initLookupTable(e)}get(e,t){return this._lookupTable[e*this.dimensions+t]}decodeScalar(e){let t=e.tryPeekBits(this._prefixBitLength);if(t.bitsRead===0)return-1;let i=this._prefixList[t.value];if(i!=null)return e.skipBits(i.length),i.value;if(t=e.tryPeekBits(this._maxBits),this._overflowList!==null)for(let a=0;a<this._overflowList.length;a++){i=this._overflowList[a];const n=t.value&i.mask;if(i.bits===n)return e.skipBits(i.length),i.value}return-1}initTree(e,t){let i,a=0,n;if(e.readBit()){let r=e.readBits(5)+1;for(let o=0;o<this.entries;){let l=e.readBits(Ba.ilog(this.entries-o));for(;--l>=0;)this._lengths[o++]=r;++r}a=0,i=!1,n=r}else{n=-1,i=e.readBit();for(let r=0;r<this.entries;r++)!i||e.readBit()?(this._lengths[r]=e.readBits(5)+1,++a):this._lengths[r]=-1,this._lengths[r]>n&&(n=this._lengths[r])}if(this._maxBits=n,n>-1){let r=null;i&&a>=this.entries>>2&&(r=new Int32Array(this.entries),r.set(this._lengths.subarray(0,this.entries),0),i=!1);let o;i?o=a:o=0;let l=null,h=null;if(i?o!==0&&(r=new Int32Array(o),h=new Int32Array(o),l=new Int32Array(o)):h=new Int32Array(this.entries),!this.computeCodewords(i,h,r,this._lengths,this.entries,l))throw new We(Ve.Format,"Vorbis: Failed to compute codewords");const c=l==null?up.instance:new Qx(l);t.generateTable(c,r??this._lengths,h),this._prefixList=t.prefixTree,this._prefixBitLength=t.tableBits,this._overflowList=t.overflowList}}computeCodewords(e,t,i,a,n,r){const o=new Uint32Array(32);let l=0,h=0;for(l=0;l<n&&!(a[l]>0);++l);if(l===n)return!0;this.addEntry(e,t,i,0,l,h++,a[l],r);for(let c=1;c<=a[l];++c)o[c]=1<<32-c;for(let c=l+1;c<n;++c){let d=a[c];if(d<=0)continue;for(;d>0&&o[d]===0;)--d;if(d===0)return!1;const f=o[d];if(o[d]=0,this.addEntry(e,t,i,Ba.bitReverse(f),c,h++,a[c],r),d!==a[c])for(let p=a[c];p>d;--p)o[p]=f+(1<<32-p)}return!0}addEntry(e,t,i,a,n,r,o,l){e?(t[r]=a,i[r]=o,l[r]=n):t[n]=a}initLookupTable(e){if(this.mapType=e.readBits(4),this.mapType===0)return;const t=Ba.convertFromVorbisFloat32(e.readBits(32)),i=Ba.convertFromVorbisFloat32(e.readBits(32)),a=e.readBits(4)+1,n=e.readBit();let r=this.entries*this.dimensions;const o=new Float32Array(r);this.mapType===1&&(r=this.lookup1Values());const l=new Uint32Array(r);for(let h=0;h<r;h++)l[h]=e.readBits(a);if(this.mapType===1)for(let h=0;h<this.entries;h++){let c=0,d=1;for(let f=0;f<this.dimensions;f++){const p=h/d%r|0,g=l[p]*i+t+c;o[h*this.dimensions+f]=g,n&&(c=g),d*=r}}else for(let h=0;h<this.entries;h++){let c=0,d=h*this.dimensions;for(let f=0;f<this.dimensions;f++){const p=l[d]*i+t+c;o[h*this.dimensions+f]=p,n&&(c=p),++d}}this._lookupTable=o}lookup1Values(){let e=Math.floor(Math.exp(Math.log(this.entries)/this.dimensions));return Math.floor(Math.pow(e+1,this.dimensions))<=this.entries&&++e,e}}class $x{constructor(){this.value=0,this.length=0,this.bits=0,this.mask=0}}class ch{constructor(){this.tableBits=0,this.prefixTree=[],this.overflowList=null}generateTable(e,t,i){const a=new Array(t.length);let n=0;for(let h=0;h<a.length;h++){const c=new $x;c.value=e.get(h),c.length=t[h]<=0?99999:t[h],c.bits=i[h],c.mask=(1<<t[h])-1,a[h]=c,t[h]>0&&n<t[h]&&(n=t[h])}a.sort((h,c)=>{const d=h.length-c.length;return d===0?h.bits-c.bits:d});const r=n>ch.MAX_TABLE_BITS?ch.MAX_TABLE_BITS:n,o=[];let l=null;for(let h=0;h<a.length&&a[h].length<99999;h++){const c=a[h].length;if(c>r)for(l=[];h<a.length&&a[h].length<99999;h++)l.push(a[h]);else{const d=1<<r-c,f=a[h];for(let p=0;p<d;p++){const g=p<<c|f.bits;for(;o.length<=g;)o.push(null);o[g]=f}}}for(;o.length<1<<r;)o.push(null);this.tableBits=r,this.prefixTree=o,this.overflowList=l}}ch.MAX_TABLE_BITS=10;class Zx{constructor(e){e.readBits(16)}}class jx{get executeChannel(){return(this.forceEnergy||this.amp>0)&&!this.forceNoEnergy}constructor(e){this.amp=0,this.forceEnergy=!1,this.forceNoEnergy=!1,this.coeff=e}}class iu{constructor(e,t,i,a){if(this._order=e.readBits(8),this._rate=e.readBits(16),this._bark_map_size=e.readBits(16),this._ampBits=e.readBits(6),this._ampOfs=e.readBits(8),this._books=new Array(e.readBits(4)+1),this._order<1||this._rate<1||this._bark_map_size<1||this._books.length===0)throw new We(Ve.Format,"Vorbis: Invalid Floor0 Data");this._ampDiv=(1<<this._ampBits)-1;for(let n=0;n<this._books.length;n++){const r=e.readBits(8);if(r<0||r>=a.length)throw new We(Ve.Format,"Vorbis: Invalid Floor0 Data");const o=a[r];if(o.mapType===0||o.dimensions<1)throw new We(Ve.Format,"Vorbis: Invalid Floor0 Data");this._books[n]=o}this._bookBits=Ba.ilog(this._books.length),this._barkMaps=new Map([[t,this.synthesizeBarkCurve(t/2)],[i,this.synthesizeBarkCurve(i/2)]]),this._wMap=new Map([[t,this.synthesizeWDelMap(t/2)],[i,this.synthesizeWDelMap(i/2)]])}synthesizeBarkCurve(e){const t=this._bark_map_size/iu.toBARK(this._rate/2),i=new Int32Array(e+1);for(let a=0;a<e-1;a++)i[a]=Math.min(this._bark_map_size-1,Math.floor(iu.toBARK(this._rate/2/e*a)*t));return i[e]=-1,i}static toBARK(e){return 13.1*Math.atan(74e-5*e)+2.24*Math.atan(185e-10*e*e)+1e-4*e}synthesizeWDelMap(e){const t=Math.PI/this._bark_map_size,i=new Float32Array(e);for(let a=0;a<e;a++)i[a]=2*Math.cos(t*a);return i}unpack(e,t,i){const a=new jx(new Float32Array(this._order+1));if(a.amp=e.readBits(this._ampBits),a.amp>0){a.amp=a.amp/this._ampDiv*this._ampOfs;const n=e.readBits(this._bookBits);if(n>=this._books.length)return a.amp=0,a;const r=this._books[n];for(let l=0;l<this._order;){const h=r.decodeScalar(e);if(h===-1)return a.amp=0,a;for(let c=0;l<this._order&&c<r.dimensions;c++,l++)a.coeff[l]=r.get(h,c)}let o=0;for(let l=0;l<this._order;){for(let h=0;l<this._order&&h<r.dimensions;l++,h++)a.coeff[l]+=o;o=a.coeff[l-1]}}return a}apply(e,t,i){const a=e,n=t/2;if(a.amp>0){const r=this._barkMaps.get(t),o=this._wMap.get(t);let l=0;for(l=0;l<this._order;l++)a.coeff[l]=2*Math.cos(a.coeff[l]);for(l=0;l<n;){let h=0;const c=r[l];let d=.5,f=.5;const p=o[c];for(h=1;h<this._order;h+=2)f*=p-a.coeff[h-1],d*=p-a.coeff[h];for(h===this._order?(f*=p-a.coeff[h-1],d*=d*(4-p*p),f*=f):(d*=d*(2-p),f*=f*(2+p)),f=a.amp/Math.sqrt(d+f)-this._ampOfs,f=Math.exp(f*.11512925),i[l]*=f;r[++l]===c;)i[l]*=f}}else i.fill(0,0,n)}}class ev{constructor(){this.posts=new Int32Array(64),this.postCount=0,this.forceEnergy=!1,this.forceNoEnergy=!1}get executeChannel(){return(this.forceEnergy||this.postCount>0)&&!this.forceNoEnergy}}class ja{constructor(e,t){let i=-1;this._partitionClass=new Int32Array(e.readBits(5));for(let r=0;r<this._partitionClass.length;r++)this._partitionClass[r]=e.readBits(4),this._partitionClass[r]>i&&(i=this._partitionClass[r]);++i,this._classDimensions=new Int32Array(i),this._classSubclasses=new Int32Array(i),this._classMasterbooks=new Array(i),this._classMasterBookIndex=new Int32Array(i),this._subclassBooks=new Array(i),this._subclassBookIndex=new Array(i);for(let r=0;r<i;r++){this._classDimensions[r]=e.readBits(3)+1,this._classSubclasses[r]=e.readBits(2),this._classSubclasses[r]>0&&(this._classMasterBookIndex[r]=e.readBits(8),this._classMasterbooks[r]=t[this._classMasterBookIndex[r]]),this._subclassBooks[r]=new Array(1<<this._classSubclasses[r]),this._subclassBookIndex[r]=new Int32Array(this._subclassBooks[r].length);for(let o=0;o<this._subclassBooks[r].length;o++){const l=e.readBits(8)-1;l>=0&&(this._subclassBooks[r][o]=t[l]),this._subclassBookIndex[r][o]=l}}this._multiplier=e.readBits(2),this._range=ja._rangeLookup[this._multiplier],this._yBits=ja._yBitsLookup[this._multiplier],++this._multiplier;const a=e.readBits(4),n=[];n.push(0),n.push(1<<a);for(let r=0;r<this._partitionClass.length;r++){const o=this._partitionClass[r];for(let l=0;l<this._classDimensions[o];l++)n.push(e.readBits(a))}this._xList=new Int32Array(n),this._lNeigh=new Int32Array(n.length),this._hNeigh=new Int32Array(n.length),this._sortIdx=new Int32Array(n.length),this._sortIdx[0]=0,this._sortIdx[1]=1;for(let r=2;r<this._lNeigh.length;r++){this._lNeigh[r]=0,this._hNeigh[r]=1,this._sortIdx[r]=r;for(let o=2;o<r;o++){const l=this._xList[o];l<this._xList[r]?l>this._xList[this._lNeigh[r]]&&(this._lNeigh[r]=o):l<this._xList[this._hNeigh[r]]&&(this._hNeigh[r]=o)}}for(let r=0;r<this._sortIdx.length-1;r++)for(let o=r+1;o<this._sortIdx.length;o++){if(this._xList[r]===this._xList[o])throw new We(Ve.Format,"Vorbis: Invalid Floor1 Data");if(this._xList[this._sortIdx[r]]>this._xList[this._sortIdx[o]]){const l=this._sortIdx[r];this._sortIdx[r]=this._sortIdx[o],this._sortIdx[o]=l}}}unpack(e,t,i){const a=new ev;if(e.readBit()){let n=2;a.posts[0]=e.readBits(this._yBits),a.posts[1]=e.readBits(this._yBits);for(let r=0;r<this._partitionClass.length;r++){const o=this._partitionClass[r],l=this._classDimensions[o],h=this._classSubclasses[o],c=(1<<h)-1;let d=0;if(h>0&&(d=this._classMasterbooks[o].decodeScalar(e),d===-1)){n=0;break}for(let f=0;f<l;f++){const p=this._subclassBooks[o][d&c];if(d=d>>h,p!=null&&(a.posts[n]=p.decodeScalar(e),a.posts[n]===-1)){n=0,r=this._partitionClass.length;break}++n}}a.postCount=n}return a}apply(e,t,i){const a=e,n=t/2;if(a.postCount>0){const r=this.unwrapPosts(a);let o=0,l=a.posts[0]*this._multiplier;for(let h=1;h<a.postCount;h++){const c=this._sortIdx[h];if(r[c]){const d=this._xList[c],f=a.posts[c]*this._multiplier;o<n&&this.renderLineMulti(o,l,Math.min(d,n),f,i),o=d,l=f}if(o>=n)break}o<n&&this.renderLineMulti(o,l,n,l,i)}else i.fill(0,0,n)}unwrapPosts(e){const t=new Array(64);t.fill(!1),t[0]=!0,t[1]=!0;const i=new Int32Array(64);i[0]=e.posts[0],i[1]=e.posts[1];for(let a=2;a<e.postCount;a++){const n=this._lNeigh[a],r=this._hNeigh[a],o=this.renderPoint(this._xList[n],i[n],this._xList[r],i[r],this._xList[a]),l=e.posts[a],h=this._range-o,c=o;let d;h<c?d=h*2:d=c*2,l!==0?(t[n]=!0,t[r]=!0,t[a]=!0,l>=d?h>c?i[a]=l-c+o:i[a]=o-l+h-1:l%2===1?i[a]=o-(l+1)/2:i[a]=o+l/2):(t[a]=!1,i[a]=o)}for(let a=0;a<e.postCount;a++)e.posts[a]=i[a];return t}renderPoint(e,t,i,a,n){const r=a-t,o=i-e,c=Math.abs(r)*(n-e)/o|0;return r<0?t-c:t+c}renderLineMulti(e,t,i,a,n){const r=a-t,o=i-e;let l=Math.abs(r);const h=1-(r>>31&1)*2,c=r/o|0;let d=e,f=t,p=-o;for(n[e]*=ja.inverse_dB_table[t],l-=Math.abs(c)*o;++d<i;)f+=c,p+=l,p>=0&&(p-=o,f+=h),n[d]*=ja.inverse_dB_table[f]}}ja._rangeLookup=[256,128,86,64];ja._yBitsLookup=[8,7,7,6];ja.inverse_dB_table=new Float32Array([10649863e-14,11341951e-14,12079015e-14,12863978e-14,13699951e-14,14590251e-14,15538408e-14,16548181e-14,17623575e-14,18768855e-14,19988561e-14,2128753e-13,22670913e-14,24144197e-14,25713223e-14,27384213e-14,29163793e-14,31059021e-14,33077411e-14,35226968e-14,37516214e-14,39954229e-14,4255068e-13,45315863e-14,48260743e-14,51396998e-14,54737065e-14,58294187e-14,62082472e-14,66116941e-14,70413592e-14,74989464e-14,79862701e-14,8505263e-13,90579828e-14,96466216e-14,10273513e-13,10941144e-13,11652161e-13,12409384e-13,13215816e-13,14074654e-13,14989305e-13,15963394e-13,17000785e-13,18105592e-13,19282195e-13,20535261e-13,21869758e-13,23290978e-13,24804557e-13,26416497e-13,2813319e-12,29961443e-13,31908506e-13,33982101e-13,36190449e-13,38542308e-13,41047004e-13,4371447e-12,46555282e-13,49580707e-13,5280274e-12,5623416e-12,59888572e-13,63780469e-13,67925283e-13,72339451e-13,77040476e-13,82047e-10,87378876e-13,93057248e-13,99104632e-13,10554501e-12,11240392e-12,11970856e-12,12748789e-12,13577278e-12,14459606e-12,15399272e-12,16400004e-12,17465768e-12,18600792e-12,19809576e-12,21096914e-12,22467911e-12,23928002e-12,25482978e-12,27139006e-12,28902651e-12,30780908e-12,32781225e-12,34911534e-12,37180282e-12,39596466e-12,42169667e-12,4491009e-11,47828601e-12,50936773e-12,54246931e-12,57772202e-12,61526565e-12,65524908e-12,69783085e-12,74317983e-12,79147585e-12,8429104e-11,89768747e-12,95602426e-12,.00010181521,.00010843174,.00011547824,.00012298267,.00013097477,.00013948625,.00014855085,.00015820453,.00016848555,.00017943469,.00019109536,.00020351382,.00021673929,.00023082423,.00024582449,.00026179955,.00027881276,.00029693158,.00031622787,.00033677814,.00035866388,.00038197188,.00040679456,.00043323036,.00046138411,.00049136745,.00052329927,.00055730621,.00059352311,.00063209358,.00067317058,716917e-9,.0007635063,.00081312324,.00086596457,.00092223983,.00098217216,.0010459992,.0011139742,.0011863665,.0012634633,.0013455702,.0014330129,.0015261382,.0016253153,.0017309374,.0018434235,.0019632195,.0020908006,.0022266726,.0023713743,.0025254795,.0026895994,.0028643847,.0030505286,.0032487691,.0034598925,.0036847358,.0039241906,.0041792066,.004450795,.0047400328,.0050480668,.0053761186,.0057254891,.0060975636,.0064938176,.0069158225,.0073652516,.0078438871,.0083536271,.0088964928,.009474637,.010090352,.01074608,.011444421,.012188144,.012980198,.013823725,.014722068,.015678791,.016697687,.017782797,.018938423,.020169149,.021479854,.022875735,.02436233,.025945531,.027631618,.029427276,.031339626,.033376252,.035545228,.037855157,.040315199,.042935108,.045725273,.048696758,.051861348,.055231591,.05882085,.062643361,.066714279,.071049749,.075666962,.080584227,.085821044,.091398179,.097337747,.1036633,.11039993,.11757434,.12521498,.13335215,.14201813,.15124727,.16107617,.1715438,.18269168,.19456402,.20720788,.22067342,.23501402,.25028656,.26655159,.28387361,.30232132,.32196786,.34289114,.36517414,.38890521,.41417847,.44109412,.4697589,.50028648,.53279791,.56742212,.6042964,.64356699,.68538959,.72993007,.77736504,.8278826,.88168307,.9389798,1]);class tv{constructor(e,t,i,a){const n=e.readBits(16);switch(n){case 0:this.floor=new iu(e,t,i,a);break;case 1:this.floor=new ja(e,a);break;default:throw new We(Ve.Format,`Vorbis: Invalid Floor type: ${n}`)}}apply(e,t,i){this.floor.apply(e,t,i)}unpack(e,t,i){return this.floor.unpack(e,t,i)}}class Ih{constructor(e,t,i){this._begin=e.readBits(24),this._end=e.readBits(24),this._partitionSize=e.readBits(24)+1,this._classifications=e.readBits(6)+1,this._classBook=i[e.readBits(8)],this._cascade=new Int32Array(this._classifications);let a=0;for(let d=0;d<this._classifications;d++){const f=e.readBits(3);e.readBit()?this._cascade[d]=e.readBits(5)<<3|f:this._cascade[d]=f,a+=Ih.icount(this._cascade[d])}const n=new Int32Array(a);for(let d=0;d<a;d++)if(n[d]=e.readBits(8),i[n[d]].mapType===0)throw new We(Ve.Format,"Vorbis: Invalid Residue 0");const r=this._classBook.entries;let o=this._classBook.dimensions,l=1;for(;o>0;){if(l*=this._classifications,l>r)throw new We(Ve.Format,"Vorbis: Invalid Residue 0");--o}this._books=new Array(this._classifications),a=0;let h=0,c;for(let d=0;d<this._classifications;d++)if(c=Ba.ilog(this._cascade[d]),this._books[d]=new Array(c),c>0){h=Math.max(h,c);for(let f=0;f<c;f++)(this._cascade[d]&1<<f)>0&&(this._books[d][f]=i[n[a++]])}this._maxStages=h,this._decodeMap=new Array(l);for(let d=0;d<l;d++){let f=d,p=l/this._classifications|0;this._decodeMap[d]=new Int32Array(this._classBook.dimensions);for(let g=0;g<this._classBook.dimensions;g++){const m=f/p|0;f-=m*p,p=p/this._classifications|0,this._decodeMap[d][g]=m}}this._channels=t}static icount(e){let t=0;for(;e!==0;)t+=e&1,e>>=1;return t}decode(e,t,i,a){const r=(this._end<i/2?this._end:i/2)-this._begin;if(r>0&&t.indexOf(!1)!==-1){const o=r/this._partitionSize,l=(o+this._classBook.dimensions-1)/this._classBook.dimensions|0,h=[];for(let c=0;c<this._channels;c++)h.push(new Array(l));for(let c=0;c<this._maxStages;c++)for(let d=0,f=0;d<o;f++){if(c===0)for(let p=0;p<this._channels;p++){const g=this._classBook.decodeScalar(e);if(g>=0&&g<this._decodeMap.length)h[p][f]=this._decodeMap[g];else{d=o,c=this._maxStages;break}}for(let p=0;d<o&&p<this._classBook.dimensions;p++,d++){const g=this._begin+d*this._partitionSize;for(let m=0;m<this._channels;m++){const T=h[m][f][p];if(this._cascade[T]&1<<c){const S=this._books[T][c];if(S&&this.writeVectors(S,e,a,m,g,this._partitionSize)){d=o,c=this._maxStages;break}}}}}}}writeVectors(e,t,i,a,n,r){const o=i[a],l=r/e.dimensions,h=new Int32Array(l);for(let c=0;c<l;c++)if(h[c]=e.decodeScalar(t),h[c]===-1)return!0;for(let c=0;c<e.dimensions;c++)for(let d=0;d<l;d++,n++)o[n]+=e.get(h[d],c);return!1}}class iv extends Ih{writeVectors(e,t,i,a,n,r){const o=i[a];for(let l=0;l<r;){const h=e.decodeScalar(t);if(h===-1)return!0;for(let c=0;c<e.dimensions;l++,c++)o[n+l]+=e.get(h,c)}return!1}}class sv extends Ih{constructor(e,t,i){super(e,1,i),this._realChannels=t}decode(e,t,i,a){super.decode(e,t,i*this._realChannels,a)}writeVectors(e,t,i,a,n,r){let o=0;n/=this._realChannels;for(let l=0;l<r;){const h=e.decodeScalar(t);if(h===-1)return!0;for(let c=0;c<e.dimensions;c++,l++)i[o][n]+=e.get(h,c),++o===this._realChannels&&(o=0,n++)}return!1}}class av{constructor(e,t,i){const a=e.readBits(16);switch(a){case 0:this.residue=new Ih(e,t,i);break;case 1:this.residue=new iv(e,t,i);break;case 2:this.residue=new sv(e,t,i);break;default:throw new We(Ve.Format,`Vorbis: Invalid Residue type: ${a}`)}}decode(e,t,i,a){this.residue.decode(e,t,i,a)}}class nv{constructor(e,t,i,a,n){if(e.readBits(16)!==0)throw new We(Ve.Format,"Vorbis: Invalid mapping type!");let o=1;e.readBit()&&(o+=e.readBits(4));let l=0;e.readBit()&&(l=e.readBits(8)+1);const h=Ba.ilog(t-1);this._couplingAngle=new Int32Array(l),this._couplingMangitude=new Int32Array(l);for(let d=0;d<l;d++){const f=e.readBits(h),p=e.readBits(h);if(f===p||f>t-1||p>t-1)throw new We(Ve.Format,"Vorbis: Invalid magnitude or angle in mapping header!");this._couplingAngle[d]=p,this._couplingMangitude[d]=f}if(e.readBits(2)!==0)throw new We(Ve.Format,"Vorbis: Reserved bits not 0 in mapping header.");const c=new Int32Array(t);if(o>1){for(let d=0;d<t;d++)if(c[d]=e.readBits(4),c[d]>o)throw new We(Ve.Format,"Vorbis: Invalid channel mux submap index in mapping header!")}this._submapFloor=new Array(o),this._submapResidue=new Array(o);for(let d=0;d<o;d++){e.skipBits(8);const f=e.readBits(8);if(f>=i.length)throw new We(Ve.Format,"Vorbis: Invalid floor number in mapping header!");const p=e.readBits(8);if(p>=a.length)throw new We(Ve.Format,"Vorbis: Invalid residue number in mapping header!");this._submapFloor[d]=i[f],this._submapResidue[d]=a[p]}this._channelFloor=new Array(t),this._channelResidue=new Array(t);for(let d=0;d<t;d++)this._channelFloor[d]=this._submapFloor[c[d]],this._channelResidue[d]=this._submapResidue[c[d]];this._mdct=n}decodePacket(e,t,i){const a=t>>1,n=new Array(this._channelFloor.length),r=new Array(this._channelFloor.length);r.fill(!1);for(let o=0;o<this._channelFloor.length;o++)n[o]=this._channelFloor[o].unpack(e,t,o),r[o]=!n[o].executeChannel,i[o].fill(0,0,a);for(let o=0;o<this._couplingAngle.length;o++)(n[this._couplingAngle[o]].executeChannel||n[this._couplingMangitude[o]].executeChannel)&&(n[this._couplingAngle[o]].forceEnergy=!0,n[this._couplingMangitude[o]].forceEnergy=!0);for(let o=0;o<this._submapFloor.length;o++){for(let l=0;l<this._channelFloor.length;l++)(this._submapFloor[o]!==this._channelFloor[l]||this._submapResidue[o]!==this._channelResidue[l])&&(n[l].forceNoEnergy=!0);this._submapResidue[o].decode(e,r,t,i)}for(let o=this._couplingAngle.length-1;o>=0;o--)if(n[this._couplingAngle[o]].executeChannel||n[this._couplingMangitude[o]].executeChannel){const l=i[this._couplingMangitude[o]],h=i[this._couplingAngle[o]];for(let c=0;c<a;c++){let d,f;const p=l[c],g=h[c];p>0?g>0?(d=p,f=p-g):(f=p,d=p+g):g>0?(d=p,f=p+g):(f=p,d=p-g),l[c]=d,h[c]=f}}for(let o=0;o<this._channelFloor.length;o++)n[o].executeChannel?(this._channelFloor[o].apply(n[o],t,i[o]),this._mdct.reverse(i[o],t)):i[o].fill(0,a,a*2)}}class yk{constructor(){this.packetStartIndex=0,this.packetTotalLength=0,this.packetValidLength=0}}class rv{constructor(){this.overlapInfo=new yk,this.windowIndex=0}}class ov{constructor(e=null){this.samplePosition=null,this.samplePosition=e}}class Ui{constructor(e,t,i,a,n){if(this._overlapInfo=null,this._channels=t,this._blockFlag=e.readBit(),e.readBits(32)!==0)throw new We(Ve.Format,"Vorbis: Mode header had invalid window or transform type!");const r=e.readBits(8);if(r>=n.length)throw new We(Ve.Format,"Vorbis: Mode header had invalid mapping index!");this._mapping=n[r],this._blockFlag?(this._blockSize=a,this._windows=[Ui.calcWindow(i,a,i),Ui.calcWindow(a,a,i),Ui.calcWindow(i,a,a),Ui.calcWindow(a,a,a)],this._overlapInfo=[Ui.calcOverlap(i,a,i),Ui.calcOverlap(a,a,i),Ui.calcOverlap(i,a,a),Ui.calcOverlap(a,a,a)]):(this._blockSize=i,this._windows=[Ui.calcWindow(i,i,i)])}decode(e,t){const i=this.getPacketInfo(e);this._mapping.decodePacket(e,this._blockSize,t);const a=this._windows[i.windowIndex];for(let n=0;n<this._blockSize;n++)for(let r=0;r<this._channels;r++)t[r][n]*=a[n];return i.overlapInfo}getPacketInfo(e){const t=new rv;if(this._blockFlag){const i=e.readBit(),a=e.readBit();t.windowIndex=(i?1:0)+(a?2:0);const n=this._overlapInfo[t.windowIndex];t.overlapInfo.packetStartIndex=n.packetStartIndex,t.overlapInfo.packetValidLength=n.packetValidLength,t.overlapInfo.packetTotalLength=n.packetTotalLength}else t.windowIndex=0,t.overlapInfo.packetStartIndex=0,t.overlapInfo.packetValidLength=this._blockSize/2,t.overlapInfo.packetTotalLength=this._blockSize;return t}static calcWindow(e,t,i){const a=new Float32Array(t),n=e/2,r=t,o=i/2,l=r/4-n/2,h=r-r/4-o/2;for(let c=0;c<n;c++){let d=Math.sin((c+.5)/n*Ui.M_PI2);d*=d,a[l+c]=Math.sin(d*Ui.M_PI2)}for(let c=l+n;c<h;c++)a[c]=1;for(let c=0;c<o;c++){let d=Math.sin((o-c-.5)/o*Ui.M_PI2);d*=d,a[h+c]=Math.sin(d*Ui.M_PI2)}return a}static calcOverlap(e,t,i){const a=e/4,n=i/4,r=t/4-a,o=t/4*3+n,l=o-n*2,h=new yk;return h.packetStartIndex=r,h.packetValidLength=l,h.packetTotalLength=o,h}}Ui.M_PI2=3.1415926539/2;class Va{constructor(e){this._n=e,this._n2=e>>1,this._n4=this._n2>>1,this._n8=this._n4>>1,this._ld=Ba.ilog(e)-1,this._a=new Float32Array(this._n2),this._b=new Float32Array(this._n2),this._c=new Float32Array(this._n4);let t=0,i=0;for(;t<this._n4;++t,i+=2)this._a[i]=Math.cos(4*t*Va.M_PI/e),this._a[i+1]=-Math.sin(4*t*Va.M_PI/e),this._b[i]=Math.cos((i+1)*Va.M_PI/e/2)*.5,this._b[i+1]=Math.sin((i+1)*Va.M_PI/e/2)*.5;for(t=0,i=0;t<this._n8;++t,i+=2)this._c[i]=Math.cos(2*(i+1)*Va.M_PI/e),this._c[i+1]=-Math.sin(2*(i+1)*Va.M_PI/e);this._bitrev=new Uint16Array(this._n8);for(let a=0;a<this._n8;++a)this._bitrev[a]=de.int32ToUint16(Ba.bitReverse(a,this._ld-3)<<2)}calcReverse(e){let t,i;const a=new Float32Array(this._n2);{let r=this._n2-2,o=0,l=0;const h=this._n2;for(;l!==h;)a[r+1]=e[l]*this._a[o]-e[l+2]*this._a[o+1],a[r]=e[l]*this._a[o+1]+e[l+2]*this._a[o],r-=2,o+=2,l+=4;for(l=this._n2-3;r>=0;)a[r+1]=-e[l+2]*this._a[o]- -e[l]*this._a[o+1],a[r]=-e[l+2]*this._a[o+1]+-e[l]*this._a[o],r-=2,o+=2,l-=4}t=e,i=a;{let r=this._n2-8,o=this._n4,l=0,h=this._n4,c=0;for(;r>=0;){let d,f;f=i[o+1]-i[l+1],d=i[o]-i[l],t[h+1]=i[o+1]+i[l+1],t[h]=i[o]+i[l],t[c+1]=f*this._a[r+4]-d*this._a[r+5],t[c]=d*this._a[r+4]+f*this._a[r+5],f=i[o+3]-i[l+3],d=i[o+2]-i[l+2],t[h+3]=i[o+3]+i[l+3],t[h+2]=i[o+2]+i[l+2],t[c+3]=f*this._a[r]-d*this._a[r+1],t[c+2]=d*this._a[r]+f*this._a[r+1],r-=8,h+=4,c+=4,o+=4,l+=4}}this.step3_iter0_loop(this._n>>4,t,this._n2-1-this._n4*0,-this._n8),this.step3_iter0_loop(this._n>>4,t,this._n2-1-this._n4*1,-this._n8),this.step3_inner_r_loop(this._n>>5,t,this._n2-1-this._n8*0,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,t,this._n2-1-this._n8*1,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,t,this._n2-1-this._n8*2,-(this._n>>4),16),this.step3_inner_r_loop(this._n>>5,t,this._n2-1-this._n8*3,-(this._n>>4),16);let n=2;for(;n<this._ld-3>>1;++n){const r=this._n>>n+2,o=r>>1,l=1<<n+1;for(let h=0;h<l;++h)this.step3_inner_r_loop(this._n>>n+4,t,this._n2-1-r*h,-o,1<<n+3)}for(;n<this._ld-6;++n){const r=this._n>>n+2,o=1<<n+3,l=r>>1,h=this._n>>n+6,c=1<<n+1;let d=this._n2-1,f=0;for(let p=h;p>0;--p)this.step3_inner_s_loop(c,t,d,-l,f,o,r),f+=o*4,d-=8}this.step3_inner_s_loop_ld654(this._n>>5,t,this._n2-1,this._n);{let r=0,o=this._n4-4,l=this._n2-4;for(;o>=0;){let h;h=this._bitrev[r],i[l+3]=t[h],i[l+2]=t[h+1],i[o+3]=t[h+2],i[o+2]=t[h+3],h=this._bitrev[r+1],i[l+1]=t[h],i[l]=t[h+1],i[o+1]=t[h+2],i[o]=t[h+3],o-=4,l-=4,r+=2}}{let r=0,o=0,l=this._n2-4;for(;o<l;){let h,c,d,f,p,g;h=i[o]-i[l+2],c=i[o+1]+i[l+3],d=this._c[r+1]*h+this._c[r]*c,f=this._c[r+1]*c-this._c[r]*h,p=i[o]+i[l+2],g=i[o+1]-i[l+3],i[o]=p+d,i[o+1]=g+f,i[l+2]=p-d,i[l+3]=f-g,h=i[o+2]-i[l],c=i[o+3]+i[l+1],d=this._c[r+3]*h+this._c[r+2]*c,f=this._c[r+3]*c-this._c[r+2]*h,p=i[o+2]+i[l],g=i[o+3]-i[l+1],i[o+2]=p+d,i[o+3]=g+f,i[l]=p-d,i[l+1]=f-g,r+=4,o+=4,l-=4}}{let r=this._n2-8,o=this._n2-8,l=0,h=this._n2-4,c=this._n2,d=this._n-4;for(;o>=0;){let f,p,g,m;m=a[o+6]*this._b[r+7]-a[o+7]*this._b[r+6],g=-a[o+6]*this._b[r+6]-a[o+7]*this._b[r+7],e[l]=m,e[h+3]=-m,e[c]=g,e[d+3]=g,p=a[o+4]*this._b[r+5]-a[o+5]*this._b[r+4],f=-a[o+4]*this._b[r+4]-a[o+5]*this._b[r+5],e[l+1]=p,e[h+2]=-p,e[c+1]=f,e[d+2]=f,m=a[o+2]*this._b[r+3]-a[o+3]*this._b[r+2],g=-a[o+2]*this._b[r+2]-a[o+3]*this._b[r+3],e[l+2]=m,e[h+1]=-m,e[c+2]=g,e[d+1]=g,p=a[o]*this._b[r+1]-a[o+1]*this._b[r],f=-a[o]*this._b[r]-a[o+1]*this._b[r+1],e[l+3]=p,e[h]=-p,e[c+3]=f,e[d]=f,r-=8,o-=8,l+=4,c+=4,h-=4,d-=4}}}step3_inner_r_loop(e,t,i,a,n){let r,o,l=i,h=l+a,c=0;for(let d=e>>2;d>0;--d)r=t[l]-t[h],o=t[l-1]-t[h-1],t[l]+=t[h],t[l-1]+=t[h-1],t[h]=r*this._a[c]-o*this._a[c+1],t[h-1]=o*this._a[c]+r*this._a[c+1],c+=n,r=t[l-2]-t[h-2],o=t[l-3]-t[h-3],t[l-2]+=t[h-2],t[l-3]+=t[h-3],t[h-2]=r*this._a[c]-o*this._a[c+1],t[h-3]=o*this._a[c]+r*this._a[c+1],c+=n,r=t[l-4]-t[h-4],o=t[l-5]-t[h-5],t[l-4]+=t[h-4],t[l-5]+=t[h-5],t[h-4]=r*this._a[c]-o*this._a[c+1],t[h-5]=o*this._a[c]+r*this._a[c+1],c+=n,r=t[l-6]-t[h-6],o=t[l-7]-t[h-7],t[l-6]+=t[h-6],t[l-7]+=t[h-7],t[h-6]=r*this._a[c]-o*this._a[c+1],t[h-7]=o*this._a[c]+r*this._a[c+1],c+=n,l-=8,h-=8}step3_iter0_loop(e,t,i,a){let n=i,r=n+a,o=0;for(let l=e>>2;l>0;--l){let h,c;h=t[n]-t[r],c=t[n-1]-t[r-1],t[n]+=t[r],t[n-1]+=t[r-1],t[r]=h*this._a[o]-c*this._a[o+1],t[r-1]=c*this._a[o]+h*this._a[o+1],o+=8,h=t[n-2]-t[r-2],c=t[n-3]-t[r-3],t[n-2]+=t[r-2],t[n-3]+=t[r-3],t[r-2]=h*this._a[o]-c*this._a[o+1],t[r-3]=c*this._a[o]+h*this._a[o+1],o+=8,h=t[n-4]-t[r-4],c=t[n-5]-t[r-5],t[n-4]+=t[r-4],t[n-5]+=t[r-5],t[r-4]=h*this._a[o]-c*this._a[o+1],t[r-5]=c*this._a[o]+h*this._a[o+1],o+=8,h=t[n-6]-t[r-6],c=t[n-7]-t[r-7],t[n-6]+=t[r-6],t[n-7]+=t[r-7],t[r-6]=h*this._a[o]-c*this._a[o+1],t[r-7]=c*this._a[o]+h*this._a[o+1],o+=8,n-=8,r-=8}}step3_inner_s_loop(e,t,i,a,n,r,o){const l=this._a[n],h=this._a[n+1],c=this._a[n+r],d=this._a[n+r+1],f=this._a[n+r*2],p=this._a[n+r*2+1],g=this._a[n+r*3],m=this._a[n+r*3+1];let T,S,y=i,b=y+a;for(let B=e;B>0;--B)T=t[y]-t[b],S=t[y-1]-t[b-1],t[y]+=t[b],t[y-1]+=t[b-1],t[b]=T*l-S*h,t[b-1]=S*l+T*h,T=t[y-2]-t[b-2],S=t[y-3]-t[b-3],t[y-2]+=t[b-2],t[y-3]+=t[b-3],t[b-2]=T*c-S*d,t[b-3]=S*c+T*d,T=t[y-4]-t[b-4],S=t[y-5]-t[b-5],t[y-4]+=t[b-4],t[y-5]+=t[b-5],t[b-4]=T*f-S*p,t[b-5]=S*f+T*p,T=t[y-6]-t[b-6],S=t[y-7]-t[b-7],t[y-6]+=t[b-6],t[y-7]+=t[b-7],t[b-6]=T*g-S*m,t[b-7]=S*g+T*m,y-=o,b-=o}step3_inner_s_loop_ld654(e,t,i,a){const n=a>>3,r=this._a[n];let o=i;const l=o-16*e;for(;o>l;){let h,c;h=t[o]-t[o-8],c=t[o-1]-t[o-9],t[o]+=t[o-8],t[o-1]+=t[o-9],t[o-8]=h,t[o-9]=c,h=t[o-2]-t[o-10],c=t[o-3]-t[o-11],t[o-2]+=t[o-10],t[o-3]+=t[o-11],t[o-10]=(h+c)*r,t[o-11]=(c-h)*r,h=t[o-12]-t[o-4],c=t[o-5]-t[o-13],t[o-4]+=t[o-12],t[o-5]+=t[o-13],t[o-12]=c,t[o-13]=h,h=t[o-14]-t[o-6],c=t[o-7]-t[o-15],t[o-6]+=t[o-14],t[o-7]+=t[o-15],t[o-14]=(h+c)*r,t[o-15]=(h-c)*r,this.iter_54(t,o),this.iter_54(t,o-8),o-=16}}iter_54(e,t){const i=e[t]-e[t-4],a=e[t]+e[t-4],n=e[t-2]+e[t-6],r=e[t-2]-e[t-6];e[t]=a+n,e[t-2]=a-n;const o=e[t-3]-e[t-7];e[t-4]=i+o,e[t-6]=i-o;const l=e[t-1]-e[t-5],h=e[t-1]+e[t-5],c=e[t-3]+e[t-7];e[t-1]=h+c,e[t-3]=h-c,e[t-5]=l-r,e[t-7]=l+r}}Va.M_PI=3.141592653589793;class lv{constructor(){this._setupCache=new Map}reverse(e,t){let i;this._setupCache.has(t)?i=this._setupCache.get(t):(i=new Va(t),this._setupCache.set(t,i)),i.calcReverse(e)}}class Ag{constructor(e,t,i){this._packetIndex=0,this._stream=e,this._setup=t,this._packets=i,this._currentPosition=0,this._prevPacketBuf=null,this._prevPacketStart=0,this._prevPacketEnd=0,this._prevPacketStop=0,this._nextPacketBuf=null,this._eosFound=!1,this._hasPosition=!1,this._modeFieldBits=Ba.ilog(t.modes.length-1)}decode(){let e=new Float32Array(this._packets[this._packets.length-1].granulePosition*this._stream.audioChannels);const t=new Float32Array(.2*this._stream.audioSampleRate*this._stream.audioChannels);let i=0,a=0;for(;i=this.read(t,0,t.length),i!==0;){if(a+i>=e.length){const n=new Float32Array(e.length+t.length);n.set(e,0),e=n}e.set(t.subarray(0,i),a),a+=i}return e.subarray(0,a)}read(e,t,i){if(i===0)return 0;let a=t;const n=t+i;for(;a<n;){if(this._prevPacketStart===this._prevPacketEnd){if(this._eosFound){this._nextPacketBuf=null,this._prevPacketBuf=null;break}const o=this.readNextPacket((a-t)/this._stream.audioChannels);o===null&&(this._prevPacketEnd=this._prevPacketStop),o!==null&&o.samplePosition!==null&&!this._hasPosition&&(this._hasPosition=!0,this._currentPosition=o.samplePosition-(this._prevPacketEnd-this._prevPacketStart)-(a-t)/this._stream.audioChannels)}const r=Math.min((n-a)/this._stream.audioChannels,this._prevPacketEnd-this._prevPacketStart);r>0&&(a+=this.copyBuffer(e,a,r))}return i=a-t,this._currentPosition+=i/this._stream.audioChannels,i}copyBuffer(e,t,i){let a=t;for(;i>0;this._prevPacketStart++,i--)for(let n=0;n<this._stream.audioChannels;n++)e[a++]=this._prevPacketBuf[n][this._prevPacketStart];return a-t}readNextPacket(e){const t=this.decodeNextPacket();if(this._eosFound=this._eosFound||t.isEndOfStream,t.curPacket==null)return null;if(t.samplePosition!==null&&t.isEndOfStream){const i=this._currentPosition+e+t.validLen-t.startIndex,a=t.samplePosition-i;a<0&&(t.validLen+=a,t.validLen<0&&(t.validLen=0))}return this._prevPacketEnd>0?(Ag.overlapBuffers(this._prevPacketBuf,t.curPacket,this._prevPacketStart,this._prevPacketStop,t.startIndex,this._stream.audioChannels),this._prevPacketStart=t.startIndex):this._prevPacketBuf==null&&(this._prevPacketStart=t.validLen),this._nextPacketBuf=this._prevPacketBuf,this._prevPacketEnd=t.validLen,this._prevPacketStop=t.totalLen,this._prevPacketBuf=t.curPacket,new ov(t.samplePosition)}static overlapBuffers(e,t,i,a,n,r){for(;i<a;i++,n++)for(let o=0;o<r;o++)t[o][n]+=e[o][i]}decodeNextPacket(){const e=new hv;let t=null;if(this._packetIndex>=this._packets.length)e.isEndOfStream=!0;else{t=this._packets[this._packetIndex++];const i=new Oh(Dt.fromBuffer(t.packetData));if(e.isEndOfStream=t.isEndOfStream,!i.readBit()){const a=this._setup.modes[i.readBits(this._modeFieldBits)];if(this._nextPacketBuf==null){this._nextPacketBuf=new Array(this._stream.audioChannels);for(let r=0;r<this._stream.audioChannels;r++)this._nextPacketBuf[r]=new Float32Array(this._stream.blocksize1)}const n=a.decode(i,this._nextPacketBuf);return e.startIndex=n.packetStartIndex,e.validLen=n.packetValidLength,e.totalLen=n.packetTotalLength,e.samplePosition=t.granulePosition,e.curPacket=this._nextPacketBuf,e}}return e}}class hv{constructor(){this.curPacket=null,this.startIndex=0,this.validLen=0,this.totalLen=0,this.isEndOfStream=!1,this.samplePosition=null}}var Fl;(function(s){s[s.IdentificationHeader=1]="IdentificationHeader",s[s.Comment=3]="Comment",s[s.SetupHeader=5]="SetupHeader"})(Fl||(Fl={}));class Wa{constructor(e){this._packetIndex=-1,this._packets=e}read(){let e;for(;;){if(e=this.nextPacket(),e==null)return null;if(e.isBeginningOfStream){const t=this.readStream(e);if(t!=null)return t}}}nextPacket(){return this._packetIndex++,this._packetIndex<this._packets.length?this._packets[this._packetIndex]:null}readStream(e){const t=new qx;if(!this.readIdentificationHeader(t,e)||!this.readComments(this.nextPacket()))return null;const i=new Jx;if(!this.readSetupHeader(t,i,this.nextPacket()))return null;const a=[];let n;for(;n=this.nextPacket(),!(n==null||(a.push(n),n.isEndOfStream)););const r=new Ag(t,i,a);return t.samples=r.decode(),t}comonHeaderDecode(e,t){const i=new Uint8Array(7);if(t.read(i,0,i.length),i[0]!==e)return!1;for(let a=0;a<Wa.VorbisHeaderMarker.length;a++)if(i[1+a]!==Wa.VorbisHeaderMarker[a])return!1;return!0}comonHeaderDecodeBit(e,t){const i=t.readBytes(7);if(i[0]!==e)return!1;for(let a=0;a<Wa.VorbisHeaderMarker.length;a++)if(i[1+a]!==Wa.VorbisHeaderMarker[a])return!1;return!0}readIdentificationHeader(e,t){const i=Dt.fromBuffer(t.packetData);if(!this.comonHeaderDecode(Fl.IdentificationHeader,i)||x.readUInt32LE(i)!==0||(e.audioChannels=i.readByte(),e.audioSampleRate=x.readUInt32LE(i),e.audioChannels<=0||e.audioSampleRate<=0))return!1;e.bitrateMaximum=x.readInt32LE(i),e.bitrateNominal=x.readInt32LE(i),e.bitrateMinimum=x.readInt32LE(i);const n=i.readByte();return e.blocksize0=1<<(n&15),e.blocksize1=1<<(n>>4),!(e.blocksize0>e.blocksize1||!Wa.isAllowedBlockSize(e.blocksize0)||!Wa.isAllowedBlockSize(e.blocksize0)||i.readByte()===0)}static isAllowedBlockSize(e){switch(e){case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:return!0;default:return!1}}readComments(e){if(e==null)return!1;const t=Dt.fromBuffer(e.packetData);if(!this.comonHeaderDecode(Fl.Comment,t))return!1;const i=x.readUInt32LE(t);t.skip(i);const a=x.readUInt32LE(t);for(let r=0;r<a;r++){const o=x.readUInt32LE(t);t.skip(o)}return t.readByte()!==0}readSetupHeader(e,t,i){if(i==null)return!1;const a=new Oh(Dt.fromBuffer(i.packetData)),n=new lv,r=new ch;if(!this.comonHeaderDecodeBit(Fl.SetupHeader,a))return!1;let o=a.readByte()+1;for(let l=0;l<o;l++)t.codebooks.push(new Kx(a,r));o=a.readBits(6)+1;for(let l=0;l<o;l++)t.timeDomainTransforms.push(new Zx(a));o=a.readBits(6)+1;for(let l=0;l<o;l++)t.floors.push(new tv(a,e.blocksize0,e.blocksize1,t.codebooks));o=a.readBits(6)+1;for(let l=0;l<o;l++)t.residues.push(new av(a,e.audioChannels,t.codebooks));o=a.readBits(6)+1;for(let l=0;l<o;l++)t.mappings.push(new nv(a,e.audioChannels,t.floors,t.residues,n));o=a.readBits(6)+1;for(let l=0;l<o;l++)t.modes.push(new Ui(a,e.audioChannels,e.blocksize0,e.blocksize1,t.mappings));return!!a.readBit()}}Wa.VorbisHeaderMarker=new Uint8Array([118,111,114,98,105,115]);class cv{constructor(e){this.streams=[];const i=new Xx(e).read(),a=new Wa(i);for(;;){const n=a.read();if(n==null)break;this.streams.push(n)}}}class bk{constructor(){this.phdrs=[],this.pbags=[],this.pmods=[],this.pgens=[],this.insts=[],this.ibags=[],this.imods=[],this.igens=[],this.sHdrs=[],this.sampleData=new Uint8Array(0),this._sampleCache=new Map}decodeSamples(e,t,i){const a=`${e}_${t}_${i}`;if(!this._sampleCache.has(a)){let n;const r=this.sampleData.slice(e,t);if(i)n=new cv(Dt.fromBuffer(r)).streams[0].samples;else{const o=new DataView(r.buffer,r.byteOffset,r.length);n=new Float32Array(r.length/2);for(let l=0;l<n.length;l++)n[l]=o.getInt16(l*2,!0)/32767}return this._sampleCache.set(a,n),n}return this._sampleCache.get(a)}load(e){const t=new Es,i=new Es;if(!Es.load(null,t,e)||t.id!=="sfbk")throw new Kt("Soundfont is not a valid Soundfont2 file");for(;Es.load(t,i,e);){const a=new Es;if(i.id==="pdta")for(;Es.load(i,a,e);)switch(a.id){case"phdr":for(let n=0,r=a.size/yp.SizeInFile|0;n<r;n++)this.phdrs.push(new yp(e));break;case"pbag":for(let n=0,r=a.size/mp.SizeInFile|0;n<r;n++)this.pbags.push(new mp(e));break;case"pmod":for(let n=0,r=a.size/bp.SizeInFile|0;n<r;n++)this.pmods.push(new bp(e));break;case"pgen":for(let n=0,r=a.size/ws.SizeInFile|0;n<r;n++)this.pgens.push(new ws(e));break;case"inst":for(let n=0,r=a.size/gp.SizeInFile|0;n<r;n++)this.insts.push(new gp(e));break;case"ibag":for(let n=0,r=a.size/dp.SizeInFile|0;n<r;n++)this.ibags.push(new dp(e));break;case"imod":for(let n=0,r=a.size/fp.SizeInFile|0;n<r;n++)this.imods.push(new fp(e));break;case"igen":for(let n=0,r=a.size/pp.SizeInFile|0;n<r;n++)this.igens.push(new pp(e));break;case"shdr":for(let n=0,r=a.size/Sp.SizeInFile|0;n<r;n++)this.sHdrs.push(new Sp(e));break;default:e.position+=a.size;break}else if(i.id==="sdta")for(;Es.load(i,a,e);)switch(a.id){case"smpl":this.sampleData=new Uint8Array(a.size),e.read(this.sampleData,0,a.size);break;default:e.position+=a.size;break}else e.position+=i.size}}}class dp{constructor(e){this.instGenNdx=x.readUInt16LE(e),this.instModNdx=x.readUInt16LE(e)}}dp.SizeInFile=4;class fp{constructor(e){this.modSrcOper=x.readUInt16LE(e),this.modDestOper=x.readUInt16LE(e),this.modAmount=x.readInt16LE(e),this.modAmtSrcOper=x.readUInt16LE(e),this.modTransOper=x.readUInt16LE(e)}}fp.SizeInFile=10;class pp{constructor(e){this.genOper=x.readUInt16LE(e),this.genAmount=new Sk(e)}}pp.SizeInFile=4;class gp{constructor(e){this.instName=x.read8BitStringLength(e,20),this.instBagNdx=x.readUInt16LE(e)}}gp.SizeInFile=22;class mp{constructor(e){this.genNdx=x.readUInt16LE(e),this.modNdx=x.readUInt16LE(e)}}mp.SizeInFile=4;class ws{constructor(e){this.genOper=x.readUInt16LE(e),this.genAmount=new Sk(e)}}ws.SizeInFile=4;ws.GenInstrument=41;ws.GenKeyRange=43;ws.GenVelRange=44;ws.GenSampleId=53;class yp{constructor(e){this.presetName=x.read8BitStringLength(e,20),this.preset=x.readUInt16LE(e),this.bank=x.readUInt16LE(e),this.presetBagNdx=x.readUInt16LE(e),this.library=x.readUInt32LE(e),this.genre=x.readUInt32LE(e),this.morphology=x.readUInt32LE(e)}}yp.SizeInFile=38;class bp{constructor(e){this.modSrcOper=x.readUInt16LE(e),this.modDestOper=x.readUInt16LE(e),this.modAmount=x.readUInt16LE(e),this.modAmtSrcOper=x.readUInt16LE(e),this.modTransOper=x.readUInt16LE(e)}}bp.SizeInFile=10;class Sp{constructor(e){this.sampleName=x.read8BitStringLength(e,20),this.start=x.readUInt32LE(e),this.end=x.readUInt32LE(e),this.startLoop=x.readUInt32LE(e),this.endLoop=x.readUInt32LE(e),this.sampleRate=x.readUInt32LE(e),this.originalPitch=e.readByte(),this.pitchCorrection=x.readSInt8(e),this.sampleLink=x.readUInt16LE(e),this.sampleType=x.readUInt16LE(e)}}Sp.SizeInFile=46;class Sk{get shortAmount(){return de.uint16ToInt16(this.wordAmount)}get lowByteAmount(){return this.wordAmount&255}get highByteAmount(){return(this.wordAmount&65280)>>8&255}constructor(e){this.wordAmount=x.readUInt16LE(e)}}class uv{constructor(){this.presetIndex=0,this.bank=0,this.pitchWheel=0,this.perNotePitchWheel=new Map,this.midiPan=0,this.midiVolume=0,this.midiExpression=0,this.midiRpn=0,this.midiData=0,this.panOffset=0,this.gainDb=0,this.pitchRange=0,this.tuning=0,this.mixVolume=0,this.mute=!1,this.solo=!1}}class dv{constructor(){this.activeChannel=0,this.channelList=[]}setupVoice(e,t){const i=this.channelList[this.activeChannel],a=t.region.pan+i.panOffset;t.playingChannel=this.activeChannel,t.mixVolume=i.mixVolume,t.noteGainDb+=i.gainDb,t.updatePitchRatio(i,e.outSampleRate),a<=-.5?(t.panFactorLeft=1,t.panFactorRight=0):a>=.5?(t.panFactorLeft=0,t.panFactorRight=1):(t.panFactorLeft=Math.sqrt(.5-a),t.panFactorRight=Math.sqrt(.5+a))}}var Xa;(function(s){s[s.None=0]="None",s[s.Continuous=1]="Continuous",s[s.Sustain=2]="Sustain"})(Xa||(Xa={}));var br;(function(s){s[s.StereoInterleaved=0]="StereoInterleaved",s[s.StereoUnweaved=1]="StereoUnweaved",s[s.Mono=2]="Mono"})(br||(br={}));class fv{constructor(){this.name="",this.presetNumber=0,this.bank=0,this.regions=null}}class $t{static timecents2Secs(e){return Math.pow(2,e/1200)}static decibelsToGain(e){return e>-100?Math.pow(10,e*.05):0}static gainToDecibels(e){return e<=1e-5?-100:20*Math.log10(e)}static cents2Hertz(e){return 8.176*Math.pow(2,e/1200)}}class pl{constructor(e){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0,e&&(this.delay=e.delay,this.attack=e.attack,this.hold=e.hold,this.decay=e.decay,this.sustain=e.sustain,this.release=e.release,this.keynumToHold=e.keynumToHold,this.keynumToDecay=e.keynumToDecay)}clear(){this.delay=0,this.attack=0,this.hold=0,this.decay=0,this.sustain=0,this.release=0,this.keynumToHold=0,this.keynumToDecay=0}envToSecs(e){this.delay=this.delay<-11950?0:$t.timecents2Secs(this.delay),this.attack=this.attack<-11950?0:$t.timecents2Secs(this.attack),this.release=this.release<-11950?0:$t.timecents2Secs(this.release),this.keynumToHold===0&&(this.hold=this.hold<-11950?0:$t.timecents2Secs(this.hold)),this.keynumToDecay===0&&(this.decay=this.decay<-11950?0:$t.timecents2Secs(this.decay)),this.sustain<0?this.sustain=0:e?this.sustain=$t.decibelsToGain(-this.sustain/10):this.sustain=1-this.sustain/1e3}}var Re;(function(s){s[s.StartAddrsOffset=0]="StartAddrsOffset",s[s.EndAddrsOffset=1]="EndAddrsOffset",s[s.StartloopAddrsOffset=2]="StartloopAddrsOffset",s[s.EndloopAddrsOffset=3]="EndloopAddrsOffset",s[s.StartAddrsCoarseOffset=4]="StartAddrsCoarseOffset",s[s.ModLfoToPitch=5]="ModLfoToPitch",s[s.VibLfoToPitch=6]="VibLfoToPitch",s[s.ModEnvToPitch=7]="ModEnvToPitch",s[s.InitialFilterFc=8]="InitialFilterFc",s[s.InitialFilterQ=9]="InitialFilterQ",s[s.ModLfoToFilterFc=10]="ModLfoToFilterFc",s[s.ModEnvToFilterFc=11]="ModEnvToFilterFc",s[s.EndAddrsCoarseOffset=12]="EndAddrsCoarseOffset",s[s.ModLfoToVolume=13]="ModLfoToVolume",s[s.Unused1=14]="Unused1",s[s.ChorusEffectsSend=15]="ChorusEffectsSend",s[s.ReverbEffectsSend=16]="ReverbEffectsSend",s[s.Pan=17]="Pan",s[s.Unused2=18]="Unused2",s[s.Unused3=19]="Unused3",s[s.Unused4=20]="Unused4",s[s.DelayModLFO=21]="DelayModLFO",s[s.FreqModLFO=22]="FreqModLFO",s[s.DelayVibLFO=23]="DelayVibLFO",s[s.FreqVibLFO=24]="FreqVibLFO",s[s.DelayModEnv=25]="DelayModEnv",s[s.AttackModEnv=26]="AttackModEnv",s[s.HoldModEnv=27]="HoldModEnv",s[s.DecayModEnv=28]="DecayModEnv",s[s.SustainModEnv=29]="SustainModEnv",s[s.ReleaseModEnv=30]="ReleaseModEnv",s[s.KeynumToModEnvHold=31]="KeynumToModEnvHold",s[s.KeynumToModEnvDecay=32]="KeynumToModEnvDecay",s[s.DelayVolEnv=33]="DelayVolEnv",s[s.AttackVolEnv=34]="AttackVolEnv",s[s.HoldVolEnv=35]="HoldVolEnv",s[s.DecayVolEnv=36]="DecayVolEnv",s[s.SustainVolEnv=37]="SustainVolEnv",s[s.ReleaseVolEnv=38]="ReleaseVolEnv",s[s.KeynumToVolEnvHold=39]="KeynumToVolEnvHold",s[s.KeynumToVolEnvDecay=40]="KeynumToVolEnvDecay",s[s.Instrument=41]="Instrument",s[s.Reserved1=42]="Reserved1",s[s.KeyRange=43]="KeyRange",s[s.VelRange=44]="VelRange",s[s.StartloopAddrsCoarseOffset=45]="StartloopAddrsCoarseOffset",s[s.Keynum=46]="Keynum",s[s.Velocity=47]="Velocity",s[s.InitialAttenuation=48]="InitialAttenuation",s[s.Reserved2=49]="Reserved2",s[s.EndloopAddrsCoarseOffset=50]="EndloopAddrsCoarseOffset",s[s.CoarseTune=51]="CoarseTune",s[s.FineTune=52]="FineTune",s[s.SampleID=53]="SampleID",s[s.SampleModes=54]="SampleModes",s[s.Reserved3=55]="Reserved3",s[s.ScaleTuning=56]="ScaleTuning",s[s.ExclusiveClass=57]="ExclusiveClass",s[s.OverridingRootKey=58]="OverridingRootKey",s[s.Unused5=59]="Unused5",s[s.EndOper=60]="EndOper"})(Re||(Re={}));class ya{constructor(e){this.loopMode=Xa.None,this.samples=ya.NoSamples,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv=new pl,this.modEnv=new pl,this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,e&&(this.loopMode=e.loopMode,this.samples=e.samples,this.sampleRate=e.sampleRate,this.loKey=e.loKey,this.hiKey=e.hiKey,this.loVel=e.loVel,this.hiVel=e.hiVel,this.group=e.group,this.offset=e.offset,this.end=e.end,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.transpose=e.transpose,this.tune=e.tune,this.pitchKeyCenter=e.pitchKeyCenter,this.pitchKeyTrack=e.pitchKeyTrack,this.attenuation=e.attenuation,this.pan=e.pan,this.ampEnv=new pl(e.ampEnv),this.modEnv=new pl(e.modEnv),this.initialFilterQ=e.initialFilterQ,this.initialFilterFc=e.initialFilterFc,this.modEnvToPitch=e.modEnvToPitch,this.modEnvToFilterFc=e.modEnvToFilterFc,this.modLfoToFilterFc=e.modLfoToFilterFc,this.modLfoToVolume=e.modLfoToVolume,this.delayModLFO=e.delayModLFO,this.freqModLFO=e.freqModLFO,this.modLfoToPitch=e.modLfoToPitch,this.delayVibLFO=e.delayVibLFO,this.freqVibLFO=e.freqVibLFO,this.vibLfoToPitch=e.vibLfoToPitch)}clear(e){this.loopMode=Xa.None,this.samples=ya.NoSamples,this.sampleRate=0,this.loKey=0,this.hiKey=0,this.loVel=0,this.hiVel=0,this.group=0,this.offset=0,this.end=0,this.loopStart=0,this.loopEnd=0,this.transpose=0,this.tune=0,this.pitchKeyCenter=0,this.pitchKeyTrack=0,this.attenuation=0,this.pan=0,this.ampEnv.clear(),this.modEnv.clear(),this.initialFilterQ=0,this.initialFilterFc=0,this.modEnvToPitch=0,this.modEnvToFilterFc=0,this.modLfoToFilterFc=0,this.modLfoToVolume=0,this.delayModLFO=0,this.freqModLFO=0,this.modLfoToPitch=0,this.delayVibLFO=0,this.freqVibLFO=0,this.vibLfoToPitch=0,this.hiKey=127,this.hiVel=127,this.pitchKeyCenter=60,!e&&(this.pitchKeyTrack=100,this.pitchKeyCenter=-1,this.ampEnv.delay=-12e3,this.ampEnv.attack=-12e3,this.ampEnv.hold=-12e3,this.ampEnv.decay=-12e3,this.ampEnv.release=-12e3,this.modEnv.delay=-12e3,this.modEnv.attack=-12e3,this.modEnv.hold=-12e3,this.modEnv.decay=-12e3,this.modEnv.release=-12e3,this.initialFilterFc=13500,this.delayModLFO=-12e3,this.delayVibLFO=-12e3)}operator(e,t){switch(e){case Re.StartAddrsOffset:this.offset+=de.int16ToUint32(t.shortAmount);break;case Re.EndAddrsOffset:this.end+=de.int16ToUint32(t.shortAmount);break;case Re.StartloopAddrsOffset:this.loopStart+=de.int16ToUint32(t.shortAmount);break;case Re.EndloopAddrsOffset:this.loopEnd+=de.int16ToUint32(t.shortAmount);break;case Re.StartAddrsCoarseOffset:this.offset+=de.int16ToUint32(t.shortAmount)*32768;break;case Re.ModLfoToPitch:this.modLfoToPitch=t.shortAmount;break;case Re.VibLfoToPitch:this.vibLfoToPitch=t.shortAmount;break;case Re.ModEnvToPitch:this.modEnvToPitch=t.shortAmount;break;case Re.InitialFilterFc:this.initialFilterFc=t.shortAmount;break;case Re.InitialFilterQ:this.initialFilterQ=t.shortAmount;break;case Re.ModLfoToFilterFc:this.modLfoToFilterFc=t.shortAmount;break;case Re.ModEnvToFilterFc:this.modEnvToFilterFc=t.shortAmount;break;case Re.EndAddrsCoarseOffset:this.end+=de.int16ToUint32(t.shortAmount)*32768;break;case Re.ModLfoToVolume:this.modLfoToVolume=t.shortAmount;break;case Re.Pan:this.pan=t.shortAmount/1e3;break;case Re.DelayModLFO:this.delayModLFO=t.shortAmount;break;case Re.FreqModLFO:this.freqModLFO=t.shortAmount;break;case Re.DelayVibLFO:this.delayVibLFO=t.shortAmount;break;case Re.FreqVibLFO:this.freqVibLFO=t.shortAmount;break;case Re.DelayModEnv:this.modEnv.delay=t.shortAmount;break;case Re.AttackModEnv:this.modEnv.attack=t.shortAmount;break;case Re.HoldModEnv:this.modEnv.hold=t.shortAmount;break;case Re.DecayModEnv:this.modEnv.decay=t.shortAmount;break;case Re.SustainModEnv:this.modEnv.sustain=t.shortAmount;break;case Re.ReleaseModEnv:this.modEnv.release=t.shortAmount;break;case Re.KeynumToModEnvHold:this.modEnv.keynumToHold=t.shortAmount;break;case Re.KeynumToModEnvDecay:this.modEnv.keynumToDecay=t.shortAmount;break;case Re.DelayVolEnv:this.ampEnv.delay=t.shortAmount;break;case Re.AttackVolEnv:this.ampEnv.attack=t.shortAmount;break;case Re.HoldVolEnv:this.ampEnv.hold=t.shortAmount;break;case Re.DecayVolEnv:this.ampEnv.decay=t.shortAmount;break;case Re.SustainVolEnv:this.ampEnv.sustain=t.shortAmount;break;case Re.ReleaseVolEnv:this.ampEnv.release=t.shortAmount;break;case Re.KeynumToVolEnvHold:this.ampEnv.keynumToHold=t.shortAmount;break;case Re.KeynumToVolEnvDecay:this.ampEnv.keynumToDecay=t.shortAmount;break;case Re.KeyRange:this.loKey=t.lowByteAmount,this.hiKey=t.highByteAmount;break;case Re.VelRange:this.loVel=t.lowByteAmount,this.hiVel=t.highByteAmount;break;case Re.StartloopAddrsCoarseOffset:this.loopStart+=de.int16ToUint32(t.shortAmount)*32768;break;case Re.InitialAttenuation:this.attenuation+=t.shortAmount*.1;break;case Re.EndloopAddrsCoarseOffset:this.loopEnd+=de.int16ToUint32(t.shortAmount)*32768;break;case Re.CoarseTune:this.transpose+=t.shortAmount;break;case Re.FineTune:this.tune+=t.shortAmount;break;case Re.SampleModes:this.loopMode=(t.wordAmount&3)===3?Xa.Sustain:(t.wordAmount&3)===1?Xa.Continuous:Xa.None;break;case Re.ScaleTuning:this.pitchKeyTrack=t.shortAmount;break;case Re.ExclusiveClass:this.group=t.wordAmount;break;case Re.OverridingRootKey:this.pitchKeyCenter=t.shortAmount;break}}}ya.NoSamples=new Float32Array(0);var Ze;(function(s){s[s.None=0]="None",s[s.Delay=1]="Delay",s[s.Attack=2]="Attack",s[s.Hold=3]="Hold",s[s.Decay=4]="Decay",s[s.Sustain=5]="Sustain",s[s.Release=6]="Release",s[s.Done=7]="Done"})(Ze||(Ze={}));class uh{constructor(){this.level=0,this.slope=0,this.samplesUntilNextSegment=0,this.segment=Ze.None,this.midiVelocity=0,this.parameters=null,this.segmentIsExponential=!1,this.isAmpEnv=!1}nextSegment(e,t){if(this.parameters)for(;;)switch(e){case Ze.None:if(this.samplesUntilNextSegment=this.parameters.delay*t|0,this.samplesUntilNextSegment>0){this.segment=Ze.Delay,this.segmentIsExponential=!1,this.level=0,this.slope=0;return}e=Ze.Delay;break;case Ze.Delay:if(this.samplesUntilNextSegment=this.parameters.attack*t|0,this.samplesUntilNextSegment>0){this.isAmpEnv||(this.samplesUntilNextSegment=this.parameters.attack*((145-this.midiVelocity)/144)*t|0),this.segment=Ze.Attack,this.segmentIsExponential=!1,this.level=0,this.slope=1/this.samplesUntilNextSegment;return}e=Ze.Attack;break;case Ze.Attack:if(this.samplesUntilNextSegment=this.parameters.hold*t|0,this.samplesUntilNextSegment>0){this.segment=Ze.Hold,this.segmentIsExponential=!1,this.level=1,this.slope=0;return}e=Ze.Hold;break;case Ze.Hold:if(this.samplesUntilNextSegment=this.parameters.decay*t|0,this.samplesUntilNextSegment>0){if(this.segment=Ze.Decay,this.level=1,this.isAmpEnv){const i=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(i),this.segmentIsExponential=!0,this.parameters.sustain>0&&(this.samplesUntilNextSegment=Math.log(this.parameters.sustain)/i|0)}else this.slope=-1/this.samplesUntilNextSegment,this.samplesUntilNextSegment=this.parameters.decay*(1-this.parameters.sustain)*t|0,this.segmentIsExponential=!1;return}e=Ze.Decay;break;case Ze.Decay:this.segment=Ze.Sustain,this.level=this.parameters.sustain,this.slope=0,this.samplesUntilNextSegment=2147483647,this.segmentIsExponential=!1;return;case Ze.Sustain:if(this.segment=Ze.Release,this.samplesUntilNextSegment=(this.parameters.release<=0?uh.FastReleaseTime:this.parameters.release)*t|0,this.isAmpEnv){const i=-9.226/this.samplesUntilNextSegment;this.slope=Math.exp(i),this.segmentIsExponential=!0}else this.slope=-this.level/this.samplesUntilNextSegment,this.segmentIsExponential=!1;return;default:this.segment=Ze.Done,this.segmentIsExponential=!1,this.level=0,this.slope=0,this.samplesUntilNextSegment=134217727;return}}setup(e,t,i,a,n){this.parameters=new pl(e),this.parameters.keynumToHold>0&&(this.parameters.hold+=this.parameters.keynumToHold*(60-t),this.parameters.hold=this.parameters.hold<-1e4?0:$t.timecents2Secs(this.parameters.hold)),this.parameters.keynumToDecay>0&&(this.parameters.decay+=this.parameters.keynumToDecay*(60-t),this.parameters.decay=this.parameters.decay<-1e4?0:$t.timecents2Secs(this.parameters.decay)),this.midiVelocity=i|0,this.isAmpEnv=a,this.nextSegment(Ze.None,n)}process(e,t){this.slope>0&&(this.segmentIsExponential?this.level*=Math.pow(this.slope,e):this.level+=this.slope*e),this.samplesUntilNextSegment-=e,this.samplesUntilNextSegment<=0&&this.nextSegment(this.segment,t)}}uh.FastReleaseTime=.01;class Ry{constructor(){this.samplesUntil=0,this.level=0,this.delta=0}setup(e,t,i){this.samplesUntil=e*i|0,this.delta=4*$t.cents2Hertz(t)/i,this.level=0}process(e){if(this.samplesUntil>e){this.samplesUntil-=e;return}this.level+=this.delta*e,this.level>1?(this.delta=-this.delta,this.level=2-this.level):this.level<-1&&(this.delta=-this.delta,this.level=-2-this.level)}}class Oy{constructor(e){this.qInv=0,this.a0=0,this.a1=0,this.b1=0,this.b2=0,this.z1=0,this.z2=0,this.active=!1,e&&(this.qInv=e.qInv,this.a0=e.a0,this.a1=e.a1,this.b1=e.b1,this.b2=e.b2,this.z1=e.z1,this.z2=e.z2,this.active=e.active)}setup(e){const t=Math.tan(Math.PI*e),i=t*t,a=1/(1+t*this.qInv+i);this.a0=i*a,this.a1=2*this.a0,this.b1=2*(i-1)*a,this.b2=(1-t*this.qInv+i)*a}process(e){const t=e*this.a0+this.z1;return this.z1=e*this.a1+this.z2-this.b1*t,this.z2=e*this.a0-this.b2*t,t}}class dh{constructor(){this.playingPreset=0,this.playingKey=0,this.playingChannel=0,this.region=null,this.pitchInputTimecents=0,this.pitchOutputFactor=0,this.sourceSamplePosition=0,this.noteGainDb=0,this.panFactorLeft=0,this.panFactorRight=0,this.playIndex=0,this.loopStart=0,this.loopEnd=0,this.ampEnv=new uh,this.modEnv=new uh,this.lowPass=new Oy,this.modLfo=new Ry,this.vibLfo=new Ry,this.mixVolume=0,this.mute=!1}updatePitchRatio(e,t){let i=e.pitchWheel;e.perNotePitchWheel.has(this.playingKey)&&(i+=e.perNotePitchWheel.get(this.playingKey)-8192);const a=i===8192?e.tuning:i/16383*e.pitchRange*2-e.pitchRange+e.tuning;this.calcPitchRatio(a,t)}calcPitchRatio(e,t){if(!this.region)return;const i=this.playingKey+this.region.transpose+this.region.tune/100;let a=this.region.pitchKeyCenter+(i-this.region.pitchKeyCenter)*(this.region.pitchKeyTrack/100);e!==0&&(a+=e),this.pitchInputTimecents=a*100,this.pitchOutputFactor=this.region.sampleRate/($t.timecents2Secs(this.region.pitchKeyCenter*100)*t)}end(e){this.region&&(this.ampEnv.nextSegment(Ze.Sustain,e),this.modEnv.nextSegment(Ze.Sustain,e),this.region.loopMode===Xa.Sustain&&(this.loopEnd=this.loopStart))}endQuick(e){this.ampEnv.parameters.release=0,this.ampEnv.nextSegment(Ze.Sustain,e),this.modEnv.parameters.release=0,this.modEnv.nextSegment(Ze.Sustain,e)}render(e,t,i,a,n){if(!this.region)return;const r=this.region,o=r.samples;let l=0,h=e.outputMode===br.StereoUnweaved?a:-1;const c=r.modEnvToPitch!==0||r.modEnvToFilterFc!==0,d=this.modLfo.delta>0&&(r.modLfoToPitch!==0||r.modLfoToFilterFc!==0||r.modLfoToVolume!==0),f=this.vibLfo.delta>0&&r.vibLfoToPitch!==0,p=this.loopStart<this.loopEnd,g=this.loopStart,m=this.loopEnd,T=r.end,S=m+1;let y=this.sourceSamplePosition;const b=new Oy(this.lowPass),B=r.modLfoToFilterFc!==0||r.modEnvToFilterFc!==0;let N=0,L=0,_=0,A=0;const J=r.modLfoToPitch!==0||r.modEnvToPitch!==0||r.vibLfoToPitch!==0;let G=0,ee=0,Ce=0,at=0;const ht=r.modLfoToVolume!==0;let Qi=0,K=0;for(B?(N=e.outSampleRate,L=r.initialFilterFc,_=r.modLfoToFilterFc,A=r.modEnvToFilterFc):(N=0,L=0,_=0,A=0),J?(G=0,ee=r.modLfoToPitch,Ce=r.vibLfoToPitch,at=r.modEnvToPitch):(G=$t.timecents2Secs(this.pitchInputTimecents)*this.pitchOutputFactor,ee=0,Ce=0,at=0),ht?K=r.modLfoToVolume*.1:(Qi=$t.decibelsToGain(this.noteGainDb),K=0);a>0;){let Se,Me,gt=0,nt=a>dh.RenderEffectSampleBlock?dh.RenderEffectSampleBlock:a;if(a-=nt,B){const Lt=L+this.modLfo.level*_+this.modEnv.level*A;b.active=Lt<=13500,b.active&&b.setup($t.cents2Hertz(Lt)/N)}switch(J&&(G=$t.timecents2Secs(this.pitchInputTimecents+(this.modLfo.level*ee+this.vibLfo.level*Ce+this.modEnv.level*at))*this.pitchOutputFactor),ht&&(Qi=$t.decibelsToGain(this.noteGainDb+this.modLfo.level*K)),Se=Qi*this.ampEnv.level,n?Se=0:Se*=this.mixVolume,this.ampEnv.process(nt,e.outSampleRate),c&&this.modEnv.process(nt,e.outSampleRate),d&&this.modLfo.process(nt),f&&this.vibLfo.process(nt),e.outputMode){case br.StereoInterleaved:for(Me=Se*this.panFactorLeft,gt=Se*this.panFactorRight;nt-- >0&&y<T;){const Lt=y|0,us=Lt>=m&&p?g:Lt+1,ds=y-Lt;let Gt=o[Lt]*(1-ds)+o[us]*ds;b.active&&(Gt=b.process(Gt)),t[i+l]+=Gt*Me,l++,t[i+l]+=Gt*gt,l++,y+=G,y>=S&&p&&(y-=m-g+1)}break;case br.StereoUnweaved:for(Me=Se*this.panFactorLeft,gt=Se*this.panFactorRight;nt-- >0&&y<T;){const Lt=y|0,us=Lt>=m&&p?g:Lt+1,ds=y-Lt;let Gt=o[Lt]*(1-ds)+o[us]*ds;b.active&&(Gt=b.process(Gt)),t[i+l]+=Gt*Me,l++,t[i+h]+=Gt*gt,h++,y+=G,y>=S&&p&&(y-=m-g+1)}break;case br.Mono:for(;nt-- >0&&y<T;){const Lt=y|0,us=Lt>=m&&p?g:Lt+1,ds=y-Lt;let Gt=o[Lt]*(1-ds)+o[us]*ds;b.active&&(Gt=b.process(Gt)),t[i+l]=Gt*Se,l++,y+=G,y>=S&&p&&(y-=m-g+1)}break}if(y>=T||this.ampEnv.segment===Ze.Done){this.kill();return}}this.sourceSamplePosition=y,(b.active||B)&&(this.lowPass=b)}kill(){this.playingPreset=-1}}dh.RenderEffectSampleBlock=te.MicroBufferSize;class pv{constructor(e){this.value=e}}class Fg{get isEmpty(){return this._head===void 0}clear(){this._head=void 0,this._tail=void 0}enqueue(e){const t=new pv(e);this._tail?(this._tail.next=t,this._tail=t):(this._head=t,this._tail=t)}peek(){const e=this._head;if(e)return e.value}dequeue(){const e=this._head;if(!e)return;const t=e.next;return this._head=t,t||(this._tail=void 0),e.value}}var je;(function(s){s[s.BankSelectCoarse=0]="BankSelectCoarse",s[s.ModulationCoarse=1]="ModulationCoarse",s[s.DataEntryCoarse=6]="DataEntryCoarse",s[s.VolumeCoarse=7]="VolumeCoarse",s[s.PanCoarse=10]="PanCoarse",s[s.ExpressionControllerCoarse=11]="ExpressionControllerCoarse",s[s.BankSelectFine=32]="BankSelectFine",s[s.ModulationFine=33]="ModulationFine",s[s.DataEntryFine=38]="DataEntryFine",s[s.VolumeFine=39]="VolumeFine",s[s.PanFine=42]="PanFine",s[s.ExpressionControllerFine=43]="ExpressionControllerFine",s[s.HoldPedal=64]="HoldPedal",s[s.LegatoPedal=68]="LegatoPedal",s[s.NonRegisteredParameterFine=98]="NonRegisteredParameterFine",s[s.NonRegisteredParameterCourse=99]="NonRegisteredParameterCourse",s[s.RegisteredParameterFine=100]="RegisteredParameterFine",s[s.RegisteredParameterCourse=101]="RegisteredParameterCourse",s[s.AllSoundOff=120]="AllSoundOff",s[s.ResetControllers=121]="ResetControllers",s[s.AllNotesOff=123]="AllNotesOff"})(je||(je={}));class id{constructor(e){this._midiEventQueue=new Fg,this._mutedChannels=new Map,this._soloChannels=new Map,this._isAnySolo=!1,this._transpositionPitches=new Map,this._liveTranspositionPitches=new Map,this.currentTempo=0,this.timeSignatureNumerator=0,this.timeSignatureDenominator=0,this.presets=null,this._voices=[],this._channels=null,this._voicePlayIndex=0,this.outputMode=br.StereoInterleaved,this.outSampleRate=0,this.globalGainDb=0,this.outSampleRate=e}synthesize(e,t,i){return this.fillWorkingBuffer(e,t,i)}synthesizeSilent(e){this.fillWorkingBuffer(null,0,e)}channelGetMixVolume(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].mixVolume:1}channelSetMixVolume(e,t){const i=this.channelInit(e);for(const a of this._voices)a.playingChannel===e&&a.playingPreset!==-1&&(a.mixVolume=t);i.mixVolume=t}channelSetMute(e,t){t?this._mutedChannels.set(e,!0):this._mutedChannels.delete(e)}channelSetSolo(e,t){t?this._soloChannels.set(e,!0):this._soloChannels.delete(e),this._isAnySolo=this._soloChannels.size>0}resetChannelStates(){this._mutedChannels=new Map,this._soloChannels=new Map,this._liveTranspositionPitches=new Map,this.applyTranspositionPitches(new Map),this._isAnySolo=!1}setChannelTranspositionPitch(e,t){let i=0;this._liveTranspositionPitches.has(e)&&(i=this._liveTranspositionPitches.get(e)),t===0?this._liveTranspositionPitches.delete(e):this._liveTranspositionPitches.set(e,t);for(const a of this._voices)if(a.playingChannel===e&&a.playingChannel!==9){let n=0;n-=i,n+=t,a.playingKey+=n,this._channels&&a.updatePitchRatio(this._channels.channelList[a.playingChannel],this.outSampleRate)}}applyTranspositionPitches(e){const t=this._transpositionPitches;for(const i of this._voices)if(i.playingChannel>=0&&i.playingChannel!==9){let a=0;t.has(i.playingChannel)&&(a-=t.get(i.playingChannel)),e.has(i.playingChannel)&&(a+=e.get(i.playingChannel)),i.playingKey+=a,this._channels&&i.updatePitchRatio(this._channels.channelList[i.playingChannel],this.outSampleRate)}this._transpositionPitches=e}dispatchEvent(e){this._midiEventQueue.enqueue(e)}fillWorkingBuffer(e,t,i){const a=this._isAnySolo,n=[];for(;!this._midiEventQueue.isEmpty;){const r=this._midiEventQueue.dequeue();r.isMetronome&&this.metronomeVolume>0?(this.channelNoteOff(te.MetronomeChannel,te.MetronomeKey),this.channelNoteOn(te.MetronomeChannel,te.MetronomeKey,95/127)):r.event&&this.processMidiMessage(r.event),n.push(r)}for(const r of this._voices)if(r.playingPreset!==-1){const o=r.playingChannel,l=this._mutedChannels.has(o)||a&&o!==te.MetronomeChannel&&!this._soloChannels.has(o);e?r.render(this,e,t,i,l):r.kill()}return n}processMidiMessage(e){switch(e.type){case Fe.TimeSignature:const i=e;this.timeSignatureNumerator=i.numerator,this.timeSignatureDenominator=Math.pow(2,i.denominatorIndex);break;case Fe.NoteOn:const a=e;this.channelNoteOn(a.channel,a.noteKey,a.noteVelocity/127);break;case Fe.NoteOff:const n=e;this.channelNoteOff(n.channel,n.noteKey);break;case Fe.ControlChange:const r=e;this.channelMidiControl(r.channel,r.controller,r.value);break;case Fe.ProgramChange:const o=e;this.channelSetPresetNumber(o.channel,o.program,o.channel===9);break;case Fe.TempoChange:const l=e;this.currentTempo=l.beatsPerMinute;break;case Fe.PitchBend:const h=e;this.channelSetPitchWheel(h.channel,h.value);break;case Fe.PerNotePitchBend:const c=e;let d=c.value;d=d*te.MaxPitchWheel/te.MaxPitchWheel20,this.channelSetPerNotePitchWheel(c.channel,c.noteKey,d);break}}get metronomeVolume(){return this.channelGetMixVolume(te.MetronomeChannel)}set metronomeVolume(e){this.setupMetronomeChannel(e)}setupMetronomeChannel(e){this.channelSetMixVolume(te.MetronomeChannel,e),e>0&&(this.channelSetVolume(te.MetronomeChannel,1),this.channelSetPresetNumber(te.MetronomeChannel,0,!0))}get masterVolume(){return $t.decibelsToGain(this.globalGainDb)}set masterVolume(e){const t=$t.gainToDecibels(e),i=t-this.globalGainDb;if(i!==0){for(const a of this._voices)a.playingPreset!==-1&&(a.noteGainDb+=i);this.globalGainDb=t}}resetSoft(){for(const e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<Ze.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);if(this._channels)for(const e of this._channels.channelList)e.presetIndex=0,e.bank=0,e.pitchWheel=8192,e.midiPan=8192,e.perNotePitchWheel.clear(),e.midiVolume=16383,e.midiExpression=16383,e.midiRpn=65535,e.midiData=0,e.panOffset=0,e.gainDb=0,e.pitchRange=2,e.tuning=0}get presetCount(){var e;return((e=this.presets)==null?void 0:e.length)??0}reset(){for(const e of this._voices)e.playingPreset!==-1&&(e.ampEnv.segment<Ze.Release||e.ampEnv.parameters.release!==0)&&e.endQuick(this.outSampleRate);this._channels=null}setOutput(e,t,i){this.outputMode=e,this.outSampleRate=t>=1?t:44100,this.globalGainDb=i}noteOn(e,t,i){if(!this.presets)return;const a=i*127|0;if(e<0||e>=this.presets.length)return;if(i<=0){this.noteOff(e,t);return}const n=this._voicePlayIndex++;for(const r of this.presets[e].regions){if(t<r.loKey||t>r.hiKey||a<r.loVel||a>r.hiVel)continue;let o=null;if(r.group!==0)for(const c of this._voices)c.playingPreset===e&&c.region.group===r.group?c.endQuick(this.outSampleRate):c.playingPreset===-1&&!o&&(o=c);else for(const c of this._voices)c.playingPreset===-1&&(o=c);if(!o){for(let c=0;c<4;c++){const d=new dh;d.playingPreset=-1,this._voices.push(d)}o=this._voices[this._voices.length-4]}o.region=r,o.playingPreset=e,o.playingKey=t,o.playIndex=n,o.noteGainDb=this.globalGainDb-r.attenuation-$t.gainToDecibels(1/i),this._channels?this._channels.setupVoice(this,o):(o.calcPitchRatio(0,this.outSampleRate),o.panFactorLeft=Math.sqrt(.5-r.pan),o.panFactorRight=Math.sqrt(.5+r.pan)),o.sourceSamplePosition=r.offset;const l=r.loopMode!==Xa.None&&r.loopStart<r.loopEnd;o.loopStart=l?r.loopStart:0,o.loopEnd=l?r.loopEnd:0,o.ampEnv.setup(r.ampEnv,t,a,!0,this.outSampleRate),o.modEnv.setup(r.modEnv,t,a,!1,this.outSampleRate);const h=r.initialFilterQ/10;o.lowPass.qInv=1/Math.pow(10,h/20),o.lowPass.z1=0,o.lowPass.z2=0,o.lowPass.active=r.initialFilterFc<=13500,o.lowPass.active&&o.lowPass.setup($t.cents2Hertz(r.initialFilterFc)/this.outSampleRate),o.modLfo.setup(r.delayModLFO,r.freqModLFO,this.outSampleRate),o.vibLfo.setup(r.delayVibLFO,r.freqVibLFO,this.outSampleRate)}}bankNoteOn(e,t,i,a){const n=this.getPresetIndex(e,t);return n===-1?!1:(this.noteOn(n,i,a),!0)}noteOff(e,t){let i=null,a=null;const n=[];for(const r of this._voices)r.playingPreset!==e||r.playingKey!==t||r.ampEnv.segment>=Ze.Release||(!i||r.playIndex<i.playIndex?(i=r,a=r,n.push(r)):r.playIndex===i.playIndex&&(a=r,n.push(r)));if(i)for(const r of n)r!==i&&r!==a&&(r.playIndex!==i.playIndex||r.playingPreset!==e||r.playingKey!==t||r.ampEnv.segment>=Ze.Release)||r.end(this.outSampleRate)}bankNoteOff(e,t,i){const a=this.getPresetIndex(e,t);return a===-1?!1:(this.noteOff(a,i),!0)}noteOffAll(e){for(const t of this._voices)t.playingPreset!==-1&&(e?t.endQuick(this.outSampleRate):t.ampEnv.segment<Ze.Release&&t.end(this.outSampleRate))}get activeVoiceCount(){let e=0;for(const t of this._voices)t.playingPreset!==-1&&e++;return e}channelInit(e){if(this._channels&&e<this._channels.channelList.length)return this._channels.channelList[e];this._channels||(this._channels=new dv);for(let t=this._channels.channelList.length;t<=e;t++){const i=new uv;i.presetIndex=0,i.bank=0,i.pitchWheel=8192,i.midiPan=8192,i.midiVolume=16383,i.midiExpression=16383,i.midiRpn=65535,i.midiData=0,i.panOffset=0,i.gainDb=0,i.pitchRange=2,i.tuning=0,i.mixVolume=1,this._channels.channelList.push(i)}return this._channels.channelList[e]}getPresetIndex(e,t){if(!this.presets)return-1;for(let i=this.presets.length-1;i>=0;i--){const a=this.presets[i];if(a.presetNumber===t&&a.bank===e)return i}return-1}getPresetName(e){return this.presets?e<0||e>=this.presets.length?null:this.presets[e].name:null}bankGetPresetName(e,t){return this.getPresetName(this.getPresetIndex(e,t))}channelNoteOn(e,t,i){!this._channels||e>this._channels.channelList.length||(this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e)),this._channels.activeChannel=e,this.noteOn(this._channels.channelList[e].presetIndex,t,i))}channelNoteOff(e,t){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const i=[];let a=null,n=null;for(const o of this._voices)o.playingPreset===-1||o.playingChannel!==e||o.playingKey!==t||o.ampEnv.segment>=Ze.Release||(!a||o.playIndex<a.playIndex?(a=o,n=o,i.push(o)):o.playIndex===a.playIndex&&(n=o,i.push(o)));if(this.channelInit(e).perNotePitchWheel.delete(t),!!a)for(const o of i)o!==a&&o!==n&&(o.playIndex!==a.playIndex||o.playingPreset===-1||o.playingChannel!==e||o.playingKey!==t||o.ampEnv.segment>=Ze.Release)||o.end(this.outSampleRate)}channelNoteOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(const i of this._voices)i.playingPreset!==-1&&i.playingChannel===e&&i.ampEnv.segment<Ze.Release&&i.end(this.outSampleRate)}channelSoundsOffAll(e){this.channelInit(e).perNotePitchWheel.clear();for(const i of this._voices)i.playingPreset!==-1&&i.playingChannel===e&&(i.ampEnv.segment<Ze.Release||i.ampEnv.parameters.release===0)&&i.endQuick(this.outSampleRate)}channelSetPresetIndex(e,t){this.channelInit(e).presetIndex=de.int32ToUint16(t)}channelSetPresetNumber(e,t,i=!1){const a=this.channelInit(e);let n=0;return i?(n=this.getPresetIndex(128|a.bank&32767,t),n===-1&&(n=this.getPresetIndex(128,t)),n===-1&&(n=this.getPresetIndex(128,0)),n===-1&&(n=this.getPresetIndex(a.bank&2047,t))):n=this.getPresetIndex(a.bank&2047,t),a.presetIndex=n,n!==-1}channelSetBank(e,t){this.channelInit(e).bank=de.int32ToUint16(t)}channelSetBankPreset(e,t,i){const a=this.channelInit(e),n=this.getPresetIndex(t,i);return n===-1?!1:(a.presetIndex=de.int32ToUint16(n),a.bank=de.int32ToUint16(t),!0)}channelSetPan(e,t){for(const i of this._voices)if(i.playingChannel===e&&i.playingPreset!==-1){const a=i.region.pan+t-.5;a<=-.5?(i.panFactorLeft=1,i.panFactorRight=0):a>=.5?(i.panFactorLeft=0,i.panFactorRight=1):(i.panFactorLeft=Math.sqrt(.5-a),i.panFactorRight=Math.sqrt(.5+a))}this.channelInit(e).panOffset=t-.5}channelSetVolume(e,t){const i=this.channelInit(e),a=$t.gainToDecibels(t),n=a-i.gainDb;if(n!==0){for(const r of this._voices)r.playingChannel===e&&r.playingPreset!==-1&&(r.noteGainDb+=n);i.gainDb=a}}channelSetPitchWheel(e,t){const i=this.channelInit(e);i.pitchWheel!==t&&(i.pitchWheel=de.int32ToUint16(t),this.channelApplyPitch(e,i))}channelSetPerNotePitchWheel(e,t,i){this._transpositionPitches.has(e)&&(t+=this._transpositionPitches.get(e)),this._liveTranspositionPitches.has(e)&&(t+=this._liveTranspositionPitches.get(e));const a=this.channelInit(e);a.perNotePitchWheel.has(t)&&a.perNotePitchWheel.get(t)===i||(a.perNotePitchWheel.set(t,i),this.channelApplyPitch(e,a,t))}channelApplyPitch(e,t,i=-1){for(const a of this._voices)a.playingChannel===e&&a.playingPreset!==-1&&(i===-1||a.playingKey===i)&&a.updatePitchRatio(t,this.outSampleRate)}channelSetPitchRange(e,t){const i=this.channelInit(e);i.pitchRange!==t&&(i.pitchRange=t,i.pitchWheel!==8192&&this.channelApplyPitch(e,i))}channelSetTuning(e,t){const i=this.channelInit(e);i.tuning!==t&&(i.tuning=t,this.channelApplyPitch(e,i))}channelMidiControl(e,t,i){const a=this.channelInit(e);switch(t){case je.DataEntryFine:a.midiData=de.int32ToUint16(a.midiData&16256|i),a.midiRpn===0?this.channelSetPitchRange(e,(a.midiData>>7)+.01*(a.midiData&127)):a.midiRpn===1?this.channelSetTuning(e,(a.tuning|0)+(a.midiData-8192)/8192):a.midiRpn===2&&this.channelSetTuning(e,i-64+(a.tuning-(a.tuning|0)));return;case je.VolumeCoarse:a.midiVolume=de.int32ToUint16(a.midiVolume&127|i<<7),this.channelSetVolume(e,Math.pow(a.midiVolume/16383*(a.midiExpression/16383),3));return;case je.VolumeFine:a.midiVolume=de.int32ToUint16(a.midiVolume&16256|i),this.channelSetVolume(e,Math.pow(a.midiVolume/16383*(a.midiExpression/16383),3));return;case je.ExpressionControllerCoarse:a.midiExpression=de.int32ToUint16(a.midiExpression&127|i<<7),this.channelSetVolume(e,Math.pow(a.midiVolume/16383*(a.midiExpression/16383),3));return;case je.ExpressionControllerFine:a.midiExpression=de.int32ToUint16(a.midiExpression&16256|i),this.channelSetVolume(e,Math.pow(a.midiVolume/16383*(a.midiExpression/16383),3));return;case je.PanCoarse:a.midiPan=de.int32ToUint16(a.midiPan&127|i<<7),this.channelSetPan(e,a.midiPan/16383);return;case je.PanFine:a.midiPan=de.int32ToUint16(a.midiPan&16256|i),this.channelSetPan(e,a.midiPan/16383);return;case je.DataEntryCoarse:a.midiData=de.int32ToUint16(a.midiData&127|i<<7),a.midiRpn===0?this.channelSetPitchRange(e,(a.midiData>>7)+.01*(a.midiData&127)):a.midiRpn===1?this.channelSetTuning(e,(a.tuning|0)+(a.midiData-8192)/8192):a.midiRpn===2&&t===je.DataEntryCoarse&&this.channelSetTuning(e,i-64+(a.tuning-(a.tuning|0)));return;case je.BankSelectCoarse:a.bank=de.int32ToUint16(32768|i);return;case je.BankSelectFine:a.bank=de.int32ToUint16((a.bank&32768?(a.bank&127)<<7:0)|i);return;case je.RegisteredParameterCourse:a.midiRpn=de.int32ToUint16((a.midiRpn===65535?0:a.midiRpn)&127|i<<7);return;case je.RegisteredParameterFine:a.midiRpn=de.int32ToUint16((a.midiRpn===65535?0:a.midiRpn)&16256|i);return;case je.NonRegisteredParameterFine:a.midiRpn=65535;return;case je.NonRegisteredParameterCourse:a.midiRpn=65535;return;case je.AllSoundOff:this.channelSoundsOffAll(e);return;case je.AllNotesOff:this.channelNoteOffAll(e);return;case je.ResetControllers:a.midiVolume=16383,a.midiExpression=16383,a.midiPan=8192,a.bank=0,this.channelSetVolume(e,1),this.channelSetPan(e,.5),this.channelSetPitchRange(e,2);return}}channelGetPresetIndex(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].presetIndex:0}channelGetPresetBank(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].bank&32767:0}channelGetPan(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].panOffset-.5:.5}channelGetVolume(e){return this._channels&&e<this._channels.channelList.length?$t.decibelsToGain(this._channels.channelList[e].gainDb):1}channelGetPitchWheel(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchWheel:8192}channelGetPitchRange(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].pitchRange:2}channelGetTuning(e){return this._channels&&e<this._channels.channelList.length?this._channels.channelList[e].tuning:0}resetPresets(){this.presets=[]}loadPresets(e,t,i,a){const n=[];for(let r=0;r<e.phdrs.length-1;r++){const o=e.phdrs[r];let l=0;const h=new fv;n.push(h),h.name=o.presetName,h.bank=o.bank,h.presetNumber=o.preset;let c=0;for(let f=o.presetBagNdx;f<e.phdrs[r+1].presetBagNdx;f++){const p=e.pbags[f];let g=0,m=127,T=0,S=127;for(let y=p.genNdx;y<e.pbags[f+1].genNdx;y++){const b=e.pgens[y];if(b.genOper===ws.GenKeyRange){g=b.genAmount.lowByteAmount,m=b.genAmount.highByteAmount;continue}if(b.genOper===ws.GenVelRange){T=b.genAmount.lowByteAmount,S=b.genAmount.highByteAmount;continue}if(b.genOper!==ws.GenInstrument||b.genAmount.wordAmount>=e.insts.length)continue;const B=e.insts[b.genAmount.wordAmount];for(let N=B.instBagNdx;N<e.insts[b.genAmount.wordAmount+1].instBagNdx;N++){const L=e.ibags[N];let _=0,A=127,J=0,G=127;for(let ee=L.instGenNdx;ee<e.ibags[N+1].instGenNdx;ee++){const Ce=e.igens[ee];if(Ce.genOper===ws.GenKeyRange){_=Ce.genAmount.lowByteAmount,A=Ce.genAmount.highByteAmount;continue}if(Ce.genOper===ws.GenVelRange){J=Ce.genAmount.lowByteAmount,G=Ce.genAmount.highByteAmount;continue}Ce.genOper===53&&A>=g&&_<=m&&G>=T&&J<=S&&c++}}}}h.regions=new Array(c);let d=new ya;d.clear(!0);for(let f=o.presetBagNdx;f<e.phdrs[r+1].presetBagNdx;f++){const p=e.pbags[f],g=new ya(d);let m=!1;for(let T=p.genNdx;T<e.pbags[f+1].genNdx;T++){const S=e.pgens[T];if(S.genOper===ws.GenInstrument){const y=S.genAmount.wordAmount;if(y>=e.insts.length)continue;let b=new ya;b.clear(!1);const B=e.insts[y];for(let N=B.instBagNdx;N<e.insts[y+1].instBagNdx;N++){const L=e.ibags[N],_=new ya(b);let A=!1;for(let J=L.instGenNdx;J<e.ibags[N+1].instGenNdx;J++){const G=e.igens[J];if(G.genOper===ws.GenSampleId){if(_.hiKey<g.loKey||_.loKey>g.hiKey||_.hiVel<g.loVel||_.loVel>g.hiVel)continue;g.loKey>_.loKey&&(_.loKey=g.loKey),g.hiKey<_.hiKey&&(_.hiKey=g.hiKey),g.loVel>_.loVel&&(_.loVel=g.loVel),g.hiVel<_.hiVel&&(_.hiVel=g.hiVel),_.offset+=g.offset,_.end+=g.end,_.loopStart+=g.loopStart,_.loopEnd+=g.loopEnd,_.transpose+=g.transpose,_.tune+=g.tune,_.pitchKeyTrack+=g.pitchKeyTrack,_.attenuation+=g.attenuation,_.pan+=g.pan,_.ampEnv.delay+=g.ampEnv.delay,_.ampEnv.attack+=g.ampEnv.attack,_.ampEnv.hold+=g.ampEnv.hold,_.ampEnv.decay+=g.ampEnv.decay,_.ampEnv.sustain+=g.ampEnv.sustain,_.ampEnv.release+=g.ampEnv.release,_.modEnv.delay+=g.modEnv.delay,_.modEnv.attack+=g.modEnv.attack,_.modEnv.hold+=g.modEnv.hold,_.modEnv.decay+=g.modEnv.decay,_.modEnv.sustain+=g.modEnv.sustain,_.modEnv.release+=g.modEnv.release,_.initialFilterQ+=g.initialFilterQ,_.initialFilterFc+=g.initialFilterFc,_.modEnvToPitch+=g.modEnvToPitch,_.modEnvToFilterFc+=g.modEnvToFilterFc,_.delayModLFO+=g.delayModLFO,_.freqModLFO+=g.freqModLFO,_.modLfoToPitch+=g.modLfoToPitch,_.modLfoToFilterFc+=g.modLfoToFilterFc,_.modLfoToVolume+=g.modLfoToVolume,_.delayVibLFO+=g.delayVibLFO,_.freqVibLFO+=g.freqVibLFO,_.vibLfoToPitch+=g.vibLfoToPitch,_.ampEnv.envToSecs(!0),_.modEnv.envToSecs(!1),_.delayModLFO=_.delayModLFO<-11950?0:$t.timecents2Secs(_.delayModLFO),_.delayVibLFO=_.delayVibLFO<-11950?0:$t.timecents2Secs(_.delayVibLFO),_.pan<-.5?_.pan=-.5:_.pan>.5&&(_.pan=.5),(_.initialFilterQ<1500||_.initialFilterQ>13500)&&(_.initialFilterQ=0);const ee=e.sHdrs[G.genAmount.wordAmount];_.offset+=ee.start,_.end+=ee.end,_.loopStart+=ee.startLoop,_.loopEnd+=ee.endLoop,ee.endLoop>0&&(_.loopEnd-=1),_.pitchKeyCenter===-1&&(_.pitchKeyCenter=ee.originalPitch),_.tune+=ee.pitchCorrection,_.sampleRate=ee.sampleRate;const Ce=o.bank===te.PercussionBank;Ce&&id.setContainsRange(i,_.loKey,_.hiKey)||!Ce&&t.has(o.preset)?ee.sampleType&1?(E.debug("AlphaSynth",`Loading of used sample ${ee.sampleName} for preset ${o.presetName} (bank ${h.bank} program ${h.presetNumber})`),(ee.sampleType&16)!==0?_.samples=e.decodeSamples(ee.start,ee.end,!0):(_.samples=e.decodeSamples(_.offset*2,_.end*2,!1),_.loopStart>0&&(_.loopStart-=_.offset),_.loopEnd>0&&(_.loopEnd-=_.offset)),_.offset=0,_.end=_.samples.length-1):(E.warning("AlphaSynth",`Skipping load of unsupported sample ${ee.sampleName} for preset ${o.presetName}, sample type ${ee.sampleType} is not supported (bank ${h.bank} program ${h.presetNumber})`),_.samples=new Float32Array(0)):(E.debug("AlphaSynth",`Skipping load of unused sample ${ee.sampleName} for preset ${o.presetName} (bank ${h.bank} program ${h.presetNumber})`),_.samples=new Float32Array(0)),h.regions[l]=new ya(_),l++,A=!0}else _.operator(G.genOper,G.genAmount)}L===e.ibags[B.instBagNdx]&&!A&&(b=new ya(_))}m=!0}else g.operator(S.genOper,S.genAmount)}p===e.pbags[o.presetBagNdx]&&!m&&(d=g)}}if(!a||!this.presets)this.presets=n;else for(const r of n)this.presets.push(r)}static setContainsRange(e,t,i){for(let a=t;a<=i;a++)if(e.has(a))return!0;return!1}hasSamplesForProgram(e){const t=this.presets;if(!t)return!1;for(const i of t)if(i.presetNumber===e){for(const a of i.regions)if(a.samples.length>0)return!0}return!1}hasSamplesForPercussion(e){const t=this.presets;if(!t)return!1;for(const i of t)if(i.bank===te.PercussionBank){for(const a of i.regions)if(a.loKey>=e&&a.hiKey<=e&&a.samples.length>0)return!0}return!1}}class Bt{constructor(e=void 0){this._listeners=[],this._fireOnRegister=e}on(e){var t;return this._listeners.push(e),(t=this._fireOnRegister)!=null&&t.call(this)&&e(),()=>{this.off(e)}}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(){for(const e of this._listeners)e()}}class we{constructor(e=void 0){this._listeners=[],this._fireOnRegister=e}on(e){if(this._listeners.push(e),this._fireOnRegister){const t=this._fireOnRegister();t!==null&&e(t)}return()=>{this.off(e)}}off(e){this._listeners=this._listeners.filter(t=>t!==e)}trigger(e){for(const t of this._listeners)t(e)}}class wk{constructor(e){this.events=e}}class su{constructor(e){this.playbackRange=e}}class gv{constructor(){this.sampleRate=44100,this.useSyncPoints=!1,this.masterVolume=1,this.metronomeVolume=0,this.trackVolume=new Map,this.trackTranspositionPitches=new Map}}class mv{constructor(){this.currentTime=0,this.endTime=0,this.currentTick=0,this.endTick=0}}class kk{get output(){return this._output}get isReadyForPlayback(){return this.isReady&&this.isSoundFontLoaded&&this._isMidiLoaded}get logLevel(){return E.logLevel}set logLevel(e){E.logLevel=e}get masterVolume(){return this.synthesizer.masterVolume}set masterVolume(e){e=Math.max(e,te.MinVolume),this.updateMasterVolume(e)}updateMasterVolume(e){this.synthesizer.masterVolume=e}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,te.MinVolume),this._metronomeVolume=e,this.synthesizer.metronomeVolume=e}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,te.MinVolume),this._countInVolume=e}get midiEventsPlayedFilter(){return Array.from(this._midiEventsPlayedFilter)}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=new Set(e)}get playbackSpeed(){return this.sequencer.playbackSpeed}set playbackSpeed(e){e=V.clamp(e,te.MinPlaybackSpeed,te.MaxPlaybackSpeed),this.updatePlaybackSpeed(e)}updatePlaybackSpeed(e){const t=this.sequencer.playbackSpeed;this.sequencer.playbackSpeed=e,this.timePosition=this.timePosition*(t/e)}get loadedMidiInfo(){return this._loadedMidiInfo}get currentPosition(){return this._currentPosition}get tickPosition(){return this._tickPosition}set tickPosition(e){this.timePosition=this.sequencer.mainTickPositionToTimePosition(e)}get timePosition(){return this._timePosition}set timePosition(e){E.debug("AlphaSynth",`Seeking to position ${e}ms (main)`),this.sequencer.mainSeek(e),this.updateTimePosition(e,!0),this.sequencer.isPlayingMain&&(this._notPlayedSamples=0,this.output.resetSamples())}get playbackRange(){return this.sequencer.mainPlaybackRange}set playbackRange(e){this.sequencer.mainPlaybackRange=e,e&&(this.tickPosition=e.startTick),this.playbackRangeChanged.trigger(new su(e))}get isLooping(){return this.sequencer.isLooping}set isLooping(e){this.sequencer.isLooping=e}destroy(){E.debug("AlphaSynth","Destroying player"),this.stop(),this.output.destroy()}constructor(e,t,i){this.isSoundFontLoaded=!1,this._isMidiLoaded=!1,this._tickPosition=0,this._timePosition=0,this._metronomeVolume=0,this._countInVolume=0,this._playedEventsQueue=new Fg,this._midiEventsPlayedFilter=new Set,this._notPlayedSamples=0,this._synthStopping=!1,this._currentPosition=new Ya(0,0,0,0,!1,120,120),this.isReady=!1,this.state=ii.Paused,this._loadedSoundFonts=[],this.readyForPlayback=new Bt,this.finished=new Bt,this.soundFontLoaded=new Bt,this.soundFontLoadFailed=new we,this.midiLoadFailed=new we,this.midiEventsPlayed=new we,E.debug("AlphaSynth","Initializing player"),this.state=ii.Paused,this.ready=new Bt(()=>this.isReady),this.readyForPlayback=new Bt(()=>this.isReadyForPlayback),this.midiLoaded=new we(()=>this._loadedMidiInfo?this._loadedMidiInfo:null),this.stateChanged=new we(()=>new co(this.state,!1)),this.positionChanged=new we(()=>this._currentPosition),this.playbackRangeChanged=new we(()=>this.playbackRange?new su(this.playbackRange):null),E.debug("AlphaSynth","Creating output"),this._output=e,E.debug("AlphaSynth","Creating synthesizer"),this.synthesizer=t,this.sequencer=new mk(this.synthesizer),E.debug("AlphaSynth","Opening output"),this.output.ready.on(()=>{this.isReady=!0,this.ready.trigger(),this.checkReadyForPlayback()}),this.output.sampleRequest.on(()=>{this.onSampleRequest()}),this.output.samplesPlayed.on(this.onSamplesPlayed.bind(this)),this.output.open(i)}onSampleRequest(){if(this.state===ii.Playing&&(!this.sequencer.isFinished||this.synthesizer.activeVoiceCount>0)){let e=new Float32Array(te.MicroBufferSize*te.MicroBufferCount*te.AudioChannels),t=0;for(let i=0;i<te.MicroBufferCount;i++){this.sequencer.fillMidiEventQueue();const a=this.synthesizer.synthesize(e,t,te.MicroBufferSize);t+=te.MicroBufferSize*te.AudioChannels;for(const n of a)this._midiEventsPlayedFilter.has(n.event.type)&&this._playedEventsQueue.enqueue(n);if(this.sequencer.isFinished)break}t<e.length&&(e=e.subarray(0,t)),this._notPlayedSamples+=e.length,this.output.addSamples(e)}else{const e=new Float32Array(0);this.output.addSamples(e)}}play(){return this.state!==ii.Paused||!this._isMidiLoaded?!1:(this.output.activate(),this.playInternal(),this._countInVolume>0&&(E.debug("AlphaSynth","Starting countin"),this.sequencer.startCountIn(),this.synthesizer.setupMetronomeChannel(this._countInVolume),this.updateTimePosition(0,!0)),this.output.play(),!0)}playInternal(){this.sequencer.isPlayingOneTimeMidi&&(E.debug("AlphaSynth","Cancelling one time midi"),this.stopOneTimeMidi()),E.debug("AlphaSynth","Starting playback"),this.synthesizer.setupMetronomeChannel(this.metronomeVolume),this._synthStopping=!1,this.state=ii.Playing,this.stateChanged.trigger(new co(this.state,!1))}pause(){this.state===ii.Paused||!this._isMidiLoaded||(E.debug("AlphaSynth","Pausing playback"),this.state=ii.Paused,this.stateChanged.trigger(new co(this.state,!1)),this.output.pause(),this.synthesizer.noteOffAll(!1))}playPause(){this.state!==ii.Paused||!this._isMidiLoaded?this.pause():this.play()}stop(){this._isMidiLoaded&&(E.debug("AlphaSynth","Stopping playback"),this.state=ii.Paused,this.output.pause(),this._notPlayedSamples=0,this.sequencer.stop(),this.synthesizer.noteOffAll(!0),this.tickPosition=this.sequencer.mainPlaybackRange?this.sequencer.mainPlaybackRange.startTick:0,this.stateChanged.trigger(new co(this.state,!0)))}playOneTimeMidiFile(e){this.sequencer.isPlayingOneTimeMidi?this.stopOneTimeMidi():this.pause(),this.sequencer.loadOneTimeMidi(e),this.synthesizer.noteOffAll(!0),this.updateTimePosition(0,!0),this._notPlayedSamples=0,this.output.resetSamples(),this.output.play()}resetSoundFonts(){this.stop(),this.synthesizer.resetPresets(),this._loadedSoundFonts=[],this.isSoundFontLoaded=!1,this.soundFontLoaded.trigger()}loadSoundFont(e,t){this.pause();const i=Dt.fromBuffer(e);try{E.debug("AlphaSynth","Loading soundfont from bytes");const a=new bk;a.load(i),t||(this._loadedSoundFonts=[]),this._loadedSoundFonts.push(a),this.isSoundFontLoaded=!0,this.soundFontLoaded.trigger(),E.debug("AlphaSynth","soundFont successfully loaded"),this.checkReadyForPlayback()}catch(a){E.error("AlphaSynth",`Could not load soundfont from bytes ${a}`),this.soundFontLoadFailed.trigger(a)}}checkReadyForPlayback(){if(this.isReadyForPlayback){this.synthesizer.setupMetronomeChannel(this.metronomeVolume);const e=this.sequencer.instrumentPrograms,t=this.sequencer.percussionKeys;let i=!1;for(const a of this._loadedSoundFonts)this.synthesizer.loadPresets(a,e,t,i),i=!0;this.readyForPlayback.trigger()}}loadMidiFile(e){this.stop();try{E.debug("AlphaSynth","Loading midi from model"),this.sequencer.loadMidi(e),this._isMidiLoaded=!0,this._loadedMidiInfo=new Ya(0,this.sequencer.currentEndTime,0,this.sequencer.currentEndTick,!1,this.sequencer.currentTempo,this.sequencer.modifiedTempo),this.midiLoaded.trigger(this._loadedMidiInfo),E.debug("AlphaSynth","Midi successfully loaded"),this.checkReadyForPlayback(),this.tickPosition=0}catch(t){E.error("AlphaSynth",`Could not load midi from model ${t}`),this.midiLoadFailed.trigger(t)}}applyTranspositionPitches(e){this.synthesizer.applyTranspositionPitches(e)}setChannelTranspositionPitch(e,t){this.synthesizer.setChannelTranspositionPitch(e,t)}setChannelMute(e,t){this.synthesizer.channelSetMute(e,t)}resetChannelStates(){this.synthesizer.resetChannelStates()}setChannelSolo(e,t){this.synthesizer.channelSetSolo(e,t)}setChannelVolume(e,t){t=Math.max(t,te.MinVolume),this.synthesizer.channelSetMixVolume(e,t)}onSamplesPlayed(e){if(e===0)return;const t=e/this.synthesizer.outSampleRate*1e3;this._notPlayedSamples-=e*te.AudioChannels,this.updateTimePosition(this._timePosition+t,!1),this.checkForFinish()}checkForFinish(){let e=0,t=0;this.playbackRange&&this.sequencer.isPlayingMain?(e=this.playbackRange.startTick,t=this.playbackRange.endTick):t=this.sequencer.currentEndTick,this._tickPosition>=t&&(this._notPlayedSamples<=0?(this._notPlayedSamples=0,this.sequencer.isPlayingCountIn?(E.debug("AlphaSynth","Finished playback (count-in)"),this.sequencer.resetCountIn(),this.timePosition=this.sequencer.currentTime,this.playInternal(),this.output.resetSamples()):this.sequencer.isPlayingOneTimeMidi?(E.debug("AlphaSynth","Finished playback (one time)"),this.output.resetSamples(),this.state=ii.Paused,this.stopOneTimeMidi()):this.isLooping?(E.debug("AlphaSynth","Finished playback (main looping)"),this.finished.trigger(),this.tickPosition=e,this._synthStopping=!1):this.synthesizer.activeVoiceCount>0?this._synthStopping||(E.debug("AlphaSynth","Signaling synth to stop all voices (all samples played)"),this.synthesizer.noteOffAll(!0),this._synthStopping=!0):(this._synthStopping=!1,E.debug("AlphaSynth","Finished playback (main)"),this.finished.trigger(),this.stop())):this._synthStopping||(E.debug("AlphaSynth","Signaling synth to stop all voices (not all samples played)"),this.synthesizer.noteOffAll(!0),this._synthStopping=!0))}stopOneTimeMidi(){this.output.pause(),this.synthesizer.noteOffAll(!0),this.sequencer.resetOneTimeMidi(),this.timePosition=this.sequencer.currentTime}createPositionChangedEventArgs(e){let t=this._timePosition,i=this.sequencer.currentTimePositionToTickPosition(t);const a=this.sequencer.currentEndTime,n=this.sequencer.currentEndTick;return t>a&&(t=a,i=n),new Ya(t,a,i,n,e,this.sequencer.currentTempo,this.sequencer.modifiedTempo)}updateTimePosition(e,t){this._timePosition=e;const i=this.createPositionChangedEventArgs(t);this._tickPosition=i.currentTick;const a=this.sequencer.isPlayingMain?"main":this.sequencer.isPlayingCountIn?"count-in":"one-time";if(E.debug("AlphaSynth",`Position changed: (time: ${i.currentTime}/${i.endTime}, tick: ${i.currentTick}/${i.endTick}, Active Voices: ${this.synthesizer.activeVoiceCount} (${a}), Tempo original: ${this.sequencer.currentTempo}, Tempo modified: ${this.sequencer.modifiedTempo})`),this.sequencer.isPlayingMain&&(this._currentPosition=i,this.positionChanged.trigger(i)),t)this._playedEventsQueue.clear();else{const n=[];for(;!this._playedEventsQueue.isEmpty&&this._playedEventsQueue.peek().time<i.currentTime;){const r=this._playedEventsQueue.dequeue();n.push(r.event)}n.length>0&&(n.reverse(),this.midiEventsPlayed.trigger(new wk(n)))}}hasSamplesForProgram(e){return this.synthesizer.hasSamplesForProgram(e)}hasSamplesForPercussion(e){return this.synthesizer.hasSamplesForPercussion(e)}loadBackingTrack(e){}updateSyncPoints(e){}}class yv extends kk{constructor(e,t){super(e,new id(e.sampleRate),t)}exportAudio(e,t,i,a){const n=new bv(e);n.loadMidiFile(t),e.useSyncPoints&&n.updateSyncPoints(i),n.applyTranspositionPitches(a);for(const[r,o]of e.trackTranspositionPitches)n.setChannelTranspositionPitch(r,o);for(const[r,o]of e.trackVolume)n.channelSetMixVolume(r,o);if(e.soundFonts)for(const r of e.soundFonts)n.loadSoundFont(r);else n.loadPresets(this.synthesizer.presets);return e.playbackRange&&n.limitExport(e.playbackRange),n.setup(),n}}class bv{constructor(e){this._generatedAudioCurrentTime=0,this._generatedAudioEndTime=0,this._synth=new id(e.sampleRate),this._sequencer=new mk(this._synth),this._synth.masterVolume=Math.max(e.masterVolume,te.MinVolume),this._synth.metronomeVolume=Math.max(e.metronomeVolume,te.MinVolume)}loadSoundFont(e){const t=Dt.fromBuffer(e),i=new bk;i.load(t);const a=this._sequencer.instrumentPrograms,n=this._sequencer.percussionKeys;this._synth.loadPresets(i,a,n,!0)}loadPresets(e){this._synth.presets=e}limitExport(e){this._sequencer.mainPlaybackRange=e,this._sequencer.mainSeek(this._sequencer.mainTickPositionToTimePosition(e.startTick))}setChannelTranspositionPitch(e,t){this._synth.setChannelTranspositionPitch(e,t)}applyTranspositionPitches(e){this._synth.applyTranspositionPitches(e)}loadMidiFile(e){this._sequencer.loadMidi(e)}updateSyncPoints(e){this._sequencer.mainUpdateSyncPoints(e)}channelSetMixVolume(e,t){t=Math.max(t,te.MinVolume),this._synth.channelSetMixVolume(e,t)}setup(){this._synth.setupMetronomeChannel(this._synth.metronomeVolume);const e=this._sequencer.currentSyncPoints,t=this._sequencer.currentEndTime;if(e.length===0)this._generatedAudioEndTime=t;else{const i=e[e.length-1];let a=i.syncTime;const n=this._sequencer.currentEndTick-i.synthTick;n>0&&(a+=v.ticksToMillis(n,i.syncBpm)),this._generatedAudioEndTime=a}}render(e){if(this._sequencer.isFinished)return;const t=te.MicroBufferSize*1e3/this._synth.outSampleRate,i=Math.ceil(e/t);let a=new Float32Array(te.MicroBufferSize*i*te.AudioChannels);const n=this._sequencer.currentSyncPoints;let r=0,o=this._generatedAudioCurrentTime,l=0;for(let c=0;c<i;c++){if(n.length>0){this._sequencer.currentUpdateSyncPoints(o),this._sequencer.currentUpdateCurrentTempo(this._sequencer.currentTime);const d=this._sequencer.syncPointTempo/this._sequencer.currentTempo;this._sequencer.playbackSpeed!==d&&(this._sequencer.playbackSpeed=d)}if(this._sequencer.fillMidiEventQueue(),this._synth.synthesize(a,r,te.MicroBufferSize),r+=te.MicroBufferSize*te.AudioChannels,o+=t,l+=t*this._sequencer.playbackSpeed,this._sequencer.isFinished)break}r<a.length&&(a=a.subarray(0,r));const h=new mv;return h.currentTime=this._generatedAudioCurrentTime,h.endTime=this._generatedAudioEndTime,h.currentTick=this._sequencer.currentTimePositionToTickPosition(this._sequencer.currentTime),h.endTick=this._sequencer.currentEndTick,this._generatedAudioCurrentTime+=e,h.samples=a,this._sequencer.isFinished&&this._synth.noteOffAll(!0),h}}class D{static parseEnum(e,t){switch(typeof e){case"string":const i=Number.parseInt(e);return Number.isNaN(i)?t[Object.keys(t).find(a=>a.toLowerCase()===e.toLowerCase())]:i;case"number":return e;case"undefined":case"object":return}throw new We(Ve.Format,`Could not parse enum value '${e}'`)}static forEach(e,t){if(e instanceof Map)e.forEach(t);else if(typeof e=="object")for(const i in e)t(e[i],i)}static getValue(e,t){return e instanceof Map?e.get(t):typeof e=="object"?e[t]:null}}class Sv{constructor(e,t,i){this.text=e,this.startPos=t,this.endPos=i}}class uo{constructor(e){this.style="normal",this.variant="normal",this.weight="normal",this.stretch="normal",this.lineHeight="normal",this.size="1rem",this.families=[],this.parseOnlyFamilies=!1,this._currentTokenIndex=-1,this._input="",this._currentToken=null,this._input=e,this._tokens=this.splitToTokens(e)}splitToTokens(e){const t=[];let i=0;for(;i<e.length;){let a=i;for(;a<e.length&&e.charAt(a)!==" ";)a++;a>i&&t.push(new Sv(e.substring(i,a),i,a)),i=a+1}return t}parse(){var e;if(this.reset(),this._tokens.length===1)switch((e=this._currentToken)==null?void 0:e.text){case"caption":case"icon":case"menu":case"message-box":case"small-caption":case"status-bar":case"inherit":return}this.parseOnlyFamilies||(this.fontStyleVariantWeight(),this.fontSizeLineHeight()),this.fontFamily()}static parseFamilies(e){const t=new uo(e);return t.parseOnlyFamilies=!0,t.parse(),t.families}fontFamily(){if(!this._currentToken){if(this.parseOnlyFamilies)return;throw new Error("Missing font list")}const e=this._input.substr(this._currentToken.startPos).trim();let t=0;for(;t<e.length;){const i=e.charAt(t);if(i===" "||i===",")t++;else if(i==='"'||i==="'"){const a=this.findEndOfQuote(e,t+1,i);this.families.push(e.substring(t+1,a).split(`\\${i}`).join(i)),t=a+1}else{const a=this.findEndOfQuote(e,t+1,",");this.families.push(e.substring(t,a).trim()),t=a+1}}}findEndOfQuote(e,t,i){let a=!1;for(;t<e.length;){const n=e.charAt(t);if(!a&&n===i)return t;!a&&n==="\\"?a=!0:a=!1,t+=1}return e.length}fontSizeLineHeight(){if(!this._currentToken)throw new Error("Missing font size");const e=this._currentToken.text.split("/");if(e.length>=3)throw new Error(`Invalid font size '${this._currentToken}' specified`);if(this.nextToken(),e.length>=2)if(e[1]==="/"){if(!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.size=e[0],this.lineHeight=e[1];else if(e.length>=1){if(this.size=e[0],this._currentToken&&this._currentToken.text.indexOf("/")===0)if(this._currentToken.text==="/"){if(this.nextToken(),!this._currentToken)throw new Error("Missing line-height after font size");this.lineHeight=this._currentToken.text,this.nextToken()}else this.lineHeight=this._currentToken.text.substr(1),this.nextToken()}else throw new Error("Missing font size")}nextToken(){this._currentTokenIndex++,this._currentTokenIndex<this._tokens.length?this._currentToken=this._tokens[this._currentTokenIndex]:this._currentToken=null}fontStyleVariantWeight(){let e=!1,t=!1,i=!1,a=3;const n=[];for(;;){if(!this._currentToken)return;const r=this._currentToken.text;switch(r){case"normal":case"inherit":n.push(r),a--,this.nextToken();break;case"italic":case"oblique":this.style=r,e=!0,a--,this.nextToken();break;case"small-caps":this.variant=r,t=!0,a--,this.nextToken();break;case"bold":case"bolder":case"lighter":case"100":case"200":case"300":case"400":case"500":case"600":case"700":case"800":case"900":this.weight=r,i=!0,a--,this.nextToken();break;default:return}if(a===0)break}for(;n.length>0;){const r=n.pop();i?t?e||(this.style=r):this.variant=r:this.weight=r}}reset(){this._currentTokenIndex=-1,this.nextToken()}static quoteFont(e){return e.indexOf(" ")===-1?e:`"${e.replaceAll('"','\\"')}"`}}var rt;(function(s){s[s.Plain=0]="Plain",s[s.Italic=1]="Italic"})(rt||(rt={}));var Xi;(function(s){s[s.Regular=0]="Regular",s[s.Bold=1]="Bold"})(Xi||(Xi={}));class ge{reset(){this._cssScale=0,this._css=this.toCssString()}get family(){return this._families[0]}set family(e){this.families=uo.parseFamilies(e)}get families(){return this._families}set families(e){this._families=e,this.reset()}get size(){return this._size}set size(e){this._size=e,this.reset()}get style(){return this._style}set style(e){this._style=e,this.reset()}get weight(){return this._weight}set weight(e){this._weight=e,this.reset()}get isBold(){return this.weight===Xi.Bold}get isItalic(){return this.style===rt.Italic}constructor(e,t,i=rt.Plain,a=Xi.Regular){this._cssScale=0,this._families=uo.parseFamilies(e),this._size=t,this._style=i,this._weight=a,this._css=this.toCssString()}withSize(e){return ge.withFamilyList(this._families,e,this._style,this._weight)}static withFamilyList(e,t,i=rt.Plain,a=Xi.Regular){const n=new ge("",t,i,a);return n.families=e,n}toCssString(e=1){if(!this._css||!(Math.abs(e-this._cssScale)<.01)){let t="";this.isBold&&(t+="bold "),this.isItalic&&(t+="italic "),t+=this.size*e,t+="px ",t+=this.families.map(i=>uo.quoteFont(i)).join(", "),this._css=t,this._cssScale=e}return this._css}static fromJson(e){if(e instanceof ge)return e;switch(typeof e){case"undefined":return;case"object":{const t=e,i=t.get("families"),a=t.get("size"),n=D.parseEnum(t.get("style"),rt),r=D.parseEnum(t.get("weight"),Xi);return ge.withFamilyList(i,a,n,r)}case"string":{const t=new uo(e);t.parse();const i=t.families,a=t.size.toLowerCase();let n=0;switch(a){case"xx-small":n=7;break;case"x-small":n=10;break;case"small":case"smaller":n=13;break;case"medium":n=16;break;case"large":case"larger":n=18;break;case"x-large":n=24;break;case"xx-large":n=32;break;default:try{a.endsWith("em")?n=Number.parseFloat(a.substr(0,a.length-2))*16:a.endsWith("pt")?n=Number.parseFloat(a.substr(0,a.length-2))*16/12:a.endsWith("px")?n=Number.parseFloat(a.substr(0,a.length-2)):n=12}catch{n=12}break}let r=rt.Plain;t.style==="italic"&&(r=rt.Italic);let o=Xi.Regular;switch(t.weight.toLowerCase()){case"normal":case"lighter":break;default:o=Xi.Bold;break}return ge.withFamilyList(i,n,r,o)}default:return}}static toJson(e){if(!e)return;const t=new Map;return t.set("families",e.families),t.set("size",e.size),t.set("style",e.style),t.set("weight",e.weight),t}}class ui{constructor(){this.copyrightFont=new ge(ui.sansFont,12,rt.Plain,Xi.Bold),this.titleFont=new ge(ui.serifFont,32,rt.Plain),this.subTitleFont=new ge(ui.serifFont,20,rt.Plain),this.wordsFont=new ge(ui.serifFont,15,rt.Plain),this.effectFont=new ge(ui.serifFont,12,rt.Italic),this.timerFont=new ge(ui.serifFont,12,rt.Plain),this.directionsFont=new ge(ui.serifFont,14,rt.Plain),this.fretboardNumberFont=new ge(ui.sansFont,11,rt.Plain),this.numberedNotationFont=new ge(ui.sansFont,16,rt.Plain),this.numberedNotationGraceFont=new ge(ui.sansFont,14,rt.Plain),this.tablatureFont=new ge(ui.sansFont,13,rt.Plain),this.graceFont=new ge(ui.sansFont,11,rt.Plain),this.staffLineColor=new Pe(165,165,165,255),this.barSeparatorColor=new Pe(34,34,17,255),this.barNumberFont=new ge(ui.sansFont,11,rt.Plain),this.barNumberColor=new Pe(200,0,0,255),this.fingeringFont=new ge(ui.serifFont,14,rt.Plain),this.inlineFingeringFont=new ge(ui.serifFont,12,rt.Plain),this.markerFont=new ge(ui.serifFont,14,rt.Plain,Xi.Bold),this.mainGlyphColor=new Pe(0,0,0,255),this.secondaryGlyphColor=new Pe(0,0,0,100),this.scoreInfoColor=new Pe(0,0,0,255)}getFontForElement(e){switch(e){case z.Title:return this.titleFont;case z.SubTitle:case z.Artist:case z.Album:return this.subTitleFont;case z.Words:case z.Music:case z.WordsAndMusic:case z.Transcriber:return this.wordsFont;case z.Copyright:case z.CopyrightSecondLine:return this.copyrightFont}return this.wordsFont}}ui.sansFont="Arial, sans-serif";ui.serifFont="Georgia, serif";var tr;(function(s){s[s.Automatic=0]="Automatic",s[s.UseModelLayout=1]="UseModelLayout"})(tr||(tr={}));class wv{constructor(){this.scale=1,this.stretchForce=1,this.layoutMode=nn.Page,this.staveProfile=Ua.Default,this.barsPerRow=-1,this.startBar=1,this.barCount=-1,this.barCountPerPartial=10,this.justifyLastSystem=!1,this.resources=new ui,this.padding=[35,35],this.firstSystemPaddingTop=5,this.systemPaddingTop=10,this.systemPaddingBottom=20,this.lastSystemPaddingBottom=0,this.systemLabelPaddingLeft=0,this.systemLabelPaddingRight=3,this.accoladeBarPaddingRight=3,this.notationStaffPaddingTop=5,this.notationStaffPaddingBottom=5,this.effectStaffPaddingTop=0,this.effectStaffPaddingBottom=0,this.firstStaffPaddingLeft=6,this.staffPaddingLeft=2,this.systemsLayoutMode=tr.Automatic}}class kv{constructor(){this.encoding="utf-8",this.mergePartGroupsInMusicXml=!1,this.beatTextAsLyrics=!1}}var qa;(function(s){s[s.Off=0]="Off",s[s.Continuous=1]="Continuous",s[s.OffScreen=2]="OffScreen"})(qa||(qa={}));class Tv{constructor(){this.noteWideLength=240,this.noteWideAmplitude=1,this.noteSlightLength=360,this.noteSlightAmplitude=.5,this.beatWideLength=480,this.beatWideAmplitude=2,this.beatSlightLength=480,this.beatSlightAmplitude=2}}class Bv{constructor(){this.simpleSlidePitchOffset=6,this.simpleSlideDurationRatio=.25,this.shiftSlideDurationRatio=.5}}var fh;(function(s){s[s.WebAudioAudioWorklets=0]="WebAudioAudioWorklets",s[s.WebAudioScriptProcessor=1]="WebAudioScriptProcessor"})(fh||(fh={}));var Pi;(function(s){s[s.Disabled=0]="Disabled",s[s.EnabledAutomatic=1]="EnabledAutomatic",s[s.EnabledSynthesizer=2]="EnabledSynthesizer",s[s.EnabledBackingTrack=3]="EnabledBackingTrack",s[s.EnabledExternalMedia=4]="EnabledExternalMedia"})(Pi||(Pi={}));class _v{constructor(){this.soundFont=null,this.scrollElement="html,body",this.outputMode=fh.WebAudioAudioWorklets,this.enablePlayer=!1,this.playerMode=Pi.Disabled,this.enableCursor=!0,this.enableAnimatedBeatCursor=!0,this.enableElementHighlighting=!0,this.enableUserInteraction=!0,this.scrollOffsetX=0,this.scrollOffsetY=0,this.scrollMode=qa.Continuous,this.scrollSpeed=300,this.nativeBrowserSmoothScroll=!0,this.songBookBendDuration=75,this.songBookDipDuration=150,this.vibrato=new Tv,this.slide=new Bv,this.playTripletFeel=!0,this.bufferTimeInMilliseconds=500}}class Ml{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Ml.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("scriptfile",e.scriptFile),t.set("fontdirectory",e.fontDirectory),e.smuflFontSources!==null){const i=new Map;t.set("smuflfontsources",i);for(const[a,n]of e.smuflFontSources)i.set(a.toString(),n)}return t.set("file",e.file),t.set("tex",e.tex),t.set("tracks",e.tracks),t.set("enablelazyloading",e.enableLazyLoading),t.set("engine",e.engine),t.set("loglevel",e.logLevel),t.set("useworkers",e.useWorkers),t.set("includenotebounds",e.includeNoteBounds),t}static setProperty(e,t,i){switch(t){case"scriptfile":return e.scriptFile=i,!0;case"fontdirectory":return e.fontDirectory=i,!0;case"smuflfontsources":return e.smuflFontSources=new Map,D.forEach(i,(a,n)=>{e.smuflFontSources.set(D.parseEnum(n,Js),a)}),!0;case"file":return e.file=i,!0;case"tex":return e.tex=i,!0;case"tracks":return e.tracks=i,!0;case"enablelazyloading":return e.enableLazyLoading=i,!0;case"engine":return e.engine=i,!0;case"loglevel":return e.logLevel=D.parseEnum(i,na),!0;case"useworkers":return e.useWorkers=i,!0;case"includenotebounds":return e.includeNoteBounds=i,!0}return!1}}class Rl{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Rl.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("smuflfont",ge.toJson(e.smuflFont)),t.set("copyrightfont",ge.toJson(e.copyrightFont)),t.set("titlefont",ge.toJson(e.titleFont)),t.set("subtitlefont",ge.toJson(e.subTitleFont)),t.set("wordsfont",ge.toJson(e.wordsFont)),t.set("effectfont",ge.toJson(e.effectFont)),t.set("timerfont",ge.toJson(e.timerFont)),t.set("directionsfont",ge.toJson(e.directionsFont)),t.set("fretboardnumberfont",ge.toJson(e.fretboardNumberFont)),t.set("numberednotationfont",ge.toJson(e.numberedNotationFont)),t.set("numberednotationgracefont",ge.toJson(e.numberedNotationGraceFont)),t.set("tablaturefont",ge.toJson(e.tablatureFont)),t.set("gracefont",ge.toJson(e.graceFont)),t.set("stafflinecolor",Pe.toJson(e.staffLineColor)),t.set("barseparatorcolor",Pe.toJson(e.barSeparatorColor)),t.set("barnumberfont",ge.toJson(e.barNumberFont)),t.set("barnumbercolor",Pe.toJson(e.barNumberColor)),t.set("fingeringfont",ge.toJson(e.fingeringFont)),t.set("inlinefingeringfont",ge.toJson(e.inlineFingeringFont)),t.set("markerfont",ge.toJson(e.markerFont)),t.set("mainglyphcolor",Pe.toJson(e.mainGlyphColor)),t.set("secondaryglyphcolor",Pe.toJson(e.secondaryGlyphColor)),t.set("scoreinfocolor",Pe.toJson(e.scoreInfoColor)),t}static setProperty(e,t,i){switch(t){case"smuflfont":return e.smuflFont=ge.fromJson(i),!0;case"copyrightfont":return e.copyrightFont=ge.fromJson(i),!0;case"titlefont":return e.titleFont=ge.fromJson(i),!0;case"subtitlefont":return e.subTitleFont=ge.fromJson(i),!0;case"wordsfont":return e.wordsFont=ge.fromJson(i),!0;case"effectfont":return e.effectFont=ge.fromJson(i),!0;case"timerfont":return e.timerFont=ge.fromJson(i),!0;case"directionsfont":return e.directionsFont=ge.fromJson(i),!0;case"fretboardnumberfont":return e.fretboardNumberFont=ge.fromJson(i),!0;case"numberednotationfont":return e.numberedNotationFont=ge.fromJson(i),!0;case"numberednotationgracefont":return e.numberedNotationGraceFont=ge.fromJson(i),!0;case"tablaturefont":return e.tablatureFont=ge.fromJson(i),!0;case"gracefont":return e.graceFont=ge.fromJson(i),!0;case"stafflinecolor":return e.staffLineColor=Pe.fromJson(i),!0;case"barseparatorcolor":return e.barSeparatorColor=Pe.fromJson(i),!0;case"barnumberfont":return e.barNumberFont=ge.fromJson(i),!0;case"barnumbercolor":return e.barNumberColor=Pe.fromJson(i),!0;case"fingeringfont":return e.fingeringFont=ge.fromJson(i),!0;case"inlinefingeringfont":return e.inlineFingeringFont=ge.fromJson(i),!0;case"markerfont":return e.markerFont=ge.fromJson(i),!0;case"mainglyphcolor":return e.mainGlyphColor=Pe.fromJson(i),!0;case"secondaryglyphcolor":return e.secondaryGlyphColor=Pe.fromJson(i),!0;case"scoreinfocolor":return e.scoreInfoColor=Pe.fromJson(i),!0}return!1}}class Ol{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Ol.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("scale",e.scale),t.set("stretchforce",e.stretchForce),t.set("layoutmode",e.layoutMode),t.set("staveprofile",e.staveProfile),t.set("barsperrow",e.barsPerRow),t.set("startbar",e.startBar),t.set("barcount",e.barCount),t.set("barcountperpartial",e.barCountPerPartial),t.set("justifylastsystem",e.justifyLastSystem),t.set("resources",Rl.toJson(e.resources)),t.set("padding",e.padding),t.set("firstsystempaddingtop",e.firstSystemPaddingTop),t.set("systempaddingtop",e.systemPaddingTop),t.set("systempaddingbottom",e.systemPaddingBottom),t.set("lastsystempaddingbottom",e.lastSystemPaddingBottom),t.set("systemlabelpaddingleft",e.systemLabelPaddingLeft),t.set("systemlabelpaddingright",e.systemLabelPaddingRight),t.set("accoladebarpaddingright",e.accoladeBarPaddingRight),t.set("notationstaffpaddingtop",e.notationStaffPaddingTop),t.set("notationstaffpaddingbottom",e.notationStaffPaddingBottom),t.set("effectstaffpaddingtop",e.effectStaffPaddingTop),t.set("effectstaffpaddingbottom",e.effectStaffPaddingBottom),t.set("firststaffpaddingleft",e.firstStaffPaddingLeft),t.set("staffpaddingleft",e.staffPaddingLeft),t.set("systemslayoutmode",e.systemsLayoutMode),t}static setProperty(e,t,i){switch(t){case"scale":return e.scale=i,!0;case"stretchforce":return e.stretchForce=i,!0;case"layoutmode":return e.layoutMode=D.parseEnum(i,nn),!0;case"staveprofile":return e.staveProfile=D.parseEnum(i,Ua),!0;case"barsperrow":return e.barsPerRow=i,!0;case"startbar":return e.startBar=i,!0;case"barcount":return e.barCount=i,!0;case"barcountperpartial":return e.barCountPerPartial=i,!0;case"justifylastsystem":return e.justifyLastSystem=i,!0;case"padding":return e.padding=i,!0;case"firstsystempaddingtop":return e.firstSystemPaddingTop=i,!0;case"systempaddingtop":return e.systemPaddingTop=i,!0;case"systempaddingbottom":return e.systemPaddingBottom=i,!0;case"lastsystempaddingbottom":return e.lastSystemPaddingBottom=i,!0;case"systemlabelpaddingleft":return e.systemLabelPaddingLeft=i,!0;case"systemlabelpaddingright":return e.systemLabelPaddingRight=i,!0;case"accoladebarpaddingright":return e.accoladeBarPaddingRight=i,!0;case"notationstaffpaddingtop":return e.notationStaffPaddingTop=i,!0;case"notationstaffpaddingbottom":return e.notationStaffPaddingBottom=i,!0;case"effectstaffpaddingtop":return e.effectStaffPaddingTop=i,!0;case"effectstaffpaddingbottom":return e.effectStaffPaddingBottom=i,!0;case"firststaffpaddingleft":return e.firstStaffPaddingLeft=i,!0;case"staffpaddingleft":return e.staffPaddingLeft=i,!0;case"systemslayoutmode":return e.systemsLayoutMode=D.parseEnum(i,tr),!0}if(["resources"].indexOf(t)>=0)return Rl.fromJson(e.resources,i),!0;for(const a of["resources"])if(t.indexOf(a)===0&&Rl.setProperty(e.resources,t.substring(a.length),i))return!0;return!1}}class Il{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Il.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;t.set("notationmode",e.notationMode),t.set("fingeringmode",e.fingeringMode);{const i=new Map;t.set("elements",i);for(const[a,n]of e.elements)i.set(a.toString(),n)}return t.set("rhythmmode",e.rhythmMode),t.set("rhythmheight",e.rhythmHeight),t.set("transpositionpitches",e.transpositionPitches),t.set("displaytranspositionpitches",e.displayTranspositionPitches),t.set("smallgracetabnotes",e.smallGraceTabNotes),t.set("extendbendarrowsontiednotes",e.extendBendArrowsOnTiedNotes),t.set("extendlineeffectstobeatend",e.extendLineEffectsToBeatEnd),t.set("slurheight",e.slurHeight),t}static setProperty(e,t,i){switch(t){case"notationmode":return e.notationMode=D.parseEnum(i,ai),!0;case"fingeringmode":return e.fingeringMode=D.parseEnum(i,ua),!0;case"elements":return e.elements=new Map,D.forEach(i,(a,n)=>{e.elements.set(D.parseEnum(n,be),a)}),!0;case"rhythmmode":return e.rhythmMode=D.parseEnum(i,Us),!0;case"rhythmheight":return e.rhythmHeight=i,!0;case"transpositionpitches":return e.transpositionPitches=i,!0;case"displaytranspositionpitches":return e.displayTranspositionPitches=i,!0;case"smallgracetabnotes":return e.smallGraceTabNotes=i,!0;case"extendbendarrowsontiednotes":return e.extendBendArrowsOnTiedNotes=i,!0;case"extendlineeffectstobeatend":return e.extendLineEffectsToBeatEnd=i,!0;case"slurheight":return e.slurHeight=i,!0}return!1}}class Hl{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Hl.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("encoding",e.encoding),t.set("mergepartgroupsinmusicxml",e.mergePartGroupsInMusicXml),t.set("beattextaslyrics",e.beatTextAsLyrics),t}static setProperty(e,t,i){switch(t){case"encoding":return e.encoding=i,!0;case"mergepartgroupsinmusicxml":return e.mergePartGroupsInMusicXml=i,!0;case"beattextaslyrics":return e.beatTextAsLyrics=i,!0}return!1}}class Vl{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Vl.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("notewidelength",e.noteWideLength),t.set("notewideamplitude",e.noteWideAmplitude),t.set("noteslightlength",e.noteSlightLength),t.set("noteslightamplitude",e.noteSlightAmplitude),t.set("beatwidelength",e.beatWideLength),t.set("beatwideamplitude",e.beatWideAmplitude),t.set("beatslightlength",e.beatSlightLength),t.set("beatslightamplitude",e.beatSlightAmplitude),t}static setProperty(e,t,i){switch(t){case"notewidelength":return e.noteWideLength=i,!0;case"notewideamplitude":return e.noteWideAmplitude=i,!0;case"noteslightlength":return e.noteSlightLength=i,!0;case"noteslightamplitude":return e.noteSlightAmplitude=i,!0;case"beatwidelength":return e.beatWideLength=i,!0;case"beatwideamplitude":return e.beatWideAmplitude=i,!0;case"beatslightlength":return e.beatSlightLength=i,!0;case"beatslightamplitude":return e.beatSlightAmplitude=i,!0}return!1}}class Wl{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Wl.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("simpleslidepitchoffset",e.simpleSlidePitchOffset),t.set("simpleslidedurationratio",e.simpleSlideDurationRatio),t.set("shiftslidedurationratio",e.shiftSlideDurationRatio),t}static setProperty(e,t,i){switch(t){case"simpleslidepitchoffset":return e.simpleSlidePitchOffset=i,!0;case"simpleslidedurationratio":return e.simpleSlideDurationRatio=i,!0;case"shiftslidedurationratio":return e.shiftSlideDurationRatio=i,!0}return!1}}class zl{static fromJson(e,t){t&&D.forEach(t,(i,a)=>zl.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("soundfont",e.soundFont),t.set("outputmode",e.outputMode),t.set("enableplayer",e.enablePlayer),t.set("playermode",e.playerMode),t.set("enablecursor",e.enableCursor),t.set("enableanimatedbeatcursor",e.enableAnimatedBeatCursor),t.set("enableelementhighlighting",e.enableElementHighlighting),t.set("enableuserinteraction",e.enableUserInteraction),t.set("scrolloffsetx",e.scrollOffsetX),t.set("scrolloffsety",e.scrollOffsetY),t.set("scrollmode",e.scrollMode),t.set("scrollspeed",e.scrollSpeed),t.set("nativebrowsersmoothscroll",e.nativeBrowserSmoothScroll),t.set("songbookbendduration",e.songBookBendDuration),t.set("songbookdipduration",e.songBookDipDuration),t.set("vibrato",Vl.toJson(e.vibrato)),t.set("slide",Wl.toJson(e.slide)),t.set("playtripletfeel",e.playTripletFeel),t.set("buffertimeinmilliseconds",e.bufferTimeInMilliseconds),t}static setProperty(e,t,i){switch(t){case"soundfont":return e.soundFont=i,!0;case"scrollelement":return e.scrollElement=i,!0;case"outputmode":return e.outputMode=D.parseEnum(i,fh),!0;case"enableplayer":return e.enablePlayer=i,!0;case"playermode":return e.playerMode=D.parseEnum(i,Pi),!0;case"enablecursor":return e.enableCursor=i,!0;case"enableanimatedbeatcursor":return e.enableAnimatedBeatCursor=i,!0;case"enableelementhighlighting":return e.enableElementHighlighting=i,!0;case"enableuserinteraction":return e.enableUserInteraction=i,!0;case"scrolloffsetx":return e.scrollOffsetX=i,!0;case"scrolloffsety":return e.scrollOffsetY=i,!0;case"scrollmode":return e.scrollMode=D.parseEnum(i,qa),!0;case"scrollspeed":return e.scrollSpeed=i,!0;case"nativebrowsersmoothscroll":return e.nativeBrowserSmoothScroll=i,!0;case"songbookbendduration":return e.songBookBendDuration=i,!0;case"songbookdipduration":return e.songBookDipDuration=i,!0;case"playtripletfeel":return e.playTripletFeel=i,!0;case"buffertimeinmilliseconds":return e.bufferTimeInMilliseconds=i,!0}if(["vibrato"].indexOf(t)>=0)return Vl.fromJson(e.vibrato,i),!0;for(const a of["vibrato"])if(t.indexOf(a)===0&&Vl.setProperty(e.vibrato,t.substring(a.length),i))return!0;if(["slide"].indexOf(t)>=0)return Wl.fromJson(e.slide,i),!0;for(const a of["slide"])if(t.indexOf(a)===0&&Wl.setProperty(e.slide,t.substring(a.length),i))return!0;return!1}}class ir{static fromJson(e,t){t&&D.forEach(t,(i,a)=>ir.setProperty(e,a.toLowerCase(),i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("core",Ml.toJson(e.core)),t.set("display",Ol.toJson(e.display)),t.set("notation",Il.toJson(e.notation)),t.set("importer",Hl.toJson(e.importer)),t.set("player",zl.toJson(e.player)),t}static setProperty(e,t,i){if(["core",""].indexOf(t)>=0)return Ml.fromJson(e.core,i),!0;for(const a of["core",""])if(t.indexOf(a)===0&&Ml.setProperty(e.core,t.substring(a.length),i))return!0;if(["display",""].indexOf(t)>=0)return Ol.fromJson(e.display,i),!0;for(const a of["display",""])if(t.indexOf(a)===0&&Ol.setProperty(e.display,t.substring(a.length),i))return!0;if(["notation"].indexOf(t)>=0)return Il.fromJson(e.notation,i),!0;for(const a of["notation"])if(t.indexOf(a)===0&&Il.setProperty(e.notation,t.substring(a.length),i))return!0;if(["importer"].indexOf(t)>=0)return Hl.fromJson(e.importer,i),!0;for(const a of["importer"])if(t.indexOf(a)===0&&Hl.setProperty(e.importer,t.substring(a.length),i))return!0;if(["player"].indexOf(t)>=0)return zl.fromJson(e.player,i),!0;for(const a of["player"])if(t.indexOf(a)===0&&zl.setProperty(e.player,t.substring(a.length),i))return!0;return!1}}class sr{constructor(){this.core=new Jg,this.display=new wv,this.notation=new nh,this.importer=new kv,this.player=new _v}setSongBookModeSettings(){this.notation.notationMode=ai.SongBook,this.notation.smallGraceTabNotes=!1,this.notation.fingeringMode=ua.SingleNoteEffectBand,this.notation.extendBendArrowsOnTiedNotes=!1,this.notation.elements.set(be.ParenthesisOnTiedBends,!1),this.notation.elements.set(be.TabNotesOnTiedBends,!1),this.notation.elements.set(be.ZerosOnDiveWhammys,!0)}static get songBook(){const e=new sr;return e.setSongBookModeSettings(),e}fillFromJson(e){ir.fromJson(this,e)}handleBackwardsCompatibility(){this.player.playerMode===Pi.Disabled&&this.player.enablePlayer&&(this.player.playerMode=Pi.EnabledAutomatic)}}class au{static fromJson(e,t){t&&D.forEach(t,(i,a)=>au.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("marker",e.marker),t.set("text",e.text),t}static setProperty(e,t,i){switch(t){case"marker":return e.marker=i,!0;case"text":return e.text=i,!0}return!1}}class nu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>nu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("baroccurence",e.barOccurence),t.set("millisecondoffset",e.millisecondOffset),t}static setProperty(e,t,i){switch(t){case"baroccurence":return e.barOccurence=i,!0;case"millisecondoffset":return e.millisecondOffset=i,!0}return!1}}class Mn{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Mn.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("islinear",e.isLinear),t.set("type",e.type),t.set("value",e.value),e.syncPointValue&&t.set("syncpointvalue",nu.toJson(e.syncPointValue)),t.set("ratioposition",e.ratioPosition),t.set("text",e.text),t}static setProperty(e,t,i){switch(t){case"islinear":return e.isLinear=i,!0;case"type":return e.type=D.parseEnum(i,tt),!0;case"value":return e.value=i,!0;case"syncpointvalue":return i?(e.syncPointValue=new ju,nu.fromJson(e.syncPointValue,i)):e.syncPointValue=void 0,!0;case"ratioposition":return e.ratioPosition=i,!0;case"text":return e.text=i,!0}return!1}}class ru{static fromJson(e,t){t&&D.forEach(t,(i,a)=>ru.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("type",e.type),t.set("length",e.length),t}static setProperty(e,t,i){switch(t){case"type":return e.type=D.parseEnum(i,Bi),!0;case"length":return e.length=i,!0}return!1}}class ou{static fromJson(e,t){t&&D.forEach(t,(i,a)=>ou.setProperty(e,a,i))}static toJson(e){var i;if(!e)return null;const t=new Map;if(t.set("alternateendings",e.alternateEndings),t.set("isdoublebar",e.isDoubleBar),t.set("isrepeatstart",e.isRepeatStart),t.set("repeatcount",e.repeatCount),t.set("timesignaturenumerator",e.timeSignatureNumerator),t.set("timesignaturedenominator",e.timeSignatureDenominator),t.set("timesignaturecommon",e.timeSignatureCommon),t.set("isfreetime",e.isFreeTime),t.set("tripletfeel",e.tripletFeel),e.section&&t.set("section",au.toJson(e.section)),t.set("tempoautomations",e.tempoAutomations.map(a=>Mn.toJson(a))),e.syncPoints!==void 0&&t.set("syncpoints",(i=e.syncPoints)==null?void 0:i.map(a=>Mn.toJson(a))),e.fermata!==null){const a=new Map;t.set("fermata",a);for(const[n,r]of e.fermata)a.set(n.toString(),ru.toJson(r))}if(t.set("start",e.start),t.set("isanacrusis",e.isAnacrusis),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),e.directions!==null){const a=[];t.set("directions",a);for(const n of e.directions)a.push(n)}return t}static setProperty(e,t,i){switch(t){case"alternateendings":return e.alternateEndings=i,!0;case"isdoublebar":return e.isDoubleBar=i,!0;case"isrepeatstart":return e.isRepeatStart=i,!0;case"repeatcount":return e.repeatCount=i,!0;case"timesignaturenumerator":return e.timeSignatureNumerator=i,!0;case"timesignaturedenominator":return e.timeSignatureDenominator=i,!0;case"timesignaturecommon":return e.timeSignatureCommon=i,!0;case"isfreetime":return e.isFreeTime=i,!0;case"tripletfeel":return e.tripletFeel=D.parseEnum(i,me),!0;case"section":return i?(e.section=new Mh,au.fromJson(e.section,i)):e.section=null,!0;case"tempoautomations":e.tempoAutomations=[];for(const a of i){const n=new wt;Mn.fromJson(n,a),e.tempoAutomations.push(n)}return!0;case"syncpoints":if(i){e.syncPoints=[];for(const a of i){const n=new wt;Mn.fromJson(n,a),e.addSyncPoint(n)}}return!0;case"fermata":return e.fermata=new Map,D.forEach(i,(a,n)=>{const r=new Rh;ru.fromJson(r,a),e.addFermata(Number.parseInt(n),r)}),!0;case"start":return e.start=i,!0;case"isanacrusis":return e.isAnacrusis=i,!0;case"displayscale":return e.displayScale=i,!0;case"displaywidth":return e.displayWidth=i,!0;case"directions":for(const a of i)e.addDirection(D.parseEnum(a,R));return!0}return!1}}class Fo{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Fo.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("offset",e.offset),t.set("value",e.value),t}static setProperty(e,t,i){switch(t){case"offset":return e.offset=i,!0;case"value":return e.value=i,!0}return!1}}class lu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>lu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;t.set("notehead",e.noteHead),t.set("noteheadcenteronstem",e.noteHeadCenterOnStem);{const i=new Map;t.set("colors",i);for(const[a,n]of e.colors)i.set(a.toString(),Pe.toJson(n))}return t}static setProperty(e,t,i){switch(t){case"notehead":return e.noteHead=D.parseEnum(i,u),!0;case"noteheadcenteronstem":return e.noteHeadCenterOnStem=i,!0;case"colors":return e.colors=new Map,D.forEach(i,(a,n)=>{e.colors.set(D.parseEnum(n,Ci),Pe.fromJson(a))}),!0}return!1}}class hu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>hu.setProperty(e,a,i))}static toJson(e){var i;if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("accentuated",e.accentuated),t.set("bendtype",e.bendType),t.set("bendstyle",e.bendStyle),t.set("iscontinuedbend",e.isContinuedBend),e.bendPoints!==null&&t.set("bendpoints",(i=e.bendPoints)==null?void 0:i.map(a=>Fo.toJson(a))),t.set("fret",e.fret),t.set("string",e.string),t.set("showstringnumber",e.showStringNumber),t.set("octave",e.octave),t.set("tone",e.tone),t.set("percussionarticulation",e.percussionArticulation),t.set("isvisible",e.isVisible),t.set("islefthandtapped",e.isLeftHandTapped),t.set("ishammerpullorigin",e.isHammerPullOrigin),t.set("isslurdestination",e.isSlurDestination),t.set("harmonictype",e.harmonicType),t.set("harmonicvalue",e.harmonicValue),t.set("isghost",e.isGhost),t.set("isletring",e.isLetRing),t.set("ispalmmute",e.isPalmMute),t.set("isdead",e.isDead),t.set("isstaccato",e.isStaccato),t.set("slideintype",e.slideInType),t.set("slideouttype",e.slideOutType),t.set("vibrato",e.vibrato),t.set("istiedestination",e.isTieDestination),t.set("lefthandfinger",e.leftHandFinger),t.set("righthandfinger",e.rightHandFinger),t.set("trillvalue",e.trillValue),t.set("trillspeed",e.trillSpeed),t.set("durationpercent",e.durationPercent),t.set("accidentalmode",e.accidentalMode),t.set("dynamics",e.dynamics),t.set("ornament",e.ornament),e.style&&t.set("style",lu.toJson(e.style)),e.toJson(t),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"accentuated":return e.accentuated=D.parseEnum(i,_t),!0;case"bendtype":return e.bendType=D.parseEnum(i,q),!0;case"bendstyle":return e.bendStyle=D.parseEnum(i,Xe),!0;case"iscontinuedbend":return e.isContinuedBend=i,!0;case"bendpoints":if(i){e.bendPoints=[];for(const a of i){const n=new H;Fo.fromJson(n,a),e.addBendPoint(n)}}return!0;case"fret":return e.fret=i,!0;case"string":return e.string=i,!0;case"showstringnumber":return e.showStringNumber=i,!0;case"octave":return e.octave=i,!0;case"tone":return e.tone=i,!0;case"percussionarticulation":return e.percussionArticulation=i,!0;case"isvisible":return e.isVisible=i,!0;case"islefthandtapped":return e.isLeftHandTapped=i,!0;case"ishammerpullorigin":return e.isHammerPullOrigin=i,!0;case"isslurdestination":return e.isSlurDestination=i,!0;case"harmonictype":return e.harmonicType=D.parseEnum(i,ae),!0;case"harmonicvalue":return e.harmonicValue=i,!0;case"isghost":return e.isGhost=i,!0;case"isletring":return e.isLetRing=i,!0;case"ispalmmute":return e.isPalmMute=i,!0;case"isdead":return e.isDead=i,!0;case"isstaccato":return e.isStaccato=i,!0;case"slideintype":return e.slideInType=D.parseEnum(i,jt),!0;case"slideouttype":return e.slideOutType=D.parseEnum(i,pe),!0;case"vibrato":return e.vibrato=D.parseEnum(i,ve),!0;case"istiedestination":return e.isTieDestination=i,!0;case"lefthandfinger":return e.leftHandFinger=D.parseEnum(i,ie),!0;case"righthandfinger":return e.rightHandFinger=D.parseEnum(i,ie),!0;case"trillvalue":return e.trillValue=i,!0;case"trillspeed":return e.trillSpeed=D.parseEnum(i,w),!0;case"durationpercent":return e.durationPercent=i,!0;case"accidentalmode":return e.accidentalMode=D.parseEnum(i,ke),!0;case"dynamics":return e.dynamics=D.parseEnum(i,j),!0;case"ornament":return e.ornament=D.parseEnum(i,Tt),!0;case"style":return i?(e.style=new Kw,lu.fromJson(e.style,i)):e.style=void 0,!0}return e.setProperty(t,i)}}class cu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>cu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("colors",i);for(const[a,n]of e.colors)i.set(a.toString(),Pe.toJson(n))}return t}static setProperty(e,t,i){switch(t){case"colors":return e.colors=new Map,D.forEach(i,(a,n)=>{e.colors.set(D.parseEnum(n,qe),Pe.fromJson(a))}),!0}return!1}}class uu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>uu.setProperty(e,a,i))}static toJson(e){var i;if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("notes",e.notes.map(a=>hu.toJson(a))),t.set("isempty",e.isEmpty),t.set("whammystyle",e.whammyStyle),t.set("ottava",e.ottava),t.set("islegatoorigin",e.isLegatoOrigin),t.set("duration",e.duration),t.set("automations",e.automations.map(a=>Mn.toJson(a))),t.set("dots",e.dots),t.set("fade",e.fade),t.set("lyrics",e.lyrics),t.set("pop",e.pop),t.set("slap",e.slap),t.set("tap",e.tap),t.set("text",e.text),t.set("slashed",e.slashed),t.set("deadslapped",e.deadSlapped),t.set("brushtype",e.brushType),t.set("brushduration",e.brushDuration),t.set("tupletdenominator",e.tupletDenominator),t.set("tupletnumerator",e.tupletNumerator),t.set("iscontinuedwhammy",e.isContinuedWhammy),t.set("whammybartype",e.whammyBarType),e.whammyBarPoints!==null&&t.set("whammybarpoints",(i=e.whammyBarPoints)==null?void 0:i.map(a=>Fo.toJson(a))),t.set("vibrato",e.vibrato),t.set("chordid",e.chordId),t.set("gracetype",e.graceType),t.set("pickstroke",e.pickStroke),t.set("tremolospeed",e.tremoloSpeed),t.set("crescendo",e.crescendo),t.set("displaystart",e.displayStart),t.set("playbackstart",e.playbackStart),t.set("displayduration",e.displayDuration),t.set("playbackduration",e.playbackDuration),t.set("overridedisplayduration",e.overrideDisplayDuration),t.set("golpe",e.golpe),t.set("dynamics",e.dynamics),t.set("invertbeamdirection",e.invertBeamDirection),t.set("preferredbeamdirection",e.preferredBeamDirection),t.set("beamingmode",e.beamingMode),t.set("wahpedal",e.wahPedal),t.set("barrefret",e.barreFret),t.set("barreshape",e.barreShape),t.set("rasgueado",e.rasgueado),t.set("showtimer",e.showTimer),t.set("timer",e.timer),e.style&&t.set("style",cu.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"notes":e.notes=[];for(const a of i){const n=new bt;hu.fromJson(n,a),e.addNote(n)}return!0;case"isempty":return e.isEmpty=i,!0;case"whammystyle":return e.whammyStyle=D.parseEnum(i,Xe),!0;case"ottava":return e.ottava=D.parseEnum(i,fe),!0;case"islegatoorigin":return e.isLegatoOrigin=i,!0;case"duration":return e.duration=D.parseEnum(i,w),!0;case"automations":e.automations=[];for(const a of i){const n=new wt;Mn.fromJson(n,a),e.automations.push(n)}return!0;case"dots":return e.dots=i,!0;case"fade":return e.fade=D.parseEnum(i,qt),!0;case"lyrics":return e.lyrics=i,!0;case"pop":return e.pop=i,!0;case"slap":return e.slap=i,!0;case"tap":return e.tap=i,!0;case"text":return e.text=i,!0;case"slashed":return e.slashed=i,!0;case"deadslapped":return e.deadSlapped=i,!0;case"brushtype":return e.brushType=D.parseEnum(i,Y),!0;case"brushduration":return e.brushDuration=i,!0;case"tupletdenominator":return e.tupletDenominator=i,!0;case"tupletnumerator":return e.tupletNumerator=i,!0;case"iscontinuedwhammy":return e.isContinuedWhammy=i,!0;case"whammybartype":return e.whammyBarType=D.parseEnum(i,De),!0;case"whammybarpoints":if(i){e.whammyBarPoints=[];for(const a of i){const n=new H;Fo.fromJson(n,a),e.addWhammyBarPoint(n)}}return!0;case"vibrato":return e.vibrato=D.parseEnum(i,ve),!0;case"chordid":return e.chordId=i,!0;case"gracetype":return e.graceType=D.parseEnum(i,se),!0;case"pickstroke":return e.pickStroke=D.parseEnum(i,ni),!0;case"tremolospeed":return e.tremoloSpeed=D.parseEnum(i,w)??null,!0;case"crescendo":return e.crescendo=D.parseEnum(i,vi),!0;case"displaystart":return e.displayStart=i,!0;case"playbackstart":return e.playbackStart=i,!0;case"displayduration":return e.displayDuration=i,!0;case"playbackduration":return e.playbackDuration=i,!0;case"overridedisplayduration":return e.overrideDisplayDuration=i,!0;case"golpe":return e.golpe=D.parseEnum(i,Ji),!0;case"dynamics":return e.dynamics=D.parseEnum(i,j),!0;case"invertbeamdirection":return e.invertBeamDirection=i,!0;case"preferredbeamdirection":return e.preferredBeamDirection=D.parseEnum(i,P)??null,!0;case"beamingmode":return e.beamingMode=D.parseEnum(i,it),!0;case"wahpedal":return e.wahPedal=D.parseEnum(i,ls),!0;case"barrefret":return e.barreFret=i,!0;case"barreshape":return e.barreShape=D.parseEnum(i,ns),!0;case"rasgueado":return e.rasgueado=D.parseEnum(i,X),!0;case"showtimer":return e.showTimer=i,!0;case"timer":return e.timer=i,!0;case"style":return i?(e.style=new Lx,cu.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class du{static fromJson(e,t){t&&D.forEach(t,(i,a)=>du.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("colors",i);for(const[a,n]of e.colors)i.set(a.toString(),Pe.toJson(n))}return t}static setProperty(e,t,i){switch(t){case"colors":return e.colors=new Map,D.forEach(i,(a,n)=>{e.colors.set(D.parseEnum(n,rh),Pe.fromJson(a))}),!0}return!1}}class fu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>fu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("beats",e.beats.map(i=>uu.toJson(i))),e.style&&t.set("style",du.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"beats":e.beats=[];for(const a of i){const n=new Wt;uu.fromJson(n,a),e.addBeat(n)}return!0;case"style":return i?(e.style=new Cx,du.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class pu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>pu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("ratioposition",e.ratioPosition),t.set("pedaltype",e.pedalType),t}static setProperty(e,t,i){switch(t){case"ratioposition":return e.ratioPosition=i,!0;case"pedaltype":return e.pedalType=D.parseEnum(i,Et),!0}return!1}}class gu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>gu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("colors",i);for(const[a,n]of e.colors)i.set(a.toString(),Pe.toJson(n))}return t}static setProperty(e,t,i){switch(t){case"colors":return e.colors=new Map,D.forEach(i,(a,n)=>{e.colors.set(D.parseEnum(n,Ee),Pe.fromJson(a))}),!0}return!1}}class mu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>mu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("id",e.id),t.set("clef",e.clef),t.set("clefottava",e.clefOttava),t.set("voices",e.voices.map(i=>fu.toJson(i))),t.set("similemark",e.simileMark),t.set("displayscale",e.displayScale),t.set("displaywidth",e.displayWidth),t.set("sustainpedals",e.sustainPedals.map(i=>pu.toJson(i))),t.set("barlineleft",e.barLineLeft),t.set("barlineright",e.barLineRight),t.set("keysignature",e.keySignature),t.set("keysignaturetype",e.keySignatureType),e.style&&t.set("style",gu.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"id":return e.id=i,!0;case"clef":return e.clef=D.parseEnum(i,xe),!0;case"clefottava":return e.clefOttava=D.parseEnum(i,fe),!0;case"voices":e.voices=[];for(const a of i){const n=new Bs;fu.fromJson(n,a),e.addVoice(n)}return!0;case"similemark":return e.simileMark=D.parseEnum(i,St),!0;case"displayscale":return e.displayScale=i,!0;case"displaywidth":return e.displayWidth=i,!0;case"sustainpedals":e.sustainPedals=[];for(const a of i){const n=new xr;pu.fromJson(n,a),e.sustainPedals.push(n)}return!0;case"barlineleft":return e.barLineLeft=D.parseEnum(i,oe),!0;case"barlineright":return e.barLineRight=D.parseEnum(i,oe),!0;case"keysignature":return e.keySignature=D.parseEnum(i,_e),!0;case"keysignaturetype":return e.keySignatureType=D.parseEnum(i,Mi),!0;case"style":return i?(e.style=new vx,gu.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class yu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>yu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("name",e.name),t.set("firstfret",e.firstFret),t.set("strings",e.strings),t.set("barrefrets",e.barreFrets),t.set("showname",e.showName),t.set("showdiagram",e.showDiagram),t.set("showfingering",e.showFingering),t}static setProperty(e,t,i){switch(t){case"name":return e.name=i,!0;case"firstfret":return e.firstFret=i,!0;case"strings":return e.strings=i,!0;case"barrefrets":return e.barreFrets=i,!0;case"showname":return e.showName=i,!0;case"showdiagram":return e.showDiagram=i,!0;case"showfingering":return e.showFingering=i,!0}return!1}}class bu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>bu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("isstandard",e.isStandard),t.set("name",e.name),t.set("tunings",e.tunings),t}static setProperty(e,t,i){switch(t){case"isstandard":return e.isStandard=i,!0;case"name":return e.name=i,!0;case"tunings":return e.tunings=i,!0}return!1}}class Su{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Su.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("bars",e.bars.map(i=>mu.toJson(i))),e.chords!==null){const i=new Map;t.set("chords",i);for(const[a,n]of e.chords)i.set(a.toString(),yu.toJson(n))}return t.set("capo",e.capo),t.set("transpositionpitch",e.transpositionPitch),t.set("displaytranspositionpitch",e.displayTranspositionPitch),t.set("stringtuning",bu.toJson(e.stringTuning)),t.set("showslash",e.showSlash),t.set("shownumbered",e.showNumbered),t.set("showtablature",e.showTablature),t.set("showstandardnotation",e.showStandardNotation),t.set("ispercussion",e.isPercussion),t.set("standardnotationlinecount",e.standardNotationLineCount),t}static setProperty(e,t,i){switch(t){case"bars":e.bars=[];for(const a of i){const n=new qi;mu.fromJson(n,a),e.addBar(n)}return!0;case"chords":return e.chords=new Map,D.forEach(i,(a,n)=>{const r=new er;yu.fromJson(r,a),e.addChord(n,r)}),!0;case"capo":return e.capo=i,!0;case"transpositionpitch":return e.transpositionPitch=i,!0;case"displaytranspositionpitch":return e.displayTranspositionPitch=i,!0;case"stringtuning":return bu.fromJson(e.stringTuning,i),!0;case"showslash":return e.showSlash=i,!0;case"shownumbered":return e.showNumbered=i,!0;case"showtablature":return e.showTablature=i,!0;case"showstandardnotation":return e.showStandardNotation=i,!0;case"ispercussion":return e.isPercussion=i,!0;case"standardnotationlinecount":return e.standardNotationLineCount=i,!0}return!1}}class wu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>wu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("volume",e.volume),t.set("balance",e.balance),t.set("port",e.port),t.set("program",e.program),t.set("primarychannel",e.primaryChannel),t.set("secondarychannel",e.secondaryChannel),t.set("ismute",e.isMute),t.set("issolo",e.isSolo),t}static setProperty(e,t,i){switch(t){case"volume":return e.volume=i,!0;case"balance":return e.balance=i,!0;case"port":return e.port=i,!0;case"program":return e.program=i,!0;case"primarychannel":return e.primaryChannel=i,!0;case"secondarychannel":return e.secondaryChannel=i,!0;case"ismute":return e.isMute=i,!0;case"issolo":return e.isSolo=i,!0}return!1}}class ku{static fromJson(e,t){t&&D.forEach(t,(i,a)=>ku.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("elementtype",e.elementType),t.set("staffline",e.staffLine),t.set("noteheaddefault",e.noteHeadDefault),t.set("noteheadhalf",e.noteHeadHalf),t.set("noteheadwhole",e.noteHeadWhole),t.set("techniquesymbol",e.techniqueSymbol),t.set("techniquesymbolplacement",e.techniqueSymbolPlacement),t.set("outputmidinumber",e.outputMidiNumber),t}static setProperty(e,t,i){switch(t){case"elementtype":return e.elementType=i,!0;case"staffline":return e.staffLine=i,!0;case"noteheaddefault":return e.noteHeadDefault=D.parseEnum(i,u),!0;case"noteheadhalf":return e.noteHeadHalf=D.parseEnum(i,u),!0;case"noteheadwhole":return e.noteHeadWhole=D.parseEnum(i,u),!0;case"techniquesymbol":return e.techniqueSymbol=D.parseEnum(i,u),!0;case"techniquesymbolplacement":return e.techniqueSymbolPlacement=D.parseEnum(i,he),!0;case"outputmidinumber":return e.outputMidiNumber=i,!0}return!1}}class Tu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Tu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("colors",i);for(const[a,n]of e.colors)i.set(a.toString(),Pe.toJson(n))}return t}static setProperty(e,t,i){switch(t){case"colors":return e.colors=new Map,D.forEach(i,(a,n)=>{e.colors.set(D.parseEnum(n,Ta),Pe.fromJson(a))}),!0}return!1}}class Bu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Bu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("staves",e.staves.map(i=>Su.toJson(i))),t.set("playbackinfo",wu.toJson(e.playbackInfo)),t.set("color",Pe.toJson(e.color)),t.set("name",e.name),t.set("isvisibleonmultitrack",e.isVisibleOnMultiTrack),t.set("shortname",e.shortName),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),e.lineBreaks!==void 0){const i=[];t.set("linebreaks",i);for(const a of e.lineBreaks)i.push(a)}return t.set("percussionarticulations",e.percussionArticulations.map(i=>ku.toJson(i))),e.style&&t.set("style",Tu.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"staves":e.staves=[];for(const a of i){const n=new $o;Su.fromJson(n,a),e.addStaff(n)}return!0;case"playbackinfo":return wu.fromJson(e.playbackInfo,i),!0;case"color":return e.color=Pe.fromJson(i),!0;case"name":return e.name=i,!0;case"isvisibleonmultitrack":return e.isVisibleOnMultiTrack=i,!0;case"shortname":return e.shortName=i,!0;case"defaultsystemslayout":return e.defaultSystemsLayout=i,!0;case"systemslayout":return e.systemsLayout=i,!0;case"linebreaks":for(const a of i)e.addLineBreaks(a);return!0;case"percussionarticulations":e.percussionArticulations=[];for(const a of i){const n=new U;ku.fromJson(n,a),e.percussionArticulations.push(n)}return!0;case"style":return i?(e.style=new Ax,Tu.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class _u{static fromJson(e,t){t&&D.forEach(t,(i,a)=>_u.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;if(t.set("hidedynamics",e.hideDynamics),t.set("bracketextendmode",e.bracketExtendMode),t.set("usesystemsignseparator",e.useSystemSignSeparator),t.set("globaldisplaytuning",e.globalDisplayTuning),e.perTrackDisplayTuning!==null){const i=new Map;t.set("pertrackdisplaytuning",i);for(const[a,n]of e.perTrackDisplayTuning)i.set(a.toString(),n)}if(t.set("globaldisplaychorddiagramsontop",e.globalDisplayChordDiagramsOnTop),e.perTrackChordDiagramsOnTop!==null){const i=new Map;t.set("pertrackchorddiagramsontop",i);for(const[a,n]of e.perTrackChordDiagramsOnTop)i.set(a.toString(),n)}if(t.set("singletracktracknamepolicy",e.singleTrackTrackNamePolicy),t.set("multitracktracknamepolicy",e.multiTrackTrackNamePolicy),t.set("firstsystemtracknamemode",e.firstSystemTrackNameMode),t.set("othersystemstracknamemode",e.otherSystemsTrackNameMode),t.set("firstsystemtracknameorientation",e.firstSystemTrackNameOrientation),t.set("othersystemstracknameorientation",e.otherSystemsTrackNameOrientation),t.set("multitrackmultibarrest",e.multiTrackMultiBarRest),e.perTrackMultiBarRest!==null){const i=[];t.set("pertrackmultibarrest",i);for(const a of e.perTrackMultiBarRest)i.push(a)}return t}static setProperty(e,t,i){switch(t){case"hidedynamics":return e.hideDynamics=i,!0;case"bracketextendmode":return e.bracketExtendMode=D.parseEnum(i,la),!0;case"usesystemsignseparator":return e.useSystemSignSeparator=i,!0;case"globaldisplaytuning":return e.globalDisplayTuning=i,!0;case"pertrackdisplaytuning":return e.perTrackDisplayTuning=new Map,D.forEach(i,(a,n)=>{e.perTrackDisplayTuning.set(Number.parseInt(n),a)}),!0;case"globaldisplaychorddiagramsontop":return e.globalDisplayChordDiagramsOnTop=i,!0;case"pertrackchorddiagramsontop":return e.perTrackChordDiagramsOnTop=new Map,D.forEach(i,(a,n)=>{e.perTrackChordDiagramsOnTop.set(Number.parseInt(n),a)}),!0;case"singletracktracknamepolicy":return e.singleTrackTrackNamePolicy=D.parseEnum(i,ct),!0;case"multitracktracknamepolicy":return e.multiTrackTrackNamePolicy=D.parseEnum(i,ct),!0;case"firstsystemtracknamemode":return e.firstSystemTrackNameMode=D.parseEnum(i,Si),!0;case"othersystemstracknamemode":return e.otherSystemsTrackNameMode=D.parseEnum(i,Si),!0;case"firstsystemtracknameorientation":return e.firstSystemTrackNameOrientation=D.parseEnum(i,wi),!0;case"othersystemstracknameorientation":return e.otherSystemsTrackNameOrientation=D.parseEnum(i,wi),!0;case"multitrackmultibarrest":return e.multiTrackMultiBarRest=i,!0;case"pertrackmultibarrest":return e.perTrackMultiBarRest=new Set(i),!0}return!1}}class Nu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Nu.setProperty(e,a,i))}static toJson(e){return e?new Map:null}static setProperty(e,t,i){return!1}}class xu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>xu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("template",e.template),t.set("isvisible",e.isVisible),t.set("textalign",e.textAlign),t}static setProperty(e,t,i){switch(t){case"template":return e.template=i,!0;case"isvisible":return e.isVisible=i,!0;case"textalign":return e.textAlign=D.parseEnum(i,Q),!0}return!1}}class vu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>vu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;{const i=new Map;t.set("headerandfooter",i);for(const[a,n]of e.headerAndFooter)i.set(a.toString(),xu.toJson(n))}{const i=new Map;t.set("colors",i);for(const[a,n]of e.colors)i.set(a.toString(),Pe.toJson(n))}return t}static setProperty(e,t,i){switch(t){case"headerandfooter":return e.headerAndFooter=new Map,D.forEach(i,(a,n)=>{const r=new is;xu.fromJson(r,a),e.headerAndFooter.set(D.parseEnum(n,z),r)}),!0;case"colors":return e.colors=new Map,D.forEach(i,(a,n)=>{e.colors.set(D.parseEnum(n,z),Pe.fromJson(a))}),!0}return!1}}class Cu{static fromJson(e,t){t&&D.forEach(t,(i,a)=>Cu.setProperty(e,a,i))}static toJson(e){if(!e)return null;const t=new Map;return t.set("album",e.album),t.set("artist",e.artist),t.set("copyright",e.copyright),t.set("instructions",e.instructions),t.set("music",e.music),t.set("notices",e.notices),t.set("subtitle",e.subTitle),t.set("title",e.title),t.set("words",e.words),t.set("tab",e.tab),t.set("tempo",e.tempo),t.set("tempolabel",e.tempoLabel),t.set("masterbars",e.masterBars.map(i=>ou.toJson(i))),t.set("tracks",e.tracks.map(i=>Bu.toJson(i))),t.set("defaultsystemslayout",e.defaultSystemsLayout),t.set("systemslayout",e.systemsLayout),t.set("stylesheet",_u.toJson(e.stylesheet)),e.backingTrack&&t.set("backingtrack",Nu.toJson(e.backingTrack)),e.style&&t.set("style",vu.toJson(e.style)),t}static setProperty(e,t,i){switch(t){case"album":return e.album=i,!0;case"artist":return e.artist=i,!0;case"copyright":return e.copyright=i,!0;case"instructions":return e.instructions=i,!0;case"music":return e.music=i,!0;case"notices":return e.notices=i,!0;case"subtitle":return e.subTitle=i,!0;case"title":return e.title=i,!0;case"words":return e.words=i,!0;case"tab":return e.tab=i,!0;case"tempo":return e.tempo=i,!0;case"tempolabel":return e.tempoLabel=i,!0;case"masterbars":e.masterBars=[];for(const a of i){const n=new Ca;ou.fromJson(n,a),e.addMasterBar(n)}return!0;case"tracks":e.tracks=[];for(const a of i){const n=new Ea;Bu.fromJson(n,a),e.addTrack(n)}return!0;case"defaultsystemslayout":return e.defaultSystemsLayout=i,!0;case"systemslayout":return e.systemsLayout=i,!0;case"stylesheet":return _u.fromJson(e.stylesheet,i),!0;case"backingtrack":return i?(e.backingTrack=new ek,Nu.fromJson(e.backingTrack,i)):e.backingTrack=void 0,!0;case"style":return i?(e.style=new ko,vu.fromJson(e.style,i)):e.style=void 0,!0}return!1}}class Ft{static jsonReplacer(e,t){if(t instanceof Map){if("fromEntries"in Object)return Object.fromEntries(t);const i={};for(const[a,n]of t)i[a]=n;return i}return ArrayBuffer.isView(t)?Array.apply([],[t]):t}static scoreToJson(e){const t=Ft.scoreToJsObject(e);return JSON.stringify(t,Ft.jsonReplacer)}static jsonToScore(e,t){return Ft.jsObjectToScore(JSON.parse(e),t)}static scoreToJsObject(e){return Cu.toJson(e)}static jsObjectToScore(e,t){const i=new fn;return Cu.fromJson(i,e),i.finish(t??new sr),i}static settingsToJson(e){const t=Ft.settingsToJsObject(e);return JSON.stringify(t,Ft.jsonReplacer)}static jsonToSettings(e){return Ft.jsObjectToSettings(JSON.parse(e))}static settingsToJsObject(e){return ir.toJson(e)}static jsObjectToSettings(e){const t=new sr;return ir.fromJson(t,e),t}static jsObjectToMidiFile(e){const t=new Za;return D.forEach(e,(i,a)=>{switch(a){case"division":t.division=i;break;case"tracks":for(const n of i){const r=Ft.jsObjectToMidiTrack(n);t.tracks.push(r)}break}}),t}static jsObjectToMidiTrack(e){const t=new sk;return D.forEach(e,(i,a)=>{switch(a){case"events":for(const n of i){const r=Ft.jsObjectToMidiEvent(n);t.events.push(r)}break}}),t}static jsObjectToMidiEvent(e){const t=D.getValue(e,"track"),i=D.getValue(e,"tick"),a=D.getValue(e,"type");switch(a){case Fe.TimeSignature:return new ak(t,i,D.getValue(e,"numerator"),D.getValue(e,"denominatorIndex"),D.getValue(e,"midiClocksPerMetronomeClick"),D.getValue(e,"thirdySecondNodesInQuarter"));case Fe.AlphaTabRest:return new rk(t,i,D.getValue(e,"channel"));case Fe.AlphaTabMetronome:return new nk(t,i,D.getValue(e,"metronomeNumerator"),D.getValue(e,"metronomeDurationInTicks"),D.getValue(e,"metronomeDurationInMilliseconds"));case Fe.NoteOn:return new lk(t,i,D.getValue(e,"channel"),D.getValue(e,"noteKey"),D.getValue(e,"noteVelocity"));case Fe.NoteOff:return new hk(t,i,D.getValue(e,"channel"),D.getValue(e,"noteKey"),D.getValue(e,"noteVelocity"));case Fe.ControlChange:return new ck(t,i,D.getValue(e,"channel"),D.getValue(e,"controller"),D.getValue(e,"value"));case Fe.ProgramChange:return new uk(t,i,D.getValue(e,"channel"),D.getValue(e,"program"));case Fe.TempoChange:const n=new dk(i,0);return n.beatsPerMinute=D.getValue(e,"beatsPerMinute"),n;case Fe.PitchBend:return new fk(t,i,D.getValue(e,"channel"),D.getValue(e,"value"));case Fe.PerNotePitchBend:return new pk(t,i,D.getValue(e,"channel"),D.getValue(e,"noteKey"),D.getValue(e,"value"));case Fe.EndOfTrack:return new gk(t,i)}throw new We(Ve.Format,`Unknown Midi Event type: ${a}`)}static midiFileToJsObject(e){const t=new Map;t.set("division",e.division);const i=[];for(const a of e.tracks)i.push(Ft.midiTrackToJsObject(a));return t.set("tracks",i),t}static midiTrackToJsObject(e){const t=new Map,i=[];for(const a of e.events)i.push(Ft.midiEventToJsObject(a));return t.set("events",i),t}static midiEventToJsObject(e){const t=new Map;switch(t.set("track",e.track),t.set("tick",e.tick),t.set("type",e.type),e.type){case Fe.TimeSignature:t.set("numerator",e.numerator),t.set("denominatorIndex",e.denominatorIndex),t.set("midiClocksPerMetronomeClick",e.midiClocksPerMetronomeClick),t.set("thirdySecondNodesInQuarter",e.thirtySecondNodesInQuarter);break;case Fe.AlphaTabRest:t.set("channel",e.channel);break;case Fe.AlphaTabMetronome:t.set("metronomeNumerator",e.metronomeNumerator),t.set("metronomeDurationInMilliseconds",e.metronomeDurationInMilliseconds),t.set("metronomeDurationInTicks",e.metronomeDurationInTicks);break;case Fe.NoteOn:case Fe.NoteOff:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("noteVelocity",e.noteVelocity);break;case Fe.ControlChange:t.set("channel",e.channel),t.set("controller",e.controller),t.set("value",e.value);break;case Fe.ProgramChange:t.set("channel",e.channel),t.set("program",e.program);break;case Fe.TempoChange:t.set("beatsPerMinute",e.beatsPerMinute);break;case Fe.PitchBend:t.set("channel",e.channel),t.set("value",e.value);break;case Fe.PerNotePitchBend:t.set("channel",e.channel),t.set("noteKey",e.noteKey),t.set("value",e.value);break;case Fe.EndOfTrack:break}return t}}class lt{constructor(){this.ready=new Bt,this.samplesPlayed=new we,this.sampleRequest=new Bt}get sampleRate(){return lt.preferredSampleRate}open(){E.debug("AlphaSynth","Initializing synth worker"),this._worker=C.globalThis,this._worker.addEventListener("message",this.handleMessage.bind(this)),this.ready.trigger()}destroy(){this._worker.postMessage({cmd:"alphaSynth.output.destroy"})}handleMessage(e){const t=e.data;switch(t.cmd){case lt.CmdOutputSampleRequest:this.sampleRequest.trigger();break;case lt.CmdOutputSamplesPlayed:this.samplesPlayed.trigger(t.samples);break}}addSamples(e){this._worker.postMessage({cmd:"alphaSynth.output.addSamples",samples:C.prepareForPostMessage(e)})}play(){this._worker.postMessage({cmd:"alphaSynth.output.play"})}pause(){this._worker.postMessage({cmd:"alphaSynth.output.pause"})}resetSamples(){this._worker.postMessage({cmd:"alphaSynth.output.resetSamples"})}activate(){}async enumerateOutputDevices(){return[]}async setOutputDevice(e){}async getOutputDevice(){return null}}lt.CmdOutputPrefix="alphaSynth.output.";lt.CmdOutputAddSamples=`${lt.CmdOutputPrefix}addSamples`;lt.CmdOutputPlay=`${lt.CmdOutputPrefix}play`;lt.CmdOutputPause=`${lt.CmdOutputPrefix}pause`;lt.CmdOutputResetSamples=`${lt.CmdOutputPrefix}resetSamples`;lt.CmdOutputStop=`${lt.CmdOutputPrefix}stop`;lt.CmdOutputSampleRequest=`${lt.CmdOutputPrefix}sampleRequest`;lt.CmdOutputSamplesPlayed=`${lt.CmdOutputPrefix}samplesPlayed`;lt.preferredSampleRate=0;class Mg{constructor(e,t){this._exporter=new Map,this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this)),this._player=new yv(new lt,t),this._player.positionChanged.on(this.onPositionChanged.bind(this)),this._player.stateChanged.on(this.onPlayerStateChanged.bind(this)),this._player.finished.on(this.onFinished.bind(this)),this._player.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.soundFontLoadFailed.on(this.onSoundFontLoadFailed.bind(this)),this._player.midiLoaded.on(this.onMidiLoaded.bind(this)),this._player.midiLoadFailed.on(this.onMidiLoadFailed.bind(this)),this._player.readyForPlayback.on(this.onReadyForPlayback.bind(this)),this._player.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),this._player.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),this._main.postMessage({cmd:"alphaSynth.ready"})}static init(){const e=C.globalThis;e.addEventListener("message",t=>{const i=t.data;switch(i.cmd){case"alphaSynth.initialize":lt.preferredSampleRate=i.sampleRate,E.logLevel=i.logLevel,C.globalThis.alphaSynthWebWorker=new Mg(e,i.bufferTimeInMilliseconds);break}})}handleMessage(e){const t=e.data,i=t.cmd;switch(i){case"alphaSynth.setLogLevel":E.logLevel=t.value;break;case"alphaSynth.setMasterVolume":this._player.masterVolume=t.value;break;case"alphaSynth.setMetronomeVolume":this._player.metronomeVolume=t.value;break;case"alphaSynth.setPlaybackSpeed":this._player.playbackSpeed=t.value;break;case"alphaSynth.setTickPosition":this._player.tickPosition=t.value;break;case"alphaSynth.setTimePosition":this._player.timePosition=t.value;break;case"alphaSynth.setPlaybackRange":this._player.playbackRange=t.value;break;case"alphaSynth.setIsLooping":this._player.isLooping=t.value;break;case"alphaSynth.setCountInVolume":this._player.countInVolume=t.value;break;case"alphaSynth.setMidiEventsPlayedFilter":this._player.midiEventsPlayedFilter=t.value;break;case"alphaSynth.play":this._player.play();break;case"alphaSynth.pause":this._player.pause();break;case"alphaSynth.playPause":this._player.playPause();break;case"alphaSynth.stop":this._player.stop();break;case"alphaSynth.playOneTimeMidiFile":this._player.playOneTimeMidiFile(Ft.jsObjectToMidiFile(t.midi));break;case"alphaSynth.loadSoundFontBytes":this._player.loadSoundFont(t.data,t.append);break;case"alphaSynth.resetSoundFonts":this._player.resetSoundFonts();break;case"alphaSynth.loadMidi":this._player.loadMidiFile(Ft.jsObjectToMidiFile(t.midi));break;case"alphaSynth.setChannelMute":this._player.setChannelMute(t.channel,t.mute);break;case"alphaSynth.setChannelTranspositionPitch":this._player.setChannelTranspositionPitch(t.channel,t.semitones);break;case"alphaSynth.setChannelSolo":this._player.setChannelSolo(t.channel,t.solo);break;case"alphaSynth.setChannelVolume":this._player.setChannelVolume(t.channel,t.volume);break;case"alphaSynth.resetChannelStates":this._player.resetChannelStates();break;case"alphaSynth.destroy":this._player.destroy(),this._main.postMessage({cmd:"alphaSynth.destroyed"});break;case"alphaSynth.applyTranspositionPitches":this._player.applyTranspositionPitches(new Map(JSON.parse(t.transpositionPitches)));break}i.startsWith("alphaSynth.exporter")&&this.handleExporterMessage(e)}handleExporterMessage(e){const t=e.data,i=t.cmd;try{switch(i){case"alphaSynth.exporter.initialize":const a=this._player.exportAudio(t.options,Ft.jsObjectToMidiFile(t.midi),t.syncPoints,t.transpositionPitches);this._exporter.set(t.exporterId,a),this._main.postMessage({cmd:"alphaSynth.exporter.initialized",exporterId:t.exporterId});break;case"alphaSynth.exporter.render":if(this._exporter.has(t.exporterId)){const r=this._exporter.get(t.exporterId).render(t.milliseconds);this._main.postMessage({cmd:"alphaSynth.exporter.rendered",exporterId:t.exporterId,chunk:r})}else this._main.postMessage({cmd:"alphaSynth.exporter.error",exporterId:t.exporterId,error:new Error("Unknown exporter ID")});break;case"alphaSynth.exporter.destroy":this._exporter.delete(t.exporterId);break}}catch(a){this._main.postMessage({cmd:"alphaSynth.exporter.error",exporterId:t.exporterId,error:a})}}onPositionChanged(e){this._main.postMessage({cmd:"alphaSynth.positionChanged",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek,originalTempo:e.originalTempo,modifiedTempo:e.modifiedTempo})}onPlayerStateChanged(e){this._main.postMessage({cmd:"alphaSynth.playerStateChanged",state:e.state,stopped:e.stopped})}onFinished(){this._main.postMessage({cmd:"alphaSynth.finished"})}onSoundFontLoaded(){this._main.postMessage({cmd:"alphaSynth.soundFontLoaded"})}onSoundFontLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.soundFontLoadFailed",error:this.serializeException(C.prepareForPostMessage(e))})}serializeException(e){const t=JSON.parse(JSON.stringify(e));return e.message&&(t.message=e.message),e.stack&&(t.stack=e.stack),e.constructor&&e.constructor.name&&(t.type=e.constructor.name),t}onMidiLoaded(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",currentTime:e.currentTime,endTime:e.endTime,currentTick:e.currentTick,endTick:e.endTick,isSeek:e.isSeek,originalTempo:e.originalTempo,modifiedTempo:e.modifiedTempo})}onMidiLoadFailed(e){this._main.postMessage({cmd:"alphaSynth.midiLoaded",error:this.serializeException(C.prepareForPostMessage(e))})}onReadyForPlayback(){this._main.postMessage({cmd:"alphaSynth.readyForPlayback"})}onMidiEventsPlayed(e){this._main.postMessage({cmd:"alphaSynth.midiEventsPlayed",events:e.events.map(Ft.midiEventToJsObject)})}onPlaybackRangeChanged(e){this._main.postMessage({cmd:"alphaSynth.playbackRangeChanged",playbackRange:e.playbackRange})}}var Yi;(function(s){s[s.Browser=0]="Browser",s[s.NodeJs=1]="NodeJs",s[s.BrowserModule=2]="BrowserModule"})(Yi||(Yi={}));class Iy{constructor(e,t){this.characterWidths=e,this.fontSizeToHeight=t}}class Li{static generateFontLookup(e){if(!Li.FontSizeLookupTables.has(e))if(!C.isRunningInWorker&&C.webPlatform!==Yi.NodeJs){const i=document.createElement("canvas").getContext("2d"),a=11;i.font=`${a}px ${e}`;const n=[];let r="";for(let f=Li.ControlChars;f<255;f++){const p=String.fromCharCode(f);r+=p;const g=i.measureText(p);n.push(g.width)}const o=i.measureText(`${r}`),l=0-Math.abs(o.fontBoundingBoxAscent),c=0+Math.abs(o.fontBoundingBoxDescent)-l,d=new Iy(new Uint8Array(n),c/a);Li.FontSizeLookupTables.set(e,d)}else{const t=new Iy(new Uint8Array([8]),1.2);Li.FontSizeLookupTables.set(e,t)}}static measureString(e,t,i,a,n){let r,l=t[0];for(let d=0;d<t.length;d++)if(Li.FontSizeLookupTables.has(t[d])){l=t[d];break}Li.FontSizeLookupTables.has(l)||Li.generateFontLookup(l),r=Li.FontSizeLookupTables.get(l);let h=1;a===rt.Italic&&(h*=1.1),n===Xi.Bold&&(h*=1.1);let c=0;for(let d=0;d<e.length;d++){const f=Math.min(r.characterWidths.length-1,e.charCodeAt(d)-Li.ControlChars);f>=0&&(c+=r.characterWidths[f]*i/11)}return h*=1.07,new ed(c*h,i*r.fontSizeToHeight)}}Li.FontSizeLookupTables=new Map;Li.ControlChars=32;class Rn{constructor(){this.id=V.newGuid(),this.x=0,this.y=0,this.width=0,this.height=0,this.totalWidth=0,this.totalHeight=0,this.firstMasterBarIndex=-1,this.lastMasterBarIndex=-1,this.renderResult=null}}class Tk{constructor(){this.beats=[]}addBeat(e){e.barBounds=this,this.beats.push(e),this.masterBarBounds.addBeat(e)}findBeatAtPos(e){let t=null;for(const i of this.beats)if(!t||i.realBounds.x<e)t=i;else if(i.realBounds.x>e)break;return t}finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.beats.sort((t,i)=>t.realBounds.x-i.realBounds.x);for(const t of this.beats)t.finish(e)}}class Bk{constructor(){this.onNotesX=0,this.notes=null}addNote(e){this.notes||(this.notes=[]),e.beatBounds=this,this.notes.push(e)}findNoteAtPos(e,t){const i=this.notes;if(!i)return null;for(const a of i){const n=a.noteHeadBounds.y+a.noteHeadBounds.h,r=a.noteHeadBounds.x+a.noteHeadBounds.w;if(a.noteHeadBounds.x<=e&&a.noteHeadBounds.y<=t&&e<=r&&t<=n)return a.note}return null}finish(e=1){if(this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.onNotesX*=e,this.notes)for(const t of this.notes)t.finish(e)}}class _k{constructor(){this.index=0,this.isFirstOfLine=!1,this.bars=[],this.staffSystemBounds=null}get staveGroupBounds(){return this.staffSystemBounds}addBar(e){e.masterBarBounds=this,this.bars.push(e)}findBeatAtPos(e,t){let i=null;const a=1e7;for(const n of this.bars){const r=n.findBeatAtPos(e);if(r&&(!i||i.realBounds.x<r.realBounds.x)){const o=Math.abs(r.realBounds.x-e);(!i||o<a)&&(i=r)}}return i?i.beat:null}finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e),this.lineAlignedBounds.scaleWith(e),this.bars.sort((t,i)=>t.realBounds.y<i.realBounds.y?-1:t.realBounds.y>i.realBounds.y?1:t.realBounds.x<i.realBounds.x?-1:t.realBounds.x>i.realBounds.x?1:0);for(const t of this.bars)t.finish(e)}addBeat(e){this.staffSystemBounds.boundsLookup.addBeat(e)}}class Hh{finish(e=1){this.noteHeadBounds.scaleWith(e)}}class Nk{constructor(){this.index=0,this.bars=[]}finish(e=1){this.realBounds.scaleWith(e),this.visualBounds.scaleWith(e);for(const t of this.bars)t.finish(e)}addBar(e){this.boundsLookup.addMasterBar(e),e.staffSystemBounds=this,this.bars.push(e)}findBarAtPos(e){let t=null;for(const i of this.bars)if(!t||i.realBounds.x<e)t=i;else if(e>i.realBounds.x+i.realBounds.w)break;return t}}class ji{constructor(){this._beatLookup=new Map,this._masterBarLookup=new Map,this._currentStaffSystem=null,this.staffSystems=[],this.isFinished=!1}toJson(){const e={},t=[];e.staffSystems=t;for(const i of this.staffSystems){const a={};a.visualBounds=this.boundsToJson(i.visualBounds),a.realBounds=this.boundsToJson(i.realBounds),a.bars=[];for(const n of i.bars){const r={};r.lineAlignedBounds=this.boundsToJson(n.lineAlignedBounds),r.visualBounds=this.boundsToJson(n.visualBounds),r.realBounds=this.boundsToJson(n.realBounds),r.index=n.index,r.bars=[];for(const o of n.bars){const l={};l.visualBounds=this.boundsToJson(o.visualBounds),l.realBounds=this.boundsToJson(o.realBounds),l.beats=[];for(const h of o.beats){const c={};c.visualBounds=this.boundsToJson(h.visualBounds),c.realBounds=this.boundsToJson(h.realBounds),c.onNotesX=h.onNotesX;const d=c;if(d.beatIndex=h.beat.index,d.voiceIndex=h.beat.voice.index,d.barIndex=h.beat.voice.bar.index,d.staffIndex=h.beat.voice.bar.staff.index,d.trackIndex=h.beat.voice.bar.staff.track.index,h.notes){const f=[];c.notes=f;for(const p of h.notes){const g={},m=g;m.index=p.note.index,g.noteHeadBounds=this.boundsToJson(p.noteHeadBounds),f.push(g)}}l.beats.push(c)}r.bars.push(l)}a.bars.push(r)}t.push(a)}return e}static fromJson(e,t){const i=new ji,a=e.staffSystems;for(const n of a){const r=new Nk;r.visualBounds=ji.boundsFromJson(n.visualBounds),r.realBounds=ji.boundsFromJson(n.realBounds),i.addStaffSystem(r);for(const o of n.bars){const l=new _k;l.index=o.index,l.isFirstOfLine=o.isFirstOfLine,l.lineAlignedBounds=ji.boundsFromJson(o.lineAlignedBounds),l.visualBounds=ji.boundsFromJson(o.visualBounds),l.realBounds=ji.boundsFromJson(o.realBounds),r.addBar(l);for(const h of o.bars){const c=new Tk;c.visualBounds=ji.boundsFromJson(h.visualBounds),c.realBounds=ji.boundsFromJson(h.realBounds),l.addBar(c);for(const d of h.beats){const f=new Bk;f.visualBounds=ji.boundsFromJson(d.visualBounds),f.realBounds=ji.boundsFromJson(d.realBounds),f.onNotesX=d.onNotesX;const p=d;if(f.beat=t.tracks[p.trackIndex].staves[p.staffIndex].bars[p.barIndex].voices[p.voiceIndex].beats[p.beatIndex],d.notes){f.notes=[];for(const g of d.notes){const m=new Hh,T=g;m.note=f.beat.notes[T.index],m.noteHeadBounds=ji.boundsFromJson(g.noteHeadBounds),f.addNote(m)}}c.addBeat(f)}}}}return i}static boundsFromJson(e){const t=new hi;return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}boundsToJson(e){const t={};return t.x=e.x,t.y=e.y,t.w=e.w,t.h=e.h,t}finish(e=1){for(const t of this.staffSystems)t.finish(e);this.isFinished=!0}addStaffSystem(e){e.index=this.staffSystems.length,e.boundsLookup=this,this.staffSystems.push(e),this._currentStaffSystem=e}addMasterBar(e){e.staffSystemBounds?this._masterBarLookup.set(e.index,e):(e.staffSystemBounds=this._currentStaffSystem,this._masterBarLookup.set(e.index,e),this._currentStaffSystem.addBar(e))}addBeat(e){var t;this._beatLookup.has(e.beat.id)||this._beatLookup.set(e.beat.id,[]),(t=this._beatLookup.get(e.beat.id))==null||t.push(e)}findMasterBarByIndex(e){return this._masterBarLookup.has(e)?this._masterBarLookup.get(e):null}findMasterBar(e){const t=e.index;return this._masterBarLookup.has(t)?this._masterBarLookup.get(t):null}findBeat(e){const t=this.findBeats(e);return t?t[0]:null}findBeats(e){const t=e.id;return this._beatLookup.has(t)?this._beatLookup.get(t):null}getBeatAtPos(e,t){let i=0,a=this.staffSystems.length-1,n=-1;for(;i<=a;){const l=(a+i)/2|0,h=this.staffSystems[l];if(t>=h.realBounds.y&&t<=h.realBounds.y+h.realBounds.h){n=l;break}t<h.realBounds.y?a=l-1:i=l+1}if(n===-1)return null;const o=this.staffSystems[n].findBarAtPos(e);return o?o.findBeatAtPos(e,t):null}getNoteAtPos(e,t,i){const a=this.findBeats(e);if(a)for(const n of a){const r=n.findNoteAtPos(t,i);if(r)return r}return null}}class gl{constructor(e){this._currentLayoutMode=nn.Page,this._currentRenderEngine=null,this._renderedTracks=null,this.canvas=null,this.score=null,this.tracks=null,this.layout=null,this.boundsLookup=null,this.width=0,this.preRender=new we,this.renderFinished=new we,this.partialRenderFinished=new we,this.partialLayoutFinished=new we,this.postRenderFinished=new Bt,this.error=new we,this.settings=e,this.recreateCanvas(),this.recreateLayout()}destroy(){var e;this.score=null,(e=this.canvas)==null||e.destroy(),this.canvas=null,this.layout=null,this.boundsLookup=null,this.tracks=null}recreateCanvas(){var e;return this._currentRenderEngine!==this.settings.core.engine?((e=this.canvas)==null||e.destroy(),this.canvas=C.getRenderEngineFactory(this.settings.core.engine).createCanvas(),this._currentRenderEngine=this.settings.core.engine,!0):!1}recreateLayout(){return!this.layout||this._currentLayoutMode!==this.settings.display.layoutMode?(this.layout=C.getLayoutEngineFactory(this.settings.display.layoutMode).createLayout(this),this._currentLayoutMode=this.settings.display.layoutMode,!0):!1}renderScore(e,t){try{this.score=e;let i=null;if(e!=null&&t!=null){if(!t)i=e.tracks.slice(0);else{i=[];for(const a of t)a>=0&&a<e.tracks.length&&i.push(e.tracks[a])}i.length===0&&e.tracks.length>0&&i.push(e.tracks[0])}this.tracks=i,this.render()}catch(i){this.error.trigger(i)}}renderTracks(e){e.length===0?this.score=null:this.score=e[0].score,this.tracks=e,this.render()}updateSettings(e){this.settings=e}renderResult(e){try{const t=this.layout;t?(E.debug("Rendering",`Request render of lazy partial ${e}`),t.renderLazyPartial(e)):E.warning("Rendering",`Request render of lazy partial ${e} ignored, no layout exists`)}catch(t){this.error.trigger(t)}}render(){if(this.width===0){E.warning("Rendering","AlphaTab skipped rendering because of width=0 (element invisible)",null);return}if(this.boundsLookup=new ji,this.recreateCanvas(),this.canvas.lineWidth=1,this.canvas.settings=this.settings,!this.tracks||this.tracks.length===0||!this.score)E.debug("Rendering","Clearing rendered tracks because no score or tracks are set"),this.preRender.trigger(!1),this._renderedTracks=null,this.onRenderFinished(),this.postRenderFinished.trigger(),E.debug("Rendering","Clearing finished");else{E.debug("Rendering",`Rendering ${this.tracks.length} tracks`);for(let e=0;e<this.tracks.length;e++){const t=this.tracks[e];E.debug("Rendering",`Track ${e}: ${t.name}`)}this.preRender.trigger(!1),this.recreateLayout(),this.layoutAndRender(),E.debug("Rendering","Rendering finished")}}resizeRender(){this.recreateLayout()||this.recreateCanvas()||this._renderedTracks!==this.tracks||!this.tracks?(E.debug("Rendering","Starting full rerendering due to layout or canvas change",null),this.render()):this.layout.supportsResize?(E.debug("Rendering","Starting optimized rerendering for resize"),this.boundsLookup=new ji,this.preRender.trigger(!0),this.canvas.settings=this.settings,this.layout.resize(),this.onRenderFinished(),this.postRenderFinished.trigger()):E.debug("Rendering","Current layout does not support dynamic resizing, nothing was done",null),E.debug("Rendering","Resize finished")}layoutAndRender(){E.debug("Rendering",`Rendering at scale ${this.settings.display.scale} with layout ${this.layout.name}`,null),this.layout.layoutAndRender(),this._renderedTracks=this.tracks,this.onRenderFinished(),this.postRenderFinished.trigger()}onRenderFinished(){var t;(t=this.boundsLookup)==null||t.finish(this.settings.display.scale);const e=new Rn;e.totalHeight=this.layout.height,e.totalWidth=this.layout.width,e.renderResult=this.canvas.onRenderFinished(),this.renderFinished.trigger(e)}}class Rg{constructor(e){this._main=e,this._main.addEventListener("message",this.handleMessage.bind(this),!1)}static init(){C.globalThis.alphaTabWebWorker=new Rg(C.globalThis)}handleMessage(e){const t=e.data;switch(t?t.cmd:""){case"alphaTab.initialize":const a=Ft.jsObjectToSettings(t.settings);E.logLevel=a.core.logLevel,this._renderer=new gl(a),this._renderer.partialRenderFinished.on(r=>{this._main.postMessage({cmd:"alphaTab.partialRenderFinished",result:r})}),this._renderer.partialLayoutFinished.on(r=>{this._main.postMessage({cmd:"alphaTab.partialLayoutFinished",result:r})}),this._renderer.renderFinished.on(r=>{this._main.postMessage({cmd:"alphaTab.renderFinished",result:r})}),this._renderer.postRenderFinished.on(()=>{var r;this._main.postMessage({cmd:"alphaTab.postRenderFinished",boundsLookup:((r=this._renderer.boundsLookup)==null?void 0:r.toJson())??null})}),this._renderer.preRender.on(r=>{this._main.postMessage({cmd:"alphaTab.preRender",resize:r})}),this._renderer.error.on(this.error.bind(this));break;case"alphaTab.invalidate":this._renderer.render();break;case"alphaTab.resizeRender":this._renderer.resizeRender();break;case"alphaTab.renderResult":this._renderer.renderResult(t.resultId);break;case"alphaTab.setWidth":this._renderer.width=t.width;break;case"alphaTab.renderScore":this.updateFontSizes(t.fontSizes);const n=t.score==null?null:Ft.jsObjectToScore(t.score,this._renderer.settings);this.renderMultiple(n,t.trackIndexes);break;case"alphaTab.updateSettings":this.updateSettings(t.settings);break}}updateFontSizes(e){if(!(e instanceof Map)){const t=e;e=new Map;for(const i in t)e.set(i,t[i])}if(e){Li.FontSizeLookupTables||(Li.FontSizeLookupTables=new Map);for(const[t,i]of e)Li.FontSizeLookupTables.set(t,i)}}updateSettings(e){ir.fromJson(this._renderer.settings,e)}renderMultiple(e,t){try{this._renderer.renderScore(e,t)}catch(i){this.error(i)}}error(e){E.error("Worker","An unexpected error occurred in worker",e),this._main.postMessage({cmd:"alphaTab.error",error:e})}}class Nv{constructor(){this._canvas=null,this._color=new Pe(0,0,0,255),this._font=new ge("Arial",10,rt.Plain),this._lineWidth=0,this._measureCanvas=document.createElement("canvas"),this._measureCanvas.width=10,this._measureCanvas.height=10,this._measureCanvas.style.width="10px",this._measureCanvas.style.height="10px",this._measureContext=this._measureCanvas.getContext("2d"),this._measureContext.textBaseline="hanging"}destroy(){}onRenderFinished(){return null}beginRender(e,t){this._musicFont=this.settings.display.resources.smuflFont;const i=this.settings.display.scale;this._canvas=document.createElement("canvas"),this._canvas.width=e*C.HighDpiFactor|0,this._canvas.height=t*C.HighDpiFactor|0,this._canvas.style.width=`${e}px`,this._canvas.style.height=`${t}px`,this._context=this._canvas.getContext("2d"),this._context.textBaseline="hanging",this._context.scale(C.HighDpiFactor*i,C.HighDpiFactor*i),this._context.lineWidth=this._lineWidth}endRender(){const e=this._canvas;return this._canvas=null,e}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._context.strokeStyle=e.rgba,this._context.fillStyle=e.rgba)}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._context&&(this._context.lineWidth=e)}fillRect(e,t,i,a){i>0&&this._context.fillRect(e|0,t|0,i,a)}strokeRect(e,t,i,a){const n=this.lineWidth%2===0?0:.5;this._context.strokeRect((e|0)+n,(t|0)+n,i,a)}beginPath(){this._context.beginPath()}closePath(){this._context.closePath()}moveTo(e,t){this._context.moveTo(e,t)}lineTo(e,t){this._context.lineTo(e,t)}quadraticCurveTo(e,t,i,a){this._context.quadraticCurveTo(e,t,i,a)}bezierCurveTo(e,t,i,a,n,r){this._context.bezierCurveTo(e,t,i,a,n,r)}fillCircle(e,t,i){this._context.beginPath(),this._context.arc(e,t,i,0,Math.PI*2,!0),this.fill()}strokeCircle(e,t,i){this._context.beginPath(),this._context.arc(e,t,i,0,Math.PI*2,!0),this.stroke()}fill(){this._context.fill(),this._context.beginPath()}stroke(){this._context.stroke(),this._context.beginPath()}get font(){return this._font}set font(e){this._font=e,this._context&&(this._context.font=e.toCssString(1)),this._measureContext.font=e.toCssString(1)}get textAlign(){switch(this._context.textAlign){case"left":return Q.Left;case"center":return Q.Center;case"right":return Q.Right;default:return Q.Left}}set textAlign(e){switch(e){case Q.Left:this._context.textAlign="left";break;case Q.Center:this._context.textAlign="center";break;case Q.Right:this._context.textAlign="right";break}}get textBaseline(){switch(this._context.textBaseline){case"hanging":return he.Top;case"middle":return he.Middle;case"bottom":return he.Bottom;default:return he.Top}}set textBaseline(e){switch(e){case he.Top:this._context.textBaseline="hanging";break;case he.Middle:this._context.textBaseline="middle";break;case he.Bottom:this._context.textBaseline="bottom";break}}beginGroup(e){}endGroup(){}fillText(e,t,i){this._context.fillText(e,t,i)}measureText(e){const t=this._measureContext.measureText(e);return new ed(t.width,t.actualBoundingBoxDescent+t.actualBoundingBoxAscent)}fillMusicFontSymbol(e,t,i,a,n=!1){a!==u.None&&this.fillMusicFontSymbolText(e,t,i,String.fromCharCode(a),n)}fillMusicFontSymbols(e,t,i,a,n=!1){let r="";for(const o of a)o!==u.None&&(r+=String.fromCharCode(o));this.fillMusicFontSymbolText(e,t,i,r,n)}fillMusicFontSymbolText(e,t,i,a,n){const r=this._context.textAlign,o=this._context.textBaseline,l=this._context.font;this._context.font=this._musicFont.toCssString(i),this._context.textBaseline="middle",n?this._context.textAlign="center":this._context.textAlign="left",this._context.fillText(a,e,t),this._context.textBaseline=o,this._context.font=l,this._context.textAlign=r}beginRotate(e,t,i){this._context.save(),this._context.translate(e,t),this._context.rotate(i*Math.PI/180)}endRotate(){this._context.restore()}}class ra{constructor(e,t=!1){this._midiFile=e,this._smf1Mode=t}addTimeSignature(e,t,i){let a=0,n=i;for(;n=n>>1,n>0;)a++;this._midiFile.addEvent(new ak(0,e,t,a,48,8))}addRest(e,t,i){this._smf1Mode||this._midiFile.addEvent(new rk(e,t,i))}addNote(e,t,i,a,n,r){this._midiFile.addEvent(new lk(e,t,r,ra.fixValue(a),ra.fixValue(n))),this._midiFile.addEvent(new hk(e,t+i,r,ra.fixValue(a),ra.fixValue(n)))}static fixValue(e){return e>127?127:e<0?0:e}addControlChange(e,t,i,a,n){this._midiFile.addEvent(new ck(e,t,i,a,ra.fixValue(n)))}addProgramChange(e,t,i,a){this._midiFile.addEvent(new uk(e,t,i,a))}addTempo(e,t){const i=new dk(e,0);i.beatsPerMinute=t,this._midiFile.addEvent(i)}addBend(e,t,i,a){a>=te.MaxPitchWheel?a=te.MaxPitchWheel:a=Math.floor(a),this._midiFile.addEvent(new fk(e,t,i,a))}addNoteBend(e,t,i,a,n){this._smf1Mode?this.addBend(e,t,i,n):(n=n*te.MaxPitchWheel20/te.MaxPitchWheel,this._midiFile.addEvent(new pk(e,t,i,a,n)))}finishTrack(e,t){(this._midiFile.format===Ao.MultiTrack||e===0)&&this._midiFile.addEvent(new gk(e,t))}}class xv{constructor(e,t){this.closingIndex=0,this.group=e,this.opening=t,e.closings=e.closings.sort((i,a)=>i.index-a.index),this.iterations=e.closings.map(i=>0)}}var Qt;(function(s){s[s.PlayingNormally=0]="PlayingNormally",s[s.DirectionJumped=1]="DirectionJumped",s[s.DirectionJumpedAlCoda=2]="DirectionJumpedAlCoda",s[s.DirectionJumpedAlDoubleCoda=3]="DirectionJumpedAlDoubleCoda",s[s.DirectionJumpedAlFine=4]="DirectionJumpedAlFine"})(Qt||(Qt={}));class vv{get finished(){return this.index>=this._score.masterBars.length}constructor(e){this._repeatStack=[],this._groupsOnStack=new Set,this._previousAlternateEndings=0,this._state=Qt.PlayingNormally,this.shouldPlay=!0,this.index=0,this.currentTick=0,this._score=e}processCurrent(){const e=this._score.masterBars[this.index];if(this._state===Qt.PlayingNormally){let t=e.alternateEndings;if(t===0&&(t=this._previousAlternateEndings),e===e.repeatGroup.opening&&e.repeatGroup.isClosed&&!this._groupsOnStack.has(e.repeatGroup)){const i=new xv(e.repeatGroup,e);this._repeatStack.push(i),this._groupsOnStack.add(e.repeatGroup),this._previousAlternateEndings=0,t=e.alternateEndings}if(this._repeatStack.length===0||t===0)this.shouldPlay=!0;else{const i=this._repeatStack[this._repeatStack.length-1],a=i.iterations[i.closingIndex];this._previousAlternateEndings=t,t&1<<a?this.shouldPlay=!0:this.shouldPlay=!1}}else this.shouldPlay=!0;this.shouldPlay&&(this.currentTick+=e.calculateDuration())}moveNext(){this.moveNextWithDirections()||this.moveNextWithNormalRepeats()}resetRepeats(){this._groupsOnStack.clear(),this._previousAlternateEndings=0,this._repeatStack=[]}handleDaCapo(e,t,i){return e.has(t)?(this.index=0,this._state=i,this.resetRepeats(),!0):!1}handleDalSegno(e,t,i,a){if(e.has(t)){const n=this.findJumpTarget(a,this.index,!0);return n===-1?!1:(this.index=n,this._state=i,this.resetRepeats(),!0)}return!1}handleDaCoda(e,t,i){if(e.has(t)){const a=this.findJumpTarget(i,this.index,!1);return a===-1?(this.index++,!0):(this.index=a,this._state=Qt.PlayingNormally,!0)}return!1}moveNextWithDirections(){const e=this._score.masterBars[this.index],t=e.directions!==null&&e.directions.size>0;if(this._state===Qt.PlayingNormally&&!t)return!1;if(!t)return this.index++,!0;switch(this._state){case Qt.PlayingNormally:return!!(this.handleDaCapo(e.directions,R.JumpDaCapo,Qt.DirectionJumped)||this.handleDaCapo(e.directions,R.JumpDaCapoAlCoda,Qt.DirectionJumpedAlCoda)||this.handleDaCapo(e.directions,R.JumpDaCapoAlDoubleCoda,Qt.DirectionJumpedAlDoubleCoda)||this.handleDaCapo(e.directions,R.JumpDaCapoAlFine,Qt.DirectionJumpedAlFine)||this.handleDalSegno(e.directions,R.JumpDalSegno,Qt.DirectionJumped,R.TargetSegno)||this.handleDalSegno(e.directions,R.JumpDalSegnoAlCoda,Qt.DirectionJumpedAlCoda,R.TargetSegno)||this.handleDalSegno(e.directions,R.JumpDalSegnoAlDoubleCoda,Qt.DirectionJumpedAlDoubleCoda,R.TargetSegno)||this.handleDalSegno(e.directions,R.JumpDalSegnoAlFine,Qt.DirectionJumpedAlFine,R.TargetSegno)||this.handleDalSegno(e.directions,R.JumpDalSegnoSegno,Qt.DirectionJumped,R.TargetSegnoSegno)||this.handleDalSegno(e.directions,R.JumpDalSegnoSegnoAlCoda,Qt.DirectionJumpedAlCoda,R.TargetSegnoSegno)||this.handleDalSegno(e.directions,R.JumpDalSegnoSegnoAlDoubleCoda,Qt.DirectionJumpedAlDoubleCoda,R.TargetSegnoSegno)||this.handleDalSegno(e.directions,R.JumpDalSegnoSegnoAlFine,Qt.DirectionJumpedAlFine,R.TargetSegnoSegno));case Qt.DirectionJumped:return this.index++,!0;case Qt.DirectionJumpedAlCoda:return this.handleDaCoda(e.directions,R.JumpDaCoda,R.TargetCoda)||this.index++,!0;case Qt.DirectionJumpedAlDoubleCoda:return this.handleDaCoda(e.directions,R.JumpDaDoubleCoda,R.TargetDoubleCoda)||this.index++,!0;case Qt.DirectionJumpedAlFine:return e.directions.has(R.TargetFine)?(this.index=this._score.masterBars.length,!0):(this.index++,!0)}return!0}findJumpTarget(e,t,i){let a;return i?(a=this.findJumpTargetBackwards(e,t),a===-1&&(a=this.findJumpTargetForwards(e,t)),a):(a=this.findJumpTargetForwards(e,t),a===-1&&(a=this.findJumpTargetBackwards(e,t)),a)}findJumpTargetForwards(e,t){let i=t;for(;i<this._score.masterBars.length;){const a=this._score.masterBars[i].directions;if(a&&a.has(e))return i;i++}return-1}findJumpTargetBackwards(e,t){let i=t;for(;i>=0;){const a=this._score.masterBars[i].directions;if(a&&a.has(e))return i;i--}return-1}moveNextWithNormalRepeats(){const t=this._score.masterBars[this.index].repeatCount-1;if(this._repeatStack.length>0&&t>0){const i=this._repeatStack[this._repeatStack.length-1];if(i.iterations[i.closingIndex]<t){this.index=i.opening.index,i.iterations[i.closingIndex]++;for(let n=0;n<i.closingIndex;n++)i.iterations[n]=0;i.closingIndex=0,this._previousAlternateEndings=0}else i.closingIndex<i.group.closings.length-1?(i.closingIndex++,this.index++):(this._repeatStack.pop(),this._groupsOnStack.delete(i.group),this.index++)}else this.index++}}class Cv{constructor(e,t){this.beat=e,this.playbackStart=t}}class zs{get duration(){return this.end-this.start}constructor(e,t){this._highlightedBeats=new Map,this.highlightedBeats=[],this.nextBeat=null,this.previousBeat=null,this.start=e,this.end=t}highlightBeat(e,t){e.isEmpty&&!e.voice.isEmpty||this._highlightedBeats.has(e.id)||(this._highlightedBeats.set(e.id,!0),this.highlightedBeats.push(new Cv(e,t)))}getVisibleBeatAtStart(e){for(const t of this.highlightedBeats)if(t.playbackStart===this.start&&e.has(t.beat.voice.bar.staff.track.index))return t.beat;return null}}class rc{constructor(e,t){this.tick=e,this.tempo=t}}class xk{constructor(){this.start=0,this.end=0,this.tempoChanges=[],this.firstBeat=null,this.lastBeat=null,this.nextMasterBar=null,this.previousMasterBar=null}get tempo(){return this.tempoChanges[0].tempo}insertAfter(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.nextBeat=e.nextBeat,t.previousBeat=e,e.nextBeat&&(e.nextBeat.previousBeat=t),e.nextBeat=t,e===this.lastBeat&&(this.lastBeat=t))}insertBefore(e,t){this.firstBeat==null||e==null||this.lastBeat==null?(this.firstBeat=t,this.lastBeat=t):(t.previousBeat=e.previousBeat,t.nextBeat=e,e.previousBeat&&(e.previousBeat.nextBeat=t),e.previousBeat=t,e===this.firstBeat&&(this.firstBeat=t))}addBeat(e,t,i,a){const n=i+a;if(this.firstBeat==null){const r=new zs(i,n);r.highlightBeat(e,t),this.insertAfter(this.firstBeat,r)}else if(i>=this.lastBeat.end){const r=new zs(this.lastBeat.end,n);r.highlightBeat(e,t),this.insertAfter(this.lastBeat,r)}else{let r=null;if(i<this.firstBeat.start)r=this.firstBeat;else{let o=this.firstBeat;for(;o!=null;){if(i>=o.start&&i<o.end){r=o;break}o=o.nextBeat}if(r===null)throw new We(Ve.General,"Error on building lookup, unknown variant")}if(i<r.start)if(n===r.start){const o=new zs(i,r.start);o.highlightBeat(e,t),this.insertBefore(this.firstBeat,o)}else if(n<r.end){const o=new zs(i,r.start);o.highlightBeat(e,t),this.insertBefore(r,o);const l=new zs(r.start,n);for(const h of r.highlightedBeats)l.highlightBeat(h.beat,h.playbackStart);l.highlightBeat(e,t),this.insertBefore(r,l),r.start=n}else if(n===r.end){const o=new zs(i,r.start);o.highlightBeat(e,t),r.highlightBeat(e,t),this.insertBefore(r,o)}else{const o=new zs(i,r.start);o.highlightBeat(e,t),r.highlightBeat(e,t),this.insertBefore(r,o),this.addBeat(e,t,r.end,n-r.end)}else if(i>r.start)if(n===r.end){const o=new zs(r.start,i);for(const l of r.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);r.start=i,r.highlightBeat(e,t),this.insertBefore(r,o)}else if(n<r.end){const o=new zs(r.start,i);this.insertBefore(r,o);const l=new zs(i,n);this.insertBefore(r,l);for(const h of r.highlightedBeats)o.highlightBeat(h.beat,h.playbackStart),l.highlightBeat(h.beat,h.playbackStart);l.highlightBeat(e,t),r.start=n}else{const o=new zs(r.start,i);for(const l of r.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);r.start=i,r.highlightBeat(e,t),this.insertBefore(r,o),this.addBeat(e,t,r.end,n-r.end)}else if(n===r.end)r.highlightBeat(e,t);else if(n<r.end){const o=new zs(r.start,n);for(const l of r.highlightedBeats)o.highlightBeat(l.beat,l.playbackStart);o.highlightBeat(e,t),r.start=n,this.insertBefore(r,o)}else r.highlightBeat(e,t),this.addBeat(e,t,r.end,n-r.end)}}}var Cs;(function(s){s[s.Unknown=0]="Unknown",s[s.ToNextBext=1]="ToNextBext",s[s.ToEndOfBar=2]="ToEndOfBar"})(Cs||(Cs={}));class Ev{get start(){return this.masterBar.start+this.beatLookup.start}get end(){return this.start+this.tickDuration}constructor(e){this.nextBeat=null,this.tickDuration=0,this.duration=0,this.cursorMode=Cs.Unknown,this.masterBar=e}calculateDuration(){if(this.masterBar.tempoChanges.length===1)this.duration=v.ticksToMillis(this.tickDuration,this.masterBar.tempoChanges[0].tempo);else{let e=0,t=this.start,i=this.masterBar.tempoChanges[0].tempo;const a=this.end;for(const n of this.masterBar.tempoChanges)if(n.tick<t)i=n.tempo;else{if(n.tick>a)break;e+=v.ticksToMillis(n.tick-t,i),i=n.tempo,t=n.tick}a>t&&(e+=v.ticksToMillis(a-t,i)),this.duration=e}}}class Dv{constructor(){this._currentMasterBar=null,this.masterBarLookup=new Map,this.masterBars=[],this.multiBarRestInfo=null}findBeat(e,t,i=null){let a=null;return i&&(a=this.findBeatFast(e,i,t)),a||(a=this.findBeatSlow(e,i,t,!1)),a}findBeatFast(e,t,i){if(i>=t.start&&i<t.end)return t;if(t.nextBeat&&i>=t.nextBeat.start&&i<t.nextBeat.end){const a=t.nextBeat;return this.fillNextBeat(a,e),a}return null}fillNextBeatMultiBarRest(e,t){const i=this.multiBarRestInfo.get(e.masterBar.masterBar.index);let a=e.masterBar;for(let n=0;n<i.length&&a;n++)a=a.nextMasterBar;a?a.nextMasterBar?(e.nextBeat=this.firstBeatInMasterBar(t,a.nextMasterBar,a.nextMasterBar.start,!0),e.nextBeat?(e.tickDuration=e.nextBeat.start-e.start,e.cursorMode=Cs.ToNextBext,e.nextBeat.masterBar.masterBar.index!==a.masterBar.index+1&&(e.nextBeat.masterBar.masterBar.index!==a.masterBar.index||e.nextBeat.beat.playbackStart<=e.beat.playbackStart)&&(e.cursorMode=Cs.ToEndOfBar)):(e.tickDuration=a.nextMasterBar.end-e.start,e.cursorMode=Cs.ToEndOfBar)):(e.tickDuration=a.end-e.start,e.cursorMode=Cs.ToEndOfBar):(E.warning("Synth","MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain fill-next)"),e.tickDuration=(e.masterBar.end-e.masterBar.start)*(i.length+1),e.cursorMode=Cs.ToEndOfBar),e.calculateDuration()}fillNextBeat(e,t){this.isMultiBarRestResult(e)?this.fillNextBeatMultiBarRest(e,t):this.fillNextBeatDefault(e,t)}fillNextBeatDefault(e,t){e.nextBeat=this.findBeatInMasterBar(e.masterBar,e.beatLookup.nextBeat,e.end,t,!0),e.nextBeat==null&&(e.nextBeat=this.findBeatSlow(t,e,e.end,!0)),e.nextBeat?(e.tickDuration=e.nextBeat.start-e.start,e.cursorMode=Cs.ToNextBext,e.calculateDuration()):(e.tickDuration=e.masterBar.end-e.start,e.cursorMode=Cs.ToEndOfBar,e.calculateDuration()),e.nextBeat&&e.nextBeat.masterBar.masterBar.index!==e.masterBar.masterBar.index+1&&(e.nextBeat.masterBar.masterBar.index!==e.masterBar.masterBar.index||e.nextBeat.beat.playbackStart<=e.beat.playbackStart)&&(e.cursorMode=Cs.ToEndOfBar)}isMultiBarRestResult(e){return this.internalIsMultiBarRestResult(e.masterBar.masterBar.index,e.beat)}internalIsMultiBarRestResult(e,t){return this.multiBarRestInfo&&this.multiBarRestInfo.has(e)&&t.isRest&&t.voice.bar.isRestOnly}findBeatSlow(e,t,i,a){let n=null;return t!=null&&(t.masterBar.start<=i&&t.masterBar.end>i?n=t.masterBar:t.masterBar.nextMasterBar&&t.masterBar.nextMasterBar.start<=i&&t.masterBar.nextMasterBar.end>i&&(n=t.masterBar.nextMasterBar)),n||(n=this.findMasterBar(i)),n?this.firstBeatInMasterBar(e,n,i,a):null}firstBeatInMasterBar(e,t,i,a){let n=t;for(;n;){if(n.firstBeat){const r=this.findBeatInMasterBar(n,n.firstBeat,i,e,a);if(r)return r}n=n.nextMasterBar}return null}findBeatInMasterBar(e,t,i,a,n){if(!t)return null;let r=null,o=null;const l=i-e.start;for(;t!=null&&o==null;){if((t.start<=l||n&&l<0)&&l<t.end){if(r=t,o=t.getVisibleBeatAtStart(a),!o)if(n){let c=e;for(;c!=null&&o==null;){for(;t!=null;){if(o=t.getVisibleBeatAtStart(a),o){r=t,e=c;break}t=t.nextBeat}(!o||!r)&&(c=c.nextMasterBar,t=(c==null?void 0:c.firstBeat)??null)}}else{let c=e;for(;c!=null&&o==null;){for(;t!=null;){if(o=t.getVisibleBeatAtStart(a),o){r=t,e=c;break}t=t.previousBeat}(!o||!r)&&(c=c.previousMasterBar,t=(c==null?void 0:c.firstBeat)??null)}}}else if(t.end>l)break;t=(t==null?void 0:t.nextBeat)??null}return o==null?null:this.createResult(e,r,o,n,a)}createResult(e,t,i,a,n){const r=new Ev(e);if(r.beat=i,r.beatLookup=t,r.tickDuration=t.end-t.start,!a)this.fillNextBeat(r,n);else if(this.isMultiBarRestResult(r)){const o=this.multiBarRestInfo.get(e.masterBar.index);let l=e;for(let h=0;h<o.length&&l;h++)l=l.nextMasterBar;l?l.nextMasterBar?r.tickDuration=l.nextMasterBar.start-t.start:r.tickDuration=l.end-t.start:E.warning("Synth","MultiBar Rest Info and the nextMasterBar are out of sync, this is an unexpected error. Please report it as bug.  (broken chain stretch-result)")}return r.calculateDuration(),r}findMasterBar(e){const t=this.masterBars;let i=0,a=t.length-1;for(;i<=a;){const n=(a+i)/2|0,r=t[n];if(e>=r.start&&e<r.end)return r;e<r.start?a=n-1:i=n+1}return null}getMasterBar(e){if(!this.masterBarLookup.has(e.index)){const t=new xk;return t.masterBar=e,t}return this.masterBarLookup.get(e.index)}getMasterBarStart(e){return this.masterBarLookup.has(e.index)?this.masterBarLookup.get(e.index).start:0}getBeatStart(e){return this.masterBarLookup.has(e.voice.bar.index)?this.masterBarLookup.get(e.voice.bar.index).start+e.playbackStart:0}addMasterBar(e){this.masterBars.push(e),this._currentMasterBar&&(e.previousMasterBar=this._currentMasterBar,this._currentMasterBar.nextMasterBar=e),this._currentMasterBar=e,this.masterBarLookup.has(e.masterBar.index)||this.masterBarLookup.set(e.masterBar.index,e)}addBeat(e,t,i){const a=this._currentMasterBar;if(a)if(t<0&&a.previousMasterBar){const n=a.previousMasterBar.end-a.previousMasterBar.start,r=n+t,o=r+i;if(a.previousMasterBar.addBeat(e,r,r,i),o>n){const l=i+t;a.addBeat(e,t,0,l)}}else a.addBeat(e,t,t,i)}}class Pv{constructor(){this.noteOnly=0,this.untilTieOrSlideEnd=0,this.letRingEnd=0}}class Lv{constructor(){this.firstBeatDuration=0,this.secondBeatStartOffset=0,this.secondBeatDuration=0}}class Av{constructor(){this.durations=[],this.brushInfos=[]}}class Fv{constructor(){this.synthTick=0,this.synthTime=0,this.currentTempo=0,this.automationToSyncPoint=new Map,this.createNewSyncPoints=!1}}class ue{constructor(e,t,i){this._programsPerChannel=new Map,this._currentTime=0,this._calculatedBeatTimers=new Set,this.tickLookup=new Dv,this.applyTranspositionPitches=!0,this.syncPoints=[],this.transpositionPitches=new Map,this._currentTripletFeel=null,this.vibratoResolution=16,this._score=e,this._settings=t||new sr,this._handler=i}generate(){this.transpositionPitches.clear(),this._calculatedBeatTimers.clear(),this._currentTime=0;for(const e of this._score.tracks)this.generateTrack(e);E.debug("Midi","Begin midi generation"),this.syncPoints=[],ue.playThroughSong(this._score,this.syncPoints,!1,(e,t,i,a,n)=>{this.generateMasterBar(e,t,i,a,n)},(e,t,i)=>{for(const a of this._score.tracks)for(const n of a.staves)e<n.bars.length&&this.generateBar(n.bars[e],t,i)},e=>{for(const t of this._score.tracks)this._handler.finishTrack(t.index,e)}),E.debug("Midi","Midi generation done")}generateTrack(e){this.generateChannel(e,e.playbackInfo.primaryChannel,e.playbackInfo),e.playbackInfo.primaryChannel!==e.playbackInfo.secondaryChannel&&this.generateChannel(e,e.playbackInfo.secondaryChannel,e.playbackInfo)}addProgramChange(e,t,i,a){(!this._programsPerChannel.has(i)||this._programsPerChannel.get(i)!==a)&&(this._handler.addProgramChange(e.index,t,i,a),this._programsPerChannel.set(i,a))}static buildTranspositionPitches(e,t){const i=new Map;for(const a of e.tracks){const n=a.index<t.notation.transpositionPitches.length?t.notation.transpositionPitches[a.index]:-a.staves[0].transpositionPitch;i.set(a.playbackInfo.primaryChannel,n),i.set(a.playbackInfo.secondaryChannel,n)}return i}generateChannel(e,t,i){const a=e.index<this._settings.notation.transpositionPitches.length?this._settings.notation.transpositionPitches[e.index]:-e.staves[0].transpositionPitch;this.transpositionPitches.set(t,a);const n=ue.toChannelShort(i.volume),r=ue.toChannelShort(i.balance);this._handler.addControlChange(e.index,0,t,je.VolumeCoarse,n),this._handler.addControlChange(e.index,0,t,je.PanCoarse,r),this._handler.addControlChange(e.index,0,t,je.ExpressionControllerCoarse,127),this._handler.addControlChange(e.index,0,t,je.RegisteredParameterFine,0),this._handler.addControlChange(e.index,0,t,je.RegisteredParameterCourse,0),this._handler.addControlChange(e.index,0,t,je.DataEntryFine,0),this._handler.addControlChange(e.index,0,t,je.DataEntryCoarse,ue.PitchBendRangeInSemitones),this.addProgramChange(e,0,t,i.program)}static generateSyncPoints(e,t=!1){const i=[];return ue.playThroughSong(e,i,t,(a,n,r,o,l)=>{},(a,n,r)=>{},a=>{}),i}static buildModifiedTempoLookup(e){const t=[];return ue.playThroughSong(e,t,!1,(a,n,r,o,l)=>{},(a,n,r)=>{},a=>{}).automationToSyncPoint}static playThroughSong(e,t,i,a,n,r){const o=new vv(e),l=new Fv;l.currentTempo=e.tempo,l.syncPoints=t,l.createNewSyncPoints=i;let h=null;const c=new Map;for(;!o.finished;){const d=o.index,f=e.masterBars[d],p=o.currentTick;if(o.processCurrent(),o.shouldPlay){let g=c.has(d)?c.get(d):-1;g++,c.set(d,g),a(f,h,p,l.currentTempo,g);const m=f.tempoAutomations.length>0?f.tempoAutomations[0].value:l.currentTempo;n(d,p,m),l.synthTick=p,ue.processBarTime(f,g,l)}o.moveNext(),h=f}if(t.length>0){const d=t[t.length-1],f=o.currentTick-d.synthTick;if(f>0){const p=new fl;p.masterBarIndex=h.index,p.masterBarOccurence=c.get(h.index)-1,p.synthTick=o.currentTick,p.synthBpm=l.currentTempo,l.createNewSyncPoints?(p.syncBpm=d.synthBpm,p.synthBpm=d.synthBpm):t.length===1?p.syncBpm=d.synthBpm:p.syncBpm=t[t.length-2].syncBpm,p.synthTime=d.synthTime+v.ticksToMillis(f,d.synthBpm),p.syncTime=d.syncTime+v.ticksToMillis(f,p.syncBpm),l.createNewSyncPoints||d.updateSyncBpm(p.synthTime,p.syncTime),t.push(p)}}return r(o.currentTick),l}static processBarTime(e,t,i){const a=e.calculateDuration(),n=e.syncPoints,r=i.synthTick;i.createNewSyncPoints?ue.processBarTimeWithNewSyncPoints(e,t,i):n?ue.processBarTimeWithSyncPoints(e,t,i):ue.processBarTimeNoSyncPoints(e,i);const o=r+a,l=o-i.synthTick;l>0&&(i.synthTime+=v.ticksToMillis(l,i.currentTempo),i.synthTick=o)}static processBarTimeWithNewSyncPoints(e,t,i){const a=i.synthTick;if(e.index===0&&t===0){i.currentTempo=e.score.tempo;const r=new fl;r.masterBarIndex=e.index,r.masterBarOccurence=t,r.synthTick=a,r.synthBpm=i.currentTempo,r.synthTime=i.synthTime,r.syncBpm=i.currentTempo,r.syncTime=i.synthTime,i.syncPoints.push(r)}const n=e.calculateDuration();for(const r of e.tempoAutomations){const o=a+r.ratioPosition*n,l=o-i.synthTick;if(l>0&&(i.synthTick=o,i.synthTime+=v.ticksToMillis(l,i.currentTempo)),r.value!==i.currentTempo){i.currentTempo=r.value;const h=new fl;h.masterBarIndex=e.index,h.masterBarOccurence=t,h.synthTick=o,h.synthBpm=i.currentTempo,h.synthTime=i.synthTime,h.syncBpm=i.currentTempo,h.syncTime=i.synthTime,i.syncPoints.push(h)}}}static processBarTimeWithSyncPoints(e,t,i){const a=i.synthTick,n=e.calculateDuration();let r=0,o;for(const l of e.syncPoints){if(l.syncPointValue.barOccurence!==t)continue;const h=a+l.ratioPosition*n;for(;r<e.tempoAutomations.length&&e.tempoAutomations[r].ratioPosition<=l.ratioPosition;){const d=e.tempoAutomations[r],f=a+d.ratioPosition*n;o=f-i.synthTick,o>0&&(i.synthTick=f,i.synthTime+=v.ticksToMillis(o,i.currentTempo)),i.currentTempo=d.value,r++}o=h-i.synthTick,o>0&&(i.synthTick=h,i.synthTime+=v.ticksToMillis(o,i.currentTempo)),i.syncPoints.length>0&&i.syncPoints[i.syncPoints.length-1].updateSyncBpm(i.synthTime,l.syncPointValue.millisecondOffset);const c=new fl;c.masterBarIndex=e.index,c.masterBarOccurence=t,c.synthTick=h,c.synthBpm=i.currentTempo,c.synthTime=i.synthTime,c.syncTime=l.syncPointValue.millisecondOffset,c.syncBpm=0,i.syncPoints.push(c),i.automationToSyncPoint.set(l,c)}for(;r<e.tempoAutomations.length;){const l=e.tempoAutomations[r],h=a+l.ratioPosition*n;o=h-i.synthTick,o>0&&(i.synthTick=h,i.synthTime+=v.ticksToMillis(o,i.currentTempo)),i.currentTempo=l.value,r++}}static processBarTimeNoSyncPoints(e,t){const i=t.synthTick,a=e.calculateDuration();for(const n of e.tempoAutomations){const r=i+n.ratioPosition*a,o=r-t.synthTick;o>0&&(t.synthTick=r,t.synthTime+=v.ticksToMillis(o,t.currentTempo)),t.currentTempo=n.value}}static toChannelShort(e){const t=Math.max(-32768,Math.min(32767,e*8-1));return Math.max(t,-1)+1}generateMasterBar(e,t,i,a,n){(!t||t.timeSignatureDenominator!==e.timeSignatureDenominator||t.timeSignatureNumerator!==e.timeSignatureNumerator)&&this._handler.addTimeSignature(i,e.timeSignatureNumerator,e.timeSignatureDenominator);const r=e.calculateDuration(),o=new xk;if(e.tempoAutomations.length>0){e.tempoAutomations[0].ratioPosition>0&&o.tempoChanges.push(new rc(i,a));for(const l of e.tempoAutomations){const h=i+r*l.ratioPosition;this._handler.addTempo(h,l.value),o.tempoChanges.push(new rc(h,l.value))}}else t?o.tempoChanges.push(new rc(i,a)):(this._handler.addTempo(i,e.score.tempo),o.tempoChanges.push(new rc(i,e.score.tempo)));o.masterBar=e,o.start=i,o.end=o.start+r,this.tickLookup.addMasterBar(o)}generateBar(e,t,i){const a=this.getPlaybackBar(e),n=this._currentTime;for(const h of a.voices)this._currentTime=n,this.generateVoice(h,t,e,i);const r=a.masterBar,o=r.calculateDuration(),l=r.tempoAutomations.slice();if(l.length===0)this._currentTime=n+v.ticksToMillis(o,i);else{this._currentTime=n;let h=t,c=i;const d=t+o;for(const p of l){const m=o*p.ratioPosition-h;m>0&&(this._currentTime+=v.ticksToMillis(m,c)),c=p.value,h+=m}const f=d-h;f>0&&(this._currentTime+=v.ticksToMillis(f,c))}a.id!==e.id&&this.tickLookup.addBeat(e.voices[0].beats[0],0,o)}getPlaybackBar(e){switch(e.simileMark){case St.Simple:e.previousBar&&(e=this.getPlaybackBar(e.previousBar));break;case St.FirstOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar));break;case St.SecondOfDouble:e.previousBar&&e.previousBar.previousBar&&(e=this.getPlaybackBar(e.previousBar.previousBar));break}return e}generateVoice(e,t,i,a){if(e.isEmpty&&(!e.bar.isEmpty||e.index!==0))return;const n=i.masterBar.tempoAutomations.slice();let r=a;const o=i.masterBar.calculateDuration();for(const l of e.beats){const h=l.playbackStart/o;for(;n.length>0&&n[0].ratioPosition<=h;)r=n.shift().value;this.generateBeat(l,t,i,r)}}generateBeat(e,t,i,a){let n=e.playbackStart,r=e.playbackDuration;const o=e.voice.bar.masterBar.calculateDuration();e.voice.bar.isEmpty?r=o:e.voice.bar.masterBar.tripletFeel!==me.NoTripletFeel&&this._settings.player.playTripletFeel&&(this._currentTripletFeel?(n-=this._currentTripletFeel.secondBeatStartOffset,r=this._currentTripletFeel.secondBeatDuration,this._currentTripletFeel=null):(this._currentTripletFeel=ue.calculateTripletFeelInfo(n,r,e),this._currentTripletFeel&&(r=this._currentTripletFeel.firstBeatDuration))),e.showTimer&&!this._calculatedBeatTimers.has(e.id)&&(e.timer=this._currentTime,this._calculatedBeatTimers.add(e.id)),this._currentTime+=v.ticksToMillis(r,a),i===e.voice.bar&&this.tickLookup.addBeat(e,n,r);const l=e.voice.bar.staff.track;for(const h of e.automations)this.generateNonTempoAutomation(e,h,t);if(e.isRest)this._handler.addRest(l.index,t+n,l.playbackInfo.primaryChannel);else if(e.deadSlapped)this.generateDeadSlap(e,t+n);else{const h=this.getBrushInfo(e),c=this.getRasgueadoInfo(e,r);for(const d of e.notes)this.generateNote(d,t+n,r,a,h,c)}if(e.fade!==qt.None&&this.generateFade(e,t+n,r),e.vibrato!==ve.None){let h=240,c=3;switch(e.vibrato){case ve.Slight:h=this._settings.player.vibrato.beatSlightLength,c=this._settings.player.vibrato.beatSlightAmplitude;break;case ve.Wide:h=this._settings.player.vibrato.beatWideLength,c=this._settings.player.vibrato.beatWideAmplitude;break}this.generateVibratorWithParams(t+n,e.playbackDuration,h,0,c,(d,f)=>{this._handler.addBend(e.voice.bar.staff.track.index,d,l.playbackInfo.secondaryChannel,f)})}}static calculateTripletFeelInfo(e,t,i){let a;switch(i.voice.bar.masterBar.tripletFeel){case me.Triplet8th:case me.Dotted8th:case me.Scottish8th:a=w.Eighth;break;case me.Triplet16th:case me.Dotted16th:case me.Scottish16th:a=w.Sixteenth;break;default:return null}const n=v.toTicks(a);if(t!==n||e%n!==0||!i.nextBeat||i.nextBeat.voice!==i.voice||i.playbackDuration!==n)return null;const r=new Lv;switch(i.voice.bar.masterBar.tripletFeel){case me.Triplet8th:r.firstBeatDuration=v.applyTuplet(v.toTicks(w.Quarter),3,2),r.secondBeatDuration=v.applyTuplet(v.toTicks(w.Eighth),3,2);break;case me.Dotted8th:r.firstBeatDuration=v.applyDot(v.toTicks(w.Eighth),!1),r.secondBeatDuration=v.toTicks(w.Sixteenth);break;case me.Scottish8th:r.firstBeatDuration=v.toTicks(w.Sixteenth),r.secondBeatDuration=v.applyDot(v.toTicks(w.Eighth),!1);break;case me.Triplet16th:r.firstBeatDuration=v.applyTuplet(v.toTicks(w.Eighth),3,2),r.secondBeatDuration=v.applyTuplet(v.toTicks(w.Sixteenth),3,2);break;case me.Dotted16th:r.firstBeatDuration=v.applyDot(v.toTicks(w.Sixteenth),!1),r.secondBeatDuration=v.toTicks(w.ThirtySecond);break;case me.Scottish16th:r.firstBeatDuration=v.toTicks(w.ThirtySecond),r.secondBeatDuration=v.applyDot(v.toTicks(w.Sixteenth),!1);break}return r.secondBeatStartOffset=t-r.firstBeatDuration,r}generateDeadSlap(e,t){const i=v.toTicks(w.SixtyFourth),a=e.voice.bar.staff;if(a.tuning.length>0)for(const n of a.tuning)this._handler.addNote(a.track.index,t,i,n,v.dynamicToVelocity(j.F),a.track.playbackInfo.primaryChannel)}needsSecondaryChannel(e){return e.hasBend||e.beat.hasWhammyBar||e.beat.vibrato!==ve.None}determineChannel(e,t){if(this.needsSecondaryChannel(t))return e.playbackInfo.secondaryChannel;let i=t;for(;i.isTieDestination;)if(i=i.tieOrigin,this.needsSecondaryChannel(i))return e.playbackInfo.secondaryChannel;for(i=t;i.isTieOrigin;)if(i=i.tieDestination,this.needsSecondaryChannel(i))return e.playbackInfo.secondaryChannel;return e.playbackInfo.primaryChannel}generateNote(e,t,i,a,n,r){const o=e.beat.voice.bar.staff.track,l=e.beat.voice.bar.staff;let h=e.calculateRealValue(this.applyTranspositionPitches,!0);if(e.isPercussion){const S=At.getArticulation(e);S&&(h=S.outputMidiNumber)}const c=r==null&&e.isStringed&&e.string<=n.length?n[e.string-1]:0,d=t+c,f=this.getNoteDuration(e,i,a);f.untilTieOrSlideEnd-=c,f.noteOnly-=c,f.letRingEnd-=c;const p=ue.getNoteVelocity(e),g=this.determineChannel(o,e);let m=0;const T=Math.max(f.untilTieOrSlideEnd,f.letRingEnd);if(e.hasBend?m=ue.getPitchWheel(e.bendPoints[0].value):e.beat.hasWhammyBar?m=ue.getPitchWheel(e.beat.whammyBarPoints[0].value):e.isTieDestination||e.slideOrigin&&e.slideOrigin.slideOutType===pe.Legato?m=-1:m=ue.getPitchWheel(0),m>=0&&this._handler.addNoteBend(o.index,d,g,h,m),e.beat.hasRasgueado){this.generateRasgueado(o,e,d,h,p,g,r);return}if(e.ornament!==Tt.None){this.generateOrnament(o,e,d,T,h,p,g);return}if(e.isTrill&&!l.isPercussion){this.generateTrill(e,d,f,h,p,g);return}if(e.beat.isTremolo){this.generateTremoloPicking(e,d,f,h,p,g);return}e.hasBend?this.generateBend(e,d,f,h,g,a):e.beat.hasWhammyBar&&e.index===0?this.generateWhammy(e.beat,d,f,g,a):e.slideInType!==jt.None||e.slideOutType!==pe.None?this.generateSlide(e,d,f,h,g,a):(e.vibrato!==ve.None||e.isTieDestination&&e.tieOrigin.vibrato!==ve.None)&&this.generateVibrato(e,d,f,h,g),!e.isTieDestination&&(!e.slideOrigin||e.slideOrigin.slideOutType!==pe.Legato)&&this._handler.addNote(o.index,d,T,h,p,g)}generateOrnament(e,t,i,a,n,r,o){let l,h;const c=n%12,d=1/3;switch(t.ornament){case Tt.Turn:l=[n+ue.OrnamentKeysUp[c],n,n+ue.OrnamentKeysDown[c]],h=[v.toTicks(w.Sixteenth)*d,v.toTicks(w.Sixteenth)*d,v.toTicks(w.Sixteenth)*d];break;case Tt.InvertedTurn:l=[n+ue.OrnamentKeysDown[c],n,n+ue.OrnamentKeysUp[c]],h=[v.toTicks(w.Sixteenth)*d,v.toTicks(w.Sixteenth)*d,v.toTicks(w.Sixteenth)*d];break;case Tt.UpperMordent:l=[n,n+ue.OrnamentKeysUp[c]],h=[v.toTicks(w.ThirtySecond),v.toTicks(w.ThirtySecond)];break;case Tt.LowerMordent:l=[n,n+ue.OrnamentKeysDown[c]],h=[v.toTicks(w.ThirtySecond),v.toTicks(w.ThirtySecond)];break;default:return}let f=1;a<v.QuarterTime&&(f=a/v.QuarterTime),r-=v.VelocityIncrement;let p=0;for(let m=0;m<l.length;m++){const T=h[m]*f;this._handler.addNote(e.index,i,T,l[m],r,o),i+=T,p+=T}const g=a-p;this._handler.addNote(e.index,i,g,n,r,o)}getNoteDuration(e,t,i){const a=new Pv;if(a.noteOnly=t,a.untilTieOrSlideEnd=t,a.letRingEnd=t,e.isDead)return a.noteOnly=this.applyStaticDuration(ue.DefaultDurationDead,t,i),a.untilTieOrSlideEnd=a.noteOnly,a.letRingEnd=a.noteOnly,a;if(e.isPalmMute)return a.noteOnly=this.applyStaticDuration(ue.DefaultDurationPalmMute,t,i),a.untilTieOrSlideEnd=a.noteOnly,a.letRingEnd=a.noteOnly,a;if(e.isStaccato)return a.noteOnly=t/2|0,a.untilTieOrSlideEnd=a.noteOnly,a.letRingEnd=a.noteOnly,a;if(e.isTieOrigin){const n=e.tieDestination;if(n)if(e.isTieDestination){const r=this.getNoteDuration(n,n.beat.playbackDuration,i);a.untilTieOrSlideEnd=t+r.untilTieOrSlideEnd}else{const r=e.beat.absolutePlaybackStart,o=this.getNoteDuration(n,n.beat.playbackDuration,i),l=n.beat.absolutePlaybackStart+o.untilTieOrSlideEnd;a.untilTieOrSlideEnd=l-r}}else if(e.slideOutType===pe.Legato){const n=e.slideTarget;if(n){const r=e.beat.absolutePlaybackStart,o=this.getNoteDuration(n,n.beat.playbackDuration,i),l=n.beat.absolutePlaybackStart+o.untilTieOrSlideEnd;a.untilTieOrSlideEnd=l-r}}if(e.isLetRing&&this._settings.notation.notationMode===ai.GuitarPro){let n=e.beat,r=0;const o=e.beat.voice.bar.masterBar.calculateDuration();for(;n.nextBeat;){const l=n.nextBeat;if(l.isRest||e.isStringed&&l.hasNoteOnString(e.string))break;if(n=n.nextBeat,r=n.absolutePlaybackStart-e.beat.absolutePlaybackStart+n.playbackDuration,r>o){r=o;break}}n===e.beat?a.letRingEnd=t:a.letRingEnd=r}else a.letRingEnd=a.untilTieOrSlideEnd;return a}applyStaticDuration(e,t,i){const a=i*e/H.MaxPosition|0;return Math.min(a,t)}static getNoteVelocity(e){let t=0;switch(!e.beat.voice.bar.staff.isPercussion&&e.hammerPullOrigin&&t--,e.isGhost&&t--,e.accentuated){case _t.Normal:t++;break;case _t.Heavy:t+=2;break}return v.dynamicToVelocity(e.dynamics,t)}generateFade(e,t,i){const a=e.voice.bar.staff.track;switch(e.fade){case qt.FadeIn:this.generateFadeSteps(a,t,i,0,ue.toChannelShort(a.playbackInfo.volume));break;case qt.FadeOut:this.generateFadeSteps(a,t,i,ue.toChannelShort(a.playbackInfo.volume),0);break;case qt.VolumeSwell:const n=i/2|0;this.generateFadeSteps(a,t,n,0,ue.toChannelShort(a.playbackInfo.volume)),this.generateFadeSteps(a,t+n,n,ue.toChannelShort(a.playbackInfo.volume),0);break}}generateFadeSteps(e,t,i,a,n){i=i*.8|0;const o=(n-a)/i,l=i/120+1|0,h=t+i;for(let c=0;c<l;c++){const d=c===l-1,f=d?h:t+c*120,p=d?n:Math.round(a+(f-t)*o);this._handler.addControlChange(e.index,f,e.playbackInfo.primaryChannel,je.VolumeCoarse,p),this._handler.addControlChange(e.index,f,e.playbackInfo.secondaryChannel,je.VolumeCoarse,p)}}generateVibrato(e,t,i,a,n){let r=0,o=0;switch(e.vibrato!==ve.None?e.vibrato:e.isTieDestination?e.tieOrigin.vibrato:ve.Slight){case ve.Slight:r=this._settings.player.vibrato.noteSlightLength,o=this._settings.player.vibrato.noteSlightAmplitude;break;case ve.Wide:r=this._settings.player.vibrato.noteWideLength,o=this._settings.player.vibrato.noteWideAmplitude;break;default:return}const h=e.beat.voice.bar.staff.track;let c=0;if(e.isTieDestination&&e.tieOrigin.hasBend){const d=e.tieOrigin.bendPoints;c=d[d.length-1].value}this.generateVibratorWithParams(t,i.noteOnly,r,c,o,(d,f)=>{this._handler.addNoteBend(h.index,d,n,a,f)})}generateVibratorWithParams(e,t,i,a,n,r){const o=this.vibratoResolution,l=i/2|0,h=e+t;for(;e<h;){let c=0;const d=e+i<h?i:h-e;for(;c<d;){const f=a+n*Math.sin(c*Math.PI/l);r(e+c|0,ue.getPitchWheel(f)),c+=o}e+=i}r(h|0,ue.getPitchWheel(a))}static getPitchWheel(e){return te.DefaultPitchWheel+e/2*ue.PitchValuePerSemitone}generateSlide(e,t,i,a,n,r){const o=e.slideOutType===pe.Legato?i.noteOnly:i.untilTieOrSlideEnd,l=[],h=e.beat.voice.bar.staff.track,c=this._settings.player.slide.simpleSlidePitchOffset,d=Math.floor(H.MaxPosition*this._settings.player.slide.simpleSlideDurationRatio),f=Math.floor(H.MaxPosition*this._settings.player.slide.shiftSlideDurationRatio);switch(e.slideInType){case jt.IntoFromAbove:l.push(new H(0,c)),l.push(new H(d,0));break;case jt.IntoFromBelow:l.push(new H(0,-c)),l.push(new H(d,0));break}switch(e.slideOutType){case pe.Legato:case pe.Shift:l.push(new H(f,0));const p=(e.slideTarget.calculateRealValue(this.applyTranspositionPitches,!0)-e.calculateRealValue(this.applyTranspositionPitches,!0))*2;l.push(new H(H.MaxPosition,p));break;case pe.OutDown:l.push(new H(H.MaxPosition-d,0)),l.push(new H(H.MaxPosition,-c));break;case pe.OutUp:l.push(new H(H.MaxPosition-d,0)),l.push(new H(H.MaxPosition,c));break}this.generateWhammyOrBend(t,o,l,r,(p,g)=>{this._handler.addNoteBend(h.index,p,n,a,g)})}generateBend(e,t,i,a,n,r){const o=e.bendPoints,l=e.beat.voice.bar.staff.track,h=(g,m)=>{this._handler.addNoteBend(l.index,g,n,a,m)};let c=null,d;if(e.isTieOrigin&&this._settings.notation.extendBendArrowsOnTiedNotes){let g=e;for(;g.isTieOrigin&&!g.tieDestination.hasBend&&g.tieDestination.vibrato===ve.None;)g=g.tieDestination;d=g.beat.absolutePlaybackStart-e.beat.absolutePlaybackStart+this.getNoteDuration(g,g.beat.playbackDuration,r).noteOnly}else if(e.isTieOrigin&&e.beat.graceType!==se.None){switch(e.tieDestination.bendType){case q.Bend:case q.BendRelease:case q.PrebendBend:c=e.tieDestination.bendPoints[1].value;break;case q.Prebend:case q.PrebendRelease:c=e.tieDestination.bendPoints[0].value;break}d=Math.max(i.noteOnly,v.millisToTicks(this._settings.player.songBookBendDuration,r))}else d=i.noteOnly;o[0].value>0&&!e.isContinuedBend&&t>0&&t--;const f=Math.min(d,v.millisToTicks(this._settings.player.songBookBendDuration,r));let p=[];switch(e.bendType){case q.Custom:p=o;break;case q.Bend:case q.Release:switch(e.bendStyle){case Xe.Default:p=o;break;case Xe.Gradual:p.push(new H(0,e.bendPoints[0].value)),(!c||c<e.bendPoints[1].value)&&(c=e.bendPoints[1].value),p.push(new H(H.MaxPosition,c));break;case Xe.Fast:(!c||c<e.bendPoints[1].value)&&(c=e.bendPoints[1].value),e.beat.graceType===se.BendGrace?this.generateSongBookWhammyOrBend(t,d,!0,[e.bendPoints[0].value,c],f,r,h):this.generateSongBookWhammyOrBend(t,d,!1,[e.bendPoints[0].value,c],f,r,h);return}break;case q.BendRelease:switch(e.bendStyle){case Xe.Default:p=o;break;case Xe.Gradual:p.push(new H(0,e.bendPoints[0].value)),p.push(new H(H.MaxPosition/2|0,e.bendPoints[1].value)),p.push(new H(H.MaxPosition,e.bendPoints[2].value));break;case Xe.Fast:this.generateSongBookWhammyOrBend(t,d,!1,[e.bendPoints[0].value,e.bendPoints[1].value,e.bendPoints[2].value],f,r,h);return}break;case q.Hold:p=o;break;case q.Prebend:p=o;break;case q.PrebendBend:switch(e.bendStyle){case Xe.Default:p=o;break;case Xe.Gradual:p.push(new H(0,e.bendPoints[0].value)),p.push(new H(H.MaxPosition,e.bendPoints[1].value));break;case Xe.Fast:const g=ue.getPitchWheel(e.bendPoints[0].value);h(t,g|0),(!c||c<e.bendPoints[1].value)&&(c=e.bendPoints[1].value),this.generateSongBookWhammyOrBend(t,d,!1,[e.bendPoints[0].value,c],f,r,h);return}break;case q.PrebendRelease:switch(e.bendStyle){case Xe.Default:p=o;break;case Xe.Gradual:p.push(new H(0,e.bendPoints[0].value)),p.push(new H(H.MaxPosition,e.bendPoints[1].value));break;case Xe.Fast:const g=ue.getPitchWheel(e.bendPoints[0].value);h(t,g|0),this.generateSongBookWhammyOrBend(t,d,!1,[e.bendPoints[0].value,e.bendPoints[1].value],f,r,h);return}break}this.generateWhammyOrBend(t,d,p,r,h)}generateSongBookWhammyOrBend(e,t,i,a,n,r,o){const l=i?e:e+t-n,h=n/(a.length-1);for(let c=0;c<a.length-1;c++){const d=ue.getPitchWheel(a[c]),f=ue.getPitchWheel(a[c+1]),p=l+h*c;this.generateBendValues(p,h,d,f,r,o)}}generateWhammy(e,t,i,a,n){const r=e.whammyBarPoints,o=e.voice.bar.staff.track,l=i.noteOnly;r[0].value>0&&!e.isContinuedWhammy&&t--;const h=(d,f)=>{this._handler.addBend(o.index,d,a,f)};let c=[];switch(e.whammyBarType){case De.Custom:c=r;break;case De.Dive:switch(e.whammyStyle){case Xe.Default:c=r;break;case Xe.Gradual:c.push(new H(0,r[0].value)),c.push(new H(H.MaxPosition,r[1].value));break;case Xe.Fast:const d=Math.min(l,v.millisToTicks(this._settings.player.songBookBendDuration,n));this.generateSongBookWhammyOrBend(t,l,!1,[r[0].value,r[1].value],d,n,h);return}break;case De.Dip:switch(e.whammyStyle){case Xe.Default:c=r;break;case Xe.Gradual:c.push(new H(0,r[0].value)),c.push(new H(H.MaxPosition/2|0,r[1].value)),c.push(new H(H.MaxPosition,r[2].value));break;case Xe.Fast:const d=Math.min(l,v.millisToTicks(this._settings.player.songBookDipDuration,n));this.generateSongBookWhammyOrBend(t,l,!0,[r[0].value,r[1].value,r[2].value],d,n,h);return}break;case De.Hold:c=r;break;case De.Predive:c=r;break;case De.PrediveDive:switch(e.whammyStyle){case Xe.Default:c=r;break;case Xe.Gradual:c.push(new H(0,r[0].value)),c.push(new H(H.MaxPosition/2|0,r[0].value)),c.push(new H(H.MaxPosition,r[1].value));break;case Xe.Fast:const d=ue.getPitchWheel(r[0].value);this._handler.addBend(o.index,t,a,d|0);const f=Math.min(l,v.millisToTicks(this._settings.player.songBookBendDuration,n));this.generateSongBookWhammyOrBend(t,l,!1,[r[0].value,r[1].value],f,n,h);return}break}this.generateWhammyOrBend(t,l,c,n,h)}generateWhammyOrBend(e,t,i,a,n){const r=t/H.MaxPosition;for(let o=0;o<i.length-1;o++){const l=i[o],h=i[o+1],c=ue.getPitchWheel(l.value),d=ue.getPitchWheel(h.value),f=r*(h.offset-l.offset),p=e+r*l.offset;this.generateBendValues(p,f,c,d,a,n)}}generateBendValues(e,t,i,a,n,r){const o=v.ticksToMillis(t,n),l=Math.abs(a-i)/ue.PitchValuePerSemitone,h=Math.max(ue.MinBreakpointsPerSemitone*l,o/ue.MillisecondsPerBreakpoint),c=t/h,d=(a-i)/h,f=e+t;for(let p=0;p<h;p++)r(e|0,Math.round(i)),i+=d,e+=c;r(f|0,a)}generateRasgueado(e,t,i,a,n,r,o){let l=i;for(let h=0;h<o.durations.length;h++){const c=o.brushInfos[h],d=t.isStringed&&t.string<=c.length?c[t.string-1]:0,f=o.durations[h];this._handler.addNote(e.index,l+d,f-d,a,n,r),l+=f}}generateTrill(e,t,i,a,n,r){const o=e.beat.voice.bar.staff.track,l=e.stringTuning+e.trillFret;let h=v.toTicks(e.trillSpeed),c=!0,d=t;const f=t+i.untilTieOrSlideEnd;for(;d+10<f;)d+h>=f&&(h=f-d),this._handler.addNote(o.index,d,h,c?l:a,n,r),c=!c,d+=h}generateTremoloPicking(e,t,i,a,n,r){const o=e.beat.voice.bar.staff.track;let l=v.toTicks(e.beat.tremoloSpeed),h=t;const c=t+i.untilTieOrSlideEnd;for(;h+10<c;)h+l>=c&&(l=c-h),this._handler.addNote(o.index,h,l,a,n,r),h+=l}getRasgueadoInfo(e,t){if(!e.hasRasgueado)return null;const i=new Av,n=ue.RasgueadoDurations.get(e.rasgueado).reduce((c,d)=>c+d,0);i.durations=ue.RasgueadoDurations.get(e.rasgueado).map(c=>t*c/n),i.brushInfos=new Array(i.durations.length);const r=v.toTicks(w.Sixteenth);let o=0,l=0;for(const c of e.notes)c.isTieDestination||(o|=1<<c.string-1,l++);const h=ue.RasgueadoDirections.get(e.rasgueado);for(let c=0;c<i.durations.length;c++){const d=i.durations[c]*r/v.QuarterTime,f=new Int32Array(e.voice.bar.staff.tuning.length);i.brushInfos[c]=f;const p=h[c];p!==Y.None&&this.fillBrushInfo(e,f,p===Y.ArpeggioDown||p===Y.BrushDown,o,l,d)}return i}getBrushInfo(e){const t=new Int32Array(e.voice.bar.staff.tuning.length);if(e.brushType){let i=0,a=0;for(const n of e.notes)n.isTieDestination||(i|=1<<n.string-1,a++);this.fillBrushInfo(e,t,e.brushType===Y.ArpeggioDown||e.brushType===Y.BrushDown,i,a,e.brushDuration)}return t}fillBrushInfo(e,t,i,a,n,r){if(e.notes.length>0){let o=0;const l=r/(n-1)|0;for(let h=0;h<e.voice.bar.staff.tuning.length;h++){const c=i?h:t.length-1-h;a&1<<c&&(t[c]=o,o+=l)}}return t}generateNonTempoAutomation(e,t,i){switch(t.type){case tt.Instrument:this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,(t.value|0)&255),this.addProgramChange(e.voice.bar.staff.track,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,(t.value|0)&255);break;case tt.Balance:const a=ue.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,je.PanCoarse,a),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,je.PanCoarse,a);break;case tt.Volume:const n=ue.toChannelShort(t.value);this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.primaryChannel,je.VolumeCoarse,n),this._handler.addControlChange(e.voice.bar.staff.track.index,e.playbackStart+i,e.voice.bar.staff.track.playbackInfo.secondaryChannel,je.VolumeCoarse,n);break}}prepareSingleBeat(e){let t=-1,i=-1,a=e;for(;a&&(t===-1||i===-1);){for(const c of e.automations)switch(c.type){case tt.Instrument:i=c.value;break;case tt.Tempo:t=c.value;break}a=a.previousBeat}const n=e.voice.bar.staff.track,r=e.voice.bar.masterBar;t===-1&&(t=r.score.tempo);const o=e.playbackStart/r.calculateDuration();for(const c of r.tempoAutomations)if(c.ratioPosition<=o)t=c.value;else break;i===-1&&(i=n.playbackInfo.program);const l=n.playbackInfo.volume;this.generateTrack(n),this._handler.addTimeSignature(0,r.timeSignatureNumerator,r.timeSignatureDenominator),this._handler.addTempo(0,t);const h=ue.toChannelShort(l);return this._handler.addControlChange(0,0,n.playbackInfo.primaryChannel,je.VolumeCoarse,h),this._handler.addControlChange(0,0,n.playbackInfo.secondaryChannel,je.VolumeCoarse,h),t}generateSingleBeat(e){const t=this.prepareSingleBeat(e);this.generateBeat(e,-e.playbackStart,e.voice.bar,t)}generateSingleNote(e){const t=this.prepareSingleBeat(e.beat);this.generateNote(e,0,e.beat.playbackDuration,t,new Int32Array(e.beat.voice.bar.staff.tuning.length),null)}}ue.DefaultDurationDead=30;ue.DefaultDurationPalmMute=80;ue.OrnamentKeysUp=[2,2,2,1,1,2,2,2,2,2,1,1];ue.OrnamentKeysDown=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1];ue.PitchBendRangeInSemitones=8*2;ue.PitchValuePerSemitone=te.DefaultPitchWheel/ue.PitchBendRangeInSemitones;ue.MinBreakpointsPerSemitone=6;ue.MillisecondsPerBreakpoint=150;ue.RasgueadoDirections=new Map([[X.Ii,[Y.BrushDown,Y.BrushUp]],[X.Mi,[Y.BrushDown,Y.BrushDown]],[X.MiiTriplet,[Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.MiiAnapaest,[Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.PmpTriplet,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PmpAnapaest,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PeiTriplet,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PeiAnapaest,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PaiTriplet,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.PaiAnapaest,[Y.BrushUp,Y.BrushDown,Y.BrushDown]],[X.AmiTriplet,[Y.BrushDown,Y.BrushDown,Y.BrushDown]],[X.AmiAnapaest,[Y.BrushDown,Y.BrushDown,Y.BrushDown]],[X.Ppp,[Y.None,Y.BrushDown,Y.BrushUp]],[X.Amii,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.Amip,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.Eami,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushDown]],[X.Eamii,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushUp]],[X.Peami,[Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushDown,Y.BrushUp]]]);ue.RasgueadoDurations=new Map([[X.Ii,[v.toTicks(w.Eighth),v.toTicks(w.Eighth)]],[X.Mi,[v.toTicks(w.Eighth),v.toTicks(w.Eighth)]],[X.MiiTriplet,[v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3]],[X.MiiAnapaest,[v.toTicks(w.Sixteenth),v.toTicks(w.Sixteenth),v.toTicks(w.Eighth)]],[X.PmpTriplet,[v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3]],[X.PmpAnapaest,[v.toTicks(w.Sixteenth)/3,v.toTicks(w.Sixteenth)/3,v.toTicks(w.Eighth)/3]],[X.PeiTriplet,[v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3]],[X.PeiAnapaest,[v.toTicks(w.Sixteenth),v.toTicks(w.Sixteenth),v.toTicks(w.Eighth)]],[X.PaiTriplet,[v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3]],[X.PaiAnapaest,[v.toTicks(w.Sixteenth),v.toTicks(w.Sixteenth),v.toTicks(w.Eighth)]],[X.AmiTriplet,[v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3,v.toTicks(w.Eighth)/3]],[X.AmiAnapaest,[v.toTicks(w.Sixteenth)/3,v.toTicks(w.Sixteenth)/3,v.toTicks(w.Eighth)/3]],[X.Ppp,[v.toTicks(w.Sixteenth)/3,v.toTicks(w.Sixteenth)/3,v.toTicks(w.Eighth)/3]],[X.Amii,[v.toTicks(w.Sixteenth)/3,v.toTicks(w.Sixteenth)/3,v.toTicks(w.Sixteenth)/3,v.toTicks(w.Eighth)]],[X.Amip,[v.toTicks(w.Sixteenth)/3,v.toTicks(w.Sixteenth)/3,v.toTicks(w.Sixteenth)/3,v.toTicks(w.Eighth)]],[X.Eami,[v.toTicks(w.Sixteenth),v.toTicks(w.Sixteenth),v.toTicks(w.Sixteenth),v.toTicks(w.Sixteenth)]],[X.Eamii,[v.toTicks(w.Sixteenth)/5,v.toTicks(w.Sixteenth)/5,v.toTicks(w.Sixteenth)/5,v.toTicks(w.Sixteenth)/5,v.toTicks(w.Sixteenth)/5]],[X.Peami,[v.toTicks(w.Sixteenth)/5,v.toTicks(w.Sixteenth)/5,v.toTicks(w.Sixteenth)/5,v.toTicks(w.Sixteenth)/5,v.toTicks(w.Sixteenth)/5]]]);class Mv{constructor(){this.startTick=0,this.endTick=0}}class pt{constructor(e,t){this.width=0,this.height=0,this.x=e,this.y=t}doLayout(){}paint(e,t,i){}}class cs extends pt{constructor(e=0,t=0){super(e,t),this.beat=null,this.nextGlyph=null,this.previousGlyph=null}}class He{}He.Widths=new Map([[u.Brace,3],[u.BracketTop,0],[u.BracketBottom,0],[u.SystemDivider,0],[u.GClef,28],[u.CClef,28],[u.FClef,28],[u.UnpitchedPercussionClef1,15],[u.SixStringTabClef,28],[u.FourStringTabClef,28],[u.TimeSig0,14],[u.TimeSig1,10],[u.TimeSig2,14],[u.TimeSig3,14],[u.TimeSig4,14],[u.TimeSig5,14],[u.TimeSig6,14],[u.TimeSig7,14],[u.TimeSig8,14],[u.TimeSig9,14],[u.TimeSigCommon,14],[u.TimeSigCutCommon,14],[u.NoteheadDoubleWholeSquare,14],[u.NoteheadDoubleWhole,14],[u.NoteheadWhole,14],[u.NoteheadHalf,9],[u.NoteheadBlack,9],[u.NoteheadNull,9],[u.NoteheadXOrnate,9],[u.NoteheadPlusDoubleWhole,16],[u.NoteheadPlusWhole,10],[u.NoteheadPlusHalf,10],[u.NoteheadPlusBlack,10],[u.NoteheadSquareWhite,11],[u.NoteheadSquareBlack,11],[u.NoteheadTriangleUpDoubleWhole,16],[u.NoteheadTriangleUpWhole,11],[u.NoteheadTriangleUpHalf,11],[u.NoteheadTriangleUpBlack,11],[u.NoteheadTriangleRightWhite,11],[u.NoteheadTriangleRightBlack,11],[u.NoteheadTriangleDownDoubleWhole,16],[u.NoteheadTriangleDownWhole,11],[u.NoteheadTriangleDownHalf,11],[u.NoteheadTriangleDownBlack,11],[u.NoteheadDiamondDoubleWhole,16],[u.NoteheadDiamondWhole,9],[u.NoteheadDiamondHalf,9],[u.NoteheadDiamondBlack,9],[u.NoteheadDiamondBlackWide,10],[u.NoteheadDiamondWhite,9],[u.NoteheadDiamondWhiteWide,9],[u.NoteheadCircleXDoubleWhole,16],[u.NoteheadCircleXWhole,9],[u.NoteheadCircleXHalf,9],[u.NoteheadCircleX,9],[u.NoteheadXDoubleWhole,16],[u.NoteheadXWhole,9],[u.NoteheadXHalf,9],[u.NoteheadXBlack,9],[u.NoteheadParenthesis,9],[u.NoteheadSlashedBlack1,9],[u.NoteheadSlashedBlack2,9],[u.NoteheadSlashedHalf1,9],[u.NoteheadSlashedHalf2,9],[u.NoteheadSlashedWhole1,9],[u.NoteheadSlashedWhole2,9],[u.NoteheadSlashedDoubleWhole1,16],[u.NoteheadSlashedDoubleWhole2,16],[u.NoteheadCircledBlack,9],[u.NoteheadCircledHalf,9],[u.NoteheadCircledWhole,9],[u.NoteheadCircledDoubleWhole,16],[u.NoteheadCircleSlash,9],[u.NoteheadHeavyX,13],[u.NoteheadHeavyXHat,13],[u.NoteheadSlashVerticalEnds,12],[u.NoteheadSlashWhiteWhole,32],[u.NoteheadSlashWhiteHalf,25],[u.NoteheadRoundWhiteWithDot,9],[u.NoteheadSquareBlackLarge,9],[u.NoteheadSquareBlackWhite,9],[u.NoteheadClusterDoubleWhole3rd,16],[u.NoteheadClusterWhole3rd,12],[u.NoteheadClusterHalf3rd,12],[u.NoteheadClusterQuarter3rd,12],[u.NoteShapeRoundWhite,9],[u.NoteShapeRoundBlack,9],[u.NoteShapeSquareWhite,12],[u.NoteShapeSquareBlack,12],[u.NoteShapeTriangleRightWhite,12],[u.NoteShapeTriangleRightBlack,12],[u.NoteShapeTriangleLeftWhite,12],[u.NoteShapeTriangleLeftBlack,12],[u.NoteShapeDiamondWhite,9],[u.NoteShapeDiamondBlack,9],[u.NoteShapeTriangleUpWhite,12],[u.NoteShapeTriangleUpBlack,12],[u.NoteShapeMoonWhite,12],[u.NoteShapeMoonBlack,12],[u.NoteShapeTriangleRoundWhite,12],[u.NoteShapeTriangleRoundBlack,12],[u.NoteQuarterUp,10],[u.NoteEighthUp,10],[u.TextBlackNoteLongStem,0],[u.TextBlackNoteFrac8thLongStem,0],[u.TextBlackNoteFrac16thLongStem,0],[u.TextBlackNoteFrac32ndLongStem,0],[u.TextCont8thBeamLongStem,0],[u.TextCont16thBeamLongStem,0],[u.TextCont32ndBeamLongStem,0],[u.TextAugmentationDot,0],[u.TextTupletBracketStartLongStem,0],[u.TextTuplet3LongStem,0],[u.TextTupletBracketEndLongStem,0],[u.Tremolo3,12],[u.Tremolo2,12],[u.Tremolo1,12],[u.FlagEighthUp,0],[u.FlagEighthDown,0],[u.FlagSixteenthUp,0],[u.FlagSixteenthDown,0],[u.FlagThirtySecondUp,0],[u.FlagThirtySecondDown,0],[u.FlagSixtyFourthUp,0],[u.FlagSixtyFourthDown,0],[u.FlagOneHundredTwentyEighthUp,0],[u.FlagOneHundredTwentyEighthDown,0],[u.FlagTwoHundredFiftySixthUp,0],[u.FlagTwoHundredFiftySixthDown,0],[u.AccidentalFlat,8],[u.AccidentalNatural,8],[u.AccidentalSharp,8],[u.AccidentalDoubleSharp,8],[u.AccidentalDoubleFlat,18],[u.AccidentalQuarterToneFlatArrowUp,8],[u.AccidentalQuarterToneSharpArrowUp,8],[u.AccidentalQuarterToneNaturalArrowUp,8],[u.Segno,0],[u.Coda,0],[u.ArticAccentAbove,9],[u.ArticAccentBelow,9],[u.ArticStaccatoAbove,9],[u.ArticStaccatoBelow,9],[u.ArticTenutoAbove,9],[u.ArticTenutoBelow,9],[u.ArticMarcatoAbove,9],[u.ArticMarcatoBelow,9],[u.FermataAbove,23],[u.FermataShortAbove,23],[u.FermataLongAbove,23],[u.RestLonga,9],[u.RestDoubleWhole,9],[u.RestWhole,9],[u.RestHalf,9],[u.RestQuarter,9],[u.RestEighth,9],[u.RestSixteenth,9],[u.RestThirtySecond,12],[u.RestSixtyFourth,14],[u.RestOneHundredTwentyEighth,14],[u.RestTwoHundredFiftySixth,14],[u.RestHBarLeft,0],[u.RestHBarMiddle,0],[u.RestHBarRight,0],[u.Repeat1Bar,0],[u.Repeat2Bars,0],[u.Ottava,0],[u.OttavaAlta,32],[u.OttavaBassaVb,29],[u.Quindicesima,23],[u.QuindicesimaAlta,46],[u.DynamicPPPPPP,0],[u.DynamicPPPPP,0],[u.DynamicPPPP,0],[u.DynamicPPP,0],[u.DynamicPP,0],[u.DynamicPiano,0],[u.DynamicMP,0],[u.DynamicMF,0],[u.DynamicPF,0],[u.DynamicForte,0],[u.DynamicFF,0],[u.DynamicFFF,0],[u.DynamicFFFF,0],[u.DynamicFFFFF,0],[u.DynamicFFFFFF,0],[u.DynamicFortePiano,0],[u.DynamicNiente,0],[u.DynamicSforzando1,0],[u.DynamicSforzandoPiano,0],[u.DynamicSforzandoPianissimo,0],[u.DynamicSforzato,0],[u.DynamicSforzatoPiano,0],[u.DynamicSforzatoFF,0],[u.DynamicRinforzando1,0],[u.DynamicRinforzando2,0],[u.DynamicForzando,0],[u.OrnamentTrill,20],[u.OrnamentTurn,26],[u.OrnamentTurnInverted,26],[u.OrnamentShortTrill,0],[u.OrnamentMordent,26],[u.StringsDownBow,9],[u.StringsUpBow,9],[u.KeyboardPedalPed,35],[u.KeyboardPedalUp,16],[u.PictEdgeOfCymbal,44],[u.GuitarString0,20],[u.GuitarString1,20],[u.GuitarString2,20],[u.GuitarString3,20],[u.GuitarString4,20],[u.GuitarString5,20],[u.GuitarString6,20],[u.GuitarString7,20],[u.GuitarString8,20],[u.GuitarString9,20],[u.GuitarOpenPedal,11],[u.GuitarClosePedal,11],[u.GuitarGolpe,13.4],[u.GuitarFadeIn,13],[u.GuitarFadeOut,13],[u.GuitarVolumeSwell,26],[u.FretboardX,0],[u.FretboardO,0],[u.WiggleTrill,9],[u.WiggleVibratoMediumFast,10],[u.OctaveBaselineM,13],[u.OctaveBaselineB,9]]);He.Heights=new Map([[u.Brace,34],[u.BracketTop,0],[u.BracketBottom,0],[u.SystemDivider,0],[u.GClef,0],[u.CClef,0],[u.FClef,0],[u.UnpitchedPercussionClef1,0],[u.SixStringTabClef,0],[u.FourStringTabClef,0],[u.TimeSig0,0],[u.TimeSig1,0],[u.TimeSig2,0],[u.TimeSig3,0],[u.TimeSig4,0],[u.TimeSig5,0],[u.TimeSig6,0],[u.TimeSig7,0],[u.TimeSig8,0],[u.TimeSig9,0],[u.TimeSigCommon,0],[u.TimeSigCutCommon,0],[u.NoteheadDoubleWholeSquare,8],[u.NoteheadDoubleWhole,8],[u.NoteheadWhole,8],[u.NoteheadHalf,8],[u.NoteheadBlack,8],[u.NoteheadNull,8],[u.NoteheadXOrnate,8],[u.NoteheadPlusDoubleWhole,8],[u.NoteheadPlusWhole,8],[u.NoteheadPlusHalf,8],[u.NoteheadPlusBlack,8],[u.NoteheadSquareWhite,8],[u.NoteheadSquareBlack,8],[u.NoteheadTriangleUpDoubleWhole,8],[u.NoteheadTriangleUpWhole,8],[u.NoteheadTriangleUpHalf,8],[u.NoteheadTriangleUpBlack,8],[u.NoteheadTriangleRightWhite,8],[u.NoteheadTriangleRightBlack,8],[u.NoteheadTriangleDownDoubleWhole,8],[u.NoteheadTriangleDownWhole,8],[u.NoteheadTriangleDownHalf,8],[u.NoteheadTriangleDownBlack,8],[u.NoteheadDiamondDoubleWhole,8],[u.NoteheadDiamondWhole,8],[u.NoteheadDiamondHalf,8],[u.NoteheadDiamondBlack,8],[u.NoteheadDiamondBlackWide,9],[u.NoteheadDiamondWhite,9],[u.NoteheadDiamondWhiteWide,9],[u.NoteheadCircleXDoubleWhole,8],[u.NoteheadCircleXWhole,8],[u.NoteheadCircleXHalf,8],[u.NoteheadCircleX,8],[u.NoteheadXDoubleWhole,8],[u.NoteheadXWhole,8],[u.NoteheadXHalf,8],[u.NoteheadXBlack,8],[u.NoteheadParenthesis,8],[u.NoteheadSlashedBlack1,8],[u.NoteheadSlashedBlack2,8],[u.NoteheadSlashedHalf1,8],[u.NoteheadSlashedHalf2,8],[u.NoteheadSlashedWhole1,8],[u.NoteheadSlashedWhole2,8],[u.NoteheadSlashedDoubleWhole1,8],[u.NoteheadSlashedDoubleWhole2,8],[u.NoteheadCircledBlack,8],[u.NoteheadCircledHalf,8],[u.NoteheadCircledWhole,8],[u.NoteheadCircledDoubleWhole,8],[u.NoteheadCircleSlash,8],[u.NoteheadHeavyX,8],[u.NoteheadHeavyXHat,8],[u.NoteheadSlashVerticalEnds,17],[u.NoteheadSlashWhiteWhole,17],[u.NoteheadSlashWhiteHalf,17],[u.NoteheadRoundWhiteWithDot,8],[u.NoteheadSquareBlackLarge,8],[u.NoteheadSquareBlackWhite,8],[u.NoteheadClusterDoubleWhole3rd,8],[u.NoteheadClusterWhole3rd,8],[u.NoteheadClusterHalf3rd,8],[u.NoteheadClusterQuarter3rd,8],[u.NoteShapeRoundWhite,8],[u.NoteShapeRoundBlack,8],[u.NoteShapeSquareWhite,8],[u.NoteShapeSquareBlack,8],[u.NoteShapeTriangleRightWhite,8],[u.NoteShapeTriangleRightBlack,8],[u.NoteShapeTriangleLeftWhite,8],[u.NoteShapeTriangleLeftBlack,8],[u.NoteShapeDiamondWhite,8],[u.NoteShapeDiamondBlack,8],[u.NoteShapeTriangleUpWhite,8],[u.NoteShapeTriangleUpBlack,8],[u.NoteShapeMoonWhite,8],[u.NoteShapeMoonBlack,8],[u.NoteShapeTriangleRoundWhite,8],[u.NoteShapeTriangleRoundBlack,8],[u.NoteQuarterUp,8],[u.NoteEighthUp,8],[u.TextBlackNoteLongStem,0],[u.TextBlackNoteFrac8thLongStem,0],[u.TextBlackNoteFrac16thLongStem,0],[u.TextBlackNoteFrac32ndLongStem,0],[u.TextCont8thBeamLongStem,0],[u.TextCont16thBeamLongStem,0],[u.TextCont32ndBeamLongStem,0],[u.TextAugmentationDot,0],[u.TextTupletBracketStartLongStem,0],[u.TextTuplet3LongStem,0],[u.TextTupletBracketEndLongStem,0],[u.Tremolo3,0],[u.Tremolo2,0],[u.Tremolo1,0],[u.FlagEighthUp,0],[u.FlagEighthDown,0],[u.FlagSixteenthUp,0],[u.FlagSixteenthDown,0],[u.FlagThirtySecondUp,0],[u.FlagThirtySecondDown,0],[u.FlagSixtyFourthUp,0],[u.FlagSixtyFourthDown,0],[u.FlagOneHundredTwentyEighthUp,0],[u.FlagOneHundredTwentyEighthDown,0],[u.FlagTwoHundredFiftySixthUp,0],[u.FlagTwoHundredFiftySixthDown,0],[u.AccidentalFlat,0],[u.AccidentalNatural,0],[u.AccidentalSharp,0],[u.AccidentalDoubleSharp,0],[u.AccidentalDoubleFlat,0],[u.AccidentalQuarterToneFlatArrowUp,0],[u.AccidentalQuarterToneSharpArrowUp,0],[u.AccidentalQuarterToneNaturalArrowUp,0],[u.Segno,0],[u.Coda,0],[u.ArticAccentAbove,9],[u.ArticAccentBelow,9],[u.ArticStaccatoAbove,9],[u.ArticStaccatoBelow,9],[u.ArticTenutoAbove,9],[u.ArticTenutoBelow,9],[u.ArticMarcatoAbove,9],[u.ArticMarcatoBelow,9],[u.FermataAbove,12],[u.FermataShortAbove,12],[u.FermataLongAbove,12],[u.RestLonga,0],[u.RestDoubleWhole,0],[u.RestWhole,0],[u.RestHalf,0],[u.RestQuarter,0],[u.RestEighth,0],[u.RestSixteenth,0],[u.RestThirtySecond,0],[u.RestSixtyFourth,0],[u.RestOneHundredTwentyEighth,0],[u.RestTwoHundredFiftySixth,0],[u.RestHBarLeft,0],[u.RestHBarMiddle,0],[u.RestHBarRight,0],[u.Repeat1Bar,0],[u.Repeat2Bars,0],[u.Ottava,13],[u.OttavaAlta,13],[u.OttavaBassaVb,13],[u.Quindicesima,13],[u.QuindicesimaAlta,13],[u.DynamicPPPPPP,28.4],[u.DynamicPPPPP,28.4],[u.DynamicPPPP,28.4],[u.DynamicPPP,28.4],[u.DynamicPP,28.4],[u.DynamicPiano,28.4],[u.DynamicMP,28.4],[u.DynamicMF,28.4],[u.DynamicPF,28.4],[u.DynamicForte,28.4],[u.DynamicFF,28.4],[u.DynamicFFF,28.4],[u.DynamicFFFF,28.4],[u.DynamicFFFFF,28.4],[u.DynamicFFFFFF,28.4],[u.DynamicFortePiano,28.4],[u.DynamicNiente,28.4],[u.DynamicSforzando1,28.4],[u.DynamicSforzandoPiano,28.4],[u.DynamicSforzandoPianissimo,28.4],[u.DynamicSforzato,28.4],[u.DynamicSforzatoPiano,28.4],[u.DynamicSforzatoFF,28.4],[u.DynamicRinforzando1,28.4],[u.DynamicRinforzando2,28.4],[u.DynamicForzando,28.4],[u.OrnamentTrill,24],[u.OrnamentTurn,18],[u.OrnamentTurnInverted,18],[u.OrnamentShortTrill,18],[u.OrnamentMordent,18],[u.StringsDownBow,13/.75],[u.StringsUpBow,13/.75],[u.KeyboardPedalPed,19],[u.KeyboardPedalUp,16],[u.PictEdgeOfCymbal,30],[u.GuitarString0,20],[u.GuitarString1,20],[u.GuitarString2,20],[u.GuitarString3,20],[u.GuitarString4,20],[u.GuitarString5,20],[u.GuitarString6,20],[u.GuitarString7,20],[u.GuitarString8,20],[u.GuitarString9,20],[u.GuitarOpenPedal,11],[u.GuitarClosePedal,11],[u.GuitarGolpe,13.4],[u.GuitarFadeIn,13],[u.GuitarFadeOut,13],[u.GuitarVolumeSwell,13],[u.FretboardX,0],[u.FretboardO,0],[u.WiggleTrill,6],[u.WiggleVibratoMediumFast,10],[u.OctaveBaselineM,0],[u.OctaveBaselineB,0]]);class Mt extends cs{constructor(e,t,i,a){super(e,t),this.glyphScale=0,this.center=!1,this.glyphScale=i,this.symbol=a}doLayout(){this.width=He.Widths.has(this.symbol)?He.Widths.get(this.symbol)*this.glyphScale:0,this.height=He.Heights.has(this.symbol)?He.Heights.get(this.symbol)*this.glyphScale:0}paint(e,t,i){const a=i.color;this.colorOverride&&(i.color=this.colorOverride),i.fillMusicFontSymbol(e+this.x,t+this.y,this.glyphScale,this.symbol,this.center),i.color=a}}class Ye extends Mt{constructor(e,t,i,a){super(e,t,a?Ye.GraceScale:1,Ye.getSymbol(i)),this.centerOnStem=!1,this._isGrace=a}paint(e,t,i){const a=this._isGrace?1:0;this.centerOnStem&&(this.center=!0),super.paint(e,t+a,i)}static getSymbol(e){switch(e){case w.QuadrupleWhole:return u.NoteheadDoubleWholeSquare;case w.DoubleWhole:return u.NoteheadDoubleWhole;case w.Whole:return u.NoteheadWhole;case w.Half:return u.NoteheadHalf;default:return u.NoteheadBlack}}}Ye.GraceScale=.75;class Cr extends Mt{constructor(e,t,i,a,n){super(e,t,n?Ye.GraceScale:1,Cr.getSymbol(i,a,n))}static getSymbol(e,t,i){if(i&&(e=w.Eighth),t===P.Up)switch(e){case w.Eighth:return u.FlagEighthUp;case w.Sixteenth:return u.FlagSixteenthUp;case w.ThirtySecond:return u.FlagThirtySecondUp;case w.SixtyFourth:return u.FlagSixtyFourthUp;case w.OneHundredTwentyEighth:return u.FlagOneHundredTwentyEighthUp;case w.TwoHundredFiftySixth:return u.FlagTwoHundredFiftySixthUp;default:return u.FlagEighthUp}switch(e){case w.Eighth:return u.FlagEighthDown;case w.Sixteenth:return u.FlagSixteenthDown;case w.ThirtySecond:return u.FlagThirtySecondDown;case w.SixtyFourth:return u.FlagSixtyFourthDown;case w.OneHundredTwentyEighth:return u.FlagOneHundredTwentyEighthDown;case w.TwoHundredFiftySixth:return u.FlagOneHundredTwentyEighthDown;default:return u.FlagEighthDown}}}Cr.FlagWidth=11;class rs extends pt{get onTimeX(){return this.onNotes.x+this.onNotes.centerX}constructor(e,t){super(0,0),this.ties=[],this.minWidth=0,this.beat=e,this.ties=[],this.voiceContainer=t}addTie(e){e.renderer=this.renderer,this.ties.push(e)}drawBeamHelperAsFlags(e){return e.hasFlag(!1,void 0)}registerLayoutingInfo(e){const t=this.preNotes.computedWidth+this.onNotes.centerX;let i=this.onNotes.computedWidth-this.onNotes.centerX;const a=this.renderer.helpers.getBeamingHelperForBeat(this.beat);this.beat.graceType!==se.None?this.beat.graceGroup.beats.length===1?i+=Cr.FlagWidth*Ye.GraceScale:this.beat.graceIndex<this.beat.graceGroup.beats.length-1?i+=7:i+=rs.GraceBeatPadding:a&&this.drawBeamHelperAsFlags(a)&&(i+=Cr.FlagWidth);for(const n of this.ties)i+=n.width;e.addBeatSpring(this.beat,t,i)}applyLayoutingInfo(e){this.onNotes.updateBeamingHelper(),this.updateWidth()}doLayout(){this.preNotes.x=0,this.preNotes.renderer=this.renderer,this.preNotes.container=this,this.preNotes.doLayout(),this.onNotes.x=this.preNotes.x+this.preNotes.width,this.onNotes.renderer=this.renderer,this.onNotes.container=this,this.onNotes.doLayout();let e=this.beat.notes.length-1;for(;e>=0;)this.createTies(this.beat.notes[e--]);this.renderer.registerTies(this.ties),this.updateWidth()}updateWidth(){if(this.minWidth=this.preNotes.width+this.onNotes.width,!this.beat.isRest)if(this.onNotes.beamingHelper.beats.length===1)this.beat.duration>=w.Eighth&&(this.minWidth+=20);else switch(this.beat.duration){case w.OneHundredTwentyEighth:case w.TwoHundredFiftySixth:this.minWidth+=10;break}let e=0;for(const t of this.ties)t.width>e&&(e=t.width);this.minWidth+=e,this.width=this.minWidth}scaleToWidth(e){this.onNotes.updateBeamingHelper(),this.width=e}createTies(e){}static getGroupId(e){return`b${e.id}`}paint(e,t,i){if(this.preNotes.isEmpty&&this.onNotes.isEmpty&&this.ties.length===0)return;i.beginGroup(rs.getGroupId(this.beat)),this.preNotes.paint(e+this.x,t+this.y,i),this.onNotes.paint(e+this.x,t+this.y,i);const n=e-this.voiceContainer.x-this.renderer.x,r=t-this.voiceContainer.y-this.renderer.y;for(let o=0,l=this.ties.length;o<l;o++){const h=this.ties[o];h.renderer=this.renderer,h.paint(n,r,i)}i.endGroup()}buildBoundingsLookup(e,t,i,a){const n=new Bk;if(n.beat=this.beat,this.beat.isEmpty)n.visualBounds=new hi,n.visualBounds.x=t+this.x,n.visualBounds.y=e.visualBounds.y,n.visualBounds.w=this.width,n.visualBounds.h=e.visualBounds.h,n.realBounds=new hi,n.realBounds.x=t+this.x,n.realBounds.y=e.realBounds.y,n.realBounds.w=this.width,n.realBounds.h=e.realBounds.h,n.onNotesX=t+this.x+this.onNotes.centerX;else{n.visualBounds=new hi,n.visualBounds.x=t+this.x,this.preNotes.isEmpty?this.onNotes.isEmpty?n.visualBounds.x=t+this.x:n.visualBounds.x=t+this.x+this.onNotes.x:n.visualBounds.x=t+this.x+this.preNotes.x;let r=0;this.onNotes.isEmpty?this.preNotes.isEmpty?r=t+this.x+this.width:r=t+this.x+this.preNotes.x+this.preNotes.width:r=t+this.x+this.onNotes.x+this.onNotes.width,n.visualBounds.w=r-n.visualBounds.x;const o=this.renderer.helpers.getBeamingHelperForBeat(this.beat);(o&&this.drawBeamHelperAsFlags(o)||this.beat.graceType!==se.None)&&(n.visualBounds.w+=Cr.FlagWidth*(this.beat.graceType!==se.None?Ye.GraceScale:1)),n.visualBounds.y=e.visualBounds.y,n.visualBounds.h=e.visualBounds.h,n.realBounds=new hi,n.realBounds.x=t+this.x,n.realBounds.y=e.realBounds.y,n.realBounds.w=this.width,n.realBounds.h=e.realBounds.h,n.onNotesX=t+this.x+this.onNotes.x+this.onNotes.centerX}e.addBeat(n),this.renderer.settings.core.includeNoteBounds&&this.onNotes.buildBoundingsLookup(n,t+this.x,i+this.y)}}rs.GraceBeatPadding=3;class Hy{constructor(){this.oldWidth=0,this.newWidth=0,this.settings=null}core(){return this.settings&&this.causeIssue()?this.settings.core:new Jg}causeIssue(){return this.settings=null,!0}}class Vy{constructor(e){this.activeBeats=e}}class Rv{constructor(){this._midiEventQueue=new Fg,this.masterVolume=1,this.metronomeVolume=0,this.outSampleRate=44100,this.currentTempo=120,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.activeVoiceCount=0}noteOffAll(e){}resetSoft(){}resetPresets(){}loadPresets(e,t,i,a){}setupMetronomeChannel(e){}synthesizeSilent(e){this.fakeSynthesize()}processMidiMessage(e){}dispatchEvent(e){this._midiEventQueue.enqueue(e)}synthesize(e,t,i){return this.fakeSynthesize()}fakeSynthesize(){const e=[];for(;!this._midiEventQueue.isEmpty;){const t=this._midiEventQueue.dequeue();t.isMetronome&&this.metronomeVolume>0||t.event&&this.processMidiMessage(t.event),e.push(t)}return e}applyTranspositionPitches(e){}setChannelTranspositionPitch(e,t){}channelSetMute(e,t){}channelSetSolo(e,t){}resetChannelStates(){}channelSetMixVolume(e,t){}hasSamplesForProgram(e){return!0}hasSamplesForPercussion(e){return!0}}class vk extends kk{constructor(e,t){super(e,new Rv,t),this.synthesizer.output=e,this._backingTrackOutput=e,e.timeUpdate.on(i=>{const a=this.sequencer.mainTimePositionFromBackingTrack(i,e.backingTrackDuration);this.sequencer.fillMidiEventQueueToEndTime(a),this.synthesizer.fakeSynthesize(),this.updateTimePosition(a,!1),this.checkForFinish()})}updateMasterVolume(e){super.updateMasterVolume(e),this._backingTrackOutput.masterVolume=e}updatePlaybackSpeed(e){super.updatePlaybackSpeed(e),this._backingTrackOutput.playbackRate=e}onSampleRequest(){}loadMidiFile(e){this.isSoundFontLoaded||(this.isSoundFontLoaded=!0,this.soundFontLoaded.trigger()),super.loadMidiFile(e)}updateTimePosition(e,t){super.updateTimePosition(e,t),t&&this._backingTrackOutput.seekTo(this.sequencer.mainTimePositionToBackingTrack(e,this._backingTrackOutput.backingTrackDuration))}loadBackingTrack(e){const t=e.backingTrack;t&&(this._backingTrackOutput.loadBackingTrack(t),this.timePosition=0)}updateSyncPoints(e){this.sequencer.mainUpdateSyncPoints(e),this.tickPosition=this.tickPosition}}class Ov{constructor(){this.sampleRate=44100,this._seekPosition=0,this.ready=new Bt,this.samplesPlayed=new we,this.timeUpdate=new we,this.sampleRequest=new Bt}get handler(){return this._handler}set handler(e){e&&this._seekPosition!==0&&(e.seekTo(this._seekPosition),this._seekPosition=0),this._handler=e}get backingTrackDuration(){var e;return((e=this.handler)==null?void 0:e.backingTrackDuration)??0}get playbackRate(){var e;return((e=this.handler)==null?void 0:e.playbackRate)??1}set playbackRate(e){const t=this.handler;t&&(t.playbackRate=e)}get masterVolume(){var e;return((e=this.handler)==null?void 0:e.masterVolume)??1}set masterVolume(e){const t=this.handler;t&&(t.masterVolume=e)}seekTo(e){const t=this.handler;t?t.seekTo(e):this._seekPosition=e}loadBackingTrack(e){}open(e){this.ready.trigger()}updatePosition(e){this.timeUpdate.trigger(e)}play(){var e;(e=this.handler)==null||e.play()}destroy(){}pause(){var e;(e=this.handler)==null||e.pause()}addSamples(e){}resetSamples(){}activate(){}async enumerateOutputDevices(){return[]}async setOutputDevice(e){}async getOutputDevice(){return null}}class Iv extends vk{get handler(){return this.output.handler}set handler(e){this.output.handler=e}constructor(e){super(new Ov,e)}}class Hv{constructor(){this._masterVolume=1,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=1,this._isLooping=!1,this._midiEventsPlayedFilter=[],this.finished=new Bt,this.soundFontLoaded=new Bt,this.soundFontLoadFailed=new we,this.midiLoadFailed=new we,this.midiEventsPlayed=new we,this.ready=new Bt(()=>this.isReady),this.readyForPlayback=new Bt(()=>this.isReadyForPlayback),this.midiLoaded=new we(()=>{var e;return((e=this._instance)==null?void 0:e.loadedMidiInfo)??null}),this.stateChanged=new we(()=>new co(this.state,!1)),this.positionChanged=new we(()=>this.currentPosition),this.playbackRangeChanged=new we(()=>{const e=this.playbackRange;return e?new su(e):null})}get instance(){return this._instance}set instance(e){this._instance=e;const t=this._instanceEventUnregister;if(t)for(const i of t)i();if(e){const i=[];i.push(e.ready.on(()=>this.ready.trigger())),i.push(e.readyForPlayback.on(()=>this.readyForPlayback.trigger())),i.push(e.finished.on(()=>this.finished.trigger())),i.push(e.soundFontLoaded.on(()=>this.soundFontLoaded.trigger())),i.push(e.soundFontLoadFailed.on(a=>this.soundFontLoadFailed.trigger(a))),i.push(e.midiLoaded.on(a=>{this.midiLoaded.trigger(a)})),i.push(e.midiLoadFailed.on(a=>this.midiLoadFailed.trigger(a))),i.push(e.stateChanged.on(a=>this.stateChanged.trigger(a))),i.push(e.positionChanged.on(a=>{this.positionChanged.trigger(a)})),i.push(e.midiEventsPlayed.on(a=>this.midiEventsPlayed.trigger(a))),i.push(e.playbackRangeChanged.on(a=>this.playbackRangeChanged.trigger(a))),this._instanceEventUnregister=i,this.isReady?(e.masterVolume=this._masterVolume,e.metronomeVolume=this._metronomeVolume,e.countInVolume=this._countInVolume,e.playbackSpeed=this._playbackSpeed,e.isLooping=this._isLooping,e.midiEventsPlayedFilter=this._midiEventsPlayedFilter,this.ready.trigger()):i.push(e.ready.on(()=>{e.masterVolume=this._masterVolume,e.metronomeVolume=this._metronomeVolume,e.countInVolume=this._countInVolume,e.playbackSpeed=this._playbackSpeed,e.isLooping=this._isLooping,e.midiEventsPlayedFilter=this._midiEventsPlayedFilter}))}else this._instanceEventUnregister=void 0}get output(){return this._instance.output}get isReady(){return this._instance?this._instance.isReady:!1}get isReadyForPlayback(){return this._instance?this._instance.isReadyForPlayback:!1}get state(){return this._instance?this._instance.state:ii.Paused}get logLevel(){return E.logLevel}set logLevel(e){E.logLevel=e,this._instance&&(this._instance.logLevel=e)}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,te.MinVolume),this._masterVolume=e,this._instance&&(this._instance.masterVolume=e)}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,te.MinVolume),this._metronomeVolume=e,this._instance&&(this._instance.metronomeVolume=e)}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){this._playbackSpeed=e,this._instance&&(this._instance.playbackSpeed=e)}get loadedMidiInfo(){return this._instance?this._instance.loadedMidiInfo:void 0}get currentPosition(){return this._instance?this._instance.currentPosition:new Ya(0,0,0,0,!1,120,120)}get tickPosition(){return this._instance?this._instance.tickPosition:0}set tickPosition(e){this._instance&&(this._instance.tickPosition=e)}get timePosition(){return this._instance?this._instance.timePosition:0}set timePosition(e){this._instance&&(this._instance.timePosition=e)}get playbackRange(){return this._instance?this._instance.playbackRange:null}set playbackRange(e){this._instance&&(this._instance.playbackRange=e)}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._instance&&(this._instance.isLooping=e)}get countInVolume(){return this._countInVolume}set countInVolume(e){this._countInVolume=e,this._instance&&(this._instance.countInVolume=e)}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._instance&&(this._instance.midiEventsPlayedFilter=e)}destroy(){this._instance&&(this._instance.destroy(),this._instance=void 0)}play(){return this._instance?this._instance.play():!1}pause(){this._instance&&this._instance.pause()}playPause(){this._instance&&this._instance.playPause()}stop(){this._instance&&this._instance.stop()}playOneTimeMidiFile(e){this._instance&&this._instance.playOneTimeMidiFile(e)}loadSoundFont(e,t){this._instance&&this._instance.loadSoundFont(e,t)}resetSoundFonts(){this._instance&&this._instance.resetSoundFonts()}loadMidiFile(e){this._instance&&this._instance.loadMidiFile(e)}loadBackingTrack(e){this._instance&&this._instance.loadBackingTrack(e)}updateSyncPoints(e){this._instance&&this._instance.updateSyncPoints(e)}applyTranspositionPitches(e){this._instance&&this._instance.applyTranspositionPitches(e)}setChannelTranspositionPitch(e,t){this._instance&&this._instance.setChannelTranspositionPitch(e,t)}setChannelMute(e,t){this._instance&&this._instance.setChannelMute(e,t)}resetChannelStates(){this._instance&&this._instance.resetChannelStates()}setChannelSolo(e,t){this._instance&&this._instance.setChannelSolo(e,t)}setChannelVolume(e,t){this._instance&&this._instance.setChannelVolume(e,t)}}class Vv{constructor(){this._width=0,this._score=null,this._trackIndexes=null,this.preRender=new we,this.renderFinished=new we,this.partialRenderFinished=new we,this.partialLayoutFinished=new we,this.postRenderFinished=new Bt,this.error=new we}get instance(){return this._instance}set instance(e){this._instance=e;const t=this._instanceEventUnregister;if(t)for(const i of t)i();if(e){const i=[];i.push(e.preRender.on(a=>this.preRender.trigger(a))),i.push(e.renderFinished.on(a=>this.renderFinished.trigger(a))),i.push(e.partialRenderFinished.on(a=>this.partialRenderFinished.trigger(a))),i.push(e.partialLayoutFinished.on(a=>this.partialLayoutFinished.trigger(a))),i.push(e.postRenderFinished.on(()=>this.postRenderFinished.trigger())),i.push(e.error.on(a=>this.error.trigger(a))),this._instanceEventUnregister=i,this._settings&&e.updateSettings(this._settings),e.width=this._width,this._score!==null&&e.renderScore(this._score,this._trackIndexes)}else this._instanceEventUnregister=void 0}get boundsLookup(){return this._instance?this._instance.boundsLookup:null}get width(){return this._instance?this._instance.width:0}set width(e){this._width=e,this._instance&&(this._instance.width=e)}render(){var e;(e=this._instance)==null||e.render()}resizeRender(){var e;(e=this._instance)==null||e.resizeRender()}renderScore(e,t){var i;this._score=e,this._trackIndexes=t,(i=this._instance)==null||i.renderScore(e,t)}renderResult(e){var t;(t=this._instance)==null||t.renderResult(e)}updateSettings(e){var t;this._settings=e,(t=this._instance)==null||t.updateSettings(e)}destroy(){var e;(e=this._instance)==null||e.destroy(),this._instance=void 0}}class oc{constructor(e){this.bounds=null,this.beat=e}}class Wv{get actualPlayerMode(){return this._actualPlayerMode}get renderer(){return this._renderer}get score(){return this._score}get tracks(){return this._tracks}constructor(e,t){this._startTime=0,this._trackIndexes=null,this._trackIndexLookup=null,this._isDestroyed=!1,this._score=null,this._tracks=[],this._actualPlayerMode=Pi.Disabled,this._tickCache=null,this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null,this._previousTick=0,this._currentBeat=null,this._currentBeatBounds=null,this._isInitialBeatCursorUpdate=!0,this._previousStateForCursor=ii.Paused,this._previousCursorCache=null,this._lastScroll=0,this._beatMouseDown=!1,this._noteMouseDown=!1,this._selectionStart=null,this._selectionEnd=null,this.beatMouseDown=new we,this.beatMouseMove=new we,this.beatMouseUp=new we,this.noteMouseDown=new we,this.noteMouseMove=new we,this.noteMouseUp=new we,this.resize=new we,this.renderStarted=new we,this.renderFinished=new we,this.postRenderFinished=new Bt,this.error=new we,this.midiLoad=new we,this.settingsUpdated=new Bt,this.uiFacade=e,this.container=e.rootContainer,this.activeBeatsChanged=new we(()=>this._player.state===ii.Playing&&this._currentBeat?new Vy(this._currentBeat.beatLookup.highlightedBeats.map(a=>a.beat)):null),this.playedBeatChanged=new we(()=>this._player.state===ii.Playing&&this._currentBeat?this._currentBeat.beat:null),this.scoreLoaded=new we(()=>this._score?this._score:null),this.midiLoaded=new we(()=>this._player.loadedMidiInfo??null),e.initialize(this,t),E.logLevel=this.settings.core.logLevel,this.settings.handleBackwardsCompatibility(),C.printEnvironmentInfo(!1),this.canvasElement=e.createCanvasElement(),this.container.appendChild(this.canvasElement),this._renderer=new Vv,this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&C.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?this._renderer.instance=this.uiFacade.createWorkerRenderer():this._renderer.instance=new gl(this.settings),this.container.resize.on(C.throttle(()=>{this._isDestroyed||this.container.width!==this._renderer.width&&this.triggerResize()},e.resizeThrottle));const i=new Hy;i.oldWidth=this._renderer.width,i.newWidth=this.container.width|0,i.settings=this.settings,this.onResize(i),this._renderer.preRender.on(this.onRenderStarted.bind(this)),this._renderer.renderFinished.on(a=>{this.onRenderFinished(a)}),this._renderer.postRenderFinished.on(()=>{const a=Date.now()-this._startTime;E.debug("rendering",`Rendering completed in ${a}ms`),this.onPostRenderFinished()}),this._renderer.preRender.on(a=>{this._startTime=Date.now()}),this._renderer.partialLayoutFinished.on(a=>this.appendRenderResult(a,!1)),this._renderer.partialRenderFinished.on(this.updateRenderResult.bind(this)),this._renderer.renderFinished.on(a=>{this.appendRenderResult(a,!0)}),this._renderer.error.on(this.onError.bind(this)),this.setupPlayerWrapper(),this.settings.player.playerMode!==Pi.Disabled&&this.setupOrDestroyPlayer(),this.setupClickHandling(),this.uiFacade.beginInvoke(()=>{this.uiFacade.initialRender()})}setupPlayerWrapper(){const e=new Hv;this._player=e,e.ready.on(()=>{this.loadMidiForScore()}),e.readyForPlayback.on(()=>{if(this.onPlayerReady(),this.tracks)for(const t of this.tracks){const i=t.playbackInfo.volume/16;e.setChannelVolume(t.playbackInfo.primaryChannel,i),e.setChannelVolume(t.playbackInfo.secondaryChannel,i)}}),e.soundFontLoaded.on(this.onSoundFontLoaded.bind(this)),e.soundFontLoadFailed.on(t=>{this.onError(t)}),e.midiLoaded.on(this.onMidiLoaded.bind(this)),e.midiLoadFailed.on(t=>{this.onError(t)}),e.stateChanged.on(this.onPlayerStateChanged.bind(this)),e.positionChanged.on(this.onPlayerPositionChanged.bind(this)),e.midiEventsPlayed.on(this.onMidiEventsPlayed.bind(this)),e.playbackRangeChanged.on(this.onPlaybackRangeChanged.bind(this)),e.finished.on(this.onPlayerFinished.bind(this))}destroy(){this._isDestroyed=!0,this._player.destroy(),this.uiFacade.destroy(),this._renderer.destroy()}updateSettings(){this.settings.handleBackwardsCompatibility();const e=this.score;e&&V.applyPitchOffsets(this.settings,e),this.updateRenderer(),this._renderer.updateSettings(this.settings),this.setupOrDestroyPlayer(),this.onSettingsUpdated()}updateRenderer(){const e=this._renderer;this.settings.core.useWorkers&&this.uiFacade.areWorkersSupported&&C.getRenderEngineFactory(this.settings.core.engine).supportsWorkers?e.instance instanceof gl&&(e.destroy(),e.instance=this.uiFacade.createWorkerRenderer()):e.instance instanceof gl||(e.destroy(),e.instance=new gl(this.settings))}load(e,t){try{return this.uiFacade.load(e,i=>{this.renderScore(i,t)},i=>{this.onError(i)})}catch(i){return this.onError(i),!1}}renderScore(e,t){const i=[];if(!t)e.tracks.length>0&&i.push(e.tracks[0]);else if(t.length===0)e.tracks.length>0&&i.push(e.tracks[0]);else if(t.length===1&&t[0]===-1)for(const a of e.tracks)i.push(a);else for(const a of t)a>=0&&a<=e.tracks.length&&i.push(e.tracks[a]);this.internalRenderTracks(e,i)}renderTracks(e){if(e.length>0){const t=e[0].score;for(const i of e)if(i.score!==t){this.onError(new We(Ve.General,"All rendered tracks must belong to the same score."));return}this.internalRenderTracks(t,e)}}internalRenderTracks(e,t){if(V.applyPitchOffsets(this.settings,e),e!==this.score){this._score=e,this._tracks=t,this._tickCache=null,this._trackIndexes=[];for(const i of t)this._trackIndexes.push(i.index);this._trackIndexLookup=new Set(this._trackIndexes),this.onScoreLoaded(e),this.loadMidiForScore(),this.render()}else{this._tracks=t;const i=V.computeFirstDisplayedBarIndex(e,this.settings),a=V.computeLastDisplayedBarIndex(e,this.settings,i);this._tickCache&&(this._tickCache.multiBarRestInfo=V.buildMultiBarRestInfo(this.tracks,i,a)),this._trackIndexes=[];for(const n of t)this._trackIndexes.push(n.index);this._trackIndexLookup=new Set(this._trackIndexes),this.render()}}triggerResize(){if(!this.container.isVisible)E.warning("Rendering","AlphaTab container was invisible while autosizing, waiting for element to become visible",null),this.uiFacade.rootContainerBecameVisible.on(()=>{E.debug("Rendering","AlphaTab container became visible, doing autosizing",null),this.triggerResize()});else{const e=new Hy;e.oldWidth=this._renderer.width,e.newWidth=this.container.width,e.settings=this.settings,this.onResize(e),this._renderer.updateSettings(this.settings),this._renderer.width=this.container.width,this._renderer.resizeRender()}}appendRenderResult(e,t){t&&(this.canvasElement.width=e.totalWidth,this.canvasElement.height=e.totalHeight,this._cursorWrapper&&(this._cursorWrapper.width=e.totalWidth,this._cursorWrapper.height=e.totalHeight)),(e.width>0||e.height>0)&&this.uiFacade.beginAppendRenderResults(e),t&&this.uiFacade.beginAppendRenderResults(null)}updateRenderResult(e){e&&e.renderResult&&this.uiFacade.beginUpdateRenderResults(e)}tex(e,t){try{const i=new di;i.logErrors=!0,i.initFromString(e,this.settings);const a=i.readScore();this.renderScore(a,t)}catch(i){this.onError(i)}}loadSoundFont(e,t=!1){return this.uiFacade.loadSoundFont(e,t)}resetSoundFonts(){this._player.resetSoundFonts()}render(){this.uiFacade.canRender?(this._renderer.width=this.container.width,this._renderer.renderScore(this.score,this._trackIndexes)):this.uiFacade.canRenderChanged.on(()=>this.render())}get tickCache(){return this._tickCache}get boundsLookup(){return this._renderer.boundsLookup}get player(){return this._player.instance?this._player:null}get isReadyForPlayback(){return this._player.isReadyForPlayback}get playerState(){return this._player.state}get masterVolume(){return this._player.masterVolume}set masterVolume(e){this._player.masterVolume=e}get metronomeVolume(){return this._player.metronomeVolume}set metronomeVolume(e){this._player.metronomeVolume=e}get countInVolume(){return this._player.countInVolume}set countInVolume(e){this._player.countInVolume=e}get midiEventsPlayedFilter(){return this._player.midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._player.midiEventsPlayedFilter=e}get tickPosition(){return this._player.tickPosition}set tickPosition(e){this._player.tickPosition=e}get timePosition(){return this._player.timePosition}set timePosition(e){this._player.timePosition=e}get endTick(){return this._player.currentPosition.endTick}get endTime(){return this._player.currentPosition.endTime}get playbackRange(){return this._player.playbackRange}set playbackRange(e){this._player.playbackRange=e,this.updateSelectionCursor(e)}get playbackSpeed(){return this._player.playbackSpeed}set playbackSpeed(e){this._player.playbackSpeed=e}get isLooping(){return this._player.isLooping}set isLooping(e){this._player.isLooping=e}destroyPlayer(){this._player.destroy(),this._previousTick=0,this.destroyCursors()}setupOrDestroyPlayer(){var i;let e=this.settings.player.playerMode;if(e===Pi.EnabledAutomatic){const a=this.score;if(!a)return!1;(i=a==null?void 0:a.backingTrack)!=null&&i.rawAudioFile?e=Pi.EnabledBackingTrack:e=Pi.EnabledSynthesizer}let t=null;if(e!==this._actualPlayerMode)switch(this.destroyPlayer(),this.updateCursors(),e){case Pi.Disabled:t=null;break;case Pi.EnabledSynthesizer:t=this.uiFacade.createWorkerPlayer();break;case Pi.EnabledBackingTrack:t=this.uiFacade.createBackingTrackPlayer();break;case Pi.EnabledExternalMedia:t=new Iv(this.settings.player.bufferTimeInMilliseconds);break}else return this.updateCursors(),!1;return this._actualPlayerMode=e,t&&(this._player.instance=t),!1}loadMidiForScore(){if(!this.score)return;const e=this.score;E.debug("AlphaTab","Generating Midi");const t=new Za,i=new ra(t),a=new ue(e,this.settings,i),n=V.computeFirstDisplayedBarIndex(e,this.settings),r=V.computeLastDisplayedBarIndex(e,this.settings,n);a.tickLookup.multiBarRestInfo=V.buildMultiBarRestInfo(this.tracks,n,r),a.applyTranspositionPitches=!1,a.generate(),this._tickCache=a.tickLookup,this.onMidiLoad(t);const o=this._player;o.loadMidiFile(t),o.loadBackingTrack(e),o.updateSyncPoints(a.syncPoints),o.applyTranspositionPitches(a.transpositionPitches)}updateSyncPoints(){if(!this.score)return;const e=this.score;this._player.updateSyncPoints(ue.generateSyncPoints(e))}changeTrackVolume(e,t){for(const i of e)this._player.setChannelVolume(i.playbackInfo.primaryChannel,t),this._player.setChannelVolume(i.playbackInfo.secondaryChannel,t)}changeTrackSolo(e,t){for(const i of e)this._player.setChannelSolo(i.playbackInfo.primaryChannel,t),this._player.setChannelSolo(i.playbackInfo.secondaryChannel,t)}changeTrackMute(e,t){for(const i of e)this._player.setChannelMute(i.playbackInfo.primaryChannel,t),this._player.setChannelMute(i.playbackInfo.secondaryChannel,t)}changeTrackTranspositionPitch(e,t){for(const i of e)this._player.setChannelTranspositionPitch(i.playbackInfo.primaryChannel,t),this._player.setChannelTranspositionPitch(i.playbackInfo.secondaryChannel,t)}play(){return this._player.play()}pause(){this._player.pause()}playPause(){this._player.playPause()}stop(){this._player.stop()}playBeat(e){const t=new Za,i=new ra(t);new ue(e.voice.bar.staff.track.score,this.settings,i).generateSingleBeat(e),this._player.playOneTimeMidiFile(t)}playNote(e){const t=new Za,i=new ra(t);new ue(e.beat.voice.bar.staff.track.score,this.settings,i).generateSingleNote(e),this._player.playOneTimeMidiFile(t)}destroyCursors(){this._cursorWrapper&&(this.uiFacade.destroyCursors(),this._cursorWrapper=null,this._barCursor=null,this._beatCursor=null,this._selectionWrapper=null)}updateCursors(){const e=this.hasCursor;if(e&&!this._cursorWrapper){const t=this.uiFacade.createCursors();t&&(this._cursorWrapper=t.cursorWrapper,this._barCursor=t.barCursor,this._beatCursor=t.beatCursor,this._selectionWrapper=t.selectionWrapper,this._isInitialBeatCursorUpdate=!0),this._currentBeat!==null&&this.cursorUpdateBeat(this._currentBeat,!1,this._previousTick>10,1,!0)}else!e&&this._cursorWrapper&&this.destroyCursors()}cursorUpdateTick(e,t,i,a=!1,n=!1){this._previousTick=e;const r=this._tickCache;if(r){const o=this._trackIndexLookup;if(o!=null&&o.size>0){const l=r.findBeat(o,e,this._currentBeat);l&&this.cursorUpdateBeat(l,t,a,i,n||this.playerState===ii.Paused)}}}cursorUpdateBeat(e,t,i,a,n=!1){var m;const r=e.beat,o=((m=e.nextBeat)==null?void 0:m.beat)??null,l=e.duration,h=e.beatLookup.highlightedBeats;if(!r)return;const c=this._renderer.boundsLookup;if(!c)return;const d=this._currentBeat,f=this._previousCursorCache,p=this._previousStateForCursor;if(!n&&r===(d==null?void 0:d.beat)&&c===f&&p===this._player.state&&(d==null?void 0:d.start)===e.start)return;const g=c.findBeat(r);g&&(this._currentBeat=e,this._previousCursorCache=c,this._previousStateForCursor=this._player.state,this.uiFacade.beginInvoke(()=>{this.internalCursorUpdateBeat(r,o,l,t,h,c,g,i,e.cursorMode,a)}))}scrollToCursor(){const e=this._currentBeatBounds;e&&this.internalScrollToCursor(e.barBounds.masterBarBounds)}internalScrollToCursor(e){const t=this.uiFacade.getScrollContainer(),i=C.getLayoutEngineFactory(this.settings.display.layoutMode).vertical,a=this.settings.player.scrollMode;if(i){const n=e.realBounds.y+this.settings.player.scrollOffsetY;if(n!==this._lastScroll)switch(this._lastScroll=n,a){case qa.Continuous:const r=this.uiFacade.getOffset(t,this.container);this.uiFacade.scrollToY(t,r.y+n,this.settings.player.scrollSpeed);break;case qa.OffScreen:const o=t.scrollTop+this.uiFacade.getOffset(null,t).h;if(e.visualBounds.y+e.visualBounds.h>=o||e.visualBounds.y<t.scrollTop){const l=e.realBounds.y+this.settings.player.scrollOffsetY;this.uiFacade.scrollToY(t,l,this.settings.player.scrollSpeed)}break}}else{const n=e.visualBounds.x;if(n!==this._lastScroll)switch(this._lastScroll=n,a){case qa.Continuous:const r=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,r,this.settings.player.scrollSpeed);break;case qa.OffScreen:const o=t.scrollLeft+this.uiFacade.getOffset(null,t).w;if(e.visualBounds.x+e.visualBounds.w>=o||e.visualBounds.x<t.scrollLeft){const l=e.realBounds.x+this.settings.player.scrollOffsetX;this._lastScroll=e.visualBounds.x,this.uiFacade.scrollToX(t,l,this.settings.player.scrollSpeed)}break}}}internalCursorUpdateBeat(e,t,i,a,n,r,o,l,h,c){const d=this._barCursor,f=this._beatCursor,p=o.barBounds.masterBarBounds,g=p.visualBounds,m=this._currentBeatBounds;this._currentBeatBounds=o,d&&d.setBounds(g.x,g.y,g.w,g.h);const T=this._player.state===ii.Playing&&!a;let S=p.visualBounds.x+p.visualBounds.w;if(t&&h===Cs.ToNextBext){const B=r.findBeat(t);B&&B.barBounds.masterBarBounds.staffSystemBounds===p.staffSystemBounds&&(S=B.onNotesX)}let y=o.onNotesX;if(f){if(this.settings.player.enableAnimatedBeatCursor){const B=S-o.onNotesX,N=this._previousTick-this._currentBeat.start,L=this._currentBeat.tickDuration>0?N/this._currentBeat.tickDuration:0;y=o.onNotesX+B*L,i-=i*L,T?((!m||this._isInitialBeatCursorUpdate||g.y!==m.barBounds.masterBarBounds.visualBounds.y||y<m.onNotesX||p.index>m.barBounds.masterBarBounds.index+1)&&(f.transitionToX(0,y),f.setBounds(y,g.y,1,g.h)),this.uiFacade.beginInvoke(()=>{const A=h===Cs.ToNextBext?2:1,J=y+(S-y)*A;f.transitionToX(i/c*A,J)})):(f.transitionToX(0,y),f.setBounds(y,g.y,1,g.h))}else f.transitionToX(0,y),f.setBounds(y,g.y,1,g.h);this._isInitialBeatCursorUpdate=!1}else this._isInitialBeatCursorUpdate=!0;this.uiFacade.removeHighlights();let b=!1;if(T){if(this.settings.player.enableElementHighlighting)for(const B of n){const N=rs.getGroupId(B.beat);this.uiFacade.highlightElements(N,e.voice.bar.index)}l=!a,b=!0}l&&!this._beatMouseDown&&this.settings.player.scrollMode!==qa.Off&&this.internalScrollToCursor(p),b&&(this.onPlayedBeatChanged(e),this.onActiveBeatsChanged(new Vy(n.map(B=>B.beat))))}onPlayedBeatChanged(e){this._isDestroyed||(this.playedBeatChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"playedBeatChanged",e))}onActiveBeatsChanged(e){this._isDestroyed||(this.activeBeatsChanged.trigger(e),this.uiFacade.triggerEvent(this.container,"activeBeatsChanged",e))}get hasCursor(){return this.settings.player.playerMode!==Pi.Disabled&&this.settings.player.enableCursor}onBeatMouseDown(e,t){this._isDestroyed||(this.hasCursor&&this.settings.player.enableUserInteraction&&(this._selectionStart=new oc(t),this._selectionEnd=null),this._beatMouseDown=!0,this.beatMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseDown",t,e))}onNoteMouseDown(e,t){this._isDestroyed||(this._noteMouseDown=!0,this.noteMouseDown.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseDown",t,e))}onBeatMouseMove(e,t){this._isDestroyed||(this.settings.player.enableUserInteraction&&(!this._selectionEnd||this._selectionEnd.beat!==t)&&(this._selectionEnd=new oc(t),this.cursorSelectRange(this._selectionStart,this._selectionEnd)),this.beatMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseMove",t,e))}onNoteMouseMove(e,t){this._isDestroyed||(this.noteMouseMove.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseMove",t,e))}onBeatMouseUp(e,t){var i,a;if(!this._isDestroyed){if(this.hasCursor&&this.settings.player.enableUserInteraction){if(this._selectionEnd){const n=((i=this._tickCache)==null?void 0:i.getBeatStart(this._selectionStart.beat))??this._selectionStart.beat.absolutePlaybackStart;if((((a=this._tickCache)==null?void 0:a.getBeatStart(this._selectionEnd.beat))??this._selectionEnd.beat.absolutePlaybackStart)<n){const o=this._selectionStart;this._selectionStart=this._selectionEnd,this._selectionEnd=o}}if(this._selectionStart&&this._tickCache){const n=this._tickCache,r=n.getMasterBarStart(this._selectionStart.beat.voice.bar.masterBar);if(this._currentBeat=null,this._player.state===ii.Paused&&this.cursorUpdateTick(this._tickCache.getBeatStart(this._selectionStart.beat),!1,1),this.tickPosition=r+this._selectionStart.beat.playbackStart,this._selectionEnd&&this._selectionStart.beat!==this._selectionEnd.beat){const o=n.getMasterBarStart(this._selectionEnd.beat.voice.bar.masterBar),l=new Mv;l.startTick=r+this._selectionStart.beat.playbackStart,l.endTick=o+this._selectionEnd.beat.playbackStart+this._selectionEnd.beat.playbackDuration-50,this.playbackRange=l}else this._selectionStart=null,this.playbackRange=null,this.cursorSelectRange(this._selectionStart,this._selectionEnd)}}this.beatMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"beatMouseUp",t,e),this._beatMouseDown=!1}}onNoteMouseUp(e,t){this._isDestroyed||(this.noteMouseUp.trigger(t),this.uiFacade.triggerEvent(this.container,"noteMouseUp",t,e),this._noteMouseDown=!1)}updateSelectionCursor(e){if(this._tickCache)if(e){const t=this._tickCache.findBeat(this._trackIndexLookup,e.startTick),i=this._tickCache.findBeat(this._trackIndexLookup,e.endTick);if(t&&i){const a=new oc(t.beat),n=new oc(i.beat);this.cursorSelectRange(a,n)}}else this.cursorSelectRange(null,null)}setupClickHandling(){this.canvasElement.mouseDown.on(e=>{var n,r;if(!e.isLeftMouseButton)return;this.settings.player.enableUserInteraction&&e.preventDefault();const t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),a=((n=this._renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,i))??null;if(a&&(this.onBeatMouseDown(e,a),this.settings.core.includeNoteBounds)){const o=(r=this._renderer.boundsLookup)==null?void 0:r.getNoteAtPos(a,t,i);o&&this.onNoteMouseDown(e,o)}}),this.canvasElement.mouseMove.on(e=>{var n,r;if(!this._beatMouseDown)return;const t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),a=((n=this._renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,i))??null;if(a&&(this.onBeatMouseMove(e,a),this._noteMouseDown)){const o=(r=this._renderer.boundsLookup)==null?void 0:r.getNoteAtPos(a,t,i);o&&this.onNoteMouseMove(e,o)}}),this.canvasElement.mouseUp.on(e=>{var n,r;if(!this._beatMouseDown)return;this.settings.player.enableUserInteraction&&e.preventDefault();const t=e.getX(this.canvasElement),i=e.getY(this.canvasElement),a=((n=this._renderer.boundsLookup)==null?void 0:n.getBeatAtPos(t,i))??null;if(this.onBeatMouseUp(e,a),this._noteMouseDown)if(a){const o=((r=this._renderer.boundsLookup)==null?void 0:r.getNoteAtPos(a,t,i))??null;this.onNoteMouseUp(e,o)}else this.onNoteMouseUp(e,null)}),this._renderer.postRenderFinished.on(()=>{!this._selectionStart||!this.hasCursor||!this.settings.player.enableUserInteraction||this.cursorSelectRange(this._selectionStart,this._selectionEnd)})}cursorSelectRange(e,t){var h,c;const i=this._renderer.boundsLookup;if(!i)return;const a=this._selectionWrapper;if(!a||(a.clear(),!e||!t||e.beat===t.beat))return;e.bounds||(e.bounds=i.findBeat(e.beat)),t.bounds||(t.bounds=i.findBeat(t.beat));const n=((h=this._tickCache)==null?void 0:h.getBeatStart(e.beat))??e.beat.absolutePlaybackStart;if((((c=this._tickCache)==null?void 0:c.getBeatStart(t.beat))??t.beat.absolutePlaybackStart)<n){const d=e;e=t,t=d}const o=e.bounds.realBounds.x;let l=t.bounds.realBounds.x+t.bounds.realBounds.w;if(t.beat.index===t.beat.voice.beats.length-1&&(l=t.bounds.barBounds.masterBarBounds.realBounds.x+t.bounds.barBounds.masterBarBounds.realBounds.w),e.bounds.barBounds.masterBarBounds.staffSystemBounds!==t.bounds.barBounds.masterBarBounds.staffSystemBounds){const d=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x,f=e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.x+e.bounds.barBounds.masterBarBounds.staffSystemBounds.visualBounds.w,p=this.uiFacade.createSelectionElement();p.setBounds(o,e.bounds.barBounds.masterBarBounds.visualBounds.y,f-o,e.bounds.barBounds.masterBarBounds.visualBounds.h),a.appendChild(p);const g=e.bounds.barBounds.masterBarBounds.staffSystemBounds.index+1,m=t.bounds.barBounds.masterBarBounds.staffSystemBounds.index;for(let S=g;S<m;S++){const y=i.staffSystems[S],b=this.uiFacade.createSelectionElement();b.setBounds(d,y.visualBounds.y,f-d,y.visualBounds.h),a.appendChild(b)}const T=this.uiFacade.createSelectionElement();T.setBounds(d,t.bounds.barBounds.masterBarBounds.visualBounds.y,l-d,t.bounds.barBounds.masterBarBounds.visualBounds.h),a.appendChild(T)}else{const d=this.uiFacade.createSelectionElement();d.setBounds(o,e.bounds.barBounds.masterBarBounds.visualBounds.y,l-o,e.bounds.barBounds.masterBarBounds.visualBounds.h),a.appendChild(d)}}onScoreLoaded(e){this._isDestroyed||(this.scoreLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"scoreLoaded",e),this.setupOrDestroyPlayer()||this.loadMidiForScore())}onResize(e){this._isDestroyed||(this.resize.trigger(e),this.uiFacade.triggerEvent(this.container,"resize",e))}onRenderStarted(e){this._isDestroyed||(this.renderStarted.trigger(e),this.uiFacade.triggerEvent(this.container,"renderStarted",e))}onRenderFinished(e){this._isDestroyed||(this.renderFinished.trigger(e),this.uiFacade.triggerEvent(this.container,"renderFinished",e))}onPostRenderFinished(){this._isDestroyed||(this._currentBeat=null,this.cursorUpdateTick(this._previousTick,!1,1,!0,!0),this.postRenderFinished.trigger(),this.uiFacade.triggerEvent(this.container,"postRenderFinished",null))}onError(e){this._isDestroyed||(E.error("API","An unexpected error occurred",e),this.error.trigger(e),this.uiFacade.triggerEvent(this.container,"error",e))}get playerReady(){return this._player.readyForPlayback}onPlayerReady(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playerReady",null)}get playerFinished(){return this._player.finished}onPlayerFinished(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playerFinished",null)}get soundFontLoaded(){return this._player.soundFontLoaded}onSoundFontLoaded(){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"soundFontLoaded",null)}onMidiLoad(e){this._isDestroyed||(this.midiLoad.trigger(e),this.uiFacade.triggerEvent(this.container,"midiLoad",e))}onMidiLoaded(e){this._isDestroyed||(this.midiLoaded.trigger(e),this.uiFacade.triggerEvent(this.container,"midiFileLoaded",e))}get playerStateChanged(){return this._player.stateChanged}onPlayerStateChanged(e){if(!this._isDestroyed){if(!e.stopped&&e.state===ii.Paused){const t=this._currentBeat,i=this._tickCache;t&&i&&(this._player.tickPosition=i.getBeatStart(t.beat))}this.uiFacade.triggerEvent(this.container,"playerStateChanged",e)}}get playerPositionChanged(){return this._player.positionChanged}onPlayerPositionChanged(e){this._isDestroyed||(this._previousTick=e.currentTick,this.uiFacade.beginInvoke(()=>{const t=e.modifiedTempo/e.originalTempo;this.cursorUpdateTick(e.currentTick,!1,t,!1,e.isSeek)}),this.uiFacade.triggerEvent(this.container,"playerPositionChanged",e))}get midiEventsPlayed(){return this._player.midiEventsPlayed}onMidiEventsPlayed(e){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"midiEventsPlayed",e)}get playbackRangeChanged(){return this._player.playbackRangeChanged}onPlaybackRangeChanged(e){this._isDestroyed||this.uiFacade.triggerEvent(this.container,"playbackRangeChanged",e)}onSettingsUpdated(){this._isDestroyed||(this.settingsUpdated.trigger(),this.uiFacade.triggerEvent(this.container,"settingsUpdated",null))}async enumerateOutputDevices(){return await this._player.output.enumerateOutputDevices()}async setOutputDevice(e){await this._player.output.setOutputDevice(e)}async getOutputDevice(){return await this._player.output.getOutputDevice()}async exportAudio(e){if(!this.score)throw new We(Ve.General,"No song loaded");let t;switch(this._actualPlayerMode){case Pi.EnabledSynthesizer:t=this.uiFacade.createWorkerAudioExporter(this._player.instance);break;default:t=this.uiFacade.createWorkerAudioExporter(null);break}const i=this.score,a=new Za,n=new ra(a),r=new ue(i,this.settings,n);r.applyTranspositionPitches=!1,r.generate();const o=new gv;o.soundFonts=e.soundFonts,o.sampleRate=e.sampleRate,o.useSyncPoints=e.useSyncPoints,o.masterVolume=e.masterVolume,o.metronomeVolume=e.metronomeVolume,o.playbackRange=e.playbackRange;for(const[l,h]of e.trackVolume)if(l<this.score.tracks.length){const c=this.score.tracks[l];o.trackVolume.set(c.playbackInfo.primaryChannel,h),o.trackVolume.set(c.playbackInfo.secondaryChannel,h)}for(const[l,h]of e.trackTranspositionPitches)if(l<this.score.tracks.length){const c=this.score.tracks[l];o.trackTranspositionPitches.set(c.playbackInfo.primaryChannel,h),o.trackTranspositionPitches.set(c.playbackInfo.secondaryChannel,h)}return await t.initialize(o,a,r.syncPoints,r.transpositionPitches),t}}class za extends We{constructor(e,t){super(Ve.General,e),this.xhr=t,Object.setPrototypeOf(this,za.prototype)}}class fo{static loadAlphaTex(e,t){const i=new di;return i.logErrors=!0,i.initFromString(e,t??new sr),i.readScore()}static loadScoreAsync(e,t,i,a){const n=new XMLHttpRequest;n.open("GET",e,!0,null,null),n.responseType="arraybuffer",n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){const r=n.response;if(n.status===200||n.status===0&&r)try{const o=n.response,l=new Uint8Array(o),h=fo.loadScoreFromBytes(l,a);t(h)}catch(o){i(o)}else n.status===0?i(new za(`You are offline!!
 Please Check Your Network.`,n)):n.status===404?i(new za("Requested URL not found.",n)):n.status===500?i(new za("Internel Server Error.",n)):n.statusText==="parsererror"?i(new za(`Error.
Parsing JSON Request failed.`,n)):n.statusText==="timeout"?i(new za("Request Time out.",n)):i(new za(`Unknow Error: ${n.responseText}`,n))}},n.send()}static loadScoreFromBytes(e,t){t||(t=new sr);const i=C.buildImporters();E.debug("ScoreLoader",`Loading score from ${e.length} bytes using ${i.length} importers`);let a=null;const n=Dt.fromBuffer(e);for(const r of i){n.reset();try{E.debug("ScoreLoader",`Importing using importer ${r.name}`),r.init(n,t),a=r.readScore(),E.debug("ScoreLoader",`Score imported using ${r.name}`);break}catch(o){if(o instanceof vt)E.debug("ScoreLoader",`${r.name} does not support the file`);else throw E.error("ScoreLoader","Score import failed due to unexpected error: ",o),o}}if(a)return a;throw new vt("No compatible importer found for file")}}class tf{get isLeftMouseButton(){return this.mouseEvent.button===0}getX(e){const t=e.element,a=t.getBoundingClientRect().left+t.ownerDocument.defaultView.pageXOffset;return this.mouseEvent.pageX-a}getY(e){const t=e.element,a=t.getBoundingClientRect().top+t.ownerDocument.defaultView.pageYOffset;return this.mouseEvent.pageY-a}preventDefault(){this.mouseEvent.preventDefault()}constructor(e){this.mouseEvent=e}}class ba{get width(){return this.element.offsetWidth}set width(e){this.element.style.width=`${e}px`}get scrollLeft(){return this.element.scrollLeft}set scrollLeft(e){this.element.scrollLeft=e}get scrollTop(){return this.element.scrollTop}set scrollTop(e){this.element.scrollTop=e}get height(){return this.element.offsetHeight}set height(e){e>=0?this.element.style.height=`${e}px`:this.element.style.height="100%"}get isVisible(){return!!this.element.offsetWidth||!!this.element.offsetHeight||!!this.element.getClientRects().length}constructor(e){this._resizeListeners=0,this.lastBounds=new hi,this.element=e,this.mouseDown={on:i=>{const a=n=>{i(new tf(n))};return this.element.addEventListener("mousedown",a,!0),()=>{this.element.removeEventListener("mousedown",a,!0)}},off:i=>{}},this.mouseUp={on:i=>{const a=n=>{i(new tf(n))};return this.element.addEventListener("mouseup",a,!0),()=>{this.element.removeEventListener("mouseup",a,!0)}},off:i=>{}},this.mouseMove={on:i=>{const a=n=>{i(new tf(n))};return this.element.addEventListener("mousemove",a,!0),()=>{this.element.removeEventListener("mousemove",a,!0)}},off:i=>{}};const t=this;this.resize={on:function(i){return t._resizeListeners===0&&ba.resizeObserver.value.observe(t.element),t.element.addEventListener("resize",i,!0),t._resizeListeners++,()=>this.off(i)},off:i=>{this.element.removeEventListener("resize",i,!0),this._resizeListeners--,this._resizeListeners<=0&&(this._resizeListeners=0,ba.resizeObserver.value.unobserve(this.element))}}}stopAnimation(){this.element.style.transition="none"}transitionToX(e,t){this.element.style.transition=`transform ${e}ms linear`,this.setBounds(t,Number.NaN,Number.NaN,Number.NaN)}setBounds(e,t,i,a){Number.isNaN(e)&&(e=this.lastBounds.x),Number.isNaN(t)&&(t=this.lastBounds.y),Number.isNaN(i)&&(i=this.lastBounds.w),Number.isNaN(a)&&(a=this.lastBounds.h),this.element.style.transform=`translate(${e}px, ${t}px) scale(${i}, ${a})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=i,this.lastBounds.h=a}appendChild(e){this.element.appendChild(e.element)}clear(){this.element.innerHTML=""}}ba.resizeObserver=new Fh(()=>new ResizeObserver(s=>{for(const e of s){const t=new CustomEvent("resize",{detail:e});e.target.dispatchEvent(t)}}));class Wy{constructor(e){this._isStarted=!1,this.isFontLoaded=!1,this.fontLoaded=new we,this._originalFamilies=e,this._families=e}checkForFontAvailability(){if(C.isRunningInWorker){this.isFontLoaded=!1;return}if(this._isStarted)return;this._isStarted=!0;let e=0;const t=window.setInterval(()=>{E.warning("Rendering",`Could not load font '${this._families[0]}' within ${(e+1)*5} seconds`,null),this._families.length>1?(this._families.shift(),e=0):e++},5e3);E.debug("Font",`Start checking for font availablility: ${this._families.join(", ")}`);const i=r=>{this._families.length>1?(E.debug("Font",`[${this._families[0]}] Loading Failed, switching to ${this._families[1]}`,r),this._families.shift(),window.setTimeout(()=>{n()},0)):(E.error("Font",`[${this._originalFamilies.join(",")}] Loading Failed, rendering cannot start`,r),window.clearInterval(t))},a=r=>{E.debug("Font",`[${r}] Font API signaled available`),this.isFontLoaded=!0,window.clearInterval(t),this.fontLoaded.trigger(this._families[0])},n=async()=>{for(const r of this._families)if(await this.isFontAvailable(r,!1)){a(r);return}try{await document.fonts.load(`1em ${this._families[0]}`)}catch(r){i(r)}return E.debug("Font",`[${this._families[0]}] Font API signaled loaded`),await this.isFontAvailable(this._families[0],!0)?a(this._families[0]):i("Font not available"),!0};document.fonts.ready.then(()=>{n()})}isFontAvailable(e,t){return new Promise(i=>{const a=`1em ${e}`;if(document.fonts.check(a))i(!0);else if(t){E.debug("Font",`Font ${e} not available, creating test element to trigger load`);const n=document.createElement("div");n.style.font=a,n.style.opacity="0",n.style.position="absolute",n.style.top="0",n.style.left="0",n.innerText=`Trigger ${e} load`,document.body.appendChild(n),setTimeout(()=>{document.body.removeChild(n),document.fonts.check(a)?i(!0):i(!1)},200)}else i(!1)})}}class Ck{constructor(e){this._writePosition=0,this._readPosition=0,this.count=0,this._buffer=new Float32Array(e)}clear(){this._readPosition=0,this._writePosition=0,this.count=0,this._buffer=new Float32Array(this._buffer.length)}write(e,t,i){let a=0;i>this._buffer.length-this.count&&(i=this._buffer.length-this.count);const n=Math.min(this._buffer.length-this._writePosition,i);return this._buffer.set(e.subarray(t,t+n),this._writePosition),this._writePosition+=n,this._writePosition%=this._buffer.length,a+=n,a<i&&(this._buffer.set(e.subarray(t+a,t+a+i-a),this._writePosition),this._writePosition+=i-a,a=i),this.count+=a,a}read(e,t,i){i>this.count&&(i=this.count);let a=0;const n=Math.min(this._buffer.length-this._readPosition,i);return e.set(this._buffer.subarray(this._readPosition,this._readPosition+n),t),a+=n,this._readPosition+=n,this._readPosition%=this._buffer.length,a<i&&(e.set(this._buffer.subarray(this._readPosition,this._readPosition+i-a),t+a),this._readPosition+=i-a,a=i),this.count-=a,a}}class zv{constructor(e){this.isDefault=!1,this.device=e}get deviceId(){return this.device.deviceId}get label(){return this.device.label}}class Hi{static findKnownDevice(e){return Hi._knownDevices.find(t=>t.deviceId===e)}static createAudioContext(){if("AudioContext"in C.globalThis)return new AudioContext;if("webkitAudioContext"in C.globalThis)return new webkitAudioContext;throw new We(Ve.General,"AudioContext not found")}static async checkSinkIdSupport(){return"setSinkId"in Hi.createAudioContext()?!0:(E.warning("WebAudio","Browser does not support changing the output device"),!1)}static async enumerateOutputDevices(){try{if(!await Hi.checkSinkIdSupport())return[];try{await navigator.mediaDevices.getUserMedia({audio:!0})}catch(o){E.warning("WebAudio","Output device permission rejected",o)}const e=await navigator.mediaDevices.enumerateDevices();let t="",i="";const a=new Map;for(const o of e)o.kind==="audiooutput"&&(a.set(o.groupId,new zv(o)),(o.deviceId==="default"||o.deviceId==="")&&(t=o.groupId,i=o.deviceId));const n=Array.from(a.values());let r=n.find(o=>o.deviceId===i);return r||(r=n.find(o=>o.device.groupId===t)),!r&&n.length>0&&(r=n[0]),r&&(r.isDefault=!0),Hi._knownDevices=n,n}catch(e){return E.error("WebAudio","Failed to enumerate output devices",e),[]}}}Hi._knownDevices=[];class Zs{constructor(){this._context=null,this._buffer=null,this._source=null,this.ready=new Bt,this.samplesPlayed=new we,this.sampleRequest=new Bt}get sampleRate(){return this._context?this._context.sampleRate:Zs.PreferredSampleRate}activate(e){this._context||(this._context=Hi.createAudioContext()),(this._context.state==="suspended"||this._context.state==="interrupted")&&(E.debug("WebAudio","Audio Context is suspended, trying resume"),this._context.resume().then(()=>{var t,i;E.debug("WebAudio",`Audio Context resume success: state=${(t=this._context)==null?void 0:t.state}, sampleRate:${(i=this._context)==null?void 0:i.sampleRate}`),e&&e()},t=>{var i,a;E.warning("WebAudio",`Audio Context resume failed: state=${(i=this._context)==null?void 0:i.state}, sampleRate:${(a=this._context)==null?void 0:a.sampleRate}, reason=${t}`)}))}patchIosSampleRate(){const e=navigator.userAgent;if(e.indexOf("iPhone")!==-1||e.indexOf("iPad")!==-1){const t=Hi.createAudioContext(),i=t.createBuffer(1,1,Zs.PreferredSampleRate),a=t.createBufferSource();a.buffer=i,a.connect(t.destination),a.start(0),a.disconnect(0),t.close()}}open(e){this.patchIosSampleRate(),this._context=Hi.createAudioContext(),this._context.state==="suspended"&&this.registerResumeHandler()}registerResumeHandler(){this._resumeHandler=(()=>{this.activate(()=>{this.unregisterResumeHandler()})}).bind(this),document.body.addEventListener("touchend",this._resumeHandler,!1),document.body.addEventListener("click",this._resumeHandler,!1)}unregisterResumeHandler(){const e=this._resumeHandler;e&&(document.body.removeEventListener("touchend",e,!1),document.body.removeEventListener("click",e,!1))}play(){const e=this._context;this.activate(),this._buffer=e.createBuffer(2,Zs.BufferSize,e.sampleRate),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0}pause(){this._source&&(this._source.stop(0),this._source.disconnect()),this._source=null}destroy(){var e;this.pause(),(e=this._context)==null||e.close(),this._context=null,this.unregisterResumeHandler()}onSamplesPlayed(e){this.samplesPlayed.trigger(e)}onSampleRequest(){this.sampleRequest.trigger()}onReady(){this.ready.trigger()}enumerateOutputDevices(){return Hi.enumerateOutputDevices()}async setOutputDevice(e){await Hi.checkSinkIdSupport()&&(e?await this._context.setSinkId(e.deviceId):await this._context.setSinkId(""))}async getOutputDevice(){if(!await Hi.checkSinkIdSupport())return null;const e=this._context.sinkId;if(typeof e!="string"||e===""||e==="default")return null;let t=Hi.findKnownDevice(e);if(t)return t;const i=await this.enumerateOutputDevices();return t=i.find(a=>a.deviceId===e),t||(E.warning("WebAudio","Could not find output device in device list",e,i),null)}}Zs.BufferSize=4096;Zs.PreferredSampleRate=44100;class Gv extends Zs{constructor(){super(...arguments),this._audioNode=null,this._bufferCount=0,this._requestedBufferCount=0,this._outputBuffer=new Float32Array(0)}open(e){super.open(e),this._bufferCount=Math.floor(e*this.sampleRate/1e3/Zs.BufferSize),this._circularBuffer=new Ck(Zs.BufferSize*this._bufferCount),this.onReady()}play(){super.play();const e=this._context;this._audioNode=e.createScriptProcessor(4096,0,2),this._audioNode.onaudioprocess=this.generateSound.bind(this),this._circularBuffer.clear(),this.requestBuffers(),this._source=e.createBufferSource(),this._source.buffer=this._buffer,this._source.loop=!0,this._source.connect(this._audioNode,0,0),this._source.start(0),this._audioNode.connect(e.destination,0,0)}pause(){super.pause(),this._audioNode&&this._audioNode.disconnect(0),this._audioNode=null}addSamples(e){this._circularBuffer.write(e,0,e.length),this._requestedBufferCount--}resetSamples(){this._circularBuffer.clear()}requestBuffers(){const e=this._bufferCount/2|0,t=e*Zs.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*Zs.BufferSize<t){for(let a=0;a<e;a++)this.onSampleRequest();this._requestedBufferCount+=e}}generateSound(e){const t=e.outputBuffer.getChannelData(0),i=e.outputBuffer.getChannelData(1),a=t.length+i.length;let n=this._outputBuffer;n.length!==a&&(n=new Float32Array(a),this._outputBuffer=n);const r=this._circularBuffer.read(n,0,Math.min(n.length,this._circularBuffer.count));let o=0;const l=Math.min(t.length,r);for(let h=0;h<l;h++)t[h]=n[o++],i[h]=n[o++];if(r<t.length)for(let h=r;h<t.length;h++)t[h]=0,i[h]=0;this.onSamplesPlayed(r/te.AudioChannels),this.requestBuffers()}}class sf{get output(){return this._output}get isReady(){return this._workerIsReady&&this._outputIsReady}get isReadyForPlayback(){return this._workerIsReadyForPlayback}get state(){return this._state}get logLevel(){return E.logLevel}get worker(){return this._synth}set logLevel(e){E.logLevel=e,this._synth.postMessage({cmd:"alphaSynth.setLogLevel",value:e})}get masterVolume(){return this._masterVolume}set masterVolume(e){e=Math.max(e,te.MinVolume),this._masterVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMasterVolume",value:e})}get metronomeVolume(){return this._metronomeVolume}set metronomeVolume(e){e=Math.max(e,te.MinVolume),this._metronomeVolume=e,this._synth.postMessage({cmd:"alphaSynth.setMetronomeVolume",value:e})}get countInVolume(){return this._countInVolume}set countInVolume(e){e=Math.max(e,te.MinVolume),this._countInVolume=e,this._synth.postMessage({cmd:"alphaSynth.setCountInVolume",value:e})}get midiEventsPlayedFilter(){return this._midiEventsPlayedFilter}set midiEventsPlayedFilter(e){this._midiEventsPlayedFilter=e,this._synth.postMessage({cmd:"alphaSynth.setMidiEventsPlayedFilter",value:C.prepareForPostMessage(e)})}get playbackSpeed(){return this._playbackSpeed}set playbackSpeed(e){e=V.clamp(e,te.MinPlaybackSpeed,te.MaxPlaybackSpeed),this._playbackSpeed=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackSpeed",value:e})}get loadedMidiInfo(){return this.loadedMidiInfo}get currentPosition(){return this._currentPosition}get tickPosition(){return this._currentPosition.currentTick}set tickPosition(e){e<0&&(e=0),this._currentPosition=new Ya(this._currentPosition.currentTime,this._currentPosition.endTime,e,this._currentPosition.endTick,!0,this._currentPosition.originalTempo,this._currentPosition.modifiedTempo),this._synth.postMessage({cmd:"alphaSynth.setTickPosition",value:e})}get timePosition(){return this._currentPosition.currentTime}set timePosition(e){e<0&&(e=0),this._currentPosition=new Ya(e,this._currentPosition.endTime,this._currentPosition.currentTick,this._currentPosition.endTick,!0,this._currentPosition.originalTempo,this._currentPosition.modifiedTempo),this._synth.postMessage({cmd:"alphaSynth.setTimePosition",value:e})}get isLooping(){return this._isLooping}set isLooping(e){this._isLooping=e,this._synth.postMessage({cmd:"alphaSynth.setIsLooping",value:e})}get playbackRange(){return this._playbackRange}set playbackRange(e){e&&(e.startTick<0&&(e.startTick=0),e.endTick<0&&(e.endTick=0)),this._playbackRange=e,this._synth.postMessage({cmd:"alphaSynth.setPlaybackRange",value:C.prepareForPostMessage(e)})}constructor(e,t){this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=ii.Paused,this._masterVolume=0,this._metronomeVolume=0,this._countInVolume=0,this._playbackSpeed=0,this._isLooping=!1,this._playbackRange=null,this._midiEventsPlayedFilter=[],this._currentPosition=new Ya(0,0,0,0,!1,120,120),this.ready=new Bt,this.readyForPlayback=new Bt,this.finished=new Bt,this.soundFontLoaded=new Bt,this.soundFontLoadFailed=new we,this.midiLoaded=new we,this.midiLoadFailed=new we,this.stateChanged=new we,this.positionChanged=new we,this.midiEventsPlayed=new we,this.playbackRangeChanged=new we,this._workerIsReadyForPlayback=!1,this._workerIsReady=!1,this._outputIsReady=!1,this._state=ii.Paused,this._masterVolume=0,this._metronomeVolume=0,this._playbackSpeed=0,this._isLooping=!1,this._playbackRange=null,this._output=e,this._output.ready.on(this.onOutputReady.bind(this)),this._output.samplesPlayed.on(this.onOutputSamplesPlayed.bind(this)),this._output.sampleRequest.on(this.onOutputSampleRequest.bind(this)),this._output.open(t.player.bufferTimeInMilliseconds);try{this._synth=C.createWebWorker(t)}catch(i){E.error("AlphaSynth",`Failed to create WebWorker: ${i}`)}this._synth.addEventListener("message",this.handleWorkerMessage.bind(this),!1),this._synth.postMessage({cmd:"alphaSynth.initialize",sampleRate:this._output.sampleRate,logLevel:t.core.logLevel,bufferTimeInMilliseconds:t.player.bufferTimeInMilliseconds}),this.masterVolume=1,this.playbackSpeed=1,this.metronomeVolume=0}destroy(){this._synth.postMessage({cmd:"alphaSynth.destroy"})}play(){return this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.play"}),!0}pause(){this._synth.postMessage({cmd:"alphaSynth.pause"})}playPause(){this._output.activate(),this._synth.postMessage({cmd:"alphaSynth.playPause"})}stop(){this._synth.postMessage({cmd:"alphaSynth.stop"})}playOneTimeMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.playOneTimeMidiFile",midi:Ft.midiFileToJsObject(C.prepareForPostMessage(e))})}loadSoundFont(e,t){this._synth.postMessage({cmd:"alphaSynth.loadSoundFontBytes",data:C.prepareForPostMessage(e),append:t})}resetSoundFonts(){this._synth.postMessage({cmd:"alphaSynth.resetSoundFonts"})}loadMidiFile(e){this._synth.postMessage({cmd:"alphaSynth.loadMidi",midi:Ft.midiFileToJsObject(C.prepareForPostMessage(e))})}applyTranspositionPitches(e){this._synth.postMessage({cmd:"alphaSynth.applyTranspositionPitches",transpositionPitches:JSON.stringify(Array.from(C.prepareForPostMessage(e).entries()))})}setChannelTranspositionPitch(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelTranspositionPitch",channel:e,semitones:t})}setChannelMute(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelMute",channel:e,mute:t})}resetChannelStates(){this._synth.postMessage({cmd:"alphaSynth.resetChannelStates"})}setChannelSolo(e,t){this._synth.postMessage({cmd:"alphaSynth.setChannelSolo",channel:e,solo:t})}setChannelVolume(e,t){t=Math.max(t,te.MinVolume),this._synth.postMessage({cmd:"alphaSynth.setChannelVolume",channel:e,volume:t})}handleWorkerMessage(e){const t=e.data;switch(t.cmd){case"alphaSynth.ready":this._workerIsReady=!0,this.checkReady();break;case"alphaSynth.destroyed":this._synth.terminate();break;case"alphaSynth.readyForPlayback":this._workerIsReadyForPlayback=!0,this.checkReadyForPlayback();break;case"alphaSynth.positionChanged":this._currentPosition=new Ya(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek,t.originalTempo,t.modifiedTempo),this.positionChanged.trigger(this._currentPosition);break;case"alphaSynth.midiEventsPlayed":this.midiEventsPlayed.trigger(new wk(t.events.map(Ft.jsObjectToMidiEvent)));break;case"alphaSynth.playerStateChanged":this._state=t.state,this.stateChanged.trigger(new co(t.state,t.stopped));break;case"alphaSynth.playbackRangeChanged":this._playbackRange=t.playbackRange,this.playbackRangeChanged.trigger(new su(this._playbackRange));break;case"alphaSynth.finished":this.finished.trigger();break;case"alphaSynth.soundFontLoaded":this.soundFontLoaded.trigger();break;case"alphaSynth.soundFontLoadFailed":this.soundFontLoadFailed.trigger(t.error);break;case"alphaSynth.midiLoaded":this.checkReadyForPlayback(),this._loadedMidiInfo=new Ya(t.currentTime,t.endTime,t.currentTick,t.endTick,t.isSeek,t.originalTempo,t.modifiedTempo),this.midiLoaded.trigger(this._loadedMidiInfo);break;case"alphaSynth.midiLoadFailed":this.checkReadyForPlayback(),this.midiLoadFailed.trigger(t.error);break;case"alphaSynth.output.addSamples":this._output.addSamples(t.samples);break;case"alphaSynth.output.play":this._output.play();break;case"alphaSynth.output.pause":this._output.pause();break;case"alphaSynth.output.destroy":this._output.destroy();break;case"alphaSynth.output.resetSamples":this._output.resetSamples();break}}checkReady(){this.isReady&&this.ready.trigger()}checkReadyForPlayback(){this.isReadyForPlayback&&this.readyForPlayback.trigger()}onOutputSampleRequest(){this._synth.postMessage({cmd:"alphaSynth.output.sampleRequest"})}onOutputSamplesPlayed(e){this._synth.postMessage({cmd:"alphaSynth.output.samplesPlayed",samples:e})}onOutputReady(){this._outputIsReady=!0,this.checkReady()}loadBackingTrack(e){}updateSyncPoints(e){}}class Uv{constructor(e,t){this._width=0,this.boundsLookup=null,this.preRender=new we,this.partialRenderFinished=new we,this.partialLayoutFinished=new we,this.renderFinished=new we,this.postRenderFinished=new Bt,this.error=new we,this._api=e;try{this._worker=C.createWebWorker(t)}catch(i){E.error("Rendering",`Failed to create WebWorker: ${i}`);return}this._worker.postMessage({cmd:"alphaTab.initialize",settings:this.serializeSettingsForWorker(t)}),this._worker.addEventListener("message",this.handleWorkerMessage.bind(this))}destroy(){this._worker.terminate()}updateSettings(e){this._worker.postMessage({cmd:"alphaTab.updateSettings",settings:this.serializeSettingsForWorker(e)})}serializeSettingsForWorker(e){const t=Ft.settingsToJsObject(C.prepareForPostMessage(e));return t.delete("player"),t}render(){this._worker.postMessage({cmd:"alphaTab.render"})}resizeRender(){this._worker.postMessage({cmd:"alphaTab.resizeRender"})}renderResult(e){this._worker.postMessage({cmd:"alphaTab.renderResult",resultId:e})}get width(){return this._width}set width(e){this._width=e,this._worker.postMessage({cmd:"alphaTab.setWidth",width:e})}handleWorkerMessage(e){const t=e.data;switch(t.cmd){case"alphaTab.preRender":this.preRender.trigger(t.resize);break;case"alphaTab.partialRenderFinished":this.partialRenderFinished.trigger(t.result);break;case"alphaTab.partialLayoutFinished":this.partialLayoutFinished.trigger(t.result);break;case"alphaTab.renderFinished":this.renderFinished.trigger(t.result);break;case"alphaTab.postRenderFinished":this.boundsLookup=ji.fromJson(t.boundsLookup,this._api.score),this.boundsLookup.finish(),this.postRenderFinished.trigger();break;case"alphaTab.error":this.error.trigger(t.error);break}}renderScore(e,t){const i=e==null?null:Ft.scoreToJsObject(C.prepareForPostMessage(e));this._worker.postMessage({cmd:"alphaTab.renderScore",score:i,trackIndexes:C.prepareForPostMessage(t),fontSizes:Li.FontSizeLookupTables})}}class Yv{constructor(e,t,i,a){this.cursorWrapper=e,this.barCursor=t,this.beatCursor=i,this.selectionWrapper=a}}class ph{static init(){var e;ph._isRegistered||(ph._isRegistered=!0,registerProcessor("alphatab",(e=class extends AudioWorkletProcessor{constructor(i){super(i),this._outputBuffer=new Float32Array(0),this._bufferCount=0,this._requestedBufferCount=0,this._isStopped=!1,E.debug("WebAudio","creating processor"),this._bufferCount=Math.floor(i.processorOptions.bufferTimeInMilliseconds*sampleRate/1e3/e.BufferSize),this._circularBuffer=new Ck(e.BufferSize*this._bufferCount),this.port.onmessage=this.handleMessage.bind(this)}handleMessage(i){const a=i.data;switch(a.cmd){case lt.CmdOutputAddSamples:const r=a.samples;this._circularBuffer.write(r,0,r.length),this._requestedBufferCount--;break;case lt.CmdOutputResetSamples:this._circularBuffer.clear();break;case lt.CmdOutputStop:this._isStopped=!0;break}}process(i,a,n){if(a.length!==1&&a[0].length!==2)return!1;const r=a[0][0],o=a[0][1];if(!r||!o)return!0;const l=r.length+o.length;let h=this._outputBuffer;h.length!==l&&(h=new Float32Array(l),this._outputBuffer=h);const c=this._circularBuffer.read(h,0,Math.min(h.length,this._circularBuffer.count));let d=0;const f=Math.min(r.length,c);for(let p=0;p<f;p++)r[p]=h[d++],o[p]=h[d++];if(c<r.length)for(let p=c;p<r.length;p++)r[p]=0,o[p]=0;return this.port.postMessage({cmd:lt.CmdOutputSamplesPlayed,samples:c/te.AudioChannels}),this.requestBuffers(),this._circularBuffer.count>0||!this._isStopped}requestBuffers(){const i=this._bufferCount/2|0,a=i*e.BufferSize;if(this._circularBuffer.count+this._requestedBufferCount*e.BufferSize<a){for(let r=0;r<i;r++)this.port.postMessage({cmd:lt.CmdOutputSampleRequest});this._requestedBufferCount+=i}}},e.BufferSize=4096,e)))}}ph._isRegistered=!1;class Xv extends Zs{constructor(e){super(),this._worklet=null,this._bufferTimeInMilliseconds=0,this._settings=e}open(e){super.open(e),this._bufferTimeInMilliseconds=e,this.onReady()}play(){super.play();const e=this._context;C.createAudioWorklet(e,this._settings).then(()=>{this._worklet=new AudioWorkletNode(e,"alphatab",{numberOfOutputs:1,outputChannelCount:[2],processorOptions:{bufferTimeInMilliseconds:this._bufferTimeInMilliseconds}}),this._worklet.port.onmessage=this.handleMessage.bind(this),this._source.connect(this._worklet),this._source.start(0),this._worklet.connect(e.destination)},t=>{E.error("WebAudio",`Audio Worklet creation failed: reason=${t}`)})}handleMessage(e){const t=e.data;switch(t.cmd){case lt.CmdOutputSamplesPlayed:this.onSamplesPlayed(t.samples);break;case lt.CmdOutputSampleRequest:this.onSampleRequest();break}}pause(){super.pause(),this._worklet&&(this._worklet.port.postMessage({cmd:lt.CmdOutputStop}),this._worklet.port.onmessage=null,this._worklet.disconnect()),this._worklet=null}addSamples(e){var t;(t=this._worklet)==null||t.port.postMessage({cmd:lt.CmdOutputAddSamples,samples:C.prepareForPostMessage(e)})}resetSamples(){var e;(e=this._worklet)==null||e.port.postMessage({cmd:lt.CmdOutputResetSamples})}}class qv extends ba{constructor(e,t,i){super(e),this._xscale=t,this._yscale=i}get width(){return this.element.offsetWidth/this._xscale}set width(e){this.element.style.width=`${e*this._xscale}px`}get height(){return this.element.offsetHeight/this._yscale}set height(e){e>=0?this.element.style.height=`${e*this._yscale}px`:this.element.style.height="100%"}setBounds(e,t,i,a){Number.isNaN(e)&&(e=this.lastBounds.x),Number.isNaN(t)&&(t=this.lastBounds.y),Number.isNaN(i)?i=this.lastBounds.w:i=i/this._xscale,Number.isNaN(a)?a=this.lastBounds.h:a=a/this._yscale,this.element.style.transform=`translate(${e}px, ${t}px) scale(${i}, ${a})`,this.element.style.transformOrigin="top left",this.lastBounds.x=e,this.lastBounds.y=t,this.lastBounds.w=i,this.lastBounds.h=a}}class Jv{constructor(){this.sampleRate=44100,this._updateInterval=0,this.ready=new Bt,this.samplesPlayed=new we,this.timeUpdate=new we,this.sampleRequest=new Bt}get backingTrackDuration(){const e=this.audioElement.duration??0;return Number.isFinite(e)?e*1e3:0}get playbackRate(){return this.audioElement.playbackRate}set playbackRate(e){this.audioElement.playbackRate=e}get masterVolume(){return this.audioElement.volume}set masterVolume(e){this.audioElement.volume=e}seekTo(e){this.audioElement.currentTime=e/1e3}loadBackingTrack(e){var a;(a=this.audioElement)!=null&&a.src&&URL.revokeObjectURL(this.audioElement.src);const t=new Blob([e.rawAudioFile]),i=this.audioElement.playbackRate;this.audioElement.src=URL.createObjectURL(t),this.audioElement.playbackRate=i}open(e){const t=document.createElement("audio");t.style.display="none",document.body.appendChild(t),t.addEventListener("seeked",()=>{this.updatePosition()}),t.addEventListener("timeupdate",()=>{this.updatePosition()}),this.audioElement=t,this.ready.trigger()}updatePosition(){const e=this.audioElement.currentTime*1e3;this.timeUpdate.trigger(e)}play(){this.audioElement.play(),this._updateInterval=window.setInterval(()=>{this.updatePosition()},50)}destroy(){const e=this.audioElement;e&&document.body.removeChild(e)}pause(){this.audioElement.pause(),window.clearInterval(this._updateInterval)}addSamples(e){}resetSamples(){}activate(){}async enumerateOutputDevices(){return Hi.enumerateOutputDevices()}async setOutputDevice(e){await Hi.checkSinkIdSupport()&&(e?await this.audioElement.setSinkId(e.deviceId):await this.audioElement.setSinkId(""))}async getOutputDevice(){if(!await Hi.checkSinkIdSupport())return null;const e=this.audioElement.sinkId;if(typeof e!="string"||e===""||e==="default")return null;let t=Hi.findKnownDevice(e);if(t)return t;const i=await this.enumerateOutputDevices();return t=i.find(a=>a.deviceId===e),t||(E.warning("WebAudio","Could not find output device in device list",e,i),null)}}class sd{constructor(e,t){this._promise=null,this._exporterId=sd._nextExporterId++,this._worker=e,this._ownsWorker=t}async initialize(e,t,i,a){const n=this.handleWorkerMessage.bind(this);this._worker.worker.addEventListener("message",n,!1),this._unsubscribe=()=>{this._worker.worker.removeEventListener("message",n,!1)},this._promise=Promise.withResolvers(),this._worker.worker.postMessage({cmd:"alphaSynth.exporter.initialize",exporterId:this._exporterId,options:C.prepareForPostMessage(e),midi:Ft.midiFileToJsObject(C.prepareForPostMessage(t)),syncPoints:C.prepareForPostMessage(i),transpositionPitches:C.prepareForPostMessage(a)}),await this._promise.promise}handleWorkerMessage(e){var a,n,r,o;const t=e.data;if(t.exporterId!==this._exporterId)return;switch(t.cmd){case"alphaSynth.exporter.initialized":(a=this._promise)==null||a.resolve(null),this._promise=null;break;case"alphaSynth.exporter.error":(n=this._promise)==null||n.reject(t.error),this._promise=null;break;case"alphaSynth.exporter.rendered":(r=this._promise)==null||r.resolve(t.chunk),this._promise=null;break;case"alphaSynth.destroyed":(o=this._promise)==null||o.reject(new We(Ve.General,"Worker was destroyed")),this._promise=null;break}}async render(e){if(this._promise)throw new We(Ve.General,"There is already an ongoing operation, wait for initialize to complete before requesting render");return this._promise=Promise.withResolvers(),this._worker.worker.postMessage({cmd:"alphaSynth.exporter.render",exporterId:this._exporterId,milliseconds:e}),await this._promise.promise}destroy(){this._worker.worker.postMessage({cmd:"alphaSynth.exporter.destroy",exporterId:this._exporterId}),this._unsubscribe(),this._ownsWorker&&this._worker.destroy()}[Symbol.dispose](){this.destroy()}}sd._nextExporterId=1;var ga;(function(s){s[s.LayoutDone=0]="LayoutDone",s[s.RenderRequested=1]="RenderRequested",s[s.RenderDone=2]="RenderDone",s[s.Detached=3]="Detached"})(ga||(ga={}));class En{get resizeThrottle(){return 10}get canRender(){return this.areAllFontsLoaded()}areAllFontsLoaded(){let e=!1;for(const t of this._fontCheckers.values())t.isFontLoaded||(e=!0);return e?!1:(E.debug("Font",`All fonts loaded: ${this._fontCheckers.size}`),!0)}onFontLoaded(e){Li.generateFontLookup(e),this.areAllFontsLoaded()&&this.canRenderChanged.trigger()}constructor(e){if(this._fontCheckers=new Map,this._contents=null,this._file=null,this._totalResultCount=0,this._initialTrackIndexes=null,this._barToElementLookup=new Map,this._resultIdToElementLookup=new Map,this.rootContainerBecameVisible=new Bt,this.canRenderChanged=new Bt,this._highlightedElements=[],this._scrollContainer=null,C.webPlatform!==Yi.Browser&&C.webPlatform!==Yi.BrowserModule)throw new We(Ve.General,"Usage of AlphaTabApi is only possible in browser environments. For usage in node use the Low Level APIs");e.classList.add("alphaTab"),this.rootContainer=new ba(e),this.areWorkersSupported="Worker"in window,this._intersectionObserver=new IntersectionObserver(this.onElementVisibilityChanged.bind(this),{threshold:[0,.01,1]}),this._intersectionObserver.observe(e)}onElementVisibilityChanged(e){for(const t of e){const i=t.target;if(i===this.rootContainer.element)t.isIntersecting&&(this.rootContainerBecameVisible.trigger(),this._intersectionObserver.unobserve(this.rootContainer.element));else if("layoutResultId"in i&&this._api.settings.core.enableLazyLoading){const a=i;t.isIntersecting?a.renderedResultId!==a.layoutResultId?this._resultIdToElementLookup.has(a.layoutResultId)?a.resultState!==ga.RenderRequested&&(a.resultState=ga.RenderRequested,this._api.renderer.renderResult(a.layoutResultId)):i.replaceChildren():a.resultState===ga.Detached&&(i.replaceChildren(...a.renderedResult),a.resultState=ga.RenderDone):a.resultState===ga.RenderDone&&(a.resultState=ga.Detached,a.replaceChildren())}}}createWorkerRenderer(){return new Uv(this._api,this._api.settings)}initialize(e,t){this._api=e;let i;t instanceof sr?i=t:i=Ft.jsObjectToSettings(t);const a=this.getDataAttributes();ir.fromJson(i,a),i.notation.notationMode===ai.SongBook&&i.setSongBookModeSettings(),e.settings=i,this.setupFontCheckers(i),this._initialTrackIndexes=this.parseTracks(i.core.tracks),this._contents="";const n=e.container;i.core.tex&&(this._contents=n.element.innerHTML,n.element.innerHTML=""),this.createStyleElements(i),this._file=i.core.file}setupFontCheckers(e){this.registerFontChecker(e.display.resources.copyrightFont),this.registerFontChecker(e.display.resources.effectFont),this.registerFontChecker(e.display.resources.fingeringFont),this.registerFontChecker(e.display.resources.graceFont),this.registerFontChecker(e.display.resources.markerFont),this.registerFontChecker(e.display.resources.tablatureFont),this.registerFontChecker(e.display.resources.titleFont),this.registerFontChecker(e.display.resources.wordsFont),this.registerFontChecker(e.display.resources.barNumberFont),this.registerFontChecker(e.display.resources.fretboardNumberFont),this.registerFontChecker(e.display.resources.subTitleFont)}registerFontChecker(e){if(!this._fontCheckers.has(e.families.join(", "))){const t=new Wy(e.families);this._fontCheckers.set(e.families.join(", "),t),t.fontLoaded.on(this.onFontLoaded.bind(this)),t.checkForFontAvailability()}}destroy(){this.rootContainer.element.innerHTML="";const e=this._webFont;e.usages--,e.usages<=0&&(e.element.remove(),En._registeredWebFonts.delete(e.hash))}createCanvasElement(){const e=document.createElement("div");return e.classList.add("at-surface",`at${this._webFont.fontSuffix}`),e.style.fontSize="0",e.style.overflow="hidden",e.style.lineHeight="0",e.style.position="relative",new ba(e)}triggerEvent(e,t,i=null,a){const n=e.element;t=`alphaTab.${t}`;const r=document.createEvent("CustomEvent"),o=a?a.mouseEvent:null;if(r.initCustomEvent(t,!1,!1,i),o&&(r.originalEvent=o),n.dispatchEvent(r),window&&"jQuery"in window){const l=window.jQuery,h=[];h.push(i),o&&h.push(o),l(n).trigger(t,h)}}load(e,t,i){if(e instanceof fn)return t(e),!0;if(e instanceof ArrayBuffer){const a=new Uint8Array(e);return t(fo.loadScoreFromBytes(a,this._api.settings)),!0}return e instanceof Uint8Array?(t(fo.loadScoreFromBytes(e,this._api.settings)),!0):typeof e=="string"?(fo.loadScoreAsync(e,t,i,this._api.settings),!0):!1}loadSoundFont(e,t){return this._api.player?e instanceof ArrayBuffer?(this._api.player.loadSoundFont(new Uint8Array(e),t),!0):e instanceof Uint8Array?(this._api.player.loadSoundFont(e,t),!0):typeof e=="string"?(this._api.loadSoundFontFromUrl(e,t),!0):!1:!1}initialRender(){this._api.renderer.preRender.on(t=>{this._totalResultCount=0,this._resultIdToElementLookup.clear(),this._barToElementLookup.clear()});const e=()=>{this._api.renderer.width=this.rootContainer.width|0,this._api.renderer.updateSettings(this._api.settings),this._contents?(this._api.tex(this._contents,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null):this._file&&fo.loadScoreAsync(this._file,t=>{this._api.renderScore(t,this._initialTrackIndexes??void 0),this._initialTrackIndexes=null},t=>{this._api.onError(t)},this._api.settings)};this.rootContainer.isVisible?e():this.rootContainerBecameVisible.on(e)}createStyleElements(e){const t=this._api.container.element.ownerDocument;En.createSharedStyleElement(t);const i=e.core.smuflFontSources??Jg.buildDefaultSmuflFontSources(e.core.fontDirectory),a=En.cyrb53(i.values()),n=En._registeredWebFonts;if(n.has(a)){const p=n.get(a);p.usages++,p.checker.fontLoaded.on(this.onFontLoaded.bind(this)),this._webFont=p;return}const r=n.size===0?"":String(n.size),o=`alphaTab${r}`,l=Array.from(i.entries()).map(p=>`url(${JSON.stringify(p[1])}) format('${En.cssFormat(p[0])}')`).join(","),h=`
            @font-face {
                font-display: block;
                font-family: '${o}';
                src: ${l};
                font-weight: normal;
                font-style: normal;
            }
            .at-surface.at${r} .at {
                font-family: '${o}';
                speak: none;
                font-style: normal;
                font-weight: normal;
                font-variant: normal;
                text-transform: none;
                line-height: 1;
                line-height: 1;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
                font-size: ${C.MusicFontSize}px;
                overflow: visible !important;
            }`,c=t.createElement("style");c.id=`alphaTabStyle${r}`,c.innerHTML=h,t.getElementsByTagName("head").item(0).appendChild(c);const d=new Wy([o]);d.fontLoaded.on(this.onFontLoaded.bind(this)),this._fontCheckers.set(o,d),d.checkForFontAvailability(),e.display.resources.smuflFont=new ge(o,C.MusicFontSize,rt.Plain,Xi.Regular);const f={hash:a,element:c,fontSuffix:r,usages:1,checker:d};n.set(a,f),this._webFont=f}static cssFormat(e){switch(e){case Js.EmbeddedOpenType:return"embedded-opentype";case Js.Woff:return"woff";case Js.Woff2:return"woff2";case Js.OpenType:return"opentype";case Js.TrueType:return"truetype";case Js.Svg:return"svg"}}static cyrb53(e,t=0){let i=3735928559^t,a=1103547991^t;for(const n of e)for(let r=0;r<n.length;r++){const o=n.charCodeAt(r);i=Math.imul(i^o,2654435761),a=Math.imul(a^o,1597334677)}return i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(a^a>>>13,3266489909),a=Math.imul(a^a>>>16,2246822507),a^=Math.imul(i^i>>>13,3266489909),4294967296*(2097151&a)+(i>>>0)}static createSharedStyleElement(e){let t=e.getElementById("alphaTabStyle");if(!t){t=document.createElement("style"),t.id="alphaTabStyleShared";const i=`
                .at-surface * {
                    cursor: default;
                    vertical-align: top;
                    overflow: visible;
                }
                .at-surface-svg text {
                    dominant-baseline: central;
                    white-space:pre;
                }`;t.innerHTML=i,document.getElementsByTagName("head").item(0).appendChild(t)}}parseTracks(e){if(!e)return[];const t=[];if(typeof e=="string")try{if(e==="all")return[-1];e=JSON.parse(e)}catch{e=[0]}if(typeof e=="number")t.push(e);else if("length"in e){const i=e.length,a=e;for(let n=0;n<i;n++){const r=a[n];let o=0;typeof r=="number"?o=r:"index"in r?o=r.index:o=Number.parseInt(r.toString()),(o>=0||o===-1)&&t.push(o)}}else"index"in e&&t.push(e.index);return t}getDataAttributes(){const e=new Map,t=this._api.container.element;if(t.dataset)for(const i of Object.keys(t.dataset)){let a=t.dataset[i];try{a=JSON.parse(a)}catch{a===""&&(a=null)}e.set(i,a)}else for(let i=0;i<t.attributes.length;i++){const a=t.attributes.item(i),n=a.nodeName;if(n.startsWith("data-")){const r=n.substr(5).split("-");let o=r[0];for(let h=1;h<r.length;h++)o+=r[h].substr(0,1).toUpperCase()+r[h].substr(1);let l=a.nodeValue;try{l=JSON.parse(l)}catch{l===""&&(l=null)}e.set(o,l)}}return e}beginUpdateRenderResults(e){if(!this._resultIdToElementLookup.has(e.id))return;const t=this._resultIdToElementLookup.get(e.id),i=e.renderResult;typeof i=="string"?t.innerHTML=i:"nodeType"in i&&t.replaceChildren(i),t.resultState=ga.RenderDone,t.renderedResultId=e.id,t.renderedResult=Array.from(t.children)}beginAppendRenderResults(e){const t=this._api.canvasElement.element;if(e){let i;this._totalResultCount<t.childElementCount?i=t.childNodes.item(this._totalResultCount):(i=document.createElement("div"),t.appendChild(i)),i.style.zIndex="1",i.style.position="absolute",i.style.left=`${e.x}px`,i.style.top=`${e.y}px`,i.style.width=`${e.width}px`,i.style.height=`${e.height}px`,i.style.display="inline-block",i.layoutResultId=e.id,i.resultState=ga.LayoutDone,i.renderedResultId=void 0,i.renderedResult=void 0,this._resultIdToElementLookup.set(e.id,i);for(let a=e.firstMasterBarIndex;a<=e.lastMasterBarIndex;a++)a>=0&&this._barToElementLookup.set(a,i);this._api.settings.core.enableLazyLoading&&(this._intersectionObserver.unobserve(i),this._intersectionObserver.observe(i)),this._totalResultCount++}else for(;t.childElementCount>this._totalResultCount;)this._api.settings.core.enableLazyLoading&&this._intersectionObserver.unobserve(t.lastChild),t.removeChild(t.lastElementChild)}createWorkerPlayer(){let e=null;const t="ScriptProcessorNode"in window;return window.isSecureContext&&"AudioWorkletNode"in window&&this._api.settings.player.outputMode===fh.WebAudioAudioWorklets?(E.debug("Player","Will use webworkers for synthesizing and web audio api with worklets for playback"),e=new sf(new Xv(this._api.settings),this._api.settings)):t&&(E.debug("Player","Will use webworkers for synthesizing and web audio api with ScriptProcessor for playback"),e=new sf(new Gv,this._api.settings)),e?e.ready.on(()=>{this._api.settings.player.soundFont&&this._api.loadSoundFontFromUrl(this._api.settings.player.soundFont,!1)}):E.error("Player","Player requires webworkers and web audio api, browser unsupported",null),e}createWorkerAudioExporter(e){const t=e===null||!(e instanceof sf);return t&&(e=this.createWorkerPlayer()),new sd(e,t)}beginInvoke(e){window.requestAnimationFrame(()=>{e()})}highlightElements(e,t){const i=this._barToElementLookup.get(t);if(i){const a=i.getElementsByClassName(e);for(let n=0;n<a.length;n++)a.item(n).classList.add("at-highlight"),this._highlightedElements.push(a.item(n))}}removeHighlights(){const e=this._highlightedElements;if(e){for(const t of e)t.classList.remove("at-highlight");this._highlightedElements=[]}}destroyCursors(){const e=this._api.container.element,t=e.querySelector(".at-cursors");e.removeChild(t)}createCursors(){const e=this._api.container.element,t=document.createElement("div");t.classList.add("at-cursors");const i=document.createElement("div");i.classList.add("at-selection");const a=this.createScalingElement(),n=this.createScalingElement(),r=a.element;r.classList.add("at-cursor-bar");const o=n.element;return o.classList.add("at-cursor-beat"),e.style.position="relative",e.style.textAlign="left",t.style.position="absolute",t.style.zIndex="1000",t.style.display="inline",t.style.pointerEvents="none",i.style.position="absolute",r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.willChange="transform",a.width=1,a.height=1,a.setBounds(0,0,1,1),o.style.position="absolute",o.style.transition="all 0s linear",o.style.left="0",o.style.top="0",o.style.willChange="transform",n.width=3,n.height=1,n.setBounds(0,0,1,1),e.insertBefore(t,e.firstChild),t.appendChild(i),t.appendChild(r),t.appendChild(o),new Yv(new ba(t),a,n,new ba(i))}getOffset(e,t){const i=t.element,a=i.getBoundingClientRect();let n=a.top+i.ownerDocument.defaultView.pageYOffset,r=a.left+i.ownerDocument.defaultView.pageXOffset;if(e){const l=e.element,h=l.nodeName.toLowerCase();if(h!=="html"&&h!=="body"){const c=this.getOffset(null,e);n=n+l.scrollTop-c.y,r=r+l.scrollLeft-c.x}}const o=new hi;return o.x=r,o.y=n,o.w=a.width,o.h=a.height,o}getScrollContainer(){if(this._scrollContainer)return this._scrollContainer;let e=typeof this._api.settings.player.scrollElement=="string"?document.querySelector(this._api.settings.player.scrollElement):this._api.settings.player.scrollElement;const t=e.nodeName.toLowerCase();return(t==="html"||t==="body")&&("scrollingElement"in document?e=document.scrollingElement:navigator.userAgent.indexOf("WebKit")!==-1?e=document.body:e=document.documentElement),this._scrollContainer=new ba(e),this._scrollContainer}createSelectionElement(){return this.createScalingElement()}createScalingElement(){const e=document.createElement("div");e.style.position="absolute";const t=new qv(e,100,100);return t.width=1,t.height=1,t.setBounds(0,0,1,1),t}scrollToY(e,t,i){this.internalScrollToY(e.element,t,i)}scrollToX(e,t,i){this.internalScrollToX(e.element,t,i)}internalScrollToY(e,t,i){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({top:t,behavior:"smooth"});else{const a=e.scrollTop,n=t-a;let r=0;const o=l=>{r===0&&(r=l);const h=l-r,c=Math.min(h/i,1);e.scrollTop=a+n*c|0,h<i&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}internalScrollToX(e,t,i){if(this._api.settings.player.nativeBrowserSmoothScroll)e.scrollTo({left:t,behavior:"smooth"});else{const a=e.scrollLeft,n=t-a;let r=0;const o=l=>{r===0&&(r=l);const h=l-r,c=Math.min(h/i,1);e.scrollLeft=a+n*c|0,h<i&&window.requestAnimationFrame(o)};window.requestAnimationFrame(o)}}createBackingTrackPlayer(){return new vk(new Jv,this._api.settings.player.bufferTimeInMilliseconds)}}En._registeredWebFonts=new Map;class Qv{constructor(e,t){this.loaded=e,this.total=t}}class Og extends Wv{constructor(e,t){super(new En(e),t),this.soundFontLoad=new we}tex(e,t){const i=this.uiFacade;super.tex(e,i.parseTracks(t))}print(e,t=null){const i=window.open("","","width=0,height=0"),a=i.document.createElement("div");e?a.style.width=e:this.settings.display.layoutMode===nn.Horizontal?a.style.width="297mm":a.style.width="210mm",i.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <style>
            .at-surface {
                width: auto !important;
                height: auto !important;
            }
            .at-surface > div {
                position: relative!important;
                left: auto !important;
                top: auto !important;
                break-inside: avoid;
            }
            </style>
          </head>
          <body></body>
        </html>
        `);const n=this.score;n&&(n.artist&&n.title?i.document.title=`${n.title} - ${n.artist}`:n.title&&(i.document.title=`${n.title}`)),i.document.body.appendChild(a);const r=typeof window.screenLeft<"u"?window.screenLeft:window.left,o=typeof window.screenTop<"u"?window.screenTop:window.top,l="innerWidth"in window?window.innerWidth:"clientWidth"in document.documentElement?document.documentElement.clientWidth:window.screen.width,h="innerHeight"in window?window.innerHeight:"clientHeight"in document.documentElement?document.documentElement.clientHeight:window.screen.height,c=a.offsetWidth+50,d=window.innerHeight,f=(l/2|0)-(c/2|0)+r,p=(h/2|0)-(d/2|0)+o;i.resizeTo(c,d),i.moveTo(f,p),i.focus();const g=Ft.jsObjectToSettings(Ft.settingsToJsObject(this.settings));g.core.enableLazyLoading=!1,g.core.useWorkers=!0,g.core.file=null,g.core.tracks=null,g.player.enableCursor=!1,g.player.playerMode=Pi.Disabled,g.player.enableElementHighlighting=!1,g.player.enableUserInteraction=!1,g.player.soundFont=null,g.display.scale=.8,g.display.stretchForce=.8,ir.fromJson(g,t);const m=new Og(a,g);i.onunload=()=>{m.destroy()},m.renderer.postRenderFinished.on(()=>{i.print()}),m.renderTracks(this.tracks)}downloadMidi(e=Ao.SingleTrackMultiChannel){if(!this.score)return;const t=new Za;t.format=e;const i=new ra(t,!0);new ue(this.score,this.settings,i).generate();const n=t.toBinary(),r=this.score.title?`${this.score.title}.mid`:"File.mid",o=document.createElement("a");o.download=r;const l=new Blob([n],{type:"audio/midi"}),h=URL.createObjectURL(l);o.href=h,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o)}changeTrackMute(e,t){const i=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackMute(i,t)}changeTrackSolo(e,t){const i=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackSolo(i,t)}changeTrackVolume(e,t){const i=this.trackIndexesToTracks(this.uiFacade.parseTracks(e));super.changeTrackVolume(i,t)}trackIndexesToTracks(e){if(!this.score)return[];const t=[];if(e.length===1&&e[0]===-1)for(const i of this.score.tracks)t.push(i);else for(const i of e)i>=0&&i<this.score.tracks.length&&t.push(this.score.tracks[i]);return t}loadSoundFontFromUrl(e,t){const i=this.player;if(!i)return;E.debug("AlphaSynth",`Start loading Soundfont from url ${e}`);const a=new XMLHttpRequest;a.open("GET",e,!0,null,null),a.responseType="arraybuffer",a.onload=n=>{const r=new Uint8Array(a.response);this.loadSoundFont(r,t)},a.onerror=n=>{E.error("AlphaSynth",`Loading failed: ${n.message}`),i.soundFontLoadFailed.trigger(new za(n.message,a))},a.onprogress=n=>{E.debug("AlphaSynth",`Soundfont downloading: ${n.loaded}/${n.total} bytes`);const r=new Qv(n.loaded,n.total);this.soundFontLoad.trigger(r),this.uiFacade.triggerEvent(this.container,"soundFontLoad",r)},a.send()}}class zy{constructor(){this._initListeners=[]}exec(e,t,i){if(typeof t!="string"&&(i=[t],t="init"),t.charCodeAt(0)===95||t==="exec")return null;const a=new jQuery(e),n=a.data("alphaTab");if(t==="destroy"&&!n)return null;if(t!=="init"&&!n)throw new Error("alphaTab not initialized");const r=this[t];if(r){const o=[a,n].concat(i);return r.apply(this,o)}return E.error("Api",`Method '${t}' does not exist on jQuery.alphaTab`),null}init(e,t,i){if(!t){t=new Og(e[0],i),e.data("alphaTab",t);for(const a of this._initListeners)a(e,t,i)}}destroy(e,t){e.removeData("alphaTab"),t.destroy()}print(e,t,i,a){t.print(i,a)}load(e,t,i,a){return t.load(i,a)}render(e,t){t.render()}renderScore(e,t,i,a){t.renderScore(i,a)}renderTracks(e,t,i){t.renderTracks(i)}invalidate(e,t){t.render()}tex(e,t,i,a){t.tex(i,a)}muteTrack(e,t,i,a){t.changeTrackMute(i,a)}soloTrack(e,t,i,a){t.changeTrackSolo(i,a)}trackVolume(e,t,i,a){t.changeTrackVolume(i,a)}loadSoundFont(e,t,i,a){t.loadSoundFont(i,a)}resetSoundFonts(e,t){t.resetSoundFonts()}pause(e,t){t.pause()}play(e,t){return t.play()}playPause(e,t){t.playPause()}stop(e,t){t.stop()}api(e,t){return t}player(e,t){return t.player}isReadyForPlayback(e,t){return t.isReadyForPlayback}playerState(e,t){return t.playerState}masterVolume(e,t,i){return typeof i=="number"&&(t.masterVolume=i),t.masterVolume}metronomeVolume(e,t,i){return typeof i=="number"&&(t.metronomeVolume=i),t.metronomeVolume}countInVolume(e,t,i){return typeof i=="number"&&(t.countInVolume=i),t.countInVolume}midiEventsPlayedFilter(e,t,i){return Array.isArray(i)&&(t.midiEventsPlayedFilter=i),t.midiEventsPlayedFilter}playbackSpeed(e,t,i){return typeof i=="number"&&(t.playbackSpeed=i),t.playbackSpeed}tickPosition(e,t,i){return typeof i=="number"&&(t.tickPosition=i),t.tickPosition}timePosition(e,t,i){return typeof i=="number"&&(t.timePosition=i),t.timePosition}loop(e,t,i){return typeof i=="boolean"&&(t.isLooping=i),t.isLooping}renderer(e,t){return t.renderer}score(e,t){return t.score}settings(e,t){return t.settings}tracks(e,t){return t.tracks}_oninit(e){this._initListeners.push(e)}static restore(e){new jQuery(e).empty().removeData("alphaTab")}}class Ig{constructor(){this.buffer="",this._currentPath="",this._currentPathIsEmpty=!0,this.scale=1,this.color=new Pe(255,255,255,255),this.lineWidth=1,this.font=new ge("Arial",10,rt.Plain),this.textAlign=Q.Left,this.textBaseline=he.Top}destroy(){}beginRender(e,t){this.scale=this.settings.display.scale,this.buffer=`<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="${e|0}px" height="${t|0}px" class="at-surface-svg">
`,this._currentPath="",this._currentPathIsEmpty=!0,this.textBaseline=he.Top}beginGroup(e){this.buffer+=`<g class="${e}">`}endGroup(){this.buffer+="</g>"}endRender(){return this.buffer+="</svg>",this.buffer}fillRect(e,t,i,a){i>0&&(this.buffer+=`<rect x="${e*this.scale|0}" y="${t*this.scale|0}" width="${i*this.scale}" height="${a*this.scale}" fill="${this.color.rgba}" />
`)}strokeRect(e,t,i,a){const n=this.lineWidth*this.scale%2===0?0:.5;this.buffer+=`<rect x="${(e*this.scale|0)+n}" y="${(t*this.scale|0)+n}" width="${i*this.scale}" height="${a*this.scale}" stroke="${this.color.rgba}"`,this.lineWidth!==1&&(this.buffer+=` stroke-width="${this.lineWidth*this.scale}"`),this.buffer+=` fill="transparent" />
`}beginPath(){}closePath(){this._currentPath+=" z"}moveTo(e,t){this._currentPath+=` M${e*this.scale},${t*this.scale}`}lineTo(e,t){this._currentPathIsEmpty=!1,this._currentPath+=` L${e*this.scale},${t*this.scale}`}quadraticCurveTo(e,t,i,a){this._currentPathIsEmpty=!1,this._currentPath+=` Q${e*this.scale},${t*this.scale},${i*this.scale},${a*this.scale}`}bezierCurveTo(e,t,i,a,n,r){this._currentPathIsEmpty=!1,this._currentPath+=` C${e*this.scale},${t*this.scale},${i*this.scale},${a*this.scale},${n*this.scale},${r*this.scale}`}fillCircle(e,t,i){this._currentPathIsEmpty=!1,e*=this.scale,t*=this.scale,i*=this.scale,this._currentPath+=` M${e-i},${t} A1,1 0 0,0 ${e+i},${t} A1,1 0 0,0 ${e-i},${t} z`,this.fill()}strokeCircle(e,t,i){this._currentPathIsEmpty=!1,e*=this.scale,t*=this.scale,i*=this.scale,this._currentPath+=` M${e-i},${t} A1,1 0 0,0 ${e+i},${t} A1,1 0 0,0 ${e-i},${t} z`,this.stroke()}fill(){this._currentPathIsEmpty||(this.buffer+=`<path d="${this._currentPath}"`,this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),this.buffer+=' style="stroke: none"/>'),this._currentPath="",this._currentPathIsEmpty=!0}stroke(){if(!this._currentPathIsEmpty){let e=`<path d="${this._currentPath}" stroke="${this.color.rgba}"`;(this.lineWidth!==1||this.scale!==1)&&(e+=` stroke-width="${this.lineWidth*this.scale}"`),e+=' style="fill: none" />',this.buffer+=e}this._currentPath="",this._currentPathIsEmpty=!0}fillText(e,t,i){if(e==="")return;let a=`<text x="${t*this.scale|0}" y="${i*this.scale|0}" style='stroke: none; font:${this.font.toCssString(this.settings.display.scale)}; ${this.getSvgBaseLine()}'`;this.color.rgba!=="#000000"&&(a+=` fill="${this.color.rgba}"`),this.textAlign!==Q.Left&&(a+=` text-anchor="${this.getSvgTextAlignment(this.textAlign)}"`),a+=`>${Ig.escapeText(e)}</text>`,this.buffer+=a}static escapeText(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}getSvgTextAlignment(e){switch(e){case Q.Left:return"start";case Q.Center:return"middle";case Q.Right:return"end"}return""}getSvgBaseLine(){switch(this.textBaseline){case he.Top:return"dominant-baseline: hanging";case he.Bottom:return"dominant-baseline: ideographic";default:return""}}measureText(e){return e?Li.measureString(e,this.font.families,this.font.size*this.scale,this.font.style,this.font.weight):new ed(0,0)}onRenderFinished(){return null}beginRotate(e,t,i){this.buffer+=`<g transform="translate(${e*this.scale} ,${t*this.scale}) rotate( ${i})">`}endRotate(){this.buffer+="</g>"}}class Kv extends Ig{fillMusicFontSymbol(e,t,i,a,n){a!==u.None&&this.fillMusicFontSymbolText(e,t,i,`&#${a};`,n)}fillMusicFontSymbols(e,t,i,a,n){let r="";for(const o of a)o!==u.None&&(r+=`&#${o};`);this.fillMusicFontSymbolText(e,t,i,r,n)}fillMusicFontSymbolText(e,t,i,a,n){e*=this.scale,t*=this.scale,this.buffer+=`<g transform="translate(${e} ${t})" class="at" ><text`;const r=this.scale*i;r!==1?this.buffer+=` style="font-size: ${r*100}%; stroke:none"`:this.buffer+=' style="stroke:none"',this.color.rgba!=="#000000"&&(this.buffer+=` fill="${this.color.rgba}"`),n&&(this.buffer+=` text-anchor="${this.getSvgTextAlignment(Q.Center)}"`),this.buffer+=`>${a}</text></g>`}}class Vh{constructor(){this.isInsideBracket=!0,this.isRelevantForBoundsLookup=!0,this.hideOnMultiTrack=!1,this.hideOnPercussionTrack=!1}canCreate(e,t){return!this.hideOnPercussionTrack||!t.isPercussion}}var Te;(function(s){s[s.PreNotes=0]="PreNotes",s[s.OnNotes=1]="OnNotes",s[s.MiddleNotes=2]="MiddleNotes",s[s.Stem=3]="Stem",s[s.PostNotes=4]="PostNotes",s[s.EndBeat=5]="EndBeat"})(Te||(Te={}));class da extends pt{constructor(){super(...arguments),this.glyphs=null}get isEmpty(){return!this.glyphs||this.glyphs.length===0}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}let e=0;for(let t=0,i=this.glyphs.length;t<i;t++){const a=this.glyphs[t];a.renderer=this.renderer,a.doLayout(),e=Math.max(e,a.width)}this.width=e}addGlyph(e){this.glyphs||(this.glyphs=[]),this.renderer&&(e.renderer=this.renderer),this.glyphs.push(e)}paint(e,t,i){const a=this.glyphs;if(!(!a||a.length===0))for(const n of a)n.paint(e+this.x,t+this.y,i)}}class mr extends da{constructor(){super(0,0),this.glyphs=[]}doLayout(){}addGlyph(e){e.x=this.width,e.renderer=this.renderer,e.doLayout(),this.width=e.x+e.width,super.addGlyph(e)}}class Be{static score(e,t,i,a=!1){if(!i.style&&!a)return;const n=Be.scoreDefaultColor(e.settings.display.resources,t);return new qr(e,t,i.style,n)}static scoreColor(e,t,i){const a=Be.scoreDefaultColor(e,t);if(i.style&&i.style.colors.has(t))return i.style.colors.get(t)??a}static scoreDefaultColor(e,t){return e.mainGlyphColor}static bar(e,t,i,a=!1){if(!i.style&&!a)return;let n=e.settings.display.resources.mainGlyphColor;switch(t){case Ee.StandardNotationRepeats:case Ee.GuitarTabsRepeats:case Ee.SlashRepeats:case Ee.NumberedRepeats:case Ee.StandardNotationClef:case Ee.GuitarTabsClef:case Ee.StandardNotationKeySignature:case Ee.NumberedKeySignature:case Ee.StandardNotationTimeSignature:case Ee.GuitarTabsTimeSignature:case Ee.SlashTimeSignature:case Ee.NumberedTimeSignature:break;case Ee.StandardNotationBarLines:case Ee.GuitarTabsBarLines:case Ee.SlashBarLines:case Ee.NumberedBarLines:n=e.settings.display.resources.barSeparatorColor;break;case Ee.StandardNotationBarNumber:case Ee.SlashBarNumber:case Ee.NumberedBarNumber:case Ee.GuitarTabsBarNumber:n=e.settings.display.resources.barNumberColor;break;case Ee.StandardNotationStaffLine:case Ee.GuitarTabsStaffLine:case Ee.SlashStaffLine:case Ee.NumberedStaffLine:n=e.settings.display.resources.staffLineColor;break}return new qr(e,t,i.style,n)}static voice(e,t,i,a=!1){if(!i.style&&!a)return;const n=i.index===0?e.settings.display.resources.mainGlyphColor:e.settings.display.resources.secondaryGlyphColor;return new qr(e,t,i.style,n)}static trackColor(e,t,i){const a=Be.trackDefaultColor(e,t);if(i.style&&i.style.colors.has(t))return i.style.colors.get(t)??a}static trackDefaultColor(e,t){let i=e.mainGlyphColor;switch(t){case Ta.TrackName:case Ta.SystemSeparator:case Ta.StringTuning:break;case Ta.BracesAndBrackets:i=e.barSeparatorColor;break}return i}static track(e,t,i,a=!1){if(!i.style&&!a)return;const n=Be.trackDefaultColor(e.settings.display.resources,t);return new qr(e,t,i.style,n)}static beatColor(e,t,i){const a=Be.beatDefaultColor(e,t,i);if(i.style&&i.style.colors.has(t))return i.style.colors.get(t)??a}static beatDefaultColor(e,t,i){return i.voice.index===0?e.mainGlyphColor:e.secondaryGlyphColor}static beat(e,t,i,a=!1){if(!i.style&&!a)return;const n=Be.beatDefaultColor(e.settings.display.resources,t,i);return new qr(e,t,i.style,n)}static noteColor(e,t,i){const a=Be.noteDefaultColor(e,t,i);if(i.style&&i.style.colors.has(t))return i.style.colors.get(t)??a}static noteDefaultColor(e,t,i){return i.beat.voice.index===0?e.mainGlyphColor:e.secondaryGlyphColor}static note(e,t,i,a=!1){if(!i.style&&!a)return;const n=i.beat.voice.index===0?e.settings.display.resources.mainGlyphColor:e.settings.display.resources.secondaryGlyphColor;return new qr(e,t,i.style,n)}}class qr{constructor(e,t,i,a){this._canvas=e,i&&i.colors.has(t)?(this._previousColor=e.color,e.color=i.colors.get(t)??a):i||(this._previousColor=e.color,e.color=a)}[Symbol.dispose](){this._previousColor&&(this._canvas.color=this._previousColor)}}class Ek extends da{constructor(e,t,i){super(e,t),this.voice=i,this.beatGlyphs=[],this.tupletGroups=[]}scaleToWidth(e){const t=this.renderer.layoutingInfo.spaceToForce(e);this.scaleToForce(t)}scaleToForce(e){this.width=this.renderer.layoutingInfo.calculateVoiceWidth(e);const t=this.renderer.layoutingInfo.buildOnTimePositions(e),i=this.beatGlyphs;for(let a=0,n=i.length;a<n;a++){const r=i[a];switch(r.beat.graceType){case se.None:r.x=t.get(r.beat.absoluteDisplayStart)-r.onTimeX;break;default:const o=r.beat.graceGroup.beats[0].absoluteDisplayStart,l=r.beat.graceGroup.id;if(r.beat.graceGroup.isComplete&&t.has(o)){r.x=t.get(o)-r.onTimeX;const h=this.renderer.layoutingInfo.allGraceRods.get(l),c=r.beat.graceGroup.beats[r.beat.graceGroup.beats.length-1].nextBeat,d=c?this.renderer.layoutingInfo.getPreBeatSize(c)+rs.GraceBeatPadding:0;r.x-=d,r.x-=h[r.beat.graceIndex].postSpringWidth,r.x+=h[r.beat.graceIndex].graceBeatWidth;const f=h[r.beat.graceGroup.beats.length-1];r.x-=f.graceBeatWidth}else{const h=this.renderer.layoutingInfo.incompleteGraceRods.get(l),c=h[r.beat.graceIndex].postSpringWidth-h[r.beat.graceIndex].preSpringWidth;a>0?r.beat.graceIndex===0?r.x=i[a-1].x+i[a-1].width:r.x=i[a-1].x+h[r.beat.graceIndex-1].postSpringWidth-h[r.beat.graceIndex-1].preSpringWidth-c:r.x=-c}break}if(a>0){const o=r.x-i[a-1].x;i[a-1].scaleToWidth(o)}if(a===n-1){const o=this.width-i[i.length-1].x;r.scaleToWidth(o)}}}registerLayoutingInfo(e){const t=this.beatGlyphs;for(const i of t)i.registerLayoutingInfo(e)}applyLayoutingInfo(e){const t=this.beatGlyphs;for(const i of t)i.applyLayoutingInfo(e);this.scaleToForce(Math.max(this.renderer.settings.display.stretchForce,e.minStretchForce))}addGlyph(e){const t=e;e.x=this.beatGlyphs.length===0?0:this.beatGlyphs[this.beatGlyphs.length-1].x+this.beatGlyphs[this.beatGlyphs.length-1].width,e.renderer=this.renderer,e.doLayout(),this.beatGlyphs.push(t),this.width=e.x+e.width,t.beat.hasTuplet&&t.beat.tupletGroup.beats[0].id===t.beat.id&&this.tupletGroups.push(t.beat.tupletGroup)}doLayout(){}paint(e,t,i){var n;const a=Be.voice(i,rh.Glyphs,this.voice,!0);try{for(let r=0,o=this.beatGlyphs.length;r<o;r++)this.beatGlyphs[r].paint(e+this.x,t+this.y,i)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}Ek.KeySizeBeat="Beat";class $v{constructor(){this.staffId="",this.up=0,this.down=0}}class Zv{constructor(){this.startBeat=null,this.startX=0,this.startY=0,this.endBeat=null,this.endX=0,this.endY=0}calcY(e){return this.startX===this.endX?this.startY:(this.endY-this.startY)/(this.endX-this.startX)*(e-this.startX)+this.startY}}class ha{get isRestBeamHelper(){return this.beats.length===1&&this.beats[0].isRest}hasLine(e,t){return e&&this.beatHasLine(t)||!e&&this.beats.length===1&&this.beatHasLine(t)}beatHasLine(e){return e.duration>w.Whole}hasFlag(e,t){return e&&this.beatHasFlag(t)||!e&&this.beats.length===1&&this.beatHasFlag(this.beats[0])}beatHasFlag(e){return!e.deadSlapped&&!e.isRest&&(e.duration>w.Quarter||e.graceType!==se.None)}constructor(e,t){this._beatLineXPositions=new Map,this._firstNonRestBeat=null,this._lastNonRestBeat=null,this.voice=null,this.beats=[],this.shortestDuration=w.QuadrupleWhole,this.hasTuplet=!1,this.slashBeats=[],this._firstBeatLowestNoteCompareValue=-1,this._firstBeatHighestNoteCompareValue=-1,this._lastBeatLowestNoteCompareValue=-1,this._lastBeatHighestNoteCompareValue=-1,this.lowestNoteInHelper=null,this._lowestNoteCompareValueInHelper=-1,this.highestNoteInHelper=null,this._highestNoteCompareValueInHelper=-1,this.invertBeamDirection=!1,this.preferredBeamDirection=null,this.isGrace=!1,this.minRestLine=null,this.beatOfMinRestLine=null,this.maxRestLine=null,this.beatOfMaxRestLine=null,this.direction=P.Up,this.drawingInfos=new Map,this._staff=e,this._renderer=t,this.beats=[]}getBeatLineX(e,t){return t=t??this.direction,this.hasBeatLineX(e)?t===P.Up?this._beatLineXPositions.get(e.index).up:this._beatLineXPositions.get(e.index).down:0}hasBeatLineX(e){return this._beatLineXPositions.has(e.index)}registerBeatLineX(e,t,i,a){const n=this.getOrCreateBeatPositions(t);n.staffId=e,n.up=i,n.down=a;for(const r of this.drawingInfos.values())r.startBeat===t?r.startX=this.getBeatLineX(t):r.endBeat===t&&(r.endX=this.getBeatLineX(t))}getOrCreateBeatPositions(e){return this._beatLineXPositions.has(e.index)||this._beatLineXPositions.set(e.index,new $v),this._beatLineXPositions.get(e.index)}finish(){this.direction=this.calculateDirection()}calculateDirection(){let e=null;if(this.voice?this.preferredBeamDirection!==null?e=this.preferredBeamDirection:this.voice.index>0?e=this.invert(P.Down):this.voice.bar.isMultiVoice?e=this.invert(P.Up):this.beats[0].graceType!==se.None&&(e=this.invert(P.Up)):e=P.Up,this.highestNoteInHelper&&this.lowestNoteInHelper){const t=this._renderer.getNoteY(this.highestNoteInHelper,$.Center),i=this._renderer.getNoteY(this.lowestNoteInHelper,$.Center);if(e===null){const a=(t+i)/2;e=this.invert(this._renderer.middleYPosition<a?P.Up:P.Down)}this._renderer.completeBeamingHelper(this)}else e=this.invert(P.Up),this._renderer.completeBeamingHelper(this);return e}static computeLineHeightsForRest(e){switch(e){case w.QuadrupleWhole:return[2,2];case w.DoubleWhole:return[2,2];case w.Whole:return[0,1];case w.Half:return[1,0];case w.Quarter:return[3,3];case w.Eighth:return[2,2];case w.Sixteenth:return[2,4];case w.ThirtySecond:return[4,4];case w.SixtyFourth:return[4,6];case w.OneHundredTwentyEighth:return[6,6];case w.TwoHundredFiftySixth:return[6,8]}return[0,0]}applyRest(e,t){if(this._lastNonRestBeat&&e.index>=this._lastNonRestBeat.index||this._firstNonRestBeat&&e.index<=this._firstNonRestBeat.index)return;let i=t,a=t;const n=ha.computeLineHeightsForRest(e.duration);i-=n[0],a+=n[1];const r=this.minRestLine,o=this.maxRestLine;(r===null||r>i)&&(this.minRestLine=i,this.beatOfMinRestLine=e),(o===null||o<a)&&(this.maxRestLine=a,this.beatOfMaxRestLine=e)}invert(e){if(!this.invertBeamDirection)return e;switch(e){case P.Down:return P.Up;default:return P.Down}}checkBeat(e){e.invertBeamDirection&&(this.invertBeamDirection=!0),this.voice||(this.voice=e.voice);let t=!1;if(this.beats.length===0)t=!0;else switch(this.beats[this.beats.length-1].beamingMode){case it.Auto:case it.ForceSplitOnSecondaryToNext:t=ha.canJoin(this.beats[this.beats.length-1],e);break;case it.ForceSplitToNext:t=!1;break;case it.ForceMergeWithNext:t=!0;break}return t&&(this.preferredBeamDirection==null&&e.preferredBeamDirection!==null&&(this.preferredBeamDirection=e.preferredBeamDirection),e.hasTuplet&&(this.hasTuplet=!0),e.graceType!==se.None&&(this.isGrace=!0),e.isRest?this.beats.length===0&&this.beats.push(e):(this.isRestBeamHelper&&(this.beats=[]),this.beats.push(e),this.checkNote(e.minNote),this.checkNote(e.maxNote),this.shortestDuration<e.duration&&(this.shortestDuration=e.duration),this._firstNonRestBeat||(this._firstNonRestBeat=e),this._lastNonRestBeat=e),e.slashed&&this.slashBeats.push(e)),t}checkNote(e){if(!e)return;let t,i;this.voice&&e.isPercussion?(t=-ut.getPercussionLine(this.voice.bar,ut.getNoteValue(e)),i=t):(t=ut.getNoteValue(e),i=t,e.harmonicType!==ae.None&&e.harmonicType!==ae.Natural&&(i=e.realValue-this._staff.displayTranspositionPitch)),this.beats.length===1&&this.beats[0]===e.beat&&((this._firstBeatLowestNoteCompareValue===-1||t<this._firstBeatLowestNoteCompareValue)&&(this._firstBeatLowestNoteCompareValue=t),(this._firstBeatHighestNoteCompareValue===-1||i>this._firstBeatHighestNoteCompareValue)&&(this._firstBeatHighestNoteCompareValue=i)),(this._lastBeatLowestNoteCompareValue===-1||t<this._lastBeatLowestNoteCompareValue)&&(this._lastBeatLowestNoteCompareValue=t),(this._lastBeatHighestNoteCompareValue===-1||i>this._lastBeatHighestNoteCompareValue)&&(this._lastBeatHighestNoteCompareValue=i),(!this.lowestNoteInHelper||t<this._lowestNoteCompareValueInHelper)&&(this.lowestNoteInHelper=e,this._lowestNoteCompareValueInHelper=t),(!this.highestNoteInHelper||i>this._highestNoteCompareValueInHelper)&&(this.highestNoteInHelper=e,this._highestNoteCompareValueInHelper=i)}static canJoin(e,t){if(!e||!t||e.graceType!==t.graceType||e.graceType===se.BendGrace||t.graceType===se.BendGrace||e.deadSlapped||t.deadSlapped)return!1;if(e.graceType!==se.None&&t.graceType!==se.None)return!0;const i=e.voice.bar,a=t.voice.bar;if(i!==a)return!1;const n=e.playbackStart,r=t.playbackStart;if(!ha.canJoinDuration(e.duration)||!ha.canJoinDuration(t.duration))return n===r;if(e.tupletGroup!==t.tupletGroup)return!1;if(e.hasTuplet&&t.hasTuplet&&e.tupletGroup===t.tupletGroup&&e.tupletGroup.isFull)return!0;let o=v.QuarterTime;switch(i.masterBar.timeSignatureDenominator){case 8:i.masterBar.timeSignatureNumerator%3===0&&(o+=v.QuarterTime/2|0);break}const l=(o+n)/o|0|0,h=(o+r)/o|0|0;return l===h}static canJoinDuration(e){switch(e){case w.Whole:case w.Half:case w.Quarter:return!1;default:return!0}}static isFullBarJoin(e,t,i){return V.getIndex(e.duration)-2-i>0&&V.getIndex(t.duration)-2-i>0}get beatOfLowestNote(){return this.lowestNoteInHelper.beat}get beatOfHighestNote(){return this.highestNoteInHelper.beat}isPositionFrom(e,t){return this._beatLineXPositions.has(t.index)?this._beatLineXPositions.get(t.index).staffId===e||!this._beatLineXPositions.get(t.index).staffId:!0}}class jv{constructor(e,t){this.topY=0,this.bottomY=0,this.topY=e,this.bottomY=t}}class eC{constructor(e){this.topY=-1e3,this.bottomY=-1e3,this.slots=[],this.beat=e}addSlot(e,t){if(this.slots.push(new jv(e,t)),this.topY===-1e3)this.topY=e,this.bottomY=t;else{const i=Math.min(e,t),a=Math.max(e,t);i<this.topY&&(this.topY=i),a>this.bottomY&&(this.bottomY=a)}}}class tC{constructor(){this.reservedLayoutAreasByDisplayTime=new Map,this.restDurationsByDisplayTime=new Map}getBeatMinMaxY(){let e=-1e3,t=-1e3;for(const i of this.reservedLayoutAreasByDisplayTime.values())e===-1e3?(e=i.topY,t=i.bottomY):(e>i.topY&&(e=i.topY),t<i.bottomY&&(t=i.bottomY));return e===-1e3?[0,0]:[e,t]}reserveBeatSlot(e,t,i){t!==i&&(this.reservedLayoutAreasByDisplayTime.has(e.displayStart)||this.reservedLayoutAreasByDisplayTime.set(e.displayStart,new eC(e)),this.reservedLayoutAreasByDisplayTime.get(e.displayStart).addSlot(t,i),e.isRest&&this.registerRest(e))}registerRest(e){this.restDurationsByDisplayTime.has(e.displayStart)||this.restDurationsByDisplayTime.set(e.displayStart,new Map),this.restDurationsByDisplayTime.get(e.displayStart).has(e.playbackDuration)||this.restDurationsByDisplayTime.get(e.displayStart).set(e.playbackDuration,e.id)}applyRestCollisionOffset(e,t,i){if(e.voice.index>0&&this.reservedLayoutAreasByDisplayTime.has(e.playbackStart)){const a=ha.computeLineHeightsForRest(e.duration).map(c=>c*i),n=t-a[0],r=t+a[1];let o=n;const l=this.reservedLayoutAreasByDisplayTime.get(e.playbackStart);let h=!1;for(const c of l.slots)if(n>=c.topY&&n<=c.bottomY||r>=c.topY&&r<=c.bottomY){h=!0;break}if(h){e.voice.index===1?o=l.topY-a[1]-a[0]:o=l.bottomY;const c=o+a[0]+a[1],d=i*2,f=Math.ceil(Math.abs(o-n)/d);return l.addSlot(o,c),o<n?f*-d:f*d}}return 0}}class iC{constructor(e){this.beamHelpers=[],this.beamHelperLookup=[],this.preferredBeamDirection=null,this._renderer=e,this.collisionHelper=new tC}initialize(){const e=this._renderer,t=this._renderer.bar;let i=null,a=null;for(let n=0,r=t.voices.length;n<r;n++){const o=t.voices[n];this.beamHelpers.push([]),this.beamHelperLookup.push(new Map);for(let l=0,h=o.beats.length;l<h;l++){const c=o.beats[l];let d;c.graceType!==se.None?d=a:(d=i,a=null),(!d||!d.checkBeat(c))&&(d&&d.finish(),d=new ha(t.staff,e),d.preferredBeamDirection=this.preferredBeamDirection,d.checkBeat(c),c.graceType!==se.None?a=d:i=d,this.beamHelpers[o.index].push(d)),this.beamHelperLookup[o.index].set(c.index,d)}i&&i.finish(),a&&a.finish(),i=null,a=null}}getBeamingHelperForBeat(e){return this.beamHelperLookup[e.voice.index].get(e.index)}}class pi extends cs{constructor(e,t,i){super(e,t),this._textRow=0,this._fretRow=0,this._firstFretSpacing=0,this._chord=i}doLayout(){super.doLayout();const e=this.renderer.resources;this._textRow=e.effectFont.size*1.5,this._fretRow=e.effectFont.size*1.5,this._chord.firstFret>1?this._firstFretSpacing=pi.FretSpacing:this._firstFretSpacing=0,this.height=this._textRow+this._fretRow+pi.Frets*pi.FretSpacing+2*pi.Padding[1],this.width=this._firstFretSpacing+(this._chord.strings.length-1)*pi.StringSpacing+2*pi.Padding[0]}paint(e,t,i){e+=this.x+pi.Padding[0]+this._firstFretSpacing,t+=this.y;const a=pi.StringSpacing,n=pi.FretSpacing,r=this.renderer.resources,o=pi.CircleRadius,l=this.width-2*pi.Padding[0]-this._firstFretSpacing,h=i.textAlign,c=i.textBaseline;i.font=r.effectFont,i.textAlign=Q.Center,i.textBaseline=he.Top,this._chord.showName&&i.fillText(this._chord.name,e+l/2,t+r.effectFont.size/2),t+=this._textRow,i.font=r.fretboardNumberFont,i.textBaseline=he.Middle;for(let f=0;f<this._chord.strings.length;f++){const p=e+f*a,g=t+this._fretRow/2;let m=this._chord.strings[this._chord.strings.length-f-1];m<0?i.fillMusicFontSymbol(p,g,1,u.FretboardX,!0):m===0?i.fillMusicFontSymbol(p,g,1,u.FretboardO,!0):(m-=this._chord.firstFret-1,i.fillText(m.toString(),p,g))}t+=this._fretRow;for(let f=0;f<this._chord.strings.length;f++){const p=e+f*a;i.fillRect(p,t,1,n*pi.Frets+1)}this._chord.firstFret>1&&(i.textAlign=Q.Left,i.fillText(this._chord.firstFret.toString(),e-this._firstFretSpacing,t+n/2)),i.fillRect(e,t-1,l,2);for(let f=0;f<=pi.Frets;f++){const p=t+f*n;i.fillRect(e,p,l,1)}const d=new Map;for(const f of this._chord.barreFrets){const p=[-1,-1];d.set(f-this._chord.firstFret,p)}for(let f=0;f<this._chord.strings.length;f++){let p=this._chord.strings[f];if(p>0){if(p-=this._chord.firstFret,d.has(p)){const T=d.get(p);(T[0]===-1||f<T[0])&&(T[0]=f),(T[1]===-1||f>T[1])&&(T[1]=f)}const g=t+p*n+n/2+.5,m=e+(this._chord.strings.length-f-1)*a;i.fillCircle(m,g,o)}}for(const[f,p]of d){const g=t+f*n+n/2+.5,m=e+(this._chord.strings.length-p[1]-1)*a,T=e+(this._chord.strings.length-p[0]-1)*a;i.fillRect(m,g-o,T-m,o*2)}i.textAlign=h,i.textBaseline=c}}pi.Padding=[5,2];pi.Frets=5;pi.CircleRadius=2.5;pi.StringSpacing=10;pi.FretSpacing=12;class Gy extends da{constructor(e,t,i=Q.Center){super(e,t),this._glyphWidth=0,this.glyphs=[],this._align=i}doLayout(){let e=0;switch(this._align){case Q.Left:e=0;break;case Q.Center:e=(this.width-this._glyphWidth)/2;break;case Q.Right:e=this.width-this._glyphWidth;break}for(const t of this.glyphs)t.x=e,e+=t.width}addGlyphToRow(e){this.glyphs.push(e),this._glyphWidth+=e.width,e.height>this.height&&(this.height=e.height)}}class Wh extends da{constructor(e,t,i=Q.Center){super(e,t),this._rows=[],this.height=0,this.glyphs=[],this._align=i}doLayout(){let e=0,t=0;const i=Wh.Padding;this._rows=[];let a=new Gy(e,t,this._align);a.width=this.width;for(const n of this.glyphs)e+n.width<this.width?(a.addGlyphToRow(n),e+=n.width):(a.isEmpty||(a.doLayout(),this._rows.push(a),t+=a.height+i),e=0,a=new Gy(e,t,this._align),a.width=this.width,a.addGlyphToRow(n),e+=n.width);a.isEmpty||(a.doLayout(),this._rows.push(a),t+=a.height+i),this.height=t}paint(e,t,i){for(const a of this._rows)a.paint(e+this.x,t+this.y,i)}}Wh.Padding=3;class sC extends Wh{addChord(e){if(e.strings.length>0){const t=new pi(0,0,e);t.renderer=this.renderer,t.doLayout(),this.glyphs.push(t)}}paint(e,t,i){var a;if(this.glyphs.length>0){const n=Be.score(i,z.ChordDiagramList,this.renderer.scoreRenderer.score);try{super.paint(e,t,i)}finally{(a=n==null?void 0:n[Symbol.dispose])==null||a.call(n)}}}}class os extends cs{constructor(e,t,i,a,n=Q.Left,r=null,o){super(e,t),this._lineHeights=null,this._lines=i.split(`
`),this.font=a,this.textAlign=n,this.textBaseline=r,this.colorOverride=o}doLayout(){super.doLayout(),this._lineHeights=[];const e=this.renderer.scoreRenderer.canvas;for(const t of this._lines){e.font=this.font;const i=e.measureText(t),a=i.height;this._lineHeights.push(a),this.height+=a,this.width=Math.max(this.width,i.width)}}paint(e,t,i){const a=i.color;i.color=this.colorOverride??a,i.font=this.font;const n=i.textAlign,r=i.textBaseline;i.textAlign=this.textAlign,this.textBaseline!==null&&(i.textBaseline=this.textBaseline);let o=t+this.y;for(let l=0;l<this._lines.length;l++)i.fillText(this._lines[l],e+this.x,o),o+=this._lineHeights[l];i.textAlign=n,i.textBaseline=r,i.color=a}}class aC{get staffId(){return this._factory.staffId}get contentTop(){return this.y+this.staveTop+this.topSpacing+this.topOverflow}get contentBottom(){return this.y+this.topSpacing+this.topOverflow+this.staveBottom}constructor(e,t,i){this._sharedLayoutData=new Map,this.barRenderers=[],this.x=0,this.y=0,this.height=0,this.index=0,this.staffIndex=0,this.isFirstInSystem=!1,this.trackIndex=0,this.staveTop=0,this.topSpacing=0,this.bottomSpacing=0,this.staveBottom=0,this._factory=i,this.trackIndex=e,this.modelStaff=t}getSharedLayoutData(e,t){return this._sharedLayoutData.has(e)?this._sharedLayoutData.get(e):t}setSharedLayoutData(e,t){this._sharedLayoutData.set(e,t)}get isInsideBracket(){return this._factory.isInsideBracket}get isRelevantForBoundsLookup(){return this._factory.isRelevantForBoundsLookup}registerStaffTop(e){this.staveTop=e}registerStaffBottom(e){this.staveBottom=e}addBarRenderer(e){e.staff=this,e.index=this.barRenderers.length,e.reLayout(),this.barRenderers.push(e),this.system.layout.registerBarRenderer(this.staffId,e)}addBar(e,t,i){const a=this._factory.create(this.system.layout.renderer,e);a.additionalMultiRestBars=i,a.staff=this,a.index=this.barRenderers.length,a.layoutingInfo=t,a.doLayout(),a.registerLayoutingInfo();const n=a.barDisplayWidth;n>0&&this.system.layout.systemsLayoutMode===ks.FromModelWithWidths&&(a.width=n),this.barRenderers.push(a),e&&this.system.layout.registerBarRenderer(this.staffId,a)}revertLastBar(){const e=this.barRenderers[this.barRenderers.length-1];this.barRenderers.splice(this.barRenderers.length-1,1),this.system.layout.unregisterBarRenderer(this.staffId,e);for(const t of this.barRenderers)t.applyLayoutingInfo();return e}scaleToWidth(e){this._sharedLayoutData=new Map;const t=this.topOverflow;let i=0;switch(this.system.layout.systemsLayoutMode){case ks.Automatic:const n=(e-this.system.computedWidth)/this.barRenderers.length;for(const o of this.barRenderers){o.x=i,o.y=this.topSpacing+t;const l=o.computedWidth+n;o.scaleToWidth(l),i+=o.width}break;case ks.FromModelWithScale:e-=this.system.accoladeWidth;const r=this.system.totalBarDisplayScale;for(const o of this.barRenderers){o.x=i,o.y=this.topSpacing+t;const l=o.barDisplayScale*e/r;o.scaleToWidth(l),i+=o.width}break;case ks.FromModelWithWidths:for(const o of this.barRenderers){o.x=i,o.y=this.topSpacing+t;const l=o.barDisplayWidth;l>0?o.scaleToWidth(l):o.scaleToWidth(o.computedWidth),i+=o.width}break}}get topOverflow(){let e=0;for(let t=0,i=this.barRenderers.length;t<i;t++){const a=this.barRenderers[t];a.topOverflow>e&&(e=a.topOverflow)}return e}get bottomOverflow(){let e=0;for(let t=0,i=this.barRenderers.length;t<i;t++){const a=this.barRenderers[t];a.bottomOverflow>e&&(e=a.bottomOverflow)}return e}calculateHeightForAccolade(){this.topSpacing=this._factory.getStaffPaddingTop(this),this.bottomSpacing=this._factory.getStaffPaddingBottom(this),this.height=this.barRenderers.length>0?this.barRenderers[0].height:0,this.height>0&&(this.height+=this.topSpacing+this.topOverflow+this.bottomOverflow+this.bottomSpacing)}finalizeStaff(){this.topSpacing=this._factory.getStaffPaddingTop(this),this.bottomSpacing=this._factory.getStaffPaddingBottom(this),this.height=0;let e=!1,t=this.topOverflow;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].y=this.topSpacing+t,this.height=Math.max(this.height,this.barRenderers[i].height),this.barRenderers[i].finalizeRenderer()&&(e=!0);if(e){t=this.topOverflow;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].y=this.topSpacing+t;for(let i=0;i<this.barRenderers.length;i++)this.barRenderers[i].finalizeRenderer()}this.height>0&&(this.height+=this.topSpacing+t+this.bottomOverflow+this.bottomSpacing)}paint(e,t,i,a,n){if(!(this.height===0||n===0))for(let r=a,o=Math.min(a+n,this.barRenderers.length);r<o;r++)this.barRenderers[r].paint(e+this.x,t+this.y,i)}}class Uy{constructor(){this.timePosition=0,this.longestDuration=0,this.smallestDuration=0,this.force=0,this.springConstant=0,this.preBeatWidth=0,this.graceBeatWidth=0,this.postSpringWidth=0,this.allDurations=new Set}get springWidth(){return this.preSpringWidth+this.postSpringWidth}get preSpringWidth(){return this.preBeatWidth+this.graceBeatWidth}}class Mo{constructor(){this._timeSortedSprings=[],this._minTime=-1,this._onTimePositionsForce=0,this._onTimePositions=new Map,this._incompleteGraceRodsWidth=0,this._minDuration=Mo.MinDuration,this.version=0,this.preBeatSize=0,this.postBeatSize=0,this.minStretchForce=0,this.totalSpringConstant=0,this.incompleteGraceRods=new Map,this.allGraceRods=new Map,this.springs=new Map,this.height=0}updateMinStretchForce(e){this.minStretchForce<e&&(this.minStretchForce=e)}getPreBeatSize(e){if(e.graceType!==se.None){const i=e.graceGroup.id;return this.allGraceRods.get(i)[e.graceIndex].preBeatWidth}const t=e.absoluteDisplayStart;return this.springs.has(t)?this.springs.get(t).preBeatWidth:0}getPostBeatSize(e){if(e.graceType!==se.None){const i=e.graceGroup.id;return this.allGraceRods.get(i)[e.graceIndex].postSpringWidth}const t=e.absoluteDisplayStart;return this.springs.has(t)?this.springs.get(t).postSpringWidth:0}addSpring(e,t,i,a,n){this.version++;let r;if(this.springs.has(e))r=this.springs.get(e),r.postSpringWidth<n&&(r.postSpringWidth=n),r.graceBeatWidth<i&&(r.graceBeatWidth=i),r.preBeatWidth<a&&(r.preBeatWidth=a),t<r.smallestDuration&&(r.smallestDuration=t),t>r.longestDuration&&(r.longestDuration=t),r.allDurations.add(t);else{if(r=new Uy,r.timePosition=e,r.allDurations.add(t),this._timeSortedSprings.length>0){const h=this._timeSortedSprings[this._timeSortedSprings.length-1];for(const c of h.allDurations)h.timePosition+c;t<this._minDuration&&(this._minDuration=t)}r.longestDuration=t,r.postSpringWidth=n,r.graceBeatWidth=i,r.preBeatWidth=a,this.springs.set(e,r);const o=this._timeSortedSprings;let l=o.length-1;for(;l>0&&o[l].timePosition>e;)l--;this._timeSortedSprings.splice(l+1,0,r)}return(this._minTime===-1||this._minTime>e)&&(this._minTime=e),r}addBeatSpring(e,t,i){const a=e.absoluteDisplayStart;if(e.graceType!==se.None){const n=e.graceGroup.id;this.allGraceRods.has(n)||this.allGraceRods.set(n,new Array(e.graceGroup.beats.length)),!e.graceGroup.isComplete&&!this.incompleteGraceRods.has(n)&&this.incompleteGraceRods.set(n,new Array(e.graceGroup.beats.length));const r=this.allGraceRods.get(n)[e.graceIndex];if(r)r.postSpringWidth<i&&(r.postSpringWidth=i),r.preBeatWidth<t&&(r.preBeatWidth=t);else{const o=new Uy;o.timePosition=a,o.postSpringWidth=i,o.preBeatWidth=t,e.graceGroup.isComplete||(this.incompleteGraceRods.get(n)[e.graceIndex]=o),this.allGraceRods.get(n)[e.graceIndex]=o}}else{let n=0;if(e.graceGroup&&this.allGraceRods.has(e.graceGroup.id))for(const r of this.allGraceRods.get(e.graceGroup.id))n+=r.springWidth;this.addSpring(a,e.displayDuration,n,t,i)}}finish(){for(const[e,t]of this.allGraceRods){let i=0;for(const a of t)i+=a.preBeatWidth,a.graceBeatWidth=i,i+=a.postSpringWidth}this._incompleteGraceRodsWidth=0;for(const e of this.incompleteGraceRods.values())for(const t of e)this._incompleteGraceRodsWidth+=t.preBeatWidth+t.postSpringWidth;this.calculateSpringConstants(),this.version++}calculateSpringConstants(){let e=0;const t=this._timeSortedSprings;if(t.length===0){this.totalSpringConstant=-1,this.minStretchForce=-1;return}for(let i=0;i<t.length;i++){const a=t[i];let n=0;if(i===t.length-1)n=a.longestDuration;else{const r=t[i+1];n=Math.abs(r.timePosition-a.timePosition)}a.springConstant=this.calculateSpringConstant(a,n),e+=1/a.springConstant}this.totalSpringConstant=1/e,this.minStretchForce=0;for(let i=0;i<t.length;i++){const a=t[i];let n=0;if(i===t.length-1)n=a.postSpringWidth;else{const o=t[i+1];n=a.postSpringWidth+o.preSpringWidth}i===0&&(n+=a.preSpringWidth);const r=n*a.springConstant;this.updateMinStretchForce(r)}}paint(e,t,i){}calculateSpringConstant(e,t){t<=0&&(t=v.toTicks(w.TwoHundredFiftySixth)),e.smallestDuration===0&&(e.smallestDuration=t);const i=e.smallestDuration,a=this._minDuration,n=Mo.MinDurationWidth,r=1+.85*Math.log2(t/a);return i/t*(1/(r*n))}spaceToForce(e){return this.totalSpringConstant!==-1?(this._timeSortedSprings.length>0&&(e-=this._timeSortedSprings[0].preSpringWidth),e-=this._incompleteGraceRodsWidth,Math.max(e,0)*this.totalSpringConstant):-1}calculateVoiceWidth(e){let t=0;return this.totalSpringConstant!==-1&&(t=this.calculateWidth(e,this.totalSpringConstant)),this._timeSortedSprings.length>0&&(t+=this._timeSortedSprings[0].preSpringWidth),t+=this._incompleteGraceRodsWidth,t}calculateWidth(e,t){return e/t}buildOnTimePositions(e){if(this.totalSpringConstant===-1)return new Map;if(V.isAlmostEqualTo(this._onTimePositionsForce,e)&&this._onTimePositions)return this._onTimePositions;this._onTimePositionsForce=e;const t=new Map;this._onTimePositions=t;const i=this._timeSortedSprings;if(i.length===0)return t;let a=i[0].preSpringWidth;for(let n=0;n<i.length;n++)t.set(i[n].timePosition,a),a+=this.calculateWidth(e,i[n].springConstant);return t}}Mo.MinDuration=30;Mo.MinDurationWidth=7;class nC{constructor(){this.width=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.additionalMultiBarRestIndexes=null,this.renderers=[]}get lastMasterBarIndex(){return this.additionalMultiBarRestIndexes?this.additionalMultiBarRestIndexes[this.additionalMultiBarRestIndexes.length-1]:this.masterBar.index}}class rC{constructor(e,t){this.staves=[],this.stavesRelevantForBoundsLookup=[],this.firstStaffInBracket=null,this.lastStaffInBracket=null,this.bracket=null,this.staffSystem=e,this.track=t}addStaff(e){this.staves.push(e),e.isRelevantForBoundsLookup&&this.stavesRelevantForBoundsLookup.push(e)}}class oC{constructor(){this.firstStaffInBracket=null,this.lastStaffInBracket=null,this.drawAsBrace=!1,this.braceScale=1,this.width=0,this.index=0}finalizeBracket(){if(this.firstStaffInBracket===this.lastStaffInBracket){this.width=0;return}const e=He.Heights.get(u.Brace),t=He.Widths.get(u.Brace);if(this.width=t,!this.drawAsBrace||!this.firstStaffInBracket||!this.lastStaffInBracket)return;const i=this.firstStaffInBracket.contentTop,r=(this.lastStaffInBracket.contentBottom-i)/e;this.braceScale=r,this.width=t*this.braceScale}}class ad extends oC{constructor(e){super(),this.track=e,this.drawAsBrace=ad.isTrackDrawAsBrace(e)}includesStaff(e){return e.modelStaff.track===this.track}static isTrackDrawAsBrace(e){return e.staves.filter(t=>t.showStandardNotation).length>1}}class lC extends ad{includesStaff(e){return e.modelStaff.track===this.track?!0:this.drawAsBrace?!1:this.track.playbackInfo.program===e.modelStaff.track.playbackInfo.program}}class qn{constructor(e){this._allStaves=[],this._firstStaffInBrackets=null,this._lastStaffInBrackets=null,this._accoladeSpacingCalculated=!1,this._brackets=[],this._hasSystemSeparator=!1,this.x=0,this.y=0,this.index=0,this.accoladeWidth=0,this.isFull=!1,this.width=0,this.computedWidth=0,this.totalBarDisplayScale=0,this.isLast=!1,this.masterBarsRenderers=[],this.staves=[],this.layout=e,this.topPadding=e.renderer.settings.display.systemPaddingTop,this.bottomPadding=e.renderer.settings.display.systemPaddingBottom}get firstBarIndex(){return this.masterBarsRenderers[0].masterBar.index}get lastBarIndex(){return this.masterBarsRenderers[this.masterBarsRenderers.length-1].lastMasterBarIndex}addMasterBarRenderers(e,t){if(e.length===0)return null;this.masterBarsRenderers.push(t),t.layoutingInfo.preBeatSize=0;let i=0;for(let a=0,n=this.staves.length;a<n;a++){const r=this.staves[a];for(let o=0,l=r.staves.length;o<l;o++){const h=r.staves[o],c=t.renderers[i++];h.addBarRenderer(c)}}return this.calculateAccoladeSpacing(e),this.updateWidthFromLastBar(),t}addBars(e,t,i){const a=new nC;a.additionalMultiBarRestIndexes=i,a.layoutingInfo=new Mo,a.masterBar=e[0].score.masterBars[t],this.masterBarsRenderers.push(a);const n=a.layoutingInfo;for(const r of this.staves)for(const o of r.staves){const l=r.track.staves[o.modelStaff.index].bars[t],h=i==null?null:i.map(d=>r.track.staves[o.modelStaff.index].bars[d]);o.addBar(l,n,h);const c=o.barRenderers[o.barRenderers.length-1];a.renderers.push(c),c.isLinkedToPrevious&&(a.isLinkedToPrevious=!0),c.canWrap||(a.canWrap=!1)}return this.calculateAccoladeSpacing(e),n.finish(),a.width=this.updateWidthFromLastBar(),a}revertLastBar(){if(this.masterBarsRenderers.length>1){const e=this.masterBarsRenderers[this.masterBarsRenderers.length-1];this.masterBarsRenderers.splice(this.masterBarsRenderers.length-1,1);let t=0,i=0;for(let a=0,n=this._allStaves.length;a<n;a++){const o=this._allStaves[a].revertLastBar(),l=o.computedWidth;l>t&&(t=l);const h=o.barDisplayScale;h>i&&(i=h)}return this.width-=t,this.computedWidth-=t,this.totalBarDisplayScale-=i,e}return null}updateWidthFromLastBar(){let e=0,t=0;for(let i=0,a=this._allStaves.length;i<a;i++){const n=this._allStaves[i],r=n.barRenderers[n.barRenderers.length-1];r.applyLayoutingInfo(),r.computedWidth>e&&(e=r.computedWidth);const o=r.barDisplayScale;o>t&&(t=o)}return this.width+=e,this.computedWidth+=e,this.totalBarDisplayScale+=t,e}calculateAccoladeSpacing(e){const t=this.layout.renderer.settings;if(!this._accoladeSpacingCalculated){this._accoladeSpacingCalculated=!0,this.accoladeWidth=0;const i=this.layout.renderer.score.stylesheet;if(this.layout.renderer.settings.notation.isNotationElementVisible(be.TrackNames)){const o=this.layout.renderer.tracks.length===1?i.singleTrackTrackNamePolicy:i.multiTrackTrackNamePolicy,l=this.index===0?i.firstSystemTrackNameMode:i.otherSystemsTrackNameMode,h=this.index===0?i.firstSystemTrackNameOrientation:i.otherSystemsTrackNameOrientation;let c=!1;switch(o){case ct.Hidden:break;case ct.FirstSystem:c=this.index===0;break;case ct.AllSystems:c=!0;break}let d=!1;if(c){const f=this.layout.renderer.canvas,p=t.display.resources.effectFont;f.font=p;for(const g of e){let m="";switch(l){case Si.FullName:m=g.name;break;case Si.ShortName:m=g.shortName;break}if(m.length>0){d=!0;const T=f.measureText(m);switch(h){case wi.Horizontal:this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,T.width));break;case wi.Vertical:this.accoladeWidth=Math.ceil(Math.max(this.accoladeWidth,T.height));break}}}d&&(this.accoladeWidth+=t.display.systemLabelPaddingLeft,this.accoladeWidth+=t.display.systemLabelPaddingRight)}}let n=0;for(const o of this._allStaves)o.y=n,o.calculateHeightForAccolade(),n+=o.height;let r=0;for(const o of this._brackets)o.finalizeBracket(),r=Math.max(r,o.width);this.accoladeWidth+=r,this.width+=this.accoladeWidth,this.computedWidth+=this.accoladeWidth}}getStaffTrackGroup(e){for(let t=0,i=this.staves.length;t<i;t++){const a=this.staves[t];if(a.track===e)return a}return null}addStaff(e,t){let i=this.getStaffTrackGroup(e);if(i||(i=new rC(this,e),this.staves.push(i)),t.staffTrackGroup=i,t.system=this,t.index=this._allStaves.length,this._allStaves.push(t),i.addStaff(t),t.isInsideBracket){this._firstStaffInBrackets||(this._firstStaffInBrackets=t,t.isFirstInSystem=!0),i.firstStaffInBracket||(i.firstStaffInBracket=t),this._lastStaffInBrackets=t,i.lastStaffInBracket=t;let a=this._brackets.find(n=>n.includesStaff(t));if(!a)switch(e.score.stylesheet.bracketExtendMode){case la.NoBrackets:break;case la.GroupStaves:a=new ad(e),a.index=this._brackets.length,this._brackets.push(a);break;case la.GroupSimilarInstruments:a=new lC(e),a.index=this._brackets.length,this._brackets.push(a);break}a&&(a.firstStaffInBracket||(a.firstStaffInBracket=t),a.lastStaffInBracket=t,i.bracket=a)}}get height(){return this._allStaves.length===0?0:this._allStaves[this._allStaves.length-1].y+this._allStaves[this._allStaves.length-1].height+this.topPadding+this.bottomPadding}scaleToWidth(e){for(let t=0,i=this._allStaves.length;t<i;t++)this._allStaves[t].scaleToWidth(e);this.width=e}paint(e,t,i){var a;if(t+=this.topPadding,this.paintPartial(e+this.x,t+this.y,i,0,this.masterBarsRenderers.length),this._hasSystemSeparator){const n=Be.track(i,Ta.SystemSeparator,this._allStaves[0].modelStaff.track);try{i.fillMusicFontSymbol(e+this.x,t+this.y+this.height-10,1,u.SystemDivider,!1),i.fillMusicFontSymbol(e+this.x+this.width-qn.SystemSignSeparatorWidth,t+this.y+this.height-qn.SystemSignSeparatorPadding,1,u.SystemDivider,!1)}finally{(a=n==null?void 0:n[Symbol.dispose])==null||a.call(n)}}}paintPartial(e,t,i,a,n){var o,l,h;for(let c=0,d=this._allStaves.length;c<d;c++)this._allStaves[c].paint(e,t,i,a,n);const r=this.layout.renderer.settings.display.resources;if(this.staves.length>0&&a===0){i.color=r.barSeparatorColor;const c=this.layout.renderer.settings,d=this.layout.renderer.settings.notation.isNotationElementVisible(be.TrackNames);if(i.font=r.effectFont,d){const f=this.layout.renderer.score.stylesheet,p=this.layout.renderer.tracks.length===1?f.singleTrackTrackNamePolicy:f.multiTrackTrackNamePolicy,g=this.index===0?f.firstSystemTrackNameMode:f.otherSystemsTrackNameMode,m=this.index===0?f.firstSystemTrackNameOrientation:f.otherSystemsTrackNameOrientation;let T=!1;switch(p){case ct.Hidden:break;case ct.FirstSystem:T=this.index===0;break;case ct.AllSystems:T=!0;break}if(T){const S=i.textBaseline,y=i.textAlign;for(const b of this.staves)if(b.firstStaffInBracket&&b.lastStaffInBracket){const B=t+b.firstStaffInBracket.contentTop,N=t+b.lastStaffInBracket.contentBottom;let L="";switch(g){case Si.FullName:L=b.track.name;break;case Si.ShortName:L=b.track.shortName;break}const _=Be.track(i,Ta.TrackName,b.track);try{if(L.length>0){const A=e+b.firstStaffInBracket.x-c.display.accoladeBarPaddingRight-(((o=b.bracket)==null?void 0:o.width)??0)-c.display.systemLabelPaddingRight;switch(m){case wi.Horizontal:i.textBaseline=he.Middle,i.textAlign=Q.Right,i.fillText(L,A,(B+N)/2);break;case wi.Vertical:i.textBaseline=he.Bottom,i.textAlign=Q.Center,i.beginRotate(A,(B+N)/2,-90-.1),i.fillText(L,0,0),i.endRotate();break}}}finally{(l=_==null?void 0:_[Symbol.dispose])==null||l.call(_)}}i.textBaseline=S,i.textAlign=y}}if(this._allStaves.length>0){let f=null;for(const p of this._allStaves)if(p.isInsideBracket){if(f!==null){const g=f.contentBottom,m=p.contentTop,T=e+f.x,S=f.barRenderers[0],y=Be.bar(i,S.staffLineBarSubElement,S.bar);try{const b=Math.ceil(m-g);i.fillRect(T,t+g,1,b)}finally{(h=y==null?void 0:y[Symbol.dispose])==null||h.call(y)}}f=p}}for(const f of this._brackets)if(f.firstStaffInBracket&&f.lastStaffInBracket){const p=e+f.firstStaffInBracket.x,g=f.width,m=c.display.accoladeBarPaddingRight,T=t+f.firstStaffInBracket.contentTop,S=t+f.lastStaffInBracket.contentBottom;let y=T,b=S;if(f.drawAsBrace)i.fillMusicFontSymbol(p-m-g,b,f.braceScale,u.Brace);else if(f.firstStaffInBracket!==f.lastStaffInBracket){const B=g/2;y-=B,b+=B*2,i.fillRect(p-m-g,y,g,Math.ceil(b-y));const N=p-m-g-.5;i.fillMusicFontSymbol(N,y,1,u.BracketTop),i.fillMusicFontSymbol(N,Math.floor(b),1,u.BracketBottom)}}}}finalizeSystem(){const e=this.layout.renderer.settings;this.index===0&&(this.topPadding=e.display.firstSystemPaddingTop),this.isLast?this.bottomPadding=e.display.lastSystemPaddingBottom:this.layout.renderer.score.stylesheet.useSystemSignSeparator&&this.layout.renderer.tracks.length>1&&(this.bottomPadding+=qn.SystemSignSeparatorHeight,this._hasSystemSeparator=!0);let t=0;for(const i of this._allStaves)i.x=this.accoladeWidth,i.y=t,i.finalizeStaff(),t+=i.height;for(const i of this._brackets)i.finalizeBracket()}buildBoundingsLookup(e,t){if(this.layout.renderer.boundsLookup.isFinished)return;const i=this._firstStaffInBrackets,a=this._lastStaffInBrackets;if(!i||!a)return;t+=this.topPadding;const n=this._allStaves[this._allStaves.length-1],r=t+this.y+i.y,o=t+this.y+a.y+a.height,l=t+this.y+this._allStaves[0].y,h=t+this.y+n.y+n.height,c=t+this.y+i.y+i.topSpacing+i.topOverflow+(i.barRenderers.length>0?i.barRenderers[0].topPadding:0),d=t+this.y+n.y+n.height-n.bottomSpacing-n.bottomOverflow-(n.barRenderers.length>0?n.barRenderers[0].bottomPadding:0),f=o-r,p=d-c,g=h-l,m=this.x+i.x,T=new Nk;T.visualBounds=new hi,T.visualBounds.x=e+this.x,T.visualBounds.y=t+this.y,T.visualBounds.w=this.width,T.visualBounds.h=this.height-this.topPadding-this.bottomPadding,T.realBounds=new hi,T.realBounds.x=e+this.x,T.realBounds.y=t+this.y,T.realBounds.w=this.width,T.realBounds.h=this.height,this.layout.renderer.boundsLookup.addStaffSystem(T);const S=new Map;for(let y=0;y<this.staves.length;y++)for(const b of this.staves[y].stavesRelevantForBoundsLookup)for(const B of b.barRenderers){let N;S.has(B.bar.masterBar.index)?N=S.get(B.bar.masterBar.index):(N=new _k,N.index=B.bar.masterBar.index,N.isFirstOfLine=B.isFirstOfLine,N.realBounds=new hi,N.realBounds.x=m+B.x,N.realBounds.y=l,N.realBounds.w=B.width,N.realBounds.h=g,N.visualBounds=new hi,N.visualBounds.x=m+B.x,N.visualBounds.y=r,N.visualBounds.w=B.width,N.visualBounds.h=f,N.lineAlignedBounds=new hi,N.lineAlignedBounds.x=m+B.x,N.lineAlignedBounds.y=c,N.lineAlignedBounds.w=B.width,N.lineAlignedBounds.h=p,this.layout.renderer.boundsLookup.addMasterBar(N),S.set(N.index,N)),B.buildBoundingsLookup(N,m,t+this.y+b.y)}}getBarX(e){if(!this._firstStaffInBrackets||this.layout.renderer.tracks.length===0)return 0;const t=this.layout.renderer.tracks[0].staves[0].bars[e];return this.layout.getRendererForBar(this._firstStaffInBrackets.staffId,t).x}}qn.SystemSignSeparatorHeight=40;qn.SystemSignSeparatorPadding=10;qn.SystemSignSeparatorWidth=36;class hC extends Wh{constructor(e,t){super(e,t,Q.Left)}}class Er extends da{constructor(e,t,i,a){super(e,t),this._tuning=i,this._trackLabel=a,this.glyphs=[]}doLayout(){if(!(this.glyphs.length>0)){this.createGlyphs(this._tuning);for(const e of this.glyphs)e.renderer=this.renderer,e.doLayout()}}paint(e,t,i){i.textBaseline=he.Middle;const a=i.color;this.colorOverride&&(i.color=this.colorOverride),super.paint(e,t,i),i.color=a}createGlyphs(e){const t=this.renderer.resources;this.height=0;const i=15,a=1;if(this._trackLabel.length>0){this.height+=a;const o=new os(0,this.height,this._trackLabel,t.effectFont,Q.Left);o.renderer=this.renderer,o.doLayout(),this.height+=o.height+a,o.y+=o.height/2,this.addGlyph(o)}const n=new os(0,this.height,e.name,t.effectFont,Q.Left);n.renderer=this.renderer,n.doLayout(),this.height+=n.height,n.y+=n.height/2,this.addGlyph(n);const r=64;if(this.renderer.scoreRenderer.canvas.font=t.effectFont,this.width=Math.max(this.renderer.scoreRenderer.canvas.measureText(this._trackLabel).width,Math.max(this.renderer.scoreRenderer.canvas.measureText(e.name).width,2*r)),!e.isStandard){this.height+=i;const o=Er.CircleNumberScale,l=He.Heights.get(u.GuitarString0)*o,h=Math.ceil(e.tunings.length/2)|0;let c=0,d=this.height;for(let f=0,p=e.tunings.length;f<p;f++){const g=u.GuitarString0+(f+1);this.addGlyph(new Mt(c,d+l/2.5,o,g));const m=`= ${M.getTextForTuning(e.tunings[f],!1)}`;this.addGlyph(new os(c+l+1,d,m,t.effectFont,Q.Left)),d+=i,f===h-1&&(d=this.height,c+=r)}this.height+=h*i}this.width+=15}}Er.CircleNumberScale=.7;class cC{constructor(e,t){this.args=e,this.renderCallback=t}}var ks;(function(s){s[s.Automatic=0]="Automatic",s[s.FromModelWithScale=1]="FromModelWithScale",s[s.FromModelWithWidths=2]="FromModelWithWidths"})(ks||(ks={}));class rn{get scaledWidth(){return Math.round(this.width/this.renderer.settings.display.scale)}constructor(e){this._barRendererLookup=new Map,this.pagePadding=null,this.width=0,this.height=0,this.multiBarRestInfo=null,this.headerGlyphs=new Map,this.footerGlyphs=new Map,this.chordDiagrams=null,this.tuningGlyph=null,this.systemsLayoutMode=ks.Automatic,this._lazyPartials=new Map,this.firstBarIndex=0,this.lastBarIndex=0,this.renderer=e}resize(){this._lazyPartials.clear(),this.doResize()}layoutAndRender(){this._lazyPartials.clear();const e=this.renderer.score;this.firstBarIndex=V.computeFirstDisplayedBarIndex(e,this.renderer.settings),this.lastBarIndex=V.computeLastDisplayedBarIndex(e,this.renderer.settings,this.firstBarIndex),this.multiBarRestInfo=V.buildMultiBarRestInfo(this.renderer.tracks,this.firstBarIndex,this.lastBarIndex),this.pagePadding=this.renderer.settings.display.padding.map(t=>t/this.renderer.settings.display.scale),this.pagePadding||(this.pagePadding=[0,0,0,0]),this.pagePadding.length===1?this.pagePadding=[this.pagePadding[0],this.pagePadding[0],this.pagePadding[0],this.pagePadding[0]]:this.pagePadding.length===2&&(this.pagePadding=[this.pagePadding[0],this.pagePadding[1],this.pagePadding[0],this.pagePadding[1]]),this.createScoreInfoGlyphs(),this.doLayoutAndRender()}registerPartial(e,t){if(e.height===0)return;const i=this.renderer.settings.display.scale;e.x*=i,e.y*=i,e.width*=i,e.height*=i,e.totalWidth*=i,e.totalHeight*=i,this.renderer.settings.core.enableLazyLoading?(this._lazyPartials.set(e.id,new cC(e,t)),this.renderer.partialLayoutFinished.trigger(e)):(this.renderer.partialLayoutFinished.trigger(e),this.internalRenderLazyPartial(e,t))}internalRenderLazyPartial(e,t){const i=this.renderer.canvas;i.beginRender(e.width,e.height),t(i),e.renderResult=i.endRender(),this.renderer.partialRenderFinished.trigger(e)}renderLazyPartial(e){if(this._lazyPartials.has(e)){const t=this._lazyPartials.get(e);this.internalRenderLazyPartial(t.args,t.renderCallback)}}createHeaderFooterGlyph(e,t,i,a){switch(i){case z.WordsAndMusic:if(t.words!==t.music)return;break;case z.Words:case z.Music:if(t.words===t.music)return;break;case z.CopyrightSecondLine:if(!this.headerGlyphs.has(z.Copyright))return;break}const n=e.display.resources,r=e.notation,l=t.style&&t.style.headerAndFooter.has(i)?t.style.headerAndFooter.get(i):ko.defaultHeaderAndFooter.get(i);let h=l.isVisible!==void 0?l.isVisible:!0;if(a!==void 0&&(h=r.isNotationElementVisible(a)),!h)return;const c=l.buildText(t);if(c)return new os(0,0,c,n.getFontForElement(i),l.textAlign,void 0,Be.scoreColor(n,i,t))}createScoreInfoGlyphs(){E.debug("ScoreLayout","Creating score info glyphs");const e=this.renderer.settings,t=this.renderer.score;this.headerGlyphs=new Map,this.footerGlyphs=new Map;const i=new ot(this.renderer,this.renderer.tracks[0].staves[0].bars[0]);for(const[r,o]of rn.HeaderElements.value){const l=this.createHeaderFooterGlyph(e,t,r,o);l&&(l.renderer=i,l.doLayout(),this.headerGlyphs.set(r,l))}for(const[r,o]of rn.FooterElements.value){const l=this.createHeaderFooterGlyph(e,t,r,o);l&&(l.renderer=i,l.doLayout(),this.footerGlyphs.set(r,l))}const a=e.notation,n=e.display.resources;if(a.isNotationElementVisible(be.GuitarTuning)){const r=[];for(const o of this.renderer.tracks)for(const l of o.staves){let h=!l.isPercussion&&l.isStringed&&l.tuning.length>0&&l.showTablature;if(t.stylesheet.perTrackDisplayTuning&&t.stylesheet.perTrackDisplayTuning.has(o.index)&&t.stylesheet.perTrackDisplayTuning.get(o.index)===!1&&(h=!1),h){r.push(l);break}}if(r.length>0&&t.stylesheet.globalDisplayTuning){this.tuningGlyph=new hC(0,0),this.tuningGlyph.renderer=i;for(const o of r)if(o.stringTuning.tunings.length>0){const l=r.length>1?o.track.name:"",h=new Er(0,0,o.stringTuning,l);h.colorOverride=Be.trackColor(n,Ta.StringTuning,o.track),h.renderer=i,h.doLayout(),this.tuningGlyph.addGlyph(h)}}else this.tuningGlyph=null}if(a.isNotationElementVisible(be.ChordDiagrams)){this.chordDiagrams=new sC(0,0),this.chordDiagrams.renderer=i;const r=new Set;for(const o of this.renderer.tracks)if(t.stylesheet.globalDisplayChordDiagramsOnTop&&(t.stylesheet.perTrackChordDiagramsOnTop==null||!t.stylesheet.perTrackChordDiagramsOnTop.has(o.index)||t.stylesheet.perTrackChordDiagramsOnTop.get(o.index)))for(const h of o.staves){const c=h.chords;if(c)for(const[,d]of c)r.has(d.uniqueId)||d.showDiagram&&(r.add(d.uniqueId),this.chordDiagrams.addChord(d))}this.chordDiagrams.isEmpty&&(this.chordDiagrams=null)}else this.chordDiagrams=null}createEmptyStaffSystem(){const e=new qn(this);for(let t=0;t<this.renderer.tracks.length;t++){const i=this.renderer.tracks[t];for(let a=0;a<i.staves.length;a++){const n=i.staves[a],r=C.staveProfiles.get(this.renderer.settings.display.staveProfile);for(const o of r)o.canCreate(i,n)&&e.addStaff(i,new aC(t,n,o))}}return e}registerBarRenderer(e,t){if(this._barRendererLookup.has(e)||this._barRendererLookup.set(e,new Map),this._barRendererLookup.get(e).set(t.bar.id,t),t.additionalMultiRestBars)for(const i of t.additionalMultiRestBars)this._barRendererLookup.get(e).set(i.id,t)}unregisterBarRenderer(e,t){if(this._barRendererLookup.has(e)){const i=this._barRendererLookup.get(e);if(i.delete(t.bar.id),t.additionalMultiRestBars)for(const a of t.additionalMultiRestBars)i.delete(a.id)}}getRendererForBar(e,t){const i=t.id;return this._barRendererLookup.has(e)&&this._barRendererLookup.get(e).has(i)?this._barRendererLookup.get(e).get(i):null}layoutAndRenderBottomScoreInfo(e){e=Math.round(e);const t=new Rn;t.x=0,t.y=e;let i=0;const a=this.renderer.settings.display.resources,n=[];let r=0;for(const[o,l]of rn.FooterElements.value)if(this.footerGlyphs.has(o)){const h=this.footerGlyphs.get(o);h.y=i,this.alignScoreInfoGlyph(h),i+=h.font.size*1.2,n.push(h),r=Math.max(r,Math.round(h.x+h.width))}return i=Math.round(i),n.length>0&&(t.width=r,t.height=i,t.totalWidth=this.scaledWidth,t.totalHeight=e+t.height,this.registerPartial(t,o=>{o.color=a.scoreInfoColor,o.textAlign=Q.Left,o.textBaseline=he.Top;for(const l of n)l.paint(0,0,o)})),e+i}alignScoreInfoGlyph(e){if(C.getLayoutEngineFactory(this.renderer.settings.display.layoutMode).vertical)switch(e.textAlign){case Q.Left:e.x=this.pagePadding[0];break;case Q.Center:e.x=this.scaledWidth/2;break;case Q.Right:e.x=this.scaledWidth-this.pagePadding[2];break}else e.x=this.firstBarX,e.textAlign=Q.Left}layoutAndRenderAnnotation(e){const t="rendered by alphaTab",i=this.renderer.settings.display.resources,a=12,n=ge.withFamilyList(i.copyrightFont.families,a,rt.Plain,Xi.Bold),r=new ot(this.renderer,this.renderer.tracks[0].staves[0].bars[0]),o=new os(0,0,t,n,Q.Center,void 0,i.mainGlyphColor);o.renderer=r,o.doLayout(),this.alignScoreInfoGlyph(o);const l=new Rn;return l.width=o.x+o.width,l.x=0,l.height=a,l.y=e,l.totalWidth=this.scaledWidth,l.totalHeight=e+a,l.firstMasterBarIndex=-1,l.lastMasterBarIndex=-1,this.registerPartial(l,h=>{h.color=i.mainGlyphColor,h.font=n,h.textAlign=Q.Left,h.textBaseline=he.Top,o.paint(0,0,h)}),e+a}}rn.HeaderElements=new Fh(()=>new Map([[z.Title,be.ScoreTitle],[z.SubTitle,be.ScoreSubTitle],[z.Artist,be.ScoreArtist],[z.Album,be.ScoreAlbum],[z.Words,be.ScoreWords],[z.Music,be.ScoreMusic],[z.WordsAndMusic,be.ScoreWordsAndMusic],[z.Transcriber,void 0]]));rn.FooterElements=new Fh(()=>new Map([[z.Copyright,be.ScoreCopyright],[z.CopyrightSecondLine,void 0]]));class or extends da{constructor(){super(0,0),this._effectGlyphs=[],this._normalGlyphs=[],this.computedWidth=0}doLayout(){let e=0;if(this.glyphs)for(let t=0,i=this.glyphs.length;t<i;t++){const a=this.glyphs[t];a.x=e,a.renderer=this.renderer,a.doLayout(),e+=a.width}this.width=e,this.computedWidth=e}noteLoop(e){for(let t=this.container.beat.notes.length-1;t>=0;t--)e(this.container.beat.notes[t])}addEffect(e){super.addGlyph(e),this._effectGlyphs.push(e)}addNormal(e){super.addGlyph(e),this._normalGlyphs.push(e)}get effectElement(){}paint(e,t,i){this.paintEffects(e,t,i),this.paintNormal(e,t,i)}paintNormal(e,t,i){for(const a of this._normalGlyphs)a.paint(e+this.x,t+this.y,i)}paintEffects(e,t,i){var n;const a=this.effectElement?Be.beat(i,this.effectElement,this.container.beat):void 0;try{for(const r of this._effectGlyphs)r.paint(e+this.x,t+this.y,i)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}class lr extends or{constructor(){super(...arguments),this.centerX=0}updateBeamingHelper(){}buildBoundingsLookup(e,t,i){}getNoteX(e,t){return 0}getNoteY(e,t){return 0}}class Jn extends pt{constructor(e,t,i,a=1){super(e,t),this._scale=0,this._symbols=[],this._symbols=Jn.getSymbols(i),this._scale=a}static getSymbols(e){const t=[];for(;e>0;){const i=e%10;t.unshift(Jn.getSymbol(i)),e=e/10|0}return t}static getSymbol(e){switch(e){case 0:return u.TimeSig0;case 1:return u.TimeSig1;case 2:return u.TimeSig2;case 3:return u.TimeSig3;case 4:return u.TimeSig4;case 5:return u.TimeSig5;case 6:return u.TimeSig6;case 7:return u.TimeSig7;case 8:return u.TimeSig8;case 9:return u.TimeSig9;default:return u.None}}doLayout(){let e=0;for(const t of this._symbols)e+=He.Widths.get(t);this.width=e}paint(e,t,i){i.fillMusicFontSymbols(e+this.x,t+this.y,this._scale,this._symbols)}}Jn.numberHeight=18;class nd extends pt{constructor(){super(0,0),this._numberGlyph=[]}doLayout(){this.width=70,this.renderer.registerOverflowTop(this.renderer.getLineHeight(1));const e=this.renderer.additionalMultiRestBars.length+1;this._numberGlyph=Jn.getSymbols(e)}paint(e,t,i){i.fillMusicFontSymbols(e+this.x,t+this.y+this.renderer.height/2,1,[u.RestHBarLeft,u.RestHBarMiddle,u.RestHBarMiddle,u.RestHBarMiddle,u.RestHBarRight]);const a=this.renderer.getLineY(-1.5);i.fillMusicFontSymbols(e+this.x+nd.BarWidth/2,t+this.y+a|0,1,this._numberGlyph,!0)}}nd.BarWidth=60;class rd extends rs{constructor(e){super(rd.getOrCreatePlaceholderBeat(e),e),this.preNotes=new or,this.onNotes=new lr}doLayout(){this.renderer.showMultiBarRest&&this.onNotes.addNormal(new nd),super.doLayout()}static getOrCreatePlaceholderBeat(e){if(e.voice.beats.length>1)return e.voice.beats[0];const t=new Wt;return t.voice=e.voice,t}}var $;(function(s){s[s.TopWithStem=0]="TopWithStem",s[s.Top=1]="Top",s[s.Center=2]="Center",s[s.Bottom=3]="Bottom",s[s.BottomWithStem=4]="BottomWithStem"})($||($={}));var Ke;(function(s){s[s.Left=0]="Left",s[s.Center=1]="Center",s[s.Right=2]="Right"})(Ke||(Ke={}));class ot{get nextRenderer(){return!this.bar||!this.bar.nextBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staffId,this.bar.nextBar)}get previousRenderer(){return!this.bar||!this.bar.previousBar?null:this.scoreRenderer.layout.getRendererForBar(this.staff.staffId,this.bar.previousBar)}get lastBar(){return this.additionalMultiRestBars?this.additionalMultiRestBars[this.additionalMultiRestBars.length-1]:this.bar}get showMultiBarRest(){return!1}constructor(e,t){this._preBeatGlyphs=new mr,this._voiceContainers=new Map,this._postBeatGlyphs=new mr,this._ties=[],this.additionalMultiRestBars=null,this.x=0,this.y=0,this.width=0,this.computedWidth=0,this.height=0,this.index=0,this.topOverflow=0,this.bottomOverflow=0,this.isLinkedToPrevious=!1,this.canWrap=!0,this.wasFirstOfLine=!1,this._appliedLayoutingInfo=0,this.isFinalized=!1,this.topPadding=0,this.bottomPadding=0,this.scoreRenderer=e,this.bar=t,t&&(this.helpers=new iC(this))}registerTies(e){this._ties.push(...e)}get middleYPosition(){return 0}registerOverflowTop(e){return e>this.topOverflow?(this.topOverflow=e,!0):!1}registerOverflowBottom(e){return e>this.bottomOverflow?(this.bottomOverflow=e,!0):!1}scaleToWidth(e){const t=e-this._preBeatGlyphs.width-this._postBeatGlyphs.width;for(const i of this._voiceContainers.values())i.scaleToWidth(t);this._postBeatGlyphs.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width+t,this.width=e}get resources(){return this.settings.display.resources}get settings(){return this.scoreRenderer.settings}get barDisplayScale(){return this.staff.system.staves.length>1?this.bar.masterBar.displayScale:this.bar.displayScale}get barDisplayWidth(){return this.staff.system.staves.length>1?this.bar.masterBar.displayWidth:this.bar.displayWidth}get isFirstOfLine(){return this.index===0}get isLast(){return!this.bar||this.bar.index===this.scoreRenderer.layout.lastBarIndex}registerLayoutingInfo(){const e=this.layoutingInfo,t=this._preBeatGlyphs.width;e.preBeatSize<t&&(e.preBeatSize=t);for(const a of this._voiceContainers.values())a.registerLayoutingInfo(e),a.x+a.width;const i=this._postBeatGlyphs.width;e.postBeatSize<i&&(e.postBeatSize=i)}applyLayoutingInfo(){if(this._appliedLayoutingInfo>=this.layoutingInfo.version)return!1;this._appliedLayoutingInfo=this.layoutingInfo.version,this._preBeatGlyphs.width=this.layoutingInfo.preBeatSize;let e=this._preBeatGlyphs.x+this._preBeatGlyphs.width;for(const i of this._voiceContainers.values()){i.x=this._preBeatGlyphs.x+this._preBeatGlyphs.width,i.applyLayoutingInfo(this.layoutingInfo);const a=i.x+i.width;e<a&&(e=a)}this._postBeatGlyphs.x=Math.floor(e),this._postBeatGlyphs.width=this.layoutingInfo.postBeatSize,this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.computedWidth=this.width;const t=this.barDisplayWidth;return t>0&&this.scoreRenderer.layout.systemsLayoutMode===ks.FromModelWithWidths&&(this.width=t,this.computedWidth=t),!0}finalizeRenderer(){this.isFinalized=!0;let e=!1;const t=this.y-this.staff.topSpacing,i=this.y+this.height+this.staff.bottomSpacing;for(const a of this._ties)if(a.doLayout(),a.height>0){const n=a.y+a.height-i;n>0&&this.registerOverflowBottom(n)&&(e=!0);const r=a.y-t;r<0&&this.registerOverflowTop(r*-1)&&(e=!0)}return e}doLayout(){if(this.bar){this.helpers.initialize(),this._ties=[],this._preBeatGlyphs=new mr,this._preBeatGlyphs.renderer=this,this._voiceContainers.clear(),this._postBeatGlyphs=new mr,this._postBeatGlyphs.renderer=this;for(let e=0;e<this.bar.voices.length;e++){const t=this.bar.voices[e];if(this.hasVoiceContainer(t)){const i=new Ek(0,0,t);i.renderer=this,this._voiceContainers.set(this.bar.voices[e].index,i)}}if(this.bar.simileMark===St.SecondOfDouble&&(this.canWrap=!1),this.createPreBeatGlyphs(),this.additionalMultiRestBars){const e=new rd(this.getVoiceContainer(this.bar.voices[0]));this.addBeatGlyph(e)}else this.createBeatGlyphs();this.createPostBeatGlyphs(),this.updateSizes();for(const e of this.helpers.beamHelpers)for(const t of e)t.finish();this.computedWidth=this.width}}hasVoiceContainer(e){return this.additionalMultiRestBars||e.index===0?!0:!e.isEmpty}updateSizes(){this.staff.registerStaffTop(this.topPadding),this.staff.registerStaffBottom(this.height-this.bottomPadding);const e=this._voiceContainers,t=this.beatGlyphsStart;let i=t;for(const a of e.values()){a.x=t,a.doLayout();const n=a.x+a.width;i<n&&(i=n)}this._postBeatGlyphs.x=Math.floor(i),this.width=Math.ceil(this._postBeatGlyphs.x+this._postBeatGlyphs.width),this.height+=this.layoutingInfo.height}addPreBeatGlyph(e){e.renderer=this,this._preBeatGlyphs.addGlyph(e)}addBeatGlyph(e){e.renderer=this,e.preNotes.renderer=this,e.onNotes.renderer=this,e.onNotes.beamingHelper=this.helpers.beamHelperLookup[e.beat.voice.index].get(e.beat.index),this.getVoiceContainer(e.beat.voice).addGlyph(e)}getVoiceContainer(e){return this._voiceContainers.has(e.index)?this._voiceContainers.get(e.index):void 0}getBeatContainer(e){var t,i;return(i=(t=this.getVoiceContainer(e.voice))==null?void 0:t.beatGlyphs)==null?void 0:i[e.index]}getPreNotesGlyphForBeat(e){var t;return(t=this.getBeatContainer(e))==null?void 0:t.preNotes}getOnNotesGlyphForBeat(e){var t;return(t=this.getBeatContainer(e))==null?void 0:t.onNotes}paint(e,t,i){this.paintBackground(e,t,i),i.color=this.resources.mainGlyphColor,this._preBeatGlyphs.paint(e+this.x,t+this.y,i);for(const a of this._voiceContainers.values())a.paint(e+this.x,t+this.y,i);i.color=this.resources.mainGlyphColor,this._postBeatGlyphs.paint(e+this.x,t+this.y,i)}paintBackground(e,t,i){this.layoutingInfo.paint(e+this.x+this._preBeatGlyphs.x+this._preBeatGlyphs.width,t+this.y+this.height,i)}buildBoundingsLookup(e,t,i){const a=new Tk;a.bar=this.bar,a.visualBounds=new hi,a.visualBounds.x=t+this.x,a.visualBounds.y=i+this.y+this.topPadding,a.visualBounds.w=this.width,a.visualBounds.h=this.height-this.topPadding-this.bottomPadding,a.realBounds=new hi,a.realBounds.x=t+this.x,a.realBounds.y=i+this.y,a.realBounds.w=this.width,a.realBounds.h=this.height,e.addBar(a);for(const[n,r]of this._voiceContainers){const o=this.bar.isEmpty&&n===0;if(!r.voice.isEmpty||o)for(let l=0,h=r.beatGlyphs.length;l<h;l++)r.beatGlyphs[l].buildBoundingsLookup(a,t+this.x+r.x,i+this.y+r.y,o)}}addPostBeatGlyph(e){this._postBeatGlyphs.addGlyph(e)}createPreBeatGlyphs(){this.wasFirstOfLine=this.isFirstOfLine}createBeatGlyphs(){for(const e of this.bar.voices)this.hasVoiceContainer(e)&&this.createVoiceGlyphs(e)}createVoiceGlyphs(e){}createPostBeatGlyphs(){}get beatGlyphsStart(){return this._preBeatGlyphs.x+this._preBeatGlyphs.width}get postBeatGlyphsStart(){return this._postBeatGlyphs.x}getBeatX(e,t=Te.PreNotes){const i=this.getBeatContainer(e);if(i)switch(t){case Te.PreNotes:return i.voiceContainer.x+i.x;case Te.OnNotes:return i.voiceContainer.x+i.x+i.onNotes.x;case Te.MiddleNotes:return i.voiceContainer.x+i.x+i.onTimeX;case Te.Stem:const a=i.onNotes.beamingHelper?i.onNotes.beamingHelper.getBeatLineX(e):i.onNotes.x+i.onNotes.width/2;return i.voiceContainer.x+a;case Te.PostNotes:return i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.width;case Te.EndBeat:return i.voiceContainer.x+i.x+i.width}return 0}getRatioPositionX(e){const t=this.bar.isEmpty?this.beatGlyphsStart:this.getBeatX(this.bar.voices[0].beats[0],Te.OnNotes),i=t,a=this.postBeatGlyphsStart-t;return i+a*e}getNoteX(e,t){const i=this.getBeatContainer(e.beat);return i?i.voiceContainer.x+i.x+i.onNotes.x+i.onNotes.getNoteX(e,t):0}getNoteY(e,t){const i=this.getOnNotesGlyphForBeat(e.beat);return i?i.getNoteY(e,t):Number.NaN}reLayout(){(this.wasFirstOfLine&&!this.isFirstOfLine||!this.wasFirstOfLine&&this.isFirstOfLine)&&this.recreatePreBeatGlyphs(),this.updateSizes(),this.registerLayoutingInfo()}recreatePreBeatGlyphs(){this._preBeatGlyphs=new mr,this._preBeatGlyphs.renderer=this,this.createPreBeatGlyphs()}paintSimileMark(e,t,i){var n;const a=Be.voice(i,rh.Glyphs,this.bar.voices[0],!0);try{switch(this.bar.simileMark){case St.Simple:i.beginGroup(rs.getGroupId(this.bar.voices[0].beats[0])),i.fillMusicFontSymbol(e+this.x+(this.width-20)/2,t+this.y+this.height/2,1,u.Repeat1Bar,!1),i.endGroup();break;case St.SecondOfDouble:i.beginGroup(rs.getGroupId(this.bar.voices[0].beats[0])),i.beginGroup(rs.getGroupId(this.bar.previousBar.voices[0].beats[0])),i.fillMusicFontSymbol(e+this.x-28/2,t+this.y+this.height/2,1,u.Repeat2Bars,!1),i.endGroup(),i.endGroup();break}}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}completeBeamingHelper(e){}getBeatDirection(e){return this.helpers.getBeamingHelperForBeat(e).direction}}ot.RawLineSpacing=8;ot.StemWidth=.12*ot.RawLineSpacing;ot.StaffLineThickness=.13*ot.RawLineSpacing;ot.BeamThickness=.5*ot.RawLineSpacing;ot.BeamSpacing=.25*ot.RawLineSpacing;var Ne;(function(s){s[s.SinglePreBeat=0]="SinglePreBeat",s[s.SingleOnBeat=1]="SingleOnBeat",s[s.SingleOnBeatToEnd=2]="SingleOnBeatToEnd",s[s.GroupedOnBeat=3]="GroupedOnBeat",s[s.GroupedOnBeatToEnd=4]="GroupedOnBeatToEnd",s[s.FullBar=5]="FullBar"})(Ne||(Ne={}));class uC extends pt{constructor(e,t){super(0,0),this._uniqueEffectGlyphs=[],this._effectGlyphs=[],this.isEmpty=!0,this.previousBand=null,this.isLinkedToPrevious=!1,this.firstBeat=null,this.lastBeat=null,this.height=0,this.originalHeight=0,this.slot=null,this.voice=e,this.info=t}doLayout(){super.doLayout();for(let e=0;e<this.renderer.bar.voices.length;e++)this._effectGlyphs.push(new Map),this._uniqueEffectGlyphs.push([])}createGlyph(e){if(e.voice===this.voice&&this.info.shouldCreateGlyph(this.renderer.settings,e)&&(!this.info.hideOnMultiTrack||this.renderer.staff.trackIndex===0)){if(this.isEmpty=!1,(!this.firstBeat||e.isBefore(this.firstBeat))&&(this.firstBeat=e),!this.lastBeat||e.isAfter(this.lastBeat))switch(this.lastBeat=e,this.info.sizingMode){case Ne.SingleOnBeatToEnd:case Ne.GroupedOnBeatToEnd:this.lastBeat.nextBeat&&(this.lastBeat=this.lastBeat.nextBeat);break}const t=this.createOrResizeGlyph(this.info.sizingMode,e);t.height>this.height&&(this.height=t.height,this.originalHeight=t.height)}}resetHeight(){this.height=this.originalHeight}createOrResizeGlyph(e,t){let i;switch(e){case Ne.FullBar:return i=this.info.createNewGlyph(this.renderer,t),i.renderer=this.renderer,i.beat=t,i.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,i),this._uniqueEffectGlyphs[t.voice.index].push(i),i;case Ne.SinglePreBeat:case Ne.SingleOnBeat:case Ne.SingleOnBeatToEnd:return i=this.info.createNewGlyph(this.renderer,t),i.renderer=this.renderer,i.beat=t,i.doLayout(),this._effectGlyphs[t.voice.index].set(t.index,i),this._uniqueEffectGlyphs[t.voice.index].push(i),i;case Ne.GroupedOnBeat:case Ne.GroupedOnBeatToEnd:const a=e===Ne.GroupedOnBeat?Ne.SingleOnBeat:Ne.SingleOnBeatToEnd;if(t.index>0||this.renderer.index>0){const n=t.previousBeat;if(this.info.shouldCreateGlyph(this.renderer.settings,n)){let r=null;if(t.index>0&&this._effectGlyphs[t.voice.index].has(n.index))r=this._effectGlyphs[t.voice.index].get(n.index);else if(this.renderer.index>0){const h=this.renderer.previousRenderer.getBand(n.voice,this.info.effectId);if(h){const c=h._effectGlyphs[n.voice.index];c.has(n.index)&&(r=c.get(n.index))}}const o=this.createOrResizeGlyph(a,t);return r&&this.info.canExpand(n,t)&&(r.nextGlyph=o,o.previousGlyph=r,this.isLinkedToPrevious=!0),o}return this.createOrResizeGlyph(a,t)}return this.createOrResizeGlyph(a,t);default:return this.createOrResizeGlyph(Ne.SingleOnBeat,t)}}paint(e,t,i){var a;super.paint(e,t,i);for(let n=0,r=this._uniqueEffectGlyphs.length;n<r;n++){const o=this._uniqueEffectGlyphs[n];for(let l=0,h=o.length;l<h;l++){const c=o[l],d=Be.beat(i,qe.Effects,c.beat,!1);try{c.paint(e+this.x,t+this.y,i)}finally{(a=d==null?void 0:d[Symbol.dispose])==null||a.call(d)}}}}alignGlyphs(){for(let e=0;e<this._effectGlyphs.length;e++)for(const t of this._effectGlyphs[e].keys())this.alignGlyph(this.info.sizingMode,this.renderer.bar.voices[e].beats[t])}alignGlyph(e,t){const i=this._effectGlyphs[t.voice.index].get(t.index),a=this.renderer.getBeatContainer(t);switch(e){case Ne.SinglePreBeat:const n=this.renderer.layoutingInfo.getPreBeatSize(t);i.x=this.renderer.beatGlyphsStart+a.x-n;break;case Ne.SingleOnBeat:case Ne.GroupedOnBeat:i.x=this.renderer.beatGlyphsStart+a.x;break;case Ne.SingleOnBeatToEnd:case Ne.GroupedOnBeatToEnd:if(i.x=this.renderer.beatGlyphsStart+a.x,a.beat.isLastOfVoice)i.width=this.renderer.width-i.x;else{const r=this.renderer.layoutingInfo.getPostBeatSize(t);i.width=r}break;case Ne.FullBar:i.width=this.renderer.width;break}}}class dC{constructor(){this.uniqueEffectId=null,this.y=0,this.height=0,this.firstBeat=null,this.lastBeat=null}}class fC{constructor(){this.bands=[],this.shared=new dC}update(e){e.info.canShareBand||(this.shared.uniqueEffectId=e.info.effectId),e.slot=this,this.bands.push(e),e.height>this.shared.height&&(this.shared.height=e.height),(!this.shared.firstBeat||e.firstBeat.isBefore(this.shared.firstBeat))&&(this.shared.firstBeat=e.firstBeat),(!this.shared.lastBeat||e.lastBeat.isAfter(this.shared.lastBeat))&&(this.shared.lastBeat=e.lastBeat)}canBeUsed(e){return(!this.shared.uniqueEffectId&&e.info.canShareBand||e.info.effectId===this.shared.uniqueEffectId)&&(!this.shared.firstBeat||this.shared.lastBeat.isBefore(e.firstBeat)||this.shared.lastBeat.isBefore(this.shared.firstBeat))}}class pC{constructor(){this.slots=[],this._effectSlot=new Map}getOrCreateSlot(e){if(this._effectSlot.has(e.info.effectId)){const i=this._effectSlot.get(e.info.effectId);if(i.canBeUsed(e))return i}for(const i of this.slots)if(i.canBeUsed(e))return i;const t=new fC;return this.slots.push(t),t}register(e){const t=this.getOrCreateSlot(e);t.update(e),this._effectSlot.set(e.info.effectId,t)}}class gC extends ot{constructor(e,t,i){super(e,t),this._bands=[],this._bandLookup=new Map,this.sizingInfo=null,this._infos=i}updateSizes(){this.topOverflow=0,this.bottomOverflow=0,this.topPadding=0,this.bottomPadding=0,this.updateHeight(),super.updateSizes()}finalizeRenderer(){let e=super.finalizeRenderer();return this.updateHeight()&&(e=!0),e}updateHeight(){if(!this.sizingInfo)return!1;let e=0;for(const t of this.sizingInfo.slots){t.shared.y=e;for(const i of t.bands)i.y=e,i.height=t.shared.height;e+=t.shared.height}return e!==this.height?(this.height=e,!0):!1}applyLayoutingInfo(){const e=!super.applyLayoutingInfo();if(this.index>0){const t=this.previousRenderer;this.sizingInfo=t.sizingInfo}else this.sizingInfo=new pC;for(const t of this._bands)t.resetHeight(),t.alignGlyphs(),t.isEmpty||this.sizingInfo.register(t);return this.updateHeight(),e}scaleToWidth(e){super.scaleToWidth(e);for(const t of this._bands)t.alignGlyphs()}createBeatGlyphs(){this._bands=[],this._bandLookup=new Map;for(const e of this.bar.voices)if(this.hasVoiceContainer(e))for(const t of this._infos){const i=new uC(e,t);i.renderer=this,i.doLayout(),this._bands.push(i),this._bandLookup.set(`${e.index}.${t.effectId}`,i)}super.createBeatGlyphs();for(const e of this._bands)e.isLinkedToPrevious&&(this.isLinkedToPrevious=!0)}createVoiceGlyphs(e){for(const t of e.beats){const i=new rs(t,this.getVoiceContainer(e));i.preNotes=new or,i.onNotes=new lr,this.addBeatGlyph(i);for(const a of this._bands)a.createGlyph(t)}}paint(e,t,i){this.paintBackground(e,t,i);for(const a of this._bands)i.color=a.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,a.isEmpty||a.paint(e+this.x,t+this.y,i)}getBand(e,t){const i=`${e.index}.${t}`;return this._bandLookup.has(i)?this._bandLookup.get(i):null}}class cr extends Vh{get staffId(){return this._staffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.effectStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.effectStaffPaddingBottom}constructor(e,t,i=null){super(),this.infos=t,this._staffId=e,this.isInsideBracket=!1,this.isRelevantForBoundsLookup=!1,this.shouldShow=i}canCreate(e,t){const i=this.shouldShow;return super.canCreate(e,t)&&(!i||i(e,t))}create(e,t){return new gC(e,t,this.infos.filter(i=>e.settings.notation.isNotationElementVisible(i.notationElement)))}}class gh extends cs{constructor(e,t,i,a,n){super(e,t),this._endingsString="",this._endings=V.getAlternateEndingsList(i),this._openLine=a,this._closeLine=n}doLayout(){super.doLayout(),this.height=this.renderer.resources.wordsFont.size+(gh.Padding+2);let e="";for(let t=0,i=this._endings.length;t<i;t++)e+=this._endings[t]+1,e+=". ";this._endingsString=e}paint(e,t,i){const a=this._closeLine?this.width-4:this.width;if(e=(e|0)+.5,t=(t|0)+.5,this._openLine?(i.moveTo(e+this.x,t+this.y+this.height),i.lineTo(e+this.x,t+this.y)):i.moveTo(e+this.x,t+this.y),i.lineTo(e+this.x+a,t+this.y),this._closeLine&&i.lineTo(e+this.x+a,t+this.y+this.height),i.stroke(),this._openLine){const n=i.textBaseline;i.textBaseline=he.Top;const r=this.renderer.resources;i.font=r.wordsFont,i.fillText(this._endingsString,e+this.x+gh.Padding,t+this.y),i.textBaseline=n}}}gh.Padding=3;class mt{get effectId(){return this.notationElement.toString()}}class mC extends mt{get notationElement(){return be.EffectAlternateEndings}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Ne.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.alternateEndings!==0}createNewGlyph(e,t){const i=t.voice.bar.masterBar,a=i.previousMasterBar===null||i.alternateEndings!==i.previousMasterBar.alternateEndings;let n=i.isRepeatEnd||i.nextMasterBar===null||i.alternateEndings!==i.nextMasterBar.alternateEndings;return i.repeatGroup.closings.some(r=>r.index>=i.index)||(n=!1),new gh(0,0,i.alternateEndings,a,n)}canExpand(e,t){return!0}}class yC extends mt{get notationElement(){return be.EffectCapo}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.index===0&&t.voice.bar.index===0&&t.voice.bar.staff.capo!==0}createNewGlyph(e,t){return new os(0,0,`Capo. fret ${t.voice.bar.staff.capo}`,e.resources.effectFont,Q.Left)}canExpand(e,t){return!1}}class bC extends mt{get notationElement(){return be.EffectChordNames}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.hasChord}createNewGlyph(e,t){return new os(0,0,t.chord.name,e.resources.effectFont,Q.Center)}canExpand(e,t){return!1}}class Zo extends cs{constructor(e){super(),this.forceGroupedRendering=!1,this.endOnBarLine=!1,this.endPosition=e}get isLinkedWithPrevious(){return!!this.previousGlyph&&this.previousGlyph.renderer.staff.system===this.renderer.staff.system}get isLinkedWithNext(){return!!this.nextGlyph&&this.nextGlyph.renderer.isFinalized&&this.nextGlyph.renderer.staff.system===this.renderer.staff.system}paint(e,t,i){if(this.isLinkedWithPrevious)return;if(!this.isLinkedWithNext&&!this.forceGroupedRendering){this.paintNonGrouped(e,t,i);return}let a;if(!this.isLinkedWithNext&&this.forceGroupedRendering)a=this;else for(a=this.nextGlyph;a.isLinkedWithNext;)a=a.nextGlyph;const n=a.renderer,r=a.beat,o=this.endPosition,l=e-this.renderer.x,h=this.calculateEndX(n,r,l,o);this.paintGrouped(e,t,h,i)}calculateEndX(e,t,i,a){return t?i+e.x+e.getBeatX(t,a):i+e.x+this.x+this.width}paintNonGrouped(e,t,i){const a=e-this.renderer.x,n=this.calculateEndX(this.renderer,this.beat,a,this.endPosition);this.paintGrouped(e,t,n,i)}}class SC extends Zo{constructor(e,t,i){super(Te.EndBeat),this._crescendo=vi.None,this._crescendo=i,this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=17}paintGrouped(e,t,i,a){const n=e+this.x,r=this.height,o=He.Widths.get(u.NoteheadBlack)/2;a.beginPath(),this._crescendo===vi.Crescendo?(i-=o,a.moveTo(i,t+this.y),a.lineTo(n,t+this.y+r/2),a.lineTo(i,t+this.y+r)):(i-=o,a.moveTo(n,t+this.y),a.lineTo(i,t+this.y+r/2),a.lineTo(n,t+this.y+r)),a.stroke()}}class wC extends mt{get notationElement(){return be.EffectCrescendo}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.crescendo!==vi.None}createNewGlyph(e,t){return new SC(0,0,t.crescendo)}canExpand(e,t){return e.crescendo===t.crescendo}}class Hg extends Mt{constructor(e,t,i){super(e,t,.6,Hg.getSymbol(i)),this.center=!0}doLayout(){super.doLayout(),this.y+=this.height/2}static getSymbol(e){switch(e){case j.PPP:return u.DynamicPPP;case j.PP:return u.DynamicPP;case j.P:return u.DynamicPiano;case j.MP:return u.DynamicMP;case j.MF:return u.DynamicMF;case j.F:return u.DynamicForte;case j.FF:return u.DynamicFF;case j.FFF:return u.DynamicFFF;case j.PPPP:return u.DynamicPPPP;case j.PPPPP:return u.DynamicPPPPP;case j.PPPPPP:return u.DynamicPPPPP;case j.FFFF:return u.DynamicFFFF;case j.FFFFF:return u.DynamicFFFFF;case j.FFFFFF:return u.DynamicFFFFFF;case j.SF:return u.DynamicSforzando1;case j.SFP:return u.DynamicSforzandoPiano;case j.SFPP:return u.DynamicSforzandoPianissimo;case j.FP:return u.DynamicFortePiano;case j.RF:return u.DynamicRinforzando1;case j.RFZ:return u.DynamicRinforzando2;case j.SFZ:return u.DynamicSforzato;case j.SFFZ:return u.DynamicSforzatoFF;case j.FZ:return u.DynamicForzando;case j.N:return u.DynamicNiente;case j.PF:return u.DynamicPF;case j.SFZP:return u.DynamicSforzatoPiano;default:return u.None}}}class kC extends mt{get notationElement(){return be.EffectDynamics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return this.internalShouldCreateGlyph(t)}internalShouldCreateGlyph(e){if(e.voice.bar.staff.track.score.stylesheet.hideDynamics||e.isEmpty||e.voice.isEmpty||e.isRest)return!1;const t=this.getPreviousDynamicsBeat(e);let i=e.voice.index===0&&!t||e.dynamics!==(t==null?void 0:t.dynamics);if(i&&e.voice.index>0){for(const a of e.voice.bar.voices)if(a.index<e.voice.index){const n=a.getBeatAtPlaybackStart(e.playbackStart);n&&e.dynamics===n.dynamics&&this.internalShouldCreateGlyph(n)&&(i=!1)}}return i}getPreviousDynamicsBeat(e){let t=e.previousBeat;for(;t!=null;){if(!t.isRest)return t;t=t.previousBeat}return null}createNewGlyph(e,t){return new Hg(0,0,t.dynamics)}canExpand(e,t){return!0}}class Vg extends Mt{constructor(e){super(0,0,1,Vg.getSymbol(e)),this.center=!0}static getSymbol(e){switch(e){case qt.FadeIn:return u.GuitarFadeIn;case qt.FadeOut:return u.GuitarFadeOut;case qt.VolumeSwell:return u.GuitarVolumeSwell}return u.None}paint(e,t,i){super.paint(e,t+this.height,i)}}class TC extends mt{get notationElement(){return be.EffectFadeIn}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.fade!==qt.None}createNewGlyph(e,t){return new Vg(t.fade)}canExpand(e,t){return!0}}class Wg extends Mt{constructor(e,t,i){super(e,t,1,Wg.getSymbol(i))}static getSymbol(e){switch(e){case Bi.Short:return u.FermataShortAbove;case Bi.Medium:return u.FermataAbove;case Bi.Long:return u.FermataLongAbove;default:return u.None}}paint(e,t,i){super.paint(e-this.width/2,t+this.height,i)}}class BC extends mt{get notationElement(){return be.EffectFermata}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index===0&&!!t.fermata}createNewGlyph(e,t){return new Wg(0,0,t.fermata.type)}canExpand(e,t){return!0}}class _C extends mt{get notationElement(){return be.EffectFingering}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.voice.index!==0||t.isRest||e.notation.fingeringMode!==ua.SingleNoteEffectBand&&e.notation.fingeringMode!==ua.SingleNoteEffectBandForcePiano||t.notes.length!==1?!1:t.notes[0].isFingering}createNewGlyph(e,t){let i=ie.Unknown,a=!1;const n=t.notes[0];n.leftHandFinger!==ie.Unknown?(i=n.leftHandFinger,a=!0):n.rightHandFinger!==ie.Unknown&&(i=n.rightHandFinger);const r=V.fingerToString(e.settings,t,i,a)??"";return new os(0,0,r,e.resources.fingeringFont,Q.Left)}canExpand(e,t){return!0}}class Gr extends mt{constructor(){super(...arguments),this.lastCreateInfo=null}shouldCreateGlyph(e,t){this.lastCreateInfo=[];for(let i=0,a=t.notes.length;i<a;i++){const n=t.notes[i];this.shouldCreateGlyphForNote(n)&&this.lastCreateInfo.push(n)}return this.lastCreateInfo.length>0}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}canExpand(e,t){return!0}}class pa extends Zo{constructor(e,t=!0){super(Te.OnNotes),this._label=e,this._dashed=t}doLayout(){this.renderer.settings.notation.extendLineEffectsToBeatEnd&&(this.endPosition=Te.EndBeat,this.forceGroupedRendering=!0),super.doLayout(),this.height=this.renderer.resources.effectFont.size}paintNonGrouped(e,t,i){const a=this.renderer.resources;i.font=a.effectFont;const n=i.textAlign;i.textAlign=Q.Center,i.fillText(this._label,e+this.x,t+this.y),i.textAlign=n}paintGrouped(e,t,i,a){this.paintNonGrouped(e,t,a);const n=3,r=a.measureText(this._label).width,o=e+this.x+r/2+n,l=t+this.y+4,h=8;if(this._dashed){if(i>o){let c=o;for(;c<i;)a.beginPath(),a.moveTo(c,l|0),a.lineTo(Math.min(c+h,i),l|0),c+=h+n,a.stroke();a.beginPath(),a.moveTo(i,l-5|0),a.lineTo(i,l+5|0),a.stroke()}}else a.beginPath(),a.moveTo(o,l|0),a.lineTo(i,l|0),a.lineTo(i,l+5|0),a.stroke()}}pa.LineSpacing=3;pa.LineTopPadding=4;pa.LineTopOffset=5;pa.LineSize=8;class _n extends Gr{get effectId(){return this._effectId}get notationElement(){return be.EffectHarmonics}constructor(e){switch(super(),this._beat=null,this._harmonicType=e,e){case ae.None:this._effectId="harmonics-none";break;case ae.Natural:this._effectId="harmonics-natural";break;case ae.Artificial:this._effectId="harmonics-artificial";break;case ae.Pinch:this._effectId="harmonics-pinch";break;case ae.Tap:this._effectId="harmonics-tap";break;case ae.Semi:this._effectId="harmonics-semi";break;case ae.Feedback:this._effectId="harmonics-feedback";break;default:this._effectId="";break}}shouldCreateGlyphForNote(e){return!e.isHarmonic||e.harmonicType!==this._harmonicType?!1:(e.beat!==this._beat&&(this._beat=e.beat),!0)}get sizingMode(){return Ne.GroupedOnBeat}createNewGlyph(e,t){return new pa(_n.harmonicToString(this._harmonicType))}static harmonicToString(e){switch(e){case ae.Natural:return"N.H.";case ae.Artificial:return"A.H.";case ae.Pinch:return"P.H.";case ae.Tap:return"T.H.";case ae.Semi:return"S.H.";case ae.Feedback:return"Fdbk."}return""}}class NC extends mt{get notationElement(){return be.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isLetRing}get sizingMode(){return Ne.GroupedOnBeat}createNewGlyph(e,t){return new pa("LetRing")}canExpand(e,t){return!0}}class xC extends cs{constructor(e,t,i,a,n=Q.Center){super(e,t),this._lines=i,this.font=a,this.textAlign=n}doLayout(){super.doLayout(),this.height=this.font.size*this._lines.length}paint(e,t,i){i.font=this.font;const a=i.textAlign;i.textAlign=this.textAlign;for(let n=0;n<this._lines.length;n++)this._lines[n]&&i.fillText(this._lines[n],e+this.x,t+this.y+n*this.font.size);i.textAlign=a}}class vC extends mt{get notationElement(){return be.EffectLyrics}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.lyrics}createNewGlyph(e,t){return new xC(0,0,t.lyrics,e.resources.effectFont,Q.Center)}canExpand(e,t){return!0}}class CC extends mt{get notationElement(){return be.EffectMarker}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return Ne.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.isSectionStart}createNewGlyph(e,t){return new os(0,0,t.voice.bar.masterBar.section.marker?`[${t.voice.bar.masterBar.section.marker}] ${t.voice.bar.masterBar.section.text}`:t.voice.bar.masterBar.section.text,e.resources.markerFont,Q.Left)}canExpand(e,t){return!0}}class EC extends Zo{constructor(e,t){super(Te.PostNotes),this._ottava=e,this._aboveStaff=t}doLayout(){super.doLayout(),this.height=He.Heights.get(u.QuindicesimaAlta)}paintNonGrouped(e,t,i){this.paintOttava(e,t,i)}paintOttava(e,t,i){let a=0;switch(this._ottava){case fe._15ma:a=He.Widths.get(u.QuindicesimaAlta)*.8,i.fillMusicFontSymbol(e+this.x-a/2,t+this.y+this.height,.8,u.QuindicesimaAlta,!1);break;case fe._8va:a=He.Widths.get(u.OttavaAlta)*.8,i.fillMusicFontSymbol(e+this.x-a/2,t+this.y+this.height,.8,u.OttavaAlta,!1);break;case fe._8vb:a=He.Widths.get(u.OttavaBassaVb)*.8,i.fillMusicFontSymbol(e+this.x-a/2,t+this.y+this.height,.8,u.OttavaBassaVb,!1);break;case fe._15mb:a=(He.Widths.get(u.Quindicesima)+He.Widths.get(u.OctaveBaselineM)+He.Widths.get(u.OctaveBaselineB))*.8,i.fillMusicFontSymbols(e+this.x-a/2,t+this.y+this.height,.8,[u.Quindicesima,u.OctaveBaselineM,u.OctaveBaselineB],!1);break}return a/2}paintGrouped(e,t,i,a){const n=this.paintOttava(e,t,a),r=3,o=e+this.x+n+r;let l=t+this.y;l+=this._aboveStaff?2:this.height-2;const h=8;if(i>o){let c=o;for(;c<i;)a.beginPath(),a.moveTo(c,l|0),a.lineTo(Math.min(c+h,i),l|0),c+=h+r,a.stroke();a.beginPath(),this._aboveStaff?(a.moveTo(i,l),a.lineTo(i,t+this.y+this.height)):(a.moveTo(i,l),a.lineTo(i,t+this.y)),a.stroke()}}}class Yy extends mt{get effectId(){return`ottavia-${this._aboveStaff?"above":"below"}`}get notationElement(){return be.EffectOttavia}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.GroupedOnBeat}constructor(e){super(),this._aboveStaff=e}shouldCreateGlyph(e,t){switch(t.ottava){case fe._15ma:return this._aboveStaff;case fe._8va:return this._aboveStaff;case fe._8vb:return!this._aboveStaff;case fe._15mb:return!this._aboveStaff}return!1}createNewGlyph(e,t){return new EC(t.ottava,this._aboveStaff)}canExpand(e,t){return e.ottava===t.ottava}}class DC extends Gr{get notationElement(){return be.EffectPalmMute}shouldCreateGlyphForNote(e){return e.isPalmMute}get sizingMode(){return Ne.GroupedOnBeat}createNewGlyph(e,t){return new pa("P.M.")}}class PC extends Gr{get notationElement(){return be.EffectPickSlide}shouldCreateGlyphForNote(e){return e.slideOutType===pe.PickSlideDown||e.slideOutType===pe.PickSlideUp}get sizingMode(){return Ne.GroupedOnBeat}createNewGlyph(e,t){return new pa("P.S.")}}class mh extends Mt{constructor(e,t,i){super(e,t,Ye.GraceScale,mh.getSymbol(i))}paint(e,t,i){super.paint(e,t+this.height,i)}static getSymbol(e){switch(e){case ni.Up:return u.StringsUpBow;case ni.Down:return u.StringsDownBow;default:return u.None}}}class LC extends mt{get notationElement(){return be.EffectPickStroke}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.pickStroke!==ni.None}createNewGlyph(e,t){return new mh(0,0,t.pickStroke)}canExpand(e,t){return!0}}class Dk extends Zo{constructor(e){super(Te.EndBeat),this._stepSize=0,this._type=e}doLayout(){switch(super.doLayout(),this._type){case ve.Slight:this._stepSize=12;break;case ve.Wide:this._stepSize=23;break}this.height=18}paintGrouped(e,t,i,a){let n=e+this.x;const r=i-n,o=Math.max(1,r/this._stepSize);a.beginPath(),a.moveTo(n,t+this.y);for(let l=0;l<o;l++)a.lineTo(n+this._stepSize/2,t+this.y+this.height),a.lineTo(n+this._stepSize,t+this.y),n+=this._stepSize;a.stroke()}}class Xy extends mt{get notationElement(){return be.EffectSlightBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===ve.Slight}createNewGlyph(e,t){return new Dk(ve.Slight)}canExpand(e,t){return!0}}class ar extends Zo{constructor(e,t,i,a=1.2,n=!1){super(Te.EndBeat),this._scale=0,this._symbol=u.None,this._symbolSize=0,this._type=i,this._scale=a,this.x=e,this.y=t,this._partialWaves=n}doLayout(){switch(super.doLayout(),this._type){case ve.Slight:this._symbol=u.WiggleTrill;break;case ve.Wide:this._symbol=u.WiggleVibratoMediumFast;break}this._symbolSize=He.Widths.get(this._symbol)*this._scale,this.height=He.Heights.get(this._symbol)*this._scale}paintGrouped(e,t,i,a){const n=e+this.x,r=i-n,o=this._symbolSize;let l=r/o;this._partialWaves||(l=Math.floor(l)),l<1&&(l=1);let h=0;for(let c=0;c<l;c++)a.fillMusicFontSymbol(e+this.x+h,t+this.y+this.height*2,this._scale,this._symbol,!1),h+=o}}class qy extends Gr{get notationElement(){return be.EffectSlightNoteVibrato}shouldCreateGlyphForNote(e){let t=e.vibrato===ve.Slight||e.isTieDestination&&e.tieOrigin.vibrato===ve.Slight;return this._hideOnTiedBend&&t&&e.isTieDestination&&e.tieOrigin.hasBend&&(t=!1),t}get sizingMode(){return Ne.GroupedOnBeatToEnd}createNewGlyph(e,t){return new ar(0,0,ve.Slight,1.2)}constructor(e){super(),this._hideOnTiedBend=e}}class AC extends mt{get notationElement(){return be.EffectTap}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.slap||t.pop||t.tap}createNewGlyph(e,t){const i=e.resources;return t.slap?new os(0,0,"S",i.effectFont,Q.Left):t.pop?new os(0,0,"P",i.effectFont,Q.Left):new os(0,0,"T",i.effectFont,Q.Left)}canExpand(e,t){return!0}}class FC extends cs{constructor(e){super(0,0),this.tempoAutomations=e}doLayout(){super.doLayout(),this.height=25}paint(e,t,i){for(const a of this.tempoAutomations){let n=e+this.renderer.getRatioPositionX(a.ratioPosition);const r=this.renderer.resources;if(i.font=r.markerFont,i.textBaseline=he.Top,a.text){const o=i.measureText(a.text);i.fillText(a.text,n,t+this.y+i.font.size/2),n+=o.width+i.font.size*.7}i.fillMusicFontSymbol(n,t+this.y+this.height*.8,.5,u.NoteQuarterUp,!0),i.fillText(`= ${a.value.toString()}`,n+He.Widths.get(u.NoteQuarterUp)*.5+3,t+this.y+i.font.size/2)}}}class MC extends mt{get notationElement(){return be.EffectTempo}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Ne.SinglePreBeat}shouldCreateGlyph(e,t){return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.tempoAutomations.length>0}createNewGlyph(e,t){return new FC(t.voice.bar.masterBar.tempoAutomations)}canExpand(e,t){return!0}}class RC extends mt{get notationElement(){return be.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return!!t.text}createNewGlyph(e,t){return new os(0,0,t.text,e.resources.effectFont,Q.Left)}canExpand(e,t){return!0}}class OC extends Zo{constructor(e,t){super(Te.EndBeat),this.x=e,this.y=t}doLayout(){super.doLayout(),this.height=He.Heights.get(u.OrnamentTrill)/2}paintGrouped(e,t,i,a){let n=e+this.x;a.fillMusicFontSymbol(n,t+this.y+this.height,1,u.OrnamentTrill,!0),n+=He.Widths.get(u.OrnamentTrill)/2;const r=1.2,o=He.Widths.get(u.WiggleTrill)*r,l=Math.floor((i-n)/o),h=t+this.y+this.height*1.37;let c=n;for(let d=0;d<l;d++)a.fillMusicFontSymbol(c,h,r,u.WiggleTrill,!1),c+=o}}class Jy extends Gr{get notationElement(){return be.EffectTrill}shouldCreateGlyphForNote(e){return e.isTrill}get sizingMode(){return Ne.GroupedOnBeatToEnd}createNewGlyph(e,t){return new OC(0,0)}}var Qy;(function(s){s[s.Full=0]="Full",s[s.PartialLeft=1]="PartialLeft",s[s.PartialRight=2]="PartialRight"})(Qy||(Qy={}));class On extends cs{constructor(e){super(0,0),this._tripletFeel=e}doLayout(){super.doLayout(),this.height=25}paint(e,t,i){e+=this.x,t+=this.y;const a=t+this.height*Ye.GraceScale,n=a+8;i.font=this.renderer.resources.effectFont,i.fillText("(",e,t+this.height*.3);const r=e+10,o=e+40;let l=[],h=[],c=[],d=[];switch(this._tripletFeel){case me.NoTripletFeel:l=[u.TextBlackNoteLongStem,u.TextCont8thBeamLongStem,u.TextBlackNoteFrac8thLongStem],c=[u.TextBlackNoteLongStem,u.TextCont8thBeamLongStem,u.TextBlackNoteFrac8thLongStem];break;case me.Triplet8th:l=[u.TextBlackNoteLongStem,u.TextCont8thBeamLongStem,u.TextBlackNoteFrac8thLongStem],c=[u.TextBlackNoteLongStem,u.Space,u.NoteEighthUp],d=[u.TextTupletBracketStartLongStem,u.TextTuplet3LongStem,u.TextTupletBracketEndLongStem];break;case me.Triplet16th:l=[u.TextBlackNoteLongStem,u.TextCont8thBeamLongStem,u.TextBlackNoteFrac8thLongStem],c=[u.TextBlackNoteLongStem,u.TextCont8thBeamLongStem,u.TextBlackNoteFrac16thLongStem],d=[u.TextTupletBracketStartLongStem,u.TextTuplet3LongStem,u.TextTupletBracketEndLongStem];break;case me.Dotted8th:l=[u.TextBlackNoteLongStem,u.TextCont8thBeamLongStem,u.TextBlackNoteFrac8thLongStem],h=[u.TextAugmentationDot],c=[u.TextBlackNoteLongStem,u.TextCont8thBeamLongStem,u.TextBlackNoteFrac16thLongStem];break;case me.Dotted16th:l=[u.TextBlackNoteLongStem,u.TextCont16thBeamLongStem,u.TextBlackNoteFrac16thLongStem],h=[u.TextAugmentationDot],c=[u.TextBlackNoteLongStem,u.TextCont16thBeamLongStem,u.TextBlackNoteFrac32ndLongStem],i.fillCircle(o+9,a,1);break;case me.Scottish8th:l=[u.TextBlackNoteLongStem,u.TextCont8thBeamLongStem,u.TextBlackNoteFrac8thLongStem],c=[u.TextBlackNoteLongStem,u.TextCont16thBeamLongStem,u.TextBlackNoteFrac8thLongStem,u.TextAugmentationDot];break;case me.Scottish16th:l=[u.TextBlackNoteLongStem,u.TextCont16thBeamLongStem,u.TextBlackNoteFrac16thLongStem],c=[u.TextBlackNoteLongStem,u.TextCont32ndBeamLongStem,u.TextBlackNoteFrac16thLongStem,u.TextAugmentationDot];break}i.fillMusicFontSymbols(r,a,On.NoteScale,l,!1),i.fillText("=",e+32,t+5),i.fillMusicFontSymbols(o,a,On.NoteScale,c,!1),h.length>0&&i.fillMusicFontSymbols(o+7,a,On.NoteScale,h,!1),d.length>0&&i.fillMusicFontSymbols(o,n,On.TupletScale,d,!1),i.fillText(")",e+65,t+this.height*.3)}}On.NoteScale=.5;On.TupletScale=.7;class IC extends mt{get notationElement(){return be.EffectTripletFeel}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Ne.SinglePreBeat}shouldCreateGlyph(e,t){return t.index===0&&(t.voice.bar.masterBar.index===0&&t.voice.bar.masterBar.tripletFeel!==me.NoTripletFeel||t.voice.bar.masterBar.index>0&&t.voice.bar.masterBar.tripletFeel!==t.voice.bar.masterBar.previousMasterBar.tripletFeel)}createNewGlyph(e,t){return new On(t.voice.bar.masterBar.tripletFeel)}canExpand(e,t){return!0}}class HC extends mt{get notationElement(){return be.EffectWhammyBar}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ne.GroupedOnBeat}shouldCreateGlyph(e,t){return t.hasWhammyBar}createNewGlyph(e,t){return new pa("w/bar")}canExpand(e,t){return!0}}class Ky extends mt{get notationElement(){return be.EffectWideBeatVibrato}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.GroupedOnBeatToEnd}shouldCreateGlyph(e,t){return t.vibrato===ve.Wide}createNewGlyph(e,t){return new Dk(ve.Wide)}canExpand(e,t){return!0}}class $y extends Gr{get notationElement(){return be.EffectWideNoteVibrato}shouldCreateGlyphForNote(e){return e.vibrato===ve.Wide||e.isTieDestination&&e.tieOrigin.vibrato===ve.Wide}get sizingMode(){return Ne.GroupedOnBeatToEnd}createNewGlyph(e,t){return new ar(0,0,ve.Wide,1.2)}}class Zy{constructor(){this.x=0,this.width=0,this.masterBars=[]}}class VC extends rn{constructor(){super(...arguments),this._system=null}get name(){return"HorizontalScreen"}get supportsResize(){return!1}get firstBarX(){let e=this.pagePadding[0];return this._system&&(e+=this._system.accoladeWidth),e}doResize(){}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case tr.Automatic:this.systemsLayoutMode=ks.Automatic;break;case tr.UseModelLayout:this.systemsLayoutMode=ks.FromModelWithWidths;break}const e=this.renderer.score;let t=this.renderer.settings.display.startBar;t--,t=Math.min(e.masterBars.length-1,Math.max(0,t));let i=t,a=this.renderer.settings.display.barCount;a<=0&&(a=e.masterBars.length),a=t+a-1,a=Math.min(e.masterBars.length-1,Math.max(0,a)),this._system=this.createEmptyStaffSystem(),this._system.isLast=!0,this._system.x=this.pagePadding[0],this._system.y=this.pagePadding[1];const n=this.renderer.settings.display.barCountPerPartial,r=[];let o=new Zy,l=0;for(;i<=a;){const d=this.multiBarRestInfo,f=d!==null&&d.has(i)?d.get(i):null,p=this._system.addBars(this.renderer.tracks,i,f);if(o.masterBars.length===0&&p.isLinkedToPrevious&&r.length>0){const g=r[r.length-1];g.masterBars.push(e.masterBars[i]),g.width+=p.width,l+=p.width,o.x+=l}else o.masterBars.push(e.masterBars[i]),o.width+=p.width,o.masterBars.length>=n&&(r.length===0&&(o.width+=this._system.accoladeWidth+this.pagePadding[0]),l+=o.width,r.push(o),E.debug(this.name,`Finished partial from bar ${o.masterBars[0].index} to ${o.masterBars[o.masterBars.length-1].index}`,null),o=new Zy,o.x=l);i++}o.masterBars.length>0&&(r.length===0&&(o.width+=this._system.accoladeWidth+this.pagePadding[0]),r.push(o),E.debug(this.name,`Finished partial from bar ${o.masterBars[0].index} to ${o.masterBars[o.masterBars.length-1].index}`,null)),this.finalizeStaffSystem();const h=this.renderer.settings.display.scale;this.height=Math.floor(this._system.y+this._system.height)*h,this.width=(this._system.x+this._system.width+this.pagePadding[2])*h,i=0;let c=0;for(let d=0;d<r.length;d++){const f=r[d],p=new Rn;p.x=c,p.y=0,p.totalWidth=this.width/h,p.totalHeight=this.height/h,p.width=f.width,p.height=this.height/h,p.firstMasterBarIndex=f.masterBars[0].index,p.lastMasterBarIndex=f.masterBars[f.masterBars.length-1].index,c+=f.width;const g=i,m=d;this._system.buildBoundingsLookup(0,0),this.registerPartial(p,T=>{let S=this._system.getBarX(f.masterBars[0].index)+this._system.accoladeWidth;m===0&&(S-=this._system.x+this._system.accoladeWidth),T.color=this.renderer.settings.display.resources.mainGlyphColor,T.textAlign=Q.Left,E.debug(this.name,`Rendering partial from bar ${f.masterBars[0].index} to ${f.masterBars[f.masterBars.length-1].index}`,null),this._system.paintPartial(-S,this._system.y,T,g,f.masterBars.length)}),i+=f.masterBars.length}this.height=this.layoutAndRenderBottomScoreInfo(this.height),this.height=this.layoutAndRenderAnnotation(this.height),this.height+=this.pagePadding[3]}finalizeStaffSystem(){this._system.scaleToWidth(this._system.width),this._system.finalizeSystem()}}class WC extends rn{constructor(){super(...arguments),this._systems=[],this._allMasterBarRenderers=[],this._barsFromPreviousSystem=[]}get name(){return"PageView"}doLayoutAndRender(){switch(this.renderer.settings.display.systemsLayoutMode){case tr.Automatic:this.systemsLayoutMode=ks.Automatic;break;case tr.UseModelLayout:this.systemsLayoutMode=ks.FromModelWithScale;break}let e=this.pagePadding[1];this.width=this.renderer.width,this._allMasterBarRenderers=[],e=this.layoutAndRenderScoreInfo(e,-1),e=this.layoutAndRenderTunings(e,-1),e=this.layoutAndRenderChordDiagrams(e,-1),e=this.layoutAndRenderScore(e),e=this.layoutAndRenderBottomScoreInfo(e),e=this.layoutAndRenderAnnotation(e),this.height=(e+this.pagePadding[3])*this.renderer.settings.display.scale}get supportsResize(){return!0}get firstBarX(){let e=this.pagePadding[0];return this._systems.length>0&&(e+=this._systems[0].accoladeWidth),e}doResize(){let e=this.pagePadding[1];this.width=this.renderer.width;const t=this.height;e=this.layoutAndRenderScoreInfo(e,t),e=this.layoutAndRenderTunings(e,t),e=this.layoutAndRenderChordDiagrams(e,t),e=this.resizeAndRenderScore(e,t),e=this.layoutAndRenderBottomScoreInfo(e),e=this.layoutAndRenderAnnotation(e),this.height=(e+this.pagePadding[3])*this.renderer.settings.display.scale}layoutAndRenderTunings(e,t=-1){if(!this.tuningGlyph)return e;const i=this.renderer.settings.display.resources;this.tuningGlyph.x=this.pagePadding[0],this.tuningGlyph.width=this.scaledWidth,this.tuningGlyph.doLayout();const a=Math.round(this.tuningGlyph.height),n=new Rn;return n.x=0,n.y=e,n.width=this.scaledWidth,n.height=a,n.totalWidth=this.scaledWidth,n.totalHeight=t<0?e+n.height:t,this.registerPartial(n,r=>{r.color=i.scoreInfoColor,r.textAlign=Q.Center,this.tuningGlyph.paint(0,0,r)}),e+a}layoutAndRenderChordDiagrams(e,t=-1){if(!this.chordDiagrams)return e;const i=this.renderer.settings.display.resources;this.chordDiagrams.width=this.scaledWidth,this.chordDiagrams.doLayout();const a=Math.round(this.chordDiagrams.height),n=new Rn;return n.x=0,n.y=e,n.width=this.scaledWidth,n.height=a,n.totalWidth=this.scaledWidth,n.totalHeight=t<0?e+a:t,this.registerPartial(n,r=>{r.color=i.scoreInfoColor,r.textAlign=Q.Center,this.chordDiagrams.paint(0,0,r)}),e+a}layoutAndRenderScoreInfo(e,t=-1){E.debug(this.name,"Layouting score info");const i=new Rn;i.x=0,i.y=e;let a=0;const n=this.renderer.settings.display.resources,r=[];for(const[o,l]of rn.HeaderElements.value)if(this.headerGlyphs.has(o)){const h=this.headerGlyphs.get(o);h.y=a,this.alignScoreInfoGlyph(h);let c=h.font.size;o===z.Words&&this.headerGlyphs.has(z.Music)&&this.headerGlyphs.get(z.Music).textAlign!==h.textAlign&&(c=0),a+=c,r.push(h)}return r.length>0&&(a=Math.floor(a+17),i.width=this.scaledWidth,i.height=a,i.totalWidth=this.scaledWidth,i.totalHeight=t<0?e+i.height:t,this.registerPartial(i,o=>{o.color=n.scoreInfoColor,o.textAlign=Q.Center;for(const l of r)l.paint(0,0,o)})),e+a}resizeAndRenderScore(e,t){if(this.renderer.settings.display.barsPerRow>0||this.systemsLayoutMode===ks.FromModelWithScale)for(let a=0;a<this._systems.length;a++){const n=this._systems[a];this.fitSystem(n),e+=this.paintSystem(n,t)}else{this._systems=[];let a=0;const n=this.maxWidth;let r=this.createEmptyStaffSystem();for(r.index=this._systems.length,r.x=this.pagePadding[0],r.y=e;a<this._allMasterBarRenderers.length;){let o=this._allMasterBarRenderers[a];if(r.width+o.width<=n||r.masterBarsRenderers.length===0)r.addMasterBarRenderers(this.renderer.tracks,o),a++;else{for(;o&&!o.canWrap&&r.masterBarsRenderers.length>1;)o=r.revertLastBar(),a--;r.isFull=!0,r.isLast=this.lastBarIndex===r.lastBarIndex,this._systems.push(r),this.fitSystem(r),e+=this.paintSystem(r,t),r=this.createEmptyStaffSystem(),r.index=this._systems.length,r.x=this.pagePadding[0],r.y=e}}r.isLast=this.lastBarIndex===r.lastBarIndex,this.fitSystem(r),e+=this.paintSystem(r,t)}return e}layoutAndRenderScore(e){let i=this.firstBarIndex;const a=this.lastBarIndex;for(this._systems=[];i<=a;){const n=this.createStaffSystem(i,a);this._systems.push(n),n.x=this.pagePadding[0],n.y=e,i=n.lastBarIndex+1,this.fitSystem(n),E.debug(this.name,`Rendering partial from bar ${n.firstBarIndex} to ${n.lastBarIndex}`,null),e+=this.paintSystem(n,e)}return e}paintSystem(e,t){const i=Math.floor(e.height),a=new Rn;return a.x=0,a.y=e.y,a.totalWidth=this.scaledWidth,a.totalHeight=t,a.width=this.scaledWidth,a.height=i,a.firstMasterBarIndex=e.firstBarIndex,a.lastMasterBarIndex=e.lastBarIndex,e.buildBoundingsLookup(0,0),this.registerPartial(a,n=>{this.renderer.canvas.color=this.renderer.settings.display.resources.mainGlyphColor,this.renderer.canvas.textAlign=Q.Left,e.paint(0,-(a.y/this.renderer.settings.display.scale),n)}),i}fitSystem(e){e.isFull||e.width>this.maxWidth||this.renderer.settings.display.justifyLastSystem?e.scaleToWidth(this.maxWidth):e.scaleToWidth(e.width),e.finalizeSystem()}getBarsPerSystem(e){let t=this.renderer.settings.display.barsPerRow;if(this.systemsLayoutMode===ks.FromModelWithScale){let i,a;this.renderer.tracks.length>1?(i=this.renderer.score.defaultSystemsLayout,a=this.renderer.score.systemsLayout):(i=this.renderer.tracks[0].defaultSystemsLayout,a=this.renderer.tracks[0].systemsLayout),t=e<a.length?a[e]:i}return t}createStaffSystem(e,t){const i=this.createEmptyStaffSystem();i.index=this._systems.length;const a=this.getBarsPerSystem(i.index),n=this.maxWidth,r=t+1;let o=e;for(;o<r;){if(this._barsFromPreviousSystem.length>0)for(const d of this._barsFromPreviousSystem)i.addMasterBarRenderers(this.renderer.tracks,d),o=d.lastMasterBarIndex;else{const d=this.multiBarRestInfo,f=d!==null&&d.has(o)?d.get(o):null,p=i.addBars(this.renderer.tracks,o,f);this._allMasterBarRenderers.push(p),o=p.lastMasterBarIndex}this._barsFromPreviousSystem=[];let l=!1;if((a===-1&&i.width>=n&&i.masterBarsRenderers.length!==0||i.masterBarsRenderers.length===a+1)&&(l=!0),l){let d=i.revertLastBar();if(d)for(this._barsFromPreviousSystem.push(d);d&&!d.canWrap&&i.masterBarsRenderers.length>1;)d=i.revertLastBar(),d&&this._barsFromPreviousSystem.push(d);return i.isFull=!0,i.isLast=!1,this._barsFromPreviousSystem.reverse(),i}let h=!1,c=!0;for(const d of this.renderer.tracks)d.lineBreaks&&d.lineBreaks.has(o+1)?h=!0:c=!1;if(h&&c)return i.isFull=!0,i.isLast=!1,i;i.x=0,o++}return i.isLast=t===i.lastBarIndex,i}get maxWidth(){return this.scaledWidth-this.pagePadding[0]-this.pagePadding[2]}}class xa extends Mt{constructor(e,t,i,a){super(e,t,a,xa.getMusicSymbol(i))}static getMusicSymbol(e){switch(e){case ne.Natural:return u.AccidentalNatural;case ne.Sharp:return u.AccidentalSharp;case ne.Flat:return u.AccidentalFlat;case ne.NaturalQuarterNoteUp:return u.AccidentalQuarterToneNaturalArrowUp;case ne.SharpQuarterNoteUp:return u.AccidentalQuarterToneSharpArrowUp;case ne.FlatQuarterNoteUp:return u.AccidentalQuarterToneFlatArrowUp;case ne.DoubleSharp:return u.AccidentalDoubleSharp;case ne.DoubleFlat:return u.AccidentalDoubleFlat}return u.None}}class zg extends Mt{constructor(e,t,i,a){super(e,t,1,zg.getSymbol(i)),this._clef=i,this._clefOttava=a}static getSymbol(e){switch(e){case xe.Neutral:return u.UnpitchedPercussionClef1;case xe.C3:return u.CClef;case xe.C4:return u.CClef;case xe.F4:return u.FClef;case xe.G2:return u.GClef;default:return u.None}}paint(e,t,i){var n;const a=Be.bar(i,Ee.StandardNotationClef,this.renderer.bar);try{super.paint(e,t,i);let r,o=!1;switch(this._clefOttava){case fe._15ma:r=new Mt(-4,0,.5,u.Quindicesima),o=!0;break;case fe._8va:r=new Mt(-2,0,.5,u.Ottava),o=!0;break;case fe._8vb:r=new Mt(-6,0,.5,u.Ottava);break;case fe._15mb:r=new Mt(-8,0,.5,u.Quindicesima);break;default:return}let l=0,h=0;switch(this._clef){case xe.Neutral:l=o?-12:15,h=0;break;case xe.C3:l=o?-19:27,h=0;break;case xe.C4:l=o?-19:27,h=0;break;case xe.F4:l=o?-9:27,h=-4;break;case xe.G2:l=o?-37:30,h=0;break;default:return}r.renderer=this.renderer,r.doLayout();const c=this.width/2;r.paint(e+this.x+c+h,t+this.y+l,i)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}class Gl extends cs{constructor(e,t,i){super(e,t),this._note=i}static getSymbol(e,t){switch(e){case _t.None:return u.None;case _t.Normal:return t?u.ArticAccentAbove:u.ArticAccentBelow;case _t.Heavy:return t?u.ArticMarcatoAbove:u.ArticMarcatoBelow;case _t.Tenuto:return t?u.ArticTenutoAbove:u.ArticTenutoBelow;default:return u.None}}doLayout(){this.width=He.Widths.get(u.ArticAccentAbove),this.height=He.Heights.get(u.ArticAccentAbove)}paint(e,t,i){const a=this.renderer.getBeatDirection(this._note.beat),n=Gl.getSymbol(this._note.accentuated,a===P.Down),o=a===P.Up?t+this.y:t+this.y+this.height-2;i.fillMusicFontSymbol(e+this.x-2,o,1,n,!1)}}class yh extends pt{constructor(e,t,i){super(e,t),this._size=0,this._size=i}doLayout(){this.width=this._size+3}paint(e,t,i){const a=i.color;this.colorOverride&&(i.color=this.colorOverride),i.fillCircle(e+this.x,t+this.y,this._size),i.color=a}}class zC extends Mt{constructor(e,t,i){super(e,t,i?Ye.GraceScale:1,u.NoteheadXOrnate)}}class Eu extends Mt{constructor(e,t,i,a){super(e,t,a?Ye.GraceScale:1,Eu.getSymbol(i))}static getSymbol(e){switch(e){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:case w.Half:return u.NoteheadDiamondWhiteWide;default:return u.NoteheadDiamondBlackWide}}}class Zt extends pt{constructor(e,t,i){super(0,0),this.yOffset=0,this.startNoteRenderer=null,this.endNoteRenderer=null,this.tieDirection=P.Up,this._startX=0,this._startY=0,this._endX=0,this._endY=0,this._tieHeight=0,this._shouldDraw=!1,this.startBeat=e,this.endBeat=t,this.forEnd=i}doLayout(){if(this.width=0,!this.endBeat){this._shouldDraw=!1;return}const e=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar);this.startNoteRenderer=e;const t=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.endBeat.voice.bar);if(this.endNoteRenderer=t,this._startX=0,this._endX=0,this._startY=0,this._endY=0,this.height=0,this._shouldDraw=!1,this.tieDirection=e?this.getBeamDirection(this.startBeat,e):this.getBeamDirection(this.endBeat,t),!this.forEnd&&e?(e!==t?(this._startX=e.x+this.getStartX(),this._startY=e.y+this.getStartY()+this.yOffset,!t||e.staff!==t.staff?(this._endX=e.x+e.width,this._endY=this._startY):(this._endX=t.x+this.getEndX(),this._endY=t.y+this.getEndY()+this.yOffset)):(this._startX=e.x+this.getStartX(),this._endX=t.x+this.getEndX(),this._startY=e.y+this.getStartY()+this.yOffset,this._endY=t.y+this.getEndY()+this.yOffset),this._shouldDraw=!0):(!e||e.staff!==t.staff)&&(this._startX=t.x,this._endX=t.x+this.getEndX(),this._startY=t.y+this.getEndY()+this.yOffset,this._endY=this._startY,this._shouldDraw=!0),this._shouldDraw)if(this.y=Math.min(this._startY,this._endY),this.shouldDrawBendSlur())this._tieHeight=0;else{this._tieHeight=this.getTieHeight(this._startX,this._startY,this._endX,this._endY);const i=Zt.calculateActualTieHeight(1,this._startX,this._startY,this._endX,this._endY,this.tieDirection===P.Down,this._tieHeight,4);if(this.height=i.h,this.tieDirection===P.Up){const a=this.y-i.y;a>0&&(this.y-=a)}}}paint(e,t,i){this._shouldDraw&&(this.shouldDrawBendSlur()?Zt.drawBendSlur(i,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===P.Down,1):Zt.paintTie(i,1,e+this._startX,t+this._startY,e+this._endX,t+this._endY,this.tieDirection===P.Down,this._tieHeight,4))}shouldDrawBendSlur(){return!1}getTieHeight(e,t,i,a){return 22}getBeamDirection(e,t){return P.Down}getStartY(){return 0}getEndY(){return 0}getStartX(){return 0}getEndX(){return 0}static calculateActualTieHeight(e,t,i,a,n,r,o,l){const h=Zt.computeBezierControlPoints(e,t,i,a,n,r,o,l);t=h[0],i=h[1];const c=h[2],d=h[3];a=h[6],n=h[7];const f=(t-c)/(t-2*c+a),p=Zt.calculateExtrema(t,i,c,d,a,n,f),g=p.length>0?Math.min(t,a,p[0]):Math.min(t,a),m=p.length>0?Math.max(t,a,p[0]):Math.max(t,a),T=(i-d)/(i-2*d+n),S=Zt.calculateExtrema(t,i,c,d,a,n,T),y=S.length>0?Math.min(i,n,S[1]):Math.min(i,n),b=S.length>0?Math.max(i,n,S[1]):Math.max(i,n),B=new hi;return B.x=g,B.y=y,B.w=m-g,B.h=b-y,B}static calculateExtrema(e,t,i,a,n,r,o){if(o<=0||1<=o)return[];const l=e+(i-e)*o,h=t+(a-t)*o,c=i+(n-i)*o,d=a+(r-a)*o;return[l+(c-l)*o,h+(d-h)*o]}static computeBezierControlPoints(e,t,i,a,n,r,o,l){if(t===a&&i===n)return[];if(a<t){let y=t;t=a,a=y,y=i,i=n,n=y}o*=e,l*=e;let h=n-i,c=a-t;const d=Math.sqrt(h*h+c*c);r?h*=-1:c*=-1,h/=d,c/=d;const f=(a+t)/2,p=(n+i)/2,g=f+o*h,m=p+o*c,T=f+(o-l)*h,S=p+(o-l)*c;return[t,i,g,m,T,S,a,n]}static paintTie(e,t,i,a,n,r,o=!1,l=22,h=4){const c=Zt.computeBezierControlPoints(t,i,a,n,r,o,l,h);e.beginPath(),e.moveTo(c[0],c[1]),e.quadraticCurveTo(c[2],c[3],c[6],c[7]),e.quadraticCurveTo(c[4],c[5],c[0],c[1]),e.closePath(),e.fill()}static drawBendSlur(e,t,i,a,n,r,o,l){let h=n-i,c=a-t;const d=Math.sqrt(h*h+c*c);r?h*=-1:c*=-1,h/=d,c/=d;const f=(a+t)/2,p=(n+i)/2;let g=Zt.BendSlurHeight*o;a-t<20&&(g/=2);const m=f+g*h,T=p+g*c;if(e.beginPath(),e.moveTo(t,i),e.lineTo(m,T),e.lineTo(a,n),e.stroke(),l){const S=e.measureText(l).width,y=r?0:-e.font.size;e.fillText(l,m-S/2,T+y)}}}Zt.BendSlurHeight=11;class Ro extends pt{constructor(e){super(0,0),this._isOpen=e}doLayout(){super.doLayout(),this.width=Ro.Size}paint(e,t,i){const a=i.color;this.colorOverride&&(i.color=this.colorOverride),this._isOpen?Zt.paintTie(i,1,e+this.x+this.width,t+this.y+this.height,e+this.x+this.width,t+this.y,!1,6,3):Zt.paintTie(i,1,e+this.x,t+this.y,e+this.x,t+this.y+this.height,!1,6,3),i.color=a}}Ro.Size=6;class jy{constructor(e,t,i){this.line=0,this.line=e,this.isGhost=t,this.color=i}}class Du extends pt{constructor(e){super(0,0),this._infos=[],this._glyphs=[],this.isEmpty=!0,this._isOpen=e}addParenthesis(e){const t=this.renderer,i=t.getNoteLine(e),a=e.isGhost||this.isTiedBend(e)&&t.settings.notation.isNotationElementVisible(be.ParenthesisOnTiedBends),n=Be.noteColor(t.resources,Ci.Effects,e);this.add(new jy(i,a,n))}addParenthesisOnLine(e,t){const i=new jy(e,t,void 0);this.add(i)}add(e){this._infos.push(e),e.isGhost&&(this.isEmpty=!1)}isTiedBend(e){return e.isTieDestination?e.tieOrigin.hasBend?!0:this.isTiedBend(e.tieOrigin):!1}doLayout(){const e=this.renderer;this._infos.sort((a,n)=>a.line-n.line);let t=null;const i=e.getScoreHeight(1);for(let a=0,n=this._infos.length;a<n;a++){let r;if(!this._infos[a].isGhost)t=null;else if(!t)r=new Ro(this._isOpen),r.colorOverride=this._infos[a].color,r.renderer=this.renderer,r.y=e.getScoreY(this._infos[a].line)-i,r.height=i*2,r.doLayout(),this._glyphs.push(r),t=r;else{const o=e.getScoreY(this._infos[a].line)+i;t.height=o-t.y}}this.width=this._glyphs.length>0?this._glyphs[0].width:0}paint(e,t,i){super.paint(e,t,i);for(const a of this._glyphs)a.paint(e+this.x,t+this.y,i)}}class GC{constructor(e,t){this.steps=0,this.glyph=e,this.steps=t}}class Pk extends pt{constructor(){super(0,0),this._infos=[],this._noteHeadPadding=0,this.minNote=null,this.maxNote=null,this.spacingChanged=new Bt,this.upLineX=0,this.downLineX=0,this.displacedX=0,this.noteStartX=0}add(e,t){const i=new GC(e,t);this._infos.push(i),(!this.minNote||this.minNote.steps>i.steps)&&(this.minNote=i),(!this.maxNote||this.maxNote.steps<i.steps)&&(this.maxNote=i)}doLayout(){this._infos.sort((o,l)=>l.steps-o.steps);let e=0,t=!1,i=0,a=!1;const n=this.direction;let r=0;for(let o=0,l=this._infos.length;o<l;o++){const h=this._infos[o].glyph;h.renderer=this.renderer,h.doLayout();let c=!1;o===0?e=h.width:Math.abs(i-this._infos[o].steps)<=1?t?t=!1:(c=!0,h.x=e,a=!0,t=!0):t=!1,n===P.Down?h.x=c?0:e:h.x=c?e:0,h.x+=this.noteStartX,i=this._infos[o].steps,r=Math.max(r,h.x+h.width),h instanceof Ye&&h.centerOnStem&&(h.x=e)}a?(this._noteHeadPadding=0,this.upLineX=e,this.downLineX=e):(this._noteHeadPadding=n===P.Down?-e:0,r+=this._noteHeadPadding,this.upLineX=r,this.downLineX=0),this.displacedX=e,this.width=r}paint(e,t,i){e+=this.x,t+=this.y,this.paintLedgerLines(e,t,i);const a=this._infos,n=e+this._noteHeadPadding;for(const r of a)r.glyph.renderer=this.renderer,r.glyph.paint(n,t,i)}paintLedgerLines(e,t,i){var r;if(!this.minNote)return;const a=this.renderer,n=Be.bar(i,Ee.StandardNotationStaffLine,a.bar,!0);try{const l=this.width-this.noteStartX+6,h=a.getLineHeight(1),c=a.getLineY(-1),d=a.getLineY(a.drawnLineCount),f=a.getLineY(this.minNote.steps/2),p=a.getLineY(this.maxNote.steps/2);let g=c;for(;g>=f;)i.fillRect(e-3+this.noteStartX,t+g|0,l,ot.StaffLineThickness),g-=h;for(g=d;g<=p;)i.fillRect(e-3+this.noteStartX,t+g|0,l,ot.StaffLineThickness),g+=h}finally{(r=n==null?void 0:n[Symbol.dispose])==null||r.call(n)}}}class od extends Mt{constructor(e,t,i){super(e,t,1,od.getSymbol(i))}static getSymbol(e){switch(e){case w.ThirtySecond:return u.Tremolo3;case w.Sixteenth:return u.Tremolo2;case w.Eighth:return u.Tremolo1;default:return u.None}}}class ld extends pt{constructor(){super(0,0)}doLayout(){this.width=26}paint(e,t,i){const a=this.renderer,n=a.getLineHeight(a.heightLineCount-1),r=a.getLineY(0),o=a.getLineHeight(a.drawnLineCount-1),l=r+o/2-n/2,h=i.lineWidth;i.lineWidth=2,i.moveTo(e+this.x,t+l),i.lineTo(e+this.x+this.width,t+l+n),i.moveTo(e+this.x,t+l+n),i.lineTo(e+this.x+this.width,t+l),i.stroke(),i.lineWidth=h}}class UC extends Pk{constructor(){super(...arguments),this._noteGlyphLookup=new Map,this._notes=[],this._deadSlapped=null,this._tremoloPicking=null,this.aboveBeatEffects=new Map,this.belowBeatEffects=new Map}get direction(){return this.beamingHelper.direction}getNoteX(e,t){if(this._noteGlyphLookup.has(e.id)){const i=this._noteGlyphLookup.get(e.id);let a=this.x+i.x+this._noteHeadPadding;switch(t){case Ke.Left:break;case Ke.Center:a+=i.width/2;break;case Ke.Right:a+=i.width;break}return a}return 0}getNoteY(e,t){if(this._noteGlyphLookup.has(e.id)){const i=this._noteGlyphLookup.get(e.id);let a=this.y+i.y;switch(t){case $.TopWithStem:a-=this.renderer.getStemSize(this.beamingHelper);break;case $.Top:a-=i.height/2;break;case $.Center:break;case $.Bottom:a+=i.height/2;break;case $.BottomWithStem:a+=this.renderer.getStemSize(this.beamingHelper);break}return a}return 0}addNoteGlyph(e,t,i){super.add(e,i),this._noteGlyphLookup.set(t.id,e),this._notes.push(t)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.upLineX,e+this.x+this.downLineX)}doLayout(){super.doLayout();const e=this.renderer;this.beat.deadSlapped&&(this._deadSlapped=new ld,this._deadSlapped.renderer=this.renderer,this._deadSlapped.doLayout(),this.width=this._deadSlapped.width);const t=this.direction;let i=0,a=0,n=1,r=-n,o=!1,l=!1;this.beat.deadSlapped?(a=e.getScoreY(0),i=e.getScoreY(e.heightLineCount)):this.direction===P.Up?(o=!1,l=!0,a=e.getScoreY(this.maxNote.steps+2),i=e.getScoreY(this.minNote.steps)-e.getStemSize(this.beamingHelper,!0)):(o=!0,l=!1,a=e.getScoreY(this.minNote.steps-1),n*=-1,r*=-1,i=e.getScoreY(this.maxNote.steps)+e.getStemSize(this.beamingHelper,!0));let h=null,c=null;for(const d of this.aboveBeatEffects.values())d.renderer=this.renderer,d.doLayout(),l&&(i+=r*d.height),d.y=i,(h===null||h>i)&&(h=i),(c===null||c<i)&&(c=i),l||(i+=r*d.height);for(const d of this.belowBeatEffects.values())d.renderer=this.renderer,d.doLayout(),o&&(a+=n*d.height),d.y=a,(h===null||h>a)&&(h=a),(c===null||c<a)&&(c=a),o||(a+=n*d.height);if(h!==null&&e.registerBeatEffectOverflows(h,c??0),this.beat.isTremolo&&!this.beat.deadSlapped){let d=0;const f=t===P.Up?this.minNote:this.maxNote;let p=t===P.Up?this.upLineX:this.downLineX;const g=this.beat.tremoloSpeed;switch(g){case w.ThirtySecond:d=t===P.Up?-15:15;break;case w.Sixteenth:d=t===P.Up?-12:15;break;case w.Eighth:d=t===P.Up?-10:10;break;default:d=t===P.Up?-10:15;break}this.beat.duration<w.Half&&(p=this.width/2),this._tremoloPicking=new od(p,f.glyph.y+d,g),this._tremoloPicking.renderer=this.renderer,this._tremoloPicking.doLayout()}}buildBoundingsLookup(e,t,i){for(const a of this._notes)if(this._noteGlyphLookup.has(a.id)){const n=this._noteGlyphLookup.get(a.id),r=new Hh;r.note=a,r.noteHeadBounds=new hi,r.noteHeadBounds.x=t+this.x+this._noteHeadPadding+n.x,r.noteHeadBounds.y=i+this.y+n.y-n.height/2,r.noteHeadBounds.w=n.width,r.noteHeadBounds.h=n.height,e.addNote(r)}}paint(e,t,i){this.paintEffects(e,t,i),super.paint(e,t,i)}paintEffects(e,t,i){var n;const a=Be.beat(i,qe.StandardNotationEffects,this.beat);try{for(const r of this.aboveBeatEffects.values())r.paint(e+this.x+2,t+this.y,i);for(const r of this.belowBeatEffects.values())r.paint(e+this.x+2,t+this.y,i);this._tremoloPicking&&this._tremoloPicking.paint(e,t,i),this._deadSlapped&&this._deadSlapped.paint(e,t,i)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}class zh extends Mt{constructor(e,t,i){super(e,t,1,zh.getSymbol(i))}static getSymbol(e){switch(e){case w.QuadrupleWhole:return u.RestLonga;case w.DoubleWhole:return u.RestDoubleWhole;case w.Whole:return u.RestWhole;case w.Half:return u.RestHalf;case w.Quarter:return u.RestQuarter;case w.Eighth:return u.RestEighth;case w.Sixteenth:return u.RestSixteenth;case w.ThirtySecond:return u.RestThirtySecond;case w.SixtyFourth:return u.RestSixtyFourth;case w.OneHundredTwentyEighth:return u.RestOneHundredTwentyEighth;case w.TwoHundredFiftySixth:return u.RestTwoHundredFiftySixth;default:return u.None}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("score",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,i){this.internalPaint(e,t,i,qe.StandardNotationRests)}internalPaint(e,t,i,a){var r;const n=Be.beat(i,a,this.beat);try{super.paint(e,t,i)}finally{(r=n==null?void 0:n[Symbol.dispose])==null||r.call(n)}}}class e0{constructor(){this.x=0,this.y=-3e3,this.width=0}}class Gg extends da{constructor(){super(0,0)}doLayout(){if(!this.glyphs||this.glyphs.length===0){this.width=0;return}this.glyphs.sort((i,a)=>i.y<a.y?-1:i.y>a.y?1:0);const e=[];e.push(new e0);const t=21;for(let i=0,a=this.glyphs.length;i<a;i++){const n=this.glyphs[i];n.renderer=this.renderer,n.doLayout();let r=0;for(;e[r].y>n.y;)r++,r===e.length&&e.push(new e0);n.x=r,e[r].y=n.y+t,e[r].width<n.width&&(e[r].width=n.width)}this.width=0;for(const i of e)this.width+=i.width,i.x=this.width;for(let i=0,a=this.glyphs.length;i<a;i++){const n=this.glyphs[i],r=e[n.x];n.x=this.width-r.x}}}class ss extends Pk{get direction(){return P.Up}constructor(e,t=!1){super(),this._showParenthesis=!1,this._noteValueLookup=new Map,this._accidentals=new Gg,this._preNoteParenthesis=null,this._postNoteParenthesis=null,this.isEmpty=!0,this.noteHeadOffset=0,this._beat=e,this._showParenthesis=t,t&&(this._preNoteParenthesis=new Du(!0),this._postNoteParenthesis=new Du(!1))}containsNoteValue(e){return this._noteValueLookup.has(e)}getNoteValueY(e){return this._noteValueLookup.has(e)?this.y+this._noteValueLookup.get(e).y:0}addGlyph(e,t,i){const a=this.renderer,n=new Ye(0,0,w.Quarter,!0),r=a.accidentalHelper.applyAccidentalForValue(this._beat,e,t,!0),o=a.accidentalHelper.getNoteLineForValue(e,!1);if(n.y=a.getScoreY(o),this._showParenthesis&&(this._preNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.addParenthesisOnLine(o,!0),this._postNoteParenthesis.addParenthesisOnLine(o,!0)),r!==ne.None){const l=new xa(0,n.y,r,Ye.GraceScale);l.renderer=this.renderer,this._accidentals.renderer=this.renderer,this._accidentals.addGlyph(l)}this._noteValueLookup.set(e,n),this.add(n,o),this.isEmpty=!1}doLayout(){let e=0;this._showParenthesis&&(this._preNoteParenthesis.x=e,this._preNoteParenthesis.renderer=this.renderer,this._preNoteParenthesis.doLayout(),e+=this._preNoteParenthesis.width+ss.ElementPadding),this._accidentals.isEmpty||(e+=this._accidentals.width+ss.ElementPadding,this._accidentals.x=e,this._accidentals.renderer=this.renderer,this._accidentals.doLayout(),e+=this._accidentals.width+ss.ElementPadding),this.noteStartX=e,super.doLayout(),this.noteHeadOffset=this.noteStartX+(this.width-this.noteStartX)/2,this._showParenthesis&&(this._postNoteParenthesis.x=this.width+ss.ElementPadding,this._postNoteParenthesis.renderer=this.renderer,this._postNoteParenthesis.doLayout(),this.width+=this._postNoteParenthesis.width+ss.ElementPadding)}paint(e,t,i){this._accidentals.isEmpty||this._accidentals.paint(e+this.x,t+this.y,i),this._showParenthesis&&(this._preNoteParenthesis.paint(e+this.x,t+this.y,i),this._postNoteParenthesis.paint(e+this.x,t+this.y,i)),super.paint(e,t,i)}}ss.ElementPadding=2;class Ug extends pt{constructor(){super(...arguments),this.BendNoteHeads=[]}drawBendSlur(e,t,i,a,n,r,o,l){Zt.drawBendSlur(e,t,i,a,n,r,o,l)}doLayout(){super.doLayout(),this.width=0;for(const e of this.BendNoteHeads)e.doLayout(),this.width+=e.width+10}getTieDirection(e,t){switch(t.getBeatDirection(e)){case P.Up:return P.Down;default:return P.Up}}}Ug.EndPadding=(10/2|0)+3;class kn extends H{constructor(e=0,t=0){super(e,t),this.lineValue=0,this.lineValue=t}}class Ss extends pt{constructor(){super(0,0),this._notes=[],this._renderPoints=new Map,this._preBendMinValue=-1,this._bendMiddleMinValue=-1,this._bendEndMinValue=-1,this._bendEndContinuedMinValue=-1,this._releaseMinValue=-1,this._releaseContinuedMinValue=-1,this._maxBendValue=-1}addBends(e){this._notes.push(e);const t=this.createRenderingPoints(e);this._renderPoints.set(e.id,t),(this._maxBendValue===-1||this._maxBendValue<e.maxBendPoint.value)&&(this._maxBendValue=e.maxBendPoint.value);let i=0;switch(e.bendType){case q.Bend:i=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(this._bendEndMinValue===-1||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case q.Release:i=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case q.BendRelease:i=t[1].value,(this._bendMiddleMinValue===-1||i<this._bendMiddleMinValue)&&(this._bendMiddleMinValue=i),i=t[2].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break;case q.Prebend:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i);break;case q.PrebendBend:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=t[1].value,e.isTieOrigin?(this._bendEndContinuedMinValue===-1||i<this._bendEndContinuedMinValue)&&(this._bendEndContinuedMinValue=i):(this._bendEndMinValue===-1||i<this._bendEndMinValue)&&(this._bendEndMinValue=i);break;case q.PrebendRelease:i=t[0].value,(this._preBendMinValue===-1||i<this._preBendMinValue)&&(this._preBendMinValue=i),i=t[1].value,e.isTieOrigin?(this._releaseContinuedMinValue===-1||i<this._releaseContinuedMinValue)&&(this._releaseContinuedMinValue=i):i>0&&(this._releaseMinValue===-1||i<this._releaseMinValue)&&(this._releaseMinValue=i);break}}doLayout(){super.doLayout();const e=this._maxBendValue*Ss.BendValueHeight;this.renderer.registerOverflowTop(e);let t=0;for(const i of this._notes){const a=this._renderPoints.get(i.id);switch(i.bendType){case q.Bend:a[1].lineValue=i.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case q.Release:t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(a[1].lineValue=t);break;case q.BendRelease:a[1].lineValue=this._bendMiddleMinValue,t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(a[2].lineValue=t);break;case q.Prebend:a[0].lineValue=this._preBendMinValue;break;case q.PrebendBend:a[0].lineValue=this._preBendMinValue,a[1].lineValue=i.isTieOrigin?this._bendEndContinuedMinValue:this._bendEndMinValue;break;case q.PrebendRelease:a[0].lineValue=this._preBendMinValue,t=i.isTieOrigin?this._releaseContinuedMinValue:this._releaseMinValue,t>=0&&(a[1].lineValue=t);break}}this.width=0,this._notes.sort((i,a)=>i.isStringed?i.string-a.string:i.realValue-a.realValue)}createRenderingPoints(e){const t=[];switch(e.bendType){case q.Custom:for(const i of e.bendPoints)t.push(new kn(i.offset,i.value));break;case q.BendRelease:t.push(new kn(0,e.bendPoints[0].value)),t.push(new kn(H.MaxPosition/2|0,e.bendPoints[1].value)),t.push(new kn(H.MaxPosition,e.bendPoints[3].value));break;case q.Bend:case q.Hold:case q.Prebend:case q.PrebendBend:case q.PrebendRelease:case q.Release:t.push(new kn(0,e.bendPoints[0].value)),t.push(new kn(H.MaxPosition,e.bendPoints[1].value));break}return t}paint(e,t,i){const a=i.color;this._notes.length>1&&(i.color=this.renderer.resources.secondaryGlyphColor);for(const n of this._notes){const r=this._renderPoints.get(n.id),o=this.renderer;let l=n,h=!1,c=null,d=!1;const f=n.bendStyle===Xe.Gradual?"grad.":"";let p=null;for(;l.isTieOrigin;){const b=l.tieDestination;if(c=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,b.beat.voice.bar),!c||o.staff!==c.staff)break;if(l=b,h=!0,l.hasBend||!this.renderer.settings.notation.extendBendArrowsOnTiedNotes||l.vibrato!==ve.None){d=!0;break}}p=l.beat,c=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,p.voice.bar),p.isLastOfVoice&&!l.hasBend&&this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&(p=null);let g=0,m=0;const T=t+o.y;g=e+o.x,r[0].value>0||n.isContinuedBend?g+=o.getBeatX(n.beat,Te.MiddleNotes):g+=o.getNoteX(n,Ke.Right),!p||p.isLastOfVoice&&!d?m=e+c.x+c.postBeatGlyphsStart:d||!p.nextBeat?m=e+c.x+c.getBeatX(p,Te.MiddleNotes):n.bendType===q.Hold?m=e+c.x+c.getBeatX(p.nextBeat,Te.OnNotes):m=e+c.x+c.getBeatX(p.nextBeat,Te.PreNotes),h||(m-=Ss.ArrowSize);const y=(m-g)/H.MaxPosition;i.beginPath();for(let b=0,B=r.length-1;b<B;b++){const N=r[b];let L=r[b+1];b===0&&N.value!==0&&!n.isTieDestination&&this.paintBend(n,new kn(0,0),N,g,T,y,f,i),n.bendType!==q.Prebend?(b===0&&(g+=2),this.paintBend(n,N,L,g,T,y,f,i)):n.isTieOrigin&&n.tieDestination.hasBend&&(L=new kn(H.MaxPosition,N.value),L.lineValue=N.lineValue,this.paintBend(n,N,L,g,T,y,f,i))}if(l.vibrato!==ve.None){const b=m-e+Ss.ArrowSize-c.x,B=T-t-Ss.BendValueHeight*r[r.length-1].lineValue,N=new ar(b,B,l.vibrato,1.2);N.beat=l.beat,N.renderer=c,N.doLayout(),N.paint(e+c.x,t,i)}i.color=a}}paintBend(e,t,i,a,n,r,o,l){const h=this.renderer,c=this.renderer.resources,d=h.lineOffset/2,f=a+r*t.offset,p=Ss.BendValueHeight;let g=n-p*t.lineValue;t.value===0?i.offset===t.offset?g+=h.getNoteY(e.beat.maxStringNote,$.Top):g+=h.getNoteY(e,$.Center):g+=d;const m=a+r*i.offset;let T=n-p*i.lineValue;i.lineValue===0?T+=h.getNoteY(e,$.Center):T+=d;let S=0;const y=Ss.ArrowSize;if(i.value>t.value?(T+y>g&&(T=g-y),l.beginPath(),l.moveTo(m,T),l.lineTo(m-y*.5,T+y),l.lineTo(m+y*.5,T+y),l.closePath(),l.fill(),S=y):i.value!==t.value&&(T<g&&(T=g+y),l.beginPath(),l.moveTo(m,T),l.lineTo(m-y*.5,T-y),l.lineTo(m+y*.5,T-y),l.closePath(),l.fill(),S=-y),l.beginPath(),t.value===i.value){if(t.lineValue>0){let b=m;const B=Ss.DashSize,N=f+B;if((b-f)/(B*2)<1)l.moveTo(b,g),l.lineTo(f,g);else for(;b>N;)l.moveTo(b,g),l.lineTo(b-B,g),b-=B*2;l.stroke()}}else m>f?(l.moveTo(f,g),l.bezierCurveTo((f+m)/2,g,m,g,m,T+S),l.stroke()):(l.moveTo(f,g),l.lineTo(m,T),l.stroke());if(o&&t.offset<i.offset){l.font=c.graceFont;const b=l.measureText(o).width;let B=0,N=0;if(g>T){const L=Math.abs(g-T);B=L>l.font.size*1.3?g-L/2:g,N=(f+m-b)/2}else B=g,N=m-b;l.fillText(o,N,B)}if(i.value!==0&&t.value!==i.value){let b=i.value;const B=i.value>t.value;b=Math.abs(b);let N="";if(b===4)N="full",b-=4;else if(b>=4||b<=-4){const L=b/4|0;N+=L,b-=L*4}if(b>0&&(N+=Ss.getFractionSign(b)),N!==""){T=n-p*i.value;let L=T;B||(L=g+Math.abs(T-g)*1/3),l.font=c.tablatureFont;const _=l.measureText(N).width,A=L-c.tablatureFont.size*.5-2,J=m-_/2;l.fillText(N,J,A)}}}static getFractionSign(e){switch(e){case 1:return"";case 2:return"";case 3:return"";default:return`${e}/ 4`}}}Ss.ArrowSize=6;Ss.DashSize=3;Ss.BendValueHeight=6;class Ds extends pt{constructor(e){super(0,0),this._isSimpleDip=!1,this._beat=e,this._renderPoints=this.createRenderingPoints(e)}createRenderingPoints(e){if(e.whammyBarType===De.Custom)return e.whammyBarPoints;const t=[];switch(e.whammyBarType){case De.Dive:case De.Hold:case De.PrediveDive:case De.Predive:t.push(new H(0,e.whammyBarPoints[0].value)),t.push(new H(H.MaxPosition,e.whammyBarPoints[1].value));break;case De.Dip:t.push(new H(0,e.whammyBarPoints[0].value)),t.push(new H(H.MaxPosition/2|0,e.whammyBarPoints[1].value)),t.push(new H(H.MaxPosition,e.whammyBarPoints[e.whammyBarPoints.length-1].value));break}return t}doLayout(){super.doLayout(),this._isSimpleDip=this.renderer.settings.notation.notationMode===ai.SongBook&&this._beat.whammyBarType===De.Dip;let e=null,t=null,i=this._beat;for(;i&&i.hasWhammyBar;)(!e||e.value>i.minWhammyPoint.value)&&(e=i.minWhammyPoint),(!t||t.value<i.maxWhammyPoint.value)&&(t=i.maxWhammyPoint),i=i.nextBeat;let a=t.value>0?Math.abs(this.getOffset(t.value)):0;(a>0||this._beat.whammyBarPoints[0].value!==0||this.renderer.settings.notation.isNotationElementVisible(be.ZerosOnDiveWhammys))&&(a+=this.renderer.resources.tablatureFont.size*2);const n=e.value<0?Math.abs(this.getOffset(e.value)):0;this.renderer.registerOverflowTop(a+n);const r=this.renderer.staff.getSharedLayoutData(Ds.TopOffsetSharedDataKey,-1);a>r&&this.renderer.staff.setSharedLayoutData(Ds.TopOffsetSharedDataKey,a)}getOffset(e){if(e===0)return 0;let t=Ds.PerHalfSize+Math.log2(Math.abs(e)/2)*Ds.PerHalfSize;return e<0&&(t=-t),t}paint(e,t,i){var n;const a=Be.beat(i,qe.StandardNotationEffects,this._beat);try{const r=this.renderer;let o=this._beat.nextBeat,l=null,h=Te.PreNotes;o&&(l=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,o.voice.bar),!l||l.staff!==r.staff||l!==r&&!o.hasWhammyBar?(o=null,l=null):h=o.hasWhammyBar&&(r.settings.notation.notationMode!==ai.SongBook||o.whammyBarType!==De.Dip)?Te.MiddleNotes:Te.PreNotes);let c=0,d=0;this._isSimpleDip?(c=e+r.x+r.getBeatX(this._beat,Te.OnNotes)-2,d=e+r.x+r.getBeatX(this._beat,Te.PostNotes)+2):(c=e+r.x+r.getBeatX(this._beat,Te.MiddleNotes),d=l?e+l.x+l.getBeatX(o,h):e+r.x+r.width-2);const f=i.textAlign;if(i.textAlign=Q.Center,this._renderPoints.length>=2){const p=(d-c)/H.MaxPosition;i.beginPath();const g=t+this.renderer.staff.getSharedLayoutData(Ds.TopOffsetSharedDataKey,0);let m=this._beat.whammyStyle===Xe.Gradual?"grad.":"";for(let T=0,S=this._renderPoints.length-1;T<S;T++){const y=this._renderPoints[T],b=this._renderPoints[T+1],B=T<S-2?this._renderPoints[T+2]:null;let N=T===0;T===0&&y.value!==0&&!this._beat.isContinuedWhammy&&(this.paintWhammy(!1,new H(0,0),y,b,c,g,p,i),N=!1),this.paintWhammy(N,y,b,B,c,g,p,i,m),m=""}i.stroke()}i.textAlign=f}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}paintWhammy(e,t,i,a,n,r,o,l,h){const c=n+o*t.offset,d=n+o*i.offset,f=r-this.getOffset(t.value),p=r-this.getOffset(i.value);if(t.offset===i.offset){const T=Ds.DashSize;if(Math.abs(p-f)/(T*2)<1)l.moveTo(c,f),l.lineTo(d,p);else{const y=Math.max(f,p);let b=Math.min(f,p);for(;y>b;)l.moveTo(c,b),l.lineTo(c,b+T),b+=T*2}l.stroke()}else if(t.value===i.value){const T=Ds.DashSize;if(Math.abs(d-c)/(T*2)<1)l.moveTo(c,f),l.lineTo(d,p);else{let y=Math.max(c,d);const b=Math.min(c,d);for(;y>b;)l.moveTo(y,f),l.lineTo(y-T,f),y-=T*2}l.stroke()}else l.moveTo(c,f),l.lineTo(d,p);const g=this.renderer.resources;if(e&&!this._beat.isContinuedWhammy&&!this._isSimpleDip){let T=f;T-=g.tablatureFont.size+2,this.renderer.settings.notation.isNotationElementVisible(be.ZerosOnDiveWhammys)&&l.fillText("0",c,T),h&&(T-=g.tablatureFont.size+2,l.fillText(h,c,T))}let m=Math.abs(i.value);if((m!==0||this.renderer.settings.notation.isNotationElementVisible(be.ZerosOnDiveWhammys)&&!this._isSimpleDip)&&t.value!==i.value){let T="";if(i.value<0&&(T+="-"),m>=4){const b=m/4|0;T+=b,m-=b*4}else m===0&&(T+="0");m>0&&(T+=Ss.getFractionSign(m));let S=0;this._isSimpleDip?S=Math.min(f,p)-g.tablatureFont.size-2:(S=t.offset===i.offset?Math.min(f,p):p,S-=g.tablatureFont.size+2,a&&a.value>i.value&&(S-=2));const y=d;l.fillText(T,y,S)}}}Ds.TopOffsetSharedDataKey="tab.whammy.topoffset";Ds.PerHalfSize=6;Ds.DashSize=3;class Dr extends Ug{constructor(e){super(0,0),this._beat=e}doLayout(){const e=this.renderer.settings.notation.notationMode;switch(this._beat.whammyBarType){case De.None:case De.Custom:case De.Hold:return;case De.Dive:case De.PrediveDive:{const t=new ss(this._beat,!1);t.renderer=this.renderer;const i=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(const a of this._beat.notes)a.isTieOrigin||t.addGlyph(this.getBendNoteValue(a,i),i.value%2!==0,void 0);t.doLayout(),this.BendNoteHeads.push(t)}break;case De.Dip:if(e===ai.SongBook){const t=this.renderer.resources;this.renderer.simpleWhammyOverflow=t.tablatureFont.size*1.5+Dr.SimpleDipHeight+Dr.SimpleDipPadding}else{const t=new ss(this._beat,!1);if(t.renderer=this.renderer,this.renderer.settings.notation.notationMode===ai.GuitarPro){const a=this._beat.whammyBarPoints[1];for(const n of this._beat.notes)t.addGlyph(this.getBendNoteValue(n,this._beat.whammyBarPoints[1]),a.value%2!==0,void 0)}t.doLayout(),this.BendNoteHeads.push(t);const i=new ss(this._beat,!1);if(i.renderer=this.renderer,this.renderer.settings.notation.notationMode===ai.GuitarPro){const a=this._beat.whammyBarPoints[this._beat.whammyBarPoints.length-1];for(const n of this._beat.notes)i.addGlyph(this.getBendNoteValue(n,a),a.value%2!==0,void 0)}i.doLayout(),this.BendNoteHeads.push(i)}break;case De.Predive:break}super.doLayout()}paint(e,t,i){var l,h;const a=this._beat;switch(a.whammyBarType){case De.None:case De.Custom:return}const n=this.renderer.settings.notation.notationMode,r=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,a.voice.bar),o=Be.beat(i,qe.StandardNotationEffects,a);try{const c=e+r.x+r.getBeatX(a,Te.MiddleNotes),d=this.getTieDirection(a,r);let f=this._beat.notes.length===1?d:P.Up;const p=i.textAlign,g=He.Heights.get(u.NoteheadBlack);for(let m=0;m<a.notes.length;m++){const T=a.notes[m],S=Be.note(i,Ci.StandardNotationEffects,T);try{let y=t+r.y;m>0&&m>=(this._beat.notes.length/2|0)&&(f=P.Down),f===P.Down?y+=r.getNoteY(T,$.Bottom):y+=r.getNoteY(T,$.Top);let b=e+r.x;a.isLastOfVoice?b+=r.width:b+=r.getBeatX(a,Te.EndBeat),b-=8;const B=a.whammyStyle===Xe.Gradual&&m===0?"grad.":"";let N=null;T.isTieOrigin&&(N=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,T.tieDestination.beat.voice.bar),N&&N.staff===r.staff?b=e+N.x+N.getBeatX(T.tieDestination.beat,Te.MiddleNotes):N=null);let L=g*Ye.GraceScale*.5;f===P.Up&&(L=-L);const _=a.whammyBarPoints.length>0?this.getBendNoteValue(T,a.whammyBarPoints[a.whammyBarPoints.length-1]):0;let A=0,J=!1;switch(this.BendNoteHeads.length>0&&this.BendNoteHeads[0].containsNoteValue(_)?(A=this.BendNoteHeads[0].getNoteValueY(_)+L,J=!0):N&&(T.isTieOrigin&&T.tieDestination.beat.hasWhammyBar||T.beat.isContinuedWhammy)?(A=t+N.y+N.getNoteY(T.tieDestination,$.Top),J=!0,f===P.Down&&(A+=g)):T.isTieOrigin&&(N?A=t+N.y+N.getNoteY(T.tieDestination,$.Top):A=y,f===P.Down&&(A+=g)),a.whammyBarType){case De.Hold:T.isTieOrigin&&Zt.paintTie(i,1,c,y,b,A,d===P.Down,22,4);break;case De.Dive:if(m===0){this.BendNoteHeads[0].x=b-this.BendNoteHeads[0].noteHeadOffset;const Ce=this.BendNoteHeads[0].y;this.BendNoteHeads[0].y=t+r.y,this.BendNoteHeads[0].paint(0,0,i),this.BendNoteHeads[0].containsNoteValue(_)&&(A-=Ce,A+=this.BendNoteHeads[0].y)}J?this.drawBendSlur(i,c,y,b,A,f===P.Down,1,B):T.isTieOrigin&&Zt.paintTie(i,1,c,y,b,A,d===P.Down,22,4);break;case De.Dip:if(n===ai.SongBook){if(m===0){const Ce=e+r.x+r.getBeatX(this._beat,Te.OnNotes)-2,at=e+r.x+r.getBeatX(this._beat,Te.PostNotes)+2,ht=(Ce+at)/2,Qi=((this._beat.whammyBarPoints[1].value-this._beat.whammyBarPoints[0].value)/4|0).toString();i.font=this.renderer.resources.tablatureFont,i.fillText(Qi,ht,t+this.y);const K=t+this.y+i.font.size+2,Se=K+Dr.SimpleDipHeight;this._beat.whammyBarPoints[1].value>this._beat.whammyBarPoints[0].value?(i.moveTo(Ce,Se),i.lineTo(ht,K),i.lineTo(at,Se)):(i.moveTo(Ce,K),i.lineTo(ht,Se),i.lineTo(at,K)),i.stroke()}T.isTieOrigin&&Zt.paintTie(i,1,c,y,b,A,d===P.Down,22,4)}else{const Ce=(c+b)/2;this.BendNoteHeads[0].x=Ce-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+r.y,this.BendNoteHeads[0].paint(0,0,i);const at=this.getBendNoteValue(T,a.whammyBarPoints[1]),ht=this.BendNoteHeads[0].getNoteValueY(at)+L;this.drawBendSlur(i,c,y,Ce,ht,f===P.Down,1,B),this.BendNoteHeads[1].x=b-this.BendNoteHeads[1].noteHeadOffset,this.BendNoteHeads[1].y=t+r.y,this.BendNoteHeads[1].paint(0,0,i),A=this.BendNoteHeads[1].getNoteValueY(_)+L,this.drawBendSlur(i,Ce,ht,b,A,f===P.Down,1,B)}break;case De.PrediveDive:case De.Predive:let G=e+r.x+r.getBeatX(T.beat,Te.PreNotes);G+=r.getPreNotesGlyphForBeat(T.beat).prebendNoteHeadOffset;const ee=t+r.y+r.getScoreY(r.accidentalHelper.getNoteLineForValue(T.displayValue-(T.beat.whammyBarPoints[0].value/2|0),!1))+L;this.drawBendSlur(i,G,ee,c,y,f===P.Down,1,B),this.BendNoteHeads.length>0&&(this.BendNoteHeads[0].x=b-this.BendNoteHeads[0].noteHeadOffset,this.BendNoteHeads[0].y=t+r.y,this.BendNoteHeads[0].paint(0,0,i),this.drawBendSlur(i,c,y,b,A,f===P.Down,1,B));break}}finally{(l=S==null?void 0:S[Symbol.dispose])==null||l.call(S)}}i.textAlign=p}finally{(h=o==null?void 0:o[Symbol.dispose])==null||h.call(o)}}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}Dr.SimpleDipHeight=Ds.PerHalfSize*2;Dr.SimpleDipPadding=2;class oi extends pt{constructor(e,t,i){super(e,t),this.width=i}}class YC extends Mt{constructor(e,t,i,a,n){super(e,t,n?Ye.GraceScale:1,i.getSymbol(a)),this._isGrace=n,this._articulation=i}paint(e,t,i){const a=i.color;this.colorOverride&&(i.color=this.colorOverride);const n=this._isGrace?1:0;i.fillMusicFontSymbol(e+this.x,t+this.y+n,this.glyphScale,this.symbol,!1),this._articulation.techniqueSymbol!==u.None&&this._articulation.techniqueSymbolPlacement===he.Middle&&i.fillMusicFontSymbol(e+this.x,t+this.y+n,this.glyphScale,this._articulation.techniqueSymbol,!1),i.color=a}doLayout(){super.doLayout(),this.width===0&&(this.height=He.Widths.get(u.NoteheadBlack)),this.height===0&&(this.height=He.Heights.get(u.NoteheadBlack))}}class t0 extends Mt{constructor(e,t){super(e,t,Ye.GraceScale,u.ArticStaccatoAbove)}paint(e,t,i){super.paint(e+3,t+5,i)}}class XC extends Mt{constructor(e,t){super(e,t,.5,u.PictEdgeOfCymbal)}paint(e,t,i){super.paint(e-3,t+this.height,i)}}class Lk extends Mt{constructor(e,t,i=!1){super(e,t,Ye.GraceScale,u.GuitarGolpe),this.center=i}paint(e,t,i){super.paint(e,t+this.height,i)}}class qC extends cs{constructor(){super(...arguments),this._strings=new Set}addString(e){this._strings.add(e)}doLayout(){const e=He.Widths.get(u.GuitarString0)*Er.CircleNumberScale;this.height=(e+3)*this._strings.size,this.width=e}paint(e,t,i){const a=this.renderer.bar.staff.tuning.length;let n=0;const r=He.Widths.get(u.GuitarString0)*Er.CircleNumberScale,o=He.Heights.get(u.NoteheadBlack);for(const l of this._strings){const h=a-l,c=u.GuitarString1+h;i.fillMusicFontSymbol(e+this.x+o/2,t+this.y+r+n,Er.CircleNumberScale,c,!0),n+=r+3}}}class Gh extends cs{constructor(e,t,i,a,n){super(e,t),this.beatEffects=new Map,this.noteHeadElement=Ci.SlashNoteHead,this.effectElement=qe.SlashEffects,this._isGrace=a,this._symbol=Gh.getSymbol(i),this.beat=n}paint(e,t,i){var n;const a=this.beat.notes.length===0?void 0:Be.note(i,this.noteHeadElement,this.beat.notes[0]);try{const r=this._isGrace?1:0,o=this._isGrace?Ye.GraceScale:1;i.fillMusicFontSymbol(e+this.x,t+this.y+r,o,this._symbol,!1),this.paintEffects(e,t,i)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}paintEffects(e,t,i){var n;const a=Be.beat(i,this.effectElement,this.beat);try{for(const r of this.beatEffects.values())r.paint(e+this.x,t+this.y,i)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}doLayout(){const e=this._isGrace?Ye.GraceScale:1;this.width=He.Widths.get(this._symbol)*e,this.height=He.Heights.get(this._symbol)*e;const t=7;let i=He.Heights.get(this._symbol);for(const a of this.beatEffects.values())a.y+=i,a.x+=this.width/2,a.renderer=this.renderer,i+=t,a.doLayout()}static getSymbol(e){switch(e){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:return u.NoteheadSlashWhiteWhole;case w.Half:return u.NoteheadSlashWhiteHalf;default:return u.NoteheadSlashVerticalEnds}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width,e+this.x)}}class JC extends lr{constructor(){super(...arguments),this._collisionOffset=-1e3,this._skipPaint=!1,this.slash=null,this.noteHeads=null,this.restGlyph=null}get effectElement(){return qe.StandardNotationEffects}getNoteX(e,t){return this.noteHeads?this.noteHeads.getNoteX(e,t):0}buildBoundingsLookup(e,t,i){this.noteHeads&&this.noteHeads.buildBoundingsLookup(e,t+this.x,i+this.y)}getNoteY(e,t){return this.noteHeads?this.noteHeads.getNoteY(e,t):0}updateBeamingHelper(){if(this.noteHeads)this.noteHeads.updateBeamingHelper(this.container.x+this.x);else if(this.restGlyph){if(this.restGlyph.updateBeamingHelper(this.container.x+this.x),this.renderer.bar.isMultiVoice&&this._collisionOffset===-1e3){this._collisionOffset=this.renderer.helpers.collisionHelper.applyRestCollisionOffset(this.container.beat,this.restGlyph.y,this.renderer.getScoreHeight(1)),this.y+=this._collisionOffset;const e=this.renderer.helpers.collisionHelper.restDurationsByDisplayTime;e.has(this.container.beat.playbackStart)&&e.get(this.container.beat.playbackStart).has(this.container.beat.playbackDuration)&&e.get(this.container.beat.playbackStart).get(this.container.beat.playbackDuration)!==this.container.beat.id&&(this._skipPaint=!0)}}else this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}paint(e,t,i){this._skipPaint||super.paint(e,t,i)}doLayout(){const e=this.renderer;if(!this.container.beat.isEmpty)if(this.container.beat.isRest){let t=Math.ceil((this.renderer.bar.staff.standardNotationLineCount-1)/2)*2;this.container.beat.duration===w.Whole&&this.renderer.bar.staff.standardNotationLineCount!==1&&this.renderer.bar.staff.standardNotationLineCount!==3&&(t-=2);const i=new zh(0,e.getScoreY(t),this.container.beat.duration);if(this.restGlyph=i,i.beat=this.container.beat,i.beamingHelper=this.beamingHelper,this.addNormal(i),this.renderer.bar.isMultiVoice)if(this.container.beat.voice.index===0){const a=ha.computeLineHeightsForRest(this.container.beat.duration),n=i.y-e.getScoreHeight(a[0]),r=i.y+e.getScoreHeight(a[1]);this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,n,r)}else this.renderer.helpers.collisionHelper.registerRest(this.container.beat);if(this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,t),this.container.beat.dots>0){this.addNormal(new oi(0,0,5));for(let a=0;a<this.container.beat.dots;a++){const n=new da(0,0);n.renderer=this.renderer,this.createBeatDot(t,n),this.addEffect(n)}}}else{if(this.container.beat.slashed){const t=this.container.beat.graceType!==se.None,i=(e.heightLineCount-1)/2,a=e.getLineY(i),n=new Gh(0,a,this.container.beat.duration,t,this.container.beat);n.noteHeadElement=Ci.StandardNotationNoteHead,n.effectElement=qe.StandardNotationEffects,this.slash=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addNormal(n)}else{const t=new UC;this.noteHeads=t,t.beat=this.container.beat,t.beamingHelper=this.beamingHelper;const i=new Du(!1);i.renderer=this.renderer;for(const a of this.container.beat.notes)a.isVisible&&(this.createNoteGlyph(a),i.addParenthesis(a));this.addNormal(t),i.isEmpty||(this.addNormal(new oi(0,0,4*(this.container.beat.graceType!==se.None?Ye.GraceScale:1))),this.addEffect(i))}if(this.container.beat.hasWhammyBar){const t=new Dr(this.container.beat);t.renderer=this.renderer,t.doLayout(),this.container.ties.push(t)}if(this.container.beat.dots>0){this.addNormal(new oi(0,0,5));for(let t=0;t<this.container.beat.dots;t++){const i=new da(0,0);i.renderer=this.renderer;for(const a of this.container.beat.notes){const n=this.createBeatDot(e.getNoteLine(a),i);n.colorOverride=Be.noteColor(e.resources,Ci.StandardNotationEffects,a)}this.addEffect(i)}}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}createBeatDot(e,t){const i=this.renderer,a=new yh(0,i.getScoreY(e),1.5);return t.addGlyph(a),a}createNoteHeadGlyph(e){const t=this.container.beat.graceType!==se.None,i=e.style;if((i==null?void 0:i.noteHead)!==void 0){const a=new Ye(0,0,e.beat.duration,t);return a.symbol=i.noteHead,i.noteHeadCenterOnStem&&(a.centerOnStem=!0),a}if(e.beat.voice.bar.staff.isPercussion){const a=At.getArticulation(e);if(a)return new YC(0,0,a,e.beat.duration,t);E.warning("Rendering",`No articulation found for percussion instrument ${e.percussionArticulation}`)}return e.isDead?new zC(0,0,t):e.beat.graceType===se.BendGrace?new Ye(0,0,w.Quarter,!0):e.harmonicType===ae.Natural?new Eu(0,0,e.beat.duration,t):new Ye(0,0,e.beat.duration,t)}createNoteGlyph(e){if(e.beat.graceType===se.BendGrace&&!e.hasBend)return;const t=this.renderer,i=this.createNoteHeadGlyph(e);i.colorOverride=Be.noteColor(t.resources,Ci.StandardNotationNoteHead,e);let a=t.getNoteLine(e);if(i.y=t.getScoreY(a),this.noteHeads.addNoteGlyph(i,e,a),e.harmonicType!==ae.None&&e.harmonicType!==ae.Natural){const o=e.displayValue+e.harmonicPitch,l=new Eu(0,0,e.beat.duration,this.container.beat.graceType!==se.None);l.colorOverride=i.colorOverride,a=t.accidentalHelper.getNoteLineForValue(o,!1),l.y=t.getScoreY(a),this.noteHeads.addNoteGlyph(l,e,a)}const n=this.noteHeads.belowBeatEffects,r=this.noteHeads.aboveBeatEffects;if(e.isStaccato&&!n.has("Staccato")&&n.set("Staccato",new t0(0,0)),e.accentuated===_t.Normal&&!n.has("Accent")&&n.set("Accent",new Gl(0,0,e)),e.accentuated===_t.Heavy&&!n.has("HAccent")&&n.set("HAccent",new Gl(0,0,e)),e.accentuated===_t.Tenuto&&!n.has("Tenuto")&&n.set("Tenuto",new Gl(0,0,e)),e.showStringNumber&&e.isStringed){let o;r.has("StringNumber")?o=r.get("StringNumber"):(o=new qC(0,0),r.set("StringNumber",o)),o.addString(e.string)}if(e.isPercussion){const o=At.getArticulation(e);if(o&&o.techniqueSymbolPlacement!==he.Middle){const l=o.techniqueSymbolPlacement===he.Top?this.noteHeads.aboveBeatEffects:this.noteHeads.belowBeatEffects;switch(o.techniqueSymbol){case u.PictEdgeOfCymbal:l.set("PictEdgeOfCymbal",new XC(0,0));break;case u.ArticStaccatoAbove:l.set("ArticStaccatoAbove",new t0(0,0));break;case u.StringsUpBow:l.set("StringsUpBow",new mh(0,0,ni.Up));break;case u.StringsDownBow:l.set("StringsDownBow",new mh(0,0,ni.Down));break;case u.GuitarGolpe:l.set("GuitarGolpe",new Lk(0,0));break}}}}}class QC extends pt{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=this._beat.brushType===Y.ArpeggioUp||this._beat.brushType===Y.ArpeggioDown?10:0}paint(e,t,i){if(this._beat.brushType===Y.ArpeggioUp||this._beat.brushType===Y.ArpeggioDown){const a=this.renderer,n=a.lineOffset,r=t+this.y+(a.getNoteY(this._beat.maxNote,$.Bottom)-n),o=t+this.y+a.getNoteY(this._beat.minNote,$.Top)+n,l=e+this.x+this.width/2,h=8,c=new ar(0,0,ve.Slight,1.2,!0);c.renderer=this.renderer,c.doLayout();const d=-c.height/2;if(this._beat.brushType===Y.ArpeggioUp){const f=r+h,p=o-h;c.width=Math.abs(p-f),i.beginRotate(e+this.x+5,p,-90),c.paint(0,d,i),i.endRotate(),i.beginPath(),i.moveTo(l,o),i.lineTo(l+h/2,o-h),i.lineTo(l-h/2,o-h),i.closePath(),i.fill()}else if(this._beat.brushType===Y.ArpeggioDown){const f=r+h,p=o;c.width=Math.abs(p-f),i.beginRotate(e+this.x+5,f,90),c.paint(0,d,i),i.endRotate(),i.beginPath(),i.moveTo(l,r),i.lineTo(l+h/2,r+h),i.lineTo(l-h/2,r+h),i.closePath(),i.fill()}}}}class KC{constructor(e,t){this.line=0,this.line=e,this.text=t}}class $C extends da{constructor(){super(0,0),this._infos=new Map}get isEmpty(){return this._infos.size===0}addFingers(e){const t=this.renderer.settings;if(t.notation.fingeringMode!==ua.ScoreDefault&&t.notation.fingeringMode!==ua.ScoreForcePiano)return;const i=V.fingerToString(this.renderer.settings,e.beat,e.leftHandFinger,!0);i&&this.addFinger(e,i);const a=V.fingerToString(this.renderer.settings,e.beat,e.rightHandFinger,!1);a&&this.addFinger(e,a)}addFinger(e,t){const i=this.renderer,a=i.getNoteLine(e);if(this._infos.has(a)){const n=this._infos.get(a);n.text+=t}else{const n=new KC(a,t);n.color=Be.noteColor(i.resources,Ci.StandardNotationEffects,e),this._infos.set(a,n)}}doLayout(){const e=this.renderer;for(const[t,i]of this._infos){const a=new os(0,0,i.text,e.resources.inlineFingeringFont,Q.Left,he.Middle);a.colorOverride=i.color,a.renderer=e,a.y=e.getScoreY(i.line),a.doLayout(),this.addGlyph(a),this.width=Math.max(this.width,a.width)}}}class ZC extends or{constructor(){super(...arguments),this._prebends=null,this.accidentals=null}get prebendNoteHeadOffset(){return this._prebends?this._prebends.x+this._prebends.noteHeadOffset:0}get effectElement(){return qe.StandardNotationEffects}doLayout(){if(!this.container.beat.isRest){const e=new Gg;e.renderer=this.renderer;const t=new $C;t.renderer=this.renderer;const i=new Du(!0);i.renderer=this.renderer;const a=new ss(this.container.beat,!0);this._prebends=a,a.renderer=this.renderer;for(const n of this.container.beat.notes){const r=Be.noteColor(this.renderer.resources,Ci.StandardNotationEffects,n);if(n.isVisible){if(n.hasBend)switch(n.bendType){case q.PrebendBend:case q.Prebend:case q.PrebendRelease:a.addGlyph(n.displayValue-(n.bendPoints[0].value/2|0),!1,r);break}else if(n.beat.hasWhammyBar)switch(n.beat.whammyBarType){case De.PrediveDive:case De.Predive:this._prebends.addGlyph(n.displayValue-(n.beat.whammyBarPoints[0].value/2|0),!1,r);break}this.createAccidentalGlyph(n,e),i.addParenthesis(n),t.addFingers(n)}}a.isEmpty||(this.addEffect(a),this.addNormal(new oi(0,0,4*(this.container.beat.graceType!==se.None?Ye.GraceScale:1)))),this.container.beat.brushType!==Y.None&&(this.addEffect(new QC(this.container.beat)),this.addNormal(new oi(0,0,4))),t.isEmpty||(this.isEmpty||this.addNormal(new oi(0,0,2*(this.container.beat.graceType!==se.None?Ye.GraceScale:1))),this.addEffect(t),this.addNormal(new oi(0,0,2*(this.container.beat.graceType!==se.None?Ye.GraceScale:1)))),i.isEmpty||(this.addEffect(i),this.addNormal(new oi(0,0,4*(this.container.beat.graceType!==se.None?Ye.GraceScale:1)))),e.isEmpty||(this.accidentals=e,this.isEmpty||this.addNormal(new oi(0,0,2*(this.container.beat.graceType!==se.None?Ye.GraceScale:1))),this.addNormal(e),this.addNormal(new oi(0,0,2*(this.container.beat.graceType!==se.None?Ye.GraceScale:1))))}super.doLayout()}createAccidentalGlyph(e,t){const i=this.renderer;let a=i.accidentalHelper.applyAccidental(e),n=i.getNoteLine(e);const r=this.container.beat.graceType!==se.None,o=Be.noteColor(i.resources,Ci.StandardNotationAccidentals,e),l=r?Ye.GraceScale:1;if(a!==ne.None){const h=new xa(0,i.getScoreY(n),a,l);h.colorOverride=o,h.renderer=this.renderer,t.addGlyph(h)}if(e.harmonicType!==ae.None&&e.harmonicType!==ae.Natural){const h=e.displayValue+e.harmonicPitch;a=i.accidentalHelper.applyAccidentalForValue(e.beat,h,r,!1),n=i.accidentalHelper.getNoteLineForValue(h,!1);const c=new xa(0,i.getScoreY(n),a,l);c.colorOverride=o,c.renderer=this.renderer,t.addGlyph(c)}}}class Ak extends da{constructor(e,t,i,a,n,r){super(e,t),this._numerator=0,this._denominator=0,this.barSubElement=Ee.StandardNotationTimeSignature,this._numerator=i,this._denominator=a,this._isCommon=n,this._isFreeTime=r}paint(e,t,i){var n;const a=Be.bar(i,this.barSubElement,this.renderer.bar);try{super.paint(e,t,i)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}doLayout(){let e=0;const t=Jn.numberHeight;if(this._isFreeTime){const i=new Ro(!0);i.renderer=this.renderer,i.y=-t,i.height=t*2,i.doLayout(),this.addGlyph(i),e+=i.width+10*1}if(this._isCommon&&this._numerator===2&&this._denominator===2){const i=new Mt(e,0,this.commonScale,u.TimeSigCutCommon);this.addGlyph(i),super.doLayout()}else if(this._isCommon&&this._numerator===4&&this._denominator===4){const i=new Mt(e,0,this.commonScale,u.TimeSigCommon);this.addGlyph(i),super.doLayout()}else{const i=new Jn(e,-t/2,this._numerator,this.numberScale),a=new Jn(e,t/2,this._denominator,this.numberScale);this.addGlyph(i),this.addGlyph(a),super.doLayout();const n=this.width-e;i.x=e+(n-i.width)/2,a.x=e+(n-a.width)/2}if(this._isFreeTime){const i=new Ro(!1);i.renderer=this.renderer,i.x=this.width+13,i.y=-t,i.height=t*2,i.doLayout(),this.addGlyph(i),this.width=i.x+i.width}}}class Yg extends Ak{get commonScale(){return 1}get numberScale(){return 1}}class jC extends Ug{constructor(e){super(0,0),this._notes=[],this._endNoteGlyph=null,this._middleNoteGlyph=null,this._beat=e}addBends(e){if(this._notes.push(e),e.isTieOrigin)return;const t=Be.noteColor(this.renderer.resources,Ci.StandardNotationEffects,e);switch(e.bendType){case q.Bend:case q.PrebendRelease:case q.PrebendBend:{let i=this._endNoteGlyph;i||(i=new ss(e.beat,!1),i.renderer=this.renderer,this._endNoteGlyph=i,this.BendNoteHeads.push(i));const a=e.bendPoints[e.bendPoints.length-1];i.addGlyph(this.getBendNoteValue(e,a),a.value%2!==0,t)}break;case q.Release:if(!e.isTieOrigin){let i=this._endNoteGlyph;i||(i=new ss(e.beat,!1),i.renderer=this.renderer,this._endNoteGlyph=i,this.BendNoteHeads.push(i));const a=e.bendPoints[e.bendPoints.length-1];i.addGlyph(this.getBendNoteValue(e,a),a.value%2!==0,t)}break;case q.BendRelease:{let i=this._middleNoteGlyph;i||(i=new ss(e.beat,!1),this._middleNoteGlyph=i,i.renderer=this.renderer,this.BendNoteHeads.push(i));const a=e.bendPoints[1];i.addGlyph(this.getBendNoteValue(e,e.bendPoints[1]),a.value%2!==0,t);let n=this._endNoteGlyph;n||(n=new ss(e.beat,!1),n.renderer=this.renderer,this._endNoteGlyph=n,this.BendNoteHeads.push(n));const r=e.bendPoints[e.bendPoints.length-1];n.addGlyph(this.getBendNoteValue(e,r),r.value%2!==0,t)}break}}paint(e,t,i){var d;const a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._beat.voice.bar),n=e+a.x+a.getBeatX(this._beat,Te.MiddleNotes);let r=e+a.x;this._beat.isLastOfVoice?r+=a.postBeatGlyphsStart:r+=a.getBeatX(this._beat.nextBeat,Te.PreNotes),r-=8;const o=(n+r)/2;this._middleNoteGlyph&&(this._middleNoteGlyph.x=o-this._middleNoteGlyph.noteHeadOffset,this._middleNoteGlyph.y=t+a.y,this._middleNoteGlyph.paint(0,0,i)),this._endNoteGlyph&&(this._endNoteGlyph.x=r-this._endNoteGlyph.noteHeadOffset,this._endNoteGlyph.y=t+a.y,this._endNoteGlyph.paint(0,0,i)),this._notes.sort((f,p)=>p.displayValue-f.displayValue);const l=this._beat.graceType===se.BendGrace?this._beat.nextBeat:this._beat;let h=this._notes.length===1?this.getTieDirection(l,a):P.Up;const c=He.Heights.get(u.NoteheadBlack);for(let f=0;f<this._notes.length;f++){const p=this._notes[f],g=Be.note(i,Ci.StandardNotationEffects,p);try{f>0&&f>=(this._notes.length/2|0)&&(h=P.Down);let m=t+a.y+a.getNoteY(p,$.Top),T=c*Ye.GraceScale*.5;h===P.Down&&(m+=c);const S=p.bendStyle===Xe.Gradual?"grad.":"";if(p.isTieOrigin){const y=p.tieDestination,b=y?this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,y.beat.voice.bar):null;if(!b||b.staff!==a.staff){const B=e+a.x+a.width,N=p.tieDestination.realValue;a.accidentalHelper.applyAccidentalForValue(p.beat,N,!1,!0);const L=t+a.y+a.getScoreY(a.accidentalHelper.getNoteLineForValue(N,!1));p.bendType===q.Hold||p.bendType===q.Prebend?Zt.paintTie(i,1,n,m,B,L,h===P.Down,22,4):this.drawBendSlur(i,n,m,B,L,h===P.Down,1,S)}else{const B=e+b.x+b.getBeatX(y.beat,Te.MiddleNotes);let N=t+b.y+b.getNoteY(y,$.Top);h===P.Down&&(N+=c),p.bendType===q.Hold||p.bendType===q.Prebend?Zt.paintTie(i,1,n,m,B,N,h===P.Down,22,4):this.drawBendSlur(i,n,m,B,N,h===P.Down,1,S)}switch(p.bendType){case q.Prebend:case q.PrebendBend:case q.PrebendRelease:let B=e+a.x+a.getBeatX(p.beat,Te.PreNotes);B+=a.getPreNotesGlyphForBeat(p.beat).prebendNoteHeadOffset;const N=t+a.y+a.getScoreY(a.accidentalHelper.getNoteLineForValue(p.displayValue-(p.bendPoints[0].value/2|0),!1))+T;this.drawBendSlur(i,B,N,n,m,h===P.Down,1);break}}else{h===P.Up&&(T=-T);let y=0,b=0;switch(p.bendType){case q.Bend:y=this.getBendNoteValue(p,p.bendPoints[p.bendPoints.length-1]),b=this._endNoteGlyph.getNoteValueY(y)+T,this.drawBendSlur(i,n,m,r,b,h===P.Down,1,S);break;case q.BendRelease:const B=this.getBendNoteValue(p,p.bendPoints[1]),N=this._middleNoteGlyph.getNoteValueY(B)+T;this.drawBendSlur(i,n,m,o,N,h===P.Down,1,S),y=this.getBendNoteValue(p,p.bendPoints[p.bendPoints.length-1]),b=this._endNoteGlyph.getNoteValueY(y)+T,this.drawBendSlur(i,o,N,r,b,h===P.Down,1,S);break;case q.Release:this.BendNoteHeads.length>0&&(y=this.getBendNoteValue(p,p.bendPoints[p.bendPoints.length-1]),b=this.BendNoteHeads[0].getNoteValueY(y)+T,this.drawBendSlur(i,n,m,r,b,h===P.Down,1,S));break;case q.Prebend:case q.PrebendBend:case q.PrebendRelease:let L=e+a.x+a.getBeatX(p.beat,Te.PreNotes);L+=a.getPreNotesGlyphForBeat(p.beat).prebendNoteHeadOffset;const _=t+a.y+a.getScoreY(a.accidentalHelper.getNoteLineForValue(p.displayValue-(p.bendPoints[0].value/2|0),!1))+T;this.drawBendSlur(i,L,_,n,m,h===P.Down,1),this.BendNoteHeads.length>0&&(y=this.getBendNoteValue(p,p.bendPoints[p.bendPoints.length-1]),b=this.BendNoteHeads[0].getNoteValueY(y)+T,this.drawBendSlur(i,n,m,r,b,h===P.Down,1,S));break}}}finally{(d=g==null?void 0:g[Symbol.dispose])==null||d.call(g)}}}getBendNoteValue(e,t){return e.displayValueWithoutBend+(t.value/2|0)}}class wp extends Zt{constructor(e,t,i=!1){super(e,t,i)}doLayout(){super.doLayout()}getBeamDirection(e,t){if(e.isRest)return P.Up;switch(t.getBeatDirection(e)){case P.Up:return P.Down;default:return P.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case P.Up:return this.startNoteRenderer.getNoteY(this.startBeat.maxNote,$.Top);default:return this.startNoteRenderer.getNoteY(this.startBeat.minNote,$.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case P.Up:return e.getScoreY(9);default:return e.getScoreY(0)}const t=this.startNoteRenderer.getBeatDirection(this.startBeat),i=e.getBeatDirection(this.endBeat);if(t!==i&&this.startBeat.graceType===se.None){if(i===this.tieDirection)switch(this.tieDirection){case P.Up:return e.getNoteY(this.endBeat.maxNote,$.TopWithStem);default:return e.getNoteY(this.endBeat.minNote,$.BottomWithStem)}switch(this.tieDirection){case P.Up:return e.getNoteY(this.endBeat.maxNote,$.BottomWithStem);default:return e.getNoteY(this.endBeat.minNote,$.TopWithStem)}}switch(this.tieDirection){case P.Up:return e.getNoteY(this.endBeat.maxNote,$.Top);default:return e.getNoteY(this.endBeat.minNote,$.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startBeat,Te.MiddleNotes)}getEndX(){const e=this.endNoteRenderer.getBeatDirection(this.endBeat);return this.endNoteRenderer.getBeatX(this.endBeat,this.endBeat.duration>w.Whole&&e===this.tieDirection?Te.Stem:Te.MiddleNotes)}}class e2 extends pt{constructor(e,t,i,a){super(0,0),this._outType=t,this._inType=e,this._startNote=i,this._parent=a}doLayout(){this.width=0}paint(e,t,i){this.paintSlideIn(e,t,i),this.drawSlideOut(e,t,i)}paintSlideIn(e,t,i){const a=this.renderer,n=12;let r=e+a.x+a.getNoteX(this._startNote,Ke.Left)-2;const o=t+a.y+a.getNoteY(this._startNote,$.Center);let l=r-n,h=t+a.y;switch(this._inType){case jt.IntoFromBelow:h+=a.getNoteY(this._startNote,$.Bottom);break;case jt.IntoFromAbove:h+=a.getNoteY(this._startNote,$.Top);break;default:return}const c=this.getAccidentalsWidth(a,this._startNote.beat);l-=c,r-=c,this.paintSlideLine(i,!1,l,r,h,o)}getAccidentalsWidth(e,t){const i=e.getPreNotesGlyphForBeat(t);return i&&i.accidentals?i.accidentals.width:0}drawSlideOut(e,t,i){const a=this.renderer,n=12,r=2,o=2;let l=0,h=0,c=0,d=0,f=!1;switch(this._outType){case pe.Shift:case pe.Legato:if(l=e+a.x+a.getBeatX(this._startNote.beat,Te.PostNotes)+r,h=t+a.y+a.getNoteY(this._startNote,$.Center),this._startNote.slideTarget){const p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._startNote.slideTarget.beat.voice.bar);!p||p.staff!==a.staff?(c=e+a.x+a.width,d=h):(c=e+p.x+p.getBeatX(this._startNote.slideTarget.beat,Te.PreNotes)-r,d=t+p.y+p.getNoteY(this._startNote.slideTarget,$.Center)),this._startNote.slideTarget.realValue>this._startNote.realValue?(h+=o,d-=o):(h-=o,d+=o)}else c=e+a.x+this._parent.x,d=h;break;case pe.OutUp:l=e+a.x+a.getNoteX(this._startNote,Ke.Right)+r,h=t+a.y+a.getNoteY(this._startNote,$.Center),c=l+n,d=t+a.y+a.getNoteY(this._startNote,$.Top);break;case pe.OutDown:l=e+a.x+a.getNoteX(this._startNote,Ke.Right)+r,h=t+a.y+a.getNoteY(this._startNote,$.Center),c=l+n,d=t+a.y+a.getNoteY(this._startNote,$.Bottom);break;case pe.PickSlideUp:l=e+a.x+a.getNoteX(this._startNote,Ke.Right)+r*2,h=t+a.y+a.getNoteY(this._startNote,$.Center),d=t+a.y+a.getNoteY(this._startNote,$.Top),c=e+a.x+a.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(c=e+a.x+a.getBeatX(this._startNote.beat.nextBeat,Te.PreNotes)),f=!0;break;case pe.PickSlideDown:l=e+a.x+a.getNoteX(this._startNote,Ke.Right)+r*2,h=t+a.y+a.getNoteY(this._startNote,$.Center),d=t+a.y+a.getNoteY(this._startNote,$.Bottom),c=e+a.x+a.width,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(c=e+a.x+a.getBeatX(this._startNote.beat.nextBeat,Te.PreNotes)),f=!0;break;default:return}this.paintSlideLine(i,f,l,c,h,d)}paintSlideLine(e,t,i,a,n,r){if(t){const o=new ar(0,0,ve.Slight,1.2);o.renderer=this.renderer,o.doLayout(),n-=o.height/2,r-=o.height/2;const l=a-i,h=r-n,c=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));o.width=l;const d=Math.asin(h/c)*(180/Math.PI);e.beginRotate(i,n,d),o.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(i,n),e.lineTo(a,r),e.stroke()}}class lc extends wp{constructor(e,t,i=!1){super(e.beat,t.beat,i),this._startNote=e,this._endNote=t}getTieHeight(e,t,i,a){return Math.log2(i-e+1)*this.renderer.settings.notation.slurHeight}getStartY(){if(this.isStartCentered())switch(this.tieDirection){case P.Up:return this.startNoteRenderer.getNoteY(this._startNote,$.Top);default:return this.startNoteRenderer.getNoteY(this._startNote,$.Bottom)}return this.startNoteRenderer.getNoteY(this._startNote,$.Center)}getEndY(){if(this.isEndCentered()){if(this.isEndOnStem())switch(this.tieDirection){case P.Up:return this.endNoteRenderer.getNoteY(this._endNote,$.TopWithStem);default:return this.endNoteRenderer.getNoteY(this._endNote,$.BottomWithStem)}switch(this.tieDirection){case P.Up:return this.endNoteRenderer.getNoteY(this._endNote,$.Top);default:return this.endNoteRenderer.getNoteY(this._endNote,$.Bottom)}}return this.endNoteRenderer.getNoteY(this._endNote,$.Center)}isStartCentered(){return this._startNote===this._startNote.beat.maxNote&&this.tieDirection===P.Up||this._startNote===this._startNote.beat.minNote&&this.tieDirection===P.Down}isEndCentered(){return this._startNote.beat.graceType===se.None&&(this._endNote===this._endNote.beat.maxNote&&this.tieDirection===P.Up||this._endNote===this._endNote.beat.minNote&&this.tieDirection===P.Down)}isEndOnStem(){const e=this.endNoteRenderer,t=this.startNoteRenderer.getBeatDirection(this.startBeat),i=e.getBeatDirection(this.endBeat);return t!==i&&this.startBeat.graceType===se.None}getStartX(){return this.isStartCentered()?this.startNoteRenderer.getBeatX(this._startNote.beat,Te.MiddleNotes):this.startNoteRenderer.getNoteX(this._startNote,Ke.Right)}getEndX(){return this.isEndCentered()?this.isEndOnStem()?this.endNoteRenderer.getBeatX(this._endNote.beat,Te.Stem):this.endNoteRenderer.getNoteX(this._endNote,Ke.Center):this.endNoteRenderer.getBeatX(this._endNote.beat,Te.PreNotes)}}class i0 extends Zt{constructor(e,t,i=!1){super(e?e.beat:null,t?t.beat:null,i),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){switch(t.getBeatDirection(e)){case P.Up:return P.Down;default:return P.Up}}getStartY(){if(this.startBeat.isRest)return this.startNoteRenderer.getScoreY(9);switch(this.tieDirection){case P.Up:return this.startNoteRenderer.getNoteY(this.startNote,$.Top);default:return this.startNoteRenderer.getNoteY(this.startNote,$.Bottom)}}getEndY(){const e=this.endNoteRenderer;if(this.endBeat.isRest)switch(this.tieDirection){case P.Up:return e.getScoreY(9);default:return e.getScoreY(0)}switch(this.tieDirection){case P.Up:return e.getNoteY(this.endNote,$.Top);default:return e.getNoteY(this.endNote,$.Bottom)}}getStartX(){return this.startNoteRenderer.getBeatX(this.startNote.beat,Te.PostNotes)}getEndX(){return this.endNoteRenderer.getBeatX(this.endNote.beat,Te.PreNotes)}}class t2 extends rs{constructor(){super(...arguments),this._bend=null,this._effectSlur=null,this._effectEndSlur=null}doLayout(){this._effectSlur=null,this._effectEndSlur=null,super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(e.isVisible){if(e.isTieOrigin&&!e.hasBend&&!e.beat.hasWhammyBar&&e.beat.graceType!==se.BendGrace&&e.tieDestination&&e.tieDestination.isVisible){const t=new i0(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination&&!e.tieOrigin.hasBend&&!e.beat.hasWhammyBar){const t=new i0(e.tieOrigin,e,!0);this.addTie(t)}if(e.slideInType!==jt.None||e.slideOutType!==pe.None){const t=new e2(e.slideInType,e.slideOutType,e,this);this.addTie(t)}if(e.isSlurOrigin&&e.slurDestination&&e.slurDestination.isVisible){const t=new lc(e,e.slurDestination,!1);this.addTie(t)}if(e.isSlurDestination){const t=new lc(e.slurOrigin,e,!0);this.addTie(t)}if(!this._effectSlur&&e.isEffectSlurOrigin&&e.effectSlurDestination){const t=new lc(e,e.effectSlurDestination,!1);this._effectSlur=t,this.addTie(t)}if(!this._effectEndSlur&&e.beat.isEffectSlurDestination&&e.beat.effectSlurOrigin){const t=this.onNotes.beamingHelper.direction,i=t===P.Up?e.beat.effectSlurOrigin.minNote:e.beat.effectSlurOrigin.maxNote,a=t===P.Up?e.beat.minNote:e.beat.maxNote,n=new lc(i,a,!0);this._effectEndSlur=n,this.addTie(n)}if(e.hasBend){if(!this._bend){const t=new jC(e.beat);this._bend=t,t.renderer=this.renderer,this.addTie(t)}this._bend.addBends(e)}if(this.beat.isLegatoOrigin){if(!this.beat.previousBeat||!this.beat.previousBeat.isLegatoOrigin){let t=this.beat.nextBeat;for(;t.nextBeat&&t.nextBeat.isLegatoDestination;)t=t.nextBeat;this.addTie(new wp(this.beat,t,!1))}}else if(this.beat.isLegatoDestination&&!this.beat.isLegatoOrigin){let t=this.beat.previousBeat;for(;t.previousBeat&&t.previousBeat.isLegatoOrigin;)t=t.previousBeat;this.addTie(new wp(t,this.beat,!0))}}}}class Ur extends pt{doLayout(){this.width=1}paint(e,t,i){const a=e+this.x,n=t+this.y+this.renderer.topPadding,o=t+this.y+this.renderer.height-this.renderer.bottomPadding-n;this.paintInternal(a,n,o,i)}}class rl extends Ur{paintInternal(e,t,i,a){a.fillRect(e,t,1,i)}}class i2 extends Ur{paintInternal(e,t,i,a){const r=e,o=this.renderer.getLineHeight(1);let l=t+o*.5+1;const h=t+i;for(;l<h;)a.fillCircle(r,l,1),l+=o}}class hd extends Ur{paintInternal(e,t,i,a){const n=hd.DashSize,r=e+.5,o=Math.ceil(i/2/n),l=t+i;if(a.beginPath(),o<1)a.moveTo(r,t),a.lineTo(r,l);else{let h=t;const d=(i-o*n)/(o-1);for(;h<l;)a.moveTo(r,h),a.lineTo(r,h+n),h+=n+d}a.stroke()}}hd.DashSize=4;class ol extends Ur{doLayout(){this.width=4}paintInternal(e,t,i,a){a.fillRect(e,t,this.width,i)}}class s0 extends Ur{paintInternal(e,t,i,a){const n=t+i,r=1.5,o=(t+n)/2,l=3;a.fillCircle(e,o-r*l,r),a.fillCircle(e,o+r*l,r)}}class s2 extends Ur{paintInternal(e,t,i,a){const n=this.renderer,o=n.drawnLineCount-1;if(o<=2)return;const l=n.getLineHeight(1),h=l*2,d=o/2*l-h/2;a.fillRect(e,t+d,1,h)}}class a2 extends Ur{paintInternal(e,t,i,a){const r=this.renderer.getLineHeight(1),o=-(r/2)+1;a.fillRect(e,t+o,1,r)}}class kp extends mr{constructor(e){super(),this._isRight=e}doLayout(){const e=this.renderer.bar,t=e.masterBar,i=this._isRight?e.getActualBarLineRight():e.getActualBarLineLeft(this.renderer.index===0);let a=oe.Automatic;if(!this._isRight){const r=this.renderer.previousRenderer;if(r&&r.staff===this.renderer.staff&&(a=r.bar.getActualBarLineRight(),i===a))return}const n=3;switch(this._isRight&&t.isRepeatEnd&&(this.addGlyph(new s0(0,0)),this.width+=n),i){case oe.Dashed:this.addGlyph(new hd(0,0));break;case oe.Dotted:this.addGlyph(new i2(0,0));break;case oe.Heavy:a!==oe.LightHeavy&&a!==oe.HeavyHeavy&&this.addGlyph(new ol(0,0));break;case oe.HeavyHeavy:a!==oe.LightHeavy&&a!==oe.Heavy&&this.addGlyph(new ol(0,0)),this.width+=n,this.addGlyph(new ol(0,0));break;case oe.HeavyLight:a!==oe.LightHeavy&&a!==oe.Heavy&&a!==oe.HeavyHeavy&&this.addGlyph(new ol(0,0)),this.width+=n,this.addGlyph(new rl(0,0));break;case oe.LightHeavy:a!==oe.HeavyLight&&a!==oe.Regular&&a!==oe.LightLight&&this.addGlyph(new rl(0,0)),this.width+=n,this.addGlyph(new ol(0,0));break;case oe.LightLight:a!==oe.HeavyLight&&a!==oe.Regular&&this.addGlyph(new rl(0,0)),this.width+=n,this.addGlyph(new rl(0,0));break;case oe.None:break;case oe.Regular:a!==oe.HeavyLight&&a!==oe.LightLight&&this.addGlyph(new rl(0,0));break;case oe.Short:this.addGlyph(new s2(0,0));break;case oe.Tick:this.addGlyph(new a2(0,0));break}this._isRight||t.isRepeatStart&&(this.width+=n,this.addGlyph(new s0(0,0)))}paint(e,t,i){var r;const a=this.renderer,n=Be.bar(i,a.barLineBarSubElement,this.renderer.bar,!0);try{super.paint(e,t,i)}finally{(r=n==null?void 0:n[Symbol.dispose])==null||r.call(n)}}}class n2 extends pt{constructor(e,t,i){super(e,t),this._count=0,this._count=0,this._count=i}doLayout(){this.width=0}paint(e,t,i){var n;const a=Be.bar(i,this.renderer.repeatsBarSubElement,this.renderer.bar);try{const r=this.renderer.resources,o=i.textAlign;i.font=r.barNumberFont,i.textAlign=Q.Right;const l=`x${this._count}`,h=i.measureText(l).width/1.5;i.fillText(l,e+this.x-h,t+this.y),i.textAlign=o}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}class Fk extends pt{constructor(e,t,i){super(e,t),this._number=0,this._number=i}doLayout(){this.renderer.scoreRenderer.canvas.font=this.renderer.resources.barNumberFont,this.width=this.renderer.scoreRenderer.canvas.measureText(this._number.toString()).width+5}paint(e,t,i){var n;if(!this.renderer.staff.isFirstInSystem)return;const a=Be.bar(i,this.renderer.barNumberBarSubElement,this.renderer.bar,!0);try{const r=this.renderer.resources,o=i.textBaseline;i.textBaseline=he.Top,i.font=r.barNumberFont,i.fillText(this._number.toString(),e+this.x,t+this.y),i.textBaseline=o}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}class _a extends ot{constructor(){super(...arguments),this.firstLineY=0,this._startSpacing=!1,this.tupletSize=0}get lineOffset(){return this.lineSpacing+1}get tupletOffset(){return 10}get topGlyphOverflow(){const e=this.resources;return e.tablatureFont.size/2+e.tablatureFont.size*.2}get bottomGlyphOverflow(){const e=this.resources;return e.tablatureFont.size/2+e.tablatureFont.size*.2}initLineBasedSizes(){this.topPadding=this.topGlyphOverflow,this.bottomPadding=this.bottomGlyphOverflow,this.height=this.lineOffset*(this.heightLineCount-1)+this.topPadding+this.bottomPadding}updateSizes(){this.initLineBasedSizes(),this.adjustSizes(),this.updateFirstLineY(),super.updateSizes()}adjustSizes(){}updateFirstLineY(){const e=this.lineOffset*(this.heightLineCount-1),t=(this.drawnLineCount-1)*this.lineOffset;this.firstLineY=this.topPadding+(e-t)/2}doLayout(){this.initLineBasedSizes(),this.updateFirstLineY(),this.tupletSize=15+this.resources.effectFont.size*.3,super.doLayout()}getLineY(e){return this.firstLineY+this.getLineHeight(e)}getLineHeight(e){return this.lineOffset*e}paintBackground(e,t,i){super.paintBackground(e,t,i),this.paintStaffLines(e,t,i),this.paintSimileMark(e,t,i)}paintStaffLines(e,t,i){var n;const a=Be.bar(i,this.staffLineBarSubElement,this.bar,!0);try{const r=[];for(let l=0,h=this.drawnLineCount;l<h;l++)r.push([]);this.additionalMultiRestBars||this.collectSpaces(r);for(const l of r)l.sort((h,c)=>h[0]>c[0]?1:h[0]<c[0]?-1:0);const o=Math.ceil(this.width);for(let l=0;l<this.drawnLineCount;l++){const h=this.getLineY(l);let c=0;for(const d of r[l])i.fillRect(e+this.x+c,t+this.y+h|0,d[0]-c,ot.StaffLineThickness),c=d[0]+d[1];i.fillRect(e+this.x+c,t+this.y+h|0,o-c,ot.StaffLineThickness)}}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}collectSpaces(e){}createStartSpacing(){if(this._startSpacing)return;const e=this.index===0?this.settings.display.firstStaffPaddingLeft:this.settings.display.staffPaddingLeft;this.addPreBeatGlyph(new oi(0,0,e)),this._startSpacing=!0}paintTuplets(e,t,i,a,n=!1){for(const r of this.bar.voices)if(this.hasVoiceContainer(r)){const o=this.getVoiceContainer(r);for(const l of o.tupletGroups)this.paintTupletHelper(e+this.beatGlyphsStart,t,i,l,a,n)}}getTupletBeamDirection(e){return this.getBeamDirection(e)}paintTupletHelper(e,t,i,a,n,r){var T;const o=this.resources,l=i.textAlign,h=i.textBaseline;i.color=a.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,i.textAlign=Q.Center,i.textBaseline=he.Middle;let c;const d=a.beats[0].tupletNumerator,f=a.beats[0].tupletDenominator;d===2&&f===3?c="2":d===3&&f===2?c="3":d===4&&f===6?c="4":d===5&&f===4?c="5":d===6&&f===4?c="6":d===7&&f===4?c="7":d===9&&f===8?c="9":d===10&&f===8?c="10":d===11&&f===8?c="11":d===12&&f===8?c="12":d===13&&f===8?c="13":c=`${d}:${f}`;let p=this.tupletOffset,g=5;const m=Be.beat(i,n,a.beats[0]);try{if(a.beats.length===1||!a.isFull)for(const S of a.beats){const y=this.helpers.beamHelperLookup[a.voice.index].get(S.index);if(!y)continue;const b=this.getTupletBeamDirection(y),B=y.getBeatLineX(S);let N=this.calculateBeamYWithDirection(y,B,b);b===P.Down?N+=p+g:N-=p+g,i.font=o.effectFont,i.fillText(c,e+this.x+B,t+this.y+N)}else{const S=a.beats[0],y=a.beats[a.beats.length-1];let b=null,B=null;for(let fs=0;fs<a.beats.length;fs++)if(!a.beats[fs].isRest){b=a.beats[fs];break}for(let fs=a.beats.length-1;fs>=0;fs--)if(!a.beats[fs].isRest){B=a.beats[fs];break}let N=!1;b||(b=S,N=!0),B||(B=y);const L=this.helpers.beamHelperLookup[a.voice.index].get(S.index),_=this.helpers.beamHelperLookup[a.voice.index].get(y.index),A=L.getBeatLineX(S),J=_.getBeatLineX(y),G=this.helpers.beamHelperLookup[a.voice.index].get(b.index),ee=this.helpers.beamHelperLookup[a.voice.index].get(B.index),Ce=this.getTupletBeamDirection(L);let at=this.calculateBeamYWithDirection(G,A,Ce),ht=this.calculateBeamYWithDirection(ee,J,Ce);N&&(at=Math.max(at,ht),ht=at),i.font=o.effectFont;const Qi=i.measureText(c).width,K=3,Se=(A+J)/2,Me=Se-Qi/2-K,gt=Se+Qi/2+K,nt=(ht-at)/(J-A),Lt=at-nt*A,us=nt*Me+Lt,ds=nt*Se+Lt,Gt=nt*gt+Lt;Ce===P.Down&&(p*=-1,g*=-1),i.beginPath(),i.moveTo(e+this.x+A,t+this.y+at-p|0),r?i.quadraticCurveTo(e+this.x+(Me+A)/2,t+this.y+us-p-g|0,e+this.x+Me,t+this.y+us-p-g|0):(i.lineTo(e+this.x+A,t+this.y+at-p-g|0),i.lineTo(e+this.x+Me,t+this.y+us-p-g|0)),i.stroke(),i.beginPath(),i.moveTo(e+this.x+gt,t+this.y+Gt-p-g|0),r?i.quadraticCurveTo(e+this.x+(J+gt)/2,t+this.y+Gt-p-g|0,e+this.x+J,t+this.y+ht-p|0):(i.lineTo(e+this.x+J,t+this.y+ht-p-g|0),i.lineTo(e+this.x+J,t+this.y+ht-p|0)),i.stroke(),i.fillText(c,e+this.x+Se,t+this.y+ds-p-g)}i.textAlign=l,i.textBaseline=h}finally{(T=m==null?void 0:m[Symbol.dispose])==null||T.call(m)}}paintBeams(e,t,i,a,n){for(const r of this.helpers.beamHelpers)for(const o of r)this.paintBeamHelper(e+this.beatGlyphsStart,t,i,o,a,n)}drawBeamHelperAsFlags(e){return e.beats.length===1}paintBeamHelper(e,t,i,a,n,r){i.color=a.voice.index===0?this.resources.mainGlyphColor:this.resources.secondaryGlyphColor,a.isRestBeamHelper||(this.drawBeamHelperAsFlags(a)?this.paintFlag(e,t,i,a,n):this.paintBar(e,t,i,a,r))}shouldPaintFlag(e,t){return!(e.graceType===se.BendGrace||e.deadSlapped||!t.hasBeatLineX(e)||e.graceType!==se.None&&this.settings.notation.notationMode===ai.SongBook||e.duration===w.Whole||e.duration===w.DoubleWhole||e.duration===w.QuadrupleWhole)}paintFlag(e,t,i,a,n){var r;for(const o of a.beats){if(!this.shouldPaintFlag(o,a))continue;const l=o.graceType!==se.None,h=l?Ye.GraceScale:1,c=this.getFlagStemSize(a.shortestDuration),d=a.getBeatLineX(o),f=this.getBeamDirection(a);let p=this.getFlagTopY(o,f),g=this.getFlagBottomY(o,f),m=0;if(f===P.Down?(g+=c*h,m=g):(p-=c*h,m=p),!a.hasLine(!0,o))continue;this.paintBeamingStem(o,t+this.y,e+this.x+d,t+this.y+p,t+this.y+g,i);const T=Be.beat(i,n,o);try{if(o.graceType===se.BeforeBeat&&(i.beginPath(),f===P.Down?(i.moveTo(e+this.x+d-12/2,t+this.y+g-15),i.lineTo(e+this.x+d+12/2,t+this.y+g)):(i.moveTo(e+this.x+d-12/2,t+this.y+p+15),i.lineTo(e+this.x+d+12/2,t+this.y+p)),i.stroke()),a.hasFlag(!0,o)){const S=new Cr(d-.5,m,o.duration,f,l);S.renderer=this,S.doLayout(),S.paint(e+this.x,t+this.y,i)}}finally{(r=T==null?void 0:T[Symbol.dispose])==null||r.call(T)}}}getFlagStemSize(e,t=!1){let i=0;switch(e){case w.QuadrupleWhole:case w.Half:case w.Quarter:case w.Eighth:case w.Sixteenth:case w.ThirtySecond:case w.SixtyFourth:case w.OneHundredTwentyEighth:case w.TwoHundredFiftySixth:i=3;break;default:i=t?3:0;break}return this.getLineHeight(i)}recreatePreBeatGlyphs(){this._startSpacing=!1,super.recreatePreBeatGlyphs()}calculateBeamY(e,t){return this.calculateBeamYWithDirection(e,t,this.getBeamDirection(e))}createPreBeatGlyphs(){super.createPreBeatGlyphs(),this.addPreBeatGlyph(new kp(!1)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new Fk(0,this.getLineHeight(-.25),this.bar.index+1))}createPostBeatGlyphs(){super.createPostBeatGlyphs();const e=this.lastBar;this.addPostBeatGlyph(new kp(!0)),e.masterBar.isRepeatEnd&&e.masterBar.repeatCount>2&&this.addPostBeatGlyph(new n2(0,this.getLineHeight(-.25),this.bar.masterBar.repeatCount))}paintBar(e,t,i,a,n){var r;for(let o=0,l=a.beats.length;o<l;o++){const h=a.beats[o];if(!a.hasBeatLineX(h)||h.deadSlapped)continue;const d=h.graceType!==se.None?Ye.GraceScale:1,f=a.getBeatLineX(h),p=this.getBeamDirection(a),g=t+this.y+this.getBarLineStart(h,p),m=t+this.y+this.calculateBeamY(a,f);this.paintBeamingStem(h,t+this.y,e+this.x+f,g,m,i);const T=Be.beat(i,n,h);try{let S=m;p===P.Down?S+=i.font.size*2:o!==0&&(S-=i.font.size*1.5);const y=6*d;let b=(ot.BeamSpacing+ot.BeamThickness)*d,B=ot.BeamThickness*d;const N=V.getIndex(h.duration)-2,L=t+this.y;p===P.Down&&(b=-b,B=-B);for(let _=0;_<N;_++){let A=0,J=0,G=0,ee=0;const Ce=L+_*b;if(o<a.beats.length-1){const at=ha.isFullBarJoin(h,a.beats[o+1],_);if(_===N-1&&at&&h.beamingMode===it.ForceSplitOnSecondaryToNext)A=f,J=A+y,G=Ce+this.calculateBeamY(a,A),ee=Ce+this.calculateBeamY(a,J),_a.paintSingleBar(i,e+this.x+A,G,e+this.x+J,ee,B),J=a.getBeatLineX(a.beats[o+1]),A=J-y,G=Ce+this.calculateBeamY(a,A),ee=Ce+this.calculateBeamY(a,J),_a.paintSingleBar(i,e+this.x+A,G,e+this.x+J,ee,B);else{if(at)A=f,J=a.getBeatLineX(a.beats[o+1]);else if(o===0||!ha.isFullBarJoin(a.beats[o-1],h,_))A=f,J=A+y;else continue;G=Ce+this.calculateBeamY(a,A),ee=Ce+this.calculateBeamY(a,J),_a.paintSingleBar(i,e+this.x+A,G,e+this.x+J,ee,B)}}else o>0&&!ha.isFullBarJoin(h,a.beats[o-1],_)&&(A=f-y,J=f,G=Ce+this.calculateBeamY(a,A),ee=Ce+this.calculateBeamY(a,J),_a.paintSingleBar(i,e+this.x+A,G,e+this.x+J,ee,B))}}finally{(r=T==null?void 0:T[Symbol.dispose])==null||r.call(T)}}}static paintSingleBar(e,t,i,a,n,r){e.beginPath(),e.moveTo(t,i),e.lineTo(a,n),e.lineTo(a,n+r),e.lineTo(t,i+r),e.closePath(),e.fill()}}class r2 extends mr{paint(e,t,i){var n;const a=Be.bar(i,Ee.StandardNotationKeySignature,this.renderer.bar);try{super.paint(e,t,i)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}class ca extends _a{constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this.beatEffectsMinY=null,this.beatEffectsMaxY=null,this.accidentalHelper=new ut(this)}get repeatsBarSubElement(){return Ee.StandardNotationRepeats}get barNumberBarSubElement(){return Ee.StandardNotationBarNumber}get barLineBarSubElement(){return Ee.StandardNotationBarLines}get staffLineBarSubElement(){return Ee.StandardNotationStaffLine}get showMultiBarRest(){return!0}get lineSpacing(){return ot.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return this.bar.staff.standardNotationLineCount}registerBeatEffectOverflows(e,t){const i=this.beatEffectsMinY;(i==null||e<i)&&(this.beatEffectsMinY=e);const a=this.beatEffectsMaxY;(a==null||t>a)&&(this.beatEffectsMaxY=t)}getScoreY(e){return super.getLineY(e/2)}getScoreHeight(e){return super.getLineHeight(e/2)}doLayout(){if(super.doLayout(),!this.bar.isEmpty&&this.accidentalHelper.maxLineBeat){const e=this.getScoreY(-2),t=this.getScoreY(10),i=this.simpleWhammyOverflow,a=this.beatEffectsMinY;if(a!==null){const c=e-a;c>0&&this.registerOverflowTop(c)}const n=this.beatEffectsMaxY;if(n!==null){const c=n-t;c>0&&this.registerOverflowBottom(c)}this.registerOverflowTop(i);let r=this.getScoreY(this.accidentalHelper.maxLine);const o=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.maxLineBeat);o.direction===P.Up&&(r-=this.getStemSize(o),o.hasTuplet&&(r-=this.tupletSize)),r<e&&this.registerOverflowTop(Math.abs(r)+i);let l=this.getScoreY(this.accidentalHelper.minLine);const h=this.helpers.getBeamingHelperForBeat(this.accidentalHelper.minLineBeat);h.direction===P.Down&&(l+=this.getStemSize(h),h.hasTuplet&&(l+=this.tupletSize)),l>t&&this.registerOverflowBottom(Math.abs(l)-t)}}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i,qe.StandardNotationFlags,qe.StandardNotationBeams),this.paintTuplets(e,t,i,qe.StandardNotationTuplet)}getSlashFlagY(e,t){let i=(this.heightLineCount-1)/2,a=0;switch(e){case w.QuadrupleWhole:case w.DoubleWhole:case w.Whole:a+=2;break;default:a+=1;break}return t===P.Down?i+=a:i-=a,this.getLineY(i)}getFlagTopY(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):this.getScoreY(this.accidentalHelper.getMinLine(e))}getFlagBottomY(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):this.getScoreY(this.accidentalHelper.getMaxLine(e))}getBeamDirection(e){return e.direction}getStemSize(e,t=!1){let i=e.beats.length===1?this.getFlagStemSize(e.shortestDuration,t):this.getBarStemSize(e.shortestDuration);return e.isGrace&&(i=i*Ye.GraceScale),i}getBarStemSize(e){let t=0;switch(e){case w.QuadrupleWhole:case w.Half:case w.Quarter:case w.Eighth:case w.Sixteenth:t=6;break;case w.ThirtySecond:t=8;break;case w.SixtyFourth:t=9;break;case w.OneHundredTwentyEighth:t=9;break;case w.TwoHundredFiftySixth:t=10;break;default:t=0;break}return this.getScoreHeight(t)}get middleYPosition(){return this.getScoreY(this.bar.staff.standardNotationLineCount-1)}getNoteY(e,t){if(e.beat.slashed){const a=(this.heightLineCount-1)/2;return this.getLineY(a)}let i=super.getNoteY(e,t);if(Number.isNaN(i)){const a=ut.computeLineWithoutAccidentals(this.bar,e);i=this.getScoreY(a)}return i}applyLayoutingInfo(){const e=super.applyLayoutingInfo();if(e&&this.bar.isMultiVoice){const t=this.getScoreY(-2),i=this.getScoreY(10),a=this.helpers.collisionHelper.getBeatMinMaxY();a[0]<t&&this.registerOverflowTop(Math.abs(a[0])),a[1]>i&&this.registerOverflowBottom(Math.abs(a[1])-i)}return e}calculateBeamYWithDirection(e,t,i){const a=this.getStemSize(e);if(!e.drawingInfos.has(i)){const n=new Zv;e.drawingInfos.set(i,n);const r=e.beats[0],o=e.beats[e.beats.length-1],l=e.isRestBeamHelper;n.startBeat=r,n.startX=e.getBeatLineX(r),l?n.startY=i===P.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):n.startY=i===P.Up?this.getFlagTopY(r,i)-a:this.getFlagBottomY(r,i)+a,n.endBeat=o,n.endX=e.getBeatLineX(o),l?n.endY=i===P.Up?this.getScoreY(e.minRestLine):this.getScoreY(e.maxRestLine):n.endY=i===P.Up?this.getFlagTopY(o,i)-a:this.getFlagBottomY(o,i)+a;const h=10;if(i===P.Down&&n.startY>n.endY&&n.startY-n.endY>h&&(n.endY=n.startY-h),i===P.Down&&n.endY>n.startY&&n.endY-n.startY>h&&(n.startY=n.endY-h),i===P.Up&&n.startY<n.endY&&n.endY-n.startY>h&&(n.endY=n.startY+h),i===P.Up&&n.endY<n.startY&&n.startY-n.endY>h&&(n.startY=n.endY+h),e.beats.length>1){if(i===P.Up){const c=this.getScoreY(this.accidentalHelper.getMinLine(e.beatOfHighestNote))-a,f=n.calcY(e.getBeatLineX(e.beatOfHighestNote))-c;f>0&&(n.startY-=f,n.endY-=f)}else{const c=this.getScoreY(this.accidentalHelper.getMaxLine(e.beatOfLowestNote))+a,d=n.calcY(e.getBeatLineX(e.beatOfLowestNote)),f=c-d;f>0&&(n.startY+=f,n.endY+=f)}if(e.minRestLine!==null||e.maxRestLine!==null){const c=V.getIndex(e.shortestDuration)-2,d=e.isGrace?Ye.GraceScale:1;let f=c*(ot.BeamSpacing+ot.BeamThickness)*d;if(f+=ot.BeamSpacing,i===P.Up&&e.minRestLine!==null){const p=this.getScoreY(e.minRestLine)-f,m=n.calcY(e.getBeatLineX(e.beatOfMinRestLine))-p;m>0&&(n.startY-=m,n.endY-=m)}else if(i===P.Down&&e.maxRestLine!==null){const p=this.getScoreY(e.maxRestLine)+f,g=n.calcY(e.getBeatLineX(e.beatOfMaxRestLine)),m=p-g;m>0&&(n.startY+=m,n.endY+=m)}}if(e.slashBeats.length>0)for(const c of e.slashBeats){const d=n.calcY(e.getBeatLineX(c));let f=this.getSlashFlagY(c.duration,i);i===P.Up?f-=a:i===P.Down&&(f+=a);const p=f-d;p>0&&(n.startY+=p,n.endY+=p)}}}return e.drawingInfos.get(i).calcY(t)}getBarLineStart(e,t){return e.slashed?this.getSlashFlagY(e.duration,t):t===P.Up?this.getScoreY(this.accidentalHelper.getMaxLine(e)):this.getScoreY(this.accidentalHelper.getMinLine(e))}createLinePreBeatGlyphs(){let e=!1;if(this.isFirstOfLine||this.bar.clef!==this.bar.previousBar.clef||this.bar.clefOttava!==this.bar.previousBar.clefOttava){let t=0;switch(this.bar.clef){case xe.Neutral:t=this.bar.staff.standardNotationLineCount-1;break;case xe.F4:t=2;break;case xe.C3:t=4;break;case xe.C4:t=2;break;case xe.G2:t=6;break}this.createStartSpacing(),this.addPreBeatGlyph(new zg(0,this.getScoreY(t)+.5*ot.StaffLineThickness,this.bar.clef,this.bar.clefOttava)),e=!0}(e||this.index===0&&this.bar.keySignature!==_e.C||this.bar.previousBar&&this.bar.keySignature!==this.bar.previousBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){let e=0;const t=this.bar.keySignature,i=this.bar.previousBar?this.bar.previousBar.keySignature:0;switch(this.bar.clef){case xe.Neutral:e=0;break;case xe.G2:e=1;break;case xe.F4:e=3;break;case xe.C3:e=2;break;case xe.C4:e=0;break}const a=new r2;a.renderer=this;const n=new Map,r=[];if(V.keySignatureIsSharp(t))for(let o=0;o<Math.abs(t);o++){const l=ca.SharpKsSteps[o]+e;r.push(new xa(0,this.getScoreY(l),ne.Sharp,1)),n.set(l,!0)}else for(let o=0;o<Math.abs(t);o++){const l=ca.FlatKsSteps[o]+e;r.push(new xa(0,this.getScoreY(l),ne.Flat,1)),n.set(l,!0)}if(this.bar.keySignature===_e.C){const o=Math.abs(i),l=V.keySignatureIsSharp(i)?ca.SharpKsSteps:ca.FlatKsSteps;for(let h=0;h<o;h++){const c=l[h]+e;n.has(c)||a.addGlyph(new xa(0,this.getScoreY(l[h]+e),ne.Natural,1))}}for(const o of r)a.addGlyph(o);this.addPreBeatGlyph(a)}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new oi(0,0,5));const e=this.bar.staff.standardNotationLineCount-1;this.addPreBeatGlyph(new Yg(0,this.getScoreY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){for(const t of e.beats){const i=new t2(t,this.getVoiceContainer(e));i.preNotes=new ZC,i.onNotes=new JC,this.addBeatGlyph(i)}}getNoteLine(e){return this.accidentalHelper.getNoteLine(e)}completeBeamingHelper(e){if(this.bar.isMultiVoice&&e.highestNoteInHelper&&e.lowestNoteInHelper){let t=this.getNoteY(e.highestNoteInHelper,$.Center),i=this.getNoteY(e.lowestNoteInHelper,$.Center),a=this.getStemSize(e);e.hasTuplet&&(a+=this.resources.effectFont.size*2),e.direction===P.Up?t-=a:i+=a;for(const n of e.beats)this.helpers.collisionHelper.reserveBeatSlot(n,t,i)}}paintBeamingStem(e,t,i,a,n,r){var l;const o=Be.beat(r,qe.StandardNotationStem,e);try{r.lineWidth=ot.StemWidth,r.beginPath(),r.moveTo(i,a),r.lineTo(i,n),r.stroke(),r.lineWidth=1}finally{(l=o==null?void 0:o[Symbol.dispose])==null||l.call(o)}}}ca.StaffId="score";ca.SharpKsSteps=[-1,2,-2,1,4,0,3];ca.FlatKsSteps=[3,0,4,1,5,2,6];class o2 extends Vh{get staffId(){return ca.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new ca(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showStandardNotation}}class l2 extends pt{constructor(e,t,i,a){super(0,0),this._inType=e,this._outType=t,this._startNote=i,this._parent=a}doLayout(){this.width=0}paint(e,t,i){this.paintSlideIn(e,t,i),this.paintSlideOut(e,t,i)}paintSlideIn(e,t,i){const a=this.renderer,n=12,r=3;let o=0,l=0,h=0,c=0;const d=2;switch(this._inType){case jt.IntoFromBelow:h=e+a.x+a.getNoteX(this._startNote,Ke.Left)-d,c=t+a.y+a.getNoteY(this._startNote,$.Center),o=h-n,l=t+a.y+a.getNoteY(this._startNote,$.Center)+r;break;case jt.IntoFromAbove:h=e+a.x+a.getNoteX(this._startNote,Ke.Left)-d,c=t+a.y+a.getNoteY(this._startNote,$.Center),o=h-n,l=t+a.y+a.getNoteY(this._startNote,$.Center)-r;break;default:return}this.paintSlideLine(i,!1,o,h,l,c)}paintSlideOut(e,t,i){const a=this.renderer,n=12,r=3;let o=0,l=0,h=0,c=0,d=!1;const f=2;switch(this._outType){case pe.Shift:case pe.Legato:if(o=e+a.x+a.getBeatX(this._startNote.beat,Te.PostNotes)+f,l=t+a.y+a.getNoteY(this._startNote,$.Center),this._startNote.slideTarget){const p=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this._startNote.slideTarget.beat.voice.bar);!p||p.staff!==a.staff?(h=e+a.x+a.width,c=l):(h=e+p.x+p.getBeatX(this._startNote.slideTarget.beat,Te.OnNotes)-f,c=t+p.y+p.getNoteY(this._startNote.slideTarget,$.Center)),this._startNote.slideTarget.fret>this._startNote.fret?(l+=r,c-=r):(l-=r,c+=r)}else h=e+a.x+this._parent.x,c=l;break;case pe.OutUp:o=e+a.x+a.getNoteX(this._startNote,Ke.Right)+f,l=t+a.y+a.getNoteY(this._startNote,$.Center),h=o+n,c=t+a.y+a.getNoteY(this._startNote,$.Center)-r;break;case pe.OutDown:o=e+a.x+a.getNoteX(this._startNote,Ke.Right)+f,l=t+a.y+a.getNoteY(this._startNote,$.Center),h=o+n,c=t+a.y+a.getNoteY(this._startNote,$.Center)+r;break;case pe.PickSlideDown:o=e+a.x+a.getNoteX(this._startNote,Ke.Right)+f*2,l=t+a.y+a.getNoteY(this._startNote,$.Center),h=e+a.x+a.width,c=l+r*3,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(h=e+a.x+a.getBeatX(this._startNote.beat.nextBeat,Te.PreNotes)),d=!0;break;case pe.PickSlideUp:o=e+a.x+a.getNoteX(this._startNote,Ke.Right)+f*2,l=t+a.y+a.getNoteY(this._startNote,$.Center),h=e+a.x+a.width,c=l-r*3,this._startNote.beat.nextBeat&&this._startNote.beat.nextBeat.voice===this._startNote.beat.voice&&(h=e+a.x+a.getBeatX(this._startNote.beat.nextBeat,Te.PreNotes)),d=!0;break;default:return}this.paintSlideLine(i,d,o,h,l,c)}paintSlideLine(e,t,i,a,n,r){if(t){const o=new ar(0,0,ve.Slight,1.2);o.renderer=this.renderer,o.doLayout(),n-=o.height/2,r-=o.height/2;const l=a-i,h=r-n,c=Math.sqrt(Math.pow(h,2)+Math.pow(l,2));o.width=l;const d=Math.asin(h/c)*(180/Math.PI);e.beginRotate(i,n,d),o.paint(0,0,e),e.endRotate()}else e.beginPath(),e.moveTo(i,n),e.lineTo(a,r),e.stroke()}}class on extends Zt{constructor(e,t,i=!1){super(e.beat,t.beat,i),this.startNote=e,this.endNote=t}getTieHeight(e,t,i,a){return this.startNote===this.endNote?15:super.getTieHeight(e,t,i,a)}getBeamDirection(e,t){return this.startNote===this.endNote?P.Up:on.getBeamDirectionForNote(this.startNote)}static getBeamDirectionForNote(e){return e.string>3?P.Up:P.Down}getStartY(){return this.startNote===this.endNote?this.startNoteRenderer.getNoteY(this.startNote,$.Center):this.tieDirection===P.Up?this.startNoteRenderer.getNoteY(this.startNote,$.Top):this.startNoteRenderer.getNoteY(this.startNote,$.Bottom)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,Ke.Center)}getEndX(){return this.startNote===this.endNote?this.endNoteRenderer.getNoteX(this.endNote,Ke.Left):this.endNoteRenderer.getNoteX(this.endNote,Ke.Center)}}class a0 extends on{constructor(e,t,i,a=!1){super(e,t,a),this._direction=on.getBeamDirectionForNote(e),this._forSlide=i}getTieHeight(e,t,i,a){return Math.log(i-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,i,a){if(this._forSlide!==i||this.forEnd!==a||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id||this._direction!==on.getBeamDirectionForNote(e))return!1;switch(this._direction){case P.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case P.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,i){const a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar),n=this.getBeamDirection(this.startBeat,a),r=`tab.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${n}`,o=this.renderer;o.staff.getSharedLayoutData(r,!1)||(o.staff.setSharedLayoutData(r,!0),super.paint(e,t,i))}}class h2 extends rs{constructor(){super(...arguments),this._bend=null,this._effectSlurs=[]}drawBeamHelperAsFlags(e){return e.hasFlag(this.renderer.drawBeamHelperAsFlags(e),this.beat)}doLayout(){this._effectSlurs=[],super.doLayout(),this._bend&&(this._bend.renderer=this.renderer,this._bend.doLayout(),this.updateWidth())}createTies(e){if(!e.isVisible)return;const t=this.renderer;if(e.isTieOrigin&&t.showTiedNotes&&e.tieDestination.isVisible){const i=new on(e,e.tieDestination,!1);this.addTie(i)}if(e.isTieDestination&&t.showTiedNotes){const i=new on(e.tieOrigin,e,!0);this.addTie(i)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){const i=new on(e,e,!1);this.addTie(i)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let i=!1;for(const a of this._effectSlurs)if(a.tryExpand(e,e.effectSlurDestination,!1,!1)){i=!0;break}if(!i){const a=new a0(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(a),this.addTie(a)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let i=!1;for(const a of this._effectSlurs)if(a.tryExpand(e.effectSlurOrigin,e,!1,!0)){i=!0;break}if(!i){const a=new a0(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(a),this.addTie(a)}}if(e.slideInType!==jt.None||e.slideOutType!==pe.None){const i=new l2(e.slideInType,e.slideOutType,e,this);this.addTie(i)}if(e.hasBend){if(!this._bend){const i=new Ss;this._bend=i,i.renderer=this.renderer,this.addTie(i)}this._bend.addBends(e)}}}class c2 extends pt{constructor(e,t,i){super(e,t),this._noteString=null,this._trillNoteString=null,this._trillNoteStringWidth=0,this.isEmpty=!1,this.noteStringWidth=0,this._note=i}doLayout(){const e=this._note;let t=e.fret-e.beat.voice.bar.staff.transpositionPitch;if(e.harmonicType===ae.Natural&&e.harmonicValue!==0&&(t=e.harmonicValue-e.beat.voice.bar.staff.transpositionPitch),e.isTieDestination)e.beat.index===0&&this.renderer.settings.notation.notationMode===ai.GuitarPro||(e.bendType===q.Bend||e.bendType===q.BendRelease)&&this.renderer.settings.notation.isNotationElementVisible(be.TabNotesOnTiedBends)?this._noteString=`(${(e.tieOrigin.fret-e.beat.voice.bar.staff.transpositionPitch).toString()})`:this._noteString="";else if(this._noteString=e.isDead?"x":t.toString(),e.isGhost)this._noteString=`(${this._noteString})`;else if(e.harmonicType===ae.Natural){const i=this._noteString.indexOf(".");i>=0&&(this._noteString=this._noteString.substr(0,i+2)),this._noteString=`<${this._noteString}>`}if(e.isTrill)this._trillNoteString=`(${(e.trillFret-e.beat.voice.bar.staff.transpositionPitch).toString()})`;else if(V.isAlmostEqualTo(e.harmonicValue,0))this._trillNoteString="";else switch(e.harmonicType){case ae.Artificial:case ae.Pinch:case ae.Tap:case ae.Semi:case ae.Feedback:let i=(t+e.harmonicValue).toString();const a=i.indexOf(".");a>=0&&(i=i.substr(0,a+2)),this._trillNoteString=`<${i}>`;break;default:this._trillNoteString="";break}this.isEmpty=!this._noteString,this.isEmpty||(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.tablatureFont,this.noteStringWidth=this.renderer.scoreRenderer.canvas.measureText(this._noteString).width,this.width=this.noteStringWidth,this.height=this.renderer.scoreRenderer.canvas.font.size,this._trillNoteString&&(this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,this._trillNoteStringWidth=3+this.renderer.scoreRenderer.canvas.measureText(this._trillNoteString).width,this.width+=this._trillNoteStringWidth))}paint(e,t,i){var o;if(this.isEmpty)return;const a=this.noteStringWidth+this._trillNoteStringWidth,n=e+this.x+(this.width-a)/2;this.paintTrill(n,t,i);const r=Be.note(i,Ci.GuitarTabFretNumber,this._note);try{i.fillText(this._noteString,n,t+this.y)}finally{(o=r==null?void 0:r[Symbol.dispose])==null||o.call(r)}}paintTrill(e,t,i){var n;const a=Be.note(i,Ci.GuitarTabFretNumber,this._note);try{const r=this.renderer.scoreRenderer.canvas.font;this.renderer.scoreRenderer.canvas.font=this.renderer.resources.graceFont,i.fillText(this._trillNoteString,e+this.noteStringWidth+3,t+this.y),this.renderer.scoreRenderer.canvas.font=r}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}buildBoundingsLookup(e,t,i){const a=new Hh;a.note=this._note,a.noteHeadBounds=new hi,a.noteHeadBounds.x=t+this.x,a.noteHeadBounds.y=i+this.y-this.height/2,a.noteHeadBounds.w=this.width,a.noteHeadBounds.h=this.height,e.addNote(a)}}class u2 extends pt{constructor(e,t,i){super(e,t),this._notes=[],this._deadSlapped=null,this.minStringNote=null,this.beatEffects=new Map,this.notesPerString=new Map,this.noteStringWidth=0,this._isGrace=i}buildBoundingsLookup(e,t,i){for(const a of this._notes)a.buildBoundingsLookup(e,t+this.x,i+this.y)}getNoteX(e,t){if(this.notesPerString.has(e.string)){const i=this.notesPerString.get(e.string);let a=this.x+i.x;switch(t){case Ke.Left:break;case Ke.Center:a+=i.noteStringWidth/2;break;case Ke.Right:a+=i.width;break}return a}return 0}getNoteY(e,t){if(this.notesPerString.has(e.string)){const i=this.notesPerString.get(e.string);let a=this.y+i.y;switch(t){case $.Top:case $.TopWithStem:a-=i.height/2+2;break;case $.Center:break;case $.Bottom:case $.BottomWithStem:a+=i.height/2;break}return a}return 0}doLayout(){let e=0;if(this.beat.deadSlapped)this._deadSlapped=new ld,this._deadSlapped.renderer=this.renderer,this._deadSlapped.doLayout(),e=this._deadSlapped.width,this.noteStringWidth=e;else{let t=0;for(let r=0,o=this._notes.length;r<o;r++){const l=this._notes[r];l.renderer=this.renderer,l.doLayout(),l.width>e&&(e=l.width),l.noteStringWidth>t&&(t=l.noteStringWidth)}this.noteStringWidth=t;const i=this.renderer.resources.tablatureFont.size;let a=this.getNoteY(this.minStringNote,$.Center)+i/2;const n=7;for(const r of this.beatEffects.values())r.y+=a,r.x+=this.width/2,r.renderer=this.renderer,a+=n,r.doLayout()}this.width=e}addNoteGlyph(e,t){this._notes.push(e),this.notesPerString.set(t.string,e),(!this.minStringNote||t.string<this.minStringNote.string)&&(this.minStringNote=t)}paint(e,t,i){var a,n;if(e+=this.x,t+=this.y,this.beat.deadSlapped)(a=this._deadSlapped)==null||a.paint(e,t,i);else{const r=this.renderer.resources,o=i.textBaseline;i.textBaseline=he.Middle,i.font=this._isGrace?r.graceFont:r.tablatureFont;const l=this._notes,h=this.width;for(const d of l)d.renderer=this.renderer,d.width=h,d.paint(e,t,i);i.textBaseline=o;const c=Be.beat(i,qe.GuitarTabEffects,this.beat);try{for(const d of this.beatEffects.values())d.paint(e,t,i)}finally{(n=c==null?void 0:c[Symbol.dispose])==null||n.call(c)}}}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}}class d2 extends Mt{constructor(e,t,i,a){super(e,t,1,zh.getSymbol(a)),this._isVisibleRest=i}doLayout(){super.doLayout(),this._isVisibleRest||(this.width=10)}updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.isPositionFrom("tab",this.beat)&&this.beamingHelper.registerBeatLineX("tab",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,i){var a;if(this._isVisibleRest){const n=Be.beat(i,qe.GuitarTabRests,this.beat);try{super.paint(e,t,i)}finally{(a=n==null?void 0:n[Symbol.dispose])==null||a.call(n)}}}}class f2 extends lr{constructor(){super(...arguments),this.slash=null,this.noteNumbers=null,this.restGlyph=null}get effectElement(){return qe.GuitarTabEffects}getNoteX(e,t){return this.noteNumbers?this.noteNumbers.getNoteX(e,t):0}getNoteY(e,t){return this.noteNumbers?this.noteNumbers.getNoteY(e,t):0}buildBoundingsLookup(e,t,i){this.noteNumbers&&this.noteNumbers.buildBoundingsLookup(e,t+this.x,i+this.y)}doLayout(){const e=this.renderer;if(this.container.beat.isRest){const i=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),a=e.getTabY(i),n=new d2(0,a,e.showRests,this.container.beat.duration);if(this.restGlyph=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addNormal(n),this.container.beat.dots>0&&e.showRests){this.addNormal(new oi(0,0,5));for(let r=0;r<this.container.beat.dots;r++)this.addEffect(new yh(0,a,1.5))}}else{const i=this.renderer.settings.notation.smallGraceTabNotes&&this.container.beat.graceType!==se.None;let a;if(this.container.beat.slashed&&!this.container.beat.notes.some(n=>n.isTieDestination)){const n=Math.floor((this.renderer.bar.staff.tuning.length-1)/2),r=e.getLineY(n),o=new Gh(0,r,this.container.beat.duration,i,this.container.beat);o.noteHeadElement=Ci.GuitarTabFretNumber,o.effectElement=qe.GuitarTabEffects,this.slash=o,o.beat=this.container.beat,o.beamingHelper=this.beamingHelper,this.addNormal(o),a=o.beatEffects}else{const n=new u2(0,0,i);this.noteNumbers=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper;for(const r of this.container.beat.notes)r.isVisible&&this.createNoteGlyph(r);this.addNormal(n),a=n.beatEffects}if(this.container.beat.hasWhammyBar){const n=new Ds(this.container.beat);n.renderer=this.renderer,n.doLayout(),this.container.ties.push(n)}if(this.container.beat.isTremolo&&!a.has("tremolo")){let n=0;const r=this.container.beat.tremoloSpeed;let o=5;switch(r){case w.ThirtySecond:n=10;break;case w.Sixteenth:n=5;break;case w.Eighth:n=0;break}this.container.beat.duration<w.Half&&(o=0),a.set("tremolo",new od(o,n,r))}if(this.container.beat.dots>0&&e.rhythmMode!==Us.Hidden){this.addNormal(new oi(0,0,5));for(let n=0;n<this.container.beat.dots;n++)this.addEffect(new yh(0,e.lineOffset*e.bar.staff.tuning.length+e.settings.notation.rhythmHeight,1.5))}}if(this.isEmpty)return;let t=0;for(let i=0,a=this.glyphs.length;i<a;i++){const n=this.glyphs[i];n.x=t,n.renderer=this.renderer,n.doLayout(),t+=n.width}this.width=t,this.computedWidth=t,this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteNumbers?this.centerX=this.noteNumbers.x+this.noteNumbers.noteStringWidth/2:this.slash&&(this.centerX=this.slash.x+this.slash.width/2)}updateBeamingHelper(){this.noteNumbers?this.noteNumbers.updateBeamingHelper(this.container.x+this.x):this.restGlyph?this.restGlyph.updateBeamingHelper(this.container.x+this.x):this.slash&&this.slash.updateBeamingHelper(this.container.x+this.x)}createNoteGlyph(e){const t=this.renderer,i=new c2(0,0,e),a=e.beat.voice.bar.staff.tuning.length-e.string;i.y=t.getTabY(a),i.renderer=this.renderer,i.doLayout(),this.noteNumbers.addNoteGlyph(i,e);const n=i.y-i.height/2,r=n+i.height;this.renderer.helpers.collisionHelper.reserveBeatSlot(this.container.beat,n,r)}}class p2 extends pt{constructor(e){super(0,0),this._beat=e}doLayout(){this.width=10}paint(e,t,i){const a=this.renderer,n=t+this.x+a.getNoteY(this._beat.maxStringNote,$.Top),r=t+this.y+a.getNoteY(this._beat.minStringNote,$.Bottom),o=e+this.x+this.width/2|0,l=8;if(this._beat.brushType!==Y.None){if(this._beat.brushType===Y.BrushUp||this._beat.brushType===Y.BrushDown)i.beginPath(),i.moveTo(o,n),i.lineTo(o,r),i.stroke();else if(this._beat.brushType===Y.ArpeggioUp){const h=new ar(0,0,ve.Slight,1.2,!0);h.renderer=this.renderer,h.doLayout();const c=n,d=r-l;h.width=Math.abs(d-c),i.beginRotate(e+this.x+4,d,-90),h.paint(0,-h.height/2,i),i.endRotate()}else if(this._beat.brushType===Y.ArpeggioDown){const h=new ar(0,0,ve.Slight,1.2,!0);h.renderer=this.renderer,h.doLayout();const c=n+l,d=r;h.width=Math.abs(d-c),i.beginRotate(e+this.x+4,c,90),h.paint(0,-h.height/2,i),i.endRotate()}this._beat.brushType===Y.BrushUp||this._beat.brushType===Y.ArpeggioUp?(i.beginPath(),i.moveTo(o,r),i.lineTo(o+l/2,r-l),i.lineTo(o-l/2,r-l),i.closePath(),i.fill()):(i.beginPath(),i.moveTo(o,n),i.lineTo(o+l/2,n+l),i.lineTo(o-l/2,n+l),i.closePath(),i.fill())}}}class g2 extends or{doLayout(){this.container.beat.brushType!==Y.None&&!this.container.beat.isRest&&(this.addEffect(new p2(this.container.beat)),this.addNormal(new oi(0,0,4))),super.doLayout()}get effectElement(){return qe.GuitarTabEffects}}class m2 extends pt{doLayout(){this.width=He.Widths.get(u.SixStringTabClef)}paint(e,t,i){var n;const a=Be.bar(i,Ee.GuitarTabsClef,this.renderer.bar);try{const r=this.renderer.bar.staff.tuning.length,o=r<=4?u.FourStringTabClef:u.SixStringTabClef,l=r<=4?r/4.5:r/6.5;i.fillMusicFontSymbol(e+this.x+5,t+this.y,l,o,!1)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}class y2 extends Ak{doLayout(){this.barSubElement=Ee.GuitarTabsTimeSignature,super.doLayout()}get commonScale(){return 1}get numberScale(){return this.renderer.bar.staff.tuning.length<=4?Ye.GraceScale:1}}class Rr extends _a{get showMultiBarRest(){return this._showMultiBarRest}get repeatsBarSubElement(){return Ee.GuitarTabsRepeats}get barNumberBarSubElement(){return Ee.GuitarTabsBarNumber}get barLineBarSubElement(){return Ee.GuitarTabsBarLines}get staffLineBarSubElement(){return Ee.GuitarTabsStaffLine}constructor(e,t){super(e,t),this._hasTuplets=!1,this.showTimeSignature=!1,this.showRests=!1,this.showTiedNotes=!1,this._showMultiBarRest=!1,t.staff.showStandardNotation||(this.showTimeSignature=!0,this.showRests=!0,this.showTiedNotes=!0,this._showMultiBarRest=!0)}get lineSpacing(){return Rr.TabLineSpacing}get heightLineCount(){return this.bar.staff.tuning.length}get drawnLineCount(){return this.bar.staff.tuning.length}get rhythmMode(){let e=this.settings.notation.rhythmMode;return e===Us.Automatic&&(e=this.bar.staff.showStandardNotation?Us.Hidden:Us.ShowWithBars),e}getTabY(e){return super.getLineY(e)}getTabHeight(e){return super.getLineHeight(e)}collectSpaces(e){for(const i of this.bar.voices)if(this.hasVoiceContainer(i)){const a=this.getVoiceContainer(i);for(const n of a.beatGlyphs){const r=n.onNotes,o=r.noteNumbers;if(o)for(const[l,h]of o.notesPerString)h.isEmpty||e[this.bar.staff.tuning.length-l].push(new Float32Array([a.x+n.x+r.x+o.x,o.width+1]))}}}adjustSizes(){this.rhythmMode!==Us.Hidden&&(this.height+=this.settings.notation.rhythmHeight,this.bottomPadding+=this.settings.notation.rhythmHeight)}doLayout(){if(super.doLayout(),this.rhythmMode!==Us.Hidden){this._hasTuplets=!1;for(const e of this.bar.voices)if(this.hasVoiceContainer(e)&&this.getVoiceContainer(e).tupletGroups.length>0){this._hasTuplets=!0;break}this._hasTuplets&&this.registerOverflowBottom(this.tupletSize)}}createLinePreBeatGlyphs(){if(this.isFirstOfLine){const e=(this.bar.staff.tuning.length-1)/2;this.addPreBeatGlyph(new m2(5,this.getTabY(e)))}this.showTimeSignature&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new oi(0,0,5));const e=(this.bar.staff.tuning.length+1)/2-1;this.addPreBeatGlyph(new y2(0,this.getTabY(e),this.bar.masterBar.timeSignatureNumerator,this.bar.masterBar.timeSignatureDenominator,this.bar.masterBar.timeSignatureCommon,this.bar.masterBar.isFreeTime))}createVoiceGlyphs(e){if(this.additionalMultiRestBars){const t=new rd(this.getVoiceContainer(e));this.addBeatGlyph(t)}else for(const t of e.beats){const i=new h2(t,this.getVoiceContainer(e));i.preNotes=new g2,i.onNotes=new f2,this.addBeatGlyph(i)}}paint(e,t,i){super.paint(e,t,i),this.rhythmMode!==Us.Hidden&&(this.paintBeams(e,t,i,qe.GuitarTabFlags,qe.GuitarTabBeams),this.paintTuplets(e,t,i,qe.GuitarTabTuplet))}drawBeamHelperAsFlags(e){return super.drawBeamHelperAsFlags(e)||this.rhythmMode===Us.ShowWithBeams}getFlagTopY(e,t){const i=this.getOnNotesGlyphForBeat(e);return!i.noteNumbers||e.duration===w.Half?this.height-this.settings.notation.rhythmHeight-this.tupletSize:i.noteNumbers.getNoteY(i.noteNumbers.minStringNote,$.Bottom)}getFlagBottomY(e,t){return this.getFlagAndBarPos()}getFlagStemSize(e,t=!1){return 0}getBarLineStart(e,t){const i=this.getOnNotesGlyphForBeat(e);return!i.noteNumbers||e.duration===w.Half?this.height-this.settings.notation.rhythmHeight-this.tupletSize:i.noteNumbers.getNoteY(i.noteNumbers.minStringNote,$.Bottom)+this.lineOffset/2}getBeamDirection(e){return P.Down}getFlagAndBarPos(){return this.height-(this._hasTuplets?this.tupletSize/2:0)}calculateBeamYWithDirection(e,t,i){return this.getFlagAndBarPos()}shouldPaintFlag(e,t){return!super.shouldPaintFlag(e,t)||e.graceType!==se.None?!1:this.drawBeamHelperAsFlags(t)}paintBeamingStem(e,t,i,a,n,r){var l;if(n<a){const h=n;n=a,a=h}const o=Be.beat(r,qe.GuitarTabStem,e);try{r.lineWidth=ot.StemWidth,r.beginPath();let h=[];this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.has(e.displayStart)&&(h=this.helpers.collisionHelper.reservedLayoutAreasByDisplayTime.get(e.displayStart).slots.slice(),h.sort((d,f)=>d.topY-f.topY));let c=n;for(;c>a;){r.moveTo(i,c);let d=a;if(h.length>0&&h[h.length-1].bottomY>d){const f=h.pop();d=t+f.bottomY,r.lineTo(i,d),c=t+f.topY}else{r.lineTo(i,d);break}}r.stroke(),r.lineWidth=1}finally{(l=o==null?void 0:o[Symbol.dispose])==null||l.call(o)}}}Rr.StaffId="tab";Rr.TabLineSpacing=10;class af extends Vh{get staffId(){return Rr.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}constructor(){super(),this.showTimeSignature=null,this.showRests=null,this.showTiedNotes=null,this.hideOnPercussionTrack=!0}canCreate(e,t){return t.showTablature&&t.tuning.length>0&&super.canCreate(e,t)}create(e,t){const i=new Rr(e,t);return this.showRests!==null&&(i.showRests=this.showRests),this.showTimeSignature!==null&&(i.showTimeSignature=this.showTimeSignature),this.showTiedNotes!==null&&(i.showTiedNotes=this.showTiedNotes),i}}class bh extends cs{constructor(){super(0,0)}doLayout(){super.doLayout();const e=this.renderer.resources.effectFont;this.height=e.size+bh.Padding}paint(e,t,i){const a=this.renderer.resources;i.font=a.effectFont;const n=i.textAlign;i.textAlign=Q.Center,i.fillText("T",e+this.x,t+this.y+i.font.size/2),i.textAlign=n,i.strokeCircle(e+this.x,t+this.y+i.font.size/2+(bh.Padding-1),i.font.size/1.6)}}bh.Padding=4;class n0 extends Gr{get notationElement(){return be.EffectTap}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyphForNote(e){return e.isLeftHandTapped}createNewGlyph(e,t){return new bh}}class mn{constructor(){this.noteRange=1,this.x=0,this.y=0}}var Sr;(function(s){s[s.None=0]="None",s[s.Rectangle=1]="Rectangle",s[s.Ellipse=2]="Ellipse",s[s.Circle=3]="Circle"})(Sr||(Sr={}));class nf extends mn{constructor(){super(...arguments),this.align=Q.Left,this.frame=Sr.None,this.text="",this.fontFace="",this.weight=0,this.height=0}}class r0 extends mn{constructor(){super(...arguments),this.chord=new er}}class o0 extends mn{}class l0 extends mn{}class b2 extends mn{constructor(){super(...arguments),this.number=0}}class h0 extends mn{constructor(){super(...arguments),this.decrescendo=!1}}class rf extends mn{constructor(){super(...arguments),this.allNumbers=!1,this.firstNumber=0,this.lastNumber=0}}class S2 extends mn{constructor(){super(...arguments),this.octave=1}}class w2 extends mn{}class k2{constructor(){this.defaultClef=xe.G2,this.description="",this.percussion=!1,this.instrument=0,this.volume=0,this.transpose=0,this.index=0}}class T2{constructor(){this.from=0,this.to=0,this.curly=!1}}class B2{constructor(){this.currentBarIndex=-1,this.currentBarComplete=!0,this.currentBarDuration=0,this.currentPosition=0,this.voiceStemDir=null,this.repeatCount=0,this.repeatEnd=null}}class Pu{constructor(){this._trackChannel=0,this._beamingMode=it.Auto,this._isFirstSystem=!0,this._staffLookup=new Map,this._brackets=[],this._staffLayoutLookup=new Map,this._staffLayouts=[],this._timeSignature=new Ca,this._voiceStates=new Map}parseXml(e,t){this._galleryObjects=new Map,this._tieStarts=[],this._tieStartIds=new Map,this._voiceCounts=new Map,this._slurs=new Map,this._crescendo=new Map,this._isFirstSystem=!0;const i=new oh;try{i.parse(e)}catch(a){throw new vt("Could not parse XML",a)}this.parseDom(i),this.consolidate(),this.score.finish(t)}consolidate(){V.consolidate(this.score),Pu.applyEffectRange(this._slurs,(e,t)=>{t.isLegatoOrigin=!0}),Pu.applyEffectRange(this._crescendo,(e,t)=>{t.crescendo=e.decrescendo?vi.Decrescendo:vi.Crescendo})}static applyEffectRange(e,t){for(const[i,a]of e){const n=a.noteRange;let r=i;for(let o=0;o<n;o++)if(t(a,r),r.index+1<r.voice.beats.length)r=r.voice.beats[r.index+1];else if(r.voice.bar.index+1<r.voice.bar.staff.bars.length)r=r.voice.bar.staff.bars[r.voice.bar.index+1].voices[r.voice.index].beats[0];else break}}parseDom(e){const t=e.firstElement;if(!t)throw new vt("No valid XML");if(t.localName==="score"){this.score=new fn,this.score.tempo=120;for(const i of t.childElements())switch(i.localName){case"info":this.parseInfo(i);break;case"layout":this.parseLayout(i);break;case"gallery":this.parseGallery(i);break;case"pageObjects":this.parsePageObjects(i);break;case"systems":this.parseSystems(i);break}}else throw new vt('Root node of XML was not "score"')}parseLayout(e){for(const n of e.childElements())switch(n.localName){case"staves":this.parseLayoutStaves(n);break;case"brackets":this.parseBrackets(n);break}const t=this._brackets.filter(n=>!!n.curly);t.sort((n,r)=>n.from-r.from);let i=0,a=null;for(let n=0;n<this._staffLayouts.length;n++){const r=this._staffLayouts[n];for(;i<t.length&&n>t[i].to;)i++;a&&i<t.length&&n>t[i].from&&n<=t[i].to?a.ensureStaveCount(a.staves.length+1):(a=new Ea,a.ensureStaveCount(1),a.name=r.description,a.playbackInfo.volume=Math.floor(r.volume/128*16),a.playbackInfo.program=r.instrument,r.percussion?(a.playbackInfo.primaryChannel=9,a.playbackInfo.secondaryChannel=9):(a.playbackInfo.primaryChannel=this._trackChannel++,a.playbackInfo.secondaryChannel=this._trackChannel++),this.score.addTrack(a));const o=a.staves[a.staves.length-1];o.isPercussion=r.percussion,o.transpositionPitch=r.transpose,o.displayTranspositionPitch=0,o.showTablature=!1,this._staffLookup.set(r.index,o)}}parseBrackets(e){for(const t of e.childElements())switch(t.localName){case"bracket":this.parseBracket(t);break}}parseBracket(e){const t=new T2;t.from=Number.parseInt(e.getAttribute("from")),t.to=Number.parseInt(e.getAttribute("to")),e.attributes.has("curly")&&(t.curly=e.attributes.get("curly")==="true"),this._brackets.push(t)}parseLayoutStaves(e){for(const t of e.childElements())switch(t.localName){case"staffLayout":this.parseStaffLayout(t);break}}parseStaffLayout(e){const t=new k2;t.description=e.getAttribute("description");for(const i of e.childElements())switch(i.localName){case"notation":i.attributes.has("defaultClef")&&(t.defaultClef=this.parseClef(i.attributes.get("defaultClef")));break;case"sound":i.attributes.has("percussion")&&(t.percussion=i.attributes.get("percussion")==="true"),i.attributes.has("instr")&&(t.instrument=Number.parseInt(i.attributes.get("instr"))),i.attributes.has("volume")&&(t.volume=Number.parseInt(i.attributes.get("volume"))),i.attributes.has("transpose")&&(t.transpose=Number.parseInt(i.attributes.get("transpose")));break}this._staffLayoutLookup.set(t.description,t),t.index=this._staffLayouts.length,this._staffLayouts.push(t)}parseClef(e){switch(e){case"treble":return xe.G2;case"bass":return xe.F4;case"alto":return xe.C4;case"tenor":return xe.C4}return xe.G2}parseClefOttava(e){return e.endsWith("-")?fe._8vb:e.endsWith("+")?fe._8va:fe.Regular}parseSystems(e){for(const t of e.childElements())switch(t.localName){case"system":this.parseSystem(t);break}}parseSystem(e){e.attributes.has("tempo")&&this.score.masterBars.length===0&&(this.score.tempo=Number.parseInt(e.attributes.get("tempo"))),e.getAttribute("beamGrouping")==="0"&&(this._beamingMode=it.ForceSplitToNext);for(const t of e.childElements())switch(t.localName){case"staves":this.parseStaves(e,t);break}this._isFirstSystem=!1}parseStaves(e,t){const i=this.score.masterBars.length;for(const a of t.childElements())switch(a.localName){case"staff":this.parseStaff(e,i,a);break}}parseStaff(e,t,i){const a=i.getAttribute("layout");this._currentStaffLayout=this._staffLayoutLookup.get(a),this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!1,this.parseTime(i.getAttribute("defaultTime"));const n=this._staffLookup.get(this._currentStaffLayout.index);for(;n.bars.length<t;)this.addNewBar(n);for(const r of i.childElements())switch(r.localName){case"voices":this.parseVoices(a,n,e,t,r);break}}parseTime(e){switch(e){case"allaBreve":case"C":this._timeSignature.timeSignatureNumerator=2,this._timeSignature.timeSignatureDenominator=2,this._timeSignature.timeSignatureCommon=!0;break;case"longAllaBreve":this._timeSignature.timeSignatureNumerator=4,this._timeSignature.timeSignatureDenominator=4,this._timeSignature.timeSignatureCommon=!0;break;default:if(e.indexOf("/")>0){const t=e.split("/");this._timeSignature.timeSignatureNumerator=Number.parseInt(t[0]),this._timeSignature.timeSignatureDenominator=Number.parseInt(t[1]),this._timeSignature.timeSignatureCommon=!1}break}}parseVoices(e,t,i,a,n){let r=0;for(const o of n.childElements())switch(o.localName){case"voice":this.parseVoice(e,t,i,r,a,o),r++;break}}getOrCreateBar(e,t){return t<e.bars.length?e.bars[t]:this.addNewBar(e)}addNewBar(e){const t=new qi;if(e.bars.length>0?(t.clef=e.bars[e.bars.length-1].clef,t.clefOttava=e.bars[e.bars.length-1].clefOttava,t.keySignature=e.bars[e.bars.length-1].keySignature,t.keySignatureType=e.bars[e.bars.length-1].keySignatureType):t.clef=this._currentStaffLayout.defaultClef,e.addBar(t),e.bars.length>this.score.masterBars.length){const i=new Ca;this.score.addMasterBar(i),i.index>0&&(i.tripletFeel=i.previousMasterBar.tripletFeel),i.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,i.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,i.timeSignatureCommon=this._timeSignature.timeSignatureCommon}return t}newBar(e,t){this._currentVoiceState.currentBarIndex++,this._currentBar=this.getOrCreateBar(e,this._currentVoiceState.currentBarIndex),this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1),this._currentVoiceState.currentBarComplete=!1,this._currentVoiceState.currentPosition=0,this.ensureVoice(e,t)}parseVoice(e,t,i,a,n,r){const o=`${e}_${a}`;if(this._currentVoiceState&&!this._currentVoiceState.currentBarComplete&&(this._currentBar.masterBar.isAnacrusis=!0),this._voiceStates.has(o)?(this._currentVoiceState=this._voiceStates.get(o),this._currentBar=this.getOrCreateBar(t,this._currentVoiceState.currentBarIndex),this.ensureVoice(t,a)):(this._currentVoiceState=new B2,this._currentVoiceState.currentBarIndex=n-1,this._voiceStates.set(o,this._currentVoiceState),this.newBar(t,a)),r.attributes.has("stemDir"))switch(r.attributes.get("stemDir")){case"up":this._currentVoiceState.voiceStemDir=P.Up;break;case"down":this._currentVoiceState.voiceStemDir=P.Down;break;default:this._currentVoiceState.voiceStemDir=null;break}else this._currentVoiceState.voiceStemDir=null;const l=r.findChildElement("noteObjects");if(i.attributes.has("tempo")){const h=new wt;h.isLinear=!0,h.type=tt.Tempo,h.value=Number.parseInt(i.attributes.get("tempo")),h.ratioPosition=this._currentVoiceState.currentPosition/this._currentVoiceState.currentBarDuration,this._currentBar.masterBar.tempoAutomations.push(h)}if(l)for(const h of l.childElements())switch(this._currentVoiceState.currentBarComplete&&h.localName!=="barline"&&this.newBar(t,a),h.localName){case"clefSign":this._currentBar.clef=this.parseClef(h.getAttribute("clef")),this._currentBar.clefOttava=this.parseClefOttava(h.getAttribute("clef"));break;case"keySign":this._currentBar.keySignature=Number.parseInt(h.getAttribute("fifths"));break;case"timeSign":this.parseTime(h.getAttribute("time")),this._currentBar.masterBar.timeSignatureDenominator=this._timeSignature.timeSignatureDenominator,this._currentBar.masterBar.timeSignatureNumerator=this._timeSignature.timeSignatureNumerator,this._currentBar.masterBar.timeSignatureCommon=this._timeSignature.timeSignatureCommon,this._currentVoiceState.currentPosition=0,this._currentVoiceState.currentBarDuration=this._currentBar.masterBar.calculateDuration(!1);break;case"barline":switch(h.getAttribute("type")){case"double":this._currentBar.barLineRight=oe.LightLight,this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"end":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0);break;case"repEnd":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(h),this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;case"repBegin":this.newBar(t,a),this._currentBar.masterBar.isRepeatStart=!0,this._currentVoiceState.repeatEnd=null,this._currentVoiceState.repeatCount=0;break;case"repEndBegin":this._currentVoiceState.repeatEnd=this._currentBar.masterBar,this._currentBar.masterBar.repeatCount<this._currentVoiceState.repeatCount&&(this._currentBar.masterBar.repeatCount=this._currentVoiceState.repeatCount),this.parseBarDrawObject(h),this.newBar(t,a),this._currentBar.masterBar.isRepeatStart=!0;break;case"dashed":this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break;default:this._currentVoiceState.currentBarComplete||(this._currentBar.masterBar.isAnacrusis=!0),this._currentVoiceState.currentBarComplete=!0;break}break;case"chord":const c=new Wt;this.initFromPreviousBeat(c,this._currentVoice),c.beamingMode=this._beamingMode,this._currentVoiceState.voiceStemDir&&(c.preferredBeamDirection=this._currentVoiceState.voiceStemDir),this.parseDuration(this._currentBar,c,h.findChildElement("duration")),c.updateDurations(),this._currentVoiceState.currentPosition+=c.playbackDuration,this._currentVoice.addBeat(c),this.parseChord(c,h),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0);break;case"rest":const d=this.parseRestDurations(this._currentBar,h.findChildElement("duration"));d&&(this.initFromPreviousBeat(d,this._currentVoice),d.updateDurations(),this._currentVoiceState.currentPosition+=d.playbackDuration,this._currentVoice.addBeat(d),this._currentVoiceState.currentPosition>=this._currentVoiceState.currentBarDuration&&(this._currentVoiceState.currentBarComplete=!0));break}}initFromPreviousBeat(e,t){const i=this.getLastBeat(t);i&&(e.dynamics=i.dynamics)}getLastBeat(e){if(e.beats.length>0)return e.beats[e.beats.length-1];if(e.bar.index>0){const t=e.bar.staff.bars[e.bar.index-1];if(e.index<t.voices.length){const i=t.voices[e.index];return this.getLastBeat(i)}}return null}ensureVoice(e,t){for(;this._currentBar.voices.length<t+1;)this._currentBar.addVoice(new Bs);(!this._voiceCounts.has(e.track.index)||this._voiceCounts.get(e.track.index)<this._currentBar.voices.length)&&this._voiceCounts.set(e.track.index,this._currentBar.voices.length),this._currentVoice=this._currentBar.voices[t]}parseChord(e,t){const i=new bt;for(const a of t.childElements())switch(a.localName){case"stem":switch(a.getAttribute("dir")){case"up":e.preferredBeamDirection=P.Up;break;case"down":e.preferredBeamDirection=P.Down;break}break;case"articulation":switch(a.getAttribute("type")){case"staccato":i.isStaccato=!0;break;case"normalAccent":i.accentuated=_t.Normal;break;case"strongAccent":i.accentuated=_t.Heavy;break}break;case"lyric":this.parseLyric(e,a);break;case"drawObjects":this.parseBeatDrawObject(e,a);break;case"heads":this.parseHeads(e,i,a);break;case"beam":switch(a.getAttribute("group")){case"force":e.beamingMode=it.ForceMergeWithNext;break;case"divide":e.beamingMode=it.ForceSplitToNext;break}break}}parseHeads(e,t,i){for(const a of i.childElements())switch(a.localName){case"head":this.parseHead(e,t,a);break}}parseHead(e,t,i){const a=new bt,n=V.parseTuning(i.getAttribute("pitch"));a.octave=n.octave-1,a.tone=n.tone.noteValue,a.isStaccato=t.isStaccato,a.accentuated=t.accentuated,e.addNote(a);for(const r of i.childElements())switch(r.localName){case"alter":r.attributes.has("step")&&(a.tone+=Number.parseInt(r.attributes.get("step")));break;case"tie":r.attributes.has("begin")?this._tieStartIds.has(a.id)||(this._tieStartIds.set(a.id,!0),this._tieStarts.push(a)):r.attributes.has("end")&&this._tieStarts.length>0&&!a.isTieDestination&&(a.isTieDestination=!0,a.tieOrigin=this._tieStarts[0],this._tieStarts.splice(0,1),this._tieStartIds.delete(a.id));break}}parseBeatDrawObject(e,t){for(const i of t.childElements())switch(i.localName){case"drawObj":const a=this.parseDrawObj(i);if(a){if(a instanceof nf)a.fontFace.startsWith("capella")?a.text==="u"?(e.fermata=new Rh,e.fermata.type=Bi.Medium):a.text==="f"?e.dynamics=j.F:a.text==="j"&&(e.dynamics=j.MF):this._isFirstSystem&&this.score.title===""&&a.align===Q.Center&&a.height>16&&a.weight>400?this.score.title=a.text:this._isFirstSystem&&this.score.artist===""&&a.align===Q.Center&&a.y<0?this.score.artist=a.text:this._isFirstSystem&&this.score.music===""&&a.align===Q.Right&&a.y<0?this.score.music=a.text:a.text.startsWith("by capella")||(e.text=a.text);else if(!(a instanceof r0))if(a instanceof l0)e.vibrato=ve.Slight;else if(a instanceof h0)e.crescendo=a.decrescendo?vi.Decrescendo:vi.Crescendo,a.noteRange++,this._crescendo.set(e,a);else if(a instanceof o0){const n=a;this._slurs.set(e,n)}else a instanceof rf&&this.applyVolta(a)}break}}parseBarDrawObject(e){for(const t of e.childElements())switch(t.localName){case"drawObj":const i=this.parseDrawObj(t);i&&i instanceof rf&&this.applyVolta(i);break}}applyVolta(e){if(e.lastNumber>0?(this._currentVoiceState.repeatCount=e.lastNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)):e.firstNumber>0&&(this._currentVoiceState.repeatCount=e.firstNumber,this._currentVoiceState.repeatEnd&&this._currentVoiceState.repeatEnd.repeatCount<this._currentVoiceState.repeatCount&&(this._currentVoiceState.repeatEnd.repeatCount=this._currentVoiceState.repeatCount)),e.lastNumber>0&&e.firstNumber>0){let t=0;for(let i=e.firstNumber;i<=e.lastNumber;i++)t=t|1<<i-1;this._currentBar.masterBar.alternateEndings=t}else e.lastNumber>0?this._currentBar.masterBar.alternateEndings=1<<e.lastNumber-1:e.firstNumber>0&&(this._currentBar.masterBar.alternateEndings=1<<e.firstNumber-1)}parseLyric(e,t){for(const i of t.childElements())switch(i.localName){case"verse":e.lyrics||(e.lyrics=[]);let a=i.innerText;i.getAttribute("hyphen")==="true"&&(a+="-"),e.lyrics.push(a);break}}parseRestDurations(e,t){const i=t.getAttribute("base");if(i.indexOf("/")!==-1){const n=new Wt;return n.beamingMode=this._beamingMode,this.parseDuration(e,n,t),n}if(Number.parseInt(i)===1){const n=new Wt;return n.beamingMode=this._beamingMode,n.duration=w.Whole,n}return E.warning("Importer","Multi-Bar rests are not supported"),null}parseDurationValue(e){switch(e){case"2/1":return w.DoubleWhole;case"1/1":return w.Whole;case"1/2":return w.Half;case"1/4":return w.Quarter;case"1/8":return w.Eighth;case"1/16":return w.Sixteenth;case"1/32":return w.ThirtySecond;case"1/64":return w.SixtyFourth;case"1/128":return w.OneHundredTwentyEighth;default:return E.warning("Importer","Unsupported duration"),w.Quarter}}parseDuration(e,t,i){const a=i.getAttribute("base");t.duration=this.parseDurationValue(a),i.attributes.has("dots")&&(t.dots=Number.parseInt(i.attributes.get("dots")));const n=i.findChildElement("tuplet");if(n){t.tupletNumerator=Number.parseInt(n.getAttribute("count"));const r=n.getAttribute("tripartite")==="true"?3:1,o=n.getAttribute("prolong")==="true"?0:1;let l=0;for(;r*Math.pow(2,l+o)<t.tupletNumerator;)l++;t.tupletDenominator=r*Math.pow(2,l)}}parsePageObjects(e){for(const t of e.childElements())switch(t.localName){case"drawObj":const i=this.parseDrawObj(t);if(i&&i instanceof nf)switch(i.align){case Q.Center:this.score.title?this.score.subTitle||(this.score.subTitle=t.innerText):this.score.title=t.innerText;break;case Q.Right:this.score.artist||(this.score.artist=t.innerText);break}break}}parseGallery(e){for(const t of e.childElements())switch(t.localName){case"drawObj":const i=this.parseDrawObj(t);i&&this._galleryObjects.set(t.getAttribute("name"),i);break}}parseDrawObj(e){let t=null,i=1;for(const a of e.childElements())switch(a.localName){case"text":t=this.parseText(a);break;case"guitar":t=this.parseGuitar(a);break;case"slur":t=this.parseSlur(a);break;case"wavyLine":t=this.parseWavyLine(a);break;case"bracket":t=this.parseTupletBracket(a);break;case"wedge":t=this.parseWedge(a);break;case"volta":t=this.parseVolta(a);break;case"octaveClef":t=this.parseOctaveClef(a);break;case"trill":t=this.parseTrill(a);break;case"basic":a.attributes.has("noteRange")&&(i=Number.parseInt(a.attributes.get("noteRange")));break}return t&&(t.noteRange=i),t}parseTrill(e){return new w2}parseOctaveClef(e){const t=new S2;return e.attributes.has("octave")&&(t.octave=Number.parseInt(e.attributes.get("octave"))),t}parseVolta(e){const t=new rf;return t.allNumbers=e.attributes.get("allNumbers")==="true",e.attributes.has("firstNumber")&&(t.firstNumber=Number.parseInt(e.attributes.get("firstNumber"))),e.attributes.has("lastNumber")&&(t.lastNumber=Number.parseInt(e.attributes.get("lastNumber"))),t}parseWedge(e){const t=new h0;return t.decrescendo=e.attributes.get("decrescendo")==="true",t}parseTupletBracket(e){const t=new b2;return e.attributes.has("number")&&(t.number=Number.parseInt(e.attributes.get("number"))),t}parseWavyLine(e){return new l0}parseSlur(e){return new o0}parseGuitar(e){const t=new r0,i=e.innerText.trim();for(let a=0;a<i.length;a++)i.charAt(a)==="/"?t.chord.strings.push(0):t.chord.strings.push(Number.parseInt(i.charAt(a)));return t}parseText(e){const t=new nf;switch(e.attributes.has("x")&&(t.x=Number.parseFloat(e.attributes.get("x"))),e.attributes.has("x")&&(t.y=Number.parseFloat(e.attributes.get("y"))),e.getAttribute("align")){case"left":t.align=Q.Left;break;case"center":t.align=Q.Center;break;case"right":t.align=Q.Right;break}switch(e.getAttribute("frame")){case"rectangle":t.frame=Sr.Rectangle;break;case"ellipse":t.frame=Sr.Ellipse;break;case"circle":t.frame=Sr.Circle;break;case"none":t.frame=Sr.None;break}if(e.firstElement)for(const i of e.childElements())switch(i.localName){case"font":t.fontFace=i.getAttribute("face"),i.attributes.has("weight")&&(t.weight=Number.parseInt(i.attributes.get("weight"))),i.attributes.has("height")&&(t.height=Number.parseInt(i.attributes.get("height")));break;case"content":t.text=i.innerText;break}else t.text=e.innerText;return t}parseInfo(e){for(const t of e.childElements())switch(t.localName){case"author":this.score.tab=t.firstChild.innerText;break;case"comment":this.score.notices=t.firstChild.innerText;break}}}class _2 extends Ko{get name(){return"Capella"}readScore(){E.debug(this.name,"Loading ZIP entries");const e=new Pg(this.data);let t,i=null;if(t=e.read(),E.debug(this.name,"Zip entries loaded"),t.length>0)for(const a of t)switch(a.fileName){case"score.xml":i=x.toString(a.data,this.settings.importer.encoding);break}else this.data.reset(),i=x.toString(this.data.readAll(),this.settings.importer.encoding);if(!i)throw new vt("No valid capella file");E.debug(this.name,"Start Parsing score.xml");try{const a=new Pu;return a.parseXml(i,this.settings),E.debug(this.name,"score.xml parsed"),a.score}catch(a){throw new vt("Failed to parse CapXML",a)}}}function N2(s,e,t){if(e!=null){if(typeof e!="object"&&typeof e!="function")throw new TypeError("Object expected.");var i,a;if(i===void 0){if(!Symbol.dispose)throw new TypeError("Symbol.dispose is not defined.");i=e[Symbol.dispose]}if(typeof i!="function")throw new TypeError("Object not disposable.");a&&(i=function(){try{a.call(this)}catch(n){return Promise.reject(n)}}),s.stack.push({value:e,dispose:i,async:t})}return e}var x2=typeof SuppressedError=="function"?SuppressedError:function(s,e,t){var i=new Error(t);return i.name="SuppressedError",i.error=s,i.suppressed=e,i};function v2(s){function e(n){s.error=s.hasError?new x2(n,s.error,"An error was suppressed during disposal."):n,s.hasError=!0}var t,i=0;function a(){for(;t=s.stack.pop();)try{if(!t.async&&i===1)return i=0,s.stack.push(t),Promise.resolve().then(a);if(t.dispose){var n=t.dispose.call(t.value);if(t.async)return i|=2,Promise.resolve(n).then(a,function(r){return e(r),a()})}else i|=1}catch(r){e(r)}if(i===1)return s.hasError?Promise.reject(s.error):Promise.resolve();if(s.hasError)throw s.error}return a()}class Nt{static enable(e,t){Nt.alphaSkia=t,Nt.initializeMusicFont(Nt.alphaSkia.AlphaSkiaTypeface.register(e))}static initializeMusicFont(e){Nt.musicTextStyle=new Nt.alphaSkia.AlphaSkiaTextStyle([e.familyName],e.weight,e.isItalic)}static registerFont(e,t){const i=Nt.alphaSkia.AlphaSkiaTypeface.register(e.buffer);return t||(t=ge.withFamilyList([i.familyName],12,i.isItalic?rt.Italic:rt.Plain,i.weight>400?Xi.Bold:Xi.Regular)),t}get font(){return this._font}set font(e){if(this._font===e)return;this._font=e;const t=this.textStyleKey(e);if(this._textStyles.has(t))this._textStyle=this._textStyles.get(t);else{const i=new Nt.alphaSkia.AlphaSkiaTextStyle(e.families,e.weight===Xi.Bold?700:400,e.isItalic);this._textStyles.set(t,i),this._textStyle=i}}textStyleKey(e){return[...e.families,e.weight.toString(),e.isItalic?"italic":"upright"].join("_")}constructor(){this._color=new Pe(0,0,0,0),this._lineWidth=0,this._textStyle=null,this._scale=1,this._textStyles=new Map,this._font=new ge("Arial",10,rt.Plain),this.textAlign=Q.Left,this.textBaseline=he.Top,this._canvas=new Nt.alphaSkia.AlphaSkiaCanvas,this.color=new Pe(0,0,0,255)}destroy(){this._canvas[Symbol.dispose]();for(const e of this._textStyles.values())e[Symbol.dispose]()}onRenderFinished(){return null}beginRender(e,t){this._scale=this.settings.display.scale,this._canvas.beginRender(e,t,C.HighDpiFactor)}endRender(){return this._canvas.endRender()}get color(){return this._color}set color(e){this._color.rgba!==e.rgba&&(this._color=e,this._canvas.color=Nt.alphaSkia.AlphaSkiaCanvas.rgbaToColor(e.r,e.g,e.b,e.a))}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this._canvas.lineWidth=e}fillRect(e,t,i,a){i>0&&this._canvas.fillRect(e*this._scale|0,t*this._scale|0,i*this._scale,a*this._scale)}strokeRect(e,t,i,a){const n=this.lineWidth%2===0?0:.5;this._canvas.strokeRect((e*this._scale|0)+n,(t*this._scale|0)+n,i*this._scale,a*this._scale)}beginPath(){this._canvas.beginPath()}closePath(){this._canvas.closePath()}moveTo(e,t){this._canvas.moveTo(e*this._scale,t*this._scale)}lineTo(e,t){this._canvas.lineTo(e*this._scale,t*this._scale)}quadraticCurveTo(e,t,i,a){this._canvas.quadraticCurveTo(e*this._scale,t*this._scale,i*this._scale,a*this._scale)}bezierCurveTo(e,t,i,a,n,r){this._canvas.bezierCurveTo(e*this._scale,t*this._scale,i*this._scale,a*this._scale,n*this._scale,r*this._scale)}fillCircle(e,t,i){this._canvas.fillCircle(e*this._scale,t*this._scale,i*this._scale)}strokeCircle(e,t,i){this._canvas.strokeCircle(e*this._scale,t*this._scale,i*this._scale)}fill(){this._canvas.fill()}stroke(){this._canvas.stroke()}beginGroup(e){}endGroup(){}fillText(e,t,i){if(e.length===0)return;let a=Nt.alphaSkia.AlphaSkiaTextAlign.Left;switch(this.textAlign){case Q.Left:a=Nt.alphaSkia.AlphaSkiaTextAlign.Left;break;case Q.Center:a=Nt.alphaSkia.AlphaSkiaTextAlign.Center;break;case Q.Right:a=Nt.alphaSkia.AlphaSkiaTextAlign.Right;break}let n=Nt.alphaSkia.AlphaSkiaTextBaseline.Top;switch(this.textBaseline){case he.Top:n=Nt.alphaSkia.AlphaSkiaTextBaseline.Top;break;case he.Middle:n=Nt.alphaSkia.AlphaSkiaTextBaseline.Middle;break;case he.Bottom:n=Nt.alphaSkia.AlphaSkiaTextBaseline.Bottom;break}this._canvas.fillText(e,this._textStyle,this._font.size*this._scale,t*this._scale|0,i*this._scale|0,a,n)}measureText(e){const t={stack:[],error:void 0,hasError:!1};try{const i=N2(t,this._canvas.measureText(e,this._textStyle,this._font.size,Nt.alphaSkia.AlphaSkiaTextAlign.Left,Nt.alphaSkia.AlphaSkiaTextBaseline.Alphabetic),!1);return new ed(i.width,i.actualBoundingBoxAscent+i.actualBoundingBoxDescent)}catch(i){t.error=i,t.hasError=!0}finally{v2(t)}}fillMusicFontSymbol(e,t,i,a,n){a!==u.None&&this.fillMusicFontSymbolText(e,t,i,String.fromCharCode(a),n)}fillMusicFontSymbols(e,t,i,a,n){let r="";for(const o of a)o!==u.None&&(r+=String.fromCharCode(o));this.fillMusicFontSymbolText(e,t,i,r,n)}fillMusicFontSymbolText(e,t,i,a,n){this._canvas.fillText(a,Nt.musicTextStyle,C.MusicFontSize*this._scale*i,e*this._scale,t*this._scale,n?Nt.alphaSkia.AlphaSkiaTextAlign.Center:Nt.alphaSkia.AlphaSkiaTextAlign.Left,Nt.alphaSkia.AlphaSkiaTextBaseline.Alphabetic)}beginRotate(e,t,i){this._canvas.beginRotate(e*this._scale,t*this._scale,i)}endRotate(){this._canvas.endRotate()}}Nt.musicTextStyle=null;class c0 extends Zt{constructor(e,t,i=!1){super(e.beat,t.beat,i),this.startNote=e,this.endNote=t}getTieHeight(e,t,i,a){return this.startNote===this.endNote?15:super.getTieHeight(e,t,i,a)}getBeamDirection(e,t){return P.Down}static getBeamDirectionForNote(e){return P.Down}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,$.Center)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,Ke.Right)}getEndX(){return this.endNoteRenderer.getNoteX(this.endNote,Ke.Left)}}class C2 extends rs{constructor(){super(...arguments),this._tiedNoteTie=null}createTies(e){if(e.isVisible){if(!this._tiedNoteTie&&e.isTieOrigin&&e.tieDestination.isVisible){const t=new c0(e,e.tieDestination,!1);this._tiedNoteTie=t,this.addTie(t)}if(!this._tiedNoteTie&&e.isTieDestination){const t=new c0(e.tieOrigin,e,!0);this._tiedNoteTie=t,this.addTie(t)}}}}class E2 extends zh{updateBeamingHelper(e){this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.beat,e+this.x+this.width/2,e+this.x+this.width/2)}paint(e,t,i){super.internalPaint(e,t,i,qe.SlashRests)}}class D2 extends lr{constructor(){super(...arguments),this.noteHeads=null,this.deadSlapped=null,this.restGlyph=null}get effectElement(){return qe.SlashEffects}getNoteX(e,t){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let a=i.x;switch(t){case Ke.Left:break;case Ke.Center:a+=i.width/2;break;case Ke.Right:a+=i.width;break}return a}return 0}buildBoundingsLookup(e,t,i){if(this.noteHeads&&this.container.beat.notes.length>0){const a=new Hh;a.note=this.container.beat.notes[0],a.noteHeadBounds=new hi,a.noteHeadBounds.x=t+this.x+this.noteHeads.x,a.noteHeadBounds.y=i+this.y+this.noteHeads.y-this.noteHeads.height/2,a.noteHeadBounds.w=this.width,a.noteHeadBounds.h=this.height,e.addNote(a)}}getNoteY(e,t){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let a=this.y+i.y;switch(t){case $.Top:case $.TopWithStem:a-=i.height/2+2;break;case $.Center:break;case $.Bottom:case $.BottomWithStem:a+=i.height/2;break}return a}return 0}updateBeamingHelper(){this.noteHeads?this.noteHeads.updateBeamingHelper(this.container.x+this.x):this.deadSlapped?this.beamingHelper&&this.beamingHelper.registerBeatLineX("slash",this.container.beat,this.container.x+this.x+this.deadSlapped.x+this.width,this.container.x+this.x+this.deadSlapped.x):this.restGlyph&&this.restGlyph.updateBeamingHelper(this.container.x+this.x)}doLayout(){const e=this.renderer,t=e.getNoteLine(),i=e.getLineY(t);if(this.container.beat.deadSlapped){const a=new ld;a.renderer=this.renderer,a.doLayout(),this.deadSlapped=a,this.addEffect(a)}else if(!this.container.beat.isEmpty)if(this.container.beat.isRest){const a=new E2(0,i,this.container.beat.duration);this.restGlyph=a,a.beat=this.container.beat,a.beamingHelper=this.beamingHelper,this.addNormal(a),this.beamingHelper&&this.beamingHelper.applyRest(this.container.beat,0)}else{const a=this.container.beat.graceType!==se.None,n=new Gh(0,i,this.container.beat.duration,a,this.container.beat);this.noteHeads=n,n.beat=this.container.beat,n.beamingHelper=this.beamingHelper,this.addNormal(n)}if(this.container.beat.dots>0){this.addNormal(new oi(0,0,5));for(let a=0;a<this.container.beat.dots;a++)this.addEffect(new yh(0,e.getLineY(e.getNoteLine())-e.getLineHeight(.5),1.5))}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.restGlyph?this.centerX=this.restGlyph.x+this.restGlyph.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.deadSlapped&&(this.centerX=this.deadSlapped.x+this.deadSlapped.width/2)}}class Tp extends _a{constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this._isOnlySlash=!t.staff.showTablature&&!t.staff.showStandardNotation,this.helpers.preferredBeamDirection=P.Up}get repeatsBarSubElement(){return Ee.SlashRepeats}get barNumberBarSubElement(){return Ee.SlashBarNumber}get barLineBarSubElement(){return Ee.SlashBarLines}get staffLineBarSubElement(){return Ee.SlashStaffLine}get lineSpacing(){return ot.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 1}get bottomGlyphOverflow(){return 0}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i,qe.SlashFlags,qe.SlashBeams),this.paintTuplets(e,t,i,qe.SlashTuplet)}doLayout(){super.doLayout();let e=!1;for(const t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}e&&this.registerOverflowTop(this.tupletSize)}getNoteLine(){return 0}getFlagTopY(e,t){const i=He.Heights.get(u.NoteheadSlashWhiteHalf);return this.getLineY(0)-i/2}getFlagBottomY(e,t){const i=He.Heights.get(u.NoteheadSlashWhiteHalf);return this.getLineY(0)-i/2}getBeamDirection(e){return P.Up}getNoteY(e,t){let i=super.getNoteY(e,t);return Number.isNaN(i)&&(i=this.getLineY(0)),i}calculateBeamYWithDirection(e,t,i){return this.getLineY(0)-this.getFlagStemSize(e.shortestDuration)}getBarLineStart(e,t){const i=He.Heights.get(u.NoteheadSlashWhiteHalf);return this.getLineY(0)-i/2}createLinePreBeatGlyphs(){this._isOnlySlash&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new oi(0,0,5));const e=this.bar.masterBar,t=new Yg(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(e.previousMasterBar==null||e.isFreeTime!==e.previousMasterBar.isFreeTime));t.barSubElement=Ee.SlashTimeSignature,this.addPreBeatGlyph(t)}createVoiceGlyphs(e){for(const t of e.beats){const i=new C2(t,this.getVoiceContainer(e));i.preNotes=new or,i.onNotes=e.index===0?new D2:new lr,this.addBeatGlyph(i)}}paintBeamingStem(e,t,i,a,n,r){var l;const o=Be.beat(r,qe.SlashStem,e);try{r.lineWidth=ot.StemWidth,r.beginPath(),r.moveTo(i,a),r.lineTo(i,n),r.stroke(),r.lineWidth=1}finally{(l=o==null?void 0:o[Symbol.dispose])==null||l.call(o)}}}Tp.StaffId="slash";class P2 extends Vh{get staffId(){return Tp.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new Tp(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showSlash}}class of extends Zt{constructor(e,t,i=!1){super(e?e.beat:null,t?t.beat:null,i),this.startNote=e,this.endNote=t}shouldDrawBendSlur(){return this.renderer.settings.notation.extendBendArrowsOnTiedNotes&&!!this.startNote.bendOrigin&&this.startNote.isTieOrigin}doLayout(){super.doLayout()}getBeamDirection(e,t){return P.Up}getStartY(){return this.startNoteRenderer.getNoteY(this.startNote,$.Top)}getEndY(){return this.getStartY()}getStartX(){return this.startNote===this.endNote?this.getEndX()-20:this.startNoteRenderer.getNoteX(this.startNote,Ke.Center)}getEndX(){return this.startNote===this.endNote?this.endNoteRenderer.getNoteX(this.endNote,Ke.Left):this.endNoteRenderer.getNoteX(this.endNote,Ke.Center)}}class u0 extends on{constructor(e,t,i,a=!1){super(e,t,a),this._direction=P.Up,this._forSlide=i}getTieHeight(e,t,i,a){return Math.log(i-e+1)*this.renderer.settings.notation.slurHeight}tryExpand(e,t,i,a){if(this._forSlide!==i||this.forEnd!==a||this.startNote.beat.id!==e.beat.id||this.endNote.beat.id!==t.beat.id)return!1;switch(this._direction){case P.Up:e.realValue>this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue>this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break;case P.Down:e.realValue<this.startNote.realValue&&(this.startNote=e,this.startBeat=e.beat),t.realValue<this.endNote.realValue&&(this.endNote=t,this.endBeat=t.beat);break}return!0}paint(e,t,i){const a=this.renderer.scoreRenderer.layout.getRendererForBar(this.renderer.staff.staffId,this.startBeat.voice.bar),n=this.getBeamDirection(this.startBeat,a),r=`numbered.slur.${this.startNote.beat.id}.${this.endNote.beat.id}.${n}`,o=this.renderer;o.staff.getSharedLayoutData(r,!1)||(o.staff.setSharedLayoutData(r,!0),super.paint(e,t,i))}}class L2 extends rs{constructor(){super(...arguments),this._effectSlurs=[]}createTies(e){if(e.isVisible){if(e.isTieOrigin&&e.tieDestination.isVisible){const t=new of(e,e.tieDestination,!1);this.addTie(t)}if(e.isTieDestination){const t=new of(e.tieOrigin,e,!0);this.addTie(t)}if(e.isLeftHandTapped&&!e.isHammerPullDestination){const t=new of(e,e,!1);this.addTie(t)}if(e.isEffectSlurOrigin&&e.effectSlurDestination){let t=!1;for(const i of this._effectSlurs)if(i.tryExpand(e,e.effectSlurDestination,!1,!1)){t=!0;break}if(!t){const i=new u0(e,e.effectSlurDestination,!1,!1);this._effectSlurs.push(i),this.addTie(i)}}if(e.isEffectSlurDestination&&e.effectSlurOrigin){let t=!1;for(const i of this._effectSlurs)if(i.tryExpand(e.effectSlurOrigin,e,!1,!0)){t=!0;break}if(!t){const i=new u0(e.effectSlurOrigin,e,!1,!0);this._effectSlurs.push(i),this.addTie(i)}}}}}class Oo extends pt{constructor(e,t,i,a,n){super(e,t),this._isGrace=a,this._number=i,this._beat=n}paint(e,t,i){var n;const a=this._beat.isRest?Be.beat(i,qe.NumberedRests,this._beat):this._beat.notes.length>0?Be.note(i,Ci.NumberedNumber,this._beat.notes[0]):void 0;try{const r=this.renderer.resources;i.font=this._isGrace?r.numberedNotationGraceFont:r.numberedNotationFont,i.textBaseline=he.Middle,i.textAlign=Q.Left,i.fillText(this._number.toString(),e+this.x,t+this.y)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}doLayout(){const e=this._isGrace?Ye.GraceScale:1;this.width=Oo.NoteHeadWidth*e,this.height=Oo.NoteHeadHeight*e}}Oo.NoteHeadHeight=17;Oo.NoteHeadWidth=12;class Sh extends pt{constructor(e,t,i){super(e,t),this._beat=i}doLayout(){this.width=14+Sh.Padding,this.height=gi.BarSize}paint(e,t,i){var n;const a=Be.beat(i,qe.NumberedDuration,this._beat);try{const r=Sh.Padding;i.fillRect(e+this.x,t+this.y,this.width-r,this.height)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}Sh.Padding=3;class A2 extends or{constructor(){super(...arguments),this.isNaturalizeAccidental=!1,this.accidental=ne.None}get effectElement(){return qe.NumberedEffects}doLayout(){if(!this.container.beat.isRest&&!this.container.beat.isEmpty){const e=new Gg;if(e.renderer=this.renderer,this.container.beat.notes.length>0){const t=this.container.beat.notes[0],i=t?t.accidentalMode:ke.Default,a=ut.getNoteValue(t);let n=ut.computeAccidental(this.renderer.bar.keySignature,i,a,t.hasQuarterToneOffset);if(n===ne.Natural&&(n=this.renderer.bar.keySignature+7<7?ne.Sharp:ne.Flat,this.isNaturalizeAccidental=!0),n!==ne.None){this.accidental=n;const r=this.renderer,o=Be.noteColor(r.resources,Ci.NumberedAccidentals,t),l=new xa(0,r.getLineY(0),n,t.beat.graceType!==se.None?Ye.GraceScale*Ye.GraceScale:Ye.GraceScale);l.colorOverride=o,l.renderer=this.renderer,e.addGlyph(l),this.addNormal(e),this.addNormal(new oi(0,0,4))}}}super.doLayout()}}class Or extends lr{constructor(){super(...arguments),this.noteHeads=null,this.deadSlapped=null,this.octaveDots=0}get effectElement(){return qe.NumberedEffects}getNoteX(e,t){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let a=i.x;switch(t){case Ke.Left:break;case Ke.Center:a+=i.width/2;break;case Ke.Right:a+=i.width;break}return a}return 0}buildBoundingsLookup(e,t,i){if(this.noteHeads&&this.container.beat.notes.length>0){const a=new Hh;a.note=this.container.beat.notes[0],a.noteHeadBounds=new hi,a.noteHeadBounds.x=t+this.x+this.noteHeads.x,a.noteHeadBounds.y=i+this.y+this.noteHeads.y-this.noteHeads.height/2,a.noteHeadBounds.w=this.width,a.noteHeadBounds.h=this.height,e.addNote(a)}}getNoteY(e,t){let i=null;if(this.noteHeads?i=this.noteHeads:this.deadSlapped&&(i=this.deadSlapped),i){let a=this.y+i.y;switch(t){case $.Top:case $.TopWithStem:a-=i.height/2+2;break;case $.Center:break;case $.Bottom:case $.BottomWithStem:a+=i.height/2;break}return a}return 0}updateBeamingHelper(){if(this.beamingHelper){let e=null;this.noteHeads?e=this.noteHeads:this.deadSlapped&&(e=this.deadSlapped),e&&this.beamingHelper.registerBeatLineX("numbered",this.container.beat,this.container.x+this.x+e.x,this.container.x+this.x+e.x+e.width)}}doLayout(){const e=this.renderer;e.shortestDuration<this.container.beat.duration&&(e.shortestDuration=this.container.beat.duration);const t=e.getLineY(e.getNoteLine());if(!this.container.beat.isEmpty){let i="0";if(this.container.beat.notes.length>0){const r=this.renderer.bar.keySignatureType,o=this.renderer.bar.keySignature,l=o+7,c=(r===Mi.Minor?Or.MinorKeySignatureOneValues:Or.MajorKeySignatureOneValues)[l],d=this.container.beat.notes[0];if(d.isDead)i="X";else{const f=d.displayValue-c,p=f<0?(f%12+12)%12:f%12;let g=f<0?(Math.abs(f)+12)/12|0:f/12|0;f<0&&(g*=-1),this.octaveDots=g,e.registerOctave(g);let T=(V.keySignatureIsSharp(o)||V.keySignatureIsNatural(o)?ut.FlatNoteSteps:ut.SharpNoteSteps)[p]+1;ut.AccidentalNotes[p]&&!this.container.preNotes.isNaturalizeAccidental&&(l<7?T++:T--),i=T.toString()}}if(this.container.beat.deadSlapped){const r=new ld;r.renderer=this.renderer,r.doLayout(),this.deadSlapped=r,this.addEffect(r)}else{const r=this.container.beat.graceType!==se.None,o=new Oo(0,t,i,r,this.container.beat);this.noteHeads=o,this.addNormal(o)}if(this.container.beat.dots>0&&this.container.beat.duration>=w.Quarter){this.addNormal(new oi(0,0,5));for(let r=0;r<this.container.beat.dots;r++){const o=new yh(0,e.getLineY(0),1.5);o.renderer=this.renderer,this.addEffect(o)}}let a=0;switch(this.container.beat.duration){case w.QuadrupleWhole:a=16;break;case w.DoubleWhole:a=8;break;case w.Whole:a=4;break;case w.Half:a=2;break}let n=a;for(let r=0;r<this.container.beat.dots;r++)n=n/2|0,a+=n;for(let r=0;r<a-1;r++){const o=new Sh(0,e.getLineY(0),this.container.beat);o.renderer=this.renderer,this.addNormal(o)}}super.doLayout(),this.container.beat.isEmpty?this.centerX=this.width/2:this.noteHeads?this.centerX=this.noteHeads.x+this.noteHeads.width/2:this.deadSlapped&&(this.centerX=this.deadSlapped.x+this.deadSlapped.width/2)}}Or.MajorKeySignatureOneValues=[59,66,61,68,63,58,65,60,67,62,69,64,71,66,61];Or.MinorKeySignatureOneValues=[71,66,73,68,63,70,65,72,67,74,69,64,71,66,73];class F2 extends pt{constructor(e,t,i,a){super(e,t),this._text="",this._accidental=ne.None,this._accidentalOffset=0,this._keySignature=i,this._keySignatureType=a}doLayout(){super.doLayout();const e="1 = ";let t="",i=ne.None;switch(this._keySignatureType){case Mi.Major:switch(this._keySignature){case _e.Cb:t="  C",i=ne.Flat;break;case _e.Gb:t="  G",i=ne.Flat;break;case _e.Db:t="  D",i=ne.Flat;break;case _e.Ab:t="  A",i=ne.Flat;break;case _e.Eb:t="  E",i=ne.Flat;break;case _e.Bb:t="  B",i=ne.Flat;break;case _e.F:t="F";break;case _e.C:t="C",i=ne.None;break;case _e.G:t="G",i=ne.None;break;case _e.D:t="D",i=ne.None;break;case _e.A:t="A",i=ne.None;break;case _e.E:t="E",i=ne.None;break;case _e.B:t="B",i=ne.None;break;case _e.FSharp:t="  F",i=ne.Sharp;break;case _e.CSharp:t="  C",i=ne.Sharp;break}break;case Mi.Minor:switch(this._keySignature){case _e.Cb:t="  a",i=ne.Flat;break;case _e.Gb:t="  e",i=ne.Flat;break;case _e.Db:t="  b",i=ne.Flat;break;case _e.Ab:t="f",i=ne.None;break;case _e.Eb:t="c",i=ne.None;break;case _e.Bb:t="g",i=ne.None;break;case _e.F:t="d";break;case _e.C:t="a",i=ne.None;break;case _e.G:t="e",i=ne.None;break;case _e.D:t="b",i=ne.None;break;case _e.A:t="  f",i=ne.Sharp;break;case _e.E:t="  c",i=ne.Sharp;break;case _e.B:t="  g",i=ne.Sharp;break;case _e.FSharp:t="  d",i=ne.Sharp;break;case _e.CSharp:t="  a",i=ne.Sharp;break}break}this._text=e+t,this._accidental=i;const a=this.renderer.scoreRenderer.canvas,n=this.renderer.resources;a.font=n.numberedNotationFont,this._accidentalOffset=a.measureText(e).width,this.width=a.measureText(e+t).width}paint(e,t,i){var n;const a=Be.bar(i,Ee.NumberedKeySignature,this.renderer.bar);try{const r=this.renderer.resources;i.font=r.numberedNotationFont,i.textBaseline=he.Middle,i.fillText(this._text,e+this.x,t+this.y),this._accidental!==ne.None&&i.fillMusicFontSymbol(e+this.x+this._accidentalOffset,t+this.y,.7,xa.getMusicSymbol(this._accidental),!1)}finally{(n=a==null?void 0:a[Symbol.dispose])==null||n.call(a)}}}class gi extends _a{registerOctave(e){this.lowestOctave===null?(this.lowestOctave=e,this.highestOctave=e):(e<this.lowestOctave&&(this.lowestOctave=e),e>this.highestOctave&&(this.highestOctave=e))}get repeatsBarSubElement(){return Ee.NumberedRepeats}get barNumberBarSubElement(){return Ee.NumberedBarNumber}get barLineBarSubElement(){return Ee.NumberedBarLines}get staffLineBarSubElement(){return Ee.NumberedStaffLine}constructor(e,t){super(e,t),this.simpleWhammyOverflow=0,this.shortestDuration=w.QuadrupleWhole,this.lowestOctave=null,this.highestOctave=null,this._isOnlyNumbered=!t.staff.showSlash&&!t.staff.showTablature&&!t.staff.showStandardNotation}get lineSpacing(){return ot.RawLineSpacing}get heightLineCount(){return 5}get drawnLineCount(){return 0}get bottomGlyphOverflow(){return 0}paint(e,t,i){super.paint(e,t,i),this.paintBeams(e,t,i,qe.NumberedDuration,qe.NumberedDuration),this.paintTuplets(e,t,i,qe.NumberedTuplet,!0)}doLayout(){super.doLayout();let e=!1;for(const t of this.bar.voices)if(this.hasVoiceContainer(t)&&this.getVoiceContainer(t).tupletGroups.length>0){e=!0;break}if(e&&this.registerOverflowTop(this.tupletSize),!this.bar.isEmpty){const t=V.getIndex(this.shortestDuration)-2;if(t>0){const a=gi.BarSpacing,n=gi.BarSize,r=(t-1)*a+n;let o=0;const l=this.lowestOctave;l!==null&&(o=Math.abs(l)*gi.DotSpacing+gi.DotSize),this.registerOverflowBottom(r+o)}const i=this.highestOctave;if(i!==null){const a=Math.abs(i)*gi.DotSpacing+gi.DotSize;this.registerOverflowTop(a)}}}paintFlag(e,t,i,a,n){this.paintBar(e,t,i,a,n)}paintBar(e,t,i,a,n){var o;if(a.beats.length===0)return;const r=this.resources;for(let l=0,h=a.beats.length;l<h;l++){const c=a.beats[l],d=Be.beat(i,n,c);try{const f=gi.BarSpacing,p=gi.BarSize,g=V.getIndex(c.duration)-2,m=t+this.y,T=this.getBeatX(c,Te.PreNotes)-this.beatGlyphsStart,S=this.calculateBeamY(a,T);for(let _=0;_<g;_++){let A=0,J=0,G=0;const ee=m+_*f;l===a.beats.length-1?(A=T,J=this.getBeatX(c,Te.PostNotes)-this.beatGlyphsStart):(A=T,J=this.getBeatX(a.beats[l+1],Te.PreNotes)-this.beatGlyphsStart),G=ee+S|0,_a.paintSingleBar(i,e+this.x+A,G,e+this.x+J,G,p)}const y=this.getBeatContainer(c).onNotes;let b=y instanceof Or?y.octaveDots:0,B=0,N=0;b>0?(B=m+this.getLineY(0)-r.numberedNotationFont.size/1.5,N=gi.DotSpacing*-1):b<0&&(B=m+S+g*f,N=gi.DotSpacing);const L=this.getBeatX(c,Te.OnNotes)+4-this.beatGlyphsStart;b=Math.abs(b);for(let _=0;_<b;_++)i.fillCircle(e+this.x+L,B,gi.DotSize),B+=N}finally{(o=d==null?void 0:d[Symbol.dispose])==null||o.call(d)}}}getNoteLine(){return 0}get tupletOffset(){return super.tupletOffset+this.resources.numberedNotationFont.size}getFlagTopY(e,t){const i=He.Heights.get(u.NoteheadBlack);return this.getLineY(0)-i/2}getFlagBottomY(e,t){const i=He.Heights.get(u.NoteheadBlack);return this.getLineY(0)-i/2}getBeamDirection(e){return P.Down}getTupletBeamDirection(e){return P.Up}getNoteY(e,t){let i=super.getNoteY(e,t);return Number.isNaN(i)&&(i=this.getLineY(0)),i}calculateBeamYWithDirection(e,t,i){const a=this.resources.numberedNotationFont;return this.getLineY(0)+a.size}getBarLineStart(e,t){const i=He.Heights.get(u.NoteheadBlack);return this.getLineY(0)-i/2}createPreBeatGlyphs(){this.wasFirstOfLine=this.isFirstOfLine,(this.index===0||this.bar.masterBar.isRepeatStart&&this._isOnlyNumbered)&&this.addPreBeatGlyph(new kp(!1)),this.createLinePreBeatGlyphs(),this.addPreBeatGlyph(new Fk(0,this.getLineHeight(-.25),this.bar.index+1))}createLinePreBeatGlyphs(){(!this.bar.previousBar||this.bar.keySignature!==this.bar.previousBar.keySignature)&&(this.createStartSpacing(),this.createKeySignatureGlyphs()),this._isOnlyNumbered&&(!this.bar.previousBar||this.bar.previousBar&&this.bar.masterBar.timeSignatureNumerator!==this.bar.previousBar.masterBar.timeSignatureNumerator||this.bar.previousBar&&this.bar.masterBar.timeSignatureDenominator!==this.bar.previousBar.masterBar.timeSignatureDenominator||this.bar.previousBar&&this.bar.masterBar.isFreeTime&&this.bar.masterBar.isFreeTime!==this.bar.previousBar.masterBar.isFreeTime)&&(this.createStartSpacing(),this.createTimeSignatureGlyphs())}createKeySignatureGlyphs(){this.addPreBeatGlyph(new F2(0,this.getLineY(0),this.bar.keySignature,this.bar.keySignatureType))}createTimeSignatureGlyphs(){this.addPreBeatGlyph(new oi(0,0,5));const e=this.bar.masterBar,t=new Yg(0,this.getLineY(0),e.timeSignatureNumerator,e.timeSignatureDenominator,e.timeSignatureCommon,e.isFreeTime&&(e.previousMasterBar==null||e.isFreeTime!==e.previousMasterBar.isFreeTime));t.barSubElement=Ee.NumberedTimeSignature,this.addPreBeatGlyph(t)}createPostBeatGlyphs(){this._isOnlyNumbered&&super.createPostBeatGlyphs()}createVoiceGlyphs(e){for(const t of e.beats){const i=new L2(t,this.getVoiceContainer(e));i.preNotes=e.index===0?new A2:new or,i.onNotes=e.index===0?new Or:new lr,this.addBeatGlyph(i)}}paintBeamingStem(e,t,i,a,n,r){}}gi.StaffId="numbered";gi.BarSpacing=ot.BeamSpacing+ot.BeamThickness;gi.BarSize=2;gi.DotSpacing=5;gi.DotSize=2;class M2 extends Vh{get staffId(){return gi.StaffId}getStaffPaddingTop(e){return e.system.layout.renderer.settings.display.notationStaffPaddingTop}getStaffPaddingBottom(e){return e.system.layout.renderer.settings.display.notationStaffPaddingBottom}create(e,t){return new gi(e,t)}canCreate(e,t){return super.canCreate(e,t)&&t.showNumbered}}class R2 extends mt{get notationElement(){return be.EffectText}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SinglePreBeat}shouldCreateGlyph(e,t){const i=t.voice.bar.masterBar;return t.voice.bar.staff.index===0&&t.voice.index===0&&t.index===0&&i.isFreeTime&&(i.index===0||i.isFreeTime!==i.previousMasterBar.isFreeTime)}createNewGlyph(e,t){return new os(0,0,"Free time",e.resources.effectFont,Q.Left)}canExpand(e,t){return!0}}class Io extends cs{constructor(){super(0,0)}doLayout(){super.doLayout(),this.height=He.Heights.get(u.KeyboardPedalPed)}paint(e,t,i){const a=this.renderer,n=t+this.y,r=this.height,o=a.bar.sustainPedals,l=He.Widths.get(u.KeyboardPedalPed),h=He.Widths.get(u.KeyboardPedalUp);let c=0;for(;c<o.length;){let d=o[c];for(;d!=null;){const f=e+this.renderer.getRatioPositionX(d.ratioPosition);let p=0;if(d.pedalType===Et.Down?(i.fillMusicFontSymbol(f,n+r,1,u.KeyboardPedalPed,!0),p=l/2+Io.TextLinePadding):d.pedalType===Et.Up&&(i.fillMusicFontSymbol(f,n+r,1,u.KeyboardPedalUp,!0),p=h/2+Io.StarLinePadding),d.nextPedalMarker)if(d.nextPedalMarker.bar===d.bar){let g=e+this.renderer.getRatioPositionX(d.nextPedalMarker.ratioPosition);switch(d.nextPedalMarker.pedalType){case Et.Down:g-=l/2;break;case Et.Hold:break;case Et.Up:g-=h/2;break}const m=f+p;g>m&&i.fillRect(m,n+r-1,g-m,1)}else{const g=e+this.x+this.width,m=f+p;i.fillRect(m,n+r-1,g-m,1)}if(c===0&&d.previousPedalMarker){const g=e+this.x,m=f-p;i.fillRect(g,n+r-1,m-g,1)}c++,d.nextPedalMarker!=null&&d.nextPedalMarker.bar!==d.bar?(d=null,c=o.length):d=d.nextPedalMarker}}}}Io.TextLinePadding=3;Io.StarLinePadding=3;class O2 extends mt{get notationElement(){return be.EffectSustainPedal}get hideOnMultiTrack(){return!1}get canShareBand(){return!1}get sizingMode(){return Ne.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.sustainPedals.length>0}createNewGlyph(e,t){return new Io}canExpand(e,t){return!0}}class hc extends mt{constructor(e,t){super(),this._type=e,this._shouldCreate=t}get notationElement(){return be.EffectGolpe}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){const i=this._shouldCreate;return t.golpe===this._type&&(!i||i(e,t))}createNewGlyph(e,t){return new Lk(0,0,!0)}canExpand(e,t){return!1}}class Xg extends Mt{constructor(e){super(0,0,1,Xg.getSymbol(e)),this.center=!0}static getSymbol(e){switch(e){case ls.Open:return u.GuitarOpenPedal;case ls.Closed:return u.GuitarClosePedal}return u.None}paint(e,t,i){super.paint(e,t+this.height,i)}}class I2 extends mt{get notationElement(){return be.EffectWahPedal}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.wahPedal!==ls.None}createNewGlyph(e,t){return new Xg(t.wahPedal)}canExpand(e,t){return!1}}class wh extends mt{get notationElement(){return be.EffectLetRing}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.isBarre}get sizingMode(){return Ne.GroupedOnBeat}createNewGlyph(e,t){let i="";switch(t.barreShape){case ns.None:case ns.Full:break;case ns.Half:i+="1/2";break}return i+=`B ${wh.toRoman(t.barreFret)}`,new pa(i,!1)}static toRoman(e){let t="";if(e>0)for(const[i,a]of wh.RomanLetters){const n=Math.floor(e/a);e-=n*a,t+=i.repeat(n)}return t}canExpand(e,t){return e.barreFret===t.barreFret&&e.barreShape===t.barreShape}}wh.RomanLetters=new Map([["L",50],["XL",40],["X",10],["IX",9],["V",5],["IV",4],["I",1]]);class qg extends Mt{constructor(e){super(0,0,1,qg.getSymbol(e)),this.center=!0}static getSymbol(e){switch(e){case Tt.InvertedTurn:return u.OrnamentTurnInverted;case Tt.Turn:return u.OrnamentTurn;case Tt.UpperMordent:return u.OrnamentShortTrill;case Tt.LowerMordent:return u.OrnamentMordent}return u.None}paint(e,t,i){super.paint(e,t+this.height-4,i)}}class H2 extends mt{get notationElement(){return be.EffectNoteOrnament}get hideOnMultiTrack(){return!1}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.notes.some(i=>i.ornament!==Tt.None)}createNewGlyph(e,t){return new qg(t.notes.find(i=>i.ornament!==Tt.None).ornament)}canExpand(e,t){return!1}}class V2 extends mt{get notationElement(){return be.EffectRasgueado}get canShareBand(){return!1}get hideOnMultiTrack(){return!1}shouldCreateGlyph(e,t){return t.hasRasgueado}get sizingMode(){return Ne.GroupedOnBeat}createNewGlyph(e,t){return new pa("rasg.")}canExpand(e,t){return!0}}class cc extends pt{constructor(e){super(0,0),this._symbols=e}doLayout(){this.height=27}paint(e,t,i){i.fillMusicFontSymbols(e+this.x,t+this.y+this.height,.8,this._symbols,!0)}}class Ki extends pt{constructor(e){super(0,0),this._text=e}doLayout(){this.height=this.renderer.resources.directionsFont.size*1.5}paint(e,t,i){const a=i.font,n=i.textBaseline,r=i.textAlign;i.font=this.renderer.resources.directionsFont,i.textBaseline=he.Middle,i.textAlign=Q.Right,i.fillText(this._text,e+this.x,t+this.y+this.height/2),i.font=a,i.textBaseline=n,i.textAlign=r}}class W2 extends cs{constructor(e,t,i){super(e,t),this._barBeginGlyphs=[],this._barEndGlyphs=[],this._directions=i}doLayout(){const e=this._directions;e.has(R.TargetSegnoSegno)&&this._barBeginGlyphs.push(new cc([u.Segno,u.Segno])),e.has(R.TargetSegno)&&this._barBeginGlyphs.push(new cc([u.Segno])),e.has(R.TargetDoubleCoda)&&this._barBeginGlyphs.push(new cc([u.Coda,u.Coda])),e.has(R.TargetCoda)&&this._barBeginGlyphs.push(new cc([u.Coda])),e.has(R.TargetFine)&&this._barEndGlyphs.push(new Ki("Fine")),e.has(R.JumpDaDoubleCoda)&&this._barEndGlyphs.push(new Ki("To Double Coda")),e.has(R.JumpDaCoda)&&this._barEndGlyphs.push(new Ki("To Coda")),e.has(R.JumpDalSegnoSegno)&&this._barEndGlyphs.push(new Ki("D.S.S.")),e.has(R.JumpDalSegnoSegnoAlCoda)&&this._barEndGlyphs.push(new Ki("D.S.S. al Coda")),e.has(R.JumpDalSegnoSegnoAlDoubleCoda)&&this._barEndGlyphs.push(new Ki("D.S.S. al Double Coda")),e.has(R.JumpDalSegnoSegnoAlFine)&&this._barEndGlyphs.push(new Ki("D.S.S. al Fine")),e.has(R.JumpDalSegno)&&this._barEndGlyphs.push(new Ki("D.S.")),e.has(R.JumpDalSegnoAlCoda)&&this._barEndGlyphs.push(new Ki("D.S. al Coda")),e.has(R.JumpDalSegnoAlDoubleCoda)&&this._barEndGlyphs.push(new Ki("D.S. al Double Coda")),e.has(R.JumpDalSegnoAlFine)&&this._barEndGlyphs.push(new Ki("D.S. al Fine")),e.has(R.JumpDaCapo)&&this._barEndGlyphs.push(new Ki("D.C.")),e.has(R.JumpDaCapoAlCoda)&&this._barEndGlyphs.push(new Ki("D.C. al Coda")),e.has(R.JumpDaCapoAlDoubleCoda)&&this._barEndGlyphs.push(new Ki("D.C. al Double Coda")),e.has(R.JumpDaCapoAlFine)&&this._barEndGlyphs.push(new Ki("D.C. al Fine"));const t=this.doSideLayout(this._barBeginGlyphs),i=this.doSideLayout(this._barEndGlyphs);this.height=Math.max(t,i)}doSideLayout(e){let t=0;const i=3;for(const a of e)a.y=t,a.renderer=this.renderer,a.doLayout(),t+=a.height+i;return t}paint(e,t,i){for(const a of this._barBeginGlyphs)a.paint(e+this.x,t+this.y,i);for(const a of this._barEndGlyphs)a.paint(e+this.x+this.width,t+this.y,i)}}class z2 extends mt{get notationElement(){return be.EffectDirections}get hideOnMultiTrack(){return!0}get canShareBand(){return!1}get sizingMode(){return Ne.FullBar}shouldCreateGlyph(e,t){return t.voice.index===0&&t.index===0&&t.voice.bar.masterBar.directions!==null&&t.voice.bar.masterBar.directions.size>0}createNewGlyph(e,t){return new W2(0,0,t.voice.bar.masterBar.directions)}canExpand(e,t){return!0}}class en extends cs{constructor(e){super(0,0),this._text="",this._textWidth=0,this._textHeight=0,this._timer=e}doLayout(){const e=this._timer/6e4|0,t=(this._timer-e*6e4)/1e3|0;this._text=`${e}:${t.toString().padStart(2,"0")}`;const i=this.renderer.scoreRenderer.canvas;i.font=this.renderer.resources.timerFont;const a=i.measureText(this._text);this._textHeight=i.font.size+en.PaddingY*2,this._textWidth=a.width+en.PaddingX*2,this.height=this._textHeight+en.MarginY*2}paint(e,t,i){const a=this._textWidth/2|0;i.strokeRect(e+this.x-a,t+this.y+en.MarginY,this._textWidth,this._textHeight);const n=i.font,r=i.textBaseline,o=i.textAlign;i.font=this.renderer.resources.timerFont,i.textBaseline=he.Middle,i.textAlign=Q.Center,i.fillText(this._text,e+this.x,t+this.y+this.height/2),i.font=n,i.textBaseline=r,i.textAlign=o}}en.PaddingX=2;en.PaddingY=2;en.MarginY=2;class G2 extends mt{get notationElement(){return be.EffectBeatTimer}get hideOnMultiTrack(){return!0}get canShareBand(){return!0}get sizingMode(){return Ne.SingleOnBeat}shouldCreateGlyph(e,t){return t.showTimer}createNewGlyph(e,t){return new en(t.timer??0)}canExpand(e,t){return!0}}class va{static print(e){e(`alphaTab ${va.version}`),e(`commit: ${va.commit}`),e(`build date: ${va.date}`)}}va.version="1.6.3";va.date="2025-08-30T14:34:56.310Z";va.commit="bf30fbbbf85e7c31fe99ed4c5a8f71814bb007e3";class d0{constructor(e,t){this.vertical=e,this.createLayout=t}}class lf{constructor(e,t){this.supportsWorkers=e,this.createCanvas=t}}class C{static get globalThis(){if(C._globalThis===void 0){try{C._globalThis=globalThis}catch{}typeof C._globalThis>"u"&&(C._globalThis=self),typeof C._globalThis>"u"&&(C._globalThis=global),typeof C._globalThis>"u"&&(C._globalThis=window),typeof C._globalThis>"u"&&(C._globalThis=Function("return this")())}return C._globalThis}static get isRunningInWorker(){return"WorkerGlobalScope"in C.globalThis}static get isRunningInAudioWorklet(){return"AudioWorkletGlobalScope"in C.globalThis}static throttle(e,t){let i=0;return()=>{C.globalThis.clearTimeout(i),i=C.globalThis.setTimeout(e,t)}}static detectScriptFile(){if(!C.isRunningInWorker&&C.globalThis.ALPHATAB_ROOT){let e=C.globalThis.ALPHATAB_ROOT;return e=C.ensureFullUrl(e),e=C.appendScriptName(e),e}try{const e=import.meta.url;if(e&&e.indexOf("file://")===-1)return e}catch{}return"document"in C.globalThis&&document.currentScript&&document.currentScript instanceof HTMLScriptElement?document.currentScript.src:null}static ensureFullUrl(e){var t,i,a;if(!e)return"";if(!e.startsWith("http")&&!e.startsWith("https")&&!e.startsWith("file")){let n="";const r=C.globalThis.location;if(n+=(t=r.protocol)==null?void 0:t.toString(),n+="//",r.hostname&&(n+=(i=r.hostname)==null?void 0:i.toString()),r.port&&(n+=":",n+=(a=r.port)==null?void 0:a.toString()),!e.startsWith("/")){const o=r.pathname.split("/").slice(0,-1).join("/");o.length>0&&(o.startsWith("/")||(n+="/"),n+=o==null?void 0:o.toString())}return e.startsWith("/")||(n+="/"),n+=e==null?void 0:e.toString(),n}return e}static appendScriptName(e){return e&&!e.endsWith(".js")&&(e.endsWith("/")||(e+="/"),e+="alphaTab.js"),e}static detectFontDirectory(){if(!C.isRunningInWorker&&C.globalThis.ALPHATAB_FONT)return C.ensureFullUrl(C.globalThis.ALPHATAB_FONT);const e=C.scriptFile;if(e){const t=e.lastIndexOf("/");if(t>=0)return`${e.substr(0,t)}/font/`}return null}static registerJQueryPlugin(){if(!C.isRunningInWorker&&C.globalThis&&"jQuery"in C.globalThis){const e=C.globalThis.jQuery,t=new zy;e.fn.alphaTab=function(i){const a=Array.prototype.slice.call(arguments,1);return this.length===1?t.exec(this[0],i,a):this.each((n,r)=>{t.exec(r,i,a)})},e.alphaTab={restore:zy.restore},e.fn.alphaTab.fn=t}}static getRenderEngineFactory(e){return!e||!C.renderEngines.has(e)?C.renderEngines.get("default"):C.renderEngines.get(e)}static getLayoutEngineFactory(e){return!e||!C.layoutEngines.has(e)?C.layoutEngines.get(nn.Page):C.layoutEngines.get(e)}static buildImporters(){return[new ma,new Wx,new Hx,new Ge,new _2,new di]}static createDefaultRenderEngines(){const e=new Map;return e.set("svg",new lf(!0,()=>new Kv)),e.set("default",e.get("svg")),e.set("skia",new lf(!1,()=>new Nt)),C.createPlatformSpecificRenderEngines(e),e}static enableAlphaSkia(e,t){Nt.enable(e,t)}static registerAlphaSkiaCustomFont(e){return Nt.registerFont(e)}static createPlatformSpecificRenderEngines(e){e.set("html5",new lf(!1,()=>new Nv))}static createDefaultRenderers(){return[new cr(C.StaffIdBeforeSlashAlways,[new MC,new IC,new CC,new z2,new mC,new R2,new RC,new G2,new bC]),new P2,new cr(C.StaffIdBeforeScoreAlways,[new BC,new wh,new H2,new V2,new I2]),new cr(C.StaffIdBeforeScoreHideable,[new HC,new Jy,new Yy(!0),new Ky,new Xy,new $y,new qy(!1),new n0,new hc(Ji.Finger)],(e,t)=>t.showStandardNotation),new o2,new cr(C.StaffIdBeforeNumberedAlways,[new wC,new Yy(!1),new kC,new hc(Ji.Thumb,(e,t)=>t.voice.bar.staff.showStandardNotation),new O2]),new M2,new cr(C.StaffIdBeforeTabAlways,[new vC]),new cr(C.StaffIdBeforeTabHideable,[new Jy,new Ky,new Xy,new $y,new qy(!0),new AC,new TC,new _n(ae.Natural),new _n(ae.Artificial),new _n(ae.Pinch),new _n(ae.Tap),new _n(ae.Semi),new _n(ae.Feedback),new NC,new yC,new _C,new DC,new LC,new PC,new n0,new hc(Ji.Finger,(e,t)=>!t.voice.bar.staff.showStandardNotation)],(e,t)=>t.showTablature),new af,new cr(C.StaffIdBeforeEndAlways,[new hc(Ji.Thumb,(e,t)=>!t.voice.bar.staff.showStandardNotation)])]}static createDefaultStaveProfiles(){const e=new Map,t=C.createDefaultRenderers();e.set(Ua.Default,t),e.set(Ua.ScoreTab,t);const i=new Set([C.StaffIdBeforeSlashAlways,C.StaffIdBeforeScoreAlways,C.StaffIdBeforeNumberedAlways,C.StaffIdBeforeTabAlways,ca.StaffId,C.StaffIdBeforeEndAlways]);e.set(Ua.Score,t.filter(n=>i.has(n.staffId)));const a=new Set([C.StaffIdBeforeSlashAlways,C.StaffIdBeforeScoreAlways,C.StaffIdBeforeNumberedAlways,C.StaffIdBeforeTabAlways,Rr.StaffId,C.StaffIdBeforeEndAlways]);return e.set(Ua.Tab,C.createDefaultRenderers().filter(n=>{if(n instanceof af){const r=n;r.showTimeSignature=!0,r.showRests=!0,r.showTiedNotes=!0}return a.has(n.staffId)})),e.set(Ua.TabMixed,C.createDefaultRenderers().filter(n=>{if(n instanceof af){const r=n;r.showTimeSignature=!1,r.showRests=!1,r.showTiedNotes=!1}return a.has(n.staffId)})),e}static createDefaultLayoutEngines(){const e=new Map;return e.set(nn.Page,new d0(!0,t=>new WC(t))),e.set(nn.Horizontal,new d0(!1,t=>new VC(t))),e}static initializeMain(e,t){C.isRunningInWorker||C.isRunningInAudioWorklet||((C.webPlatform===Yi.Browser||C.webPlatform===Yi.BrowserModule)&&(C.registerJQueryPlugin(),C.HighDpiFactor=window.devicePixelRatio),C.createWebWorker=e,C.createAudioWorklet=t)}static get alphaTabWorker(){return C.globalThis.Worker}static get alphaTabUrl(){return C.globalThis.URL}static initializeWorker(){if(!C.isRunningInWorker)throw new We(Ve.General,"Not running in worker, cannot run worker initialization");Rg.init(),Mg.init(),C.createWebWorker=e=>{throw new We(Ve.General,"Nested workers are not supported")}}static initializeAudioWorklet(){if(!C.isRunningInAudioWorklet)throw new We(Ve.General,"Not running in audio worklet, cannot run worklet initialization");ph.init()}static detectWebPack(){try{if(typeof __webpack_require__=="function")return!0}catch{}return!1}static detectVite(){try{if(typeof __BASE__=="string")return!0}catch{}return!1}static detectWebPlatform(){if(!(typeof C.globalThis.Window<"u"&&C.globalThis instanceof C.globalThis.Window))try{if(Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]")return Yi.NodeJs}catch{}try{const t=import.meta.url;if(t&&typeof t=="string"&&!t.startsWith("file://"))return Yi.BrowserModule}catch{}return Yi.Browser}static printEnvironmentInfo(e=!0){const t=e?i=>{E.log.debug("VersionInfo",i)}:i=>{E.debug("VersionInfo",i)};va.print(t),t(`High DPI: ${C.HighDpiFactor}`),C.printPlatformInfo(t)}static printPlatformInfo(e){e(`Browser: ${navigator.userAgent}`),e(`Platform: ${Yi[C.webPlatform]}`),e(`WebPack: ${C.isWebPackBundled}`),e(`Vite: ${C.isViteBundled}`),C.webPlatform!==Yi.NodeJs&&(e(`Window Size: ${window.outerWidth}x${window.outerHeight}`),e(`Screen Size: ${window.screen.width}x${window.screen.height}`))}static prepareForPostMessage(e){if(!e)return e;if(typeof e=="object"){const t=e.__v_raw;if(t)return C.prepareForPostMessage(t)}return e}}C.StaffIdBeforeSlashAlways="before-slash-always";C.StaffIdBeforeScoreAlways="before-score-always";C.StaffIdBeforeScoreHideable="before-score-hideable";C.StaffIdBeforeNumberedAlways="before-numbered-always";C.StaffIdBeforeTabAlways="before-tab-always";C.StaffIdBeforeTabHideable="before-tab-hideable";C.StaffIdBeforeEndAlways="before-end-always";C.MusicFontSize=34;C.HighDpiFactor=1;C._globalThis=void 0;C.webPlatform=C.detectWebPlatform();C.isWebPackBundled=C.detectWebPack();C.isViteBundled=C.detectVite();C.scriptFile=C.detectScriptFile();C.fontDirectory=C.detectFontDirectory();C.renderEngines=C.createDefaultRenderEngines();C.layoutEngines=C.createDefaultLayoutEngines();C.staveProfiles=C.createDefaultStaveProfiles();var Js;(function(s){s[s.EmbeddedOpenType=0]="EmbeddedOpenType",s[s.Woff=1]="Woff",s[s.Woff2=2]="Woff2",s[s.OpenType=3]="OpenType",s[s.TrueType=4]="TrueType",s[s.Svg=5]="Svg"})(Js||(Js={}));class Jg{static buildDefaultSmuflFontSources(e){const t=new Map,i=e??"";return t.set(Js.Woff2,`${i}Bravura.woff2`),t.set(Js.Woff,`${i}Bravura.woff`),t.set(Js.OpenType,`${i}Bravura.otf`),t}constructor(){this.scriptFile=null,this.fontDirectory=null,this.smuflFontSources=null,this.file=null,this.tex=!1,this.tracks=null,this.enableLazyLoading=!0,this.engine="default",this.logLevel=na.Info,this.useWorkers=!0,this.includeNoteBounds=!1,this.scriptFile=C.scriptFile,this.fontDirectory=C.fontDirectory}}var F;(function(s){s[s.SteelGuitar=1]="SteelGuitar",s[s.AcousticGuitar=2]="AcousticGuitar",s[s.TwelveStringGuitar=3]="TwelveStringGuitar",s[s.ElectricGuitar=4]="ElectricGuitar",s[s.Bass=5]="Bass",s[s.ClassicalGuitar=23]="ClassicalGuitar",s[s.UprightBass=6]="UprightBass",s[s.Ukulele=7]="Ukulele",s[s.Banjo=8]="Banjo",s[s.Mandolin=9]="Mandolin",s[s.Piano=10]="Piano",s[s.Synth=12]="Synth",s[s.Strings=11]="Strings",s[s.Brass=13]="Brass",s[s.Reed=14]="Reed",s[s.Woodwind=15]="Woodwind",s[s.Vocal=16]="Vocal",s[s.PitchedIdiophone=17]="PitchedIdiophone",s[s.Fx=21]="Fx",s[s.PercussionKit=18]="PercussionKit",s[s.Idiophone=19]="Idiophone",s[s.Membraphone=20]="Membraphone"})(F||(F={}));class O{constructor(e,t,i=null){if(this.icon=F.Piano,this.icon=e,this.instrumentSetName=t,i)this.instrumentSetType=i;else{const a=t.split(" ");a[0]=a[0].substr(0,1).toLowerCase()+a[0].substr(1),this.instrumentSetType=a.join("")}}}class es{constructor(){this._rhythmIdLookup=new Map}writeXml(e){const t=new oh;return this._rhythmIdLookup=new Map,this.writeDom(t,e),t.toFormattedString("",!0)}writeDom(e,t){const i=e.addElement("GPIF");i.addElement("GPVersion").innerText="8.1.3";const a=i.addElement("GPRevision");a.attributes.set("required","12024"),a.attributes.set("recommended","13000"),a.innerText="13007";const n=i.addElement("Encoding");n.addElement("EncodingDescription").innerText="GP8";const r=new Ls;r.nodeType=st.Comment,r.value=`Written by alphaTab ${va.version} (${va.commit})`,n.addChild(r),this.writeScoreNode(i,t),this.writeMasterTrackNode(i,t),this.writeBackingTrackNode(i,t),this.writeAudioTracksNode(i,t),this.writeTracksNode(i,t),this.writeMasterBarsNode(i,t),this.writeAssets(i,t);const o=i.addElement("Bars"),l=i.addElement("Voices"),h=i.addElement("Beats"),c=i.addElement("Notes"),d=i.addElement("Rhythms");for(const f of t.tracks)for(const p of f.staves)for(const g of p.bars){this.writeBarNode(o,g);for(const m of g.voices){this.writeVoiceNode(l,m);for(const T of m.beats){this.writeBeatNode(h,T,d);for(const S of T.notes)this.writeNoteNode(c,S)}}}}writeAssets(e,t){var n;if(!((n=t.backingTrack)!=null&&n.rawAudioFile))return;const a=e.addElement("Assets").addElement("Asset");a.attributes.set("id",this.backingTrackAssetId),this.backingTrackAssetFileName="Content/Assets/backing-track",a.addElement("EmbeddedFilePath").setCData(this.backingTrackAssetFileName)}writeBackingTrackNode(e,t){var o;if(!((o=t.backingTrack)!=null&&o.rawAudioFile))return;const i=e.addElement("BackingTrack"),a="0";this.backingTrackAssetId=a,i.addElement("IconId").innerText="21",i.addElement("Color").innerText="0 0 0",i.addElement("Name").setCData("Audio Track"),i.addElement("ShortName").setCData("a.track"),i.addElement("PlaybackState").innerText="Default",i.addElement("Enabled").innerText="true",i.addElement("Source").innerText="Local",i.addElement("AssetId").innerText=a;const n=i.addElement("ChannelStrip");n.addElement("Parameters").innerText="0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.500000 0.000000 0.500000 0.500000 0.800000 0.500000 0.500000 0.500000",n.addElement("YouTubeVideoUrl").innerText="",n.addElement("Filter").innerText="6",n.addElement("FramesPerPixel").innerText="400";const r=this.backingTrackFramePadding!==void 0?this.backingTrackFramePadding:0;i.addElement("FramePadding").innerText=`${r}`,i.addElement("Semitones").innerText="0",i.addElement("Cents").innerText="0"}writeNoteNode(e,t){const i=e.addElement("Note");i.attributes.set("id",t.id.toString()),this.writeNoteProperties(i,t),t.isGhost&&(i.addElement("AntiAccent").innerText="normal"),t.isLetRing&&i.addElement("LetRing"),t.isTrill&&(i.addElement("Trill").innerText=t.trillValue.toString());let a=0;switch(t.isStaccato&&(a|=1),t.accentuated){case _t.Normal:a|=8;break;case _t.Heavy:a|=4;break;case _t.Tenuto:a|=16;break}if(a>0&&(i.addElement("Accent").innerText=a.toString()),t.isTieOrigin||t.isTieDestination){const n=i.addElement("Tie");n.attributes.set("origin",t.isTieOrigin?"true":"false"),n.attributes.set("destination",t.isTieDestination?"true":"false")}switch(t.vibrato){case ve.Slight:i.addElement("Vibrato").innerText="Slight";break;case ve.Wide:i.addElement("Vibrato").innerText="Wide";break}if(t.isFingering){switch(t.leftHandFinger){case ie.Thumb:i.addElement("LeftFingering").innerText="P";break;case ie.IndexFinger:i.addElement("LeftFingering").innerText="I";break;case ie.MiddleFinger:i.addElement("LeftFingering").innerText="M";break;case ie.AnnularFinger:i.addElement("LeftFingering").innerText="A";break;case ie.LittleFinger:i.addElement("LeftFingering").innerText="C";break}switch(t.rightHandFinger){case ie.Thumb:i.addElement("RightFingering").innerText="P";break;case ie.IndexFinger:i.addElement("RightFingering").innerText="I";break;case ie.MiddleFinger:i.addElement("RightFingering").innerText="M";break;case ie.AnnularFinger:i.addElement("RightFingering").innerText="A";break;case ie.LittleFinger:i.addElement("RightFingering").innerText="C";break}}t.percussionArticulation>=0?i.addElement("InstrumentArticulation").innerText=t.percussionArticulation.toString():i.addElement("InstrumentArticulation").innerText="0",t.ornament!==Tt.None&&(i.addElement("Ornament").innerText=Tt[t.ornament])}writeNoteProperties(e,t){const i=e.addElement("Properties");if(this.writeConcertPitch(i,t),this.writeTransposedPitch(i,t),t.isStringed&&(this.writeSimplePropertyNode(i,"String","String",(t.string-1).toString()),this.writeSimplePropertyNode(i,"Fret","Fret",t.fret.toString()),this.writeSimplePropertyNode(i,"Midi","Number",t.realValue.toString()),t.showStringNumber&&this.writeSimplePropertyNode(i,"ShowStringNumber","Enable",null)),t.isPiano&&(this.writeSimplePropertyNode(i,"Octave","Number",t.octave.toString()),this.writeSimplePropertyNode(i,"Tone","Step",t.tone.toString()),this.writeSimplePropertyNode(i,"Midi","Number",t.realValue.toString())),t.beat.tap&&this.writeSimplePropertyNode(i,"Tapped","Enable",null),t.harmonicType!==ae.None){switch(t.harmonicType){case ae.Natural:this.writeSimplePropertyNode(i,"HarmonicType","HType","Natural");break;case ae.Artificial:this.writeSimplePropertyNode(i,"HarmonicType","HType","Artificial");break;case ae.Pinch:this.writeSimplePropertyNode(i,"HarmonicType","HType","Pinch");break;case ae.Tap:this.writeSimplePropertyNode(i,"HarmonicType","HType","Tap");break;case ae.Semi:this.writeSimplePropertyNode(i,"HarmonicType","HType","Semi");break;case ae.Feedback:this.writeSimplePropertyNode(i,"HarmonicType","HType","Feedback");break}t.harmonicValue!==0&&this.writeSimplePropertyNode(i,"HarmonicFret","HFret",t.harmonicValue.toString())}t.isDead&&this.writeSimplePropertyNode(i,"Muted","Enable",null),t.isPalmMute&&this.writeSimplePropertyNode(i,"PalmMuted","Enable",null),t.hasBend&&this.writeBend(i,t),t.isHammerPullOrigin&&this.writeSimplePropertyNode(i,"HopoOrigin","Enable",null),t.isHammerPullDestination&&this.writeSimplePropertyNode(i,"HopoDestination","Enable",null),t.isLeftHandTapped&&this.writeSimplePropertyNode(i,"LeftHandTapped","Enable",null);let a=0;switch(t.slideInType){case jt.IntoFromAbove:a|=32;break;case jt.IntoFromBelow:a|=16;break}switch(t.slideOutType){case pe.Shift:a|=1;break;case pe.Legato:a|=2;break;case pe.OutDown:a|=4;break;case pe.OutUp:a|=8;break;case pe.PickSlideDown:a|=64;break;case pe.PickSlideUp:a|=128;break}a>0&&this.writeSimplePropertyNode(i,"Slide","Flags",a.toString())}writeTransposedPitch(e,t){t.isPercussion?this.writePitch(e,"ConcertPitch","C","-1",""):this.writePitchForValue(e,"TransposedPitch",t.displayValueWithoutBend,t.accidentalMode)}writeConcertPitch(e,t){t.isPercussion?this.writePitch(e,"ConcertPitch","C","-1",""):this.writePitchForValue(e,"ConcertPitch",t.realValueWithoutHarmonic,t.accidentalMode)}writePitchForValue(e,t,i,a){let n=0,r=0,o="",l="";const h=()=>{n=i%12,r=i/12|0,o=M.defaultSteps[n],l=M.defaultAccidentals[n]};switch(h(),a){case ke.Default:break;case ke.ForceNone:l="";break;case ke.ForceNatural:l="";break;case ke.ForceSharp:l="#";break;case ke.ForceDoubleSharp:l==="#"&&(i-=2,h()),l="x";break;case ke.ForceFlat:l==="#"&&(i+=1,h()),l="b";break;case ke.ForceDoubleFlat:l==="#"&&(i+=2,h()),l="bb";break}this.writePitch(e,t,o,r.toString(),l)}writePitch(e,t,i,a,n){const r=e.addElement("Property");r.attributes.set("name",t);const o=r.addElement("Pitch");o.addElement("Step").innerText=i,o.addElement("Accidental").innerText=n,o.addElement("Octave").innerText=a}writeBend(e,t){t.hasBend&&t.bendPoints.length<=4&&this.writeStandardBend(e,t.bendPoints)}writeStandardBend(e,t){this.writeSimplePropertyNode(e,"Bended","Enable",null);const i=t[0],a=t[t.length-1];let n,r;switch(t.length){case 4:n=t[1],r=t[2];break;case 3:n=t[1],r=t[1];break;default:n=new H((i.offset+a.offset)/2,(i.value+a.value)/2),r=n;break}this.writeSimplePropertyNode(e,"BendDestinationOffset","Float",this.toBendOffset(a.offset).toString()),this.writeSimplePropertyNode(e,"BendDestinationValue","Float",this.toBendValue(a.value).toString()),this.writeSimplePropertyNode(e,"BendMiddleOffset1","Float",this.toBendOffset(n.offset).toString()),this.writeSimplePropertyNode(e,"BendMiddleOffset2","Float",this.toBendOffset(r.offset).toString()),this.writeSimplePropertyNode(e,"BendMiddleValue","Float",this.toBendValue(n.value).toString()),this.writeSimplePropertyNode(e,"BendOriginOffset","Float",this.toBendOffset(i.offset).toString()),this.writeSimplePropertyNode(e,"BendOriginValue","Float",this.toBendValue(i.value).toString())}toBendValue(e){return e*25}toBendOffset(e){return e/H.MaxPosition*100}writeBeatNode(e,t,i){const a=e.addElement("Beat");if(a.attributes.set("id",t.id.toString()),a.addElement("Dynamic").innerText=j[t.dynamics],t.fade!==qt.None&&(a.addElement("Fadding").innerText=qt[t.fade]),t.isTremolo)switch(t.tremoloSpeed){case w.Eighth:a.addElement("Tremolo").innerText="1/2";break;case w.Sixteenth:a.addElement("Tremolo").innerText="1/4";break;case w.ThirtySecond:a.addElement("Tremolo").innerText="1/8";break}switch(t.hasChord&&a.addElement("Chord").setCData(t.chordId),t.crescendo!==vi.None&&(a.addElement("Hairpin").innerText=vi[t.crescendo]),t.brushType){case Y.ArpeggioUp:a.addElement("Arpeggio").innerText="Up";break;case Y.ArpeggioDown:a.addElement("Arpeggio").innerText="Down";break}switch(t.text&&a.addElement("FreeText").setCData(t.text),t.graceType){case se.OnBeat:case se.BeforeBeat:a.addElement("GraceNotes").innerText=se[t.graceType];break}if(t.ottava!==fe.Regular&&(a.addElement("Ottavia").innerText=fe[t.ottava].substr(1)),t.hasWhammyBar&&this.writeWhammyNode(a,t),t.isLegatoOrigin||t.isLegatoDestination){const n=a.addElement("Legato");n.attributes.set("origin",t.isLegatoOrigin?"true":"false"),n.attributes.set("destination",t.isLegatoDestination?"true":"false")}if(this.writeRhythm(a,t,i),t.preferredBeamDirection!==null)switch(t.preferredBeamDirection){case P.Up:a.addElement("TransposedPitchStemOrientation").innerText="Upward",a.addElement("UserTransposedPitchStemOrientation").innerText="Upward";break;case P.Down:a.addElement("TransposedPitchStemOrientation").innerText="Downward",a.addElement("UserTransposedPitchStemOrientation").innerText="Downward";break}a.addElement("ConcertPitchStemOrientation").innerText="Undefined",t.slashed&&a.addElement("Slashed"),t.deadSlapped&&a.addElement("DeadSlapped"),t.notes.length>0&&(a.addElement("Notes").innerText=t.notes.map(n=>n.id).join(" ")),t.golpe!==Ji.None&&(a.addElement("Golpe").innerText=Ji[t.golpe]),t.wahPedal!==ls.None&&(a.addElement("Wah").innerText=ls[t.wahPedal]),t.showTimer&&(a.addElement("Timer").innerText=(t.timer??0).toString()),this.writeBeatProperties(a,t),this.writeBeatXProperties(a,t),t.lyrics&&t.lyrics.length>0&&this.writeBeatLyrics(a,t.lyrics)}writeBeatLyrics(e,t){const i=e.addElement("Lyrics");for(const a of t)i.addElement("Line").setCData(a)}writeBeatXProperties(e,t){const i=e.addElement("XProperties");switch(t.brushDuration>0&&this.writeSimpleXPropertyNode(i,"687935489","Int",t.brushDuration.toString()),t.beamingMode){case it.ForceSplitToNext:this.writeSimpleXPropertyNode(i,"1124204546","Int","2");break;case it.ForceMergeWithNext:this.writeSimpleXPropertyNode(i,"1124204546","Int","1");break;case it.ForceSplitOnSecondaryToNext:this.writeSimpleXPropertyNode(i,"1124204552","Int","1");break}}writeBeatProperties(e,t){const i=e.addElement("Properties");switch(t.brushType){case Y.BrushUp:this.writeSimplePropertyNode(i,"Brush","Direction","Up");break;case Y.BrushDown:this.writeSimplePropertyNode(i,"Brush","Direction","Down");break}switch(t.pickStroke){case ni.Up:this.writeSimplePropertyNode(i,"PickStroke","Direction","Up");break;case ni.Down:this.writeSimplePropertyNode(i,"PickStroke","Direction","Down");break}switch(t.slap&&this.writeSimplePropertyNode(i,"Slapped","Enable",null),t.pop&&this.writeSimplePropertyNode(i,"Popped","Enable",null),t.vibrato){case ve.Wide:this.writeSimplePropertyNode(i,"VibratoWTremBar","Strength","Wide");break;case ve.Slight:this.writeSimplePropertyNode(i,"VibratoWTremBar","Strength","Slight");break}if(t.isBarre)switch(this.writeSimplePropertyNode(i,"BarreFret","Fret",t.barreFret.toString()),t.barreShape){case ns.Full:this.writeSimplePropertyNode(i,"BarreString","String","0");break;case ns.Half:this.writeSimplePropertyNode(i,"BarreString","String","1");break}if(t.rasgueado!==X.None){let a="";switch(t.rasgueado){case X.Ii:a="ii_1";break;case X.Mi:a="mi_1";break;case X.MiiTriplet:a="mii_1";break;case X.MiiAnapaest:a="mii_2";break;case X.PmpTriplet:a="pmp_1";break;case X.PmpAnapaest:a="pmp_2";break;case X.PeiTriplet:a="pei_1";break;case X.PeiAnapaest:a="pei_2";break;case X.PaiTriplet:a="pai_1";break;case X.PaiAnapaest:a="pai_2";break;case X.AmiTriplet:a="ami_1";break;case X.AmiAnapaest:a="ami_2";break;case X.Ppp:a="ppp_1";break;case X.Amii:a="amii_1";break;case X.Amip:a="amip_1";break;case X.Eami:a="eami_1";break;case X.Eamii:a="eamii_1";break;case X.Peami:a="peami_1";break}this.writeSimplePropertyNode(i,"Rasgueado","Rasgueado",a)}}writeRhythm(e,t,i){const a=`${t.duration}_${t.dots}_${t.tupletNumerator}_${t.tupletDenominator}';`;let n;if(this._rhythmIdLookup.has(a))n=this._rhythmIdLookup.get(a);else{n=this._rhythmIdLookup.size.toString(),this._rhythmIdLookup.set(a,n);const r=i.addElement("Rhythm");if(r.attributes.set("id",n),t.hasTuplet){const l=r.addElement("PrimaryTuplet");l.attributes.set("num",t.tupletNumerator.toString()),l.attributes.set("den",t.tupletDenominator.toString())}t.dots>0&&r.addElement("AugmentationDot").attributes.set("count",t.dots.toString());let o="Quarter";switch(t.duration){case w.QuadrupleWhole:o="Long";break;case w.DoubleWhole:o="DoubleWhole";break;case w.Whole:o="Whole";break;case w.Half:o="Half";break;case w.Quarter:o="Quarter";break;case w.Eighth:o="Eighth";break;case w.Sixteenth:o="16th";break;case w.ThirtySecond:o="32nd";break;case w.SixtyFourth:o="64th";break;case w.OneHundredTwentyEighth:o="128th";break;case w.TwoHundredFiftySixth:o="256th";break}r.addElement("NoteValue").innerText=o}e.addElement("Rhythm").attributes.set("ref",n)}writeWhammyNode(e,t){t.hasWhammyBar&&t.whammyBarPoints.length<=4&&this.writeStandardWhammy(e,t.whammyBarPoints)}writeStandardWhammy(e,t){const i=e.addElement("Whammy"),a=t[0],n=t[t.length-1];let r,o;switch(t.length){case 4:r=t[1],o=t[2];break;case 3:r=t[1],o=t[1];break;default:r=new H((a.offset+n.offset)/2,(a.value+n.value)/2),o=r;break}i.attributes.set("destinationOffset",this.toBendOffset(n.offset).toString()),i.attributes.set("destinationValue",this.toBendValue(n.value).toString()),i.attributes.set("middleOffset1",this.toBendOffset(r.offset).toString()),i.attributes.set("middleOffset2",this.toBendOffset(o.offset).toString()),i.attributes.set("middleValue",this.toBendValue(r.value).toString()),i.attributes.set("originOffset",this.toBendOffset(a.offset).toString()),i.attributes.set("originValue",this.toBendValue(a.value).toString())}writeScoreNode(e,t){const i=e.addElement("Score");i.addElement("Title").setCData(t.title),i.addElement("SubTitle").setCData(t.subTitle),i.addElement("Artist").setCData(t.artist),i.addElement("Album").setCData(t.album),i.addElement("Words").setCData(t.words),i.addElement("Music").setCData(t.music),i.addElement("WordsAndMusic").setCData(t.words===t.music?t.words:""),i.addElement("Copyright").setCData(t.copyright),i.addElement("Tabber").setCData(t.tab),i.addElement("Instructions").setCData(t.instructions),i.addElement("Notices").setCData(t.notices),i.addElement("FirstPageHeader").setCData(""),i.addElement("FirstPageFooter").setCData(""),i.addElement("PageHeader").setCData(""),i.addElement("PageFooter").setCData(""),i.addElement("ScoreSystemsDefaultLayout").setCData(t.defaultSystemsLayout.toString()),i.addElement("ScoreSystemsLayout").setCData(t.systemsLayout.join(" ")),i.addElement("ScoreZoomPolicy").innerText="Value",i.addElement("ScoreZoom").innerText="1",i.addElement("MultiVoice").innerText="1>"}writeMasterTrackNode(e,t){const i=e.addElement("MasterTrack");i.addElement("Tracks").innerText=t.tracks.map(l=>l.index).join(" ");const a=i.addElement("Automations");if(t.masterBars.length>0&&t.masterBars[0].isAnacrusis&&i.addElement("Anacrusis"),t.masterBars[0].tempoAutomations.length===0){const l=a.addElement("Automation");l.addElement("Type").innerText="Tempo",l.addElement("Linear").innerText="false",l.addElement("Bar").innerText="0",l.addElement("Position").innerText="0",l.addElement("Visible").innerText="true",l.addElement("Value").innerText=`${t.tempo} 2`,t.tempoLabel&&(l.addElement("Text").innerText=t.tempoLabel)}const n=t.masterBars[0].syncPoints?t.masterBars[0].syncPoints.find(l=>l.ratioPosition===0&&l.syncPointValue.barOccurence===0):void 0,r=n?n.syncPointValue.millisecondOffset:0;this.backingTrackFramePadding=-1*(r/1e3*es.SampleRate)|0;const o=new Fh(()=>ue.buildModifiedTempoLookup(t));for(const l of t.masterBars){for(const h of l.tempoAutomations){const c=a.addElement("Automation");c.addElement("Type").innerText="Tempo",c.addElement("Linear").innerText=h.isLinear?"true":"false",c.addElement("Bar").innerText=l.index.toString(),c.addElement("Position").innerText=h.ratioPosition.toString(),c.addElement("Visible").innerText="true",c.addElement("Value").innerText=`${h.value} 2`,h.text&&(c.addElement("Text").innerText=h.text)}if(l.syncPoints)for(const h of l.syncPoints){const c=a.addElement("Automation");c.addElement("Type").innerText="SyncPoint",c.addElement("Linear").innerText="false",c.addElement("Bar").innerText=l.index.toString(),c.addElement("Position").innerText=h.ratioPosition.toString(),c.addElement("Visible").innerText="true";const d=c.addElement("Value");d.addElement("BarIndex").innerText=l.index.toString(),d.addElement("BarOccurrence").innerText=h.syncPointValue.barOccurence.toString(),d.addElement("ModifiedTempo").innerText=o.value.get(h).syncBpm.toString(),d.addElement("OriginalTempo").innerText=t.tempo.toString();let f=(h.syncPointValue.millisecondOffset-r)/1e3*es.SampleRate;f=Math.floor(f+.5),d.addElement("FrameOffset").innerText=f.toString()}}}writeAudioTracksNode(e,t){e.addElement("AudioTracks")}writeTracksNode(e,t){const i=e.addElement("Tracks");for(const a of t.tracks)this.writeTrackNode(i,a)}writeTrackNode(e,t){const i=e.addElement("Track");i.attributes.set("id",t.index.toString()),i.addElement("Name").setCData(t.name),i.addElement("ShortName").setCData(t.shortName),i.addElement("Color").innerText=`${t.color.r} ${t.color.g} ${t.color.b}`,i.addElement("SystemsDefautLayout").innerText=t.defaultSystemsLayout.toString(),i.addElement("SystemsLayout").innerText=t.systemsLayout.join(" "),i.addElement("AutoBrush"),i.addElement("PalmMute").innerText="0",i.addElement("PlayingStyle").innerText=oa.isGuitar(t.playbackInfo.program)?"StringedPick":"Default",i.addElement("UseOneChannelPerString"),i.addElement("IconId").innerText=es.getIconId(t.playbackInfo).toString(),this.writeInstrumentSetNode(i,t),this.writeTransposeNode(i,t),this.writeRseNode(i,t),i.addElement("ForcedSound").innerText="-1",this.writeMidiConnectionNode(i,t),t.playbackInfo.isSolo?i.addElement("PlaybackState").innerText="Solo":t.playbackInfo.isMute?i.addElement("PlaybackState").innerText="Mute":i.addElement("PlaybackState").innerText="Default",i.addElement("AudioEngineState").innerText="MIDI",this.writeLyricsNode(i,t),this.writeStavesNode(i,t),this.writeSoundsAndAutomations(i,t)}static getIconId(e){return e.primaryChannel===9?es.DrumKitProgramInfo.icon:es.MidiProgramInfoLookup.has(e.program)?es.MidiProgramInfoLookup.get(e.program).icon:F.SteelGuitar}writeSoundAndAutomation(e,t,i,a,n,r,o,l=0){const h=e.addElement("Sound");h.addElement("Name").setCData(i),h.addElement("Label").setCData(i),h.addElement("Path").setCData(a),h.addElement("Role").setCData(n);const c=h.addElement("MIDI");c.addElement("LSB").innerText="0",c.addElement("MSB").innerText="0",c.addElement("Program").innerText=o.toString();const d=t.addElement("Automation");d.addElement("Type").innerText="Sound",d.addElement("Linear").innerText="false",d.addElement("Bar").innerText=r.toString(),d.addElement("Position").innerText=l.toString(),d.addElement("Visible").innerText="true",d.addElement("Value").setCData(`${a};${i};${n}`)}writeSoundsAndAutomations(e,t){const i=e.addElement("Sounds"),a=e.addElement("Automations");if(t.staves.length>0&&t.staves[0].bars.length>0){const n=`Track_${t.index}_Initial`,r=`Midi/${t.playbackInfo.program}`,o="Factory";let l=!1;for(const h of t.staves)for(const c of h.bars)for(const d of c.voices)for(const f of d.beats){const p=f.getAutomation(tt.Instrument),g=c.index===0&&f.index===0;if(p){const m=g?n:`ProgramChange_${f.id}`,T=g?r:`Midi/${p.value}`,S=g?o:"User";!g&&!l&&(this.writeSoundAndAutomation(i,a,n,r,o,t.staves[0].bars[0].index,t.playbackInfo.program),l=!0),this.writeSoundAndAutomation(i,a,m,T,S,c.index,p.value,p.ratioPosition),g&&(l=!0)}}}for(const n of t.staves)for(const r of n.bars)for(const o of r.sustainPedals)if(o.pedalType!==Et.Hold){const l=a.addElement("Automation");switch(l.addElement("Type").innerText="SustainPedal",l.addElement("Linear").innerText="false",l.addElement("Bar").innerText=r.index.toString(),l.addElement("Position").innerText=o.ratioPosition.toString(),l.addElement("Visible").innerText="true",o.pedalType){case Et.Down:l.addElement("Value").innerText="0 1";break;case Et.Up:l.addElement("Value").innerText="0 3";break}}}writeMidiConnectionNode(e,t){const i=e.addElement("MidiConnection");i.addElement("Port").innerText=t.playbackInfo.port.toString(),i.addElement("PrimaryChannel").innerText=t.playbackInfo.primaryChannel.toString(),i.addElement("SecondaryChannel").innerText=t.playbackInfo.secondaryChannel.toString(),i.addElement("ForeOneChannelPerString").innerText="false"}writeRseNode(e,t){const a=e.addElement("RSE").addElement("ChannelStrip");a.attributes.set("version","E56");const n=a.addElement("Parameters");n.innerText=`0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 1 0.5 ${t.playbackInfo.balance/16} ${t.playbackInfo.volume/16} 0.5 0.5 0.5`}writeStavesNode(e,t){const i=e.addElement("Staves");for(const a of t.staves)this.writeStaffNode(i,a)}writeStaffNode(e,t){const a=e.addElement("Staff").addElement("Properties");if(this.writeSimplePropertyNode(a,"CapoFret","Fret",t.capo.toString()),this.writeSimplePropertyNode(a,"FretCount","Fret","24"),t.tuning.length>0){const n=a.addElement("Property");switch(n.attributes.set("name","Tuning"),n.addElement("Pitches").innerText=t.tuning.slice().reverse().join(" "),n.addElement("Label").setCData(t.tuningName),n.addElement("LabelVisible").innerText=t.tuningName?"true":"false",n.addElement("Flat"),t.tuning.length){case 3:n.addElement("Instrument").innerText="Shamisen";break;case 4:t.track.playbackInfo.program===105?n.addElement("Instrument").innerText="Banjo":t.track.playbackInfo.program===42?n.addElement("Instrument").innerText="Cello":t.track.playbackInfo.program===43?n.addElement("Instrument").innerText="Contrabass":t.track.playbackInfo.program===40?n.addElement("Instrument").innerText="Violin":t.track.playbackInfo.program===41?n.addElement("Instrument").innerText="Viola":n.addElement("Instrument").innerText="Bass";break;case 5:t.track.playbackInfo.program===105?n.addElement("Instrument").innerText="Banjo":n.addElement("Instrument").innerText="Bass";break;case 6:t.track.playbackInfo.program===105?n.addElement("Instrument").innerText="Banjo":t.track.playbackInfo.program<=39?n.addElement("Instrument").innerText="Bass":n.addElement("Instrument").innerText="Guitar";break;case 7:t.track.playbackInfo.program<=39?n.addElement("Instrument").innerText="Bass":n.addElement("Instrument").innerText="Guitar";break;default:n.addElement("Instrument").innerText="Guitar";break}}this.writeSimplePropertyNode(a,"PartialCapoFret","Fret","0"),this.writeSimplePropertyNode(a,"PartialCapoStringFlags","Bitset",t.tuning.map(n=>"0").join("")),this.writeSimplePropertyNode(a,"TuningFlat","Enable",null),this.writeDiagramCollection(a,t,"DiagramCollection"),this.writeDiagramCollection(a,t,"DiagramWorkingSet")}writeDiagramCollection(e,t,i){const a=e.addElement("Property");a.attributes.set("name",i);const n=a.addElement("Items"),r=t.chords;if(r)for(const[o,l]of r){const h=n.addElement("Item");h.attributes.set("id",o),h.attributes.set("name",l.name);const c=h.addElement("Diagram");c.attributes.set("stringCount",l.strings.length.toString()),c.attributes.set("fretCount","5"),c.attributes.set("baseFret",(l.firstFret-1).toString()),c.attributes.set("barStates",l.strings.map(L=>"1").join(" "));const d=[],f=new Map;for(let L=0;L<l.strings.length;L++){const _=l.strings[L];if(_!==-1){const A=c.addElement("Fret"),J=l.strings.length-1-L;A.attributes.set("string",J.toString()),A.attributes.set("fret",(_-l.firstFret+1).toString()),f.has(_)||(f.set(_,[]),d.push(_)),f.get(_).push(J)}}d.sort();const p=c.addElement("Fingering");if(l.barreFrets.length>0){const L=[ie.LittleFinger,ie.AnnularFinger,ie.MiddleFinger,ie.IndexFinger];for(const _ of d){const A=f.get(_);if(A.length>1&&l.barreFrets.indexOf(_)>=0){const J=L.length>0?L.pop():ie.IndexFinger;for(const G of A){const ee=p.addElement("Position");switch(J){case ie.LittleFinger:ee.attributes.set("finger","Pinky");break;case ie.AnnularFinger:ee.attributes.set("finger","Ring");break;case ie.MiddleFinger:ee.attributes.set("finger","Middle");break;case ie.IndexFinger:ee.attributes.set("finger","Index");break}ee.attributes.set("fret",(_-l.firstFret+1).toString()),ee.attributes.set("string",G.toString())}}}}const g=c.addElement("Property");g.attributes.set("name","ShowName"),g.attributes.set("type","bool"),g.attributes.set("value",l.showName?"true":"false");const m=c.addElement("Property");m.attributes.set("name","ShowDiagram"),m.attributes.set("type","bool"),m.attributes.set("value",l.showDiagram?"true":"false");const T=c.addElement("Property");T.attributes.set("name","ShowFingering"),T.attributes.set("type","bool"),T.attributes.set("value",l.showFingering?"true":"false");const S=c.addElement("Chord"),y=S.addElement("KeyNote");y.attributes.set("step","C"),y.attributes.set("accidental","Natural");const b=S.addElement("BassNote");b.attributes.set("step","C"),b.attributes.set("accidental","Natural");const B=S.addElement("Degree");B.attributes.set("interval","Third"),B.attributes.set("alteration","Major"),B.attributes.set("omitted","false");const N=S.addElement("Degree");N.attributes.set("interval","Fifth"),N.attributes.set("alteration","Perfect"),N.attributes.set("omitted","false")}}writeSimplePropertyNode(e,t,i,a){const n=e.addElement("Property");n.attributes.set("name",t);const r=n.addElement(i);return a!==null&&(r.innerText=a),n}writeSimpleXPropertyNode(e,t,i,a){const n=e.addElement("XProperty");n.attributes.set("id",t);const r=n.addElement(i);return a!==null&&(r.innerText=a),n}writeLyricsNode(e,t){const i=e.addElement("Lyrics");i.attributes.set("dispatched","true");const a=[];for(const n of t.staves[0].bars)for(const r of n.voices)if(!r.isEmpty){for(const o of r.beats)if(o.lyrics)for(let l=0;l<o.lyrics.length;l++){for(;l>=a.length;){const c=new Xt;c.startBar=n.index,c.text="[Empty]",a.push(c)}const h=a[l];h.text=h.text==="[Empty]"?o.lyrics[l]:`${h.text} ${o.lyrics[l].split(" ").join("+")}`}}for(let n=0;n<a.length;n++){const r=i.addElement("Line");r.addElement("Text").setCData(a[n].text),r.addElement("Offset").innerText=a[n].startBar.toString()}}writeTransposeNode(e,t){const i=e.addElement("Transpose"),a=Math.floor(t.staves[0].displayTranspositionPitch/12),n=t.staves[0].displayTranspositionPitch-a*12;i.addElement("Chromatic").innerText=n.toString(),i.addElement("Octave").innerText=a.toString()}writeInstrumentSetNode(e,t){const i=e.addElement("InstrumentSet"),a=t.staves[0];if(i.addElement("LineCount").innerText=a.standardNotationLineCount.toString(),t.percussionArticulations.length>0||a.isPercussion){const n=t.percussionArticulations.length>0?t.percussionArticulations:Array.from(At.instrumentArticulations.values());i.addElement("Name").innerText=es.DrumKitProgramInfo.instrumentSetName,i.addElement("Type").innerText=es.DrumKitProgramInfo.instrumentSetType;let r="",o=new Ls;const l=new Map,h=i.addElement("Elements");for(const c of n){{const f=h.addElement("Element");let p=c.elementType;if(l.has(p)){const g=l.get(p);p+=` ${g}`,l.set(p,g+1)}else l.set(p,1);r=p,f.addElement("Name").innerText=p,f.addElement("Type").innerText=c.elementType,o=f.addElement("Articulations")}const d=o.addElement("Articulation");switch(d.addElement("Name").innerText=`${r} ${o.childNodes.length}`,d.addElement("StaffLine").innerText=c.staffLine.toString(),d.addElement("Noteheads").innerText=[this.mapMusicSymbol(c.noteHeadDefault),this.mapMusicSymbol(c.noteHeadHalf),this.mapMusicSymbol(c.noteHeadWhole)].join(" "),c.techniqueSymbolPlacement){case he.Top:d.addElement("TechniquePlacement").innerText="below";break;case he.Middle:d.addElement("TechniquePlacement").innerText="inside";break;case he.Bottom:d.addElement("TechniquePlacement").innerText="above";break}d.addElement("TechniqueSymbol").innerText=this.mapMusicSymbol(c.techniqueSymbol),d.addElement("InputMidiNumbers").innerText="",d.addElement("OutputMidiNumber").innerText=c.outputMidiNumber.toString()}}else{const n=es.MidiProgramInfoLookup.has(t.playbackInfo.program)?es.MidiProgramInfoLookup.get(t.playbackInfo.program):es.MidiProgramInfoLookup.get(0);i.addElement("Name").innerText=n.instrumentSetName,i.addElement("Type").innerText=n.instrumentSetType;const o=i.addElement("Elements").addElement("Element");o.addElement("Pitched").innerText="Pitched",o.addElement("Type").innerText="pitched",o.addElement("SoundbankName").innerText="";const h=o.addElement("Articulations").addElement("Articulation");h.addElement("Name").innerText="",h.addElement("StaffLine").innerText="0",h.addElement("Noteheads").innerText="noteheadBlack noteheadHalf noteheadWhole",h.addElement("TechniquePlacement").innerText="outside",h.addElement("TechniqueSymbol").innerText="",h.addElement("InputMidiNumbers").innerText="",h.addElement("OutputRSESound").innerText="",h.addElement("OutputMidiNumber").innerText="0"}}mapMusicSymbol(e){if(e===u.None)return"";const t=u[e];return t.substring(0,1).toLowerCase()+t.substring(1)}writeMasterBarsNode(e,t){const i=e.addElement("MasterBars");for(const a of t.masterBars)this.writeMasterBarNode(i,a)}writeMasterBarNode(e,t){const i=e.addElement("MasterBar"),a=i.addElement("Key");a.addElement("AccidentalCount").innerText=t.keySignature.toString(),a.addElement("Mode").innerText=Mi[t.keySignatureType],a.addElement("Sharps").innerText="Sharps",i.addElement("Time").innerText=`${t.timeSignatureNumerator}/${t.timeSignatureDenominator}`,t.isFreeTime&&i.addElement("FreeTime");const n=[];for(const r of t.score.tracks)for(const o of r.staves)n.push(o.bars[t.index].id.toString());if(i.addElement("Bars").innerText=n.join(" "),t.isDoubleBar&&i.addElement("DoubleBar"),t.isSectionStart){const r=i.addElement("Section");r.addElement("Letter").setCData(t.section.marker),r.addElement("Text").setCData(t.section.text)}if(t.isRepeatStart||t.isRepeatEnd){const r=i.addElement("Repeat");r.attributes.set("start",t.isRepeatStart?"true":"false"),r.attributes.set("end",t.isRepeatEnd?"true":"false"),t.isRepeatEnd&&r.attributes.set("count",t.repeatCount.toString())}if(t.alternateEndings>0){let r=t.alternateEndings;const o=[];let l=0;for(;r>0;)(r>>l&1)===1&&(o.push(l+1),r&=~(1<<l)),l++;i.addElement("AlternateEndings").innerText=o.join(" ")}if(t.tripletFeel!==me.NoTripletFeel&&(i.addElement("TripletFeel").innerText=me[t.tripletFeel]),t.directions&&t.directions.size>0){const r=i.addElement("Directions");for(const o of t.directions)switch(o){case R.TargetFine:r.addElement("Target").innerText="Fine";break;case R.TargetSegno:r.addElement("Target").innerText="Segno";break;case R.TargetSegnoSegno:r.addElement("Target").innerText="SegnoSegno";break;case R.TargetCoda:r.addElement("Target").innerText="Coda";break;case R.TargetDoubleCoda:r.addElement("Target").innerText="DoubleCoda";break;case R.JumpDaCapo:r.addElement("Jump").innerText="DaCapo";break;case R.JumpDaCapoAlCoda:r.addElement("Jump").innerText="DaCapoAlCoda";break;case R.JumpDaCapoAlDoubleCoda:r.addElement("Jump").innerText="DaCapoAlDoubleCoda";break;case R.JumpDaCapoAlFine:r.addElement("Jump").innerText="DaCapoAlFine";break;case R.JumpDalSegno:r.addElement("Jump").innerText="DaSegno";break;case R.JumpDalSegnoAlCoda:r.addElement("Jump").innerText="DaSegnoAlCoda";break;case R.JumpDalSegnoAlDoubleCoda:r.addElement("Jump").innerText="DaSegnoAlDoubleCoda";break;case R.JumpDalSegnoAlFine:r.addElement("Jump").innerText="DaSegnoAlFine";break;case R.JumpDalSegnoSegno:r.addElement("Jump").innerText="DaSegnoSegno";break;case R.JumpDalSegnoSegnoAlCoda:r.addElement("Jump").innerText="DaSegnoSegnoAlCoda";break;case R.JumpDalSegnoSegnoAlDoubleCoda:r.addElement("Jump").innerText="DaSegnoSegnoAlDoubleCoda";break;case R.JumpDalSegnoSegnoAlFine:r.addElement("Jump").innerText="DaSegnoSegnoAlFine";break;case R.JumpDaCoda:r.addElement("Jump").innerText="DaCoda";break;case R.JumpDaDoubleCoda:r.addElement("Jump").innerText="DaDoubleCoda";break}}this.writeFermatas(i,t)}writeFermatas(e,t){var a;const i=((a=t.fermata)==null?void 0:a.size)??0;if(i!==0&&i>0){const n=e.addElement("Fermatas");for(const[r,o]of t.fermata)this.writeFermata(n,r,o)}}writeFermata(e,t,i){let a=-1,n=1;if(t>0)for(;n<10&&(a=t/v.QuarterTime*n,a!==Math.floor(a));)a=-1,n++;else a=0,n=1;if(a===-1)return;const r=e.addElement("Fermata");r.addElement("Type").innerText=Bi[i.type],r.addElement("Length").innerText=i.length.toString(),r.addElement("Offset").innerText=`${a}/${n}`}writeBarNode(e,t){const i=e.addElement("Bar");i.attributes.set("id",t.id.toString()),i.addElement("Voices").innerText=t.voices.map(a=>a.isEmpty?"-1":a.id.toString()).join(" "),i.addElement("Clef").innerText=xe[t.clef],t.clefOttava!==fe.Regular&&(i.addElement("Ottavia").innerText=fe[t.clefOttava].substr(1)),t.simileMark!==St.None&&(i.addElement("SimileMark").innerText=St[t.simileMark])}writeVoiceNode(e,t){if(t.isEmpty)return;const i=e.addElement("Voice");i.attributes.set("id",t.id.toString()),i.addElement("Beats").innerText=t.beats.map(a=>a.id).join(" ")}}es.SampleRate=44100;es.MidiProgramInfoLookup=new Map([[0,new O(F.Piano,"Acoustic Piano")],[1,new O(F.Piano,"Acoustic Piano")],[2,new O(F.Piano,"Electric Piano")],[3,new O(F.Piano,"Acoustic Piano")],[4,new O(F.Piano,"Electric Piano")],[5,new O(F.Piano,"Electric Piano")],[6,new O(F.Piano,"Harpsichord")],[7,new O(F.Piano,"Harpsichord")],[8,new O(F.PitchedIdiophone,"Celesta")],[9,new O(F.PitchedIdiophone,"Vibraphone")],[10,new O(F.PitchedIdiophone,"Vibraphone")],[11,new O(F.PitchedIdiophone,"Vibraphone")],[12,new O(F.PitchedIdiophone,"Xylophone")],[13,new O(F.PitchedIdiophone,"Xylophone")],[14,new O(F.PitchedIdiophone,"Vibraphone")],[15,new O(F.Banjo,"Banjo")],[16,new O(F.Piano,"Electric Organ")],[17,new O(F.Piano,"Electric Organ")],[18,new O(F.Piano,"Electric Organ")],[19,new O(F.Piano,"Electric Organ")],[20,new O(F.Piano,"Electric Organ")],[21,new O(F.Piano,"Electric Organ")],[22,new O(F.Woodwind,"Recorder")],[23,new O(F.Piano,"Electric Organ")],[24,new O(F.ClassicalGuitar,"Nylon Guitar")],[25,new O(F.SteelGuitar,"Steel Guitar")],[26,new O(F.SteelGuitar,"Electric Guitar")],[27,new O(F.ElectricGuitar,"Electric Guitar")],[28,new O(F.ElectricGuitar,"Electric Guitar")],[29,new O(F.ElectricGuitar,"Electric Guitar")],[30,new O(F.SteelGuitar,"Electric Guitar")],[31,new O(F.SteelGuitar,"Electric Guitar")],[32,new O(F.Bass,"Acoustic Bass")],[33,new O(F.Bass,"Electric Bass")],[34,new O(F.Bass,"Electric Bass")],[35,new O(F.Bass,"Acoustic Bass")],[36,new O(F.Bass,"Electric Bass")],[37,new O(F.Bass,"Electric Bass")],[38,new O(F.Synth,"Synth Bass")],[39,new O(F.Synth,"Synth Bass")],[40,new O(F.Strings,"Violin")],[41,new O(F.Strings,"Viola")],[42,new O(F.Strings,"Cello")],[43,new O(F.Strings,"Contrabass")],[44,new O(F.Strings,"Violin")],[45,new O(F.Strings,"Violin")],[46,new O(F.Piano,"Harp")],[47,new O(F.Membraphone,"Timpani")],[48,new O(F.Strings,"Violin")],[49,new O(F.Strings,"Violin")],[50,new O(F.Strings,"Violin")],[51,new O(F.Strings,"Violin")],[52,new O(F.Vocal,"Voice")],[53,new O(F.Vocal,"Voice")],[54,new O(F.Vocal,"Voice")],[55,new O(F.Synth,"Pad Synthesizer")],[56,new O(F.Brass,"Trumpet")],[57,new O(F.Brass,"Trombone")],[58,new O(F.Brass,"Tuba")],[59,new O(F.Brass,"Trumpet")],[60,new O(F.Brass,"French Horn")],[61,new O(F.Brass,"Trumpet")],[62,new O(F.Brass,"Trumpet")],[63,new O(F.Brass,"Trumpet")],[64,new O(F.Reed,"Saxophone")],[65,new O(F.Reed,"Saxophone")],[66,new O(F.Reed,"Saxophone")],[67,new O(F.Reed,"Saxophone")],[68,new O(F.Reed,"Oboe")],[69,new O(F.Reed,"English Horn")],[70,new O(F.Reed,"Bassoon")],[71,new O(F.Reed,"Clarinet")],[72,new O(F.Reed,"Piccolo")],[73,new O(F.Woodwind,"Flute")],[74,new O(F.Woodwind,"Recorder")],[75,new O(F.Woodwind,"Flute")],[76,new O(F.Woodwind,"Recorder")],[77,new O(F.Woodwind,"Flute")],[78,new O(F.Woodwind,"Recorder")],[79,new O(F.Woodwind,"Flute")],[80,new O(F.Synth,"Lead Synthesizer")],[81,new O(F.Synth,"Lead Synthesizer")],[82,new O(F.Synth,"Lead Synthesizer")],[83,new O(F.Synth,"Lead Synthesizer")],[84,new O(F.Synth,"Lead Synthesizer")],[85,new O(F.Synth,"Lead Synthesizer")],[86,new O(F.Synth,"Lead Synthesizer")],[87,new O(F.Synth,"Lead Synthesizer")],[88,new O(F.Synth,"Pad Synthesizer")],[89,new O(F.Synth,"Pad Synthesizer")],[90,new O(F.Synth,"Pad Synthesizer")],[91,new O(F.Synth,"Pad Synthesizer")],[92,new O(F.Synth,"Pad Synthesizer")],[93,new O(F.Synth,"Pad Synthesizer")],[94,new O(F.Synth,"Pad Synthesizer")],[95,new O(F.Synth,"Pad Synthesizer")],[96,new O(F.Fx,"Pad Synthesizer")],[97,new O(F.Fx,"Pad Synthesizer")],[98,new O(F.Fx,"Pad Synthesizer")],[99,new O(F.Fx,"Pad Synthesizer")],[100,new O(F.Fx,"Lead Synthesizer")],[101,new O(F.Fx,"Lead Synthesizer")],[102,new O(F.Fx,"Lead Synthesizer")],[103,new O(F.Fx,"Trumpet")],[104,new O(F.ElectricGuitar,"Banjo")],[105,new O(F.Banjo,"Banjo")],[106,new O(F.Ukulele,"Ukulele")],[107,new O(F.Banjo,"Banjo")],[108,new O(F.PitchedIdiophone,"Xylophone")],[109,new O(F.Reed,"Bassoon")],[110,new O(F.Strings,"Violin")],[111,new O(F.Woodwind,"Flute")],[112,new O(F.PitchedIdiophone,"Xylophone")],[113,new O(F.Idiophone,"Celesta")],[114,new O(F.PitchedIdiophone,"Vibraphone")],[115,new O(F.Idiophone,"Xylophone")],[116,new O(F.Membraphone,"Xylophone")],[117,new O(F.Membraphone,"Xylophone")],[118,new O(F.Membraphone,"Xylophone")],[119,new O(F.Idiophone,"Celesta")],[120,new O(F.Fx,"Steel Guitar")],[121,new O(F.Fx,"Recorder")],[122,new O(F.Fx,"Recorder")],[123,new O(F.Fx,"Recorder")],[124,new O(F.Fx,"Recorder")],[125,new O(F.Fx,"Recorder")],[126,new O(F.Fx,"Recorder")],[127,new O(F.Fx,"Timpani")]]);es.DrumKitProgramInfo=new O(F.PercussionKit,"Drums","drumKit");class Qn{static buildCrc32Lookup(){const t=new Uint32Array(256);for(let i=0;i<t.length;i++){let a=i;for(let n=0;n<8;n++)a=(a&1)===1?a>>>1^3988292384:a>>>1;t[i]=a}return t}get value(){return~this._checkValue}constructor(){this._checkValue=Qn.CrcInit,this.reset()}update(e,t,i){for(let a=0;a<i;a++)this._checkValue=Qn.Crc32Lookup[(this._checkValue^e[t+a])&255]^this._checkValue>>>8}reset(){this._checkValue=Qn.CrcInit}}Qn.Crc32Lookup=Qn.buildCrc32Lookup();Qn.CrcInit=4294967295;class re{}re.MAX_WBITS=15;re.WSIZE=1<<re.MAX_WBITS;re.WMASK=re.WSIZE-1;re.MIN_MATCH=3;re.MAX_MATCH=258;re.DEFAULT_MEM_LEVEL=8;re.PENDING_BUF_SIZE=1<<re.DEFAULT_MEM_LEVEL+8;re.HASH_BITS=re.DEFAULT_MEM_LEVEL+7;re.HASH_SIZE=1<<re.HASH_BITS;re.HASH_SHIFT=(re.HASH_BITS+re.MIN_MATCH-1)/re.MIN_MATCH;re.HASH_MASK=re.HASH_SIZE-1;re.MIN_LOOKAHEAD=re.MAX_MATCH+re.MIN_MATCH+1;re.MAX_DIST=re.WSIZE-re.MIN_LOOKAHEAD;class As{constructor(e,t,i,a){this.length=null,this.numCodes=0,this.codes=null,this.huffman=e,this.minNumCodes=i,this.maxLength=a,this.freqs=new Int16Array(t),this.bitLengthCounts=new Int32Array(a)}reset(){for(let e=0;e<this.freqs.length;e++)this.freqs[e]=0;this.codes=null,this.length=null}buildTree(){const e=this.freqs.length,t=new Int32Array(e);let i=0,a=0;for(let h=0;h<e;h++){const c=this.freqs[h];if(c!==0){let d=i++;for(;d>0;){const f=Math.floor((d-1)/2);if(this.freqs[t[f]]>c)t[d]=t[f],d=f;else break}t[d]=h,a=h}}for(;i<2;){const h=a<2?++a:0;t[i++]=h}this.numCodes=Math.max(a+1,this.minNumCodes);const n=i,r=new Int32Array(4*i-2),o=new Int32Array(2*i-1);let l=n;for(let h=0;h<i;h++){const c=t[h];r[2*h]=c,r[2*h+1]=-1,o[h]=this.freqs[c]<<8,t[h]=h}do{const h=t[0];let c=t[--i],d=0,f=1;for(;f<i;)f+1<i&&o[t[f]]>o[t[f+1]]&&f++,t[d]=t[f],d=f,f=f*2+1;let p=o[c];for(;f=d,d>0;)if(d=Math.floor((f-1)/2),o[t[d]]>p)t[f]=t[d];else break;t[f]=c;const g=t[0];c=l++,r[2*c]=h,r[2*c+1]=g;const m=Math.min(o[h]&255,o[g]&255);for(p=o[h]+o[g]-m+1,o[c]=p,d=0,f=1;f<i;)f+1<i&&o[t[f]]>o[t[f+1]]&&f++,t[d]=t[f],d=f,f=d*2+1;for(;f=d,f>0;)if(d=Math.floor((f-1)/2),o[t[d]]>p)t[f]=t[d];else break;t[f]=c}while(i>1);this.buildLength(r)}buildLength(e){this.length=new Uint8Array(this.freqs.length);const t=Math.floor(e.length/2),i=Math.floor((t+1)/2);let a=0;for(let l=0;l<this.maxLength;l++)this.bitLengthCounts[l]=0;const n=new Int32Array(t);n[t-1]=0;for(let l=t-1;l>=0;l--)if(e[2*l+1]!==-1){let h=n[l]+1;h>this.maxLength&&(h=this.maxLength,a++),n[e[2*l]]=h,n[e[2*l+1]]=h}else{const h=n[l];this.bitLengthCounts[h-1]++,this.length[e[2*l]]=n[l]}if(a===0)return;let r=this.maxLength-1;do{for(;this.bitLengthCounts[--r]===0;);do this.bitLengthCounts[r]--,this.bitLengthCounts[++r]++,a-=1<<this.maxLength-1-r;while(a>0&&r<this.maxLength-1)}while(a>0);this.bitLengthCounts[this.maxLength-1]+=a,this.bitLengthCounts[this.maxLength-2]-=a;let o=2*i;for(let l=this.maxLength;l!==0;l--){let h=this.bitLengthCounts[l-1];for(;h>0;){const c=2*e[o++];e[c+1]===-1&&(this.length[e[c]]=l,h--)}}}getEncodedLength(){let e=0;for(let t=0;t<this.freqs.length;t++)e+=this.freqs[t]*this.length[t];return e}calcBLFreq(e){let t,i,a,n=-1,r=0;for(;r<this.numCodes;){a=1;const o=this.length[r];for(o===0?(t=138,i=3):(t=6,i=3,n!==o&&(e.freqs[o]++,a=0)),n=o,r++;r<this.numCodes&&n===this.length[r]&&(r++,!(++a>=t)););a<i?e.freqs[n]+=a:n!==0?e.freqs[As.Repeat3To6]++:a<=10?e.freqs[As.Repeat3To10]++:e.freqs[As.Repeat11To138]++}}setStaticCodes(e,t){this.codes=e,this.length=t}buildCodes(){const e=new Int32Array(this.maxLength);let t=0;this.codes=new Int16Array(this.freqs.length);for(let i=0;i<this.maxLength;i++)e[i]=t,t+=this.bitLengthCounts[i]<<15-i;for(let i=0;i<this.numCodes;i++){const a=this.length[i];a>0&&(this.codes[i]=le.bitReverse(e[a-1]),e[a-1]+=1<<16-a)}}writeTree(e){let t,i,a,n=-1,r=0;for(;r<this.numCodes;){a=1;const o=this.length[r];for(o===0?(t=138,i=3):(t=6,i=3,n!==o&&(e.writeSymbol(o),a=0)),n=o,r++;r<this.numCodes&&n===this.length[r]&&(r++,!(++a>=t)););if(a<i)for(;a-- >0;)e.writeSymbol(n);else n!==0?(e.writeSymbol(As.Repeat3To6),this.huffman.pending.writeBits(a-3,2)):a<=10?(e.writeSymbol(As.Repeat3To10),this.huffman.pending.writeBits(a-3,3)):(e.writeSymbol(As.Repeat11To138),this.huffman.pending.writeBits(a-11,7))}}writeSymbol(e){this.huffman.pending.writeBits(this.codes[e]&65535,this.length[e])}}As.Repeat3To6=16;As.Repeat3To10=17;As.Repeat11To138=18;class le{static staticInit(){let e=0;for(;e<144;)le.staticLCodes[e]=le.bitReverse(48+e<<8),le.staticLLength[e++]=8;for(;e<256;)le.staticLCodes[e]=le.bitReverse(256+e<<7),le.staticLLength[e++]=9;for(;e<280;)le.staticLCodes[e]=le.bitReverse(-256+e<<9),le.staticLLength[e++]=7;for(;e<le.LITERAL_NUM;)le.staticLCodes[e]=le.bitReverse(-88+e<<8),le.staticLLength[e++]=8;for(e=0;e<le.DIST_NUM;e++)le.staticDCodes[e]=le.bitReverse(e<<11),le.staticDLength[e]=5}static bitReverse(e){return le.bit4Reverse[e&15]<<12|le.bit4Reverse[e>>4&15]<<8|le.bit4Reverse[e>>8&15]<<4|le.bit4Reverse[e>>12]}constructor(e){this.last_lit=0,this.extra_bits=0,this.pending=e,this.literalTree=new As(this,le.LITERAL_NUM,257,15),this.distTree=new As(this,le.DIST_NUM,1,15),this.blTree=new As(this,le.BITLEN_NUM,4,7),this.d_buf=new Int16Array(le.BUFSIZE),this.l_buf=new Uint8Array(le.BUFSIZE)}isFull(){return this.last_lit>=le.BUFSIZE}reset(){this.last_lit=0,this.extra_bits=0,this.literalTree.reset(),this.distTree.reset(),this.blTree.reset()}flushStoredBlock(e,t,i,a){this.pending.writeBits((le.STORED_BLOCK<<1)+(a?1:0),3),this.pending.alignToByte(),this.pending.writeShort(i),this.pending.writeShort(~i),this.pending.writeBlock(e,t,i),this.reset()}flushBlock(e,t,i,a){this.literalTree.freqs[le.EOF_SYMBOL]++,this.literalTree.buildTree(),this.distTree.buildTree(),this.literalTree.calcBLFreq(this.blTree),this.distTree.calcBLFreq(this.blTree),this.blTree.buildTree();let n=4;for(let l=18;l>n;l--)this.blTree.length[le.BL_ORDER[l]]>0&&(n=l+1);let r=14+n*3+this.blTree.getEncodedLength()+this.literalTree.getEncodedLength()+this.distTree.getEncodedLength()+this.extra_bits,o=this.extra_bits;for(let l=0;l<le.LITERAL_NUM;l++)o+=this.literalTree.freqs[l]*le.staticLLength[l];for(let l=0;l<le.DIST_NUM;l++)o+=this.distTree.freqs[l]*le.staticDLength[l];r>=o&&(r=o),t>=0&&i+4<r>>3?this.flushStoredBlock(e,t,i,a):r===o?(this.pending.writeBits((le.STATIC_TREES<<1)+(a?1:0),3),this.literalTree.setStaticCodes(le.staticLCodes,le.staticLLength),this.distTree.setStaticCodes(le.staticDCodes,le.staticDLength),this.compressBlock(),this.reset()):(this.pending.writeBits((le.DYN_TREES<<1)+(a?1:0),3),this.sendAllTrees(n),this.compressBlock(),this.reset())}sendAllTrees(e){this.blTree.buildCodes(),this.literalTree.buildCodes(),this.distTree.buildCodes(),this.pending.writeBits(this.literalTree.numCodes-257,5),this.pending.writeBits(this.distTree.numCodes-1,5),this.pending.writeBits(e-4,4);for(let t=0;t<e;t++)this.pending.writeBits(this.blTree.length[le.BL_ORDER[t]],3);this.literalTree.writeTree(this.blTree),this.distTree.writeTree(this.blTree)}compressBlock(){for(let e=0;e<this.last_lit;e++){const t=this.l_buf[e]&255;let i=this.d_buf[e];if(i--!==0){const a=le.Lcode(t);this.literalTree.writeSymbol(a);let n=Math.floor((a-261)/4);n>0&&n<=5&&this.pending.writeBits(t&(1<<n)-1,n);const r=le.Dcode(i);this.distTree.writeSymbol(r),n=Math.floor(r/2)-1,n>0&&this.pending.writeBits(i&(1<<n)-1,n)}else this.literalTree.writeSymbol(t)}this.literalTree.writeSymbol(le.EOF_SYMBOL)}tallyDist(e,t){this.d_buf[this.last_lit]=e,this.l_buf[this.last_lit++]=t-3;const i=le.Lcode(t-3);this.literalTree.freqs[i]++,i>=265&&i<285&&(this.extra_bits+=Math.floor((i-261)/4));const a=le.Dcode(e-1);return this.distTree.freqs[a]++,a>=4&&(this.extra_bits+=Math.floor(a/2)-1),this.isFull()}tallyLit(e){return this.d_buf[this.last_lit]=0,this.l_buf[this.last_lit++]=e,this.literalTree.freqs[e]++,this.isFull()}static Lcode(e){if(e===255)return 285;let t=257;for(;e>=8;)t+=4,e=e>>1;return t+e}static Dcode(e){let t=0;for(;e>=4;)t+=2,e=e>>1;return t+e}}le.BUFSIZE=1<<re.DEFAULT_MEM_LEVEL+6;le.LITERAL_NUM=286;le.STORED_BLOCK=0;le.STATIC_TREES=1;le.DYN_TREES=2;le.DIST_NUM=30;le.staticLCodes=new Int16Array(le.LITERAL_NUM);le.staticLLength=new Uint8Array(le.LITERAL_NUM);le.staticDCodes=new Int16Array(le.DIST_NUM);le.staticDLength=new Uint8Array(le.DIST_NUM);le.BL_ORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];le.bit4Reverse=new Uint8Array([0,8,4,12,2,10,6,14,1,9,5,13,3,11,7,15]);le.BITLEN_NUM=19;le.EOF_SYMBOL=256;le.staticInit();class cd{constructor(e){this.maxChain=128,this.niceLength=128,this.goodLength=8,this.insertHashIndex=0,this.lookahead=0,this.inputBuf=null,this.inputOff=0,this.inputEnd=0,this.prevAvailable=!1,this.matchStart=0,this.matchLen=0,this.pending=e,this.huffman=new le(e),this.inputCrc=new Qn,this.window=new Uint8Array(2*re.WSIZE),this.head=new Int16Array(re.HASH_SIZE),this.prev=new Int16Array(re.WSIZE),this.blockStart=1,this.strstart=1}reset(){this.huffman.reset(),this.inputCrc.reset(),this.blockStart=1,this.strstart=1,this.lookahead=0,this.prevAvailable=!1,this.matchLen=re.MIN_MATCH-1;for(let e=0;e<re.HASH_SIZE;e++)this.head[e]=0;for(let e=0;e<re.WSIZE;e++)this.prev[e]=0}updateHash(){this.insertHashIndex=this.window[this.strstart]<<re.HASH_SHIFT^this.window[this.strstart+1]}needsInput(){return this.inputEnd===this.inputOff}setInput(e,t,i){const a=t+i;this.inputBuf=e,this.inputOff=t,this.inputEnd=a}deflate(e,t){let i;do{this.fillWindow();const a=e&&this.inputOff===this.inputEnd;i=this.deflateSlow(a,t)}while(this.pending.isFlushed&&i);return i}deflateSlow(e,t){if(this.lookahead<re.MIN_LOOKAHEAD&&!e)return!1;for(;this.lookahead>=re.MIN_LOOKAHEAD||e;){if(this.lookahead===0)return this.prevAvailable&&this.huffman.tallyLit(this.window[this.strstart-1]&255),this.prevAvailable=!1,this.huffman.flushBlock(this.window,this.blockStart,this.strstart-this.blockStart,t),this.blockStart=this.strstart,!1;this.strstart>=2*re.WSIZE-re.MIN_LOOKAHEAD&&this.slideWindow();const i=this.matchStart;let a=this.matchLen;if(this.lookahead>=re.MIN_MATCH){const n=this.insertString();n!==0&&this.strstart-n<=re.MAX_DIST&&this.findLongestMatch(n)&&this.matchLen===re.MIN_MATCH&&this.strstart-this.matchStart>cd.TooFar&&(this.matchLen=re.MIN_MATCH-1)}if(a>=re.MIN_MATCH&&this.matchLen<=a){this.huffman.tallyDist(this.strstart-1-i,a),a-=2;do this.strstart++,this.lookahead--,this.lookahead>=re.MIN_MATCH&&this.insertString();while(--a>0);this.strstart++,this.lookahead--,this.prevAvailable=!1,this.matchLen=re.MIN_MATCH-1}else this.prevAvailable&&this.huffman.tallyLit(this.window[this.strstart-1]&255),this.prevAvailable=!0,this.strstart++,this.lookahead--;if(this.huffman.isFull()){let n=this.strstart-this.blockStart;this.prevAvailable&&n--;const r=t&&this.lookahead===0&&!this.prevAvailable;return this.huffman.flushBlock(this.window,this.blockStart,n,r),this.blockStart+=n,!r}}return!0}findLongestMatch(e){let t,i=this.strstart;const a=i+Math.min(re.MAX_MATCH,this.lookahead)-1,n=Math.max(i-re.MAX_DIST,0),r=this.window,o=this.prev;let l=this.maxChain;const h=Math.min(this.niceLength,this.lookahead);if(this.matchLen=Math.max(this.matchLen,re.MIN_MATCH-1),i+this.matchLen>a)return!1;let c=r[i+this.matchLen-1],d=r[i+this.matchLen];this.matchLen>=this.goodLength&&(l>>=2);do if(t=e,i=this.strstart,!(r[t+this.matchLen]!==d||r[t+this.matchLen-1]!==c||r[t]!==r[i]||r[++t]!==r[++i])){switch((a-i)%8){case 1:if(r[++i]===r[++t])break;break;case 2:if(r[++i]===r[++t]&&r[++i]===r[++t])break;break;case 3:if(r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t])break;break;case 4:if(r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t])break;break;case 5:if(r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t])break;break;case 6:if(r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t])break;break;case 7:if(r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t])break;break}if(r[i]===r[t])do if(i===a){++i,++t;break}while(r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]&&r[++i]===r[++t]);if(i-this.strstart>this.matchLen){if(this.matchStart=e,this.matchLen=i-this.strstart,this.matchLen>=h)break;c=r[i-1],d=r[i]}e=o[e&re.WMASK]&65535}while(e>n&&--l!==0);return this.matchLen>=re.MIN_MATCH}insertString(){const e=(this.insertHashIndex<<re.HASH_SHIFT^this.window[this.strstart+(re.MIN_MATCH-1)])&re.HASH_MASK,t=this.head[e];return this.prev[this.strstart&re.WMASK]=t,this.head[e]=this.strstart,this.insertHashIndex=e,t&65535}fillWindow(){if(this.strstart>=re.WSIZE+re.MAX_DIST&&this.slideWindow(),this.lookahead<re.MIN_LOOKAHEAD&&this.inputOff<this.inputEnd){let e=2*re.WSIZE-this.lookahead-this.strstart;e>this.inputEnd-this.inputOff&&(e=this.inputEnd-this.inputOff),this.window.set(this.inputBuf.subarray(this.inputOff,this.inputOff+e),this.strstart+this.lookahead),this.inputCrc.update(this.inputBuf,this.inputOff,e),this.inputOff+=e,this.lookahead+=e}this.lookahead>=re.MIN_MATCH&&this.updateHash()}slideWindow(){this.window.set(this.window.subarray(re.WSIZE,re.WSIZE+re.WSIZE),0),this.matchStart-=re.WSIZE,this.strstart-=re.WSIZE,this.blockStart-=re.WSIZE;for(let e=0;e<re.HASH_SIZE;++e){const t=this.head[e]&65535;this.head[e]=t>=re.WSIZE?t-re.WSIZE:0}for(let e=0;e<re.WSIZE;e++){const t=this.prev[e]&65535;this.prev[e]=t>=re.WSIZE?t-re.WSIZE:0}}}cd.TooFar=4096;class U2{get isFlushed(){return this._end===0}constructor(e){this._start=0,this._end=0,this._bits=0,this.bitCount=0,this._buffer=new Uint8Array(e)}reset(){this._start=0,this._end=0,this.bitCount=0}writeShortMSB(e){this._buffer[this._end++]=e>>8&255,this._buffer[this._end++]=e&255}writeShort(e){this._buffer[this._end++]=e,this._buffer[this._end++]=e>>8}writeBlock(e,t,i){this._buffer.set(e.subarray(t,t+i),this._end),this._end+=i}flush(e,t,i){return this.bitCount>=8&&(this._buffer[this._end++]=this._bits&255,this._bits>>=8,this.bitCount-=8),i>this._end-this._start?(i=this._end-this._start,e.set(this._buffer.subarray(this._start,this._start+i),t),this._start=0,this._end=0):(e.set(this._buffer.subarray(this._start,this._start+i),t),this._start+=i),i}writeBits(e,t){this._bits|=e<<this.bitCount,this.bitCount+=t,this.bitCount>=16&&(this._buffer[this._end++]=this._bits&255,this._buffer[this._end++]=this._bits>>8&255,this._bits>>=16,this.bitCount-=16)}alignToByte(){this.bitCount>0&&(this._buffer[this._end++]=this._bits&255,this.bitCount>8&&(this._buffer[this._end++]=this._bits>>8&255)),this._bits=0,this.bitCount=0}}class Ni{get inputCrc(){return this._engine.inputCrc.value}constructor(){this._state=0,this._pending=new U2(re.PENDING_BUF_SIZE),this._engine=new cd(this._pending),this.reset()}get isNeedingInput(){return this._engine.needsInput()}get isFinished(){return this._state===Ni.FinishedState&&this._pending.isFlushed}reset(){this._state=Ni.BusyState,this._pending.reset(),this._engine.reset()}setInput(e,t,i){this._engine.setInput(e,t,i)}deflate(e,t,i){const a=i;for(;;){const n=this._pending.flush(e,t,i);if(t+=n,i-=n,i===0||this._state===Ni.FinishedState)break;if(!this._engine.deflate((this._state&Ni.IsFlushing)!==0,(this._state&Ni.IsFinishing)!==0))switch(this._state){case Ni.BusyState:return a-i;case Ni.FlushingState:let r=8+(-this._pending.bitCount&7);for(;r>0;)this._pending.writeBits(2,10),r-=10;this._state=Ni.BusyState;break;case Ni.FinishingState:this._pending.alignToByte(),this._state=Ni.FinishedState;break}}return a-i}finish(){this._state|=Ni.IsFlushing|Ni.IsFinishing}}Ni.IsFlushing=4;Ni.IsFinishing=8;Ni.BusyState=16;Ni.FlushingState=20;Ni.FinishingState=28;Ni.FinishedState=30;class Y2 extends La{constructor(){super(0,0,Fe.EndOfTrack)}writeTo(e){throw new We(Ve.General,"Deprecated event, serialization not supported")}}var f0;(function(s){s[s.SequenceNumber=0]="SequenceNumber",s[s.TextEvent=1]="TextEvent",s[s.CopyrightNotice=2]="CopyrightNotice",s[s.SequenceOrTrackName=3]="SequenceOrTrackName",s[s.InstrumentName=4]="InstrumentName",s[s.LyricText=5]="LyricText",s[s.MarkerText=6]="MarkerText",s[s.CuePoint=7]="CuePoint",s[s.PatchName=8]="PatchName",s[s.PortName=9]="PortName",s[s.MidiChannel=32]="MidiChannel",s[s.MidiPort=33]="MidiPort",s[s.EndOfTrack=47]="EndOfTrack",s[s.Tempo=81]="Tempo",s[s.SmpteOffset=84]="SmpteOffset",s[s.TimeSignature=88]="TimeSignature",s[s.KeySignature=89]="KeySignature",s[s.SequencerSpecific=127]="SequencerSpecific"})(f0||(f0={}));var p0;(function(s){s[s.SystemExclusive=240]="SystemExclusive",s[s.MtcQuarterFrame=241]="MtcQuarterFrame",s[s.SongPosition=242]="SongPosition",s[s.SongSelect=243]="SongSelect",s[s.TuneRequest=246]="TuneRequest",s[s.SystemExclusive2=247]="SystemExclusive2"})(p0||(p0={}));class X2 extends Y2{}var g0;(function(s){s[s.MetronomeTick=0]="MetronomeTick",s[s.Rest=1]="Rest"})(g0||(g0={}));class q2 extends X2{constructor(){super(...arguments),this.data=new Uint8Array}get isMetronome(){return!1}get metronomeNumerator(){return-1}get metronomeDurationInTicks(){return-1}get metronomeDurationInMilliseconds(){return-1}get isRest(){return!1}get manufacturerId(){return 0}}q2.AlphaTabManufacturerId=125;/*!
 * alphaTab v1.6.3 (, build 22)
 *
 * Copyright  2025, Daniel Kuschny and Contributors, All rights reserved.
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/.
 *
 * Integrated Libraries:
 *
 * Library: TinySoundFont
 * License: MIT
 * Copyright: Copyright (C) 2017, 2018 Bernhard Schelling
 * URL: https://github.com/schellingb/TinySoundFont
 * Purpose: SoundFont loading and Audio Synthesis
 *
 * Library: SFZero
 * License: MIT
 * Copyright: Copyright (C) 2012 Steve Folta ()
 * URL: https://github.com/stevefolta/SFZero
 * Purpose: TinySoundFont is based on SFZEro
 *
 * Library: Haxe Standard Library
 * License: MIT
 * Copyright: Copyright (C)2005-2025 Haxe Foundation
 * URL: https://github.com/HaxeFoundation/haxe/tree/development/std
 * Purpose: XML Parser & Zip Inflate Algorithm
 *
 * Library: SharpZipLib
 * License: MIT
 * Copyright: Copyright  2000-2018 SharpZipLib Contributors
 * URL: https://github.com/icsharpcode/SharpZipLib
 * Purpose: Zip Deflate Algorithm for writing compressed Zips
 *
 * Library: NVorbis
 * License: MIT
 * Copyright: Copyright (c) 2020 Andrew Ward
 * URL: https://github.com/NVorbis/NVorbis
 * Purpose: Vorbis Stream Decoding
 *
 * Library: libvorbis
 * License: BSD-3-Clause
 * Copyright: Copyright (c) 2002-2020 Xiph.org Foundation
 * URL: https://github.com/xiph/vorbis
 * Purpose: NVorbis adopted some code from libvorbis.
 *
 * @preserve
 * @license
 */C.isRunningInWorker?C.initializeWorker():C.isRunningInAudioWorklet?C.initializeAudioWorklet():C.initializeMain(s=>{if(C.webPlatform===Yi.NodeJs)throw new We(Ve.General,"Workers not yet supported in Node.js");if(C.webPlatform===Yi.BrowserModule||C.isWebPackBundled||C.isViteBundled){E.debug("AlphaTab","Creating webworker");try{return new C.alphaTabWorker(new C.alphaTabUrl("./alphaTab.worker.mjs",import.meta.url),{type:"module"})}catch(t){E.debug("AlphaTab","ESM webworker construction with direct URL failed",t)}let e="";try{e=new C.alphaTabUrl("./alphaTab.worker.mjs",import.meta.url);const t=`import ${JSON.stringify(e)}`,i=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(i),{type:"module"})}catch(t){E.debug("AlphaTab","ESM webworker construction with blob import failed",e,t)}try{if(!s.core.scriptFile)throw new Error("Could not detect alphaTab script file");e=s.core.scriptFile;const t=`import ${JSON.stringify(s.core.scriptFile)}`,i=new Blob([t],{type:"application/javascript"});return new Worker(URL.createObjectURL(i),{type:"module"})}catch(t){E.debug("AlphaTab","ESM webworker construction with blob import failed",s.core.scriptFile,t)}}if(!s.core.scriptFile)throw new We(Ve.General,"Could not detect alphaTab script file, cannot initialize renderer");try{E.debug("AlphaTab","Creating Blob worker");const e=`importScripts('${s.core.scriptFile}')`,t=new Blob([e],{type:"application/javascript"});return new Worker(URL.createObjectURL(t))}catch{return E.warning("Rendering","Could not create inline worker, fallback to normal worker"),new Worker(s.core.scriptFile)}},(s,e)=>{if(C.webPlatform===Yi.NodeJs)throw new We(Ve.General,"Audio Worklets not yet supported in Node.js");return C.webPlatform===Yi.BrowserModule||C.isWebPackBundled||C.isViteBundled?(E.debug("AlphaTab","Creating Module worklet"),s.audioWorklet.addModule(new C.alphaTabUrl("./alphaTab.worklet.mjs",import.meta.url))):(E.debug("AlphaTab","Creating Script worklet"),s.audioWorklet.addModule(e.core.scriptFile))});const rE=(s,e)=>{const t=document.getElementById(s);if(!t)return;const i=Bx.createRoot(t),a={...t.dataset};i.render(ml.jsx(E0.StrictMode,{children:ml.jsx(tb,{theme:L_,children:e.map((n,r)=>ml.jsx(n,{...a},r))})}))};export{eE as A,sT as B,J2 as C,D0 as D,tE as E,sE as F,Ul as K,kT as R,aT as _,_B as a,dB as b,DB as c,PB as d,F0 as e,Aa as f,jT as g,j2 as h,lB as i,SB as j,K2 as k,pB as l,Xk as m,iE as n,Q2 as o,gB as p,ml as q,Ae as r,rE as s,Q_ as t,W0 as u,am as v,Dp as w,AB as x,$2 as y,Z2 as z};
