<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qtopie.github.io/tags/ubuntu/"><meta property="og:site_name" content="Blog | qtopierw"><meta property="og:title" content="Ubuntu"><meta property="og:locale" content="en_us"><meta property="og:type" content="website"><title>Ubuntu | Blog | qtopierw</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qtopie.github.io/tags/ubuntu/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.6b0a5247a29534ab597c09c6ba111855ef60594896512109921af15ed6e3e547.js integrity="sha256-awpSR6KVNKtZfAnGuhEYVe9gWUiWUSEJkhrxXtbj5Uc=" crossorigin=anonymous></script><link rel=alternate type=application/rss+xml href=https://qtopie.github.io/tags/ubuntu/index.xml title="Blog | qtopierw"></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Blog | qtopierw</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Ubuntu</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav><ul><li class=book-section-flat><strong>Categories</strong><ul><li class="flex justify-between"><a href=/categories/iot/>Iot</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/tool/>Tool</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/diy/>Diy</a>
<span>5</span></li><li class="flex justify-between"><a href=/categories/development/>Development</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/other/>Other</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/linux/>Linux</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/network/>Network</a>
<span>1</span></li></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/homeassistant/>Homeassistant</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/raspberrypi/>Raspberrypi</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/algorithm/>Algorithm</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/vim/>Vim</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/iot/>Iot</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/cloudcone/>Cloudcone</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/caddy/>Caddy</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/go/>Go</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/eclispe/>Eclispe</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/java/>Java</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/mt7612u/>Mt7612u</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ubuntu/>Ubuntu</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>Latex</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/math/>Math</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/4g-lte/>4G LTE</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/root/>Root</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/vocore/>Vocore</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/git/>Git</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/other/>Other</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/hostapd/>Hostapd</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/hugo/>Hugo</a>
<span>1</span></li></ul></li></ul></nav></aside></header><article class="markdown book-post"><h2><a href=/notes/linux/mt7612u-driver/>Ubuntu下使用MT7612U</a></h2><div class="flex align-center text-small book-post-date"><img src=/svg/calendar.svg class=book-icon alt>
<span>March 9, 2019</span></div><div class=text-small><a href=/tags/ubuntu/>Ubuntu</a>,
<a href=/tags/mt7612u/>Mt7612u</a></div><p><p>由于墙挡住了路由器WIFI信号，虽然5G频率的WIFI传输速率很快，但是信号衰减。WIFI无线通信是双方向的，就算路由信号能覆盖到，但考虑到手机或笔记本功率和天线的限制，难保证信号稳定。所以在淘宝上买了一个功能还算强大的无线网卡ComFast 926AC v2，双频WIFI外置双天线。没提前研究，“号称免驱动"，结果拿回来就懵了。</p><h2 id=安装驱动>安装驱动
<a class=anchor href=#%e5%ae%89%e8%a3%85%e9%a9%b1%e5%8a%a8>#</a></h2><p>设备: Comfast 926AC v2
系统： Ubuntu 18.04</p><p>因为是联发科的芯片，通常都是在同一份驱动代码上改改完成的。故从github上寻找了下面两个仓库的代码。</p><p><a href=https://github.com/ulli-kroll/mt7612u>ulli-kroll/mt7612u</a>, <a href=https://github.com/jurobystricky/Netgear-A6210>jurobystricky/Netgear-A6210</a>
<a href=https://www.mediatek.com/products/broadbandWifi/mt7612u>官方驱动</a></p><p>上面两驱动实际是在官方源码上改写的，但编译后，三个都不能正常工作。</p><p>后来在<code>openwrt/linux</code>项目下发现该设备驱动的相关issue, 并已有大牛正在mt76驱动项目下加入该芯片的支持。故转用mt76的设备。查询linux主仓库代码发现，该驱动已随Linux内核5.0发布。因此直接下载linux 5.0内核包安装就行了。</p><pre tabindex=0><code>  # 5.0: https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.0/
  linux-headers-5.0.0-050000_5.0.0-050000.201903032031_all.deb
  linux-headers-5.0.0-050000-generic_5.0.0-050000.201903032031_amd64.deb
  linux-image-unsigned-5.0.0-050000-generic_5.0.0-050000.201903032031_amd64.deb
  linux-modules-5.0.0-050000-generic_5.0.0-050000.201903032031_amd64.deb
</code></pre><p>手动升级内核后测试能使用, 并支持AP：</p><p>iwconfig</p><pre tabindex=0><code>wlx40a5eff2b655  IEEE 802.11  ESSID:off/any  
          Mode:Managed  Access Point: Not-Associated   Tx-Power=19 dBm   
          Retry short limit:7   RTS thr:off   Fragment thr:off
          Power Management:off
</code></pre><ul><li>网卡识别为存储设备的问题</li></ul><p>mt76还未对这款comfast网卡适配，所以默认会被系统识别为存储设备，可以手动切换过来：</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usb_modeswitch -KW -v 0e8d -p <span style=color:#f60>2870</span>
</span></span></code></pre></div><p>或者修改<code>/lib/udev/rules.d/40-usb_modeswitch.rules</code>文件自动切换（目前未成功）</p><pre tabindex=0><code># MT7612U 
ATTR{idVendor}==&#34;0e8d&#34;, ATTR{idProduct}==&#34;2870&#34;, RUN+=&#34;usb_modeswitch &#39;%b/%k&#39;&#34;
</code></pre><ul><li>USB底座接触不良的问题</li></ul><p>一起买的底座有点问题，开始还以为也要装什么驱动。检查后发现是接触不良的问题，因为USB口没有固定住，所以网卡很容易没有插入到底座中。解决办法比较简单，拆卸底座，然后填充底座中空部分，固定住USB接口。</p><ul><li>其他适配问题</li></ul><p>网卡的LED灯不能正常工作。</p><pre tabindex=0><code>pi@raspberrypi:~ $ sudo ifconfig wlan1 down
pi@raspberrypi:~ $ sudo ifconfig wlan1 hw ether 00:28:C7:0A:42:A2
pi@raspberrypi:~ $ sudo ifconfig wlan1 up
</code></pre><h2 id=尝试在树梅派上编译驱动>尝试在树梅派上编译驱动
<a class=anchor href=#%e5%b0%9d%e8%af%95%e5%9c%a8%e6%a0%91%e6%a2%85%e6%b4%be%e4%b8%8a%e7%bc%96%e8%af%91%e9%a9%b1%e5%8a%a8>#</a></h2><p><del>4.19.y已经加入mt7612u的支持，但是经过测试，并不能使用。</del>[更新] 在5.1.y上编译可以正常使用（STA模式）, 注意默认缺失了<code>/lib/firmware/mt7662.bin /lib/firmware/mt7662_rom_patch.bin</code> 两个文件，可以从其它系统拷贝或网络下载到树梅派。</p><a href=/notes/linux/mt7612u-driver/>...</a></p></article><article class="markdown book-post"><h2><a href=/notes/linux/systemd-service-unit-file/>Ubuntu init process</a></h2><div class="flex align-center text-small book-post-date"><img src=/svg/calendar.svg class=book-icon alt>
<span>September 15, 2016</span></div><div class=text-small><a href=/categories/linux/>Linux</a></div><div class=text-small><a href=/tags/ubuntu/>Ubuntu</a></div><p><h2 id=history>History
<a class=anchor href=#history>#</a></h2><ul><li>sysVinit</li><li><a href=http://upstart.ubuntu.com/>upstart</a></li><li>systemd</li></ul><p>ubuntu: sysVinit &ndash;> upstart(6.10+) &ndash;> systemd (15.04+)</p><h3 id=features-of-upstart>Features of Upstart
<a class=anchor href=#features-of-upstart>#</a></h3><p><em>Event Based</em></p><ul><li>Start System faster (compare with previous method).</li><li>Dynamically start service when discovering new device</li><li>Dynamically stop service when device is removed</li></ul><h2 id=systemd>Systemd
<a class=anchor href=#systemd>#</a></h2><p>Systemd is a collection of system management daemons, utilities and libraries which serves as a replacement of System V init daemon. Systemd functions as
central management and configuration platform for UNIX like system.</p><a href=/notes/linux/systemd-service-unit-file/>...</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav><ul><li class=book-section-flat><strong>Categories</strong><ul><li class="flex justify-between"><a href=/categories/iot/>Iot</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/tool/>Tool</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/diy/>Diy</a>
<span>5</span></li><li class="flex justify-between"><a href=/categories/development/>Development</a>
<span>3</span></li><li class="flex justify-between"><a href=/categories/other/>Other</a>
<span>1</span></li><li class="flex justify-between"><a href=/categories/linux/>Linux</a>
<span>2</span></li><li class="flex justify-between"><a href=/categories/network/>Network</a>
<span>1</span></li></ul></li><li class=book-section-flat><strong>Tags</strong><ul><li class="flex justify-between"><a href=/tags/homeassistant/>Homeassistant</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/raspberrypi/>Raspberrypi</a>
<span>3</span></li><li class="flex justify-between"><a href=/tags/algorithm/>Algorithm</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/vim/>Vim</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/iot/>Iot</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/cloudcone/>Cloudcone</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/caddy/>Caddy</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/go/>Go</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/eclispe/>Eclispe</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/java/>Java</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/mt7612u/>Mt7612u</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/ubuntu/>Ubuntu</a>
<span>2</span></li><li class="flex justify-between"><a href=/tags/latex/>Latex</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/math/>Math</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/4g-lte/>4G LTE</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/android/>Android</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/root/>Root</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/vocore/>Vocore</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/git/>Git</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/other/>Other</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/hostapd/>Hostapd</a>
<span>1</span></li><li class="flex justify-between"><a href=/tags/hugo/>Hugo</a>
<span>1</span></li></ul></li></ul></nav></div></aside></main></body></html>