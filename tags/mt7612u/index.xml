<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Mt7612u on 1001問</title><link>https://qtopie.github.io/tags/mt7612u/</link><description>Recent content in Mt7612u on 1001問</description><generator>Hugo</generator><language>en-us</language><copyright>Posts licensed under &lt;a href="https://creativecommons.org/licenses/by/4.0/legalcode"&gt;CC BY 4.0</copyright><lastBuildDate>Sat, 09 Mar 2019 11:29:38 +0800</lastBuildDate><atom:link href="https://qtopie.github.io/tags/mt7612u/index.xml" rel="self" type="application/rss+xml"/><item><title>Ubuntu下使用MT7612U</title><link>https://qtopie.github.io/notes/linux/mt7612u-driver/</link><pubDate>Sat, 09 Mar 2019 11:29:38 +0800</pubDate><guid>https://qtopie.github.io/notes/linux/mt7612u-driver/</guid><description>&lt;p&gt;由于墙挡住了路由器WIFI信号，虽然5G频率的WIFI传输速率很快，但是信号衰减。WIFI无线通信是双方向的，就算路由信号能覆盖到，但考虑到手机或笔记本功率和天线的限制，难保证信号稳定。所以在淘宝上买了一个功能还算强大的无线网卡ComFast 926AC v2，双频WIFI外置双天线。没提前研究，“号称免驱动&amp;quot;，结果拿回来就懵了。&lt;/p&gt;
&lt;h2 id="安装驱动"&gt;安装驱动&lt;/h2&gt;
&lt;p&gt;设备: Comfast 926AC v2
系统： Ubuntu 18.04&lt;/p&gt;
&lt;p&gt;因为是联发科的芯片，通常都是在同一份驱动代码上改改完成的。故从github上寻找了下面两个仓库的代码。&lt;/p&gt;
&lt;p&gt;&lt;a href="https://github.com/ulli-kroll/mt7612u"&gt;ulli-kroll/mt7612u&lt;/a&gt;, &lt;a href="https://github.com/jurobystricky/Netgear-A6210"&gt;jurobystricky/Netgear-A6210&lt;/a&gt;
&lt;a href="https://www.mediatek.com/products/broadbandWifi/mt7612u"&gt;官方驱动&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;上面两驱动实际是在官方源码上改写的，但编译后，三个都不能正常工作。&lt;/p&gt;
&lt;p&gt;后来在&lt;code&gt;openwrt/linux&lt;/code&gt;项目下发现该设备驱动的相关issue, 并已有大牛正在mt76驱动项目下加入该芯片的支持。故转用mt76的设备。查询linux主仓库代码发现，该驱动已随Linux内核5.0发布。因此直接下载linux 5.0内核包安装就行了。&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; # 5.0: https://kernel.ubuntu.com/~kernel-ppa/mainline/v5.0/
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; linux-headers-5.0.0-050000_5.0.0-050000.201903032031_all.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; linux-headers-5.0.0-050000-generic_5.0.0-050000.201903032031_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; linux-image-unsigned-5.0.0-050000-generic_5.0.0-050000.201903032031_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; linux-modules-5.0.0-050000-generic_5.0.0-050000.201903032031_amd64.deb
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;手动升级内核后测试能使用, 并支持AP：&lt;/p&gt;
&lt;p&gt;iwconfig&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;wlx40a5eff2b655 IEEE 802.11 ESSID:off/any 
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Mode:Managed Access Point: Not-Associated Tx-Power=19 dBm 
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Retry short limit:7 RTS thr:off Fragment thr:off
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt; Power Management:off
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;网卡识别为存储设备的问题&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;mt76还未对这款comfast网卡适配，所以默认会被系统识别为存储设备，可以手动切换过来：&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-bash" data-lang="bash"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;sudo usb_modeswitch -KW -v 0e8d -p &lt;span class="m"&gt;2870&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;或者修改&lt;code&gt;/lib/udev/rules.d/40-usb_modeswitch.rules&lt;/code&gt;文件自动切换（目前未成功）&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" class="chroma"&gt;&lt;code class="language-fallback" data-lang="fallback"&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;# MT7612U 
&lt;/span&gt;&lt;/span&gt;&lt;span class="line"&gt;&lt;span class="cl"&gt;ATTR{idVendor}==&amp;#34;0e8d&amp;#34;, ATTR{idProduct}==&amp;#34;2870&amp;#34;, RUN+=&amp;#34;usb_modeswitch &amp;#39;%b/%k&amp;#39;&amp;#34;
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;ul&gt;
&lt;li&gt;USB底座接触不良的问题&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;一起买的底座有点问题，开始还以为也要装什么驱动。检查后发现是接触不良的问题，因为USB口没有固定住，所以网卡很容易没有插入到底座中。解决办法比较简单，拆卸底座，然后填充底座中空部分，固定住USB接口。&lt;/p&gt;</description></item></channel></rss>