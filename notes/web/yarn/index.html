<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Yarn | 1001問</title><link rel=stylesheet href=/css/main.min.dcb41abaa5ea2698ebf89f814bc6b8060470b6414061437dac2ee0e3ef5d3b45.css integrity="sha256-3LQauqXqJpjr+J+BS8a4BgRwtkFAYUN9rC7g4+9dO0U=" crossorigin=anonymous><link rel=stylesheet href=/css/page.min.81d92e4ce9b8dc4e8a2018a7aee70f76bd7fb6884d929d5fd74e3f959f06e2f5.css integrity="sha256-gdkuTOm43E6KIBinrucPdr1/tohNkp1f104/lZ8G4vU=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.e114b8cc38f57d520f373580c935a518bc6afd6dec4f1d682365cdbcf5c8218a.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=/js/toc.min.87636f25caf644980403a5c1ce8b0812cfd10d1e53c08f181547966799ceccdb.js integrity="sha256-h2NvJcr2RJgEA6XBzosIEs/RDR5TwI8YFUeWZ5nOzNs=" crossorigin=anonymous type=module defer></script><script src=/js/copy-code.min.3bea0de4cfe8670f94a5d75c177f07b58fc90178efdea7f2a21449798d75b2c9.js integrity="sha256-O+oN5M/oZw+UpddcF38HtY/JAXjv3qfyohRJeY11ssk=" crossorigin=anonymous defer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js crossorigin=anonymous referrerpolicy=no-referrer onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})'></script><script src=/js/katex-block.min.2cf531bbcc318aadf5661baa2d0987ab5cb4daef473e108b1da714a37cff0b25.js integrity="sha256-LPUxu8wxiq31ZhuqLQmHq1y02u9HPhCLHacUo3z/CyU=" crossorigin=anonymous defer></script></head><body><header><nav><a href=/><h1>1001問</h1></a><div id=react-search class=search-root aria-label="Site Search"></div></nav></header><main><div class=sidebar><section class=toc><nav id=TableOfContents><ul><li><a href=#安装>安装</a></li><li><a href=#使用>使用</a></li><li><a href=#包下载缓存>包下载缓存</a><ul><li><a href=#构建速度简单比较>构建速度简单比较</a></li><li><a href=#包下载镜像>包下载镜像</a></li></ul></li></ul></nav></section></div><article id=content><div class=metadata><h1>Yarn</h1><time datetime=2020-06-20T22:44:03+08:00>June 20, 2020</time><div class=taxonomy></div></div><p><a href=https://yarnpkg.com/>Yarn</a>是Facebook、Google等主导开发的新的Javascript包管理器。（相对于npm)</p><h2 id=安装><a href=https://yarnpkg.com/getting-started/install>安装</a></h2><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>sudo npm install -g yarn --registry https://registry.npm.taobao.org
</span></span></code></pre></div><p>这里使用了<a href="https://developer.aliyun.com/mirror/NPM?from=tnpm">taobao npm镜像</a></p><ul><li>配置Angular Cli使用yarn</li></ul><p>使用ng命令设置全局使用yarn</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>ng config -g cli.packageManager yarn
</span></span></code></pre></div><h2 id=使用>使用</h2><p>添加依赖</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>yarn add &lt;DEP_NAME&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># dev</span>
</span></span><span style=display:flex><span>yarn add -D &lt;DEP_NAME&gt;
</span></span></code></pre></div><p>参考工具自带帮助文档</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span>yarn --help
</span></span></code></pre></div><h2 id=包下载缓存><a href=https://classic.yarnpkg.com/en/docs/cli/cache/>包下载缓存</a></h2><p>可以通过设置环境变量<code>YARN_CACHE_FOLDER</code>来指定缓存目录</p><p>Ubuntu下修改<code>~/.bashrc</code></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#366>echo</span> <span style=color:#c30>&#39;YARN_CACHE_FOLDER=$HOME/.yarn&#39;</span> &gt;&gt; ~/.bashrc
</span></span></code></pre></div><h3 id=构建速度简单比较>构建速度简单比较</h3><p>使用项目<a href=https://github.com/artificerpi/tour-of-heroes>tour-of-heroes</a>安装nodejs依赖。</p><p>镜像: <a href=https://registry.npm.taobao.org>https://registry.npm.taobao.org</a></p><table><thead><tr><th>NPM (6.14.5)</th><th>Yarn (1.22.4)</th></tr></thead><tbody><tr><td>real 0m26.231s</td><td>real 0m14.048s</td></tr><tr><td>user 0m31.685s</td><td>user 0m15.415s</td></tr><tr><td>sys 0m5.247s</td><td>sys 0m5.666s</td></tr></tbody></table><p>可以看到yarn明显要快一些。
类似于npm安装依赖时创建<code>package-lock.json</code>文件，yarn也会创建<code>yarn.lock</code>文件锁定依赖。（这时安装已有包换registry会不生效)</p><h3 id=包下载镜像>包下载镜像</h3><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#033>SASS_BINARY_SITE</span><span style=color:#555>=</span>https://npm.taobao.org/mirrors/node-sass/
</span></span><span style=display:flex><span><span style=color:#033>PHANTOMJS_CDNURL</span><span style=color:#555>=</span>https://npm.taobao.org/mirrors/phantomjs/
</span></span><span style=display:flex><span><span style=color:#033>ELECTRON_MIRROR</span><span style=color:#555>=</span>https://npm.taobao.org/mirrors/electron/
</span></span></code></pre></div><blockquote><p>可以自己搭建一个镜像，解决内网防火墙内无法下载包的问题</p></blockquote><ul><li>使用Caddy反向代理taobao镜像</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-Caddyfile data-lang=Caddyfile><span style=display:flex><span><span style=color:#030;font-weight:700>:8080</span> {<span style=color:#09f;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>  # https://npm.taobao.org/mirrors/node-sass/
</span></span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>route</span> <span style=color:#99f>/dist/node-sass/*</span> {
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>reverse_proxy</span> <span style=color:#c30>https://cdn.npm.taobao.org</span> {
</span></span><span style=display:flex><span>      <span style=color:#069;font-weight:700>header_up</span> <span style=color:#c30>Host</span> <span style=color:#c30;font-weight:700>{http.reverse_proxy.upstream.hostport}</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }<span style=color:#09f;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>  # https://npm.taobao.org/mirrors/phantomjs/
</span></span></span><span style=display:flex><span>  <span style=color:#069;font-weight:700>reverse_proxy</span> <span style=color:#99f>/dist/phantomjs/*</span> <span style=color:#c30>https://cdn.npm.taobao.org</span> {
</span></span><span style=display:flex><span>    <span style=color:#069;font-weight:700>header_up</span> <span style=color:#c30>Host</span> <span style=color:#c30;font-weight:700>{http.reverse_proxy.upstream.hostport}</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>node-sass 离线安装</li></ul><p>下载地址 <a href=https://github.com/sass/node-sass/releases>https://github.com/sass/node-sass/releases</a></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#09f;font-style:italic># 设置环境变量，注意使用绝对路径</span>
</span></span><span style=display:flex><span><span style=color:#366>export</span> <span style=color:#033>SASS_BINARY_PATH</span><span style=color:#555>=</span>&lt;absolute_path_to_file&gt;
</span></span></code></pre></div><div id=react-single-actions data-post-id=781e42638ba7d0424a16ba3784cafe13></div></article><button class=mobile-toc-trigger aria-controls=mobile-toc aria-expanded=false title=Index>☰</button><div class=mobile-toc-overlay hidden></div><div id=mobile-toc class=mobile-toc-drawer aria-hidden=true role=dialog aria-label=Index><div class=mobile-toc-header><button class=mobile-toc-close aria-label=close>×</button></div><nav class=mobile-toc-body><div class=mobile-toc-list></div></nav><div class=mobile-safe-area-spacer></div></div><script type=module src=/react/page.bundle.js></script></main><footer><div class=copyright><small>Made with <span style=color:#e25555>&#9829;</span> in Guangzhou by
©<a href=https://github.com/qtopie>qtopie</a> 2026
</small><small>Posts licensed under <a href=https://creativecommons.org/licenses/by/4.0/legalcode>CC BY 4.0</small></div><div><script type=module src=/react/base.bundle.js></script></div></footer></body></html>