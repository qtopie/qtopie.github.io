<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Caddy与http3 | 1001問</title><link rel=stylesheet href=/css/main.min.dcb41abaa5ea2698ebf89f814bc6b8060470b6414061437dac2ee0e3ef5d3b45.css integrity="sha256-3LQauqXqJpjr+J+BS8a4BgRwtkFAYUN9rC7g4+9dO0U=" crossorigin=anonymous><link rel=stylesheet href=/css/page.min.81d92e4ce9b8dc4e8a2018a7aee70f76bd7fb6884d929d5fd74e3f959f06e2f5.css integrity="sha256-gdkuTOm43E6KIBinrucPdr1/tohNkp1f104/lZ8G4vU=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.e114b8cc38f57d520f373580c935a518bc6afd6dec4f1d682365cdbcf5c8218a.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=/js/toc.min.87636f25caf644980403a5c1ce8b0812cfd10d1e53c08f181547966799ceccdb.js integrity="sha256-h2NvJcr2RJgEA6XBzosIEs/RDR5TwI8YFUeWZ5nOzNs=" crossorigin=anonymous type=module defer></script><script src=/js/copy-code.min.3bea0de4cfe8670f94a5d75c177f07b58fc90178efdea7f2a21449798d75b2c9.js integrity="sha256-O+oN5M/oZw+UpddcF38HtY/JAXjv3qfyohRJeY11ssk=" crossorigin=anonymous defer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js crossorigin=anonymous referrerpolicy=no-referrer onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})'></script><script src=/js/katex-block.min.2cf531bbcc318aadf5661baa2d0987ab5cb4daef473e108b1da714a37cff0b25.js integrity="sha256-LPUxu8wxiq31ZhuqLQmHq1y02u9HPhCLHacUo3z/CyU=" crossorigin=anonymous defer></script></head><body><header><nav><a href=/><h1>1001問</h1></a><div id=react-search class=search-root aria-label="Site Search"></div></nav></header><main><div class=sidebar><section class=toc><nav id=TableOfContents><ul><li><a href=#caddy-简单介绍>Caddy 简单介绍</a></li><li><a href=#安装使用>安装使用</a></li><li><a href=#常见问题>常见问题</a></li><li><a href=#参考>参考</a></li></ul></nav></section></div><article id=content><div class=metadata><h1>Caddy与http3</h1><time datetime=2020-04-22T00:03:52+08:00>April 22, 2020</time><div class=taxonomy><span id=post-tags><ul><li><strong>Tags</strong>:&nbsp;</li><li class=tag-item><a href=https://qtopie.github.io/tags/caddy><em>caddy</em></a></li></ul></span></div></div><h2 id=caddy-简单介绍>Caddy 简单介绍</h2><p>Caddy是现代化的web代理服务器，使用Go语言编写，不直接依赖系统底层库。
另外，它很好地支持了https (也最先支持了http3), 而且它使用了现代化流行且安全的配置，几乎不需要额外配置。</p><h2 id=安装使用>安装使用</h2><p>我们可以去官网下载2.0版本 <a href=https://caddyserver.com/>https://caddyserver.com/</a> 我们只需要拿到二进制文件即可。</p><p>下载后放到<code>/usr/local/bin/caddy</code>, 然后编辑Caddyfile</p><p>/etc/Caddyfile</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1># debug</span>
</span></span><span class=line><span class=cl>  <span class=n>servers</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>protocol</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	    <span class=n>experimental_http3</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>www</span><span class=o>.</span><span class=n>mwine</span><span class=o>.</span><span class=n>science</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1># redirect www.mwine.science to mwine.science</span>
</span></span><span class=line><span class=cl>	<span class=n>redir</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>mwine</span><span class=o>.</span><span class=n>science</span><span class=p>{</span><span class=n>uri</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>mwine</span><span class=o>.</span><span class=n>science</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>root</span> <span class=o>*</span> <span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>www</span><span class=o>/</span><span class=n>html</span><span class=o>/</span><span class=n>mwine</span><span class=o>.</span><span class=n>science</span>
</span></span><span class=line><span class=cl>	<span class=n>file_server</span>
</span></span><span class=line><span class=cl>	<span class=n>encode</span> <span class=n>zstd</span> <span class=n>gzip</span> 
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><blockquote><p>配置参考 <a href=https://caddyserver.com/docs/caddyfile/options>https://caddyserver.com/docs/caddyfile/options</a></p></blockquote><p>这里我将域名<code>mwine.science</code>和<code>www.mwine.science</code>绑定到了同一台服务器，并将<code>www.mwine.science</code>重定向到<code>mwine.science</code></p><p>然后创建一个文件<code>/var/www/html/mwine.science/index.html</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=cp>&lt;!DOCTYPE html&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  Hello World !
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>body</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>最后运行起来就可以了 （这里我加上了watch选项，启用根据文件配置动态更新）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/usr/local/bin/caddy run -config /etc/Caddyfile -watch
</span></span></code></pre></div><p>或者我们可以将它写成systemd服务，输入命令编辑<code>sudo systemctl edit --force --full caddy.service</code></p><p>粘贴以下内容</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>Unit<span class=o>]</span>                                                                          
</span></span><span class=line><span class=cl><span class=nv>Description</span><span class=o>=</span>Caddy server daemon                                          
</span></span><span class=line><span class=cl><span class=nv>Wants</span><span class=o>=</span>network-online.target
</span></span><span class=line><span class=cl><span class=nv>After</span><span class=o>=</span>network.target network-online.target multi-user.target 
</span></span><span class=line><span class=cl>                                                                                 
</span></span><span class=line><span class=cl><span class=o>[</span>Service<span class=o>]</span>                                                                        
</span></span><span class=line><span class=cl><span class=nv>ExecStart</span><span class=o>=</span>/usr/local/bin/caddy run -config /etc/Caddyfile -watch
</span></span><span class=line><span class=cl><span class=nv>Restart</span><span class=o>=</span>on-failure                                                               
</span></span><span class=line><span class=cl><span class=nv>RestartSec</span><span class=o>=</span><span class=m>30</span>
</span></span><span class=line><span class=cl><span class=nv>TimeoutStopSec</span><span class=o>=</span><span class=m>30</span>
</span></span><span class=line><span class=cl>                                                                                 
</span></span><span class=line><span class=cl><span class=o>[</span>Install<span class=o>]</span>                                                                        
</span></span><span class=line><span class=cl><span class=nv>WantedBy</span><span class=o>=</span>multi-user.target
</span></span></code></pre></div><p>酱紫就完成了, 然后你就有了一个http3的网站！</p><p>这意味着什么？ （薅羊毛）</p><ul><li>http3内置了tls1.3, 所以网站的安全性大大提升了，而且更快（具体可以了解http3协议）</li><li>DNS解析可以使用Cloudflare去实现，毕竟他家宣称有最快的<code>1.1.1.1</code> DNS服务器 (当然还有其他功能呢）</li><li>然后TLS证书哪里来的？ 实际上caddy自动帮你完成了<code>Let's Encrypt</code>证书服务的接入和更新，可以通过日志查看。</li></ul><p>而它们都是免费的！</p><h2 id=常见问题>常见问题</h2><p>Q: Caddy自动生成的证书文件在哪里
A: store certificates
~/.local/share/caddy/certificates/acme-v02.api.letsencrypt.org-directory</p><h2 id=参考>参考</h2><ul><li><a href=https://caddyserver.com/docs/architecture>https://caddyserver.com/docs/architecture</a></li></ul><div id=react-single-actions data-post-id=3514c7fd8446d1cb028b0bc931e69d63></div></article><button class=mobile-toc-trigger aria-controls=mobile-toc aria-expanded=false title=Index>☰</button><div class=mobile-toc-overlay hidden></div><div id=mobile-toc class=mobile-toc-drawer aria-hidden=true role=dialog aria-label=Index><div class=mobile-toc-header><button class=mobile-toc-close aria-label=close>×</button></div><nav class=mobile-toc-body><div class=mobile-toc-list></div></nav><div class=mobile-safe-area-spacer></div></div><script type=module src=/react/page.bundle.js></script></main><footer><div class=copyright><small>Made with <span style=color:#e25555>&#9829;</span> in Guangzhou by
©<a href=https://github.com/qtopie>qtopie</a> 2026
</small><small>Posts licensed under <a href=https://creativecommons.org/licenses/by/4.0/legalcode>CC BY 4.0</small></div><div><script type=module src=/react/base.bundle.js></script></div></footer></body></html>