<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Caddy 简单介绍
  #

Caddy是现代化的web代理服务器，使用Go语言编写，不直接依赖系统底层库。
另外，它很好地支持了https (也最先支持了http3), 而且它使用了现代化流行且安全的配置，几乎不需要额外配置。

  安装使用
  #

我们可以去官网下载2.0版本 https://caddyserver.com/ 我们只需要拿到二进制文件即可。
下载后放到/usr/local/bin/caddy, 然后编辑Caddyfile
/etc/Caddyfile
{
  # debug
  servers {
    protocol {
	    experimental_http3
    }
  }
}

www.mwine.science {
    # redirect www.mwine.science to mwine.science
	redir https://mwine.science{uri}
}

mwine.science {
	root * /var/www/html/mwine.science
	file_server
	encode zstd gzip 
}

配置参考 https://caddyserver.com/docs/caddyfile/options
这里我将域名mwine.science和www.mwine.science绑定到了同一台服务器，并将www.mwine.science重定向到mwine.science
然后创建一个文件/var/www/html/mwine.science/index.html
<!DOCTYPE html>
<html>
<body>
  Hello World !
</body>
</html>
最后运行起来就可以了 （这里我加上了watch选项，启用根据文件配置动态更新）
/usr/local/bin/caddy run -config /etc/Caddyfile -watch
或者我们可以将它写成systemd服务，输入命令编辑sudo systemctl edit --force --full caddy.service"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qtopie.github.io/notes/web/caddy/"><meta property="og:site_name" content="Blog | qtopierw"><meta property="og:title" content="Caddy与http3"><meta property="og:description" content="Caddy 简单介绍 # Caddy是现代化的web代理服务器，使用Go语言编写，不直接依赖系统底层库。 另外，它很好地支持了https (也最先支持了http3), 而且它使用了现代化流行且安全的配置，几乎不需要额外配置。
安装使用 # 我们可以去官网下载2.0版本 https://caddyserver.com/ 我们只需要拿到二进制文件即可。
下载后放到/usr/local/bin/caddy, 然后编辑Caddyfile
/etc/Caddyfile
{ # debug servers { protocol { experimental_http3 } } } www.mwine.science { # redirect www.mwine.science to mwine.science redir https://mwine.science{uri} } mwine.science { root * /var/www/html/mwine.science file_server encode zstd gzip } 配置参考 https://caddyserver.com/docs/caddyfile/options
这里我将域名mwine.science和www.mwine.science绑定到了同一台服务器，并将www.mwine.science重定向到mwine.science
然后创建一个文件/var/www/html/mwine.science/index.html
<!DOCTYPE html> <html> <body> Hello World ! </body> </html> 最后运行起来就可以了 （这里我加上了watch选项，启用根据文件配置动态更新）
/usr/local/bin/caddy run -config /etc/Caddyfile -watch 或者我们可以将它写成systemd服务，输入命令编辑sudo systemctl edit --force --full caddy.service"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2020-04-22T00:03:52+08:00"><meta property="article:modified_time" content="2020-04-22T00:03:52+08:00"><meta property="article:tag" content="Caddy"><title>Caddy与http3 | Blog | qtopierw</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qtopie.github.io/notes/web/caddy/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.6b0a5247a29534ab597c09c6ba111855ef60594896512109921af15ed6e3e547.js integrity="sha256-awpSR6KVNKtZfAnGuhEYVe9gWUiWUSEJkhrxXtbj5Uc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Blog | qtopierw</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Caddy与http3</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#caddy-简单介绍>Caddy 简单介绍</a></li><li><a href=#安装使用>安装使用</a></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=caddy-简单介绍>Caddy 简单介绍
<a class=anchor href=#caddy-%e7%ae%80%e5%8d%95%e4%bb%8b%e7%bb%8d>#</a></h2><p>Caddy是现代化的web代理服务器，使用Go语言编写，不直接依赖系统底层库。
另外，它很好地支持了https (也最先支持了http3), 而且它使用了现代化流行且安全的配置，几乎不需要额外配置。</p><h2 id=安装使用>安装使用
<a class=anchor href=#%e5%ae%89%e8%a3%85%e4%bd%bf%e7%94%a8>#</a></h2><p>我们可以去官网下载2.0版本 <a href=https://caddyserver.com/>https://caddyserver.com/</a> 我们只需要拿到二进制文件即可。</p><p>下载后放到<code>/usr/local/bin/caddy</code>, 然后编辑Caddyfile</p><p>/etc/Caddyfile</p><pre tabindex=0><code>{
  # debug
  servers {
    protocol {
	    experimental_http3
    }
  }
}

www.mwine.science {
    # redirect www.mwine.science to mwine.science
	redir https://mwine.science{uri}
}

mwine.science {
	root * /var/www/html/mwine.science
	file_server
	encode zstd gzip 
}
</code></pre><blockquote><p>配置参考 <a href=https://caddyserver.com/docs/caddyfile/options>https://caddyserver.com/docs/caddyfile/options</a></p></blockquote><p>这里我将域名<code>mwine.science</code>和<code>www.mwine.science</code>绑定到了同一台服务器，并将<code>www.mwine.science</code>重定向到<code>mwine.science</code></p><p>然后创建一个文件<code>/var/www/html/mwine.science/index.html</code></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#099>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#309;font-weight:700>html</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#309;font-weight:700>body</span>&gt;
</span></span><span style=display:flex><span>  Hello World !
</span></span><span style=display:flex><span>&lt;/<span style=color:#309;font-weight:700>body</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#309;font-weight:700>html</span>&gt;
</span></span></code></pre></div><p>最后运行起来就可以了 （这里我加上了watch选项，启用根据文件配置动态更新）</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>/usr/local/bin/caddy run -config /etc/Caddyfile -watch
</span></span></code></pre></div><p>或者我们可以将它写成systemd服务，输入命令编辑<code>sudo systemctl edit --force --full caddy.service</code></p><p>粘贴以下内容</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#555>[</span>Unit<span style=color:#555>]</span>                                                                          
</span></span><span style=display:flex><span><span style=color:#033>Description</span><span style=color:#555>=</span>Caddy server daemon                                          
</span></span><span style=display:flex><span><span style=color:#033>Wants</span><span style=color:#555>=</span>network-online.target
</span></span><span style=display:flex><span><span style=color:#033>After</span><span style=color:#555>=</span>network.target network-online.target multi-user.target 
</span></span><span style=display:flex><span>                                                                                 
</span></span><span style=display:flex><span><span style=color:#555>[</span>Service<span style=color:#555>]</span>                                                                        
</span></span><span style=display:flex><span><span style=color:#033>ExecStart</span><span style=color:#555>=</span>/usr/local/bin/caddy run -config /etc/Caddyfile -watch
</span></span><span style=display:flex><span><span style=color:#033>Restart</span><span style=color:#555>=</span>on-failure                                                               
</span></span><span style=display:flex><span><span style=color:#033>RestartSec</span><span style=color:#555>=</span><span style=color:#f60>30</span>
</span></span><span style=display:flex><span><span style=color:#033>TimeoutStopSec</span><span style=color:#555>=</span><span style=color:#f60>30</span>
</span></span><span style=display:flex><span>                                                                                 
</span></span><span style=display:flex><span><span style=color:#555>[</span>Install<span style=color:#555>]</span>                                                                        
</span></span><span style=display:flex><span><span style=color:#033>WantedBy</span><span style=color:#555>=</span>multi-user.target
</span></span></code></pre></div><p>酱紫就完成了, 然后你就有了一个http3的网站！</p><p>这意味着什么？ （薅羊毛）</p><ul><li>http3内置了tls1.3, 所以网站的安全性大大提升了，而且更快（具体可以了解http3协议）</li><li>DNS解析可以使用Cloudflare去实现，毕竟他家宣称有最快的<code>1.1.1.1</code> DNS服务器 (当然还有其他功能呢）</li><li>然后TLS证书哪里来的？ 实际上caddy自动帮你完成了<code>Let's Encrypt</code>证书服务的接入和更新，可以通过日志查看。</li></ul><p>而它们都是免费的！</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#caddy-简单介绍>Caddy 简单介绍</a></li><li><a href=#安装使用>安装使用</a></li></ul></nav></div></aside></main></body></html>