<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  线程的状态
  #

参考定义 java.lang.Thread.State
public enum State {
    /**
     * Thread state for a thread which has not yet started.
     */
    NEW,

    /**
     * Thread state for a runnable thread.  A thread in the runnable
     * state is executing in the Java virtual machine but it may
     * be waiting for other resources from the operating system
     * such as processor.
     */
    RUNNABLE,

    /**
     * Thread state for a thread blocked waiting for a monitor lock.
     * A thread in the blocked state is waiting for a monitor lock
     * to enter a synchronized block/method or
     * reenter a synchronized block/method after calling
     * {@link Object#wait() Object.wait}.
     */
    BLOCKED,

    /**
     * Thread state for a waiting thread.
     * A thread is in the waiting state due to calling one of the
     * following methods:
     * <ul>
     *   <li>{@link Object#wait() Object.wait} with no timeout</li>
     *   <li>{@link #join() Thread.join} with no timeout</li>
     *   <li>{@link LockSupport#park() LockSupport.park}</li>
     * </ul>
     *
     * <p>A thread in the waiting state is waiting for another thread to
     * perform a particular action.
     *
     * For example, a thread that has called {@code Object.wait()}
     * on an object is waiting for another thread to call
     * {@code Object.notify()} or {@code Object.notifyAll()} on
     * that object. A thread that has called {@code Thread.join()}
     * is waiting for a specified thread to terminate.
     */
    WAITING,

    /**
     * Thread state for a waiting thread with a specified waiting time.
     * A thread is in the timed waiting state due to calling one of
     * the following methods with a specified positive waiting time:
     * <ul>
     *   <li>{@link #sleep Thread.sleep}</li>
     *   <li>{@link Object#wait(long) Object.wait} with timeout</li>
     *   <li>{@link #join(long) Thread.join} with timeout</li>
     *   <li>{@link LockSupport#parkNanos LockSupport.parkNanos}</li>
     *   <li>{@link LockSupport#parkUntil LockSupport.parkUntil}</li>
     * </ul>
     */
    TIMED_WAITING,

    /**
     * Thread state for a terminated thread.
     * The thread has completed execution.
     */
    TERMINATED;
}
stateDiagram
    [*] --> New
    New --> Runnable : start()
    Runnable --> Blocked : acquire monitor lock
    Runnable --> Waiting : wait(), join(), park()
    Runnable --> Timed Waiting : wait(timeout), join(timeout), parkNanos(timeout)
    Blocked --> Runnable : obtain monitor lock
    Waiting --> Runnable : signaled or interrupted
    Timed Waiting --> Runnable : time elapses
    Runnable --> Terminated : run() completes

  waiting vs blocked
  #

blocked: 线程试图获取一个被其他线程持有的锁（monitor），但获取失败，导致线程被阻塞 被动进入 blocked 状态的"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qtopie.github.io/notes/java/thread/"><meta property="og:site_name" content="Blog | qtopierw"><meta property="og:title" content="JVM线程分析"><meta property="og:description" content="线程的状态 # 参考定义 java.lang.Thread.State
public enum State { /** * Thread state for a thread which has not yet started. */ NEW, /** * Thread state for a runnable thread. A thread in the runnable * state is executing in the Java virtual machine but it may * be waiting for other resources from the operating system * such as processor. */ RUNNABLE, /** * Thread state for a thread blocked waiting for a monitor lock. * A thread in the blocked state is waiting for a monitor lock * to enter a synchronized block/method or * reenter a synchronized block/method after calling * {@link Object#wait() Object.wait}. */ BLOCKED, /** * Thread state for a waiting thread. * A thread is in the waiting state due to calling one of the * following methods: * <ul> * <li>{@link Object#wait() Object.wait} with no timeout</li> * <li>{@link #join() Thread.join} with no timeout</li> * <li>{@link LockSupport#park() LockSupport.park}</li> * </ul> * * <p>A thread in the waiting state is waiting for another thread to * perform a particular action. * * For example, a thread that has called {@code Object.wait()} * on an object is waiting for another thread to call * {@code Object.notify()} or {@code Object.notifyAll()} on * that object. A thread that has called {@code Thread.join()} * is waiting for a specified thread to terminate. */ WAITING, /** * Thread state for a waiting thread with a specified waiting time. * A thread is in the timed waiting state due to calling one of * the following methods with a specified positive waiting time: * <ul> * <li>{@link #sleep Thread.sleep}</li> * <li>{@link Object#wait(long) Object.wait} with timeout</li> * <li>{@link #join(long) Thread.join} with timeout</li> * <li>{@link LockSupport#parkNanos LockSupport.parkNanos}</li> * <li>{@link LockSupport#parkUntil LockSupport.parkUntil}</li> * </ul> */ TIMED_WAITING, /** * Thread state for a terminated thread. * The thread has completed execution. */ TERMINATED; } stateDiagram [*] --> New New --> Runnable : start() Runnable --> Blocked : acquire monitor lock Runnable --> Waiting : wait(), join(), park() Runnable --> Timed Waiting : wait(timeout), join(timeout), parkNanos(timeout) Blocked --> Runnable : obtain monitor lock Waiting --> Runnable : signaled or interrupted Timed Waiting --> Runnable : time elapses Runnable --> Terminated : run() completes waiting vs blocked # blocked: 线程试图获取一个被其他线程持有的锁（monitor），但获取失败，导致线程被阻塞 被动进入 blocked 状态的"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2024-09-11T00:00:00+00:00"><meta property="article:modified_time" content="2024-09-11T00:00:00+00:00"><title>JVM线程分析 | Blog | qtopierw</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qtopie.github.io/notes/java/thread/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.d068e298764bebd377892ee728ef88919a2ae62519b35fcd4c9bc8f4f911fc7d.js integrity="sha256-0GjimHZL69N3iS7nKO+IkZoq5iUZs1/NTJvI9PkR/H0=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Blog | qtopierw</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>JVM线程分析</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#线程的状态>线程的状态</a><ul><li><a href=#waiting-vs-blocked>waiting vs blocked</a></li></ul></li><li><a href=#线程池>线程池</a></li><li><a href=#查看线程的状态>查看线程的状态</a></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=线程的状态>线程的状态
<a class=anchor href=#%e7%ba%bf%e7%a8%8b%e7%9a%84%e7%8a%b6%e6%80%81>#</a></h2><p>参考定义 <code>java.lang.Thread.State</code></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#069;font-weight:700>public</span><span style=color:#bbb> </span><span style=color:#069;font-weight:700>enum</span><span style=color:#bbb> </span>State<span style=color:#bbb> </span>{<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * Thread state for a thread which has not yet started.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     */</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>NEW,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * Thread state for a runnable thread.  A thread in the runnable
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * state is executing in the Java virtual machine but it may
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * be waiting for other resources from the operating system
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * such as processor.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     */</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>RUNNABLE,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * Thread state for a thread blocked waiting for a monitor lock.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * A thread in the blocked state is waiting for a monitor lock
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * to enter a synchronized block/method or
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * reenter a synchronized block/method after calling
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * {@link Object#wait() Object.wait}.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     */</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>BLOCKED,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * Thread state for a waiting thread.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * A thread is in the waiting state due to calling one of the
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * following methods:
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * &lt;ul&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *   &lt;li&gt;{@link Object#wait() Object.wait} with no timeout&lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *   &lt;li&gt;{@link #join() Thread.join} with no timeout&lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *   &lt;li&gt;{@link LockSupport#park() LockSupport.park}&lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * &lt;/ul&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * &lt;p&gt;A thread in the waiting state is waiting for another thread to
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * perform a particular action.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * For example, a thread that has called {@code Object.wait()}
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * on an object is waiting for another thread to call
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * {@code Object.notify()} or {@code Object.notifyAll()} on
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * that object. A thread that has called {@code Thread.join()}
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * is waiting for a specified thread to terminate.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     */</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>WAITING,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * Thread state for a waiting thread with a specified waiting time.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * A thread is in the timed waiting state due to calling one of
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * the following methods with a specified positive waiting time:
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * &lt;ul&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *   &lt;li&gt;{@link #sleep Thread.sleep}&lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *   &lt;li&gt;{@link Object#wait(long) Object.wait} with timeout&lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *   &lt;li&gt;{@link #join(long) Thread.join} with timeout&lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *   &lt;li&gt;{@link LockSupport#parkNanos LockSupport.parkNanos}&lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     *   &lt;li&gt;{@link LockSupport#parkUntil LockSupport.parkUntil}&lt;/li&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * &lt;/ul&gt;
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     */</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>TIMED_WAITING,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#09f;font-style:italic>/**
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * Thread state for a terminated thread.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     * The thread has completed execution.
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic>     */</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>TERMINATED;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>}<span style=color:#bbb>
</span></span></span></code></pre></div><pre tabindex=0><code class=language-mermaid data-lang=mermaid>stateDiagram
    [*] --&gt; New
    New --&gt; Runnable : start()
    Runnable --&gt; Blocked : acquire monitor lock
    Runnable --&gt; Waiting : wait(), join(), park()
    Runnable --&gt; Timed Waiting : wait(timeout), join(timeout), parkNanos(timeout)
    Blocked --&gt; Runnable : obtain monitor lock
    Waiting --&gt; Runnable : signaled or interrupted
    Timed Waiting --&gt; Runnable : time elapses
    Runnable --&gt; Terminated : run() completes
</code></pre><h3 id=waiting-vs-blocked>waiting vs blocked
<a class=anchor href=#waiting-vs-blocked>#</a></h3><p>blocked: 线程试图获取一个被其他线程持有的锁（monitor），但获取失败，导致线程被阻塞 被动进入 blocked 状态的</p><p>waiting: 线程主动调用了方法进入等待状态，等待其他线程的通知 (wait condition)</p><h2 id=线程池>线程池
<a class=anchor href=#%e7%ba%bf%e7%a8%8b%e6%b1%a0>#</a></h2><h2 id=查看线程的状态>查看线程的状态
<a class=anchor href=#%e6%9f%a5%e7%9c%8b%e7%ba%bf%e7%a8%8b%e7%9a%84%e7%8a%b6%e6%80%81>#</a></h2><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>jstack -l
</span></span></code></pre></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#线程的状态>线程的状态</a><ul><li><a href=#waiting-vs-blocked>waiting vs blocked</a></li></ul></li><li><a href=#线程池>线程池</a></li><li><a href=#查看线程的状态>查看线程的状态</a></li></ul></nav></div></aside></main></body></html>