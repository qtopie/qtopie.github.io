<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>树莓派4G模块 | 1001問</title><link rel=stylesheet href=/css/main.min.194caa9c1bc917dfa8a85f5f1f9061c52cd72509dc9f189142b69308127558b3.css integrity="sha256-GUyqnBvJF9+oqF9fH5BhxSzXJQncnxiRQraTCBJ1WLM=" crossorigin=anonymous><link rel=stylesheet href=/css/page.min.81d92e4ce9b8dc4e8a2018a7aee70f76bd7fb6884d929d5fd74e3f959f06e2f5.css integrity="sha256-gdkuTOm43E6KIBinrucPdr1/tohNkp1f104/lZ8G4vU=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.e114b8cc38f57d520f373580c935a518bc6afd6dec4f1d682365cdbcf5c8218a.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=/js/toc.min.87636f25caf644980403a5c1ce8b0812cfd10d1e53c08f181547966799ceccdb.js integrity="sha256-h2NvJcr2RJgEA6XBzosIEs/RDR5TwI8YFUeWZ5nOzNs=" crossorigin=anonymous type=module defer></script><script src=/js/copy-code.min.3bea0de4cfe8670f94a5d75c177f07b58fc90178efdea7f2a21449798d75b2c9.js integrity="sha256-O+oN5M/oZw+UpddcF38HtY/JAXjv3qfyohRJeY11ssk=" crossorigin=anonymous defer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js crossorigin=anonymous referrerpolicy=no-referrer onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})'></script><script src=/js/katex-block.min.2cf531bbcc318aadf5661baa2d0987ab5cb4daef473e108b1da714a37cff0b25.js integrity="sha256-LPUxu8wxiq31ZhuqLQmHq1y02u9HPhCLHacUo3z/CyU=" crossorigin=anonymous defer></script></head><body><header><nav><a href=/><h1>1001問</h1></a><div id=react-search class=search-root aria-label="Site Search"></div></nav></header><main><div class=sidebar><section class=toc><nav id=TableOfContents><ul><li><a href=#准备环境>准备环境</a></li><li><a href=#4g模块技术规格及文档>4G模块技术规格及文档</a></li><li><a href=#开始使用>开始使用</a></li><li><a href=#优化配置>优化配置</a><ul><li><a href=#解决等待输入命令的问题----carrier-detected--waiting-for-prompt>解决等待输入命令的问题 <code>--> Carrier detected. Waiting for prompt.</code></a></li><li><a href=#ap和以太网路由设置>AP和以太网路由设置</a></li><li><a href=#便携式4g-lte>便携式4G LTE</a></li></ul></li><li><a href=#参考>参考</a></li></ul></nav></section></div><article id=content><div class=metadata><h1>树莓派4G模块</h1><time datetime=2018-12-05T22:36:06+08:00>December 5, 2018</time><div class=taxonomy><span id=post-categories><ul><li><strong>Categories</strong>:&nbsp;</li><li class=category-item><a href=https://qtopie.github.io/categories/diy>diy</a></li></ul></span><span id=post-tags><ul><li><strong>Tags</strong>:&nbsp;</li><li class=tag-item><a href=https://qtopie.github.io/tags/raspberrypi><em>raspberrypi</em></a></li><li class=tag-item><a href=https://qtopie.github.io/tags/4g-lte><em>4G LTE</em></a></li></ul></span></div></div><h2 id=准备环境>准备环境</h2><ul><li>树莓派3B</li><li>华为4G模块：HUAWEI ME909s-821</li><li>PCIE转USB开发板</li><li>5cm天线转接线，SMA公头外螺内孔</li><li>吸盘天线全向高增益天线，SMA公头外螺内孔</li><li>中国移动4G SIM卡</li></ul><h2 id=4g模块技术规格及文档>4G模块技术规格及文档</h2><ul><li>技术规格 <a href=http://consumer.huawei.com/solutions/m2m-solutions/en/products/tech-specs/me909s_821_en.htm>连接</a></li></ul><p>基于海思芯片, 同类比较 SIM7600CE (Qualcomm MDM9206)</p><ul><li>文档 <a href="http://download-c1.huawei.com/download/downloadCenter?downloadId=60305&amp;version=200311&amp;siteCode=worldwide&amp;view=true">连接</a></li></ul><p>主天线M口</p><h2 id=开始使用>开始使用</h2><p><em>Windows上使用该4G模块需要手动安装驱动，驱动<a href=https://techship.com/downloads/category/software-software-huawei-me909s-821-lga/>连接</a></em></p><p><em>Ubuntu下可以使用<code>modemmanager</code>管理4G模块</em></p><p>树莓派下使用教程如下。</p><ul><li>查看usb设备是否被识别</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>lsusb
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># output:</span>
</span></span><span class=line><span class=cl>Bus <span class=m>001</span> Device 004: ID 12d1:15c1 Huawei Technologies Co., Ltd. 
</span></span><span class=line><span class=cl>Bus <span class=m>001</span> Device 003: ID 0424:ec00 Standard Microsystems Corp. SMSC9512/9514 Fast Ethernet Adapter
</span></span><span class=line><span class=cl>Bus <span class=m>001</span> Device 002: ID 0424:9514 Standard Microsystems Corp. SMC9514 Hub
</span></span><span class=line><span class=cl>Bus <span class=m>001</span> Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub
</span></span></code></pre></div><ul><li>安装拨号软件</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get install ppp usb-modeswitch wvdial
</span></span></code></pre></div><ul><li>初始化wvdial配置</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo wvdialconf /etc/wvdial.conf
</span></span></code></pre></div><ul><li>修改<code>wvdial</code>配置</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[Dialer Defaults]
</span></span><span class=line><span class=cl>Init1 = ATZ
</span></span><span class=line><span class=cl>Init2 = ATQ0 V1 E1 S0=0
</span></span><span class=line><span class=cl>Init3 = AT+CGDCONT=1,&#34;IP&#34;, &#34;cmnet&#34;
</span></span><span class=line><span class=cl>Modem Type = Analog Modem
</span></span><span class=line><span class=cl>Baud = 9600
</span></span><span class=line><span class=cl>New PPPD = yes
</span></span><span class=line><span class=cl>Modem = /dev/ttyUSB0
</span></span><span class=line><span class=cl>ISDN = 0
</span></span><span class=line><span class=cl>Phone = *99***1#
</span></span><span class=line><span class=cl>Password = { }
</span></span><span class=line><span class=cl>Username = { }
</span></span><span class=line><span class=cl>Auto DNS = on
</span></span></code></pre></div><p>APN和拨号设置参考</p><table><thead><tr><th>国内运营商</th><th>APN</th><th>拨号</th></tr></thead><tbody><tr><td>移动</td><td>at+cgdcont=1,&ldquo;ip&rdquo;,&ldquo;cmnet&rdquo;</td><td><code>*99***1#</code>或<code>*98*1#</code></td></tr><tr><td>联通</td><td>at+cgdcont=1,&ldquo;ip&rdquo;,&ldquo;3gnet&rdquo;</td><td><code>*99#</code></td></tr><tr><td>电信</td><td>at+cgdcont=1,&ldquo;ip&rdquo;,&ldquo;ctnet&rdquo;</td><td><code>#777</code></td></tr></tbody></table><ul><li>开始拨号</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>pi@raspberrypi:~ $ sudo wvdial
</span></span><span class=line><span class=cl>--&gt; WvDial: Internet dialer version 1.61
</span></span><span class=line><span class=cl>--&gt; Initializing modem.
</span></span><span class=line><span class=cl>--&gt; Sending: ATZ
</span></span><span class=line><span class=cl>^S
</span></span><span class=line><span class=cl>+23806F8RE
</span></span><span class=line><span class=cl>2C
</span></span><span class=line><span class=cl>,
</span></span><span class=line><span class=cl>^2/
</span></span><span class=line><span class=cl>ATZ
</span></span><span class=line><span class=cl>OK
</span></span><span class=line><span class=cl>--&gt; Sending: ATQ0 V1 E1 S0=0
</span></span><span class=line><span class=cl>ATQ0 V1 E1 S0=0
</span></span><span class=line><span class=cl>OK
</span></span><span class=line><span class=cl>--&gt; Sending: AT+CGDCONT=1,&#34;IP&#34;, &#34;cmnet&#34;
</span></span><span class=line><span class=cl>AT+CGDCONT=1,&#34;IP&#34;, &#34;cmnet&#34;
</span></span><span class=line><span class=cl>OK
</span></span><span class=line><span class=cl>--&gt; Modem initialized.
</span></span><span class=line><span class=cl>--&gt; Sending: ATDT*99***1#
</span></span><span class=line><span class=cl>--&gt; Waiting for carrier.
</span></span><span class=line><span class=cl>ATDT*99***1#
</span></span><span class=line><span class=cl>CONNECT 150000000
</span></span><span class=line><span class=cl>--&gt; Carrier detected.  Waiting for prompt.
</span></span><span class=line><span class=cl>--&gt; Don&#39;t know what to do!  Starting pppd and hoping for the best.
</span></span><span class=line><span class=cl>--&gt; Starting pppd at Tue Nov 27 22:14:54 2018
</span></span><span class=line><span class=cl>--&gt; Pid of pppd: 1690
</span></span><span class=line><span class=cl>--&gt; Using interface ppp0
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span><span class=line><span class=cl>--&gt; local  IP address 10.50.126.214
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span><span class=line><span class=cl>--&gt; remote IP address 10.64.64.64
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span><span class=line><span class=cl>--&gt; primary   DNS address 221.179.38.7
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span><span class=line><span class=cl>--&gt; secondary DNS address 120.196.165.7
</span></span><span class=line><span class=cl>--&gt; pppd: �`�[01]�W�[01]
</span></span></code></pre></div><ul><li>打开另一个窗口测试网络</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl https://www.raspberrypi.org/
</span></span></code></pre></div><ul><li>查看信号质量</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat /dev/ttyUSB0 <span class=p>&amp;</span>  <span class=nb>echo</span> -e <span class=s2>&#34;AT+CSQ\r\n&#34;</span> &gt; /dev/ttyUSB0
</span></span></code></pre></div><p>AT+CSQ语法</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>命令解释：检查网络信号强度
</span></span><span class=line><span class=cl>命令格式：AT+CSQ&lt;CR&gt;
</span></span><span class=line><span class=cl>命令返回：+CSQ:  **, ##           
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>其中：
</span></span><span class=line><span class=cl>**应在 0 到 31 之间（99表示无信号），数值越大表明信号质量越好；
</span></span><span class=line><span class=cl>##为误码率，值在 0 到 99 之间。否则应检查天线或 SIM 卡是否正确安装
</span></span></code></pre></div><p>计算公式：信号强度 = -113dBm + (rssi * 2)</p><p>测试结果：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>AT+CSQ&lt;CR&gt;
</span></span><span class=line><span class=cl>+CSQ: 31, 99
</span></span></code></pre></div><h2 id=优化配置>优化配置</h2><h3 id=解决等待输入命令的问题----carrier-detected--waiting-for-prompt>解决等待输入命令的问题 <code>--> Carrier detected. Waiting for prompt.</code></h3><p>Systemd Service Unit文件</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>Unit</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Description</span><span class=o>=</span><span class=mi>4</span><span class=n>G</span> <span class=n>LTE</span> <span class=n>Modem</span> <span class=n>daemon</span>
</span></span><span class=line><span class=cl><span class=n>After</span><span class=o>=</span><span class=n>multi</span><span class=o>-</span><span class=n>user</span><span class=o>.</span><span class=n>target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Service</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>ExecStart</span><span class=o>=/</span><span class=n>usr</span><span class=o>/</span><span class=n>bin</span><span class=o>/</span><span class=n>wvdial</span> <span class=o>--</span><span class=n>config</span> <span class=o>/</span><span class=n>etc</span><span class=o>/</span><span class=n>wvdial</span><span class=o>.</span><span class=n>conf</span>
</span></span><span class=line><span class=cl><span class=n>PIDFile</span><span class=o>=/</span><span class=k>var</span><span class=o>/</span><span class=n>run</span><span class=o>/</span><span class=n>lte</span><span class=o>-</span><span class=n>modem</span><span class=o>.</span><span class=n>pid</span>
</span></span><span class=line><span class=cl><span class=n>KillMode</span><span class=o>=</span><span class=n>process</span>
</span></span><span class=line><span class=cl><span class=n>Restart</span><span class=o>=</span><span class=n>on</span><span class=o>-</span><span class=n>failure</span>
</span></span><span class=line><span class=cl><span class=n>RestartSec</span><span class=o>=</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=n>Install</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>WantedBy</span><span class=o>=</span><span class=n>multi</span><span class=o>-</span><span class=n>user</span><span class=o>.</span><span class=n>target</span>
</span></span></code></pre></div><p>在<code>/etc/wvdial.conf</code>中加入<code>Stupid Mode = on</code>选项，参考<a href="https://ubuntuforums.org/showthread.php?t=930610">这里</a>。</p><h3 id=ap和以太网路由设置>AP和以太网路由设置</h3><p>AP参考之前的文章，这里主要说以太网路由 (LTE -> 以太网接口)</p><ul><li>设置eth0为静态IP</li></ul><p>方式1：</p><p>设置静态IP</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># vim /etc/network/interfaces.d/eth0</span>
</span></span><span class=line><span class=cl>auto eth0
</span></span><span class=line><span class=cl>allow hot-plug eth0
</span></span><span class=line><span class=cl>iface eth0 inet static
</span></span><span class=line><span class=cl>    address 172.24.1.1
</span></span><span class=line><span class=cl>    netmask 255.255.255.0
</span></span><span class=line><span class=cl>    gateway 172.24.1.1
</span></span></code></pre></div><p>修改dhcpcd管理eth0</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;denyinterfaces eth0&#34;</span> &gt;&gt; /etc/dhcpcd.conf
</span></span></code></pre></div><p>方式2：（动态配置，推荐）</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ifconfig eth0 172.24.1.1 netmask 255.255.255.0 broadcast 172.24.1.1
</span></span></code></pre></div><ul><li>配置dnsmasq作为dhcp服务器</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># vim /etc/dnsmasq.d/dnsmasq-eth0.conf</span>
</span></span><span class=line><span class=cl><span class=nv>interface</span><span class=o>=</span>eth0
</span></span><span class=line><span class=cl>listen-address<span class=o>=</span>172.24.1.1
</span></span><span class=line><span class=cl>bind-interfaces
</span></span><span class=line><span class=cl><span class=nv>server</span><span class=o>=</span>8.8.8.8
</span></span><span class=line><span class=cl>domain-needed
</span></span><span class=line><span class=cl>bogus-priv
</span></span><span class=line><span class=cl>dhcp-range<span class=o>=</span>172.24.1.2,172.24.1.50,12h
</span></span></code></pre></div><p>动态配置</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dnsmasq --interface<span class=o>=</span>eth0 --except-interface<span class=o>=</span>wlan0 --bind-interfaces --conf-file<span class=o>=</span>/dev/null --dhcp-range<span class=o>=</span>172.24.1.2,172.24.1.100,12h
</span></span></code></pre></div><ul><li>iptables规则</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 增加</span>
</span></span><span class=line><span class=cl><span class=c1>#iptables -t nat -A POSTROUTING -o ppp0 -j MASQUERADE                            </span>
</span></span><span class=line><span class=cl>iptables -A FORWARD -i ppp0 -o eth0 -m state --state RELATED,ESTABLISHED -j ACCEPT  
</span></span><span class=line><span class=cl>iptables -A FORWARD -i eth0 -o ppp0 -j ACCEPT
</span></span></code></pre></div><h3 id=便携式4g-lte>便携式4G LTE</h3><p>几年前入手了一个4G modem, 外观同这个 <a href="http://vonger.cn/?p=14785">http://vonger.cn/?p=14785</a></p><p>在openwrt上没有成功，USB设备驱动无法被识别， 在笔记本 Ubuntu上成功使用，脚本(参考了这里https://github.com/gartfr/QualcommLTE)</p><p>使用如下脚本启动成功</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=o>[</span> ! <span class=s2>&#34;</span><span class=k>$(</span>lsusb -d <span class=s1>&#39;161c:f010&#39;</span><span class=k>)</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span> <span class=nb>printf</span> <span class=s2>&#34;usb not plugged\n&#34;</span> <span class=p>;</span> <span class=k>fi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># switch from mass storage to modem devices</span>
</span></span><span class=line><span class=cl>sudo usb_modeswitch -v 161c -p f010 -W -M 55534243123456780000000000000606f50402527000000000000000000000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo modprobe qmi_wwan
</span></span><span class=line><span class=cl>sudo bash -c <span class=s1>&#39;echo &#34;161c f101&#34; &gt; /sys/bus/usb/drivers/qmi_wwan/new_id&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sleep <span class=m>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>BUS_ID</span><span class=o>=</span><span class=k>$(</span>lsusb -d <span class=s1>&#39;161c:f101&#39;</span> <span class=p>|</span> cut -d <span class=s1>&#39; &#39;</span> -f2 <span class=p>|</span> tr -d 0<span class=k>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>FIRST_PORT_ID</span><span class=o>=</span><span class=k>$(</span>ls  /sys/bus/usb/drivers/qmi_wwan/ <span class=p>|</span> grep <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUS_ID</span><span class=si>}</span><span class=s2>-*.0&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>SECOND_PORT_ID</span><span class=o>=</span><span class=k>$(</span>ls  /sys/bus/usb/drivers/qmi_wwan/ <span class=p>|</span> grep <span class=s2>&#34;</span><span class=si>${</span><span class=nv>BUS_ID</span><span class=si>}</span><span class=s2>-*.1&#34;</span><span class=k>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=c1># 这里usb ID通过dmesg或`lsusb -t`查看， 先禁用在启用1.1是因为默认无法正确加载驱动</span>
</span></span><span class=line><span class=cl>sudo bash -c <span class=s2>&#34;echo &#39;</span><span class=si>${</span><span class=nv>FIRST_PORT_ID</span><span class=si>}</span><span class=s2>&#39; &gt; /sys/bus/usb/drivers/qmi_wwan/unbind&#34;</span>
</span></span><span class=line><span class=cl>sudo bash -c <span class=s2>&#34;echo &#39;</span><span class=si>${</span><span class=nv>SECOND_PORT_ID</span><span class=si>}</span><span class=s2>&#39; &gt; /sys/bus/usb/drivers/qmi_wwan/unbind&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sleep <span class=m>1</span>
</span></span><span class=line><span class=cl>sudo bash -c <span class=s2>&#34;echo &#39;</span><span class=si>${</span><span class=nv>SECOND_PORT_ID</span><span class=si>}</span><span class=s2>&#39; &gt; /sys/bus/usb/drivers/qmi_wwan/bind&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sleep <span class=m>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo modprobe option
</span></span><span class=line><span class=cl>sudo bash -c <span class=s2>&#34;echo &#39;161c f101&#39; &gt; /sys/bus/usb-serial/drivers/option1/new_id&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># mmcli --list-modems</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># sudo ip route delete default</span>
</span></span><span class=line><span class=cl><span class=c1># sudo ip route add default dev ppp0</span>
</span></span></code></pre></div><p>该类型设备一般自带windows驱动程序，插上自动安装就可以使用。但是在linux下需要适配驱动，也需要将usb设备从cd-rom模式切换为LTE。
拆开后，发现4G通信模块芯片为Qualcomm MDM9215。通过windows下驱动设备的状态可以识别到切换为LTE的product id 为<code>f101</code></p><p>谷歌搜索后获取到这个设备的modem切换信息
<a href=https://github.com/NetworkManager/usb_modeswitch-data/blob/master/usb_modeswitch.d/1c9e:f010>https://github.com/NetworkManager/usb_modeswitch-data/blob/master/usb_modeswitch.d/1c9e:f010</a> (message信息从这里获取的）</p><p>然后尝试使用qmi_wwan驱动后，成功了。</p><p>注意，启动失败后需要清理环境。杀死所有子进程，否则再次启动拨号会失败。</p><ul><li>关于天线 <a href=https://zhuanlan.zhihu.com/p/51098683>https://zhuanlan.zhihu.com/p/51098683</a></li><li>类似modem教程 <a href=https://github.com/gartfr/QualcommLTE>https://github.com/gartfr/QualcommLTE</a></li><li>modem学习资料 <a href=http://trac.gateworks.com/wiki/wireless/modem>http://trac.gateworks.com/wiki/wireless/modem</a></li><li>ubuntu modem-manager (modem clit替代wvdial拨号, 推荐使用network-manager建立网卡接口) <a href=https://core.docs.ubuntu.com/en/stacks/network/modem-manager/docs/configuring-cellular-connections>https://core.docs.ubuntu.com/en/stacks/network/modem-manager/docs/configuring-cellular-connections</a></li></ul><h2 id=参考>参考</h2><ul><li><a href=https://www.thefanclub.co.za/how-to/how-setup-usb-3g-modem-raspberry-pi-using-usbmodeswitch-and-wvdial>https://www.thefanclub.co.za/how-to/how-setup-usb-3g-modem-raspberry-pi-using-usbmodeswitch-and-wvdial</a></li><li><a href=https://blog.csdn.net/qq_32384313/article/details/77725235>https://blog.csdn.net/qq_32384313/article/details/77725235</a>
<a href=https://www.findhao.net/easycoding/2114.html>https://www.findhao.net/easycoding/2114.html</a></li></ul></article><div id=react-app-components data-post-id=3a19c142db8d0ac4aaf474c7d217623b></div><button class=mobile-toc-trigger aria-controls=mobile-toc aria-expanded=false title=Index>☰</button><div class=mobile-toc-overlay hidden></div><div id=mobile-toc class=mobile-toc-drawer aria-hidden=true role=dialog aria-label=Index><div class=mobile-toc-header><button class=mobile-toc-close aria-label=close>×</button></div><nav class=mobile-toc-body><div class=mobile-toc-list></div></nav><div class=mobile-safe-area-spacer></div></div><script type=module src=/react/page.bundle.js></script></main><footer><div class=copyright><small>Made with <span style=color:#e25555>&#9829;</span> in Guangzhou by
©<a href=https://github.com/qtopie>qtopie</a> 2026
</small><small>Posts licensed under <a href=https://creativecommons.org/licenses/by/4.0/legalcode>CC BY 4.0</small></div><div><script type=module src=/react/base.bundle.js></script></div></footer></body></html>