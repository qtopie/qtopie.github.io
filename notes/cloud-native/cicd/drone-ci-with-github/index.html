<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Yeah, another CI tool. That&rsquo;s named Drone.
We&rsquo;ve been heard of Jenkins, travis-ci and even circle-ci (I have to mention this because there&rsquo;re too much ads on youtube for it), so why would we need another one?
I&rsquo;ve used Jenkins and travis-ci, but they are not perfect, at least there are some slight drawbacks.

  My experience on Jenkins
  #

Jenkins is stable for production, it has long history and is used widely. But sometimes I find Jenkins is too slow, and configuration is not straightforward. And it&rsquo;s a pain to upgrade to a new pipeline, you have to copy and paste jobs from UI (while accessing is pretty slow). You might able to config jobs with XML config files, but it&rsquo;s still a bit of complicated."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qtopie.github.io/notes/cloud-native/cicd/drone-ci-with-github/"><meta property="og:site_name" content="Blog | qtopierw"><meta property="og:title" content="Drone CI With Github"><meta property="og:description" content="Yeah, another CI tool. That’s named Drone.
We’ve been heard of Jenkins, travis-ci and even circle-ci (I have to mention this because there’re too much ads on youtube for it), so why would we need another one?
I’ve used Jenkins and travis-ci, but they are not perfect, at least there are some slight drawbacks.
My experience on Jenkins # Jenkins is stable for production, it has long history and is used widely. But sometimes I find Jenkins is too slow, and configuration is not straightforward. And it’s a pain to upgrade to a new pipeline, you have to copy and paste jobs from UI (while accessing is pretty slow). You might able to config jobs with XML config files, but it’s still a bit of complicated."><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2019-03-05T23:58:06+08:00"><meta property="article:modified_time" content="2019-03-05T23:58:06+08:00"><title>Drone CI With Github | Blog | qtopierw</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qtopie.github.io/notes/cloud-native/cicd/drone-ci-with-github/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.d068e298764bebd377892ee728ef88919a2ae62519b35fcd4c9bc8f4f911fc7d.js integrity="sha256-0GjimHZL69N3iS7nKO+IkZoq5iUZs1/NTJvI9PkR/H0=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Blog | qtopierw</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Drone CI With Github</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#my-experience-on-jenkins>My experience on Jenkins</a></li><li><a href=#my-experience-travis-ci>My Experience Travis-CI</a></li><li><a href=#what-about-drone>What about Drone?</a><ul><li><a href=#drone-cloud>Drone Cloud</a></li></ul></li><li><a href=#setting-up-with-github-public-repo>Setting up with github (public repo)</a><ul><li><a href=#preparement>Preparement</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><p>Yeah, another CI tool. That&rsquo;s named <a href=https://drone.io/><code>Drone</code></a>.</p><p>We&rsquo;ve been heard of Jenkins, travis-ci and even circle-ci (I have to mention this because there&rsquo;re too much ads on youtube for it), so why would we need another one?</p><p>I&rsquo;ve used Jenkins and travis-ci, but they are not perfect, at least there are some slight drawbacks.</p><h2 id=my-experience-on-jenkins>My experience on Jenkins
<a class=anchor href=#my-experience-on-jenkins>#</a></h2><p>Jenkins is stable for production, it has long history and is used widely. But sometimes I find Jenkins is too slow, and configuration is not straightforward. And it&rsquo;s a pain to upgrade to a new pipeline, you have to copy and paste jobs from UI (while accessing is pretty slow). You might able to config jobs with XML config files, but it&rsquo;s still a bit of complicated.</p><p>If you don&rsquo;t use containers in Jenkins, workspaces will take too much storage when there are too many jenkins jobs. This will make you have to expand the storage disk one day.</p><p>Some teams may use old version of Jenkins with some bugs, but they are not willing to upgrade it because of the risks of workload and technical problems.</p><h2 id=my-experience-travis-ci>My Experience Travis-CI
<a class=anchor href=#my-experience-travis-ci>#</a></h2><ul><li>Faster than Jenkins</li><li>Lighter UI</li><li>Configuration as Code</li><li>Need to learn the configuration grammer</li><li>&mldr;</li></ul><h2 id=what-about-drone>What about Drone?
<a class=anchor href=#what-about-drone>#</a></h2><ul><li>Lighter and elegant UI</li><li>Configuration is straightforward, syntax just like docker-compose</li><li>Ship Code Fast</li><li>Container Native</li><li>&mldr;</li></ul><p>So it&rsquo;s just like the upgrading path: Jenkins -> travis-ci -> drone-ci.
The latter one seems absorb the advantages and make it better.</p><p>But drone is not totally free to use: <a href=https://discourse.drone.io/t/licensing-and-subscription-faq/3839>https://discourse.drone.io/t/licensing-and-subscription-faq/3839</a></p><p>Though it&rsquo;s licensed under apache 2.0 license for oss use, you may never use the oss version because it&rsquo;s lack of agent support and its functions are limited.</p><p>But it&rsquo;s free to use for open source projects. See <a href=https://github.com/drone/drone/blob/master/LICENSE>license</a>.
While Jenkins and travis are under MIT license.</p><h3 id=drone-cloud>Drone Cloud
<a class=anchor href=#drone-cloud>#</a></h3><p>In 2018/11/27 Drone Cloud was announced, and it&rsquo;s free for open source. see <a href=https://blog.drone.io/drone-cloud/>https://blog.drone.io/drone-cloud/</a>.</p><h2 id=setting-up-with-github-public-repo>Setting up with github (public repo)
<a class=anchor href=#setting-up-with-github-public-repo>#</a></h2><h3 id=preparement>Preparement
<a class=anchor href=#preparement>#</a></h3><ul><li>GitHub token [repo]</li><li>A created public project</li></ul><p>Sample configuration for golang project: <a href=https://github.com/artificerpi/goserve>goserve</a></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>workspace</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>base</span>:<span style=color:#bbb> </span>/go<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>path</span>:<span style=color:#bbb> </span>src/github.com/artificerpi/goserve<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>steps</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>test<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>image</span>:<span style=color:#bbb> </span>golang<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>pull</span>:<span style=color:#bbb> </span>always<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>commands</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- go test -v ./...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>build<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>image</span>:<span style=color:#bbb> </span>golang<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>pull</span>:<span style=color:#bbb> </span>always<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>commands</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- go get github.com/mitchellh/gox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- go get -t -v ./...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- gox -output=&#34;./dist/{{.Dir}}_{{.OS}}_{{.Arch}}&#34; -os=&#34;linux darwin windows&#34; -arch=&#34;amd64&#34; -verbose ./...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>when</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>event</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- push<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- tag<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>publish<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>image</span>:<span style=color:#bbb> </span>plugins/github-release<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>settings</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>api_key</span>:<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>from_secret</span>:<span style=color:#bbb> </span>github_token<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>files</span>:<span style=color:#bbb> </span>dist/*<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>checksum</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- sha256<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>when</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>event</span>:<span style=color:#bbb> </span>tag<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Here we declare the workspace and set <code>gopath</code>, and we use gox to do cross-platform buliding, and finally publish the release with plugin <a href=http://plugins.drone.io/drone-plugins/drone-github-release/>github-release</a> to relase artifacts.</p><h4 id=release-artifacts>Release artifacts
<a class=anchor href=#release-artifacts>#</a></h4><ul><li><p>share artifacts with another step
Note that we can directly use the artifacts by the build step, no need to do volume mount (for security, mouting is not availbe on public drone cloud)</p></li><li><p>api key
Here we read the secret from an environment var <code>github_token</code>, which is configured in the UI of drone in project settings.</p></li></ul><p>One more java project sample from here: <a href=https://github.com/artificerpi/spring-petclinic-mybatis/blob/master/.drone.yml>java-sample</a></p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#my-experience-on-jenkins>My experience on Jenkins</a></li><li><a href=#my-experience-travis-ci>My Experience Travis-CI</a></li><li><a href=#what-about-drone>What about Drone?</a><ul><li><a href=#drone-cloud>Drone Cloud</a></li></ul></li><li><a href=#setting-up-with-github-public-repo>Setting up with github (public repo)</a><ul><li><a href=#preparement>Preparement</a></li></ul></li></ul></nav></div></aside></main></body></html>