<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Drone CI With Github | 1001問</title><link rel=stylesheet href=/css/main.min.dcb41abaa5ea2698ebf89f814bc6b8060470b6414061437dac2ee0e3ef5d3b45.css integrity="sha256-3LQauqXqJpjr+J+BS8a4BgRwtkFAYUN9rC7g4+9dO0U=" crossorigin=anonymous><link rel=stylesheet href=/css/home.min.5ac5664053c6ff57052d1e509e7cc9b36e8f9835b7c93b096da215d0725e106e.css integrity="sha256-WsVmQFPG/1cFLR5QnnzJs26PmDW3yTsJbaIV0HJeEG4=" crossorigin=anonymous></head><body><header><nav><a href=/><h1>1001問</h1></a><div id=react-search class=search-root aria-label="Site Search"></div></nav></header><main><div class=sidebar><section class=toc><h2>Table Of Contents</h2><nav id=TableOfContents><ul><li><a href=#my-experience-on-jenkins>My experience on Jenkins</a></li><li><a href=#my-experience-travis-ci>My Experience Travis-CI</a></li><li><a href=#what-about-drone>What about Drone?</a><ul><li><a href=#drone-cloud>Drone Cloud</a></li></ul></li><li><a href=#setting-up-with-github-public-repo>Setting up with github (public repo)</a><ul><li><a href=#preparement>Preparement</a></li></ul></li></ul></nav></section></div><article id=content><div class=metadata><h1>Drone CI With Github</h1><time datetime=2019-03-05T23:58:06+08:00>March 5, 2019</time><div class=taxonomy></div></div><p>Yeah, another CI tool. That&rsquo;s named <a href=https://drone.io/><code>Drone</code></a>.</p><p>We&rsquo;ve been heard of Jenkins, travis-ci and even circle-ci (I have to mention this because there&rsquo;re too much ads on youtube for it), so why would we need another one?</p><p>I&rsquo;ve used Jenkins and travis-ci, but they are not perfect, at least there are some slight drawbacks.</p><h2 id=my-experience-on-jenkins>My experience on Jenkins</h2><p>Jenkins is stable for production, it has long history and is used widely. But sometimes I find Jenkins is too slow, and configuration is not straightforward. And it&rsquo;s a pain to upgrade to a new pipeline, you have to copy and paste jobs from UI (while accessing is pretty slow). You might able to config jobs with XML config files, but it&rsquo;s still a bit of complicated.</p><p>If you don&rsquo;t use containers in Jenkins, workspaces will take too much storage when there are too many jenkins jobs. This will make you have to expand the storage disk one day.</p><p>Some teams may use old version of Jenkins with some bugs, but they are not willing to upgrade it because of the risks of workload and technical problems.</p><h2 id=my-experience-travis-ci>My Experience Travis-CI</h2><ul><li>Faster than Jenkins</li><li>Lighter UI</li><li>Configuration as Code</li><li>Need to learn the configuration grammer</li><li>&mldr;</li></ul><h2 id=what-about-drone>What about Drone?</h2><ul><li>Lighter and elegant UI</li><li>Configuration is straightforward, syntax just like docker-compose</li><li>Ship Code Fast</li><li>Container Native</li><li>&mldr;</li></ul><p>So it&rsquo;s just like the upgrading path: Jenkins -> travis-ci -> drone-ci.
The latter one seems absorb the advantages and make it better.</p><p>But drone is not totally free to use: <a href=https://discourse.drone.io/t/licensing-and-subscription-faq/3839>https://discourse.drone.io/t/licensing-and-subscription-faq/3839</a></p><p>Though it&rsquo;s licensed under apache 2.0 license for oss use, you may never use the oss version because it&rsquo;s lack of agent support and its functions are limited.</p><p>But it&rsquo;s free to use for open source projects. See <a href=https://github.com/drone/drone/blob/master/LICENSE>license</a>.
While Jenkins and travis are under MIT license.</p><h3 id=drone-cloud>Drone Cloud</h3><p>In 2018/11/27 Drone Cloud was announced, and it&rsquo;s free for open source. see <a href=https://blog.drone.io/drone-cloud/>https://blog.drone.io/drone-cloud/</a>.</p><h2 id=setting-up-with-github-public-repo>Setting up with github (public repo)</h2><h3 id=preparement>Preparement</h3><ul><li>GitHub token [repo]</li><li>A created public project</li></ul><p>Sample configuration for golang project: <a href=https://github.com/artificerpi/goserve>goserve</a></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-text-size-adjust:none><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#309;font-weight:700>workspace</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>base</span>:<span style=color:#bbb> </span>/go<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>path</span>:<span style=color:#bbb> </span>src/github.com/artificerpi/goserve<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#309;font-weight:700>steps</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>test<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>image</span>:<span style=color:#bbb> </span>golang<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>pull</span>:<span style=color:#bbb> </span>always<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>commands</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- go test -v ./...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  
</span></span></span><span style=display:flex><span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>build<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>image</span>:<span style=color:#bbb> </span>golang<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>pull</span>:<span style=color:#bbb> </span>always<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>commands</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- go get github.com/mitchellh/gox<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- go get -t -v ./...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- gox -output=&#34;./dist/{{.Dir}}_{{.OS}}_{{.Arch}}&#34; -os=&#34;linux darwin windows&#34; -arch=&#34;amd64&#34; -verbose ./...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>when</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>event</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- push<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- tag<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>publish<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>image</span>:<span style=color:#bbb> </span>plugins/github-release<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>settings</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>api_key</span>:<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>from_secret</span>:<span style=color:#bbb> </span>github_token<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>files</span>:<span style=color:#bbb> </span>dist/*<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>checksum</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- sha256<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>when</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>event</span>:<span style=color:#bbb> </span>tag<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># ...</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Here we declare the workspace and set <code>gopath</code>, and we use gox to do cross-platform buliding, and finally publish the release with plugin <a href=http://plugins.drone.io/drone-plugins/drone-github-release/>github-release</a> to relase artifacts.</p><h4 id=release-artifacts>Release artifacts</h4><ul><li><p>share artifacts with another step
Note that we can directly use the artifacts by the build step, no need to do volume mount (for security, mouting is not availbe on public drone cloud)</p></li><li><p>api key
Here we read the secret from an environment var <code>github_token</code>, which is configured in the UI of drone in project settings.</p></li></ul><p>One more java project sample from here: <a href=https://github.com/artificerpi/spring-petclinic-mybatis/blob/master/.drone.yml>java-sample</a></p><div id=react-single-actions data-post-id=a12ee00644939a8ecbfc117ad8b3157b></div></article><script type=module>

const toc = document.querySelector('#TableOfContents');
if (toc) {
  
  toc.addEventListener('click', (e) => {
    const a = e.target.closest('a');
    if (!a) return;
    const id = a.getAttribute('href')?.replace('#','');
    const target = id ? document.getElementById(id) : null;
    if (target) {
      e.preventDefault();
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      history.replaceState(null, '', `#${id}`);
    }
  });

  
  const headings = Array.from(document.querySelectorAll('article h1, article h2, article h3, article h4'));
  const linkMap = new Map();
  for (const a of toc.querySelectorAll('a[href^="#"]')) {
    const id = a.getAttribute('href').slice(1);
    linkMap.set(id, a);
  }

  const setActive = (id) => {
    for (const a of linkMap.values()) a.classList.remove('is-active');
    const active = linkMap.get(id);
    if (active) active.classList.add('is-active');
  };

  const observer = new IntersectionObserver((entries) => {
    
    const visible = entries
      .filter(e => e.isIntersecting)
      .sort((a, b) => a.target.getBoundingClientRect().top - b.target.getBoundingClientRect().top);
    if (visible.length) {
      const id = visible[0].target.id;
      if (id) setActive(id);
    }
  }, {
    root: null,
    rootMargin: '-96px 0px -60% 0px', 
    threshold: [0, 1e-3, 0.25]
  });

  headings.forEach(h => {
    
    if (!h.id) {
      h.id = h.textContent.trim().toLowerCase().replace(/\s+/g, '-');
    }
    observer.observe(h);
  });

  
  if (location.hash) {
    const target = document.getElementById(location.hash.slice(1));
    if (target) {
      setTimeout(() => target.scrollIntoView({ behavior: 'smooth', block: 'start' }), 0);
    }
  }
}
</script><script type=module src=/react/page.bundle.js></script></main><footer><div class=copyright><small>Made with <span style=color:#e25555>&#9829;</span> in Guangzhou by
©<a href=https://github.com/qtopie>qtopie</a> 2026
</small><small>Posts licensed under <a href=https://creativecommons.org/licenses/by/4.0/legalcode>CC BY 4.0</small></div><div><script type=module src=/react/base.bundle.js></script></div></footer></body></html>