<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="这里我们使用helm 3.0+版本, 可以直接使用kube-server api, 不需要在集群安装tiler

  安装
  #

sudo snap install helm --classic

  Chartmuseum
  #

repo: https://github.com/helm/chartmuseum
本地安装
curl -LO https://s3.amazonaws.com/chartmuseum/release/latest/bin/linux/amd64/chartmuseum
chmod +x chartmuseum
sudo mv chartmuseum /usr/bin/
sudo mkdir /opt/chart && sudo chown $USER /opt/chart
./chartmuseum --storage=local --storage-local-rootdir=/opt/chart
然后打开http://localhost:8080就可以看到欢迎界面

  创建和使用chart
  #

我们以创建一个nginx chart为例。
使用helm创建初始化配。
mkdir app
helm create chart
然后可以看到初始化的以下配置
artificerpi@ky-laptop:~/build/app$ tree chart
chart
├── charts
├── Chart.yaml
├── templates
│   ├── deployment.yaml
│   ├── _helpers.tpl
│   ├── ingress.yaml
│   ├── NOTES.txt
│   ├── serviceaccount.yaml
│   ├── service.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml

3 directories, 9 files
修改chart/Chart.yaml文件，将name字段改为nginx-foo"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qtopie.github.io/notes/cloud-native/k8s/helm.zh/"><meta property="og:site_name" content="Blog | qtopierw"><meta property="og:title" content="Helm"><meta property="og:description" content="这里我们使用helm 3.0+版本, 可以直接使用kube-server api, 不需要在集群安装tiler
安装 # sudo snap install helm --classic Chartmuseum # repo: https://github.com/helm/chartmuseum
本地安装
curl -LO https://s3.amazonaws.com/chartmuseum/release/latest/bin/linux/amd64/chartmuseum chmod +x chartmuseum sudo mv chartmuseum /usr/bin/ sudo mkdir /opt/chart && sudo chown $USER /opt/chart ./chartmuseum --storage=local --storage-local-rootdir=/opt/chart 然后打开http://localhost:8080就可以看到欢迎界面
创建和使用chart # 我们以创建一个nginx chart为例。
使用helm创建初始化配。
mkdir app helm create chart 然后可以看到初始化的以下配置
artificerpi@ky-laptop:~/build/app$ tree chart chart ├── charts ├── Chart.yaml ├── templates │ ├── deployment.yaml │ ├── _helpers.tpl │ ├── ingress.yaml │ ├── NOTES.txt │ ├── serviceaccount.yaml │ ├── service.yaml │ └── tests │ └── test-connection.yaml └── values.yaml 3 directories, 9 files 修改chart/Chart.yaml文件，将name字段改为nginx-foo"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2020-05-20T21:15:34+08:00"><meta property="article:modified_time" content="2020-05-20T21:15:34+08:00"><title>Helm | Blog | qtopierw</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qtopie.github.io/notes/cloud-native/k8s/helm.zh/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.6b0a5247a29534ab597c09c6ba111855ef60594896512109921af15ed6e3e547.js integrity="sha256-awpSR6KVNKtZfAnGuhEYVe9gWUiWUSEJkhrxXtbj5Uc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Blog | qtopierw</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Helm</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#安装>安装</a></li><li><a href=#chartmuseum>Chartmuseum</a></li><li><a href=#创建和使用chart>创建和使用chart</a></li><li><a href=#示范>示范</a></li></ul></nav></aside></header><article class="markdown book-article"><p>这里我们使用helm 3.0+版本, 可以直接使用kube-server api, 不需要在集群安装tiler</p><h2 id=安装>安装
<a class=anchor href=#%e5%ae%89%e8%a3%85>#</a></h2><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo snap install helm --classic
</span></span></code></pre></div><h2 id=chartmuseum>Chartmuseum
<a class=anchor href=#chartmuseum>#</a></h2><p>repo: <a href=https://github.com/helm/chartmuseum>https://github.com/helm/chartmuseum</a></p><p>本地安装</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://s3.amazonaws.com/chartmuseum/release/latest/bin/linux/amd64/chartmuseum
</span></span><span style=display:flex><span>chmod +x chartmuseum
</span></span><span style=display:flex><span>sudo mv chartmuseum /usr/bin/
</span></span><span style=display:flex><span>sudo mkdir /opt/chart <span style=color:#555>&amp;&amp;</span> sudo chown <span style=color:#033>$USER</span> /opt/chart
</span></span><span style=display:flex><span>./chartmuseum --storage<span style=color:#555>=</span><span style=color:#366>local</span> --storage-local-rootdir<span style=color:#555>=</span>/opt/chart
</span></span></code></pre></div><p>然后打开http://localhost:8080就可以看到欢迎界面</p><h2 id=创建和使用chart>创建和使用chart
<a class=anchor href=#%e5%88%9b%e5%bb%ba%e5%92%8c%e4%bd%bf%e7%94%a8chart>#</a></h2><p>我们以创建一个nginx chart为例。</p><p>使用helm创建初始化配。</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir app
</span></span><span style=display:flex><span>helm create chart
</span></span></code></pre></div><p>然后可以看到初始化的以下配置</p><pre tabindex=0><code>artificerpi@ky-laptop:~/build/app$ tree chart
chart
├── charts
├── Chart.yaml
├── templates
│   ├── deployment.yaml
│   ├── _helpers.tpl
│   ├── ingress.yaml
│   ├── NOTES.txt
│   ├── serviceaccount.yaml
│   ├── service.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml

3 directories, 9 files
</code></pre><p>修改chart/Chart.yaml文件，将name字段改为<code>nginx-foo</code></p><p>package</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm package .
</span></span></code></pre></div><p>install</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm install &lt;NAME&gt; foo-0.1.0.tgz 
</span></span></code></pre></div><p>安装<a href=https://github.com/chartmuseum/helm-push>helm-push插件</a></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm plugin install https://github.com/chartmuseum/helm-push.git
</span></span></code></pre></div><p>加入本地chartmuseum仓库</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add chartmuseum http://localhost:8080
</span></span></code></pre></div><p>推送<code>nginx-foo</code> chart</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm push chart/ chartmuseum
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># 或者指定版本</span>
</span></span><span style=display:flex><span>helm push chart/ chartmuseum --version<span style=color:#555>=</span>0.1.1
</span></span></code></pre></div><p>成功后，通过curl命令调用chartmuseum api就可以看到上传结果</p><pre tabindex=0><code># curl http://localhost:8080/api/charts

{&#34;nginx-foo&#34;:[{&#34;name&#34;:&#34;nginx-foo&#34;,&#34;version&#34;:&#34;0.1.0&#34;,&#34;description&#34;:&#34;A Helm chart for Kubernetes&#34;,&#34;apiVersion&#34;:&#34;v2&#34;,&#34;appVersion&#34;:&#34;1.16.0&#34;,&#34;type&#34;:&#34;application&#34;,&#34;urls&#34;:[&#34;charts/nginx-foo-0.1.0.tgz&#34;],&#34;created&#34;:&#34;2020-04-03T10:26:49.059906306+08:00&#34;,&#34;digest&#34;:&#34;aa6532c71a1a463d34d295f4c9a36bafbcd116e4520c8661af9fd13773f0b7b8&#34;}]}
</code></pre><h2 id=示范>示范
<a class=anchor href=#%e7%a4%ba%e8%8c%83>#</a></h2><p>all in one helm chart</p><p>sonarqube</p><p>spring boot app with web frontend</p></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#安装>安装</a></li><li><a href=#chartmuseum>Chartmuseum</a></li><li><a href=#创建和使用chart>创建和使用chart</a></li><li><a href=#示范>示范</a></li></ul></nav></div></aside></main></body></html>