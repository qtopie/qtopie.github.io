<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Helm | 1001問</title><link rel=stylesheet href=/css/main.min.62cae6038d6e603968789c1ad4892241dbe7709916726790d4f747b44676acb4.css integrity="sha256-YsrmA41uYDloeJwa1IkiQdvncJkWcmeQ1PdHtEZ2rLQ=" crossorigin=anonymous><link rel=stylesheet href=/css/page.min.04e6588a59b5cdf8e6830d05e505feda61acd4ff9befb3bdd33fe3e121fc9184.css integrity="sha256-BOZYilm1zfjmgw0F5QX+2mGs1P+b77O90z/j4SH8kYQ=" crossorigin=anonymous></head><body><header><nav><a href=/><h1>1001問</h1></a><div id=react-search class=search-root aria-label="Site Search"></div></nav></header><main><div class=sidebar></div><article><div class=metadata><h1>Helm</h1><time datetime=2020-05-20T21:15:34+08:00>May 20, 2020</time><div class=taxonomy></div></div><p>这里我们使用helm 3.0+版本, 可以直接使用kube-server api, 不需要在集群安装tiler</p><h2 id=安装>安装</h2><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo snap install helm --classic
</span></span></code></pre></div><h2 id=chartmuseum>Chartmuseum</h2><p>repo: <a href=https://github.com/helm/chartmuseum>https://github.com/helm/chartmuseum</a></p><p>本地安装</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>curl -LO https://s3.amazonaws.com/chartmuseum/release/latest/bin/linux/amd64/chartmuseum
</span></span><span style=display:flex><span>chmod +x chartmuseum
</span></span><span style=display:flex><span>sudo mv chartmuseum /usr/bin/
</span></span><span style=display:flex><span>sudo mkdir /opt/chart <span style=color:#555>&amp;&amp;</span> sudo chown <span style=color:#033>$USER</span> /opt/chart
</span></span><span style=display:flex><span>./chartmuseum --storage<span style=color:#555>=</span><span style=color:#366>local</span> --storage-local-rootdir<span style=color:#555>=</span>/opt/chart
</span></span></code></pre></div><p>然后打开http://localhost:8080就可以看到欢迎界面</p><h2 id=创建和使用chart>创建和使用chart</h2><p>我们以创建一个nginx chart为例。</p><p>使用helm创建初始化配。</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir app
</span></span><span style=display:flex><span>helm create chart
</span></span></code></pre></div><p>然后可以看到初始化的以下配置</p><pre tabindex=0><code>artificerpi@ky-laptop:~/build/app$ tree chart
chart
├── charts
├── Chart.yaml
├── templates
│   ├── deployment.yaml
│   ├── _helpers.tpl
│   ├── ingress.yaml
│   ├── NOTES.txt
│   ├── serviceaccount.yaml
│   ├── service.yaml
│   └── tests
│       └── test-connection.yaml
└── values.yaml

3 directories, 9 files
</code></pre><p>修改chart/Chart.yaml文件，将name字段改为<code>nginx-foo</code></p><p>package</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm package .
</span></span></code></pre></div><p>install</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm install &lt;NAME&gt; foo-0.1.0.tgz 
</span></span></code></pre></div><p>安装<a href=https://github.com/chartmuseum/helm-push>helm-push插件</a></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm plugin install https://github.com/chartmuseum/helm-push.git
</span></span></code></pre></div><p>加入本地chartmuseum仓库</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add chartmuseum http://localhost:8080
</span></span></code></pre></div><p>推送<code>nginx-foo</code> chart</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>helm push chart/ chartmuseum
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># 或者指定版本</span>
</span></span><span style=display:flex><span>helm push chart/ chartmuseum --version<span style=color:#555>=</span>0.1.1
</span></span></code></pre></div><p>成功后，通过curl命令调用chartmuseum api就可以看到上传结果</p><pre tabindex=0><code># curl http://localhost:8080/api/charts

{&#34;nginx-foo&#34;:[{&#34;name&#34;:&#34;nginx-foo&#34;,&#34;version&#34;:&#34;0.1.0&#34;,&#34;description&#34;:&#34;A Helm chart for Kubernetes&#34;,&#34;apiVersion&#34;:&#34;v2&#34;,&#34;appVersion&#34;:&#34;1.16.0&#34;,&#34;type&#34;:&#34;application&#34;,&#34;urls&#34;:[&#34;charts/nginx-foo-0.1.0.tgz&#34;],&#34;created&#34;:&#34;2020-04-03T10:26:49.059906306+08:00&#34;,&#34;digest&#34;:&#34;aa6532c71a1a463d34d295f4c9a36bafbcd116e4520c8661af9fd13773f0b7b8&#34;}]}
</code></pre><h2 id=示范>示范</h2><p>all in one helm chart</p><p>sonarqube</p><p>spring boot app with web frontend</p><div id=react-single-actions data-post-id=941d0b4aac590cc2cb6b2d2da4bf1c36></div></article><script type=module>

const toc = document.querySelector('#TableOfContents');
if (toc) {
  
  toc.addEventListener('click', (e) => {
    const a = e.target.closest('a');
    if (!a) return;
    const id = a.getAttribute('href')?.replace('#','');
    const target = id ? document.getElementById(id) : null;
    if (target) {
      e.preventDefault();
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      history.replaceState(null, '', `#${id}`);
    }
  });

  
  const headings = Array.from(document.querySelectorAll('article h1, article h2, article h3, article h4'));
  const linkMap = new Map();
  for (const a of toc.querySelectorAll('a[href^="#"]')) {
    const id = a.getAttribute('href').slice(1);
    linkMap.set(id, a);
  }

  const setActive = (id) => {
    for (const a of linkMap.values()) a.classList.remove('is-active');
    const active = linkMap.get(id);
    if (active) active.classList.add('is-active');
  };

  const observer = new IntersectionObserver((entries) => {
    
    const visible = entries
      .filter(e => e.isIntersecting)
      .sort((a, b) => a.target.getBoundingClientRect().top - b.target.getBoundingClientRect().top);
    if (visible.length) {
      const id = visible[0].target.id;
      if (id) setActive(id);
    }
  }, {
    root: null,
    rootMargin: '-96px 0px -60% 0px', 
    threshold: [0, 1e-3, 0.25]
  });

  headings.forEach(h => {
    
    if (!h.id) {
      h.id = h.textContent.trim().toLowerCase().replace(/\s+/g, '-');
    }
    observer.observe(h);
  });

  
  if (location.hash) {
    const target = document.getElementById(location.hash.slice(1));
    if (target) {
      setTimeout(() => target.scrollIntoView({ behavior: 'smooth', block: 'start' }), 0);
    }
  }
}
</script><script type=module src=/react/page.bundle.js></script></main><footer><div class=copyright><small>Made with <span style=color:#e25555>&#9829;</span> in Guangzhou by
©<a href=https://github.com/qtopie>qtopie</a> 2026
</small><small>Posts licensed under <a href=https://creativecommons.org/licenses/by/4.0/legalcode>CC BY 4.0</small></div><div><script type=module src=/react/base.bundle.js></script></div></footer></body></html>