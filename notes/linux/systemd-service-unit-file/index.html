<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Ubuntu init process | 1001問</title><link rel=stylesheet href=/css/main.min.dcb41abaa5ea2698ebf89f814bc6b8060470b6414061437dac2ee0e3ef5d3b45.css integrity="sha256-3LQauqXqJpjr+J+BS8a4BgRwtkFAYUN9rC7g4+9dO0U=" crossorigin=anonymous><link rel=stylesheet href=/css/page.min.81d92e4ce9b8dc4e8a2018a7aee70f76bd7fb6884d929d5fd74e3f959f06e2f5.css integrity="sha256-gdkuTOm43E6KIBinrucPdr1/tohNkp1f104/lZ8G4vU=" crossorigin=anonymous><link rel=stylesheet href=/css/syntax.min.e114b8cc38f57d520f373580c935a518bc6afd6dec4f1d682365cdbcf5c8218a.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css crossorigin=anonymous referrerpolicy=no-referrer><script src=/js/toc.min.87636f25caf644980403a5c1ce8b0812cfd10d1e53c08f181547966799ceccdb.js integrity="sha256-h2NvJcr2RJgEA6XBzosIEs/RDR5TwI8YFUeWZ5nOzNs=" crossorigin=anonymous type=module defer></script><script src=/js/copy-code.min.3bea0de4cfe8670f94a5d75c177f07b58fc90178efdea7f2a21449798d75b2c9.js integrity="sha256-O+oN5M/oZw+UpddcF38HtY/JAXjv3qfyohRJeY11ssk=" crossorigin=anonymous defer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.js crossorigin=anonymous referrerpolicy=no-referrer></script><script defer src=https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js crossorigin=anonymous referrerpolicy=no-referrer onload='renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],throwOnError:!1})'></script><script src=/js/katex-block.min.2cf531bbcc318aadf5661baa2d0987ab5cb4daef473e108b1da714a37cff0b25.js integrity="sha256-LPUxu8wxiq31ZhuqLQmHq1y02u9HPhCLHacUo3z/CyU=" crossorigin=anonymous defer></script></head><body><header><nav><a href=/><h1>1001問</h1></a><div id=react-search class=search-root aria-label="Site Search"></div></nav></header><main><div class=sidebar><section class=toc><nav id=TableOfContents><ul><li><a href=#history>History</a><ul><li><a href=#features-of-upstart>Features of Upstart</a></li></ul></li><li><a href=#systemd>Systemd</a><ul><li><a href=#systemctl>systemctl</a></li><li><a href=#init-script-vs-service-file>Init script vs Service file</a></li></ul></li><li><a href=#reference>Reference</a></li></ul></nav></section></div><article id=content><div class=metadata><h1>Ubuntu init process</h1><time datetime=2016-09-15T14:20:15+08:00>September 15, 2016</time><div class=taxonomy><span id=post-categories><ul><li><strong>Categories</strong>:&nbsp;</li><li class=category-item><a href=https://qtopie.github.io/categories/linux>linux</a></li></ul></span><span id=post-tags><ul><li><strong>Tags</strong>:&nbsp;</li><li class=tag-item><a href=https://qtopie.github.io/tags/ubuntu><em>ubuntu</em></a></li></ul></span></div></div><h2 id=history>History</h2><ul><li>sysVinit</li><li><a href=http://upstart.ubuntu.com/>upstart</a></li><li>systemd</li></ul><p>ubuntu: sysVinit &ndash;> upstart(6.10+) &ndash;> systemd (15.04+)</p><h3 id=features-of-upstart>Features of Upstart</h3><p><em>Event Based</em></p><ul><li>Start System faster (compare with previous method).</li><li>Dynamically start service when discovering new device</li><li>Dynamically stop service when device is removed</li></ul><h2 id=systemd>Systemd</h2><p>Systemd is a collection of system management daemons, utilities and libraries which serves as a replacement of System V init daemon. Systemd functions as
central management and configuration platform for UNIX like system.</p><h3 id=systemctl>systemctl</h3><p>Systemctl is a systemd utility which is responsible for Controlling the systemd system and service manager.</p><h3 id=init-script-vs-service-file>Init script vs Service file</h3><p>You may use <code>service SCRIPT start|stop|statu..</code> manage jobs, but it&rsquo;s different
between using Init script and upstart or systemd service file.
<em>see <code>man service</code></em>.</p><h4 id=system-v-init-script>System V init script</h4><p>located in /etc/init.d/SCRIPT</p><ul><li>Example: (from shadowsocks-go project)</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=c1># Start/stop shadowsocks.</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1>### BEGIN INIT INFO</span>
</span></span><span class=line><span class=cl><span class=c1># Provides:          shadowsocks</span>
</span></span><span class=line><span class=cl><span class=c1># Required-Start:</span>
</span></span><span class=line><span class=cl><span class=c1># Required-Stop:</span>
</span></span><span class=line><span class=cl><span class=c1># Should-Start:</span>
</span></span><span class=line><span class=cl><span class=c1># Should-Stop:</span>
</span></span><span class=line><span class=cl><span class=c1># Default-Start:     2 3 4 5</span>
</span></span><span class=line><span class=cl><span class=c1># Default-Stop:      0 1 6</span>
</span></span><span class=line><span class=cl><span class=c1># Short-Description: shadowsocks is a lightweight tunneling proxy</span>
</span></span><span class=line><span class=cl><span class=c1># Description:       Modified from Linode&#39;s nginx fastcgi startup script</span>
</span></span><span class=line><span class=cl><span class=c1>### END INIT INFO</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Note: this script requires sudo in order to run shadowsocks as the specified</span>
</span></span><span class=line><span class=cl><span class=c1># user. </span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>BIN</span><span class=o>=</span>/usr/bin/shadowsocks-local
</span></span><span class=line><span class=cl><span class=nv>CONFIG_FILE</span><span class=o>=</span>/etc/shadowsocks/config.json
</span></span><span class=line><span class=cl><span class=nv>LOG_FILE</span><span class=o>=</span>/var/log/shadowsocks
</span></span><span class=line><span class=cl><span class=nv>USER</span><span class=o>=</span>nobody
</span></span><span class=line><span class=cl><span class=nv>GROUP</span><span class=o>=</span>nobody
</span></span><span class=line><span class=cl><span class=nv>PID_DIR</span><span class=o>=</span>/var/run
</span></span><span class=line><span class=cl><span class=nv>PID_FILE</span><span class=o>=</span><span class=nv>$PID_DIR</span>/shadowsocks.pid
</span></span><span class=line><span class=cl><span class=nv>RET_VAL</span><span class=o>=</span><span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span> -x <span class=nv>$BIN</span> <span class=o>]</span> <span class=o>||</span> <span class=nb>exit</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>check_running<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[[</span> -r <span class=nv>$PID_FILE</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>read</span> PID &lt;<span class=nv>$PID_FILE</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>[[</span> -d <span class=s2>&#34;/proc/</span><span class=nv>$PID</span><span class=s2>&#34;</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span>
</span></span><span class=line><span class=cl>      rm -f <span class=nv>$PID_FILE</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_status<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  check_running
</span></span><span class=line><span class=cl>  <span class=k>case</span> <span class=nv>$?</span> in
</span></span><span class=line><span class=cl>    0<span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=nb>echo</span> <span class=s2>&#34;shadowsocks running with PID </span><span class=nv>$PID</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>;;</span>
</span></span><span class=line><span class=cl>    1<span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=nb>echo</span> <span class=s2>&#34;shadowsocks not running, remove PID file </span><span class=nv>$PID_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>;;</span>
</span></span><span class=line><span class=cl>    2<span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=nb>echo</span> <span class=s2>&#34;Could not find PID file </span><span class=nv>$PID_FILE</span><span class=s2>, shadowsocks does not appear to be running&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>;;</span>
</span></span><span class=line><span class=cl>  <span class=k>esac</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_start<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[[</span> ! -d <span class=nv>$PID_DIR</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;creating PID dir&#34;</span>
</span></span><span class=line><span class=cl>    mkdir <span class=nv>$PID_DIR</span> <span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;failed creating PID directory </span><span class=nv>$PID_DIR</span><span class=s2>&#34;</span><span class=p>;</span> <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    chown <span class=nv>$USER</span>:<span class=nv>$GROUP</span> <span class=nv>$PID_DIR</span> <span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;failed creating PID directory </span><span class=nv>$PID_DIR</span><span class=s2>&#34;</span><span class=p>;</span> <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>    chmod <span class=m>0770</span> <span class=nv>$PID_DIR</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> check_running<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;shadowsocks already running with PID </span><span class=nv>$PID</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[[</span> ! -r <span class=nv>$CONFIG_FILE</span> <span class=o>]]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;config file </span><span class=nv>$CONFIG_FILE</span><span class=s2> not found&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;starting shadowsocks&#34;</span>
</span></span><span class=line><span class=cl>  <span class=c1># sudo will set the group to the primary group of $USER</span>
</span></span><span class=line><span class=cl>  sudo -u <span class=nv>$USER</span> <span class=nv>$BIN</span> -c <span class=nv>$CONFIG_FILE</span> &gt;&gt;<span class=nv>$LOG_FILE</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>  <span class=nv>PID</span><span class=o>=</span><span class=nv>$!</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=nv>$PID</span> &gt; <span class=nv>$PID_FILE</span>
</span></span><span class=line><span class=cl>  sleep 0.3
</span></span><span class=line><span class=cl>  <span class=k>if</span> ! check_running<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;start failed&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=m>1</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> <span class=s2>&#34;shadowsocks running with PID </span><span class=nv>$PID</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=m>0</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_stop<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> check_running<span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;stopping shadowsocks with PID </span><span class=nv>$PID</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nb>kill</span> <span class=nv>$PID</span>
</span></span><span class=line><span class=cl>    rm -f <span class=nv>$PID_FILE</span>
</span></span><span class=line><span class=cl>  <span class=k>else</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Could not find PID file </span><span class=nv>$PID_FILE</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>do_restart<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  do_stop
</span></span><span class=line><span class=cl>  do_start
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>case</span> <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> in
</span></span><span class=line><span class=cl>  start<span class=p>|</span>stop<span class=p>|</span>restart<span class=p>|</span>status<span class=o>)</span>
</span></span><span class=line><span class=cl>    do_<span class=nv>$1</span>
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl>  *<span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>echo</span> <span class=s2>&#34;Usage: shadowsocks {start|stop|restart|status}&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>RET_VAL</span><span class=o>=</span><span class=m>1</span>
</span></span><span class=line><span class=cl>    <span class=p>;;</span>
</span></span><span class=line><span class=cl><span class=k>esac</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>exit</span> <span class=nv>$RET_VAL</span>
</span></span></code></pre></div><p>You can use <code>update-rc.d</code> command to update the system service definitions.</p><h4 id=systemd-unit-file>Systemd Unit file</h4><p>Example (<code>/etc/systemd/system/shadowsocks.service</code>)</p><ol><li>Prepare the executable file with the custom service.</li><li>Create a unit file in the /etc/systemd/system/ directory and make sure it has correct file permissions. Execute as root:</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>touch /etc/systemd/system/shadowsocks.service
</span></span><span class=line><span class=cl>chmod <span class=m>644</span> /etc/systemd/system/shadowsocks.service
</span></span></code></pre></div><ol start=3><li>Edit <code>shadowsocks.service</code> file</li></ol><ul><li>Shadowsocks-local</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-systemd data-lang=systemd><span class=line><span class=cl><span class=k>[Unit]</span>
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Shadowsocks local daemon</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Service]</span>
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/shadowsocks-local -c /etc/shadowsocks/config.json</span>
</span></span><span class=line><span class=cl><span class=na>PIDFile</span><span class=o>=</span><span class=s>/var/run/shadowsocks.pid</span>
</span></span><span class=line><span class=cl><span class=na>KillMode</span><span class=o>=</span><span class=s>process</span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure</span>
</span></span><span class=line><span class=cl><span class=na>RestartSec</span><span class=o>=</span><span class=s>42s</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>[Install]</span>
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>default.target</span>
</span></span></code></pre></div><ul><li>Shadowsocks-server</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-systemd data-lang=systemd><span class=line><span class=cl><span class=err>[Unit]</span>                                                                          
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Go Shadowsocks server daemon                                          </span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target network-online.target multi-user.target</span>
</span></span><span class=line><span class=cl>                                                                                 
</span></span><span class=line><span class=cl><span class=err>[Service]</span>                                                                        
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/shadowsocks-server -u -c /etc/shadowsocks/config.json  </span>
</span></span><span class=line><span class=cl><span class=na>ExecReload</span><span class=o>=</span><span class=s>/bin/kill -HUP $MAINPID</span>
</span></span><span class=line><span class=cl><span class=na>PIDFile</span><span class=o>=</span><span class=s>/var/run/shadowsocks.pid                                                 </span>
</span></span><span class=line><span class=cl><span class=na>KillMode</span><span class=o>=</span><span class=s>process                                                                 </span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure                                                               </span>
</span></span><span class=line><span class=cl><span class=na>TimeoutStopSec</span><span class=o>=</span><span class=s>30</span>
</span></span><span class=line><span class=cl>                                                                                 
</span></span><span class=line><span class=cl><span class=err>[Install]</span>                                                                        
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target </span>
</span></span><span class=line><span class=cl><span class=na>Alias</span><span class=o>=</span><span class=s>ss-server.service</span>
</span></span></code></pre></div><ul><li>Proxy setting</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Environment=&#34;HTTP_PROXY=http://127.0.0.1:8118&#34;
</span></span><span class=line><span class=cl>Environment=&#34;HTTPS_PROXY=http://127.0.0.1:8118&#34;
</span></span><span class=line><span class=cl>Environment=&#34;NO_PROXY=pi.lan,127.0.0.1&#34;
</span></span></code></pre></div><p>Check Environment setting [example home-assistant-@pi.servie]:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo systemctl show home-assistant@pi.service --property Environment
</span></span><span class=line><span class=cl><span class=c1># Output:</span>
</span></span><span class=line><span class=cl><span class=c1># Environment=HTTP_PROXY=http://127.0.0.1:8118 HTTPS_PROXY=http://127.0.0.1:8118 NO_PROXY=pi.lan,127.0.0.1</span>
</span></span></code></pre></div><ol start=4><li>Notify systemd that a new shadowsocks.service file exists by executing the
following command as root</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>systemctl daemon-reload
</span></span><span class=line><span class=cl><span class=c1># start shadowsocks service</span>
</span></span><span class=line><span class=cl>systemctl start shadowsocks.service
</span></span></code></pre></div><p>You can check its status now by <code>service shadowsocks status</code>
To add it to startup, using <code>systemctl enable shadowsocks</code></p><ul><li>Check details of running status</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>service shadowsocks status -l
</span></span><span class=line><span class=cl><span class=c1># or</span>
</span></span><span class=line><span class=cl>journalctl -xe
</span></span></code></pre></div><p><em>upstart job is configured in <code>/etc/init/</code></em></p><ol start=5><li>Shell script with systemd unit</li></ol><p><em>A sample with java web application.</em></p><p>dummy service</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-systemd data-lang=systemd><span class=line><span class=cl><span class=err>[Unit]</span>                                                                          
</span></span><span class=line><span class=cl><span class=na>Description</span><span class=o>=</span><span class=s>Dummy daemon                                          </span>
</span></span><span class=line><span class=cl><span class=na>Wants</span><span class=o>=</span><span class=s>network-online.target</span>
</span></span><span class=line><span class=cl><span class=na>After</span><span class=o>=</span><span class=s>network.target network-online.target multi-user.target</span>
</span></span><span class=line><span class=cl>                                                                                 
</span></span><span class=line><span class=cl><span class=err>[Service]</span>                                                                        
</span></span><span class=line><span class=cl><span class=na>ExecStart</span><span class=o>=</span><span class=s>/usr/bin/dummy </span>
</span></span><span class=line><span class=cl><span class=na>ExecReload</span><span class=o>=</span><span class=s>/bin/kill -HUP $MAINPID</span>
</span></span><span class=line><span class=cl><span class=na>PIDFile</span><span class=o>=</span><span class=s>/var/run/dummy.pid                                                 </span>
</span></span><span class=line><span class=cl><span class=na>KillMode</span><span class=o>=</span><span class=s>process                                                                 </span>
</span></span><span class=line><span class=cl><span class=na>Restart</span><span class=o>=</span><span class=s>on-failure                                                               </span>
</span></span><span class=line><span class=cl><span class=na>TimeoutStopSec</span><span class=o>=</span><span class=s>30</span>
</span></span><span class=line><span class=cl>                                                                                 
</span></span><span class=line><span class=cl><span class=err>[Install]</span>                                                                        
</span></span><span class=line><span class=cl><span class=na>WantedBy</span><span class=o>=</span><span class=s>multi-user.target </span>
</span></span></code></pre></div><p>dummy script to start</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>#/bin/bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>JAVA_HOME</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>JAVA_HOME</span><span class=k>:-</span><span class=p>/usr/lib/jvm/default</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>JAVA_OPTS</span><span class=o>=</span><span class=s2>&#34;-XX:+UnlockExperimentalVMOptions -XX:-UseJVMCICompiler&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>JAVA_OPTS</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>JAVA_OPTS</span><span class=si>}</span><span class=s2> -Xms1024m -Xmx2048m -XX:PermSize=32m&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>DUMMY_PROGRAM</span><span class=o>=</span><span class=s2>&#34;/opt/dummy/dummy.jar&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>START_CMD</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>JAVA_HOME</span><span class=si>}</span><span class=s2>/bin/java </span><span class=si>${</span><span class=nv>JAVA_OPTS</span><span class=si>}</span><span class=s2> -jar </span><span class=si>${</span><span class=nv>DUMMY_PROGRAM</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>LOG_FILE</span><span class=o>=</span>/var/log/dummy
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>init<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	touch <span class=si>${</span><span class=nv>LOG_FILE</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>check_running<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	logger -i -t <span class=s2>&#34;It&#39;s running&#34;</span> -f <span class=si>${</span><span class=nv>LOG_FILE</span><span class=si>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>check_deps<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;Ok&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>start<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>eval</span> <span class=si>${</span><span class=nv>START_CMD</span><span class=si>}</span>
</span></span><span class=line><span class=cl>	<span class=nb>echo</span> <span class=s2>&#34;It&#39;s started&#34;</span>		
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main<span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl> init
</span></span><span class=line><span class=cl> check_running
</span></span><span class=line><span class=cl> check_deps
</span></span><span class=line><span class=cl> start <span class=p>&amp;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>main <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span>
</span></span></code></pre></div><h2 id=reference>Reference</h2><ul><li><a href=https://wiki.ubuntu.com/systemd>https://wiki.ubuntu.com/systemd</a></li><li><a href=https://wiki.debian.org/Debate/initsystem/sysvinit>https://wiki.debian.org/Debate/initsystem/sysvinit</a></li><li><a href=http://0pointer.de/public/systemd-man/>http://0pointer.de/public/systemd-man/</a></li><li><a href=https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Unit_Files.html>https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html/System_Administrators_Guide/sect-Managing_Services_with_systemd-Unit_Files.html</a></li><li><a href=https://home-assistant.io/docs/autostart/systemd/>https://home-assistant.io/docs/autostart/systemd/</a></li></ul><div id=react-app-components data-post-id=d0571fda140d7a0f4149a60b792d1645></div></article><button class=mobile-toc-trigger aria-controls=mobile-toc aria-expanded=false title=Index>☰</button><div class=mobile-toc-overlay hidden></div><div id=mobile-toc class=mobile-toc-drawer aria-hidden=true role=dialog aria-label=Index><div class=mobile-toc-header><button class=mobile-toc-close aria-label=close>×</button></div><nav class=mobile-toc-body><div class=mobile-toc-list></div></nav><div class=mobile-safe-area-spacer></div></div><script type=module src=/react/page.bundle.js></script></main><footer><div class=copyright><small>Made with <span style=color:#e25555>&#9829;</span> in Guangzhou by
©<a href=https://github.com/qtopie>qtopie</a> 2026
</small><small>Posts licensed under <a href=https://creativecommons.org/licenses/by/4.0/legalcode>CC BY 4.0</small></div><div><script type=module src=/react/base.bundle.js></script></div></footer></body></html>