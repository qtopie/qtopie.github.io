<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Hostapd
  #

hostapd is a user space daemon for access point and authentication server.
Please follow the guide of Official documentation

  Installation and configuration
  #

Tested on raspbian with raspberry pi 3

  Install hostapd and configure it
  #

sudo apt-get install hostapd -y --force-yes,
also sudo apt-get install haveged

Edit hostapd.conf:

/etc/hostapd/hostapd.conf
interface=wlan0
ssid=RPi
wpa_passphrase=raspberrypi
auth_algs=1
wpa=2
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP
channel=10
hw_mode=g
There should not be any whitespace at the end of each line"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qtopie.github.io/notes/linux/hostapd-wifi/"><meta property="og:site_name" content="Blog | qtopierw"><meta property="og:title" content="Wifi with hostapd"><meta property="og:description" content="Hostapd # hostapd is a user space daemon for access point and authentication server.
Please follow the guide of Official documentation
Installation and configuration # Tested on raspbian with raspberry pi 3
Install hostapd and configure it # sudo apt-get install hostapd -y --force-yes, also sudo apt-get install haveged
Edit hostapd.conf: /etc/hostapd/hostapd.conf
interface=wlan0 ssid=RPi wpa_passphrase=raspberrypi auth_algs=1 wpa=2 wpa_key_mgmt=WPA-PSK rsn_pairwise=CCMP channel=10 hw_mode=g There should not be any whitespace at the end of each line"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="notes"><meta property="article:published_time" content="2016-08-30T19:06:18+08:00"><meta property="article:modified_time" content="2016-08-30T19:06:18+08:00"><meta property="article:tag" content="Hostapd"><title>Wifi with hostapd | Blog | qtopierw</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qtopie.github.io/notes/linux/hostapd-wifi/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.6b0a5247a29534ab597c09c6ba111855ef60594896512109921af15ed6e3e547.js integrity="sha256-awpSR6KVNKtZfAnGuhEYVe9gWUiWUSEJkhrxXtbj5Uc=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Blog | qtopierw</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>Wifi with hostapd</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#hostapd><a href=https://w1.fi/hostapd/>Hostapd</a></a></li><li><a href=#installation-and-configuration>Installation and configuration</a><ul><li><a href=#install-hostapd-and-configure-it>Install hostapd and configure it</a></li><li><a href=#dhcp-ip-address>dhcp ip address</a></li><li><a href=#port-forwarding-and-nat-traffic>Port forwarding and NAT traffic</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><h2 id=hostapd><a href=https://w1.fi/hostapd/>Hostapd</a>
<a class=anchor href=#hostapd>#</a></h2><p>hostapd is a user space daemon for access point and authentication server.</p><p><strong>Please follow the guide of <a href=https://www.raspberrypi.org/documentation/configuration/wireless/access-point.md>Official documentation</a></strong></p><h2 id=installation-and-configuration>Installation and configuration
<a class=anchor href=#installation-and-configuration>#</a></h2><p><em>Tested on raspbian with raspberry pi 3</em></p><h3 id=install-hostapd-and-configure-it>Install hostapd and configure it
<a class=anchor href=#install-hostapd-and-configure-it>#</a></h3><p><code>sudo apt-get install hostapd -y --force-yes</code>,
also <code>sudo apt-get install haveged</code></p><ul><li>Edit <code>hostapd.conf</code>:</li></ul><p><em><code>/etc/hostapd/hostapd.conf</code></em></p><pre tabindex=0><code>interface=wlan0
ssid=RPi
wpa_passphrase=raspberrypi
auth_algs=1
wpa=2
wpa_key_mgmt=WPA-PSK
rsn_pairwise=CCMP
channel=10
hw_mode=g
</code></pre><p><strong>There should not be any whitespace at the end of each line</strong></p><p>then modify file <code>/etc/default/hostapd</code> to let the configuration work
automatically.</p><p>You may turn of the wifi and test it with : <code>hostapd -d /etc/hostapd/hostapd.conf</code>
you will see the ssid <code>RPi</code> in wireless network list, but you cannot connect to
it yet.</p><p><em>Tips: if you have trouble with testing, try <code>ifdown wlan0</code> (in raspbian) to bring down wifi
device ( rfkill with network-manager)</em></p><h3 id=dhcp-ip-address>dhcp ip address
<a class=anchor href=#dhcp-ip-address>#</a></h3><ul><li>setting static ip address
<code>sudo vim /etc/network/interfaces</code></li></ul><p>supposed the interface name is wlan0:</p><pre tabindex=0><code>allow-hotplug wlan0
iface wlan0 inet static
	address 10.0.0.1
 	netmask 255.255.255.0
 	network 10.0.0.0
 	broadcast 10.0.0.255
</code></pre><p>also make dhcpcd not manage wlan0 interface</p><pre tabindex=0><code>	echo &#34;denyinterfaces wlan0&#34; &gt;&gt; /etc/dhcpcd.conf 
</code></pre><ul><li>dnsmasq
<code>sudo apt-get install dnsmasq</code></li></ul><p>configuration</p><pre tabindex=0><code>interface=wlan0
dhcp-range=10.0.0.100,10.0.0.150,255.255.255.0,12h

# dns
domain-needed
listen-address=127.0.0.1,10.0.0.1
listen-address=::1
#resolv-file=/etc/resolv.dnsmasq.conf
#local=/pi.lan/
#domain=pi.lan
#expand-hosts

# address=/#/10.0.0.1
#address=/pi.lan/10.0.0.1

dhcp-option=option:router,10.0.0.1 
# raspberry pi 2
#dhcp-host=raspberrypi2,10.0.0.102,36h
cache-size=600 # default is 150

log-async=20
</code></pre><p>you may test it with <code>dnsmasq --test</code></p><h3 id=port-forwarding-and-nat-traffic>Port forwarding and NAT traffic
<a class=anchor href=#port-forwarding-and-nat-traffic>#</a></h3><p>Find and uncomment these lines in file <code>/etc/sysctl.conf</code>:</p><pre tabindex=0><code>net.ipv4.ip_forward=1
net.ipv6.conf.all.forwarding=1
</code></pre><p>add following lines before line <code>exit 0</code> to have NAT traffic forwarded:</p><pre tabindex=0><code>iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE  
iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED
-j ACCEPT  
iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT  
</code></pre><ul><li>Or to make the rules to be applied every time on boot, run:</li></ul><pre tabindex=0><code>    sudo sh -c &#34;iptables-save &gt; /etc/iptables.ipv4.nat&#34;
    ```
   to save the rules to the file `/etc/iptables.ipv4.nat` 

 Make it restore on boot by add
	 ```
 	 iptables-restore &lt; /etc/iptables.ipv4.nat
	 ```
 in /etc/rc.local above the `exit 0` line.
 


## Now you may reboot the os to make it work well and have a try.

## Reference:
1. (http://www.ibm.com/developerworks/cn/linux/l-wifiencrypthostapd/)
2. (https://wireless.wiki.kernel.org/en/users/documentation/hostapd)
3. (https://help.ubuntu.com/community/NetworkConfigurationCommandLine/Automatic)
4. https://help.ubuntu.com/community/WifiDocs/WirelessAccessPoint

Other: [scripts](https://github.com/oblique/create_ap)
</code></pre></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#hostapd><a href=https://w1.fi/hostapd/>Hostapd</a></a></li><li><a href=#installation-and-configuration>Installation and configuration</a><ul><li><a href=#install-hostapd-and-configure-it>Install hostapd and configure it</a></li><li><a href=#dhcp-ip-address>dhcp ip address</a></li><li><a href=#port-forwarding-and-nat-traffic>Port forwarding and NAT traffic</a></li></ul></li></ul></nav></div></aside></main></body></html>