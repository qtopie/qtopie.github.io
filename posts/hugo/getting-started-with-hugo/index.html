<!doctype html><html lang=en-us dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本文主要分享如何使用Hugo生成静态站点，并部署到firebase (Hosting服务）上。
updated: 2021/9/29

  静态站点
  #

静态站点，相比于动态站点（一般指需要请求后端动态生成网站内容）来说，网站内容已提前渲染好，对搜索引擎更加友好。而且网站内容一般可以直接生成静态的html/css页面, 减少浏览器js渲染，网络传输时也可以充分利用缓存, 这样网页加载也比较快， 使用户体验更好。
更进一步地，Google和Twitter合作开发了AMP(Accelerated Mobile Pages)技术, 通过限定HTML标签和CSS，以及CDN缓存，提升移动设备(相比于PC端：弱网、低性能）对网站的访问速度。
本站点就是采用了AMP技术构建, 使用静态站点生成工具根据模板，将markdown文件渲染输出为静态AMP页面。

  生成工具
  #

静态站点生成工具有很多，我主要用过的有以下两个。（目前又换回了Hugo)

Hugo
Scully


PS, Hugo刚发布不久我就开始使用了，当时对这个新工具很喜欢，它是一个单独的二进制文件, 且渲染很快，模板丰富。但后面想定制一些功能（那时Hugo的文档比较少，仅官网使用文档， 且功能也没现在这么丰富), 但go的语法还是比较复杂的，也没太多时间看源码。因此当Scully出现的时候，我就立即使用了它（因为本人还是一个Angular粉），相比于Hugo，Scully几乎等同于你可以通过编写Angular应用定制你的网站, 因此十分灵活（主要的缺点是主题和应用代码分开进程渲染，调试略麻烦）。但后面发现，我本身写博客主题的时间可能比我写博客还花的多：》，也是该冷静下想想我的初衷是什么了。其实就是为了记录一些知识并分享，因此AMP才是我的需要。所以我决定我的博客主题的核心是简洁并对阅读友好, 而不是增添许多看其来很有趣的功能。

  博客主题
  #

这里列出我用过的博客主题


Hugo

Robust
amp-blog-theme



Scully

mdblog-theme



以下内容主要介绍Hugo使用

  安装和创建站点
  #


  目标
  #


在本地电脑安装hugo, 在github上创建私有仓库posts，存放markdown源码及图片等文件；
在github创建私有仓库qtopie.web.app（作为集成仓库）, 对应于站点名称，存放站点配置文件。
创建firebase hosting项目，将站点qtopie.web.app发布到firebase.

仓库创建过程省略

  Hugo安装
  #

以在Ubuntu 20.04上为例
sudo snap install hugo

  本地生成站点
  #

初始化git各模块
// git clone ... ; cd <repo>
hugo new site .

git submodule add https://github.com/qtopierw/amp-blog-theme.git themes/amp-blog-theme
git submodule add git@github.com:<username>/posts.git content/posts
创建.gitignore文件, 并加入public目录"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://qtopie.github.io/posts/hugo/getting-started-with-hugo/"><meta property="og:site_name" content="Blog | qtopierw"><meta property="og:title" content="使用Hugo生成静态站点"><meta property="og:description" content="本文主要分享如何使用Hugo生成静态站点，并部署到firebase (Hosting服务）上。
updated: 2021/9/29
静态站点 # 静态站点，相比于动态站点（一般指需要请求后端动态生成网站内容）来说，网站内容已提前渲染好，对搜索引擎更加友好。而且网站内容一般可以直接生成静态的html/css页面, 减少浏览器js渲染，网络传输时也可以充分利用缓存, 这样网页加载也比较快， 使用户体验更好。
更进一步地，Google和Twitter合作开发了AMP(Accelerated Mobile Pages)技术, 通过限定HTML标签和CSS，以及CDN缓存，提升移动设备(相比于PC端：弱网、低性能）对网站的访问速度。
本站点就是采用了AMP技术构建, 使用静态站点生成工具根据模板，将markdown文件渲染输出为静态AMP页面。
生成工具 # 静态站点生成工具有很多，我主要用过的有以下两个。（目前又换回了Hugo)
Hugo Scully PS, Hugo刚发布不久我就开始使用了，当时对这个新工具很喜欢，它是一个单独的二进制文件, 且渲染很快，模板丰富。但后面想定制一些功能（那时Hugo的文档比较少，仅官网使用文档， 且功能也没现在这么丰富), 但go的语法还是比较复杂的，也没太多时间看源码。因此当Scully出现的时候，我就立即使用了它（因为本人还是一个Angular粉），相比于Hugo，Scully几乎等同于你可以通过编写Angular应用定制你的网站, 因此十分灵活（主要的缺点是主题和应用代码分开进程渲染，调试略麻烦）。但后面发现，我本身写博客主题的时间可能比我写博客还花的多：》，也是该冷静下想想我的初衷是什么了。其实就是为了记录一些知识并分享，因此AMP才是我的需要。所以我决定我的博客主题的核心是简洁并对阅读友好, 而不是增添许多看其来很有趣的功能。
博客主题 # 这里列出我用过的博客主题
Hugo
Robust amp-blog-theme Scully
mdblog-theme 以下内容主要介绍Hugo使用
安装和创建站点 # 目标 # 在本地电脑安装hugo, 在github上创建私有仓库posts，存放markdown源码及图片等文件； 在github创建私有仓库qtopie.web.app（作为集成仓库）, 对应于站点名称，存放站点配置文件。 创建firebase hosting项目，将站点qtopie.web.app发布到firebase. 仓库创建过程省略
Hugo安装 # 以在Ubuntu 20.04上为例
sudo snap install hugo 本地生成站点 # 初始化git各模块
// git clone ... ; cd <repo> hugo new site . git submodule add https://github.com/qtopierw/amp-blog-theme.git themes/amp-blog-theme git submodule add git@github.com:<username>/posts.git content/posts 创建.gitignore文件, 并加入public目录"><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-05-02T00:06:17+08:00"><meta property="article:modified_time" content="2016-05-02T00:06:17+08:00"><meta property="article:tag" content="Hugo"><title>使用Hugo生成静态站点 | Blog | qtopierw</title>
<link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://qtopie.github.io/posts/hugo/getting-started-with-hugo/><link rel=stylesheet href=/book.min.6c8b9d2a1fc95075ed7da46ca81060b39add8fff6741ac51259f768929281e2c.css integrity="sha256-bIudKh/JUHXtfaRsqBBgs5rdj/9nQaxRJZ92iSkoHiw=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/en.search.min.d068e298764bebd377892ee728ef88919a2ae62519b35fcd4c9bc8f4f911fc7d.js integrity="sha256-0GjimHZL69N3iS7nKO+IkZoq5iUZs1/NTJvI9PkR/H0=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/><span>Blog | qtopierw</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/svg/menu.svg class=book-icon alt=Menu></label><h3>使用Hugo生成静态站点</h3><label for=toc-control><img src=/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#静态站点>静态站点</a><ul><li><a href=#生成工具>生成工具</a></li><li><a href=#博客主题>博客主题</a></li></ul></li><li><a href=#安装和创建站点>安装和创建站点</a><ul><li><a href=#目标>目标</a></li><li><a href=#hugo安装>Hugo安装</a></li><li><a href=#本地生成站点>本地生成站点</a></li></ul></li><li><a href=#将应用发布到firebase>将应用发布到firebase</a><ul><li><a href=#firebase工具安装>firebase工具安装</a></li><li><a href=#发布>发布</a></li><li><a href=#使用github-ci自动发布>使用github ci自动发布</a></li><li><a href=#使用azure-pipelines发布静态站点到github-pages>使用Azure Pipelines发布静态站点到GitHub Pages</a></li></ul></li><li><a href=#参考>参考</a></li></ul></nav></aside></header><article class="markdown book-post"><h2>使用Hugo生成静态站点</h2><div class="flex align-center text-small book-post-date"><img src=/svg/calendar.svg class=book-icon alt>
<span>May 2, 2016</span></div><div class=text-small><a href=/categories/tool/>Tool</a></div><div class=text-small><a href=/tags/hugo/>Hugo</a></div><div class=book-post-content><p>本文主要分享如何使用Hugo生成静态站点，并部署到firebase (Hosting服务）上。</p><p>updated: 2021/9/29</p><h2 id=静态站点>静态站点
<a class=anchor href=#%e9%9d%99%e6%80%81%e7%ab%99%e7%82%b9>#</a></h2><p>静态站点，相比于动态站点（一般指需要请求后端动态生成网站内容）来说，网站内容已提前渲染好，对搜索引擎更加友好。而且网站内容一般可以直接生成静态的html/css页面, 减少浏览器js渲染，网络传输时也可以充分利用缓存, 这样网页加载也比较快， 使用户体验更好。</p><p>更进一步地，Google和Twitter合作开发了AMP(Accelerated Mobile Pages)技术, 通过限定HTML标签和CSS，以及CDN缓存，提升移动设备(相比于PC端：弱网、低性能）对网站的访问速度。</p><p>本站点就是采用了AMP技术构建, 使用静态站点生成工具根据模板，将markdown文件渲染输出为静态AMP页面。</p><h3 id=生成工具>生成工具
<a class=anchor href=#%e7%94%9f%e6%88%90%e5%b7%a5%e5%85%b7>#</a></h3><p>静态站点生成工具有很多，我主要用过的有以下两个。（目前又换回了Hugo)</p><ul><li><a href=https://gohugo.io/>Hugo</a></li><li><a href=https://scully.io/>Scully</a></li></ul><blockquote><p>PS, Hugo刚发布不久我就开始使用了，当时对这个新工具很喜欢，它是一个单独的二进制文件, 且渲染很快，模板丰富。但后面想定制一些功能（那时Hugo的文档比较少，仅官网使用文档， 且功能也没现在这么丰富), 但go的语法还是比较复杂的，也没太多时间看源码。因此当Scully出现的时候，我就立即使用了它（因为本人还是一个Angular粉），相比于Hugo，Scully几乎等同于你可以通过编写Angular应用定制你的网站, 因此十分灵活（主要的缺点是主题和应用代码分开进程渲染，调试略麻烦）。但后面发现，我本身写博客主题的时间可能比我写博客还花的多：》，也是该冷静下想想我的初衷是什么了。其实就是为了记录一些知识并分享，因此AMP才是我的需要。所以我决定我的博客主题的核心是简洁并对阅读友好, 而不是增添许多看其来很有趣的功能。</p></blockquote><h3 id=博客主题>博客主题
<a class=anchor href=#%e5%8d%9a%e5%ae%a2%e4%b8%bb%e9%a2%98>#</a></h3><p>这里列出我用过的博客主题</p><ul><li><p>Hugo</p><ul><li><a href>Robust</a></li><li><a href>amp-blog-theme</a></li></ul></li><li><p>Scully</p><ul><li><a href>mdblog-theme</a></li></ul></li></ul><p><em>以下内容主要介绍Hugo使用</em></p><h2 id=安装和创建站点>安装和创建站点
<a class=anchor href=#%e5%ae%89%e8%a3%85%e5%92%8c%e5%88%9b%e5%bb%ba%e7%ab%99%e7%82%b9>#</a></h2><h3 id=目标>目标
<a class=anchor href=#%e7%9b%ae%e6%a0%87>#</a></h3><ul><li>在本地电脑安装hugo, 在github上创建私有仓库<code>posts</code>，存放markdown源码及图片等文件；</li><li>在github创建私有仓库<code>qtopie.web.app</code>（作为集成仓库）, 对应于站点名称，存放站点配置文件。</li><li>创建firebase hosting项目，将站点<code>qtopie.web.app</code>发布到firebase.</li></ul><p><em>仓库创建过程省略</em></p><h3 id=hugo安装>Hugo安装
<a class=anchor href=#hugo%e5%ae%89%e8%a3%85>#</a></h3><p>以在Ubuntu 20.04上为例</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo snap install hugo
</span></span></code></pre></div><h3 id=本地生成站点>本地生成站点
<a class=anchor href=#%e6%9c%ac%e5%9c%b0%e7%94%9f%e6%88%90%e7%ab%99%e7%82%b9>#</a></h3><p>初始化git各模块</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>// git clone ... ; <span style=color:#366>cd</span> &lt;repo&gt;
</span></span><span style=display:flex><span>hugo new site .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>git submodule add https://github.com/qtopierw/amp-blog-theme.git themes/amp-blog-theme
</span></span><span style=display:flex><span>git submodule add git@github.com:&lt;username&gt;/posts.git content/posts
</span></span></code></pre></div><p>创建<code>.gitignore</code>文件, 并加入<code>public</code>目录</p><p>现在可以使用<code>hugo</code>命令生成站点了（将输出到<code>public</code>目录），或使用<code>hugo server</code>命令进入开发模式</p><h2 id=将应用发布到firebase>将应用发布到firebase
<a class=anchor href=#%e5%b0%86%e5%ba%94%e7%94%a8%e5%8f%91%e5%b8%83%e5%88%b0firebase>#</a></h2><h3 id=firebase工具安装>firebase工具安装
<a class=anchor href=#firebase%e5%b7%a5%e5%85%b7%e5%ae%89%e8%a3%85>#</a></h3><p>firbase是一个nodejs应用工具包，需要使用<code>npm</code>或者<code>yarn</code>安装</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo yarn global add firebase-tools
</span></span></code></pre></div><h3 id=发布>发布
<a class=anchor href=#%e5%8f%91%e5%b8%83>#</a></h3><ul><li>登录firebase账号</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>firebase login
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#09f;font-style:italic># 如果需要使用代理</span>
</span></span><span style=display:flex><span>proxychains4 firebase login
</span></span></code></pre></div><ul><li>初始化项目</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>firebase init
</span></span></code></pre></div><p>选择发布到firebase hosting和生成github CI (选择不覆盖public目录下的静态文件）</p><p>可以将github ci修改如下</p><p><strong>.github/workflows/firebase-hosting-merge.yml</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#09f;font-style:italic># This file was auto-generated by the Firebase CLI</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic># https://github.com/firebase/firebase-tools</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>Deploy to Firebase Hosting on merge<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>&#39;on&#39;</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>push</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>branches</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- main<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#09f;font-style:italic># 新增部分</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>repository_dispatch</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>types</span>:<span style=color:#bbb> </span>sub_commit<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>jobs</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>build_and_deploy</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>runs-on</span>:<span style=color:#bbb> </span>ubuntu-20.04<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>steps</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#09f;font-style:italic># 修改部分 - start</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>uses</span>:<span style=color:#bbb> </span>actions/checkout@v2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>with</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>submodules</span>:<span style=color:#bbb> </span>recursive<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>token</span>:<span style=color:#bbb> </span>${{ secrets.PRIVATE_REPO_ACCESS_TOKEN }}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>PullLatestPosts<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>run</span>:<span style=color:#bbb> </span>git submodule update --recursive --remote<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>generate sites<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>run</span>:<span style=color:#bbb> </span>sudo snap install hugo &amp;&amp; hugo --minify<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#09f;font-style:italic># 修改部分 - end</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span>- <span style=color:#309;font-weight:700>uses</span>:<span style=color:#bbb> </span>FirebaseExtended/action-hosting-deploy@v0<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>with</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>repoToken</span>:<span style=color:#bbb> </span><span style=color:#c30>&#39;${{ secrets.GITHUB_TOKEN }}&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>firebaseServiceAccount</span>:<span style=color:#bbb> </span><span style=color:#c30>&#39;${{ secrets.FIREBASE_SERVICE_ACCOUNT_QTOPIE }}&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>channelId</span>:<span style=color:#bbb> </span>live<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>          </span><span style=color:#309;font-weight:700>projectId</span>:<span style=color:#bbb> </span>qtopie<span style=color:#bbb>
</span></span></span></code></pre></div><p>使用<code>firebase deploy</code>命令可以直接发布<code>public</code>目录下的文件到github</p><h3 id=使用github-ci自动发布>使用github ci自动发布
<a class=anchor href=#%e4%bd%bf%e7%94%a8github-ci%e8%87%aa%e5%8a%a8%e5%8f%91%e5%b8%83>#</a></h3><p>当博客主题创建好后，实际上我们很少需要修改它，更多的时候我们是在改markdown文件，即提交代码到<code>posts</code>仓库。</p><p>因此我们可以通过在<code>posts</code>仓库创建<code>github actions</code>，通过上面设置的<code>sub_commit</code>触发器，让集成仓库拉取各分支最新代码，构建站点和发布.</p><p><code>posts</code>仓库 github actions配置如下</p><p><strong>.github/workflows/trigger-events.yml</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>Dispatch Event<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>on</span>:<span style=color:#bbb> </span>[push]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>jobs</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>build</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>runs-on</span>:<span style=color:#bbb> </span>ubuntu-20.04<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>steps</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:#309;font-weight:700>uses</span>:<span style=color:#bbb> </span>actions/checkout@v2<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>- <span style=color:#309;font-weight:700>name</span>:<span style=color:#bbb> </span>dispatch event to another repository<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>env</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>GITHUB_TOKEN</span>:<span style=color:#bbb> </span>${{ secrets.PRIVATE_REPO_ACCESS_TOKEN }}<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>EVENT</span>:<span style=color:#bbb> </span>sub_commit<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>ORG</span>:<span style=color:#bbb> </span>qtopierw<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#309;font-weight:700>REPO</span>:<span style=color:#bbb> </span>qtopie.web.app<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:#309;font-weight:700>run</span>:<span style=color:#bbb> </span>|<span style=color:#c30;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>        curl --fail -d &#34;{\&#34;event_type\&#34;: \&#34;${EVENT}\&#34;}&#34; -H &#34;Content-Type: application/json&#34; -H &#34;Authorization: token ${GITHUB_TOKEN}&#34; -H &#34;Accept: application/vnd.github.everest-preview+json&#34; &#34;https://api.github.com/repos/${ORG}/${REPO}/dispatches&#34;</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>这里注意到，我们在两个仓库都使用了一个CI私有环境变量<code>PRIVATE_REPO_ACCESS_TOKEN</code>，这个token我们可以在<a href=https://github.com/settings/tokens>个人github settings页面生成</a>, <code>scope</code>选择<code>repo</code>(全勾)，然后将token复制后，在两个私有项目下分别创建一个Secret即可（名称<code>PRIVATE_REPO_ACCESS_TOKEN</code>, 值为复制的token)</p><blockquote><p>比如我的<code>posts</code>仓库设置secrets的链接为https://github.com/qtopierw/posts/settings/secrets/actions</p></blockquote><p>设置完毕后，提交<code>posts</code>仓库的更改就可以实现自动发布到站点了。</p><h3 id=使用azure-pipelines发布静态站点到github-pages>使用Azure Pipelines发布静态站点到GitHub Pages
<a class=anchor href=#%e4%bd%bf%e7%94%a8azure-pipelines%e5%8f%91%e5%b8%83%e9%9d%99%e6%80%81%e7%ab%99%e7%82%b9%e5%88%b0github-pages>#</a></h3><p><em>这是旧的内容，可忽略</em></p><p><a href=https://pages.github.com/>GitHub Pages</a> is really a great place to host static site, and to make it easier to publish your blog, you may want to you some CI pipeline to autmoate this.</p><p>You may want to keep your blog source files private while release static files in github page. Fortunately, github has already provided free private git repos. But to enable github page on private repo you need to <code>Upgrade to GitHub Pro or make this repository public to enable Pages.</code>, so for totally free hosting you have to create one public repo to host released static blog files.
And I just found <a href=https://azure.microsoft.com/en-us/services/devops/pipelines/>Azure Pipelines</a> provides 1 free CI job which can be used to automate publishing blogs, and here&rsquo;s an good tutorial for <a href=https://cloudblogs.microsoft.com/opensource/2019/04/05/publishing-github-pages-from-azure-pipelines/><code>Publishing GitHub Pages from Azure Pipelines</code></a>.</p><p>So now it becomes, what we&rsquo;re going to need:</p><ul><li>Register to use Azure Pipelines</li><li>One Github private repo to store blog source files and one public repo to host released github pages.</li></ul><p>On you private repo, add azure pipeline configuration:</p><div class=highlight><pre tabindex=0 style=background-color:#f0f3f3;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#09f;font-style:italic># Blog</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic># Build hugo blog in azure pipeline for private repo and publish it on public repo to use github pages</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#09f;font-style:italic># https://cloudblogs.microsoft.com/opensource/2019/04/05/publishing-github-pages-from-azure-pipelines/</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>trigger</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- master<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>pool</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>vmImage</span>:<span style=color:#bbb> </span><span style=color:#c30>&#39;ubuntu-latest&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#309;font-weight:700>steps</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#309;font-weight:700>script</span>:<span style=color:#bbb> </span>|<span style=color:#c30;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    if [ -f public ]; then rm -r public; fi
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    git clone https://your-repo.github.io.git public
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    git submodule init &amp;&amp; git submodule update</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>displayName</span>:<span style=color:#bbb> </span><span style=color:#c30>&#39;Clone Github Pages&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#309;font-weight:700>script</span>:<span style=color:#bbb> </span>|<span style=color:#c30;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    sudo snap install hugo
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    hugo</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>displayName</span>:<span style=color:#bbb> </span><span style=color:#c30>&#39;Generating docs&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#309;font-weight:700>task</span>:<span style=color:#bbb> </span>DownloadSecureFile@1<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>inputs</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#309;font-weight:700>secureFile</span>:<span style=color:#bbb> </span>deploy_key<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>displayName</span>:<span style=color:#bbb> </span><span style=color:#c30>&#39;Get the deploy key&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#309;font-weight:700>script</span>:<span style=color:#bbb> </span>|<span style=color:#c30;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    mkdir ~/.ssh &amp;&amp; mv $DOWNLOADSECUREFILE_SECUREFILEPATH ~/.ssh/id_rsa
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    chmod 700 ~/.ssh &amp;&amp; chmod 600 ~/.ssh/id_rsa
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    ssh-keyscan -t rsa github.com &gt;&gt; ~/.ssh/known_hosts</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>displayName</span>:<span style=color:#bbb> </span><span style=color:#c30>&#39;Setup git deploy key&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>- <span style=color:#309;font-weight:700>script</span>:<span style=color:#bbb> </span>|<span style=color:#c30;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    cd public
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    git config --local user.name &#34;your-name&#34;
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    git config --local user.email &#34;you-email@users.noreply.github.com&#34;
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    git add .
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    git commit -m &#34;Publishing GitHub Pages  ***NO_CI***&#34;
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    git remote set-url --push origin git@your-repo.github.io.git
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    git push origin HEAD:master</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>displayName</span>:<span style=color:#bbb> </span><span style=color:#c30>&#39;Publish GitHub Pages&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#309;font-weight:700>condition</span>:<span style=color:#bbb> </span>|<span style=color:#c30;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>    and(not(eq(variables[&#39;Build.Reason&#39;], &#39;PullRequest&#39;)),
</span></span></span><span style=display:flex><span><span style=color:#c30;font-style:italic>        eq(variables[&#39;Build.SourceBranch&#39;], &#39;refs/heads/master&#39;))</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>Note that in my experience, every time use <code>hugo</code> to generate sites, it will make file changes on <code>public/en/sitemap.xml</code>,
so no need to worry about <code>git commit</code> would fail.</p><p>On your public repo, add deployment key(recommend to use separate ssh key file on this repo for security reason, and write permission is needed). Then add the private ssh key named <code>deploy_key</code> in <code>azure pipelines -> Library -> secure file</code>.</p><h2 id=参考>参考
<a class=anchor href=#%e5%8f%82%e8%80%83>#</a></h2><ul><li><a href=https://themes.gohugo.io/>https://themes.gohugo.io/</a></li><li><a href=https://github.com/dim0627/hugo_theme_robust>https://github.com/dim0627/hugo_theme_robust</a></li><li><a href=https://gohugo.io/hosting-and-deployment/hosting-on-firebase/>https://gohugo.io/hosting-and-deployment/hosting-on-firebase/</a></li></ul></div></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#静态站点>静态站点</a><ul><li><a href=#生成工具>生成工具</a></li><li><a href=#博客主题>博客主题</a></li></ul></li><li><a href=#安装和创建站点>安装和创建站点</a><ul><li><a href=#目标>目标</a></li><li><a href=#hugo安装>Hugo安装</a></li><li><a href=#本地生成站点>本地生成站点</a></li></ul></li><li><a href=#将应用发布到firebase>将应用发布到firebase</a><ul><li><a href=#firebase工具安装>firebase工具安装</a></li><li><a href=#发布>发布</a></li><li><a href=#使用github-ci自动发布>使用github ci自动发布</a></li><li><a href=#使用azure-pipelines发布静态站点到github-pages>使用Azure Pipelines发布静态站点到GitHub Pages</a></li></ul></li><li><a href=#参考>参考</a></li></ul></nav></div></aside></main></body></html>